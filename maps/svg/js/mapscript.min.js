(function(){function Ga(k){h.HTMLWindow&&h.pushInitAction(()=>{h.HTMLWindow.ixmaps.htmlgui_onMapInit(window)});h.Event=new p.Event;h.SVGRootElement.setAttribute("onmouseover","map.Event.defaultMouseOver(evt)");h.SVGRootElement.setAttribute("onmouseout","map.Event.defaultMouseOut(evt)");h.SVGRootElement.setAttribute("onmousedown","map.Event.defaultMouseDown(evt)");h.SVGRootElement.setAttribute("ontouchstart","map.Event.defaultMouseDown(evt)");h.SVGRootElement.setAttribute("onmouseup","map.Event.defaultMouseUp(evt)");
h.SVGRootElement.setAttribute("ontouchend","map.Event.defaultMouseUp(evt);map.Event.defaultMouseClick(evt)");h.SVGRootElement.setAttribute("onmousemove","map.Event.defaultMouseMove(evt)");h.SVGRootElement.setAttribute("ontouchmove","map.Event.defaultMouseUp(evt);map.Event.defaultMouseMove(evt);map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()");h.SVGRootElement.setAttribute("onclick","map.Event.defaultMouseClick(evt)");h.SVGRootElement.setAttribute("onkeydown","map.Event.defaultKeyDown(evt)");h.SVGRootElement.setAttribute("onkeyup",
"map.Event.defaultKeyUp(evt)");typeof h.Event.doDefaultZoom=="function"&&(h.SVGRootElement.addEventListener("SVGZoom",h.Event.doDefaultZoom,!1),h.SVGRootElement.addEventListener("SVGScroll",h.Event.doDefaultPan,!1),h.SVGRootElement.addEventListener("SVGResize",h.Event.doDefaultResize,!1));h.Layer=new p.Layer(k);if(window.ixMap){h.Themes=new p.Themes;try{h.HTMLWindow&&h.HTMLWindow.ixmaps&&h.HTMLWindow.ixmaps.htmlgui_onInitThemes&&h.HTMLWindow.ixmaps.htmlgui_onInitThemes()}catch(u){}}h.antiZoomAndPanList=
new Aa(k);h.antiZoomAndPanList.initAntiZoomPattern(k,null);h.antiZoomAndPanList.initAntiZoomSymbols(null,h.SVGDocument.getElementById("symbolstore"));h.antiZoomAndPanList.initAntiZoomStyles(k);h.Layer.initPatternScaling(k,null);h.Zoom=new p.Zoom(h.Scale.initScale);h.Tiles=new p.Tiles;h.Label=new p.Label;h.Viewport=new p.Viewport(k);h.Layer.switchScaleDependentLayer(k);h.Scale.refreshCSSStyles();h.pushAction(()=>{h.Layer.scaleLineDecorations(h.SVGRootElement,1)});try{h.Dom.clearGroup(contextMenu.firstChild)}catch(u){}try{h.HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(a(Math.floor(h.Scale.nTrueMapScale*
h.Scale.nZoomScale)),0,"BLANK"))}catch(u){}try{h.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(h.Zoom.getEnvelopeString(),!0)}catch(u){}try{h.HTMLWindow.ixmaps.htmlgui_queryMapFeatures()}catch(u){}h.fClipMap&&!h.fClipMapDynamic||h.Zoom.removeClipping();h.fPDFEmbed&&(h.Tiles.switchScaleDependentTiles(k),sa());setTimeout(()=>{h.Zoom.init()},1E3);setTimeout(()=>{h.fadeLogo()},1E4);h.Layer.prepareCheckOverlap(k,h.Layer.layerNode);h.fInitializing=!1;(h.Scale.szMapProjection||"").match(/orthographic/i)&&
h.pushInitAction(()=>{try{var u=5;if(h.HTMLWindow&&h.HTMLWindow.ixmaps)try{var q=h.HTMLWindow.ixmaps.getZoom();q!==void 0&&Number.isFinite(q)&&(u=q)}catch(z){}u===5&&h.Scale.nZoomScale&&h.Scale.nZoomScale>0&&(u=Math.max(1,Math.min(20,Math.log2(h.Scale.nZoomScale)+5)));h._allowOrthographicCenter=!0;h.Zoom.doCenterMapToGeoPosition(0,0);h._allowOrthographicCenter=!1;console.log("Early centering orthographic projection: center:",0,0,"zoom:",u);h.Zoom.doCenterMapToGeoBounds(-.1,-.1,.1,.1)}catch(z){console.error("Error in early orthographic projection centering:",
z)}});h.HTMLWindow&&h.pushInitAction(()=>{h.HTMLWindow.ixmaps.htmlgui_onMapReady(window)});h.pushInitAction(()=>{h.showAll()});h.pushInitAction(()=>{nothing()})}function t(){try{typeof h.HTMLWindow.ixmaps.SVGResources_includePath!="undefined"&&setTimeout("loadSVGIncludes(null,'"+h.HTMLWindow.ixmaps.SVGResources_includePath+"')")}catch(k){}}function H(k,u){u?(h.fSVGEmbeded=!0,document.embeds[u]&&(h.SVGDocument=document.embeds[u].getSVGDocument(),h.EmbedHeight=document.embeds[u].height,h.EmbedWidth=
document.embeds[u].width)):h.SVGDocument=k?k.target.ownerDocument:document.getElementById("svg_map_document");h.SVGDocument.getElementById("widgetstore")&&h.SVGDocument.getElementById("widgetstore").childNodes.length>2&&(h.fAllIncluded=!0);window.parent&&window.screen&&window.location||(h.fPDFEmbed=!0);h.fLocalHost=String(window.location).match(/localhost/);l=navigator.appName;navigator.appName.match(/Adobe/)&&navigator.appVersion.match(/6.0x/)?l="Adobe6.0":navigator.appName.match(/Adobe/)&&navigator.appVersion.match(/3.0/)?
l="Adobe3.0":navigator.appName.match(/Opera/)?l="Opera":navigator.appName.match(/Netscape/)&&(l="Netscape");navigator.userAgent&&navigator.userAgent.match(/Chrome/)?l="Chrome":navigator.userAgent&&navigator.userAgent.match(/Firefox/)&&(l="Firefox");(k=h.SVGDocument.getAttribute("xmlns:xmap"))&&k.length>3&&(e=k);h.HTMLWindow=window}function x(k){if(k){k=k.getAttribute("transform");var u=null;if(k&&(u=k.match(C)))return k=u[1].split(" "),[Number(k[0]),Number(k[1]),Number(k[2]),Number(k[3]),Number(k[4]),
parseFloat(k[5])];if(k&&(u=k.match(N)))return k=u[1].split(","),[Number(k[0]),Number(k[1]),Number(k[2]),Number(k[3]),Number(k[4]),Number(k[5])]}return[1,0,0,1,0,0]}function y(k,u,q){if(k&&u.length==6){var z=!0;u.forEach(function(K){isNaN(K)&&(z=!1)});if(z){var D=k.getAttributeNS(null,"transform");u="matrix("+u[0]+" "+u[1]+" "+u[2]+" "+u[3]+" "+u[4]+" "+u[5]+")";D=D?D.split(")"):[];for(var E=0;E<D.length;E++)D[E].length>3&&(D[E].match(/rotate/)||D[E].match(/scale/)||q&&D[E].match(/translate/))&&(u=
u+" "+D[E]+")");k.setAttributeNS(null,"transform",u)}}}function A(k){return k?(k=x(k),new w(Number(k[4]),Number(k[5]))):new w(0,0)}function I(k,u,q){var z=x(k);z[4]=u;z[5]=q;y(k,[z[0],z[1],z[2],z[3],z[4],z[5]])}function O(k){return k?(k=x(k),new w(Number(k[0]),Number(k[3]))):new w(1,1)}function ha(k,u){u||="transform";return k&&(k=k.getAttributeNS(null,u),u=null,k&&(u=k.match(Y)))?Number(u[1]):0}function Z(k,u,q){q||="transform";if(k){var z=!1,D="",E=k.getAttributeNS(null,q);E=E?E.split(")"):[];for(var K=
0;K<E.length;K++)E[K].match(/rotate/)?(D=D+" rotate("+u+")",z=!0):E[K].length>3&&(D=D+" "+E[K]+")");z||(D=D+" rotate("+u+")");k.setAttributeNS(null,q,D)}}function W(k){if(k.nodeType!=1)return null;for(this.szId="";this.szId===""&&k.parentNode&&k.nodeType==1;)if(this.szId=k.getAttributeNS(null,"id"),typeof this.szId!="string"||this.szId===""||this.szId.match(/noobject/))k=k.parentNode,this.szId="";this.objNode=k;this.fu=new Q(k)}function Q(k){this.nodeObj=k}function xa(k,u){if(!k||!u)return null;k=
k.split(";");for(var q,z=0;z<k.length;z++)if(k[z].match(/stroke-width/))q=k[z].split(":"),q[1]=String(parseFloat(q[1])*u),k[z]=q.join(":");else if(k[z].match(/font-size/))q=k[z].split(":"),q[1]=String(parseFloat(q[1])*u)+"px",k[z]=q.join(":");else if(k[z].match(/stroke-dashoffset/))q=k[z].split(":"),q[1]=String(parseFloat(q[1])*u),k[z]=q.join(":");else if(k[z].match(/stroke-dasharray/)){q=k[z].split(":");var D=q[1].split(",");D.length>1?(k[z]=q[0]+":",q=0):(D=q[1].split(" "),k[z]=q[0]+":",q=0);for(;q<
D.length;q++)D[q]=String(parseFloat(D[q])*u),k[z]+=D[q],q<D.length-1&&(k[z]+=",")}return k.join(";")}function Aa(k){this.listA=[];this.buildList(k)}function Oa(k){return k==h._activeTheme}function aa(){h._legendIdent&&(h._legendIdent.style.setProperty("display","none",""),h._legendIdent=null);h._activeTheme=null;h.highLightList.removeAll()}function ca(k){return k&&k.length?k.replace(/\\/gi,"\\\\").replace(/"/gi,'\\"'):k}function X(){m&&clearTimeout(m);h._tooltip&&(h.SVGTltipGroup.fu.clear(),h._tooltip=
null);try{h.HTMLWindow.ixmaps.htmlgui_onTooltipDelete()&&(h.highLightList.unlock(),h.highLightList.removeAll())}catch(k){}}function ba(k,u,q){if(q!="notify"||h.fNotify)if(typeof k!="string"||k.length===0)h.SVGMessageGroup.fu.clear();else{F&&(clearTimeout(F),F=null);k=h.Dictionary.getLocalText(k);if(q!="notify"&&q!="big")if(h.isInitializing())try{h.HTMLWindow.ixmaps.htmlgui_displayInfo(k);return}catch(fa){}else try{if(h.HTMLWindow.ixmaps.htmlgui_isInfoDisplay()){h.HTMLWindow.ixmaps.htmlgui_displayInfo(k);
u&&sa(u);return}}catch(fa){}if(q=="big")var z=64,D="transparent",E=new w(h.Scale.bBox.width/2+h.Scale.mapPosition.x,h.Scale.normalY(38));else q=="notify"?(z=24,D="flat",E=new w(h.Scale.bBox.width/2+h.Scale.mapPosition.x,h.Scale.mapPosition.y+(h.Scale.normalY(z*2/3)+h.nToolMarginTop))):q=="top"?(z=24,D="flat",E=new w(h.Scale.bBox.width/2+h.Scale.mapPosition.x,h.Scale.mapPosition.y+(h.Scale.normalY(z*2/3)+h.nToolMarginTop))):(z=36,D="flat",E=new w(h.Scale.bBox.width/2+h.Scale.mapPosition.x,h.Scale.bBox.height/
2+h.Scale.mapPosition.y-h.Scale.normalX(z/2)));if(h.SVGDocument&&h.SVGMessageGroup&&(q=="notify"?h.SVGNotifyGroup.fu.clear():h.SVGMessageGroup.fu.clear(),k&&k.length)){var K=null;try{var P=new TextField(null,q=="notify"?h.SVGNotifyGroup:h.SVGMessageGroup,D,z);P.setText(k);K=P.textGroup;var T=K.fu.getBox();K.fu.setPosition(E.x-T.width/2,E.y+T.height/2)}catch(fa){K=pa(h.SVGDocument,q=="notify"?h.SVGNotifyGroup:h.SVGMessageGroup,"popup_message",k,z);try{T=K.fu.getBox(),K.fu.setPosition(E.x-T.width/2,
E.y+T.height/2)}catch(wa){K.fu.setPosition(E.x-h.Scale.normalX(50),E.y+h.Scale.normalX(10))}}}u&&(q=="notify"?u?(V&&clearTimeout(V),V=setTimeout("clearNotify()",u)):h.SVGNotifyGroup.fu.clear():sa(u))}}function sa(k){F&&!k||ua(k||0)}function ua(k){if(k)F&&clearTimeout(F),F=setTimeout("do_clearMessage()",k);else{try{h.HTMLWindow.ixmaps.htmlgui_killInfo()}catch(u){}h.SVGMessageGroup.fu.clear()}}function S(k,u,q,z,D,E){h.SVGDocument&&h.SVGMessageGroup&&(q=h.Dom.newGroup(h.SVGMessageGroup,"popup_progressbar"),
q.fu.setPosition(0,0),q.fu.scale(20,20),h.Dom.newShape("rect",q,0,0,h.SVGWidth/u*k,1.5,"fill:#3787D7;stroke:none;"));z&&sa(z)}function ja(k){if(typeof console!="undefined"&&typeof console.log!="undefined"){var u=new Date;u=u.getMinutes()+":"+String(u.getSeconds())+"."+String(u.getMilliseconds());console.log("_LOG: time["+u+"] "+k)}}function pa(k,u,q,z,D){D||=12;if(k&&u)return k=h.Dom.newGroup(u,q),u=h.Dom.newShape("rect",k,1,1,1,1,"fill:#aaaaaa;opacity:0.5;stroke:none"),q=h.Dom.newShape("rect",k,
1,1,1,1,"fill:#fefeff;stroke:#aaaaaa;stroke-width:"+h.Scale.normalX(.2)),h.Dom.newText(k,0,h.Scale.normalY(D*1.25),"font-family:arial;font-size:"+h.Scale.normalY(D)+"px;fill:"+h.szInfoBodyColor,z),ka=k,Sa=q,Ma=u,Na=D,Ja(),k}function Ja(){var k=Na,u=h.Dom.getBox(ka);Sa.setAttributeNS(null,"rx",h.Scale.normalX(4));Sa.setAttributeNS(null,"ry",h.Scale.normalX(4));Sa.setAttributeNS(null,"x",-h.Scale.normalX(k*.75));Sa.setAttributeNS(null,"y",-h.Scale.normalY(1));Sa.setAttributeNS(null,"width",u.width+
h.Scale.normalX(k*1.5));Sa.setAttributeNS(null,"height",u.height+h.Scale.normalY(k)/2);Ma.setAttributeNS(null,"rx",h.Scale.normalX(4));Ma.setAttributeNS(null,"ry",h.Scale.normalX(4));Ma.setAttributeNS(null,"x",-h.Scale.normalX(k*.75)+h.Scale.normalX(1));Ma.setAttributeNS(null,"y",h.Scale.normalY(1));Ma.setAttributeNS(null,"width",u.width+h.Scale.normalX(k*1.5)+h.Scale.normalX(1.5));Ma.setAttributeNS(null,"height",u.height+h.Scale.normalX(k)/2-h.Scale.normalX(0))}function Ba(k){h.isIdle();try{typeof k===
"function"?k():(console.warn("doExecuteWithMessage: Executing string via eval. This is unsafe. Please pass a function."),eval(k))}catch(u){alert("error '"+u+"' on: "+k)}}function d(k){if(typeof k=="undefined"||k==null||k.length<2)return null;try{for(var u=[],q=k.split(";"),z=0;z<q.length;z++)if(q[z].length){var D=q[z].split(":");u[D[0]]=D[1]}return u}catch(E){alert("ERROR parsing: "+k)}return null}function a(k,u,q){k=Number(k);if(!isFinite(k)||!isFinite(u)||k===0||k>1E12||k<-1E12)return String(k);
h.fDecimalPointComma||(q+="|BLANK");u||=0;u=Math.max(0,u);if(k>1E-7&&u>0)for(;k.toFixed(u)===0;)u++;k=k.toFixed(u+1);var z=Math.pow(10,u);k=q&&q.match(/CEIL/)?Math.ceil(k*z)/z:q&&q.match(/FLOOR/)?Math.floor(k*z)/z:Math.round(k*z)/z;z=String(k);for(z=z.match(/\./)?z.split(".")[1]:"";z.length<u;)z+="0";u=k<0?"-":"";var D="";k=Math.floor(Math.abs(k));if(!q||!q.match(/NOBREAKS/)){for(var E=1E3;k>E;)E*=1E3;E/=1E3;for(var K,P=" ";E>=1E3;)K=Math.floor(k/E),u+=g(K,D),k%=E,E/=1E3,K&&(D="0",P=q&&q.match(/BLANK/)?
" ":"."),u+=P;u+=g(k,D);u.length&&u!="-"||(u+="0");z.length&&(u+=(q&&q.match(/BLANK/)?".":",")+z)}return u}function g(k,u){u||="";var q="";k<100&&(q+=u);k<10&&(q+=u);return q=k===0?q+u:q+String(k)}function b(){this.szUrlA=[];this.stackA=[];this.nPending=0;this.importSVGFile=function(k,u,q,z){if(this.szUrlA[k]==q)return!1;this.doImportSVGFile(k,u,q,z)};this.push=function(k,u,q,z){this.stackA.push({szUrl:k,svgDocument:u,targetGroup:q,callback:z})};this.pop=function(){if(!this.isWaiting()){var k=this.stackA.shift();
k&&this.doImportSVGFile(k.szUrl,k.svgDocument,k.targetGroup,k.callback)}};this.doImportSVGFile=function(k,u,q,z){function D(E){this.parent=E}this.nPending++;D.prototype.operationComplete=function(E,K,P){this.parent.nPending--;this.parent.pop();K&&E==200&&(this.processImported(K.documentElement),ja("SVGLoader: "+k+" (loaded)"))};D.prototype.processImported=function(E){if(k.match(/widget/))for(var K=h.Dom.getAllIds(E),P=0;P<K.length;P++){var T=h.SVGDocument.getElementById(K[P]);T&&T.parentNode.removeChild(T)}k.match(/pattern/)&&
(q=h.Dom.newGroup(q,String(Math.random())));q.appendChild(E);if(!this.initMenu(q)){this.initCSS(q);this.initScripts(q);k.match(/widget/)&&this.initToolbar(q);k.match(/logo/)&&this.initLogo(q);this.loadScripts(q);try{h.antiZoomAndPanList.initAntiZoomPattern(null,q),h.Layer.initPatternScaling(null,q)}catch(fa){}k.match(/symbol/)&&h.Scale.normalizeSymbols(q);k.match(/widget/)&&h.Scale.normalizeButtons(q)}};D.prototype.initMenu=function(E){E=E.getElementsByTagName("menu");if(E.length){for(var K=0;K<E.length;K++){var P=
E.item(K).getAttributeNS(null,"id");(P=h.SVGDocument.getElementById(P))&&P!=E.item(K)&&(P.parentNode.removeChild(P),K--)}return!0}return!1};D.prototype.initToolbar=function(E){try{h.Toolbar.init(),h.Legend.init()}catch(K){}return!0};D.prototype.initLogo=function(E){var K=h.SVGDocument.getElementById("mapbackground:logo");K===null&&(K=h.Dom.newGroup(h.SVGDocument.getElementById("mapbackground"),"mapbackground:logo"));if(K){h.Dom.clearGroup(K);E=E.getElementsByTagName("svg").item(0).childNodes;for(var P=
0;P<E.length;P++)K.appendChild(E.item(P)),P--}return!0};D.prototype.loadScripts=function(E){E=E.getElementsByTagName("script");for(var K=0;K<E.length;K++){var P=E.item(K).getAttributeNS("http://www.w3.org/1999/xlink","href");P&&P.length&&(new v).loadScript(P)}return!0};D.prototype.initScripts=function(E){E=E.getElementsByTagName("script");for(var K=0;K<E.length;K++)if(E.item(K).firstChild){var P=E.item(K).firstChild.nodeValue;try{eval(P)}catch(T){ja("ERROR: could not eval loaded script!")}}return!0};
D.prototype.initCSS=function(E){return E.getElementsByTagName("style").length?(h.SVGDocument.getElementById("mapstyles"),!0):!1};k.length>0&&c(k,new D(this))};this.isWaiting=function(){return this.nPending}}function r(){this.szUrlA=[];this.stackA=[];this.nToLoad=this.nRequest=this.nPending=0;this.importSVGFile=function(k,u,q,z){if(q&&this.szUrlA[k]==q)return!1;this.nRequest++;this.nToLoad++;h.fLoadingSilent?this.doImportSVGFile(k,u,q,z):!h.fLoadMultiTiles&&this.isWaiting()?this.push(k,u,q,z):(ba(h.Dictionary.getLocalText("loading map")),
S(0,1,h.Dictionary.getLocalText("loading map")),this.push(k,u,q,z),setTimeout("__svgLoaderMap.pop()",10));return!0};this.push=function(k,u,q,z){this.isStacked(k,u,q)||this.stackA.push({szUrl:k,svgDocument:u,targetGroup:q,callback:z})};this.pop=function(){if(!this.isWaiting()){var k=this.stackA.shift();k?(S(this.nToLoad-this.nPending-this.stackA.length,this.nToLoad,h.Dictionary.getLocalText("loading map elements")),this.doImportSVGFile(k.szUrl,k.svgDocument,k.targetGroup,k.callback)):this.nToLoad=
this.nRequest=0}};this.isStacked=function(k,u,q){for(var z=0;z<this.stackA.length;z++)if(this.stackA[z].szUrl==k&&this.stackA[z].svgDocument==u&&this.stackA[z].targetGroup==q)return!0;return!1};this.isAnyStacked=function(){return this.stackA.length};this.doImportSVGFile=function(k,u,q,z){function D(E){this.parent=E}if(q&&this.szUrlA[k]==q)return!1;this.szUrlA[k]=q;this.nPending++;D.prototype.operationComplete=function(E,K,P){this.parent.szUrlA[k]=null;this.parent.nPending--;this.parent.nRequest--;
K&&E==200?this.processImported(K.documentElement):ba("error loading map");this.parent.pop()};D.prototype.processImported=function(E){var K=function(P,T){T&&P?(P.parentNode.insertBefore(T,P),P.parentNode.removeChild(P)):T?T.parentNode.nodeName=="defs"?h.SVGRootElement.appendChild(T.parentNode):h.SVGRootElement.appendChild(T):P&&P.parentNode.removeChild(P)};h.hideAll();K(h.SVGDocument.getElementsByTagName("metadata")[2],E.getElementsByTagName("metadata")[0]);K(h.SVGDocument.getElementById("maplayer"),
E.getElementById("maplayer"));K(h.SVGDocument.getElementById("extension"),E.getElementById("extension"));K(h.SVGDocument.getElementById("mapclipdef"),E.getElementById("mapclipdef"));K(h.SVGDocument.getElementById("mapstyles"),E.getElementById("mapstyles"));(K=E.getElementsByTagName("pattern"))&&K[0]&&(E=E.getElementsByTagName("pattern")[0].parentNode,h.SVGRootElement.appendChild(E));h.Scale=new p.Scale(null);h.Scale.superclass=h;h.Scale.createWidgetStyles();h.Scale.normalizeSymbols(h.SVGDocument.getElementById("symbolstore"));
h.Scale.normalizeButtons(h.SVGDocument.getElementById("widgetstore"));h.Layer=new p.Layer(null);h.Layer.initPatternScaling(null,null);h.Zoom=new p.Zoom(h.Scale.initScale);h.Tiles=new p.Tiles;h.Label=new p.Label;h.Viewport=new p.Viewport;h.Query=new p.Query;h.Layer.switchScaleDependentLayer();h.Scale.refreshCSSStyles();h.HTMLWindow.ixmaps.htmlgui_onMapReady(window);setTimeout("map.showAll()",1E3)};console.log("*** load new map ***");console.log(k);console.log("********************");return k.length>
0?(c(k,new D(this)),!0):!1};this.isWaiting=function(){return this.nPending};this.isLoading=function(){return this.nPending|this.isAnyStacked()}}function n(){this.loaderA=[];this.szSuffix=".js";this.loadedUrlA=[];this.loadingUrlA=[];this.errorUrlA=[]}function v(){this.loadedScripts=[];this.reqCnt=0;this.isLoading=!1;this.finishedCallback=this.errorCallback=null;this.szMessage="... loading ...";this.pool=Ka;this.pool.add(this)}function c(k,u){if(window.getURL)window.getURL(k,u);else if(window.XMLHttpRequest){var q=
function(){z.readyState==4&&u.operationComplete(z.status,z.responseXML,z.responseText)};try{var z=null;z=new XMLHttpRequest;z.open("GET",k,!0);z.onreadystatechange=q;z.send(null)}catch(D){}}else alert("your browser/svg viewer neither supports window.getURL nor window.XMLHttpRequest!")}var e="http://www.medienobjekte.de",f=96,m=null,l="Adobe3.0";typeof printNode=="undefined"&&(window.printNode=function(k){return(new XMLSerializer).serializeToString(k)});var h=null,p=function(){this.fInitializing=!1;
this.Api=this.Viewport=this.Toolbar=this.Legend=this.Themes=this.Query=this.Zoom=this.Tiles=this.Layer=this.Scale=this.Event=null;this.mapRoot="";this.Loader=new b;this.rootGroup=this.SVGDocument=null;this.nNodesCreated=0;this.fObjectPseudoShadow=!0;this.fSVGEmbeded=this.fEmbedScale=!1;this.EmbedHeight=this.EmbedWidth=this.SVGOrigViewBoxString=this.SVGViewBox=this.SVGHeight=this.SVGWidth=this.SVGTempGroup=this.SVGHiddenGroup=this.SVGTltipGroup=this.SVGMenuGroup=this.SVGMessageGroup=this.SVGNotifyGroup=
this.SVGPopupGroup=this.SVGFixedGroup=this.SVGThemeGroup=this.SVGToolsGroup=this.SVGRootElement=this.HTMLWindow=null;this.fTransparentMap=!1;this.fClipMap=!0;this.fAllIncluded=this.fPDFEmbed=this.fZoomByViewer=this.fClipMapDynamic=!1;this.fSwitchByCSS=!0;this.fLocalHost=!1;this.fDynamicTiles=this.fDynamicLayer=this.fLoadIncludes=!0;this.fTilesLoaded=!1;this.fDiscardTiles="delayed";this.fLoadMultiTiles=!0;this.fLoadingSilent=this.fMarkTiles=!1;this.fExecuteSilent=!0;this.fNotify=!1;this.szObjectGroupId=
"mapobjects";this.szShadowFilterId="DropShadowFilterObjects:antizoomandpan";this.szShadowFilterToolsId="DropShadowFilterTools:antizoomandpan";this.szShadowFilterShapeId="DropShadowFilterShape:antizoomandpan";this.fSymbolScalingDynamic=this.fObjectScaling=this.fFeatureScaling=this.fAntiZoomAndPan=!0;this.fFeatureScalingDynamic=!1;this.fCheckLabelOverlap=this.fAdaptLabelToScaling=!0;this.fCheckLabelSpace=!1;this.nCheckLabelSpace=.8;this.fCheckLabelSize=this.fCheckLabelSqueeze=!0;this.fCheckLabelOnlyOne=
this.fKillOverlappingLabel=!1;this.fCheckOverlapAllLayer=this.fCheckOverlapImplicit=!0;this.fTileTextNoClip=this.fCheckOverlapClipOnTiles=!1;this.fFeatureScalingByLayer=!0;this.fPanByViewer=this.fPendingNewGeoBounds=this.fFroozeDynamicContent=!1;this.fPanHideTools=this.fPanToolByViewer=!0;this.fEndPan="normal";this.fRotateOnMouseMove=!1;this.fPreserveMapRatio=this.fTriggerMouseMoveForPan=!0;this.fMapBorder3D=this.fMapBorder=this.fInitLegendOff=!1;this.nMapBorderWidth=1;this.szMapBorderColor="#B6BAC0";
this.szMapPanBorderStyle="fill:#E0E5F0";this.szMapPanBorderOnoverStyle="fill:#d0d5e0";this.szMapBackgroundColor=this.szMapBackgroundStyle=null;this.fLegendToggleButtons=this.fClipMapToLegend=!1;this.fNorthArrow="rotatable";this.szNorthArrowPosition="INMAP";this.szLocalPopupAlignment=null;this.szMessagePosition="center";this.nToolMarginTop=0;this.nFixedInfoScale=1;this.fScaleBar=!0;this.fActivateInfoOnClick=this.fSetToolCursor=this.fStatus=this.fDebug=!1;this.szTextGridStyle="background:#dddddd";this.fCheckSublayerCollapse=
!1;this.fCreatTextLink=!0;this.nClipTextLink=30;this.nInfoOffsetX=25;this.nInfoOffsetY=-25;this.szInfoTitleColor="#000000";this.szInfoTitleBgColor="#ffffff";this.szInfoBodyColor="#444444";this.szInfoBodyBgColor="#FFFFDD";this.nInfoRoundRect=2;this.fDecimalPointComma=this.fActiveThemeInfo=this.fInfoShowShape=!1;this.nNormalSymbolSize=20;this.nNormalButtonSize=10;this.nNormalFontSize=12;this.nHighlightToggle=0;this.fScaleToFullscreen=this.fLoadExternalData=!1;this.fAdaptMapScaleToSize=this.fHighlightHint=
!0;this.fLimitMapToExtent=!1;this.szMapToolType="";this.szLinkTarget="_blank";this.szEmbedName="SVGMap";this.highLightList=this.zoomAndPanHistory=this.bookmarkList=this.mapTiles=this.mapTool=this.mouseObject=this.antiZoomAndPanList=this._tooltip=this._activeItem=this._activeTheme=this._legendIdent=this.newShape=null;this.initActionA=[];this.initMessageA=[];this.actionA=[];this.messageA=[]};p.prototype.setFeatures=function(k){this.szFeatures=(this.szFeatures||"")+";"+k;k=k.split(";");for(var u in k){var q=
k[u].split(":");switch(q[0]){case "featurescaling":q[1]=="dynamic"?this.fFeatureScalingDynamic=this.fFeatureScaling=!0:(this.fFeatureScaling=q[1]=="false"?!1:q[1],this.fFeatureScalingDynamic=!1);break;case "objectscaling":this.fObjectScaling=q[1]=="dynamic"?"dynamic":q[1]=="false"?!1:q[1];break;case "objectlayer":this.szObjectGroupId=q[1]=="belowlabel"?"mapobjects_below_label":q[1];break;case "dynamiclabel":(this.fAdaptLabelToScaling=q[1]=="false"?!1:q[1])?(this.fKillOverlappingLabel=this.fCheckLabelSqueeze=
this.fCheckLabelSpace=this.fCheckLabelOverlap=!0,this.fCheckLabelOnlyOne=!1,q[1].match(/CHECKSPACE/)&&(this.fCheckLabelSpace=!0),q[1].match(/NOCHECKSPACE/)&&(this.fCheckLabelSpace=!1),q[1].match(/NOREPOSITIONING/)&&(this.fKillOverlappingLabel=this.fCheckLabelOverlap=!0),q[1].match(/NOREMOVE/)&&(this.fKillOverlappingLabel=!1),q[1].match(/CHECKOVERLAP/)&&(this.fCheckLabelOverlap=!0),q[1].match(/NOCHECKOVERLAP/)&&(this.fCheckLabelOverlap=!1),q[1].match(/ONLYONE/)&&(this.fCheckLabelOnlyOne=!0),q[1].match(/SQUEEZE/)&&
(this.fCheckLabelSpace=!0),q[1].match(/NOSQUEEZE/)&&(this.fCheckLabelSqueeze=!1),q[1].match(/SIZE/)&&(this.fCheckLabelSize=!0),q[1].match(/NOSIZE/)&&(this.fCheckLabelSize=!1),q[1].match(/CLIPONTILES/)&&(this.fCheckOverlapClipOnTiles=!0),q[1].match(/NOCLIPONTILES/)&&(this.fCheckOverlapClipOnTiles=!1)):this.fCheckLabelOnlyOne=this.fKillOverlappingLabel=this.fCheckLabelSize=this.fCheckLabelSqueeze=this.fCheckLabelSpace=this.fCheckLabelOverlap=!1;break;case "dynamiclayer":this.fDynamicLayer=q[1]=="false"?
!1:q[1];break;case "dynamictiles":this.fDynamicTiles=q[1]=="false"?!1:q[1];break;case "discardtiles":this.fDiscardTiles=q[1]=="false"?!1:q[1];break;case "loadmultitiles":this.fLoadMultiTiles=q[1]=="false"?!1:q[1];break;case "loadexternaldata":this.fLoadExternalData=q[1]=="false"?!1:q[1];break;case "loadincludes":this.fLoadIncludes=q[1]=="false"?!1:q[1];break;case "loadsilent":this.fLoadingSilent=q[1]=="false"?!1:q[1];break;case "worksilent":this.fExecuteSilent=q[1]=="false"?!1:q[1];break;case "notify":this.fNotify=
q[1]=="false"?!1:q[1];break;case "fastpan":this.fPanToolByViewer=q[1]=="false"?!1:q[1];break;case "fullscreen":this.fScaleToFullscreen=q[1]=="false"?!1:q[1];break;case "realtimerotate":this.fRotateOnMouseMove=q[1]=="false"?!1:q[1];break;case "tooltipdelay":this.nTooltipTimeout=Number(q[1]);break;case "popupdelay":this.nInfoTimeout=Number(q[1]);break;case "popupgridstyle":this.szTextGridStyle=q[1];break;case "buttonsize":this.nNormalButtonSize=Number(q[1]);break;case "symbolsize":this.nNormalSymbolSize=
Number(q[1]);break;case "panborder":this.fMapBorder=!0;this.nMapBorderWidth=Number(q[1]);break;case "sidebarbuttons":this.fLegendToggleButtons=q[1]=="false"?!1:q[1];break;case "3Dborder":this.fMapBorder3D=q[1]=="false"?!1:q[1];break;case "mapbackgroundstyle":this.szMapBackgroundStyle=q[1];break;case "mapbackgroundcolor":this.szMapBackgroundColor=q[1];break;case "transparent":case "transparentbackground":this.fTransparentMap=!0;break;case "mapopacity":this.nOpacity=parseFloat(q[1]);this.setOpacity(this.nOpacity,
"absolute");break;case "clipmap":q[1]=="dynamic"?this.fClipMapDynamic=this.fClipMap=!0:(this.fClipMap=q[1]=="false"?!1:q[1],this.fClipMapDynamic=!1);break;case "checklabeloverlap":this.fCheckLabelOverlap=q[1]=="false"?!1:q[1];break;case "onlyonelabel":this.fCheckLabelOnlyOne=q[1]=="false"?!1:q[1];break;case "labelspace":this.nCheckLabelSpace=parseFloat(q[1]);break;case "decimalpoint":this.fDecimalPointComma=q[1]==","||q[1]=="komma"||q[1]=="Komma"||q[1]=="comma"?!0:!1;break;case "dynamicscale":this.fAdaptMapScaleToSize=
q[1]=="false"?!1:q[1];break;case "toolcursor":this.fSetToolCursor=q[1]=="false"?!1:q[1];break;case "scalebar":this.fScaleBar=q[1]=="false"?!1:q[1];break;case "northarrow":this.fNorthArrow=q[1]=="false"?!1:q[1];break;case "northarrowposition":this.szNorthArrowPosition=q[1];break;case "screenppi":(f=Number(q[1]))||(f=96);break;case "embedname":this.szEmbedName=q[1];break;case "debug":this.fDebug=q[1];break;case "marktiles":this.fMarkTiles=q[1];break;case "popupalignment":this.szLocalPopupAlignment=
q[1];break;case "toolmargintop":this.nToolMarginTop=Number(q[1]);break;case "messageposition":this.szMessagePosition=q[1];break;case "maxThemeCharts":this.Themes.nMaxThemeCharts=Number(q[1]);break;case "maxShadowCharts":this.Themes.nMaxShadowCharts=Number(q[1]);break;case "flushPaintShape":this.Themes.nflushPaintShape=Number(q[1]);break;case "flushChartDraw":this.Themes.nflushChartDraw=Number(q[1]);this.Themes.activeTheme&&(this.Themes.activeTheme.nflushChartDraw=Number(q[1]));break;case "flushLabelDraw":this.Label.nflushLabelDraw=
Number(q[1]);break;case "activeThemeInfo":this.fActiveThemeInfo=q[1];break;case "fixedInfoScale":this.nFixedInfoScale=Number(q[1]);break;case "normalSizeScale":this.Scale.nNormalSizeScale=Number(q[1]);break;case "dynamicScalePow":this.Scale.nDynamicScalePow=Number(q[1])}}this.fClipMap&&!this.fClipMapDynamic||h.Zoom.removeClipping()};p.prototype.getFeatures=function(){this.szFeatures+=";mapopacity:"+String(this.nOpacity||1);return this.szFeatures+=";flushChartDraw:"+String(this.Themes.nflushChartDraw||
1E5)};p.prototype.isLoading=function(){return this.Loader&&this.Loader.isWaiting()||this.mapLoader&&this.mapLoader.isWaiting()||h.Tiles&&h.Tiles.isLoading()||Ka.isLoading()?!0:!1};p.prototype.isInitializing=function(){return this.fInitializing||this.Legend&&this.Legend.fInitializing||!this.Scale?!0:!1};p.prototype.isIdle=function(){return this.isInitializing()||this.isLoading()||this.actionA.length!==0||this.initActionA.length!==0?!1:!0};p.prototype.pushAction=function(k,u){if(k.toString().match(/geobounds/i)){for(var q=
0;q<this.actionA.length;q++)this.actionA[q].toString().match(/geobounds/i)&&(this.actionA[q].slice(q,1),this.messageA[q]&&this.messageA[q].slice(q,1));this.fPendingNewGeoBounds=!0}if(k.toString().match(/toview/i)){for(q=0;q<this.actionA.length;q++)this.actionA[q].toString().match(/toview/i)&&(this.actionA[q].slice(q,1),this.messageA[q]&&this.messageA[q].slice(q,1));this.fPendingNewGeoBounds=!0}this.actionA.push(k);this.messageA.push(u);this.isInitializing()||this.actionA.length!=1||setTimeout("map.popAction()",
10)};p.prototype.pushInitAction=function(k,u){this.initActionA.push(k);this.initMessageA.push(u);this.initActionA.length==1&&setTimeout("map.popInitAction()",10)};p.prototype.popAction=function(){if(this.actionA.length!==0)if(this.isLoading()||this.isInitializing())if(this.isLoading()?this.npopActionWaitInit=0:this.npopActionWaitInit++,this.npopActionWaitInit<100)setTimeout("map.popAction()",500);else{alert("Error at initializing !\nResource missing or corrupted ?\n");this.actionA.length=0;this.initActionA.length=
0;this.fInitializing=!1;try{h.HTMLWindow&&h.HTMLWindow.ixmaps.htmlgui_onMapError(window)}catch(q){}}else{var k=this.actionA.shift(),u=this.messageA.shift();u&&ba(u,1E3);if(typeof k==="function")try{k()}catch(q){q&&typeof q!="undefined"&&q.description&&typeof q.description!="undefined"&&alert("Error: "+q.description+":\n\n"+k)}else console.error("map.pushAction: Strings are no longer supported. Please pass a function."),alert("Error: map.pushAction called with string. See console for details.");setTimeout("map.popAction()",
10)}};p.prototype.popInitAction=function(){if(this.initActionA.length===0)h.npopActionWaitInit=0,h.popAction();else{if(!this.isLoading()){var k=this.initActionA.shift(),u=this.initMessageA.shift();u&&ba(u,1E3);if(typeof k==="function")try{k()}catch(q){}else console.error("map.pushInitAction: Strings are no longer supported. Please pass a function."),alert("Error: map.pushInitAction called with string. See console for details.")}setTimeout("map.popInitAction()",10)}};p.prototype.checkVersion=function(k){return k===
null||k!=this.version?!1:!0};p.prototype.fadeLogo=function(){var k=this.SVGDocument.getElementById("mapbackground:logo");k&&k.parentNode.removeChild(k)};p.prototype.hideAll=function(){var k=this.SVGDocument.getElementById("mapcanvas");k&&k.style.setProperty("display","none","")};p.prototype.showAll=function(){var k=this.SVGDocument.getElementById("mapcanvas");k&&k.style.setProperty("display","inline","")};p.prototype.hideMap=function(){if(!this.fHidden){var k=this.SVGDocument.getElementById("maplayer");
k&&k.style.setProperty("display","none","");(k=this.SVGDocument.getElementById("mapobjects"))&&k.style.setProperty("display","none","");this.fHidden=!0}};p.prototype.showMap=function(){if(this.fHidden){var k=this.SVGDocument.getElementById("maplayer");k&&k.style.setProperty("display","inline","");(k=this.SVGDocument.getElementById("mapobjects"))&&k.style.setProperty("display","inline","");this.fHidden=!1}};p.prototype.setOpacity=function(k,u){var q=this.SVGDocument.getElementById("maplayer");if(q)if(u==
"absolute")q.style.setProperty("opacity",k,""),this.nOpacity=k;else{u=q.style.getPropertyValue("opacity");if(u===null||u.length===0)u="1";u=parseFloat(u);this.nOpacity=u=Math.min(Math.max(u+k,0),1);q.style.setProperty("opacity",u,"")}};p.prototype.toggleOpacity=function(){var k=this.SVGDocument.getElementById("maplayer");if(k){var u=k.style.getPropertyValue("opacity");if(u===null||u.length===0)u="1";u=parseFloat(u);k.style.setProperty("opacity",u<1?1:0,"")}};p.prototype.clearAll=function(){h.Dom.clearGroup(h.SVGToolsGroup);
h.Dom.clearGroup(h.SVGFixedGroup);h.removeAllHighlights();h.Themes&&h.Themes.removeAll&&h.Themes.removeAll();setMapTool("");this.Scale.nObjectScaling=1};p.prototype.loadMap=function(k){this.mapLoader||(this.mapLoader=new r);if(this.mapLoader.importSVGFile(k,this.SVGDocument)){try{h.HTMLWindow.ixmaps.loadingMap=k}catch(u){}k.match(/http/)?(k=k.split(/\//),k.splice(-1),k=k.join("/"),this.mapRoot=k+"/"):this.mapRoot="";this.clearAll();h.Dom.clearGroup(h.Layer.objectGroup)}};h=new p;h.version="0.98";
window.map=h;window.thisversion="0.98";var B=0;p.Dom=function(k){this.targetDocument=window.document;k&&(this.targetDocument=k.target.ownerDocument);this.rootElement=h.SVGDocument;this.idList=[];this.objStackA=[]};p.Dom.prototype=new p;p.Dom.prototype.setTargetDocument=function(k){k&&(this.targetDocument=k)};p.Dom.prototype.setTargetGroup=function(k){k&&(this.targetGroup=k)};p.Dom.prototype.newNode=function(k,u){k=this.targetDocument.createElementNS("http://www.w3.org/2000/svg",k);(u||this.targetGroup).appendChild(k);
return k};p.Dom.prototype.newGroup=function(k,u){if(k=this.newNode("g",k))u&&k.setAttribute("id",u),k.fu=new Q(k);return k};p.Dom.prototype.newObject=function(k,u){if(k=this.newNode(k,u))k.fu=new Q(k);return k};p.Dom.prototype.getObjectById=function(k){if(k=this.targetDocument.getElementById(k))k.fu=new Q(k);return k};p.Dom.prototype.clearGroup=function(k){if(k&&k.hasChildNodes())for(var u=k.childNodes,q=u.length-1;q>=0;q--)k.removeChild(u.item(q))};p.Dom.prototype.removeElementById=function(k){(k=
h.SVGDocument.getElementById(k))&&k.parentNode&&k.parentNode.removeChild(k)};p.Dom.prototype.constructNode=function(k,u,q){k=this.newObject(k,u);for(var z in q)z.match(/xlink/)?k.setAttributeNS("http://www.w3.org/1999/xlink",z,q[z]):k.setAttribute(z,q[z]);return k};p.Dom.prototype.pushObj=function(k){var u="stackedObject"+String(Math.random());this.objStackA[u]=k;return u};p.Dom.prototype.popObj=function(k){return this.objStackA[k]};p.Dom.prototype.newShape=function(k,u,q,z,D,E,K,P,T,fa,wa,Fa,Ha){P=
null;switch(k){case "rect":isNaN(D)||D<=0||isNaN(E)||E<=0||(P={x:String(q),y:String(z),width:String(D),height:String(E),style:K});break;case "circle":isFinite(D)&&D>0&&(P={cx:String(q),cy:String(z),r:String(D),style:E});break;case "line":isFinite(q)&&isFinite(z)&&isFinite(D)&&isFinite(E)&&(P={x1:String(q),y1:String(z),x2:String(D),y2:String(E),style:K});break;case "path":P={d:String(q),style:z}}return P?this.constructNode(k,u,P):null};p.Dom.prototype.newText=function(k,u,q,z,D){if(!isFinite(u)||!isFinite(q))return null;
D&&typeof D!="undefined"||(D="(undefined)");D=String(D);if(h.fCreatTextLink&&D.substr(0,7)=="http://"||h.fCreatTextLink&&D.substr(0,8)=="https://")return this.newTextLink(k,u,q,z,D);k=this.constructNode("text",k,{x:String(u),y:String(q),style:z});D=this.targetDocument.createTextNode(D);k.appendChild(D);return k};p.Dom.prototype.newTSpan=function(k,u,q){if(k.nodeName!="text")return null;q||="(undefined)";k=this.constructNode("tspan",k,{style:u});q=this.targetDocument.createTextNode(q);k.appendChild(q);
return k};p.Dom.prototype.newTextOnPath=function(k,u,q,z,D){q&&typeof q!="undefined"||(q="(undefined)");q=String(q);var E=this.constructNode("text",k,{style:z});k=this.constructNode("textPath",k,{style:z});k.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+u);k.setAttributeNS(null,"startOffset",D);u=this.targetDocument.createTextNode(q);k.appendChild(u);E.appendChild(k);return E};p.Dom.prototype.newTextLink=function(k,u,q,z,D,E){k=this.constructNode("a",k);k.setAttributeNS("http://www.w3.org/1999/xlink",
"xlink:href",E?E:D);k.setAttributeNS(null,"target",szLinkTarget);D&&D.length>30&&(D=D.substr(0,29)+" ...");u=this.constructNode("text",k,{x:String(u),y:String(q),style:z});D=this.targetDocument.createTextNode(D);u.appendChild(D);u.style.setProperty("fill","blue","");u.style.setProperty("text-decoration","underline","");return k};p.Dom.prototype.wrapText=function(k,u){var q=k.firstChild.data,z=k.style.getPropertyValue("font-size");if(q){var D=k.getAttributeNS(null,"x");q=q.split(" ");k.removeChild(k.firstChild);
var E=this.newTSpan(k,"",q[0]);E.setAttributeNS(null,"x",D);for(var K=1,P=1;P<q.length;P++){var T=E.firstChild.data.length;E.firstChild.data+=" "+q[P];E.getComputedTextLength()>u&&(E.firstChild.data=E.firstChild.data.slice(0,T),E=this.newTSpan(k,"",q[P]),E.setAttributeNS(null,"x",D),E.setAttributeNS(null,"dy",z),K++)}return K}};p.Dom.prototype.getAllIds=function(k,u){u===null&&(this.idList.length=0);if(k&&k.hasChildNodes())for(k.hasAttributes&&(u=k.getAttributeNS(null,"id"))&&(this.idList[this.idList.length]=
u),k=k.childNodes,u=0;u<k.length;u++)this.getAllIds(k.item(u),1);return this.idList};p.Dom.prototype.extendAllIds=function(k,u){if(k&&k.nodeType==1){var q=k.getAttributeNS(null,"id");k.setAttributeNS(null,"id",q+u);k=k.childNodes;for(q=0;q<k.length;q++)this.extendAllIds(k.item(q),u)}};p.Dom.prototype.getParentByNodename=function(k,u){if(k)for(;k=k.parentNode;)if(k.nodeName==u)return k;return null};p.Dom.prototype.getAttributeByNodeOrParents=function(k,u,q){for(var z;k&&k.nodeType==1;)if(z=k.getAttributeNS(u,
q),z===null||z.length===0)k=k.parentNode;else return z;return""};p.Dom.prototype.getClipRect=function(k){var u=null;(k=k.getAttributeNS(null,"clip-path"))&&(k=k.match(M))&&k[1]&&(k=h.SVGDocument.getElementById(k[1]))&&k.hasChildNodes&&(u=k.firstChild);return u};p.Dom.prototype.setClipRect=function(k,u){var q=this.getClipRect(k);if(!q){var z=k.getAttributeNS(null,"id");q=h.Dom.newNode("clipPath",k.parentNode);q.setAttributeNS(null,"id",z+":clippath");q.setAttributeNS(null,"style","pointer-events:all");
q=h.Dom.newShape("rect",q,0,0,1,1,"fill:none;stroke:none;opacity:0");q.setAttributeNS(null,"id",z+":cliprect");k.setAttributeNS(null,"clip-path","url(#"+z+":clippath)")}q.setAttributeNS(null,"x",u.x);q.setAttributeNS(null,"y",u.y);q.setAttributeNS(null,"width",u.width);q.setAttributeNS(null,"height",u.height);return q};p.Scale=function(){h.fScaleToFullscreen&&!h.fPDFEmbed&&window.screen&&(h.SVGRootElement.currentScale=1,h.SVGRootElement.currentScale=Math.min(window.innerWidth/h.SVGWidth,window.innerHeight/
h.SVGHeight));this.viewBox=new J(h.SVGViewBox[0],h.SVGViewBox[1],h.SVGViewBox[2],h.SVGViewBox[3]);this.szMapUnits=this.nMapScale=this.scaleNode=null;this.szMapProjection="UTM";this.mapPosition=new w(0,0);this.mapOffset=new w(0,0);this.offsetNode=h.SVGDocument.getElementById("mapoffset");this.canvasNode=h.SVGDocument.getElementById("mapcanvas");this.zoomNode=h.SVGDocument.getElementById("mapzoomandpan");this.canvasNode&&(this.mapOffset=A(this.canvasNode));this.offsetNode&&(this.mapPosition=A(this.offsetNode));
this.CSSStyleNodes=h.SVGDocument.getElementById("mapstyles");this.fCSSStyleNodeChanged=!1;this.scaledSymbolsA=[];this.rotatedSymbolsA=[];this.screenX=1024;this.screenY=768;this.nPPI=f;this.objectScaling_lastScale=this.symbolScaling_lastScale=this.featureScaling_lastScale=1;this.metadataNode=null;var k=h.SVGRootElement.getElementsByTagName("metadata");if(this.metadataNode=k[k.length-1]){this.creationNode=this.metadataNode.getElementsByTagName("xmap:creation").item(0);if(this.extentNode=this.metadataNode.getElementsByTagName("xmap:extension").item(0))this.minBoundX=
Number(this.extentNode.getAttribute("minboundx")),this.maxBoundX=Number(this.extentNode.getAttribute("maxboundx")),this.minBoundY=Number(this.extentNode.getAttribute("minboundy")),this.maxBoundY=Number(this.extentNode.getAttribute("maxboundy")),this.minX=Number(this.extentNode.getAttribute("minx")),this.minY=Number(this.extentNode.getAttribute("miny")),this.maxX=Number(this.extentNode.getAttribute("maxx")),this.maxY=Number(this.extentNode.getAttribute("maxy")),this.bBox=new J(this.minX,this.minY,
this.maxX-this.minX,this.maxY-this.minY),this.mapUnitsPPX=(this.maxBoundX-this.minBoundX)/(this.maxX-this.minX),this.mapUnitsPPY=(this.maxBoundY-this.minBoundY)/(this.maxY-this.minY),this.origMinX=this.minX,this.origMinY=this.minY;if(this.scaleNode=this.metadataNode.getElementsByTagName("xmap:scale").item(0))this.nMapScale=Number(this.scaleNode.getAttribute("mapscale")),this.nMapPPI=Number(this.scaleNode.getAttribute("dpi")),this.nMapPPI||(this.nMapPPI=72),this.szMapUnits=this.scaleNode.getAttribute("mapunitsstr"),
this.initScale=this.scaleNode.getAttribute("mapinitscale"),this.initZoomNode=this.metadataNode.getElementsByTagName("xmap:initzoom").item(0),this.nObjectScaling=this.nLabelScaling=this.nLineScaling=this.nBorderScaling=this.nFeatureScaling=1,this.nTrueMapScale=this.getTrueMapScale(),this.nNormalSizeScale=this.nMapScale,this.nDynamicScalePow=3;if(this.coordsysNode=this.metadataNode.getElementsByTagName("xmap:coordsys").item(0))this.szMapProjection=this.coordsysNode.getAttribute("projection"),this.szDatum=
this.coordsysNode.getAttribute("datum"),this.szUTMZone=this.coordsysNode.getAttribute("UTMZone"),this.nFalseEasting=Number(this.coordsysNode.getAttribute("falseeasting")),this.nFalseNorthing=Number(this.coordsysNode.getAttribute("falsenorthing")),this.nCorrectEasting=Number(this.coordsysNode.getAttribute("correcteasting")),this.nCorrectNorthing=Number(this.coordsysNode.getAttribute("correctnorthing")),k=h.HTMLWindow.ixmaps.projectionParams||{},this.nAlbersLat1=k.lat1!==void 0?Number(k.lat1):this.coordsysNode.getAttribute("lat1")?
Number(this.coordsysNode.getAttribute("lat1")):null,this.nAlbersLat2=k.lat2!==void 0?Number(k.lat2):this.coordsysNode.getAttribute("lat2")?Number(this.coordsysNode.getAttribute("lat2")):null,this.nAlbersLat0=k.lat0!==void 0?Number(k.lat0):this.coordsysNode.getAttribute("lat0")?Number(this.coordsysNode.getAttribute("lat0")):null,this.nAlbersLon0=k.lon0!==void 0?Number(k.lon0):this.coordsysNode.getAttribute("lon0")?Number(this.coordsysNode.getAttribute("lon0")):null,this._albersConstants=null,this.nAlbersLat1!==
null&&this.nAlbersLat2!==null&&this.nAlbersLat0!==null&&this.nAlbersLon0!==null&&this._calculateAlbersConstants(),this.lastAlbersParams=null,this.szMapProjection==="LambertAzimuthalEqualArea"?(this.nLambertLat0=k.lat0!==void 0?Number(k.lat0):this.coordsysNode.getAttribute("lambertlat0")?Number(this.coordsysNode.getAttribute("lambertlat0")):null,this.nLambertLon0=k.lon0!==void 0?Number(k.lon0):this.coordsysNode.getAttribute("lambertlon0")?Number(this.coordsysNode.getAttribute("lambertlon0")):null):
this.nLambertLon0=this.nLambertLat0=null,this._lambertConstants=null,this.nLambertLat0!==null&&this.nLambertLon0!==null&&this._calculateLambertAzimuthalConstants(),this.lastLambertParams=null,this.szMapProjection==="Orthographic"?(this.nOrthographicLat0=k.lat0!==void 0?Number(k.lat0):this.coordsysNode.getAttribute("orthographiclat0")?Number(this.coordsysNode.getAttribute("orthographiclat0")):null,this.nOrthographicLon0=k.lon0!==void 0?Number(k.lon0):this.coordsysNode.getAttribute("orthographiclon0")?
Number(this.coordsysNode.getAttribute("orthographiclon0")):null):this.nOrthographicLon0=this.nOrthographicLat0=null,this.lastOrthographicParams=null;if(this.featuresNode=this.metadataNode.getElementsByTagName("xmap:features").item(0))(k=this.featuresNode.getAttributeNS(null,"mapfeatures"))&&k.length>1&&h.setFeatures(k),this.featuresNode.getAttributeNS(null,"cliptextpath")=="true"&&(h.fAdaptLabelToScaling="delayed"),this.featuresNode.getAttributeNS(null,"initlegendoff")=="true"&&(h.fInitLegendOff=
!0),this.featuresNode.getAttributeNS(null,"checklabeloverlap")=="true"&&(h.fCheckLabelOverlap=!0),this.featuresNode.getAttributeNS(null,"onlyonelabel")=="true"&&(h.fCheckLabelOnlyOne=!0),this.featuresNode.getAttributeNS(null,"tiletextnoclip")=="true"&&(h.fTileTextNoClip=!0),this.nFeatureScaling=Number(this.featuresNode.getAttribute("featurescaling")),this.nBorderScaling=Number(this.featuresNode.getAttribute("borderscaling")),this.nLineScaling=Number(this.featuresNode.getAttribute("linescaling")),
this.nLabelScaling=Number(this.featuresNode.getAttribute("labelscaling")),this.nObjectScaling=Number(this.featuresNode.getAttribute("objectscaling")),this.nFeatureScaling=this.nFeatureScaling?this.nFeatureScaling:1,this.nBorderScaling=this.nBorderScaling?this.nBorderScaling:1,this.nLineScaling=this.nLineScaling?this.nLineScaling:1,this.nLabelScaling=this.nLabelScaling?this.nLabelScaling:1,this.nObjectScaling=this.nObjectScaling?this.nObjectScaling:1}this.nButtonSize=this.nNormalButtonSize;this.nSymbolSize=
this.nNormalSymbolSize;this.nFontSize=this.nNormalFontSize;this.nScaleX=this.viewBox.width/this.getEmbedWidth()*this.getEmbedScale();this.nScaleY=this.viewBox.height/this.getEmbedHeight()*this.getEmbedScale();this.nZoomScale=1;this.mapCenter=new w(0,0);this.mapCanvasCenter=new w(this.mapPosition.x+this.bBox.width/2,this.mapPosition.y+this.bBox.height/2);k=this.getContainerDimensions();this.setCanvasSize(0,0,k.width,k.height,"center")};p.Scale.prototype=new p;p.Scale.prototype._calculateAlbersConstants=
function(){const k=this.nAlbersLat1*Math.PI/180,u=this.nAlbersLat2*Math.PI/180,q=this.nAlbersLat0*Math.PI/180,z=this.nAlbersLon0*Math.PI/180,D=Fa=>{const Ha=.0818191908426*Fa;return.9933056200098622*(Fa/(1-.0066943799901378*Fa*Fa)-6.111035746636471*Math.log((1-Ha)/(1+Ha)))},E=Fa=>{const Ha=Math.sin(Fa);return Math.cos(Fa)/Math.sqrt(1-.0066943799901378*Ha*Ha)},K=D(Math.sin(q));var P=D(Math.sin(k)),T=D(Math.sin(u));const fa=E(k),wa=E(u);T=(fa*fa-wa*wa)/(T-P);P=fa*fa+T*P;this._albersConstants={"\u03c61":k,
"\u03c62":u,"\u03c60":q,"\u03bb0":z,a:6378137,e:.0818191908426,e2:.0066943799901378,n:T,C:P,"\u03c10":6378137/T*Math.sqrt(P-T*K),calcQ:D,calcM:E}};p.Scale.prototype._calculateLambertAzimuthalConstants=function(){var k=this.nLambertLat0*Math.PI/180;const u=this.nLambertLon0*Math.PI/180;var q=1/298.257222101;const z=2*q-q*q,D=Math.sqrt(z);q=fa=>{fa=Math.sin(fa);const wa=D*fa;return(1-z)*(fa/(1-z*fa*fa)-1/(2*D)*Math.log((1-wa)/(1+wa)))};const E=(1-z)*(1/(1-z)-1/(2*D)*Math.log((1-D)/(1+D))),K=q(k),P=
K/E,T=6378137*Math.sqrt(.5*E);this._lambertConstants={a:6378137,e:D,e2:z,"\u03bb0":u,"\u03c60":k,qp:E,q0:K,sinBeta0:P,cosBeta0:Math.sqrt(Math.max(0,1-P*P)),Rq:T,calcQ:q,inverseQ:fa=>{let wa=Math.asin(Math.max(-1,Math.min(1,fa/2)));for(let Ha=0;Ha<12;Ha++){var Fa=Math.sin(wa);const Ua=D*Fa,fb=1-z*Fa*Fa;Fa=(fa-(1-z)*(Fa/fb-1/(2*D)*Math.log((1-Ua)/(1+Ua))))/((1-z)/fb);wa+=Fa;if(Math.abs(Fa)<1E-12)break}return wa}};k=T*Math.sqrt(2);Number.isFinite(k)&&k>0&&(this.minBoundX=-k,this.maxBoundX=k,this.minBoundY=
-k,this.maxBoundY=k,this.maxX-this.minX!==0&&this.maxY-this.minY!==0&&(this.mapUnitsPPX=(this.maxBoundX-this.minBoundX)/(this.maxX-this.minX),this.mapUnitsPPY=(this.maxBoundY-this.minBoundY)/(this.maxY-this.minY)))};p.Scale.prototype.calculateAlbersParameters=function(k,u,q){var z={lat:k,lng:u,zoom:q};k=parseFloat(k);u=parseFloat(u);q=parseFloat(q);if(!Number.isFinite(k)||!Number.isFinite(u))return console.warn("calculateAlbersParameters: invalid center coordinates",z),null;Number.isFinite(q)||(console.warn("calculateAlbersParameters: invalid zoom, defaulting to 5",
z),q=5);var D=Math.PI/180,E=Math.pow(2,q-5);Number.isFinite(E)&&E!==0||(console.warn("calculateAlbersParameters: invalid powFactor, enforcing zoom=5",{originalArgs:z,normalizedZoom:q,powFactor:E}),q=5,E=Math.pow(2,q-5));let K=15/E;Number.isFinite(K)||(console.warn("calculateAlbersParameters: invalid latitudeSpacing, enforcing zoom=5",{originalArgs:z,normalizedZoom:q,powFactor:E,latitudeSpacing:K}),q=5,E=Math.pow(2,q-5),K=15/E);Number.isFinite(K)||(K=15);console.debug("calculateAlbersParameters: normalized inputs",
{originalArgs:z,lat:k,lng:u,zoom:q,latitudeSpacing:K});z=Math.max(-89,Math.min(89,k+K));E=Math.max(-89,Math.min(89,k-K));if(E>z){var P=z;z=E;E=P}P=z*D;D*=E;var T=Ha=>{const Ua=.0818191908426*Ha;return.9933056200098622*(Ha/(1-.0066943799901378*Ha*Ha)-6.111035746636471*Math.log((1-Ua)/(1+Ua)))},fa=Ha=>{const Ua=Math.sin(Ha);return Math.cos(Ha)/Math.sqrt(1-.0066943799901378*Ua*Ua)},wa=T(Math.sin(P));const Fa=T(Math.sin(D));T=fa(P);fa=fa(D);wa=Fa-wa;if(Math.abs(wa)<1E-10)return console.warn("calculateAlbersParameters: standard parallels too close, adjusting",
{lat1:z,lat2:E}),P=(Math.sin(P)+Math.sin(D))/2,D={lat1:Math.round(z*10)/10,lat2:Math.round(E*10)/10,lat0:Math.round(k*10)/10,lon0:Math.round(u*10)/10,_n:Math.round(P*1E4)/1E4},Number.isFinite(D.lat1)&&Number.isFinite(D.lat2)&&Number.isFinite(D._n)?console.debug("calculateAlbersParameters: result",D):console.warn("calculateAlbersParameters: produced invalid result",{result:D,intermediate:{lat1:z,lat2:E,n:P},inputs:{lat:k,lng:u,normalizedZoom:q,latitudeSpacing:K}}),this.nAlbersLat1=D.lat1,this.nAlbersLat2=
D.lat2,this.nAlbersLat0=D.lat0,this.nAlbersLon0=D.lon0,typeof this._calculateAlbersConstants==="function"&&this._calculateAlbersConstants(),D;P=(T*T-fa*fa)/wa;D={lat1:Math.round(z*10)/10,lat2:Math.round(E*10)/10,lat0:Math.round(k*10)/10,lon0:Math.round(u*10)/10,_n:Math.round(P*1E4)/1E4};Number.isFinite(D.lat1)&&Number.isFinite(D.lat2)&&Number.isFinite(D._n)?console.debug("calculateAlbersParameters: result",D):console.warn("calculateAlbersParameters: produced invalid result",{result:D,intermediate:{lat1:z,
lat2:E,n:P},inputs:{lat:k,lng:u,normalizedZoom:q,latitudeSpacing:K}});this.nAlbersLat1=D.lat1;this.nAlbersLat2=D.lat2;this.nAlbersLat0=D.lat0;this.nAlbersLon0=D.lon0;typeof this._calculateAlbersConstants==="function"&&this._calculateAlbersConstants();return D};p.Scale.prototype.calculateLambertAzimuthalParameters=function(k,u){const q={lat:k,lng:u};k=parseFloat(k);u=parseFloat(u);if(!Number.isFinite(k)||!Number.isFinite(u))return console.warn("calculateLambertAzimuthalParameters: invalid center coordinates",
q),null;this.nLambertLat0=Math.max(-89.9999,Math.min(89.9999,k));this.nLambertLon0=((u+180)%360+360)%360-180;typeof this._calculateLambertAzimuthalConstants==="function"&&this._calculateLambertAzimuthalConstants();k={lat0:Math.round(this.nLambertLat0*10)/10,lon0:Math.round(this.nLambertLon0*10)/10};this._lambertConstants&&(k._sinBeta0=Math.round(this._lambertConstants.sinBeta0*1E4)/1E4,k._Rq=Math.round(this._lambertConstants.Rq));console.debug("calculateLambertAzimuthalParameters: result",k);return k};
p.Scale.prototype.calculateLambertAzimuthalParametersFromBounds=function(k,u,q,z){k=parseFloat(k);u=parseFloat(u);q=parseFloat(q);z=parseFloat(z);if(!(Number.isFinite(k)&&Number.isFinite(u)&&Number.isFinite(q)&&Number.isFinite(z)))return console.warn("calculateLambertAzimuthalParametersFromBounds: invalid bounds",{latSW:k,lonSW:u,latNE:q,lonNE:z}),null;const D=Math.max(u,z),E=Math.min(u,z),K=(Math.max(k,q)+Math.min(k,q))/2;let P=(D+E)/2;Math.abs(z-u)>180&&(P=((D<0?D+360:D)+(E<0?E+360:E))/2%360,P>
180&&(P-=360));console.debug("calculateLambertAzimuthalParametersFromBounds: derived center",{latSW:k,lonSW:u,latNE:q,lonNE:z,centerLat:K,centerLng:P});return this.calculateLambertAzimuthalParameters(K,P)};p.Scale.prototype.calculateOrthographicParameters=function(k,u){const q={lat:k,lng:u};k=parseFloat(k);u=parseFloat(u);if(!Number.isFinite(k)||!Number.isFinite(u))return console.warn("calculateOrthographicParameters: invalid center coordinates",q),null;this.nOrthographicLat0=Math.max(-89.9999,Math.min(89.9999,
k));this.nOrthographicLon0=((u+180)%360+360)%360-180;k={lat0:Math.round(this.nOrthographicLat0*10)/10,lon0:Math.round(this.nOrthographicLon0*10)/10};console.debug("calculateOrthographicParameters: result",k);return k};p.Scale.prototype.xxxcalculateOrthographicParametersFromBounds=function(k,u,q,z){k=parseFloat(k);u=parseFloat(u);q=parseFloat(q);z=parseFloat(z);if(!(Number.isFinite(k)&&Number.isFinite(u)&&Number.isFinite(q)&&Number.isFinite(z)))return console.warn("calculateOrthographicParametersFromBounds: invalid bounds",
{latSW:k,lonSW:u,latNE:q,lonNE:z}),null;const D=Math.max(u,z),E=Math.min(u,z),K=(Math.max(k,q)+Math.min(k,q))/2;let P=(D+E)/2;Math.abs(z-u)>180&&(P=((D<0?D+360:D)+(E<0?E+360:E))/2%360,P>180&&(P-=360));console.debug("calculateOrthographicParametersFromBounds: derived center",{latSW:k,lonSW:u,latNE:q,lonNE:z,centerLat:K,centerLng:P});return this.calculateOrthographicParameters(K,P)};p.Scale.prototype.calculateAlbersParametersFromBounds=function(k,u,q,z){k=parseFloat(k);u=parseFloat(u);q=parseFloat(q);
z=parseFloat(z);if(!(Number.isFinite(k)&&Number.isFinite(u)&&Number.isFinite(q)&&Number.isFinite(z)))return console.warn("calculateAlbersParametersFromBounds: invalid bounds",{latSW:k,lonSW:u,latNE:q,lonNE:z}),null;var D=Math.max(k,q),E=Math.min(k,q),K=Math.max(u,z),P=Math.min(u,z),T=(D+E)/2;let fa=(K+P)/2;Math.abs(z-u)>180&&(fa=((K<0?K+360:K)+(P<0?P+360:P))/2%360,fa>180&&(fa-=360));D===E&&(D=Math.min(89,D+.5),E=Math.max(-89,E-.5));P=Math.PI/180;K=D*P;P*=E;var wa=fb=>{const Ab=.0818191908426*fb;return.9933056200098622*
(fb/(1-.0066943799901378*fb*fb)-6.111035746636471*Math.log((1-Ab)/(1+Ab)))},Fa=fb=>{const Ab=Math.sin(fb);return Math.cos(fb)/Math.sqrt(1-.0066943799901378*Ab*Ab)},Ha=wa(Math.sin(K));const Ua=wa(Math.sin(P));wa=Fa(K);Fa=Fa(P);Ha=Ua-Ha;if(Math.abs(Ha)<1E-10)return console.warn("calculateAlbersParametersFromBounds: standard parallels too close, adjusting",{lat1:D,lat2:E}),K={lat1:Math.round(D*10)/10,lat2:Math.round(E*10)/10,lat0:Math.round(T*10)/10,lon0:Math.round(fa*10)/10,_n:Math.round((Math.sin(K)+
Math.sin(P))/2*1E4)/1E4},this.nAlbersLat1=K.lat1,this.nAlbersLat2=K.lat2,this.nAlbersLat0=K.lat0,this.nAlbersLon0=K.lon0,typeof this._calculateAlbersConstants==="function"&&this._calculateAlbersConstants(),console.debug("calculateAlbersParametersFromBounds: derived inputs",{latSW:k,lonSW:u,latNE:q,lonNE:z,centerLat:T,centerLng:fa,lat1:D,lat2:E}),K;T={lat1:Math.round(D*10)/10,lat2:Math.round(E*10)/10,lat0:Math.round(T*10)/10,lon0:Math.round(fa*10)/10,_n:Math.round((wa*wa-Fa*Fa)/Ha*1E4)/1E4};this.nAlbersLat1=
T.lat1;this.nAlbersLat2=T.lat2;this.nAlbersLat0=T.lat0;this.nAlbersLon0=T.lon0;typeof this._calculateAlbersConstants==="function"&&this._calculateAlbersConstants();console.debug("calculateAlbersParametersFromBounds: derived inputs",{latSW:k,lonSW:u,latNE:q,lonNE:z,result:T});return T};p.Scale.prototype.reset=function(){h.fScaleToFullscreen&&!h.fPDFEmbed&&window.screen&&(h.SVGRootElement.currentScale=1,h.SVGRootElement.currentScale=Math.min(window.innerWidth/h.SVGWidth,window.innerHeight/h.SVGHeight));
this.canvasNode&&(this.mapOffset=A(this.canvasNode));this.offsetNode&&(this.mapPosition=A(this.offsetNode));this.mapCanvasCenter=new w(this.mapPosition.x+this.bBox.width/2,this.mapPosition.y+this.bBox.height/2);var k=this.getContainerDimensions();this.setCanvasSize(0,0,k.width,k.height,"center")};p.Scale.prototype.setCanvasSize=function(k,u,q,z,D){if(!q||!z)return!1;this.nScaleY=this.nScaleX=20;var E=""+String(k)+" "+String(u)+" "+String(this.normalX(q))+" "+String(this.normalX(z));k=this.normalX(q)-
this.mapPosition.x;u=this.normalX(z)-this.mapPosition.y;var K=k-(this.maxX-this.minX),P=u-(this.maxY-this.minY);D=="extendmax"?(this.maxX+=K,this.maxY+=P,this.maxBoundX+=K*this.mapUnitsPPX,this.minBoundY-=P*this.mapUnitsPPY):(this.minX-=K/2,this.minY-=P/2,this.maxX+=K/2,this.maxY+=P/2,this.minBoundX-=K/2*this.mapUnitsPPX,this.maxBoundY+=P/2*this.mapUnitsPPY,this.maxBoundX+=K/2*this.mapUnitsPPX,this.minBoundY-=P/2*this.mapUnitsPPY,this.canvasNode&&(I(this.canvasNode,this.maxX,this.maxY),this.mapOffset=
A(this.canvasNode)));h.SVGWidth=q;h.SVGHeight=z;h.SVGRootElement.setAttribute("width",h.SVGWidth+"px");h.SVGRootElement.setAttribute("height",h.SVGHeight+"px");h.SVGRootElement.setAttribute("viewBox",E);h.SVGOrigViewBoxString=h.SVGRootElement.getAttribute("viewBox");h.SVGViewBox=h.SVGRootElement.getAttribute("viewBox").split(" ");h.SVGViewBox[0]=Number(h.SVGViewBox[0]);h.SVGViewBox[1]=Number(h.SVGViewBox[1]);h.SVGViewBox[2]=Number(h.SVGViewBox[2]);h.SVGViewBox[3]=Number(h.SVGViewBox[3]);this.viewBox=
new J(h.SVGViewBox[0],h.SVGViewBox[1],h.SVGViewBox[2],h.SVGViewBox[3]);this.bBox=new J(this.minX,this.minY,this.maxX-this.minX,this.maxY-this.minY);this.mapCanvasCenter=new w(this.mapPosition.x+this.bBox.width/2,this.mapPosition.y+this.bBox.height/2);this.nScaleX=this.viewBox.width/this.getEmbedWidth()*this.getEmbedScale();this.nScaleY=this.viewBox.height/this.getEmbedHeight()*this.getEmbedScale();if(D=h.SVGDocument.getElementById("mapcliprect"))D.setAttributeNS(null,"width",k),D.setAttributeNS(null,
"height",u);h.SVGDocument.getElementById("mapcliprect2");if(D=h.SVGDocument.getElementById("map:annotation"))D.fu=new Q(D),k=D.fu.getBox(),D.fu.setPosition(this.normalX(q-2)-this.mapPosition.x,this.normalY(z)-this.mapPosition.y-k.height*2)};p.Scale.prototype.resizeCanvas=function(k,u,q,z,D){D||="center";this.setCanvasSize(k,u,q,z,D);try{h.Viewport.reformat(),h.Themes.reformat(),h.Themes.redraw(),h.Legend.reformat()}catch(E){}try{displayScale(null,"bottom")}catch(E){}};p.Scale.prototype.getDistanceInMeter=
function(k,u,q,z){var D=q-k,E=z-u;this.szMapProjection=="Mercator"&&(this.szMapUnits="degrees");switch(this.szMapUnits){case "feet":D/=3.2808399,E/=3.2808399;case "meter":case "meters":D=D*this.nZoomScale*this.mapUnitsPPX;E=E*this.nZoomScale*this.mapUnitsPPY;q=Math.sqrt(D*D+E*E);q>100&&(q=Math.round(q));q=q>10?Math.round(q*10)/10:Math.round(q*100)/100;break;default:k=h.Scale.getMapPosition(k,u);z=h.Scale.getMapPosition(q,z);q=h.Scale.getMapCoordinate(k.x,k.y);z=h.Scale.getMapCoordinate(z.x,z.y);q=
h.Scale.getGeoCoordinateOfPoint(q.x,q.y);z=h.Scale.getGeoCoordinateOfPoint(z.x,z.y);if(!q||!z)return 0;k=q.y/180*Math.PI;u=z.y/180*Math.PI;q=Math.pow(Math.sin(Math.abs(u-k)/2),2)+Math.cos(k)*Math.cos(u)*Math.pow(Math.sin(Math.abs(z.x/180*Math.PI-q.x/180*Math.PI)/2),2);q=2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q))*6378.388*1E3}return q};p.Scale.prototype.formatDistanceString=function(k){return k>1E3?String(Math.round(k/100)/10)+" km":k>100?String(Math.round(k*10)/10)+" m":String(Math.round(k*100)/100)+
" m"};p.Scale.prototype.formatSurfaceString=function(k){k=k>1E6?String(Math.round(k/1E6*1E3)/1E3)+" km2":String(Math.round(k*1E3)/1E3)+" m2";var u=k.split(".");u.length>1&&(k=u[0]+","+u[1]);return k};p.Scale.prototype.getDeltaXofDistanceInMeter=function(k){return 1E3/this.getDistanceInMeter(1E3,1E3,2E3,1E3)*k};p.Scale.prototype.getDeltaYofDistanceInMeter=function(k){return 1E3/this.getDistanceInMeter(1E3,1E3,1E3,2E3)*k};p.Scale.prototype.getMapCoordinate=function(k,u){k+=this.mapOffset.x;u=this.maxY-
this.minY-(u+this.mapOffset.y);switch(this.szMapUnits){case "feet":case "meter":case "meters":k=this.minBoundX+k*this.mapUnitsPPX;u=this.minBoundY+u*this.mapUnitsPPY;break;default:k=this.minBoundX+k*this.mapUnitsPPX,u=this.minBoundY+u*this.mapUnitsPPY}return new w(k,u)};p.Scale.prototype.getMapCoordinateUTM=function(k,u){k=this.getMapCoordinate(k,u);this.szMapProjection=="Mercator"?k=Zb(k.y,k.x):this.szMapProjection=="WinkelTripel"?k=Ya(k.y,k.x):this.szMapProjection=="EqualEarth"?k=dc(k.y,k.x):this.szMapProjection==
"AlbersEqualArea"?k=rb(k.y,k.x,{lat1:this.nAlbersLat1,lat2:this.nAlbersLat2,lat0:this.nAlbersLat0,lon0:this.nAlbersLon0}):this.szMapProjection=="LambertAzimuthalEqualArea"?k=Ta(k.y,k.x,{lat0:this.nLambertLat0,lon0:this.nLambertLon0}):this.szMapProjection=="Orthographic"?k=jb(k.y,k.x,{lat0:this.nOrthographicLat0,lon0:this.nOrthographicLon0}):this.szMapUnits!="feet"&&this.szMapUnits!="meter"&&this.szMapUnits!="meters"&&(k=Bb("WGS84",k.y,k.x));return k};p.Scale.prototype.getMapPositionOfUTM=function(k,
u,q,z){k=Hb(q,k,u,z);k=h.Scale.getMapCoordinateOfLatLon(k.y,k.x);return{x:(k.x-h.Scale.minBoundX)/h.Scale.mapUnitsPPX-h.Scale.mapOffset.x,y:h.Scale.bBox.height-(k.y-h.Scale.minBoundY)/h.Scale.mapUnitsPPY-h.Scale.mapOffset.y}};p.Scale.prototype.getMapPositionOfLatLon=function(k,u){return this.szMapProjection==="Orthographic"&&this.isPointOnBacksideOrthographic&&this.isPointOnBacksideOrthographic(k,u)?null:(k=h.Scale.getMapCoordinateOfLatLon(k,u))?{x:(k.x-h.Scale.minBoundX)/h.Scale.mapUnitsPPX-h.Scale.mapOffset.x,
y:h.Scale.bBox.height-(k.y-h.Scale.minBoundY)/h.Scale.mapUnitsPPY-h.Scale.mapOffset.y}:null};p.Scale.prototype.getMapCoordinateOfLatLon=function(k,u){if(this.szMapProjection=="Mercator")var q=Zb(k,u);else if(this.szMapProjection=="WinkelTripel")q=Ya(k,u);else if(this.szMapProjection=="EqualEarth")q=dc(k,u);else if(this.szMapProjection=="AlbersEqualArea")q=rb(k,u,{lat1:this.nAlbersLat1,lat2:this.nAlbersLat2,lat0:this.nAlbersLat0,lon0:this.nAlbersLon0});else if(this.szMapProjection=="LambertAzimuthalEqualArea")q=
Ta(k,u,{lat0:this.nLambertLat0,lon0:this.nLambertLon0});else if(this.szMapProjection=="Orthographic")q=jb(k,u,{lat0:this.nOrthographicLat0,lon0:this.nOrthographicLon0});else if(this.szMapUnits=="feet"||this.szMapUnits=="meter"||this.szMapUnits=="meters"){if(!this.szDatum&&!this.szUTMZone)return null;q=Bb(this.szDatum,k,u,this.szUTMZone);this.nFalseEasting&&(q.x+=this.nFalseEasting-5E5);q.y+=this.nFalseNorthing+this.nCorrectNorthing;q.x+=this.nCorrectEasting;q.y+=this.nCorrectNorthing}return q};p.Scale.prototype.getGeoCoordinateOfPoint=
function(k,u){if(this.szMapProjection=="Mercator")return u=Math.atan($a(u*kb))*ia,new w(k,u);if(this.szMapProjection=="EqualEarth"){for(;u>6378137;)u-=6378137;for(;k>6378137;)k-=6378137;for(;u<-6378137;)u+=6378137;for(;k<-6378137;)k+=6378137;for(var q=k/=6378137,z=q*q,D=z*z*z,E,K=0;K<12&&!(E=q*(1.340264+-.081106*z+D*(8.93E-4+.003796*z))-k,z=1.340264+3*-.081106*z+D*(7*8.93E-4+.034164*z),q-=E/=z,z=q*q,D=z*z*z,Math.abs(E)<.1);++K);return new w(ia*vc*(u/6378137)*(1.340264+3*-.081106*z+D*(7*8.93E-4+.034164*
z))/Math.cos(q),ia*Math.asin(Math.sin(q)/vc))}if(this.szMapProjection=="AlbersEqualArea")return ob(k,u,{lat1:this.nAlbersLat1,lat2:this.nAlbersLat2,lat0:this.nAlbersLat0,lon0:this.nAlbersLon0});if(this.szMapProjection=="LambertAzimuthalEqualArea")return na(k,u,{lat0:this.nLambertLat0,lon0:this.nLambertLon0});if(this.szMapProjection=="Orthographic"){K=K={lat0:this.nOrthographicLat0,lon0:this.nOrthographicLon0};q=(K.lat0!==void 0?K.lat0:0)*Math.PI/180;z=(K.lon0!==void 0?K.lon0:0)*Math.PI/180;D=Math.sqrt(k*
k+u*u);if(D>6378137)k=null;else{E=Math.asin(D/6378137);K=Math.cos(E);E=Math.sin(E);var P=Math.cos(q),T=Math.sin(q);k=D<1E-10?new w(z*180/Math.PI,q*180/Math.PI):new w((z+Math.atan2(k*E,D*P*K-u*T*E))*180/Math.PI,Math.asin(K*T+u*E*P/D)*180/Math.PI)}return k}if(this.szMapUnits!="feet"&&this.szMapUnits!="meter"&&this.szMapUnits!="meters")return new w(k,u);if(!this.szDatum&&!this.szUTMZone)return null;k=new w(k,u);this.nFalseEasting&&(k.x-=this.nFalseEasting-5E5);k.y-=this.nFalseNorthing+this.nCorrectNorthing;
k.x-=this.nCorrectEasting;k.y-=this.nCorrectNorthing;return Hb(this.szDatum,k.y,k.x,this.szUTMZone)};p.Scale.prototype.isPointOnBacksideOrthographic=function(k,u){if(this.szMapProjection!=="Orthographic"||this.nOrthographicLat0===null||this.nOrthographicLon0===null)return!1;const q=this.nOrthographicLat0*Math.PI/180;k=k*Math.PI/180;return Math.sin(q)*Math.sin(k)+Math.cos(q)*Math.cos(k)*Math.cos(u*Math.PI/180-this.nOrthographicLon0*Math.PI/180)<0};p.Scale.prototype.getMapPosition=function(k,u){var q=
x(this.zoomNode),z=q[0],D=q[3],E=h.antiZoomAndPanList.getActualMatrix();k=k*E[0]+E[4];u=u*E[3]+E[5];k=k-this.mapPosition.x-this.mapOffset.x;u=u-this.mapPosition.y-this.mapOffset.y;k=(k-q[4])/z;u=(u-q[5])/D;return new w(k,u)};p.Scale.prototype.clipWidgetPositionToMap=function(k){k.x>=this.mapPosition.x+this.bBox.width&&(k.x=this.mapPosition.x+this.bBox.width);k.x<=this.mapPosition.x&&(k.x=this.mapPosition.x);k.y>=this.mapPosition.y+this.bBox.height&&(k.y=this.mapPosition.y+this.bBox.height);k.y<=this.mapPosition.y&&
(k.y=this.mapPosition.y);return k};p.Scale.prototype.isWidgetPositionInMap=function(k){return k.x>this.mapPosition.x+this.bBox.width||k.x<this.mapPosition.x||k.y>this.mapPosition.y+this.bBox.height||k.y<this.mapPosition.y?!1:!0};p.Scale.prototype.clipWidgetObjectToMap=function(k,u,q){k=h.Dom.getBox(k);u.x+q.x+k.width>this.mapPosition.x+this.bBox.width&&(u.x-=k.width+q.x*2);u.y+q.y+k.height>this.mapPosition.y+this.bBox.height&&(u.y-=k.height+q.y*2);return new w(u.x+q.x,u.y+q.y)};p.Scale.prototype.clipWidgetObjectToSVG=
function(k,u,q,z){z||=h.Dom.getBox(k);k.getAttributeNS(null,"clip-path")&&(k=k.getAttributeNS(null,"clip-path"),k.match(/url/)&&(k=k.substr(5,k.length-6),k=h.SVGDocument.getElementById(k)))&&(k=k.firstChild,z.x=Number(k.getAttributeNS(null,"x")),z.y=Number(k.getAttributeNS(null,"y")),z.width=Number(k.getAttributeNS(null,"width")),z.height=Number(k.getAttributeNS(null,"height")));k=new w(u.x+q.x,u.y+q.y);k.x+z.width>this.viewBox.width&&(k.x=u.x-z.width-q.x);k.x<0&&(k.x=h.Scale.normalX(5),q.y<=0&&(k.y-=
q.y,q.y=h.Scale.normalY(20),k.y+=q.y));k.y+z.height>this.viewBox.height&&(k.y=u.y-z.height-q.y);k.y<0&&(k.y=h.Scale.normalX(5));return k};p.Scale.prototype.getEmbedWidth=function(){if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null)try{var k=HTMLDocument.embeds[h.szEmbedName].clientWidth,u=k/HTMLDocument.embeds[h.szEmbedName].clientHeight,q=h.SVGWidth/h.SVGHeight;return u<q?k:q/u*k}catch(z){return h.SVGWidth}return h.fSVGEmbeded&&h.fEmbedScale?h.EmbedWidth.indexOf("%")!=-1?document.embeds.svgMain.clientWidth:
h.EmbedWidth:h.fPDFEmbed?(u=window.innerWidth/window.innerHeight,q=h.SVGWidth/h.SVGHeight,u<q?window.innerWidth:q/u*window.innerWidth):h.SVGWidth};p.Scale.prototype.getEmbedHeight=function(){if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null)try{var k=HTMLDocument.embeds[h.szEmbedName].clientHeight,u=HTMLDocument.embeds[h.szEmbedName].clientWidth/k,q=h.SVGWidth/h.SVGHeight;return q<u?k:u/q*k}catch(z){return h.SVGHeight}return h.fSVGEmbeded&&h.fEmbedScale?h.EmbedHeight.indexOf("%")!=-1?document.embeds.svgMain.clientHeight:
h.EmbedHeight:h.fPDFEmbed?(u=window.innerWidth/window.innerHeight,q=h.SVGWidth/h.SVGHeight,q<u?window.innerHeight:u/q*window.innerHeight):h.SVGHeight};p.Scale.prototype.getContainerDimensions=function(){if(h.SVGRootElement)try{var k=h.SVGRootElement.parentElement;if(k){var u=k.clientWidth||k.offsetWidth,q=k.clientHeight||k.offsetHeight;if(u>0&&q>0)return{width:u,height:q}}var z=h.SVGRootElement.clientWidth||h.SVGRootElement.offsetWidth,D=h.SVGRootElement.clientHeight||h.SVGRootElement.offsetHeight;
if(z>0&&D>0)return{width:z,height:D}}catch(Fa){}if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null&&h.szEmbedName)try{var E=HTMLDocument.embeds[h.szEmbedName];if(E){var K=E.clientWidth,P=E.clientHeight;if(K>0&&P>0)return{width:K,height:P}}}catch(Fa){}if(h.fSVGEmbeded)try{var T=document.embeds.svgMain;if(T&&(K=T.clientWidth,P=T.clientHeight,K>0&&P>0))return{width:K,height:P}}catch(Fa){}try{if(h.SVGWidth&&h.SVGHeight&&h.SVGWidth>0&&h.SVGHeight>0){var fa=this.getEmbedWidth(),wa=this.getEmbedHeight();
if(fa>0&&wa>0&&(fa!==h.SVGWidth||wa!==h.SVGHeight))return{width:fa,height:wa}}}catch(Fa){}return{width:window.innerWidth||1024,height:window.innerHeight||768}};p.Scale.prototype.getEmbedScale=function(){if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null)try{var k=HTMLDocument.embeds[h.szEmbedName].clientWidth,u=HTMLDocument.embeds[h.szEmbedName].clientHeight,q=h.SVGWidth/h.SVGHeight;return q<k/u?u/h.SVGHeight:k/h.SVGWidth}catch(z){return 1}return h.fPDFEmbed?(k=window.innerWidth/window.innerHeight,
q=h.SVGWidth/h.SVGHeight,q<k?window.innerHeight/h.SVGHeight:window.innerWidth/h.SVGWidth):1};p.Scale.prototype.getTrueMapScale=function(){return h.fAdaptMapScaleToSize?this.nMapScale/this.getEmbedScale()*this.nPPI/this.nMapPPI:this.nMapScale*this.nPPI/this.nMapPPI};p.Scale.prototype.normalX=function(k){return k*this.nScaleX};p.Scale.prototype.normalY=function(k){return k*this.nScaleY};p.Scale.prototype.embedX=function(k){return k/this.nScaleX};p.Scale.prototype.embedY=function(k){return k/this.nScaleY};
p.Scale.prototype.scaleX=function(k){return k/h.SVGRootElement.currentScale*this.viewBox.width/this.getEmbedWidth()};p.Scale.prototype.scaleY=function(k){return k/h.SVGRootElement.currentScale*this.viewBox.height/this.getEmbedHeight()};p.Scale.prototype.toSVGx=function(k){return this.scaleX(k*h.SVGRootElement.currentScale-h.SVGRootElement.currentTranslate.x)+this.viewBox.x};p.Scale.prototype.toSVGy=function(k){return this.scaleY(k*h.SVGRootElement.currentScale-h.SVGRootElement.currentTranslate.y)+
this.viewBox.y};p.Scale.prototype.toScreenX=function(k){return(k-this.scaleX(-h.SVGRootElement.currentTranslate.x)+Number(viewBox[0]))/h.SVGRootElement.currentScale/viewBoxScale};p.Scale.prototype.toScreenY=function(k){return(k-this.scaleY(-h.SVGRootElement.currentTranslate.y)+Number(viewBox[3]))/h.SVGRootElement.currentScale/viewBoxScale};p.Scale.prototype.toMapX=function(k){return(k-this.scaleX(-h.SVGRootElement.currentTranslate.x)+Number(viewBox[0]))/h.SVGRootElement.currentScale/viewBoxScale};
p.Scale.prototype.toMapY=function(k){return(k-this.scaleY(-h.SVGRootElement.currentTranslate.y)+Number(viewBox[3]))/h.SVGRootElement.currentScale/viewBoxScale};p.Scale.prototype.getSVGOffset=function(k){var u=k;u.nodeName!="svg"&&(u=h.Dom.getParentByNodename(k,"svg"));return u&&u!=h.SVGRootElement&&(k=u.getAttribute("viewBox").split(" "),k.length==4)?new w(Number(k[0]),Number(k[1])):new w(0,0)};p.Scale.prototype.getGroupOffset=function(k){var u=new w(0,0);if(k)for(;k=k.parentNode;){if(k==h.Zoom.zoomNode||
k.nodeType!=1)return u;var q=x(k);u.x=u.x*q[0]+q[4];u.y=u.y*q[3]+q[5]}return new w(0,0)};p.Scale.prototype.getGroupScale=function(k){var u=new w(1,1);for(k=k.parentNode;k&&k.nodeType==1;){var q=O(k);q&&(u.x*=q.x,u.y*=q.y);k=k.parentNode}return u};p.Scale.prototype.getMapOffset=function(k){var u=this.getSVGOffset(k);k=this.getGroupOffset(k);return new w(-u.x+k.x,-u.y+k.y)};p.Scale.prototype.getScreenPosition=function(k){var u=this.getSVGOffset(k),q=this.getGroupOffset(k),z=A(k);if(k=h.Dom.getBox(k))z.x+=
k.x+k.width/2,z.y+=k.y+k.height/2;k=h.antiZoomAndPanList.getActualMatrix();var D=x(this.zoomNode);z=h.Scale.rotatePoint(z,-1);return new w((this.mapPosition.x+this.mapOffset.x+D[4]+(z.x-u.x+q.x)*D[0]-k[4])*k[0],(this.mapPosition.y+this.mapOffset.y+D[5]+(z.y-u.y+q.y)*D[3]-k[5])*k[3])};p.Scale.prototype.getClientMousePosition=function(k,u){var q=null;if(k){q=h.SVGDocument.parentNode.parentNode.offsetLeft;const D=h.SVGDocument.parentNode.parentNode.offsetTop;var z=h.fEmbedScale;h.fEmbedScale=!0;u&&h.antiZoomAndPanList&&
h.antiZoomAndPanList.isContained(u)?(q=new w(this.normalX(k.clientX-q),this.normalY(k.clientY-D)),k=new w(this.getEmbedScale(),this.getEmbedScale()),q.x/=k.x,q.y/=k.y):q=new w(this.toSVGx(k.clientX-q),this.toSVGy(k.clientY-D));u&&(u=h.Scale.getGroupScale(u),q.x/=u.x,q.y/=u.y);h.fEmbedScale=z}return q};p.Scale.prototype.refreshCSSStyles=function(){this.fCSSStyleNodeChanged&&(this.CSSStyleNodes.parentNode.parentNode.appendChild(this.CSSStyleNodes.parentNode),this.fCSSStyleNodeChanged=!1)};p.Scale.prototype.normalizeSymbols=
function(k){this.featureScaling_lastScale==1&&this.normalizeElements(k,/symbol/,h.nNormalSymbolSize);this.nSymbolSize=this.nNormalButtonSize};p.Scale.prototype.normalizeButtons=function(k){this.normalizeElements(k,/button/,this.nNormalButtonSize);this.normalizeElements(k,/icon/,this.nNormalButtonSize);this.nButtonSize=this.nNormalButtonSize};p.Scale.prototype.normalizeElements=function(k,u,q){if(k){var z=k.getElementsByTagName("g");k=[];for(var D=0;D<z.length;D++)k[D]=z.item(D);for(D=0;D<k.length;D++){z=
k[D];var E=z.getAttributeNS(null,"id");if(E&&E.match(u)){var K=h.SVGDocument.getElementById(E);K&&K!=z&&K.parentNode.removeChild(K);z.fu=new Q(z);K=h.Dom.getBox(z);K.width===0&&(K=h.Dom.constructNode("use",h.SVGTempGroup,{"xlink:href":"#"+E}),K=h.Dom.getBox(K));var P=this.normalX(q)/K.height;z.fu.setPosition((-K.x-K.width/2)*P,(-K.y-K.height/2)*P);z.fu.scale(P,P);l.match(/Firefox/i)&&(z.setAttributeNS(null,"id",""),K=h.Dom.newGroup(z.parentNode),K=z.parentNode.insertBefore(K,z),K.appendChild(z),K.setAttributeNS(null,
"id",E))}}}h.Dom.clearGroup(h.SVGTempGroup)};p.Scale.prototype.changeRotation=function(k,u){var q=ha(h.Scale.canvasNode);q=(360+Number(q)+Number(u))%360;Z(h.Scale.canvasNode,q);h.Layer.setObjectRotate(k,-q);h.Layer.setPatternRotate(k,-q);h.Layer.setLabelRotate(k,-q)};p.Scale.prototype.setRotation=function(k,u){u=Math.floor(u);Z(h.Scale.canvasNode,u);h.Layer.setSymbolRotate(k,-u);h.Layer.setObjectRotate(k,-u);h.Layer.setPatternRotate(k,-u);h.Layer.setLabelRotate(k,-u);h.Themes&&h.Themes.resortCharts();
h.Dom.clearGroup(h.SVGToolsGroup);h.Dom.clearGroup(h.SVGFixedGroup);h.removeAllHighlights()};p.Scale.prototype.rotatePoint=function(k,u){var q=ha(h.Scale.canvasNode)/180*Math.PI;if(q){u==-1&&(q=-q);u=k.x;var z=k.y;k.x=u*Math.cos(q)+z*Math.sin(q);k.y=-u*Math.sin(q)+z*Math.cos(q)}return k};p.Scale.prototype.createWidgetStyles=function(){if(typeof k!="string")var k="font-family:arial;font-size:12px;fill:#444444;pointer-events:none;";if(typeof u!="string")var u=k;if(typeof q!="string")var q="font-family:arial;font-size:10px;fill:#888888;font-weight:bold;font-style:italic;pointer-events:none;";
if(typeof z!="string")var z="font-family:arial;font-size:11px;fill:#555555;;pointer-events:none;";if(typeof D!="string")var D="font-family:arial;font-size:10px;fill:#444444;pointer-events:none;";if(typeof E!="string")var E="font-family:arial;font-size:11px;fill:darkgrey;font-style:italic;stroke:none;pointer-events:none;";if(typeof K!="string")var K="font-family:arial;font-size:10px;fill:#798697;font-style:normal;stroke:none;pointer-events:none;";this.tStyle={};this.tStyle.ContainerTitle=this.createTextObject(k);
this.tStyle.InfoContainerTitle=this.createTextObject(u);this.tStyle.Description=this.createTextObject(q);this.tStyle.Snippet=this.createTextObject(z);this.tStyle.Summary=this.createTextObject(D);this.tStyle.Note=this.createTextObject(E);this.tStyle.Values=this.createTextObject(K)};p.Scale.prototype.createTextObject=function(k){var u={};u.szStyle=xa(k,this.normalY(1));a:{if(k=u.szStyle){k=k.split(";");for(var q=0;q<k.length;q++)if(k[q].match(/font-size/)){k=k[q].split(":");k=parseFloat(k[1]);break a}}k=
-1}u.nFontHeight=k;return u};p.Scale.prototype.getScaleParam=function(){var k={};this.nFeatureScaling&&this.nFeatureScaling!=1&&(k.featureScaling=this.nFeatureScaling);this.nBorderScaling&&this.nBorderScaling!=1&&(k.borderScaling=this.nBorderScaling);this.nLineScaling&&this.nLineScaling!=1&&(k.lineScaling=this.nLineScaling);this.nObjectScaling&&this.nObjectScaling!=1&&(k.objectScaling=this.nObjectScaling);this.nLabelScaling&&this.nLabelScaling!=1&&(k.labelScaling=this.nLabelScaling);this.nNormalSizeScale&&
this.nNormalSizeScale!=1&&(k.normalSizeScale=this.nNormalSizeScale);this.nDynamicScalePow&&this.nDynamicScalePow!=3&&(k.dynamicScalePow=this.nDynamicScalePow);return k};p.Scale.prototype.setScaleParam=function(k){var u=this.featureScaling_lastScale;this.nObjectScaling=this.nLabelScaling=this.nLineScaling=this.nBorderScaling=this.nFeatureScaling=1;k.featureScaling&&k.featureScaling!=1&&(this.nFeatureScaling=k.featureScaling);k.borderScaling&&k.borderScaling!=1&&(this.nBorderScaling=k.borderScaling);
k.lineScaling&&k.lineScaling!=1&&(h.Layer.changeLineScaling(null,k.lineScaling/this.nLineScaling),this.featureScaling_lastScale=u);k.labelScaling&&k.labelScaling!=1&&(h.Layer.changeLabelScaling(null,k.labelScaling/this.nLabelScaling),this.featureScaling_lastScale=u);k.objectScaling&&k.objectScaling!=1&&(this.nObjectScaling=k.objectScaling);k.normalSizeScale&&k.normalSizeScale!=1&&(this.nNormalSizeScale=Number(k.normalSizeScale));this.nDynamicScalePow=3;k.dynamicScalePow&&k.dynamicScalePow!=3&&(this.nDynamicScalePow=
Number(k.dynamicScalePow));h.Layer.doDynamicObjectScaling(h.Scale.nZoomScale)};var C=/matrix\(([^,]*)\)/,N=/matrix\(([0-9., -e]*)\)/,Y=/rotate\(([0-9]*)\)/,M=/url\(#([a-zA-Z0-9\-\._:]*)\)/,w=function(k,u){this.x=k;this.y=u},J=function(k,u,q,z){this.x=Number(k);this.y=Number(u);this.width=Number(q);this.height=Number(z)};J.prototype.scale=function(k){var u=this.width*k;k*=this.height;this.x-=(u-this.width)/2;this.y-=(k-this.height)/2;this.width=u;this.height=k};J.prototype.check=function(){return isNaN(this.x)||
isNaN(this.y)||isNaN(this.width)||isNaN(this.height)?!1:!0};p.Dom.prototype.getBox=function(k){try{var u=k.getBBox();return new J(u.x,u.y,u.width,u.height)}catch(q){return new J(0,0,0,0)}};W.prototype.getContextMenuId=function(){var k;for(k=this.objNode;k;k=k.parentNode)if(k.nodeType==1){var u=k.getAttributeNS(e,"menu");if(u&&u.length)return u}return null};W.prototype.setContextMenuId=function(k){this.objNode.setAttributeNS(e,"menu",k)};Q.prototype.setMatrix=function(k){y(this.nodeObj,k)};Q.prototype.getPosition=
function(){var k=x(this.nodeObj);return new w(Number(k[4]),Number(k[5]))};Q.prototype.setPosition=function(k,u){var q=x(this.nodeObj);q[4]=k;q[5]=u;y(this.nodeObj,[q[0],q[1],q[2],q[3],q[4],q[5]])};Q.prototype.scale=function(k,u){var q=x(this.nodeObj);q[0]=k;q[3]=u;y(this.nodeObj,[q[0],q[1],q[2],q[3],q[4],q[5]])};Q.prototype.scaleBy=function(k,u){var q=this.getBox(),z=q.width/2+q.x;q=q.height/2+q.y;var D=x(this.nodeObj);D[0]*=k;D[3]*=u;k>1?(D[4]-=z*k-z,D[5]-=q*u-q):(D[4]-=z-z/k,D[5]-=q-q/u);y(this.nodeObj,
[D[0],D[1],D[2],D[3],D[4],D[5]])};Q.prototype.rotateBy=function(k){Z(this.nodeObj,k)};Q.prototype.getScale=function(){var k=x(this.nodeObj);return new w(Number(k[0]),Number(k[3]))};Q.prototype.getParentScale=function(){var k=x(this.nodeObj.parentNode);return new w(Number(k[0]),Number(k[3]))};Q.prototype.getGroupScale=function(){return h.Scale.getGroupScale(this.nodeObj)};Q.prototype.scaleTo=function(k,u){var q=this.getBox();k&&u?this.scaleBy(k/q.width,u/q.height):k?this.scaleBy(k/q.width,k/q.width):
u&&this.scaleBy(u/q.height,u/q.height)};Q.prototype.getBox=function(){var k=h.Dom.getBox(this.nodeObj),u=this.getScale();k=new J(k.x,k.y,k.width,k.height);k.x*=u.x;k.y*=u.y;k.width*=u.x;k.height*=u.y;return k};Q.prototype.getTextLength=function(){return this.nodeObj.nodeName=="text"?this.nodeObj.getComputedTextLength():0};Q.prototype.focus=function(k,u,q){y(this.nodeObj,[q,0,0,q,Number(k*q),Number(u*q)])};Q.prototype.clear=function(){h.Dom.clearGroup(this.nodeObj)};Q.prototype.isContained=function(k){for(;k=
k.parentNode;)if(k==this.nodeObj)return!0;return!1};Q.prototype.extendAllIds=function(k){h.Dom.extendAllIds(this.objNode,k)};p.CSS=function(k){this.stylesA=[];k=k.firstChild.nextSibling.nodeValue.split("}");for(var u=0;u<k.length;u++){var q=k[u].split("{")[0];q=q.split(".")[1];this.stylesA[q]=d(k[u].split("{")[1])}};p.CSS.prototype.getStyleString=function(){var k="",u;for(u in this.stylesA){k+=" ."+u+"{";for(var q in this.stylesA[u])k+=q+":"+this.stylesA[u][q]+";";k+="}"}return k};p.CSS.prototype.setStyle=
function(k,u,q){try{this.stylesA[k][u]=q}catch(z){}};Aa.prototype.addGroup=function(k){this.listA[this.listA.length]=k};Aa.prototype.buildList=function(k){k=h.SVGRootElement.childNodes;for(var u=0;u<k.length;u++)try{k.item(u).nodeType=="1"&&k.item(u).getAttributeNS(null,"id").match(/antizoomandpan/)&&this.addGroup(k.item(u))}catch(q){}};Aa.prototype.isContained=function(k){for(;k;){if(this.checkGroup(k))return!0;k=k.parentNode}return!1};Aa.prototype.checkGroup=function(k){for(var u=0;u<this.listA.length;u++)if(k==
this.listA[u])return!0;return!1};Aa.prototype.adjustGroups=function(k){if(h.fAntiZoomAndPan){k=h.SVGRootElement.getAttribute("viewBox").split(" ");var u=h.SVGOrigViewBoxString.split(" ");u=Number(u[2])/Number(k[2]);for(var q,z=0;z<this.listA.length;z++){var D=this.listA[z];if(q=x(D))q[0]=1/h.SVGRootElement.currentScale/u,q[3]=1/h.SVGRootElement.currentScale/u,q[4]=h.Scale.scaleX(-h.SVGRootElement.currentTranslate.x)+Number(k[0]),q[5]=h.Scale.scaleY(-h.SVGRootElement.currentTranslate.y)+Number(k[1]),
y(D,q)}}};Aa.prototype.getActualMatrix=function(k){return x(this.listA[0])};Aa.prototype.setDisplay=function(k,u){for(k=0;k<this.listA.length;k++)this.listA[k].style.setProperty("display",u,"")};Aa.prototype.initAntiZoomPattern=function(k,u){u===null&&(u=h.SVGDocument);k&&(u=k.target.ownerDocument);k=u.getElementsByTagName("pattern");if(k!==null&&k.length!==0){u=k.length;for(var q=k.item(0).parentNode,z,D=0;D<u;D++)k.item(D).getAttributeNS(null,"id").match(/antizoomandpan/)||(z=k.item(D).cloneNode(1E3),
z.setAttributeNS(null,"id",z.getAttributeNS(null,"id")+":antizoomandpan"),q.appendChild(z));q.parentNode.appendChild(q)}};Aa.prototype.initAntiZoomSymbols=function(k,u){if(u!==null&&(k=u.getElementsByTagName("g"),k!==null&&k.length!==0)){u=k.length;for(var q=k.item(0).parentNode,z,D=0;D<u;D++){var E=k.item(D).getAttributeNS(null,"id");E&&E.length&&E.match(/symbol/)&&!E.match(/antizoomandpan/)&&(z=k.item(D).cloneNode(1E3),z.setAttributeNS(null,"id",E+":antizoomandpan"),q.appendChild(z))}q.parentNode.appendChild(q)}};
Aa.prototype.extendAllPatternStyles=function(k,u,q){u&&u.nodeType==1&&(k=u.style.getPropertyValue("fill"))&&k.length>1&&k.match(/url/)&&(k=k.split(")")[0]+q+")",u.style.setProperty("fill",k,""))};Aa.prototype.initAntiZoomStyles=function(k){var u=h.SVGDocument.getElementById("widgets:antizoomandpan");this.extendAllPatternStyles(k,u,":antizoomandpan")};var L=null,G=function(){this.szDictionary=[]};h.Dictionary=new G;G.prototype.add=function(k,u){this.szDictionary[k]||(this.szDictionary[k]=u)};G.prototype.replace=
function(k,u){this.szDictionary[k]=u};G.prototype.getLocalText=function(k){try{if(typeof this.szDictionary[k]!="undefined")return String(this.szDictionary[k]);for(var u="",q=k.split(" "),z=0;z<q.length;z++){var D=this.szDictionary["'"+q[z]+"'"];u+=String(D?D:q[z]);u+=z<q.length-1?" ":""}return u}catch(E){return k}};G.prototype.applyToNode=function(k){k=k.getElementsByTagName("text");for(var u=0;u<k.length;u++)k.item(u).firstChild.nodeValue=this.getLocalText(k.item(u).firstChild.nodeValue)};var F=
null,V=null,la=0,U=new Date,ka=null,Sa=null,Ma=null,Na=12,Qa=0,Ka=new n;n.prototype.add=function(k){this.loaderA[this.loaderA.length]=k};n.prototype.evalScripts=function(){if(this.isLoading()===!1){for(var k=0;k<this.loaderA.length;k++)for(var u=this.loaderA[k],q=0;q<u.loadedScripts.length;q++)this.isScriptLoaded(u.szUrl)||(this.evalScript(u.loadedScripts[q]),this.setScriptLoaded(u.szUrl));this.loaderA.length=0}};n.prototype.evalScript=function(){eval(arguments[0])};n.prototype.setScriptError=function(k){this.errorUrlA[this.errorUrlA.length]=
k};n.prototype.setScriptLoaded=function(k){this.loadedUrlA[this.loadedUrlA.length]=k};n.prototype.setScriptLoading=function(k){this.loadingUrlA[this.loadingUrlA.length]=k};n.prototype.isScriptLoaded=function(k){for(var u=0;u<this.loadedUrlA.length;u++)if(this.loadedUrlA[u]==k)return!0;return!1};n.prototype.isScriptLoading=function(k){for(var u=0;u<this.loadingUrlA.length;u++)if(this.loadingUrlA[u]==k)return!0;return!1};n.prototype.isScriptError=function(k){for(var u=0;u<this.errorUrlA.length;u++)if(this.errorUrlA[u]==
k)return!0;return!1};n.prototype.resetScriptLoading=function(k){for(var u=0;u<this.loadingUrlA.length;u++)this.loadingUrlA[u]==k&&(this.loadingUrlA[u]="");for(u=0;u<this.loadedUrlA.length;u++)this.loadedUrlA[u]==k&&(this.loadedUrlA[u]="");for(u=0;u<this.errorUrlA.length;u++)this.errorUrlA[u]==k&&(this.errorUrlA[u]="")};n.prototype.isLoading=function(){var k;for(k=0;k<this.loaderA.length;k++)if(this.loaderA[k].reqCnt>0)return!0;return!1};v.prototype.loadScript=function(k,u){u&&this.pool.resetScriptLoading(k);
try{k.match(/./)||(k+=this.pool.szSuffix),this.szUrl=k,this.pool.isScriptError(this.szUrl)?typeof this.errorCallback==="function"?this.errorCallback():eval(this.errorCallback):this.pool.isScriptLoaded(this.szUrl)?typeof this.finishedCallback==="function"?this.finishedCallback():eval(this.finishedCallback):this.pool.isScriptLoading(this.szUrl)||(this.isLoading=!0,this.reqCnt++,this.pool.setScriptLoading(this.szUrl),c(k,this))}catch(q){}};v.prototype.operationComplete=function(k,u,q){k!=200||!u&&!q?
(this.pool.setScriptError(this.szUrl),this.errorCallback&&(this.finishedCallback=null,typeof this.errorCallback==="function"?this.errorCallback():eval(this.errorCallback))):this.loadedScripts.push(q);this.reqCnt--;this.reqCnt<=0&&this.evalScripts()};v.prototype.processImported=function(k){alert(k)};v.prototype.evalScripts=function(){this.pool.evalScripts();this.isLoading=!1;this.finishedCallback&&(typeof this.finishedCallback==="function"?this.finishedCallback():eval(this.finishedCallback))};v.prototype.isLoading=
function(){return this.reqCnt>0};const $a=function(k){return(Math.exp(k)-Math.exp(-k))/2},kb=Math.PI/180,ia=180/Math.PI,Da=Math.atan($a(Math.PI))*ia,Cb={WGS84:{_EquatorialRadius:6378137,_eccentricitySquared:.00669438},Airy:{_EquatorialRadius:6377563,_eccentricitySquared:.00667054},"Australian National":{_EquatorialRadius:6378160,_eccentricitySquared:.006694542},"Bessel 1841":{_EquatorialRadius:6377397,_eccentricitySquared:.006674372},"Bessel 1841 (Nambia]":{_EquatorialRadius:6377484,_eccentricitySquared:.006674372},
"Clarke 1866":{_EquatorialRadius:6378206,_eccentricitySquared:.006768658},"Clarke 1880":{_EquatorialRadius:6378249,_eccentricitySquared:.006803511},Everest:{_EquatorialRadius:6377276,_eccentricitySquared:.006637847},"Fischer 1960 (Mercury]":{_EquatorialRadius:6378166,_eccentricitySquared:.006693422},"Fischer 1968":{_EquatorialRadius:6378150,_eccentricitySquared:.006693422},"GRS 1967":{_EquatorialRadius:6378160,_eccentricitySquared:.006694605},"GRS 1980":{_EquatorialRadius:6378137,_eccentricitySquared:.00669438},
"Helmert 1906":{_EquatorialRadius:6378200,_eccentricitySquared:.006693422},Hough:{_EquatorialRadius:6378270,_eccentricitySquared:.00672267},International:{_EquatorialRadius:6378388,_eccentricitySquared:.00672267},Krassovsky:{_EquatorialRadius:6378245,_eccentricitySquared:.006693422},"Modified Airy":{_EquatorialRadius:6377340,_eccentricitySquared:.00667054},"Modified Everest":{_EquatorialRadius:6377304,_eccentricitySquared:.006637847},"Modified Fischer 1960":{_EquatorialRadius:6378155,_eccentricitySquared:.006693422},
"South American 1969":{_EquatorialRadius:6378160,_eccentricitySquared:.006694542},"WGS 60":{_EquatorialRadius:6378165,_eccentricitySquared:.006693422},"WGS 66":{_EquatorialRadius:6378145,_eccentricitySquared:.006694542},"WGS-72":{_EquatorialRadius:6378135,_eccentricitySquared:.006694318},"WGS-84":{_EquatorialRadius:6378137,_eccentricitySquared:.00669438}},Bb=function(k,u,q,z){Cb[k]||(k="WGS84");var D=Cb[k]._EquatorialRadius;k=Cb[k]._eccentricitySquared;var E=q+180-Math.floor((q+180)/360)*360-180;
q=u*kb;var K=E*kb,P=Math.floor((E+180)/6)+1;u>=56&&u<64&&E>=3&&E<12&&(P=32);u>=72&&u<84&&(E>=0&&E<9?P=31:E>=9&&E<21?P=33:E>=21&&E<33?P=35:E>=33&&E<42&&(P=37));z&&z.length&&(P=parseInt(z));z=k/(1-k);E=D/Math.sqrt(1-k*Math.sin(q)*Math.sin(q));var T=Math.tan(q)*Math.tan(q),fa=z*Math.cos(q)*Math.cos(q);K=Math.cos(q)*(K-((P-1)*6-180+3)*kb);D=.9996*(D*((1-k/4-3*k*k/64-5*k*k*k/256)*q-(3*k/8+3*k*k/32+45*k*k*k/1024)*Math.sin(2*q)+(15*k*k/256+45*k*k*k/1024)*Math.sin(4*q)-35*k*k*k/3072*Math.sin(6*q))+E*Math.tan(q)*
(K*K/2+(5-T+9*fa+4*fa*fa)*K*K*K*K/24+(61-58*T+T*T+600*fa-330*z)*K*K*K*K*K*K/720));u<0&&(D+=1E7);return new w(.9996*E*(K+(1-T+fa)*K*K*K/6+(5-18*T+T*T+72*fa-58*z)*K*K*K*K*K/120)+5E5,D)},Hb=function(k,u,q,z){Cb[k]||(k="WGS84");if(!z)return null;var D=Cb[k]._EquatorialRadius;k=Cb[k]._eccentricitySquared;var E=(1-Math.sqrt(1-k))/(1+Math.sqrt(1-k));q-=5E5;var K=u;u=parseInt(z);z.substr(z.length-1,1)>="N"||(K-=1E7);z=k/(1-k);K=K/.9996/(D*(1-k/4-3*k*k/64-5*k*k*k/256));E=K+(3*E/2-27*E*E*E/32)*Math.sin(2*K)+
(21*E*E/16-55*E*E*E*E/32)*Math.sin(4*K)+151*E*E*E/96*Math.sin(6*K);var P=D/Math.sqrt(1-k*Math.sin(E)*Math.sin(E));K=Math.tan(E)*Math.tan(E);var T=z*Math.cos(E)*Math.cos(E);q/=P*.9996;D=E-P*Math.tan(E)/(D*(1-k)/Math.pow(1-k*Math.sin(E)*Math.sin(E),1.5))*(q*q/2-(5+3*K+10*T-4*T*T-9*z)*q*q*q*q/24+(61+90*K+298*T+45*K*K-252*z-3*T*T)*q*q*q*q*q*q/720);D*=ia;k=(q-(1+2*K+T)*q*q*q/6+(5-2*T+28*K-3*T*T+8*z+24*K*K)*q*q*q*q*q/120)/Math.cos(E);k=(u-1)*6-180+3+k*ia;return new w(k,D)},Zb=function(k,u){k=Math.max(Math.min(k,
Da),-Da);return new w(u,Math.log(Math.tan(Math.PI/4+k*kb/2))*ia)},Ya=function(k,u){var q;u-0<-180&&(u=-180);u-0>180&&(u=180);k*=kb;u=.5*kb*(u-0);var z=Math.acos(Math.cos(k)*Math.cos(u));if(z===0)var D=q=0;else q=Math.sin(k)/Math.sin(z),z*=6378137,D=2*z*Math.sqrt(1-q*q),D=D<0&&u>0?-D:D>0&&u<0?-D:D,q*=z;return new w(.5*(D+12756274*u*Math.cos(50.467)),.5*(q+6378137*k))},vc=Math.sqrt(3)/2,dc=function(k,u){k*=kb;u*=kb;k=Math.asin(vc*Math.sin(k));var q=k*k,z=q*q*q;return new w(6378137*u*Math.cos(k)/(vc*
(1.340264+3*-.081106*q+z*(7*8.93E-4+.034164*q))),6378137*k*(1.340264+-.081106*q+z*(8.93E-4+.003796*q)))},rb=function(k,u,q){let z,D,E;if(h&&h.Scale&&h.Scale._albersConstants){var K=h.Scale._albersConstants;z=K.a;D=K.e;E=K.e2;var P=K.n;var T=K.C;var fa=K.\u03c10;q=K.\u03bb0;K=K.calcQ}else{q=q||{};var wa=(q.lat1!==void 0?q.lat1:29.5)*Math.PI/180;P=(q.lat2!==void 0?q.lat2:45.5)*Math.PI/180;fa=(q.lat0!==void 0?q.lat0:23)*Math.PI/180;q=(q.lon0!==void 0?q.lon0:-96)*Math.PI/180;z=6378137;D=.0818191908426;
E=D*D;K=function(Ua){const fb=D*Ua;return(1-E)*(Ua/(1-E*Ua*Ua)-1/(2*D)*Math.log((1-fb)/(1+fb)))};const Fa=Ua=>{const fb=Math.sin(Ua);return Math.cos(Ua)/Math.sqrt(1-E*fb*fb)};fa=K(Math.sin(fa));T=K(Math.sin(wa));const Ha=K(Math.sin(P));wa=Fa(wa);P=Fa(P);P=(wa*wa-P*P)/(Ha-T);T=wa*wa+P*T;fa=z/P*Math.sqrt(T-P*fa)}u=u*Math.PI/180;k=K(Math.sin(k*Math.PI/180));k=z/P*Math.sqrt(T-P*k);q=P*(u-q);return new w(k*Math.sin(q),fa-k*Math.cos(q))},Ta=function(k,u,q){let z,D;if(h&&h.Scale&&h.Scale._lambertConstants){var E=
h.Scale._lambertConstants;var K=E.a;z=E.e;D=E.e2;var P=E.\u03bb0;var T=E.qp;var fa=E.sinBeta0;q=E.cosBeta0;K=E.Rq;E=E.calcQ}else q=q||{},fa=(q.lat0!==void 0?q.lat0:0)*Math.PI/180,P=(q.lon0!==void 0?q.lon0:0)*Math.PI/180,K=6378137,q=1/298.257222101,D=2*q-q*q,z=Math.sqrt(D),E=wa=>{wa=Math.sin(wa);const Fa=z*wa;return(1-D)*(wa/(1-D*wa*wa)-1/(2*z)*Math.log((1-Fa)/(1+Fa)))},T=(1-D)*(1/(1-D)-1/(2*z)*Math.log((1-z)/(1+z))),fa=E(fa)/T,q=Math.sqrt(Math.max(0,1-fa*fa)),K*=Math.sqrt(.5*T);u=u*Math.PI/180-P;
k=E(k*Math.PI/180)/T;P=Math.sqrt(Math.max(0,1-k*k));T=Math.cos(u);E=Math.sqrt(Math.max(0,2/Math.max(1E-15,1+fa*k+q*P*T)));return new w(K*E*P*Math.sin(u),K*E*(q*k-fa*P*T))},ob=function(k,u,q){let z,D;if(h&&h.Scale&&h.Scale._albersConstants){q=h.Scale._albersConstants;var E=q.a;z=q.e;D=q.e2;var K=q.n;var P=q.C;var T=q.\u03c10;q=q.\u03bb0}else{q=q||{};P=(q.lat1!==void 0?q.lat1:29.5)*Math.PI/180;K=(q.lat2!==void 0?q.lat2:45.5)*Math.PI/180;T=(q.lat0!==void 0?q.lat0:23)*Math.PI/180;q=(q.lon0!==void 0?q.lon0:
-96)*Math.PI/180;E=6378137;var fa=1/298.257222101;D=2*fa-fa*fa;z=Math.sqrt(D);var wa=function(Ha){const Ua=z*Ha;return(1-D)*(Ha/(1-D*Ha*Ha)-1/(2*z)*Math.log((1-Ua)/(1+Ua)))},Fa=Ha=>{const Ua=Math.sin(Ha);return Math.cos(Ha)/Math.sqrt(1-D*Ua*Ua)};T=wa(Math.sin(T));fa=wa(Math.sin(P));wa=wa(Math.sin(K));P=Fa(P);K=Fa(K);K=(P*P-K*K)/(wa-fa);P=P*P+K*fa;T=E/K*Math.sqrt(P-K*T)}fa=Math.sqrt(k*k+(T-u)*(T-u));k=Math.atan2(k,T-u);u=(P-fa*K/E*(fa*K/E))/K;E=Math.asin(u/2);for(T=0;T<10&&!(P=Math.sin(E),fa=z*P,Fa=
1-D*P*P,P=(u-(1-D)*(P/Fa-1/(2*z)*Math.log((1-fa)/(1+fa))))/((1-D)/Fa),E+=P,Math.abs(P)<1E-10);T++);return new w((q+k/K)*180/Math.PI,E*180/Math.PI)},na=function(k,u,q){let z,D;let E,K;if(h&&h.Scale&&h.Scale._lambertConstants){var P=h.Scale._lambertConstants;var T=P.a;z=P.e;D=P.e2;q=P.\u03bb0;var fa=P.qp;E=P.sinBeta0;K=P.cosBeta0;var wa=P.Rq;var Fa=P.calcQ;T=P.inverseQ;P=P.\u03c60}else q=q||{},P=(q.lat0!==void 0?q.lat0:0)*Math.PI/180,q=(q.lon0!==void 0?q.lon0:0)*Math.PI/180,T=6378137,fa=1/298.257222101,
D=2*fa-fa*fa,z=Math.sqrt(D),Fa=Ha=>{Ha=Math.sin(Ha);const Ua=z*Ha;return(1-D)*(Ha/(1-D*Ha*Ha)-1/(2*z)*Math.log((1-Ua)/(1+Ua)))},fa=(1-D)*(1/(1-D)-1/(2*z)*Math.log((1-z)/(1+z))),E=Fa(P)/fa,K=Math.sqrt(Math.max(0,1-E*E)),wa=T*Math.sqrt(.5*fa),T=Ha=>{let Ua=Math.asin(Math.max(-1,Math.min(1,Ha/2)));for(let Ab=0;Ab<12;Ab++){var fb=Math.sin(Ua);const Db=z*fb,bb=1-D*fb*fb;fb=(Ha-(1-D)*(fb/bb-1/(2*z)*Math.log((1-Db)/(1+Db))))/((1-D)/bb);Ua+=fb;if(Math.abs(fb)<1E-12)break}return Ua};Fa=Math.sqrt(k*k+u*u);
if(Fa<1E-12)return new w(q*180/Math.PI,P*180/Math.PI);wa=2*Math.asin(Math.min(1,Fa/(2*wa)));P=Math.sin(wa);wa=Math.cos(wa);k=q+Math.atan2(k*P,Fa*K*wa-u*E*P);u=T(fa*(wa*E+u*P*K/Fa));return new w(k*180/Math.PI,u*180/Math.PI)},jb=function(k,u,q){q=q||{};const z=(q.lat0!==void 0?q.lat0:0)*Math.PI/180;k=k*Math.PI/180;u=u*Math.PI/180-(q.lon0!==void 0?q.lon0:0)*Math.PI/180;q=Math.cos(k);return new w(6378137*q*Math.sin(u),6378137*(Math.cos(z)*Math.sin(k)-Math.sin(z)*q*Math.cos(u)))};window.ixMap=p;window.map=
h;window.getMatrix=x;window.setMatrix=y;window.getTranslate=A;window.setTranslate=I;window.getScale=O;window.setScale=function(k,u,q){if(k){var z=x(k);z[0]=u;z[3]=q;y(k,[z[0],z[1],z[2],z[3],z[4],z[5]],!0)}};window.getRotateAttributeValue=ha;window.setRotate=Z;window.getPatternMatrix=function(k){if(k){if((k=k.getAttribute("patternTransform"))&&(k=k.match(C)))return k=k[1].split(" "),[Number(k[0]),Number(k[1]),Number(k[2]),Number(k[3]),Number(k[4]),Number(k[5])];if(k&&=k.match(N))return k=k[1].split(","),
[Number(k[0]),Number(k[1]),Number(k[2]),Number(k[3]),Number(k[4]),Number(k[5])]}return[1,0,0,1,0,0]};window.activateTheme=function(k){if(!k.match(/:label/)&&(k=h.Tiles.getMasterId(k),h._activeTheme!=k&&k!="mapcanvas")){var u=h.SVGDocument.getElementById("legend:ident:"+k);if(u){aa();h._legendIdent=u;if((u=h._legendIdent.nextSibling.nextSibling)&&u.nodeName=="text")try{var q=h.Dom.getBox(u);h._legendIdent.setAttributeNS(null,"width",q.width+h.Scale.normalX(10))}catch(D){}h._legendIdent.style.setProperty("display",
"inline","");h._activeTheme=k;if(h.fActiveThemeInfo){q=new w(h.Scale.mapPosition.x,h.Scale.mapPosition.y+h.Scale.normalX(h.nToolMarginTop));h.Viewport.szPopupAlignment.match(/TOP/)&&(q.y=h.Scale.bBox.height+h.Scale.mapPosition.y-h.Scale.normalY(38));q=new InfoContainer(h.SVGDocument,h.SVGMenuGroup,"movable",q,{x:h.Scale.normalX(5),y:h.Scale.normalY(5)},"fix");q.frameNode.style.setProperty("fill","#fafafa","");q.setTitle("info on");q.setOnRemove("clearThemes()");var z=h.Scale.tStyle.Description.szStyle;
h.Dom.newText(q.workspaceNode,h.Scale.normalX(5),h.Scale.tStyle.Description.nFontHeight,z,u.firstChild.nodeValue);q.reformat()}try{h.HTMLWindow.ixmaps.htmlgui_setActiveTheme(k)}catch(D){}try{h.Themes.redrawInfoAll(null)}catch(D){}}else{aa();_removeInfo(null);h._activeTheme=k;try{h.HTMLWindow.ixmaps.htmlgui_setActiveTheme(k)}catch(D){}try{h.Themes.redrawInfoAll(null)}catch(D){}}h.Layer.setPointerEvents(h._activeTheme);h._activeItem=null}};window.getActiveTheme=function(){return h._activeTheme};window.isActiveTheme=
Oa;window.deactivateTheme=function(k){Oa(k)&&aa()};window.clearThemes=aa;window.displayTooltip=function(k,u){if(u&&u.nodeType==1){for(var q=u.getAttributeNS(e,"tooltip")||"";(u=u.parentNode)!=null&&u.nodeName=="g";){var z=u.getAttributeNS(e,"tooltip");z&&z.length&&(q=z)}if(q&&q.length){try{q=h.User.onTooltipDisplay(null,q,u)}catch(E){}try{q=h.HTMLWindow.ixmaps.htmlgui_onTooltipDisplay(k,q)}catch(E){}m&&clearTimeout(m);if(q&&q.length){k=h.Scale.getClientMousePosition(k,h.SVGPopupGroup);X();u=setTimeout;
if(q&&q.length){z=q.split('"');q=z[0];for(var D=1;D<z.length;D++)q+="``"+z[D]}m=u('doDisplayTooltip("'+q+'",'+k.x+","+k.y+")",500)}return!0}}return!1};window.killTooltip=X;window.displayMessage=ba;window.clearMessage=sa;window.point=w;window.box=J;window.initAll=function(k,u){console.log("*** iXMaps mapscript version: "+h.version);H(k,null);setTimeout("delayedInitAll(null,'"+u+"')",10)};window.delayedInitAll=function(k,u){if(window.innerWidth<=0||window.innerHeight<=0)console.log("window dimension is zero -> no map"),
setTimeout("delayedInitAll(null,'"+u+"')",1E3);else if(!h.fInitializing)if(h.fInitializing=!0,H(k,null),h.hideAll(),h.Dom=new p.Dom(k),h.SVGRootElement=h.SVGDocument,h.fSVGEmbeded&&(k=h.Dom.newNode("g",h.SVGRootElement),k.setAttribute("id","embed"),k.setAttribute("name",u)),h.rootGroup=h.Dom.newGroup(h.SVGRootElement,"objects:antizoomandpan"),h.SVGToolsGroup=h.Dom.newGroup(h.rootGroup,"ToolsGroup"),h.SVGFixedGroup=h.Dom.newGroup(h.rootGroup,"FixedGroup"),h.SVGThemeGroup=h.Dom.newGroup(h.rootGroup,
"ThemeGroup"),h.SVGThemeGroup.style.setProperty("display","none",""),h.SVGPopupGroup=h.Dom.newGroup(h.rootGroup,"PopupGroup"),h.SVGNotifyGroup=h.Dom.newGroup(h.rootGroup,"NotifyGroup"),h.SVGMessageGroup=h.Dom.newGroup(h.rootGroup,"MessageGroup"),h.SVGMenuGroup=h.Dom.newGroup(h.rootGroup,"MenuGroup"),h.SVGTltipGroup=h.Dom.newGroup(h.rootGroup,"TltipGroup"),h.SVGHiddenGroup=h.Dom.newGroup(h.rootGroup,"HiddenGroup"),h.SVGHiddenGroup.style.setProperty("display","none",""),h.SVGTempGroup=h.Dom.newGroup(h.rootGroup,
"TempGroup"),h.SVGWidth=parseInt(h.SVGRootElement.getAttribute("width")),h.SVGHeight=parseInt(h.SVGRootElement.getAttribute("height")),h.SVGOrigViewBoxString=h.SVGRootElement.getAttribute("viewBox"),h.SVGViewBox=h.SVGRootElement.getAttribute("viewBox").split(" "),h.SVGViewBox[0]=Number(h.SVGViewBox[0]),h.SVGViewBox[1]=Number(h.SVGViewBox[1]),h.SVGViewBox[2]=Number(h.SVGViewBox[2]),h.SVGViewBox[3]=Number(h.SVGViewBox[3]),h.Scale=new p.Scale,h.Scale.scaleNode&&h.Scale.extentNode){h.Scale.superclass=
h;if(h.fAllIncluded||h.fPDFEmbed)h.Scale.createWidgetStyles(),h.Scale.normalizeSymbols(h.SVGDocument.getElementById("symbolstore")),h.Scale.normalizeButtons(h.SVGDocument.getElementById("widgetstore")),h.Event=new p.Event,h.Event.initUseNodes(h.SVGDocument.getElementById("widgetstore"));else{h.pushAction(()=>{h.Scale.createWidgetStyles()});h.pushAction(()=>{h.Scale.normalizeSymbols(h.SVGDocument.getElementById("symbolstore"))});h.pushAction(()=>{h.Scale.normalizeButtons(h.SVGDocument.getElementById("widgetstore"))});
try{typeof h.HTMLWindow.ixmaps.SVGResources_includePath!="undefined"?h.Loader.importSVGFile(h.HTMLWindow.ixmaps.SVGResources_includePath+"/maplocal.svg",h.SVGDocument,h.SVGTempGroup,null):typeof ixmaps.szResourceBase!="undefined"?h.Loader.importSVGFile(ixmaps.szResourceBase+"/maps/svg/resources/svg/maplocal.svg",h.SVGDocument,h.SVGTempGroup,null):h.Loader.importSVGFile("../../maps/svg/resources/svg/maplocal.svg",h.SVGDocument,h.SVGTempGroup,null)}catch(q){}}h.SVGDocument.getElementById(h.szShadowFilterToolsId)||
(k=h.Dom.newNode("filter",h.rootGroup),k.setAttributeNS(null,"id",h.szShadowFilterToolsId),k.setAttributeNS(null,"filterUnits","objectBoundingBox"),k.setAttributeNS(null,"x","-50%"),k.setAttributeNS(null,"y","-50%"),k.setAttributeNS(null,"width","200%"),k.setAttributeNS(null,"height","200%"),u=h.Dom.newNode("feGaussianBlur",k),u.setAttributeNS(null,"stdDeviation","50"),u.setAttributeNS(null,"result","BlurAlpha"),u=h.Dom.newNode("feOffset",k),u.setAttributeNS(null,"in","BlurAlpha"),u.setAttributeNS(null,
"dx","20"),u.setAttributeNS(null,"dy","20"),u.setAttributeNS(null,"result","OffsetBlurAlpha"),u=h.Dom.newNode("feColorMatrix",k),u.setAttributeNS(null,"in","OffsetBlurAlpha"),u.setAttributeNS(null,"type","matrix"),u.setAttributeNS(null,"values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"),u.setAttributeNS(null,"result","matrixOut"),u=h.Dom.newNode("feMerge",k),k=h.Dom.newNode("feMergeNode",u),k.setAttributeNS(null,"in","matrixOut"),k=h.Dom.newNode("feMergeNode",u),k.setAttributeNS(null,"in","SourceGraphic"));
l.match(/Firefox/i)&&(h.pushAction(()=>{h.Scale.normalizeSymbols(h.SVGDocument.getElementById("symbolstore"))}),h.pushAction(()=>{h.Scale.normalizeButtons(h.SVGDocument.getElementById("widgetstore"))}));B++;h.fLoadIncludes&&(h.fLoadIncludes=="delayed"?h.pushInitAction(()=>{t()}):t());h.fAllIncluded||h.fPDFEmbed?Ga():h.pushInitAction(()=>{Ga(null)}," ... ")}else alert("SVG source not valid SVGGIS map !")};window.getData=c;window.AntiZoomAndPan=Aa;window.createTextField=pa;window.sizeTextField=Ja;window.executeWithMessage=
function(k,u,q){typeof q=="undefined"&&(q=250);h.fExecuteSilent?typeof k==="function"?setTimeout(function(){Ba(k)},q):setTimeout('doExecuteWithMessage("'+ca(k)+'")',q):(ba(u,null,h.szMessagePosition),typeof k==="function"?setTimeout(function(){Ba(k)},q):(console.warn("executeWithMessage: String-based execution is deprecated. Please pass a function."),setTimeout('doExecuteWithMessage("'+ca(k)+'")',q)))};window.doExecuteWithMessage=Ba;window.executeWithProgressBar=function(k,u,q,z,D,E){S(u,q,z,0,D,
E);setTimeout(k,1)};window.__timer_getSEC=function(){return((new Date).getTime()-Qa)/1E3};window.__timer_reset=function(){Qa=(new Date).getTime()};window.__formatValue=a;window.__getStyleObj=function(k){if(k===null||k.length<2)return null;try{h.styleObj={};for(var u=k.split(";"),q=0;q<u.length;q++)if(u[q].length){var z=u[q].split(":"),D=z[0].length+1,E=u[q].substr(D,u[q].length-D);try{h.styleObj[z[0].trim()]=JSON.parse(E)}catch(K){h.styleObj[z[0].trim()]=E}}return h.styleObj}catch(K){alert("ERROR parsing: "+
k)}return null};window.__getStyleArray=d;window.__scaleStyleString=xa;window.__scaleLineStyleString=function(k,u){if(!k||!u)return null;k=k.split(";");for(var q,z=0;z<k.length;z++)if(k[z].match(/stroke-width/))q=k[z].split(":"),q[1]=String(parseFloat(q[1])*u),k[z]=q.join(":");else if(k[z].match(/stroke-dashoffset/))q=k[z].split(":"),q[1]=String(parseFloat(q[1])*u),k[z]=q.join(":");else if(k[z].match(/stroke-dasharray/)){q=k[z].split(":");var D=q[1].split(",");D.length>1?(k[z]=q[0]+":",q=0):(D=q[1].split(" "),
k[z]=q[0]+":",q=0);for(;q<D.length;q++)D[q]=String(parseFloat(D[q])*u),k[z]+=D[q],q<D.length-1&&(k[z]+=",")}return k.join(";")};window.__scaleTextStyleString=function(k,u){if(!k||!u)return null;k=k.split(";");for(var q,z=0;z<k.length;z++)k[z].match(/font-size/)&&(q=k[z].split(":"),q[1]=String(parseFloat(q[1])*u)+"px",k[z]=q.join(":"));return k.join(";")};window.highlightTheme=function(k){for(;k&&k.objNode.nodeName!="g"&&k.objNode.parentNode;)if((k=new W(k.objNode.parentNode))===null)return;var u=
k.szId;h.Tiles&&(u=h.Tiles.getMasterId(u));var q=k.objNode.getAttributeNS(e,"value");(!q||q.length<1)&&k.objNode.firstChild&&k.objNode.firstChild.nextSibling&&(q=k.objNode.firstChild.nextSibling.getAttributeNS(e,"value"));q&&q.length&&(u=u.split("::")[0]+"::"+q);if(L=h.SVGDocument.getElementById("legend:ident:"+u))(k=L.nextSibling.nextSibling)&&k.nodeName=="text"&&(k=h.Dom.getBox(k),L.setAttributeNS(null,"width",k.width+h.Scale.normalX(10))),L.style.setProperty("display","inline","")};window.highlightThemeRemove=
function(){L&&(L.style.setProperty("display","none",""),L=null)};window.nInfoTimeout=250;window.loadSVGIncludes=function(k,u,q){alert("ohhh");k=k?k.target.ownerDocument:h.SVGDocument;var z=k.getElementById("mapinclude");if(z){if(u&&u.length>1){var D=u.substr(u.length-1,1);D!="\\"&&D!="/"&&(u+="/")}z=z.getElementsByTagName("g");for(D=0;D<z.length;D++){var E=z.item(D),K=E.getAttribute("xlink:href");!K||K.match(/maplocal/)||K.match(/mapmenu/)||K.match(/mapimages/)||K.match(/mappattern/)||K.match(/mapfilter/)||
!(K&&K.length>1)||q&&K!=q||(K=u+K,new b,h.Loader.importSVGFile(K,k,E,null))}}};window.MapObject=W;window.Methods=Q;window._TRACE=function(k){if(typeof console!="undefined"&&typeof console.log!="undefined"){var u=new Date,q=u-U;U=u;console.log("_TRACE: time["+q+"] "+k)}else if(!h.fPDFEmbed||h.fDebug)try{TRACE(k)}catch(z){if(h.fDebug)try{h.SVGDocument&&h.SVGMenuGroup&&(pa(h.SVGDocument,h.SVGMenuGroup,"message",k).fu.setPosition(h.Scale.normalX(0),h.Scale.normalY(la*18)),++la>20&&(la=0,h.SVGMenuGroup.fu.clear()))}catch(D){}}};
window._LOG=ja;window._STATUS=function(k){if(h.fStatus){var u=h.Dom.getObjectById("legend:statusgroup");u||(u=h.Dom.getObjectById("legend:scalegroup"),u=h.Dom.newGroup(u,"legend:statusgroup"));h.Dom.clearGroup(u);h.Dom.newText(u,h.Scale.normalX(220),h.Scale.normalY(12),"font-family:arial;font-size:"+h.Scale.normalY(12)+"px;fill:black",k)}};window._ERROR=function(k){try{h.HTMLWindow.ixmaps.htmlgui_errorLog(k)}catch(u){h.fDebug&&h.SVGDocument&&h.SVGMessageGroup&&pa(h.SVGDocument,h.SVGMessageGroup,"message",
k).fu.setPosition(h.Scale.normalX(0),h.Scale.normalY(0))}};window.displayProgressBar=S;window.do_clearMessage=ua;window.szMapNs=e;window.szXlink="http://www.w3.org/1999/xlink";window.szHTTP="http://";window.szHTTPS="https://";window.nInch=2.54})();(function(){function Ga(){this.itemA=[];this.historyPointer=0;this.fSuspend=!1;this.newItem()}function t(){try{this.szEnvelope=map.Zoom.getEnvelopeString()}catch(c){}}function H(c,e){if(e!="circle"&&e!="isolate"&&e!="scale"&&(c=map.Layer.getLayerItemNodeOfNode(c),!c))return null;this.node=c;this.szMode=e;this.doHighLight()}function x(c,e,f){if(c&&!c.touches)c=map.Scale.getClientMousePosition(c,map.SVGPopupGroup);else{c=map.Scale.getScreenPosition(e);if(!map.Scale.isWidgetPositionInMap(c))return null;
f+="|pointer"}if(f.match(/delayed/))y(),g=e,b=setTimeout("doDisplayInfo("+c.x+","+c.y+",'"+f+"')",nInfoTimeout);else return g=e,r(c.x,c.y,f)}function y(){b&&clearTimeout(b);g=null}function A(c,e){if(map.fScaleBar){var f=map.Scale.nTrueMapScale*map.Scale.nZoomScale;for(c=0;f>10;c++)f/=10;for(f=f>5?10:f>2.5?5:f>=1.1?2.5:1;c>0;c--)f*=10;var m=f/(map.Scale.nMapScale*map.Scale.nZoomScale)*(map.Scale.nMapPPI/nInch);(c=map.Dom.getObjectById("legend:scalegroup"))||(c=map.Dom.newGroup(map.SVGMenuGroup,"legend:scalegroup"));
c.hasChildNodes();c.fu.clear();var l=c.getAttributeNS(szMapNs,"scaleunits"),h=c.getAttributeNS(szMapNs,"barcolor"),p=c.getAttributeNS(szMapNs,"bgcolor"),B=c.getAttributeNS(szMapNs,"bgstyle"),C=c.getAttributeNS(szMapNs,"bgopacity"),N=c.getAttributeNS(szMapNs,"maxwidth");if(B==null||B.length<1)B=p==null||p.length<1?"fill:white;":"fill:"+p+";",C&&(B+="opacity:"+C+";");N===0&&(N=map.Scale.bBox.width/3/map.Scale.normalX(1));if(h==null||h.length<1)h="red";h="fill:"+h+(h=="#ffffff"?";stroke:black;stroke-width:0.1;":
"")+";pointer-events:none";B=map.Dom.newShape("rect",c,map.Scale.normalX(0),map.Scale.normalY(0),map.Scale.normalX(0),map.Scale.normalY(0),B);p=map.Scale.nTrueMapScale*map.Scale.nZoomScale;p=p>=1?"1:"+String(__formatValue(p,0,"BLANK")):String(__formatValue(1/p,0,"BLANK"))+":1";map.Dom.newText(c,0,map.Scale.normalY(12),"font-family:arial;font-size:"+map.Scale.normalY(9)+"px;fill:"+map.szInfoBodyColor,p).fu.setPosition(map.Scale.normalX(9),-map.Scale.normalY(9.5));if(N>0){p=0;l=l.length?l:"meters";
C=100;l=="feet"?(C=33.3,f>3E4&&(l="miles",C=5280*33.3)):f>1E4&&(l="km",C=1E5);for(var Y=0;Y<20;Y++){var M=Y%2==1?h:"fill:black;pointer-events:none";map.Dom.newShape("rect",c,map.Scale.normalX(p),map.Scale.normalY(5),map.Scale.normalX(m),map.Scale.normalY(5),M);M=Math.floor(f/C*Y*100)/100;var w=l;Y>0&&(w=Math.floor(M)!=M?String(M):String(Math.floor(M)));map.Dom.newText(c,Y===0?map.Scale.normalX(p):map.Scale.normalX(p-4),map.Scale.normalY(18),"font-family:arial;font-size:"+map.Scale.normalY(8)+"px;fill:"+
map.szInfoBodyColor+";pointer-events:none;",w);p+=m;if(N>1&&p>N||map.Scale.mapPosition.x&&map.Scale.normalX(p)>map.Scale.bBox.width*9/10||!map.Scale.mapPosition.x&&map.Scale.normalX(p)>map.Scale.bBox.width/2)break}}else map.Dom.newShape("rect",c,map.Scale.normalX(50),map.Scale.normalY(20),map.Scale.normalX(1),map.Scale.normalY(1),"fill:white;opacity:0;");f=map.Dom.getBox(c);B&&(B.setAttributeNS(null,"x",f.x-map.Scale.normalX(7)),B.setAttributeNS(null,"y",f.y-map.Scale.normalY(2)),B.setAttributeNS(null,
"width",f.width+map.Scale.normalX(14)),B.setAttributeNS(null,"height",f.height+map.Scale.normalY(4)),B.setAttributeNS(null,"rx",map.Scale.normalY(2)),B.setAttributeNS(null,"ry",map.Scale.normalY(2)));e&&(N=map.Scale.normalX(8),m=map.Scale.normalX(map.nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.bBox.height<map.Scale.viewBox.height&&(N=map.Scale.normalX(2),m=0),N=map.Scale.mapPosition.x+N,e=="bottom"?c.fu.setPosition(N+m,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-
m-f.height):c.fu.setPosition(N+m,-f.y+map.Scale.normalY(2)+map.Scale.normalY(1)+m));c.fu.setPosition(50,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-90);B&&(e=c.fu.getPosition().y>map.Scale.normalY(100)?"top":"bottom",B.setAttributeNS(null,"onclick","displayScale(evt,'"+e+"')"));map.SVGPopupGroup&&(map.SVGPopupGroup.fu.clear(),c.setAttributeNS(szMapNs,"tooltip","click to move it"))}}function I(c,e){c=new box(0,0,0,0);if(e)try{if(e.nodeName=="text")return map.Dom.getBox(e);
var f=e.childNodes;for(e=0;e<f.length;e++)if(f.item(e).nodeType==1){var m=getScale(f.item(e)),l=getTranslate(f.item(e)),h=map.Dom.getBox(f.item(e));h.x=l.x+h.x*m.x;h.y=l.y+h.y*m.y;h.width*=m.x;h.height*=m.y;if(f.item(e).getAttributeNS(null,"id").match(/overviewmap/)){var p=map.SVGDocument.getElementById("overviewmap:clippath");p&&(h=map.Dom.getBox(p),h.height=p.firstChild.getAttribute("height"),h.width=p.firstChild.getAttribute("width"),h.height=c.height+h.height*map.Scale.getGroupScale(p).y,h.width*=
map.Scale.getGroupScale(p).x)}isNaN(h.width)||isNaN(h.height)||h.width<0||h.height<0||(c.x=Math.min(c.x,h.x),c.y=Math.min(c.y,h.y),c.width=Math.max(c.width,h.x+h.width),c.height=Math.max(c.height,h.y+h.height))}if(isNaN(c.width)||isNaN(c.height)||c.width<0||c.height<0)c=new box(0,0,0,0)}catch(B){c=new box(0,0,0,0)}return c}function O(c,e){var f=map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(f)for(var m=0;m<f.length;m++)f.item(m).getAttributeNS(null,"name")==map.Tiles.getMasterId(c)&&f.item(m).setAttributeNS(null,
"state",e)}function ha(c,e){if(c!=null){var f=c.getAttributeNS(null,"id");if(!f.match(/label/)){var m,l=f.split(":");f=l[0]+":item:"+l[2];for(m=3;m<l.length;m++)f=f+":"+l[m];if(f=c.ownerDocument.getElementById(f)){var h=f.childNodes;for(m=0;m<h.length;m++)if(h.item(m).nodeType==1&&h.item(m).getAttributeNS(null,"id")&&h.item(m).getAttributeNS(null,"id").match(/collapsable/)){l=0;switch(e){case "collapse":if(h.item(m).getAttributeNS(szMapNs,"state")=="collapsed"||h.item(m).getAttributeNS(null,"id").match(/placeholder/))break;
(c=c.ownerDocument.getElementById(h.item(m).getAttributeNS(null,"id")+":end"))?l=-c.getAttributeNS(null,"y")+map.Scale.normalY(20):(c=map.Dom.getBox(h.item(m)),l=-c.height);e=map.Dom.newGroup(h.item(m).parentNode,h.item(m).getAttributeNS(null,"id")+":placeholder");e.setAttributeNS(szMapNs,"state","collapsed");e.parentNode.insertBefore(e,h.item(m));map.SVGHiddenGroup.appendChild(h.item(m+1));break;case "expand":if(h.item(m).getAttributeNS(szMapNs,"state")=="collapsed"||h.item(m).getAttributeNS(null,
"id").match(/placeholder/)){if(h.item(m).getAttributeNS(null,"id").match(/placeholder/)){e=h.item(m);h=e.getAttributeNS(null,"id").split(":");l="";for(m=0;m<h.length-1;m++)l+=m>0?":":"",l+=h[m];m=map.SVGDocument.getElementById(l);e.parentNode.replaceChild(m,e);m=map.SVGDocument.getElementById(l)}else m=h.item(m);m.setAttributeNS(szMapNs,"state","expanded");(c=c.ownerDocument.getElementById(m.getAttributeNS(null,"id")+":end"))?l=c.getAttributeNS(null,"y")-map.Scale.normalY(20):(c=map.Dom.getBox(m),
l=c.height)}}for(m=f.nextSibling;m&&l;)if(m.nodeType==1&&(c=getMatrix(m),c[5]+=l,setMatrix(m,c)),m=m.nextSibling,m==null)for(;f.parentNode&&f.parentNode.getAttributeNS(null,"id").match(/legend/);)if(f=f.parentNode,f.getAttributeNS(null,"id").match(/item/)){m=f.nextSibling;break}try{map.Legend.init(null)}catch(p){}break}}}}}ixMap.Viewport=function(c){map.Scale.metadataNode&&(this.szPopupAlignment=(this.alignmentNode=map.Scale.metadataNode.getElementsByTagNameNS(szMapNs,"alignments").item(0))?this.alignmentNode.getAttributeNS(null,
"popupwindow"):"",this.szPopupAlignment=map.szLocalPopupAlignment?map.szLocalPopupAlignment:this.szPopupAlignment);if(this.eventRect=map.SVGDocument.getElementById("mapbackground:eventrect"))map.szMapBackgroundStyle&&this.eventRect.setAttributeNS(null,"style",map.szMapBackgroundStyle+";pointer-events:all"),map.szMapBackgroundColor&&this.eventRect.setAttributeNS(null,"style","fill:"+map.szMapBackgroundColor+";opacity:1;pointer-events:all");this.clipToolsGroup();this.createPanBorder();this.createNorthArrow();
return!0};ixMap.Viewport.prototype=new Map;ixMap.Viewport.prototype.reformat=function(){this.clipToolsGroup();this.createPanBorder();this.createNorthArrow()};ixMap.Viewport.prototype.clipToolsGroup=function(){map.Dom.setClipRect(map.SVGToolsGroup,new box(map.Scale.mapPosition.x+map.Scale.normalX(map.nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(map.nMapBorderWidth),map.Scale.bBox.width-map.Scale.normalX(map.nMapBorderWidth)*2,map.Scale.bBox.height-map.Scale.normalY(map.nMapBorderWidth)*
2));this.widgetBox=new box(map.Scale.mapPosition.x+map.Scale.normalX(map.nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(map.nMapBorderWidth+map.nToolMarginTop),map.Scale.bBox.width-map.Scale.normalX(map.nMapBorderWidth)*2,map.Scale.bBox.height-map.Scale.normalY(map.nMapBorderWidth)*2)};ixMap.Viewport.prototype.createPanBorder=function(){var c=map.SVGDocument;if(map.fMapBorder){var e=c.getElementById("widgets:antizoomandpan");if(e){var f=map.szMapBorderColor,m=map.Scale.normalX(map.nMapBorderWidth),
l=c.getElementById("mapBorderClipCover");l&&l.parentNode.removeChild(l);l=map.Dom.newGroup(e,"mapBorderClipCover");l.setAttributeNS(null,"style","fill:white;opacity:1.0");e.insertBefore(l,e.firstChild);map.Dom.newShape("rect",l,0,0,map.Scale.mapPosition.x,map.Scale.viewBox.height,"");map.Dom.newShape("rect",l,0,0,map.Scale.viewBox.width+1E4,map.Scale.mapPosition.y,"");map.Dom.newShape("rect",l,0,map.Scale.mapPosition.y+map.Scale.bBox.height,map.Scale.viewBox.width+1E4,map.Scale.viewBox.height-(map.Scale.mapPosition.y+
map.Scale.bBox.height)+1E4,"");map.Dom.newShape("rect",l,map.Scale.mapPosition.x+map.Scale.bBox.width,0,map.Scale.viewBox.width-(map.Scale.mapPosition.x+map.Scale.bBox.width)+1E4,map.Scale.bBox.height,"");(l=c.getElementById("mapBorder"))&&l.parentNode.removeChild(l);l=map.Dom.newGroup(e,"mapBorder");if(map.fMapBorder3D&&map.Scale.mapPosition.x)f="#ffffff",e.insertBefore(l,e.firstChild),l.fu.setPosition(0,0),m=map.Scale.normalX(250),c=map.Scale.normalX(-3),e=map.Dom.newShape("rect",l,map.Scale.mapPosition.x,
map.Scale.mapPosition.y-m+c,map.Scale.bBox.width,m,"fill:"+f+";opacity:0.5"),e.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),e=map.Dom.newShape("rect",l,0,map.Scale.mapPosition.y+map.Scale.bBox.height-c,map.Scale.mapPosition.x+map.Scale.bBox.width,m,"fill:"+f+";opacity:0.5"),e.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),e=map.Dom.newShape("rect",l,0,0,map.Scale.mapPosition.x,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+
f+";opacity:0.5"),e.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),e=map.Dom.newShape("rect",l,map.Scale.mapPosition.x+map.Scale.bBox.width-c,0,m,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+f+";opacity:0.5"),e.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)");else if(l.setAttributeNS(null,"transform","matrix(1 0 0 1 "+map.Scale.mapPosition.x+" "+map.Scale.mapPosition.y+")"),map.Dom.newShape("rect",l,0,0,map.Scale.bBox.width,
m,"fill:"+f+";opacity:1.0"),map.Dom.newShape("rect",l,0,map.Scale.bBox.height-m,map.Scale.bBox.width,m,"fill:"+f+";opacity:1.0"),map.Dom.newShape("rect",l,0,0,m,map.Scale.bBox.height,"fill:"+f+";opacity:1.0"),map.Dom.newShape("rect",l,map.Scale.bBox.width-m,0,m,map.Scale.bBox.height,"fill:"+f+";opacity:1.0"),map.nMapBorderWidth>2){f=map.szMapPanBorderStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0";c=map.szMapPanBorderOnoverStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0";var h=
map.Scale.bBox,p=h.width/10,B=h.width/3/+map.Scale.normalX(1);e=map.Dom.newShape("rect",l,p,0,h.width-p*2,m,f);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+B+")");e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",c);e=map.Dom.newShape("rect",l,p,h.height-m-1,h.width-p*2,m,f);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+-B+")");e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",c);e=map.Dom.newShape("rect",l,0,
p,m,h.height-p*2,f);e.setAttributeNS(szMapNs,"onoverstyle",c);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+B+",0)");e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",c);e=map.Dom.newShape("rect",l,h.width-m-1,p,m,h.height-p*2,f);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-B+",0)");e.setAttributeNS(szMapNs,"onoverstyle",c);e.setAttributeNS(szMapNs,"tooltip","pan");e=map.Dom.newShape("path",l,"M0,0 l "+p+",0 0,"+m+" "+-(p-m)+",0 0,"+(p-m)+" "+
-m+",0 z",f);e.setAttributeNS(szMapNs,"onoverstyle",c);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+B+","+B+")");e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",c);e=map.Dom.newShape("path",l,"M"+h.width+","+h.height+" l "+-p+",0 0,"+-m+" "+(p-m)+",0 0,"+-(p-m)+" "+m+",0 z",f);e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",c);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-B+","+-B+")");e.setAttributeNS(szMapNs,
"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",c);e=map.Dom.newShape("path",l,"M"+h.width+",0 l "+-p+",0 0,"+m+" "+(p-m)+",0 0,"+(p-m)+" "+m+",0 z",f);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-B+","+B+")");e.setAttributeNS(szMapNs,"onoverstyle",c);e.setAttributeNS(szMapNs,"tooltip","pan");e=map.Dom.newShape("path",l,"M0,"+h.height+" l "+p+",0 0,"+-m+" "+-(p-m)+",0 0,"+-(p-m)+" "+-m+",0 z",f);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+B+","+-B+")");e.setAttributeNS(szMapNs,
"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",c)}}}};ixMap.Viewport.prototype.doPanMap=function(c,e){executeWithMessage(()=>map.Viewport.panMap(c,e),"please wait ...",100)};ixMap.Viewport.prototype.panMap=function(c,e){map.Zoom.setNewPan(c,e);map.Event.doDefaultZoom(null)};ixMap.Viewport.prototype.setBackgroundColor=function(c){this.eventRect&&this.eventRect.setAttributeNS(null,"style","fill:"+c+";opacity:1;pointer-events:all")};ixMap.Viewport.prototype.togglePanBorder=function(){var c=
map.SVGDocument.getElementById("mapBorder");c?c.parentNode.removeChild(c):map.Viewport.createPanBorder()};ixMap.Viewport.prototype.createNorthArrow=function(){if(map.fNorthArrow){var c=map.SVGDocument.getElementById("widgets:antizoomandpan");if(c){var e="none";this.northGroup&&(e=this.northGroup.style.getPropertyValue("display"),this.northGroup.parentNode.removeChild(this.northGroup));this.northGroup=map.Dom.newGroup(c,"mapNorthArrow");e&&this.northGroup.style.setProperty("display",e);map.szNorthArrowPosition==
"TOP"?this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),map.Scale.normalX(45+map.nToolMarginTop)):this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),this.widgetBox.y+map.Scale.normalX((this.widgetBox.y?50:60)+map.nToolMarginTop));c=map.Scale.normalY(30);e=map.Scale.normalY(12);map.Dom.newShape("circle",this.northGroup,0,0,c,"fill:white;opacity:0.2");map.Dom.newShape("path",this.northGroup,"M0,"+-c/2+" l "+e/2+","+c*1.2+
" "+-e/2+","+-c/5+" "+-e/2+","+c/5+" z","fill:#444444;stroke:#ffffff;stroke-width:"+map.Scale.normalX(.4)+";");map.Dom.newText(this.northGroup,map.Scale.normalX(-5),map.Scale.normalY(-19),"font-family:arial;font-size:"+map.Scale.normalX(12)+"px;font-weight:bold;fill:#444444;stroke:white;stroke-width:0.2;pointer-events:none","N");map.Dom.newShape("rect",this.northGroup,-e/2,-c,e,c,"fill:green;opacity:0.0");map.fNorthArrow=="rotatable"&&(this.northGroup.setAttributeNS(null,"cursor","pointer"),this.northGroup.setAttributeNS(szMapNs,
"tooltip",map.Dictionary.getLocalText("click to move it")),this.northArrowObj=new X(this.northGroup,100,"0,360","1",90,9),this.northArrowObj.parent=this);c=new Oa(this.northGroup,"mapNorthArrow:zoomin","BUTTON","#plus_button1","map.Zoom.doZoomMap(2)","","zoom in");c.setPosition(map.Scale.normalY(0),map.Scale.normalY(40));c.scale(1.3,1.3);c.nodeObj.style.setProperty("fill-opacity","0.5","");c=new Oa(this.northGroup,"mapNorthArrow:zoomout","BUTTON","#minus_button1","map.Zoom.doZoomMap(0.5)","","zoom out");
c.setPosition(map.Scale.normalY(0),map.Scale.normalY(40+map.nNormalButtonSize*2));c.scale(1.3,1.3);c.nodeObj.style.setProperty("fill-opacity","0.5","")}}};ixMap.Viewport.prototype.onClick=function(c){this.northArrowObj&&executeWithMessage(()=>map.Scale.setRotation(null,0),"...")};ixMap.Viewport.prototype.onMouseUp=function(c){this.northArrowObj&&!map.fRotateOnMouseMove&&executeWithMessage(()=>map.Scale.setRotation(null,this.northArrowObj.getAngle()),"...")};ixMap.Viewport.prototype.onMouseMove=function(c){this.northArrowObj&&
map.fRotateOnMouseMove&&(c=this.northArrowObj.getAngle(),c!=this.nAngle&&(map.Scale.setRotation(null,c),this.nAngle=c))};ixMap.Viewport.prototype.showNorthArrow=function(){this.northGroup&&this.northGroup.style.setProperty("display","inline","")};ixMap.Viewport.prototype.hideNorthArrow=function(){this.northGroup&&this.northGroup.style.getPropertyValue("display")!="none"&&(this.northGroup.style.setProperty("display","none",""),this.northArrowObj&&executeWithMessage(()=>map.Scale.setRotation(null,0),
"..."))};ixMap.Viewport.prototype.clipMap=function(c){var e=map.SVGDocument.getElementById("mapcliprect");e&&e.setAttributeNS(null,"width",map.Scale.normalX(c))};ixMap.Viewport.prototype.clipLayer=function(c,e){c||(c=map._activeTheme);var f=map.SVGDocument.getElementById(c);c=map.SVGDocument.getElementById(c+":values");typeof this.lastClippedLayer!="undefined"&&this.lastClippedLayer!=f&&(map.Dom.setClipRect(this.lastClippedLayer,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.bBox.width,
map.Scale.bBox.height)),this.lastClippedLayer=null);typeof this.lastClippedLayerV!="undefined"&&this.lastClippedLayerV!=c&&(map.Dom.setClipRect(this.lastClippedLayerV,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.bBox.width,map.Scale.bBox.height)),this.lastClippedLayerV=null);f&&(map.Dom.setClipRect(f,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.normalX(e),map.Scale.bBox.height)),this.lastClippedLayer=f);c&&(map.Dom.setClipRect(c,new box(-map.Scale.mapOffset.x,
-map.Scale.mapOffset.y,map.Scale.normalX(e),map.Scale.bBox.height)),this.lastClippedLayerV=c)};ixMap.Zoom=function(c){this.canvasNode=map.SVGDocument.getElementById("mapcanvas");this.zoomNode=map.SVGDocument.getElementById("mapzoomandpan");this.nZoomY=this.nZoomX=this.nZoom=1;this.doCenter=this.doArea=this.doZoom=null;this.fAreaSet=!1;c&&c>1&&this.doExecuteZoomMap(c,1)};ixMap.Zoom.prototype=new Map;ixMap.Zoom.prototype.init=function(){if(map.Scale.initZoomNode){var c=Number(map.Scale.initZoomNode.getAttribute("MinBoundX")),
e=Number(map.Scale.initZoomNode.getAttribute("MaxBoundX")),f=Number(map.Scale.initZoomNode.getAttribute("MinBoundY")),m=Number(map.Scale.initZoomNode.getAttribute("MaxBoundY"));map.Scale.initZoomNode.getAttribute("units")=="degree"?this.doZoomMapToGeoBounds(f,c,m,e):this.Zoom.doZoomMapToEnvelope(c,e,f,m)}};ixMap.Zoom.prototype.toFullExtend=function(){setTimeout("map.Zoom.reset()",100)};ixMap.Zoom.prototype.setNewZoom=function(c){this.doZoom=c;map.Zoom.execute()};ixMap.Zoom.prototype.setNewPan=function(c,
e){this.doPanMap(c,e)};ixMap.Zoom.prototype.setNewArea=function(c){this.fAreaSet=!0;this.doSetAreaByParentMap(c)||(this.doArea=new box(c.x,c.y,c.width,c.height),map.Zoom.execute())};ixMap.Zoom.prototype.setNewCenter=function(c){this.doCenterByParentMap(c)||(this.doCenter=new box(c.x,c.y,c.width,c.height),map.Zoom.execute())};ixMap.Zoom.prototype.execute=function(){this.doZoom&&(this.doExecuteZoomMap(this.doZoom,this.nZoom),this.nZoom=this.doZoom,this.doZoom=null);this.doArea&&(this.doZoomMapToArea(this.doArea),
this.doArea=null);this.doCenter&&(this.doCenterMapToArea(this.doCenter),this.doCenter=null);map.SVGPopupGroup&&map.SVGPopupGroup.fu.clear()};ixMap.Zoom.prototype.cancel=function(){this.doCenter=this.doArea=this.doZoom=null};ixMap.Zoom.prototype.reset=function(){this.zoomNode.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)");map.SVGRootElement.currentTranslate.x=0;map.SVGRootElement.currentTranslate.y=0;this.nZoom=1;map.Event.doDefaultZoom(null);clearMessage(100)};ixMap.Zoom.prototype.getBox=
function(){var c=getMatrix(this.canvasNode),e=getMatrix(this.zoomNode),f=-c[4]/this.nZoomX;c=-c[5]/this.nZoomY;f-=(map.Scale.normalX(map.SVGRootElement.currentTranslate.x)+e[4])/this.nZoomX;c-=(map.Scale.normalY(map.SVGRootElement.currentTranslate.y)+e[5])/this.nZoomY;return new box(f,c,map.Scale.bBox.width/this.nZoomX,map.Scale.bBox.height/this.nZoomY)};ixMap.Zoom.prototype.getEnvelope=function(){var c=this.getBox(),e=map.Scale.getMapCoordinate(c.x,c.y);c=map.Scale.getMapCoordinate(c.x+c.width,c.y+
c.height);return[e,c]};ixMap.Zoom.prototype.getEnvelopeString=function(){var c=this.getEnvelope();return String("MinBoundX='"+c[0].x+"' MaxBoundX='"+c[1].x+"' MinBoundY='"+c[1].y+"' MaxBoundY='"+c[0].y+"'")};ixMap.Zoom.prototype.getFractionBox=function(){var c=getMatrix(this.zoomNode),e=map.Scale.rotatePoint(new point(c[4],c[5]),-1);c[4]=e.x;c[5]=e.y;e=(map.Scale.normalX(map.SVGRootElement.currentTranslate.x)+c[4])/this.nZoomX;c=(map.Scale.normalY(map.SVGRootElement.currentTranslate.y)+c[5])/this.nZoomY;
var f=map.Scale.bBox.width-map.Scale.bBox.width/this.nZoomX,m=map.Scale.bBox.height-map.Scale.bBox.height/this.nZoomY;return f>0&&m>0?new box(.5-e/f,.5-c/m,1/this.nZoomX,1/this.nZoomY):new box(0,0,1/this.nZoomX,1/this.nZoomY)};ixMap.Zoom.prototype.setFractionBox=function(c){var e=map.Scale.bBox.width*c.width,f=map.Scale.bBox.height*c.height;c=new box((map.Scale.bBox.width-e)*c.x+map.Scale.bBox.x,(map.Scale.bBox.height-f)*c.y+map.Scale.bBox.y,e,f);map.Zoom.setNewCenter(c)};ixMap.Zoom.prototype.clipArea=
function(c){c.width/c.height!=map.Scale.bBox.width/map.Scale.bBox.height&&(c.width>c.height?c.height=c.width/map.Scale.bBox.width*map.Scale.bBox.height:c.width=c.height/map.Scale.bBox.height*map.Scale.bBox.width);var e=c.x-map.Scale.bBox.x,f=map.Scale.bBox.x+map.Scale.bBox.width-(c.x+c.width),m=c.y-map.Scale.bBox.y,l=map.Scale.bBox.y+map.Scale.bBox.height-(c.y+c.height);if(e<0||f<0||m<0||l<0){if(e<0&&f<0)c.x=map.Scale.bBox.x,c.width=map.Scale.bBox.width;else if(e<0)c.x+=-e,c.width-=f>-e?0:-e-f;else if(f<
0)return c.x-=-f,this.clipArea(c);if(m<0&&l<0)c.y=map.Scale.bBox.y,c.height=map.Scale.bBox.heigt;else if(m<0)c.y+=-m,c.height-=l>-m?0:-m-l;else if(l<0)return c.y-=-l,this.clipArea(c)}return c};ixMap.Zoom.prototype.isVisibleBox=function(c){try{var e=this.getBox();return c.x+c.width<e.x||c.x>e.x+e.width||c.y+c.height<e.y||c.y>e.y+e.height?!1:!0}catch(f){return!1}};ixMap.Zoom.prototype.isCompletelyVisibleBox=function(c){var e=this.getBox();return c.x<e.x||c.x+c.width>e.x+e.width||c.y<e.y||c.y+c.height>
e.y+e.height?!1:!0};ixMap.Zoom.prototype.doExecuteZoomMap=function(c,e){c=this.checkZoomLimit(c);if(c!=this.nZoom){var f=getMatrix(this.zoomNode),m=(map.SVGRootElement.currentTranslate.x+map.Scale.embedX(f[4]))/e*c;f=(map.SVGRootElement.currentTranslate.y+map.Scale.embedX(f[5]))/e*c;this.nOldZoomX=this.nZoomX;this.nOldZoomY=this.nZoomY;this.nZoomX=this.nZoomX/e*c;this.nZoomY=this.nZoomY/e*c;map.fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" 0 0)"),
map.SVGRootElement.currentTranslate.x=m,map.SVGRootElement.currentTranslate.y=f):this.zoomNode.setAttributeNS(null,"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" "+map.Scale.normalX(m)+" "+map.Scale.normalY(f)+")");this.nZoom=c;map.Event.doDefaultZoom(null)}};ixMap.Zoom.prototype.doZoomMapToArea=function(c){if(c.width&&c.height){this.fAreaSet=!0;var e=getMatrix(this.canvasNode);new point(e[4],e[5]);e=map.Scale.bBox.width/c.width;var f=map.Scale.bBox.height/c.height,m=Math.min(e,f);m=Math.round(m*
1E6)/1E6;e=Math.round(e*1E6)/1E6;f=Math.round(f*1E6)/1E6;var l=this.checkZoomLimit(m);l!=m&&c.scale(m/l);m=l;m!=this.nZoom&&(map.fPreserveMapRatio&&(e=f=m),map.fZoomByViewer&&map.fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),map.SVGRootElement.currentScale=m):map.fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+f+" 0 0)"),map.SVGRootElement.currentScale=1):this.zoomNode.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+f+" 0 0)"),
this.nZoom=m,this.nOldZoomX=this.nZoomX,this.nOldZoomY=this.nZoomY,this.nZoomX=e,this.nZoomY=f);this.doCenterMapToArea(c)}};ixMap.Zoom.prototype.doCenterMapToArea=function(c){this.fAreaSet=!0;this.fExternalZoom=!1;var e=getMatrix(this.canvasNode),f=new point(e[4],e[5]),m=getMatrix(this.zoomNode);e=m[0];m=m[3];c.x+=c.width/2;c.y+=c.height/2;c.x=c.x*e+f.x;c.y=c.y*m+f.y;f=-c.x+(map.Scale.viewBox&&map.Scale.viewBox.width>0?map.Scale.viewBox.width:map.Scale.bBox.width)/2;var l=-c.y+(map.Scale.viewBox&&
map.Scale.viewBox.height>0?map.Scale.viewBox.height:map.Scale.bBox.height)/2;l=map.Scale.rotatePoint(new point(f,l));f=l.x;l=l.y;map.fZoomByViewer&&map.fPanByViewer?(map.SVGRootElement.currentScale=this.nZoom,map.SVGRootElement.currentTranslate.x=map.Scale.embedX(f-c.width/2)*this.nZoomX,map.SVGRootElement.currentTranslate.y=map.Scale.embedY(l-c.height/2)*this.nZoomY):map.fPanByViewer?(map.SVGRootElement.currentTranslate.x=map.Scale.embedX(f),map.SVGRootElement.currentTranslate.y=map.Scale.embedY(l)):
(c=getTranslate(this.zoomNode),this.zoomNode.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+m+" "+f+" "+l+")"),this.doPanFixed(f-c.x,l-c.y));map.fFroozeDynamicContent||(map.isIdle()?map.Event.doDefaultZoom(null):map.pushAction(()=>{map.Event.doDefaultZoom(null)}))};ixMap.Zoom.prototype.doPanFixed=function(c,e){for(var f=map.SVGFixedGroup.childNodes,m=0;m<f.length;m++){var l=f.item(m).fu.getPosition();f.item(m).fu.setPosition(l.x+c,l.y+e)}f=map.SVGToolsGroup.childNodes;for(m=0;m<f.length;m++)l=
f.item(m).fu.getPosition(),f.item(m).fu.setPosition(l.x+c,l.y+e)};ixMap.Zoom.prototype.doZoomMapToWidgetRect=function(c){var e=Math.min(c.width,c.height)<map.Scale.normalX(25)?!0:!1;new point(c.x,c.y);new point(c.x-c.width,c.y-c.height);var f=getMatrix(map.Scale.zoomNode),m=f[0],l=f[3],h=map.antiZoomAndPanList.getActualMatrix(),p=map.Scale.rotatePoint(new point(f[4],f[5]),-1);f[4]=p.x;f[5]=p.y;c.x=c.x*h[0]+h[4];c.y=c.y*h[3]+h[5];c.width*=h[0];c.height*=h[3];c.x=c.x-map.Scale.mapPosition.x-map.Scale.mapOffset.x;
c.y=c.y-map.Scale.mapPosition.y-map.Scale.mapOffset.y;c.x=(c.x-f[4])/m;c.y=(c.y-f[5])/l;c.width/=m;c.height/=l;e?map.Zoom.setNewCenter(c):map.Zoom.setNewArea(c)};ixMap.Zoom.prototype.doZoomMapToEnvelope=function(c,e,f,m){this.doCheckEnvelope(c,e,f,m)?(c=(c-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,m=map.Scale.maxY-map.Scale.minY-(m-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,this.doArea=new box(c,m,(e-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x-
c,map.Scale.maxY-map.Scale.minY-(f-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-m),map.Zoom.execute()):map.Zoom.doZoomMapToLayer("maplayer")};ixMap.Zoom.prototype.doCenterMapToEnvelope=function(c,e,f,m){this.doCheckEnvelope(c,e,f,m)&&(c=(c-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,m=map.Scale.maxY-map.Scale.minY-(m-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,map.Zoom.doCenterMapToArea(new box(c,m,(e-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-
map.Scale.mapOffset.x-c,map.Scale.maxY-map.Scale.minY-(f-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-m)))};ixMap.Zoom.prototype.doCenterMapToGeoPosition=function(c,e){var f=map.Scale.getMapCoordinateOfLatLon(c,e);f?this.doCenterMapToEnvelope(f.x,f.x,f.y,f.y):(console.warn("getMapCoordinateOfLatLon returned null for lat="+c+", lon="+e),displayMessage("missing projection ! lat/lon could not be resolved",1E3))};ixMap.Zoom.prototype.doCenterMapToGeoBounds=function(c,e,f,m){var l=
null,h=map.Scale.szMapProjection||"";h.match(/orthographic/i)?l="orthographic":h.match(/albers/i)?l="albers":h.match(/lambert/i)&&(l="lambert");if(l){h=null;if(l==="albers"){if(map.Scale&&typeof map.Scale.calculateAlbersParametersFromBounds==="function"&&(m=map.Scale.calculateAlbersParametersFromBounds(c,e,f,m))){h=map.Scale.lastAlbersParams;f=!1;if(!h)f=!0;else if(Math.abs(m.lat1-h.lat1)>.5||Math.abs(m.lat2-h.lat2)>.5||Math.abs(m.lat0-h.lat0)>.5||Math.abs(m.lon0-h.lon0)>.5)f=!0;map.Scale.lastAlbersParams=
{lat1:m.lat1,lat2:m.lat2,lat0:m.lat0,lon0:m.lon0};h={params:m,changed:f}}}else f=(c+f)/2,m=(e+m)/2,e=null,map.HTMLWindow&&map.HTMLWindow.ixmaps&&(c=map.HTMLWindow.ixmaps.getZoom(),c!==void 0&&Number.isFinite(c)&&(e=c)),e===null&&map.Scale.nZoomScale&&map.Scale.nZoomScale>0&&(e=Math.max(1,Math.min(20,Math.log2(map.Scale.nZoomScale)+5))),e===null&&(e=5),c=null,l==="orthographic"?c=map.Api.updateOrthographicParameters:l==="lambert"&&(c=map.Api.updateLambertParameters),map.Api&&c&&typeof c==="function"&&
(h=c.call(map.Api,[f,m],e));if(h&&h.params){map.Themes.themeNodesPosA=[];map.Themes.themeNodesA=[];for(m=h=0;m<map.Themes.themesA.length;m++)f=map.Themes.themesA[m],f.szFlag&&(f.fRealize=!0,f.fActualize=!0,f.fClearOnProjectionChange=!0,h++,f.themeNodesPosA&&(f.themeNodesPosA=[]),f.themeNodesA&&(f.themeNodesA=[]));map.Scale&&typeof map.Scale.getEmbedWidth==="function"&&typeof map.Scale.getEmbedHeight==="function"&&(map.Scale.nScaleX=map.Scale.viewBox.width/map.Scale.getEmbedWidth()*map.Scale.getEmbedScale(),
map.Scale.nScaleY=map.Scale.viewBox.height/map.Scale.getEmbedHeight()*map.Scale.getEmbedScale());map.Scale&&map.Scale.viewBox&&(map.Scale.bBox.width=map.Scale.viewBox.width,map.Scale.bBox.height=map.Scale.viewBox.height,map.Scale.mapCanvasCenter=new point(map.Scale.mapPosition.x+map.Scale.bBox.width/2,map.Scale.mapPosition.y+map.Scale.bBox.height/2));m=h=null;l==="lambert"&&map.Scale.lastLambertParams?(h=map.Scale.lastLambertParams.lat0,m=map.Scale.lastLambertParams.lon0):l==="albers"&&map.Scale.lastAlbersParams&&
(h=map.Scale.lastAlbersParams.lat0,m=map.Scale.lastAlbersParams.lon0);if(h!==null&&m!==null&&map.Zoom&&typeof map.Zoom.doCenterMapToGeoPosition==="function")try{map.Zoom.doCenterMapToGeoPosition(h,m)}catch(p){console.warn("Error visually centering "+l+" projection:",p)}setTimeout(function(){map.Themes&&typeof map.Themes.execute==="function"?map.Themes.execute():console.warn("map.Themes.execute() not available")},0)}else if(console.warn("No "+l+" parameter update - result is null or missing params:",
h),h=!1,l==="orthographic"?h=map.Scale&&map.Scale.nOrthographicLat0!==void 0&&map.Scale.nOrthographicLon0!==void 0:l==="albers"?h=map.Scale&&map.Scale.lastAlbersParams!==void 0:l==="lambert"&&(h=map.Scale&&map.Scale.lastLambertParams!==void 0),h){for(m=h=0;m<map.Themes.themesA.length;m++)f=map.Themes.themesA[m],f.szFlag&&(f.fRealize=!0,f.fActualize=!0,f.fClearOnProjectionChange=!0,h++);h>0&&map.Themes&&typeof map.Themes.execute==="function"&&setTimeout(function(){map.Themes.execute()},0)}}else this.fExternalZoom=
!1,l=map.Scale.getMapCoordinateOfLatLon(c,e),h=map.Scale.getMapCoordinateOfLatLon(f,m),l&&h?this.doCenterMapToEnvelope(l.x,h.x,l.y,h.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};ixMap.Zoom.prototype.doZoomMapToGeoBounds=function(c,e,f,m){c=map.Scale.getMapCoordinateOfLatLon(c,e);f=map.Scale.getMapCoordinateOfLatLon(f,m);c&&f?this.doSetEnvelopeByParentMap(c.x,f.x,c.y,f.y)||this.doZoomMapToEnvelope(c.x,f.x,c.y,f.y):displayMessage("missing projection ! lat/lon could not be resolved",
1E3)};ixMap.Zoom.prototype.doZoomMapToView=function(c,e){try{map.HTMLWindow.ixmaps.htmlgui_setCenterAndZoom({lat:c[0],lng:c[1]},e)}catch(f){return!1}};ixMap.Zoom.prototype.doZoomMapToLayer=function(c){if(map.fPendingNewGeoBounds)map.fPendingNewGeoBounds=!1;else{var e=map.SVGDocument.getElementById(c),f=map.Dom.getBox(e);e=map.Scale.getMapOffset(e);f.x+=e.x;f.y+=e.y;f=new box(f.x,f.y,f.width,f.height);f.scale(.8);if(c=="maplayer"){e=c=3E4;var m=-3E4,l=-3E4,h=!1,p;for(p in map.Layer.listA)if(!p.match(/legend/)){var B=
map.SVGDocument.getElementById(p+"::bbox");B&&(c=Math.min(c,Number(B.getAttributeNS(null,"minboundx"))),e=Math.min(e,Number(B.getAttributeNS(null,"minboundy"))),m=Math.max(m,Number(B.getAttributeNS(null,"maxboundx"))),l=Math.max(l,Number(B.getAttributeNS(null,"maxboundy"))),h=!0)}h&&(f=new box(c,e,Math.abs(m-c),Math.abs(l-e)))}f.width&&f.height&&f.width<map.Scale.bBox.width&&f.height<map.Scale.bBox.height&&(map.Zoom.doSetAreaByParentMap(f)||map.Zoom.setNewArea(f))}};ixMap.Zoom.prototype.doZoomMapToItem=
function(c){if(map.fPendingNewGeoBounds)map.fPendingNewGeoBounds=!1;else{var e=map.SVGDocument.getElementById(c);c=map.Dom.getBox(e);e=map.Scale.getMapOffset(e);c.x+=e.x;c.y+=e.y;c=new box(c.x,c.y,c.width,c.height);c.width&&c.height&&c.width<map.Scale.bBox.width&&c.height<map.Scale.bBox.height&&(map.Zoom.doSetAreaByParentMap(c)||map.Zoom.setNewArea(c))}};ixMap.Zoom.prototype.doSetMapToGeoBounds=function(c,e,f,m){this.fExternalZoom=!1;c=map.Scale.getMapCoordinateOfLatLon(c,e);f=map.Scale.getMapCoordinateOfLatLon(f,
m);c&&f?this.doZoomMapToEnvelope(c.x,f.x,c.y,f.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};ixMap.Zoom.prototype.getCenterOfMapInGeoPosition=function(){var c=this.getBox();c=map.Scale.getMapCoordinate(c.x+c.width/2,c.y+c.height/2);return c=map.Scale.getGeoCoordinateOfPoint(c.x,c.y)};ixMap.Zoom.prototype.getBoundsOfMapInGeoBounds=function(){var c=this.getBox(),e=map.Scale.getMapCoordinate(c.x,c.y+c.height);c=map.Scale.getMapCoordinate(c.x+c.width,c.y);e=map.Scale.getGeoCoordinateOfPoint(e.x,
e.y);c=map.Scale.getGeoCoordinateOfPoint(c.x,c.y);if(!e||!c){var f=map.Zoom.getCenterOfMapInGeoPosition();f?(e||=new point(f.x-.1,f.y-.1),c||=new point(f.x+.1,f.y+.1)):(e=e||new point(-180,-90),c=c||new point(180,90))}return[e,c]};ixMap.Zoom.prototype.doCheckEnvelope=function(c,e,f,m){return map.fLimitMapToExtent?c<map.Scale.minBoundX&&e>map.Scale.maxBoundX&&f<map.Scale.minBoundY&&m>map.Scale.maxBoundY&&e-c>(map.Scale.maxBoundX-map.Scale.minBoundX)*2||c>map.Scale.maxBoundX||e<map.Scale.minBoundX||
f>map.Scale.maxBoundY||m<map.Scale.minBoundY?(displayMessage("position outside",500),!1):!0:!0};ixMap.Zoom.prototype.doSetAreaByParentMap=function(c){var e=map.Scale.getMapCoordinate(c.x,c.y);c=map.Scale.getMapCoordinate(c.x+c.width,c.y+c.height);return this.doSetEnvelopeByParentMap(e.x,c.x,e.y,c.y)};ixMap.Zoom.prototype.doSetEnvelopeByParentMap=function(c,e,f,m){try{var l=map.Scale.getGeoCoordinateOfPoint(c,f),h=map.Scale.getGeoCoordinateOfPoint(e,m);this.fExternalZoom=!0;return map.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelopeByGeoBounds(l,
h)}catch(p){return!1}};ixMap.Zoom.prototype.doCenterByParentMap=function(c){c=map.Scale.getMapCoordinate(c.x+c.width/2,c.y+c.height/2);return this.doSetCenterByParentMap(c.x,c.y)};ixMap.Zoom.prototype.doSetCenterByParentMap=function(c,e){try{var f=map.Scale.getGeoCoordinateOfPoint(c,e);return map.HTMLWindow.ixmaps.htmlgui_setCurrentCenterByGeoBounds(f)}catch(m){return!1}};ixMap.Zoom.prototype.doZoomMap=function(c,e){if(this.zoomNode){displayMessage("please wait ...",500);var f=getMatrix(map.Zoom.zoomNode)[0];
if(c===0)return this.toFullExtend(),Math.round(map.Scale.nMapScale);switch(e){case "absolute":f=c;break;case "byscale":f=map.Scale.nTrueMapScale/c;break;default:f*=c}this.setNewZoom(f);return Math.round(map.Scale.nMapScale/f)}};ixMap.Zoom.prototype.doPanMap=function(c,e){var f=getMatrix(this.zoomNode),m=f[0],l=f[3];c=map.SVGRootElement.currentTranslate.x+c;e=map.SVGRootElement.currentTranslate.y+e;e=map.Scale.rotatePoint(new point(c,e));c=e.x;e=e.y;c+=map.Scale.embedX(f[4]);e+=map.Scale.embedY(f[5]);
if(!map.Scale.szMapProjection||typeof map.Scale.szMapProjection!=="string"||map.Scale.szMapProjection.toLowerCase().indexOf("orthographic")===-1)if(map.fPanByViewer?(map.SVGRootElement.currentTranslate.x=c,map.SVGRootElement.currentTranslate.y=e):(c=map.Scale.normalX(c),e=map.Scale.normalY(e),f=getTranslate(this.zoomNode),this.zoomNode.setAttributeNS(null,"transform","matrix("+m+" 0 0 "+l+" "+c+" "+e+")"),this.doPanFixed(c-f.x,e-f.y)),map.Scale.szMapProjection=="Mercator")try{var h=this.getBox(),
p=map.Scale.getMapCoordinate(h.x+h.width/2,h.y+h.height/2);this.doSetCenterByParentMap(p.x,p.y)}catch(B){try{map.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(this.getEnvelopeString(),!1)}catch(C){}}};ixMap.Zoom.prototype.doPanMapByViewer=function(c,e){e=map.SVGRootElement.currentTranslate.y+e;map.SVGRootElement.currentTranslate.x+=c;map.SVGRootElement.currentTranslate.y=e};ixMap.Zoom.prototype.checkZoomLimit=function(c){var e=1E6;map.fPDFEmbed&&(e=20,map.Tiles&&map.Tiles.nCount>1&&(e=20));return c>=
e?e:c=Math.round(c*1E6)/1E6};ixMap.Zoom.prototype.removeClipping=function(c){map.fClipMapDynamic&&map.SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","")};ixMap.Zoom.prototype.activateClipping=function(c){map.fClipMapDynamic&&map.SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","url(#mapclippath)")};ixMap.Zoom.prototype.onMouseMove=function(c){};ixMap.Zoom.prototype.onMouseDown=function(c){};ixMap.Zoom.prototype.onMouseUp=function(c){this.setFractionBox(new box(this.overviewThumbObj.fraction.x,
this.overviewThumbObj.fraction.y,1/this.nZoomX,1/this.nZoomY))};ixMap.Layer=function(c){this.document=c?c.target.ownerDocument:map.SVGDocument;this.layerNode=map.SVGDocument.getElementById("maplayer");this.listA=[];this.depListA=[];this.generatedLabelA=[];this.changedFeatureNodesA=[];this.objectGroup=map.SVGDocument.getElementById(map.szObjectGroupId);this.fSwitchSublayer=!0;this.nDynamicObjectScale=this.nObjectScale=this.nFeatureScale=1;var e=map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");
if(e.length)for(this.listA.legend_body=new ixMap.Layer.Item(null),c=0;c<e.length;c++)this.listA[e.item(c).getAttributeNS(null,"name")]=new ixMap.Layer.Item(e.item(c));e=map.SVGDocument.getElementsByTagNameNS(szMapNs,"scaledependency");if(!(e.length<=0))for(c=0;c<e.length;c++){var f=e.item(c).getAttributeNS(null,"feature");this.depListA[f]=new ixMap.Layer.Dependency(e.item(c))}};ixMap.Layer.prototype=new Map;ixMap.Layer.Item=function(c){if(c){if(this.szName=c.getAttributeNS(null,"name"),this.szLegendName=
c.getAttributeNS(null,"legendname"),this.szFlag=c.getAttributeNS(null,"flag"),this.szType=c.getAttributeNS(null,"type"),this.nItems=Number(c.getAttributeNS(null,"items")),this.nRenderer=c.getAttributeNS(null,"renderer"),this.szRenderer=c.getAttributeNS(null,"rendererfield"),this.szLabel=c.getAttributeNS(null,"label"),this.szSelection=c.getAttributeNS(null,"selection"),this.szFilter=c.getAttributeNS(null,"filter"),this.szFilterValue=c.getAttributeNS(null,"filtervalue"),this.szHighlight=c.getAttributeNS(null,
"highlightstyle"),this.szDisplay=c.getAttributeNS(null,"display"),this.szDisplayLabel=c.getAttributeNS(null,"displaylabel"),this.categoryA=this.labelBoxA=null,c=c.getElementsByTagNameNS(szMapNs,"category"),c.length){this.categoryA=[];for(var e=0;e<c.length;e++){var f=this.categoryA[c.item(e).getAttributeNS(null,"name")]={};f.legendname=c.item(e).getAttributeNS(null,"legendname");f.fill=c.item(e).getAttributeNS(null,"fill");f.stroke=c.item(e).getAttributeNS(null,"stroke");f.style=c.item(e).getAttributeNS(null,
"style");f.display="inline"}}}else this.szFlag="",this.szType="dummy",this.szDisplayLabel=this.szDisplay="inline"};ixMap.Layer.Dependency=function(c){c&&(this.shapeId=c.getAttributeNS(null,"shape"),this.szFeature=c.getAttributeNS(null,"feature"),this.depClass=c.getAttributeNS(null,"classname"),this.nUpper=1E11,this.nLower=0,this.depLower=c.getAttributeNS(null,"lower"),(this.depUpper=c.getAttributeNS(null,"upper"))&&this.depUpper.length&&(this.nUpper=Number(this.depUpper.split(":")[1])),this.depLower&&
this.depLower.length&&(this.nLower=Number(this.depLower.split(":")[1])),this.szDisplayAttribute="inline")};ixMap.Layer.prototype.switchLayer=function(c,e,f,m){var l=m?"inline":"none",h=this.listA[e.split(":")[0]];if(!h)return!1;if(f&&f.match(/legendgroup/))return!0;if(e&&!e.match(/label/)&&!e.match(/::/)&&(e.match(/group/)||this.fSwitchSublayer)){var p="legend:collapsable:"+e.split(":")[0];map.SVGDocument.getElementById(p)&&setTimeout('__doSwitchGroupThemes("'+e+'",'+m+")",250)}e&&!e.match(/label/)&&
e.match(/::/)&&m===!0&&(p=this.fSwitchSublayer,this.fSwitchSublayer=!1,this.switchLayer(c,e.split("::")[0],f,!0),this.fSwitchSublayer=p,(p=map.SVGDocument.getElementById("legend:off:"+e.split("::")[0]))&&p.style.getPropertyValue("display")!="inline"&&(p=map.SVGDocument.getElementById("legend:suboff:"+e.split("::")[0]))&&p.style.setProperty("display","inline",""));e.match(/label/)&&!e.match(/:bg/)&&this.switchLayer(c,e+":bg",f,m);e.match(/::/)&&e.split("::")[1]&&h.categoryA[e.split("::")[1]]?h.categoryA[e.split("::")[1]].display=
l:(h.categoryA&&h.categoryA[null]&&(h.categoryA[null].display=l),h.display=l,h.nState=l=="none"?!1:!0);return h&&(this.switchLayerByFeature(e,m)||this.switchLayerOnTiles(e,m))?(e.match(/:label/)?h.szDisplayLabel=l:(h.nState=m,h.szDisplay=l),h.szLabel&&this.adaptLabel(c),setTimeout("map.Layer.adaptLabel()",100),!0):f&&!e.match(/:label/)?(this.switchLayerByCSS(null,e,f,m?"inline":"none"),h&&(h.szDisplay=l),setTimeout("map.Layer.adaptLabel()",100),!0):!1};ixMap.Layer.prototype.switchLayerOnTiles=function(c,
e){var f=!1;if(map.Tiles&&map.Tiles.nCount>0){c=map.Tiles.getTileNodeIds(c);for(var m=0;m<c.length;m++)f=this.switchLayerByFeature(c[m],e)?!0:f}return f};ixMap.Layer.prototype.switchLayerByFeature=function(c,e){var f,m=!1,l=this.document.getElementById(c);if(l)if(this.addChangedFeatureNode(l),l.getAttributeNS(null,"class")=="linetemplate"||l.getAttributeNS(szMapNs,"class")=="linetemplate")if(c.match(/#/))for(c=c.split("#"),f=0;f<10;f++){if(l=this.document.getElementById(c[0]+"_"+f+"#"+c[1]))l.style.setProperty("display",
e?"inline":"none",""),m=!0}else for(f=0;f<10;f++){if(l=this.document.getElementById(c+"_"+f))l.style.setProperty("display",e?"inline":"none",""),m=!0}else l.style.setProperty("display",e?"inline":"none",""),m=!0;return m};ixMap.Layer.prototype.switchLayerByCSS=function(c,e,f,m){if(f!="(null)"){if(e&&(e=e.split(":")[0],this.listA[e+"_1"])){var l=f.substr(e.length,f.length-e.length),h=parseInt(l),p=parseInt(l.substr(l.length-1,1));l=f.substr(0,e.length);for(f=1;this.listA[e+"_"+f];)h++,this.switchLayerByCSS(c,
null,l+"-"+f+h+"s"+p,m),f++;return}map.Scale.CSSStyleNodes&&(c=map.Scale.CSSStyleNodes,map.CSS=new ixMap.CSS(map.Scale.CSSStyleNodes),map.CSS.setStyle(f,"display",m),map.Scale.fCSSStyleNodeChanged=!0,c.firstChild.nextSibling.nodeValue=map.CSS.getStyleString(),displayMessage("please wait ...",500),setTimeout("map.Scale.refreshCSSStyles()",200))}};ixMap.Layer.prototype.switchScaleDependentLayer=function(c,e){if(map.fDynamicLayer&&this.depListA!=null){var f=0;for(f in this.depListA){if(map.Scale.nTrueMapScale*
map.Scale.nZoomScale>=this.depListA[f].nLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.depListA[f].nUpper)var m="inline";else m="none",!this.depListA[f].shapeId.match(/:label/)&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.depListA[f].nUpper&&(map.Themes&&map.Themes.getThemeCount()!==0||displayMessage("'"+this.depListA[f].shapeId+"' not visible at actual zoom level!",3E3,"notify"));if(this.depListA[f].szDisplayAttribute!=m){this.depListA[f].szDisplayAttribute=m;if(this.isChangedFeature(this.depListA[f].shapeId)){if(this.depListA[f].szOldDisplayAttribute==
m)continue;this.depListA[f].szOldDisplayAttribute=this.depListA[f].szDisplayAttribute}var l=this.depListA[f].szFeature;map.Legend&&map.Legend.switchLegendCheckBox(c,l,m)}try{var h=this.depListA[f].shapeId;h.match(/label/)?(h.split(":"),this.listA[h.split(":")[0]].szDisplayLabel=m):this.listA[h].szDisplay=m}catch(p){alert("Syntax error: "+h)}}if(map.Scale.CSSStyleNodes&&map.Scale.CSSStyleNodes.firstChild.nextSibling&&map.fSwitchByCSS){c=map.Scale.CSSStyleNodes;map.CSS=new ixMap.CSS(map.Scale.CSSStyleNodes);
for(f in this.depListA)e=this.depListA[f],e.szDisplayAttribute!=e.szOldDisplayAttribute&&(m=e.depClass,m.length>3?(map.CSS.setStyle(m,"display",e.szDisplayAttribute),map.Scale.fCSSStyleNodeChanged=!0):(m=map.SVGDocument.getElementById(e.shapeId))&&m.style.setProperty("display",e.szDisplayAttribute,""));map.Scale.fCSSStyleNodeChanged&&(c.firstChild.nextSibling.nodeValue=map.CSS.getStyleString())}else for(e=e?e:map.SVGRootElement,f=e.getElementsByTagName("g"),c=0;c<f.length;c++)e=f.item(c).getAttributeNS(null,
"id"),e=map.Tiles.getMasterId(e),this.depListA[e]&&f.item(c).style.setProperty("display",this.depListA[e].szDisplayAttribute,"")}};ixMap.Layer.prototype.isScaleDependentLayer=function(c){return this.depListA&&this.depListA[c]?!0:!1};ixMap.Layer.prototype.isScaleDependentLayerOn=function(c){return this.depListA&&this.depListA[c]?this.depListA[c].szDisplayAttribute.match(/none/)?!1:!0:!0};ixMap.Layer.prototype.zoomToScaleDependentLayerOn=function(c){if(typeof this.listA[c]!="undefined"){map.Event.doDefaultZoom(null);
var e=map.Scale.nTrueMapScale*map.Scale.nZoomScale;c=this.depListA&&this.depListA[c]&&this.depListA[c].nUpper?this.depListA[c].nUpper:map.Tiles.depUpper?map.Tiles.depUpper.split(":")[1]:0;var f=Math.ceil(e/c);e=map.Zoom.getBox();c=e.width/f;f=e.height/f;e.x+=(e.width-c)/2;e.y+=(e.height-f)/2;e.width=c;e.height=f;map.Zoom.setNewArea(e);setTimeout("map.Tiles.switchScaleDependentTiles()",5E3)}};ixMap.Layer.prototype.isLayerOn=function(c){return this.listA[c]?this.listA[c].szDisplay.match(/none/)?!1:
!0:!1};ixMap.Layer.prototype.changeLayerOpacity=function(c,e){var f;(f=this.changeOpacity(c,e))||(f=this.changeOpacityOnTiles(c,e));return f};ixMap.Layer.prototype.changeOpacityOnTiles=function(c,e){var f=!1;if(map.Tiles&&map.Tiles.nCount>0){c=map.Tiles.getTileNodeIds(c);for(var m=0;m<c.length;m++)f=this.changeOpacity(c[m],e)?!0:f}else f=this.changeOpacity(c,e)?!0:f;return f};ixMap.Layer.prototype.changeOpacity=function(c,e){var f,m=!1,l=this.document.getElementById(c);if(l)if(l.getAttributeNS(null,
"class")=="linetemplate"||l.getAttributeNS(szMapNs,"class")=="linetemplate")if(c.match(/#/))for(c=c.split("#"),f=0;f<10;f++){if(l=this.document.getElementById(c[0]+"_"+f+"#"+c[1]))this.changeNodeOpacity(l,e),m=!0}else for(f=0;f<10;f++){if(l=this.document.getElementById(c+"_"+f))this.changeNodeOpacity(l,e),m=!0}else this.changeNodeOpacity(l,e),m=!0;return m};ixMap.Layer.prototype.changeNodeOpacity=function(c,e,f){var m=c.style.getPropertyValue(f?f:"opacity");m&&m.length!==0||(m="1");m=Number(m);m=
Math.min(1,m*e);m=Math.max(0,m);c.style.setProperty(f?f:"opacity",String(m),"")};ixMap.Layer.prototype.initPatternScaling=function(c,e){e||(e=map.SVGRootElement);c=1/map.Scale.getEmbedScale()*map.Scale.nFeatureScaling;e=e.getElementsByTagName("pattern");for(var f=0;f<e.length;f++)e.item(f).getAttributeNS(null,"id").match(/antizoomandpan/)||(getPatternMatrix(e.item(f)),e.item(f).setAttributeNS(null,"patternTransform","matrix("+c+" 0 0 "+c+" 0 0)"))};ixMap.Layer.prototype.changeLineScaling=function(c,
e){this.doFeatureScaling(e);map.Scale.nLineScaling*=e};ixMap.Layer.prototype.changeLabelScaling=function(c,e){this.doLabelScaling(e);map.Scale.nLabelScaling*=e};ixMap.Layer.prototype.changeFeatureScaling=function(c,e,f){if(!(e>=1&&map.Scale.featureScaling_lastScale>=1)||f){var m=e/map.Scale.getEmbedScale();f=e;if(map.fFeatureScalingDynamic){var l=Math.log(1/e);l>1&&(e*=l)}map.Layer.nFeatureScale=e;map.Layer.nDynamicScale=map.Layer.nFeatureScale/map.Scale.nZoomScale;l=e/map.Scale.featureScaling_lastScale;
map.Scale.featureScaling_lastScale=e;if(l!==0&&l!==1)if(map.fFeatureScaling){var h=map.SVGRootElement.getElementsByTagName("pattern");var p=getMatrix(map.Scale.zoomNode);var B=p[4]+map.Scale.scaleX(map.SVGRootElement.currentTranslate.x),C=p[5]+map.Scale.scaleY(map.SVGRootElement.currentTranslate.y);B=-B*m;C=-C*m;for(p=0;p<h.length;p++)h.item(p).getAttributeNS(null,"id").match(/antizoomandpan/)||(getPatternMatrix(h.item(p)),h.item(p).setAttributeNS(null,"patternTransform","matrix("+m+" 0 0 "+m+" "+
String(B)+" "+String(C)+")"));c=c?c.target.ownerDocument:map.SVGDocument;h=!0;map.Scale.nFeatureScaling<1&&(h=!1,l<1&&map.Scale.nFeatureScaling*map.Zoom.nZoom>=1&&(map.Scale.nFeatureScaling*map.Zoom.nZoom*l<1&&(l=1/map.Scale.nFeatureScaling/map.Zoom.nZoom),h=!0),l>1&&map.Scale.nFeatureScaling*map.Zoom.nZoom*l>=1&&(map.Scale.nFeatureScaling*map.Zoom.nZoom<1&&(l=map.Zoom.nZoom*l/(1/map.Scale.nFeatureScaling)),h=!0));if(h){h=map.SVGRootElement.getElementsByTagName("filter");for(p=0;p<h.length;p++)if(!h.item(p).getAttributeNS(null,
"id").match(/antizoomandpan/))for(m=h.item(p).childNodes,B=0;B<m.length;B++)m.item(B).nodeName=="feMorphology"&&m.item(B).setAttributeNS(null,"radius",Number(m.item(B).getAttributeNS(null,"radius"))*l),m.item(B).nodeName=="feOffset"&&(m.item(B).setAttributeNS(null,"dx",Number(m.item(B).getAttributeNS(null,"dx"))*l),m.item(B).setAttributeNS(null,"dy",Number(m.item(B).getAttributeNS(null,"dy"))*l)),m.item(B).nodeName=="feGaussianBlur"&&m.item(B).setAttributeNS(null,"stdDeviation",Number(m.item(B).getAttributeNS(null,
"stdDeviation"))*l);this.doFeatureScaling(l);this.doLabelScaling(l);m=l;if(h=map.SVGDocument.getElementById("marker_symbols"))for(h=h.childNodes,p=0;p<h.length;p++)if(h.item(p).nodeType==1&&(B=h.item(p).getAttributeNS(null,"id"))&&B.length&&!B.match(/antizoomandpan/)){var N=getMatrix(h.item(p));N&&(N[0]*=l,N[3]*=l,setMatrix(h.item(p),N),map.Scale.scaledSymbolsA["#"+B]=!0)}if(h=map.SVGDocument.getElementById("symbolstore"))for(h=h.getElementsByTagName("g"),p=0;p<h.length;p++)(B=h.item(p).getAttributeNS(null,
"id"))&&B.length&&B.match(/symbol/)&&!B.match(/antizoomandpan/)&&(N=getMatrix(h.item(p)))&&(N[0]*=l,N[3]*=l,N[4]*=l,N[5]*=l,setMatrix(h.item(p),N),map.Scale.scaledSymbolsA["#"+B]=!0);h=map.SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(p=0;p<h.length;p++)B=h.item(p).getAttributeNS(szXlink,"href"),map.Scale.scaledSymbolsA[B]&&(N=getMatrix(h.item(p)))&&(N[0]/=l,N[3]/=l,setMatrix(h.item(p),N));h=map.SVGHiddenGroup.getElementsByTagName("use");for(p=0;p<h.length;p++)B=
h.item(p).getAttributeNS(szXlink,"href"),map.Scale.scaledSymbolsA[B]&&(N=getMatrix(h.item(p)))&&(N[0]/=l,N[3]/=l,setMatrix(h.item(p),N));this.scaleTextOffsets(map.SVGRootElement,e,m,c.getElementById("mapstyles"));this.scaleLineDecorations(map.SVGRootElement,e);this.doObjectScaling(f)}}else this.doObjectScaling(f)}};ixMap.Layer.prototype.doFeatureScaling=function(c){var e=map.SVGDocument.getElementById("mapstyles");if(e){var f=e.firstChild.nextSibling.nodeValue;var m=__scaleLineStyleString(f,c);e.firstChild.nextSibling.nodeValue=
m;map.Scale.fCSSStyleNodeChanged=!0}else if(map.fFeatureScalingByLayer){e=[];f=[];var l=!1;for(m in map.Layer.listA){var h=map.Layer.listA[m];if(h.szFlag.match(/tiled/)){if(!l){l=!0;var p=map.Tiles.getTileInfo();if(p)for(var B=0;B<p.length;B++){var C=Number(p[B].tileGroup.getAttributeNS(szMapNs,"deltaTBD"));if(p[B].tileGroup.style.getPropertyValue("display")=="inline"){h=p[B].tileGroup.getElementsByTagName("g");for(var N=0;N<h.length;N++)h.item(N).getAttributeNS(null,"id").match(/:label/)||(e[e.length]=
h.item(N),f[e.length-1]=C?C:1);p[B].tileGroup.setAttributeNS(szMapNs,"deltaTBD","1")}else p[B].tileGroup.hasChildNodes()&&p[B].tileGroup.setAttributeNS(szMapNs,"deltaTBD",String(c*(C?C:1)))}}}else if(h.szName&&(h=map.SVGDocument.getElementById(h.szName)))for(e[e.length]=h,f[e.length-1]=1,h=h.getElementsByTagName("g"),N=0;N<h.length;N++)h.item(N).getAttributeNS(null,"id").match(/:label/)||(e[e.length]=h.item(N),f[e.length-1]=1)}h=map.SVGDocument.getElementById("mapobjects");h=h.getElementsByTagName("g");
for(N=0;N<h.length;N++)e[e.length]=h.item(N),f[e.length-1]=1;for(l=0;l<e.length;l++)(m=e[l].getAttributeNS(null,"style"))&&m.length&&(m=__scaleLineStyleString(m,c*f[l]),e[l].setAttributeNS(null,"style",m))}};ixMap.Layer.prototype.doDynamicObjectScaling=function(c){map.Layer.nObjectScale=c;map.fObjectScaling=="dynamic"&&(map.Layer.nObjectScale*=Math.pow(1/(map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale),1/map.Scale.nDynamicScalePow));map.Layer.nDynamicObjectScale=map.Layer.nObjectScale/
c};ixMap.Layer.prototype.doObjectScaling=function(c){if(map.fObjectScaling){this.doDynamicObjectScaling(c);var e=map.Layer.nObjectScale/map.Scale.objectScaling_lastScale;map.Scale.objectScaling_lastScale=map.Layer.nObjectScale;if(e!==0&&e!==1&&(c=!0,map.Scale.nObjectScaling<1&&(c=!1,e<1&&map.Scale.nObjectScaling*map.Zoom.nZoom>=1&&(map.Scale.nObjectScaling*map.Zoom.nZoom*e<1&&(e=1/map.Scale.nObjectScaling/map.Zoom.nZoom),c=!0),e>1&&map.Scale.nObjectScaling*map.Zoom.nZoom*e>=1&&(map.Scale.nObjectScaling*
map.Zoom.nZoom<1&&(e=map.Zoom.nZoom*e/(1/map.Scale.nObjectScaling)),c=!0)),c)){c=e;e=e/map.Zoom.nOldZoomX*map.Zoom.nOldZoomY/map.Zoom.nZoomY*map.Zoom.nZoomX;for(var f=map.Layer.objectGroup.childNodes,m=0;m<f.length;m++)if(f.item(m).getAttributeNS(null,"id").match(/featuregroup/)){var l=f.item(m).style.getPropertyValue("stroke-width")*c;f.item(m).style.setProperty("stroke-width",String(l))}else if(map.antiZoomAndPanList.isContained(f.item(m))){l=f.item(m).childNodes;for(var h=0;h<l.length;h++)l.item(h).firstChild&&
l.item(h).firstChild.style.getPropertyValue("stroke-width")&&l.item(h).firstChild.style.setProperty("stroke-width",l.item(h).firstChild.style.getPropertyValue("stroke-width")*c)}else for(l=f.item(m).childNodes,h=0;h<l.length;h++){var p=getMatrix(l.item(h));p&&(p[0]*=c,p[3]*=e,setMatrix(l.item(h),p))}}}};ixMap.Layer.prototype.doStoredFeatureScaling=function(c){if(map.fFeatureScaling){var e;if(!(c?c.target.ownerDocument:map.SVGDocument).getElementById("mapstyles")){c=[];var f=[];if(e=map.Tiles.getTileInfo())for(var m=
0;m<e.length;m++)if(e[m].tileGroup.style.getPropertyValue("display")=="inline"){var l=Number(e[m].tileGroup.getAttributeNS(szMapNs,"deltaTBD"));if(l&&l!=1){var h=e[m].tileGroup.getElementsByTagName("g");for(var p=0;p<h.length;p++)c[c.length]=h.item(p),f[c.length-1]=l?l:1,e[m].tileGroup.setAttributeNS(szMapNs,"deltaTBD","1")}}for(h=0;h<c.length;h++)c[h].getAttributeNS(null,"id").match(/:label/)||(e=c[h].getAttributeNS(null,"style"))&&e.length&&(e=__scaleLineStyleString(e,f[h]),c[h].setAttributeNS(null,
"style",e))}}};ixMap.Layer.prototype.scaleTextOffsets=function(c,e,f,m){for(var l=c.getElementsByTagName("rect"),h=0;h<l.length;h++){var p=l.item(h).getAttributeNS(null,"id");if(p&&p.match(/textbg/)&&(p=l.item(h).nextSibling.nextSibling)&&p.nodeName=="text")if(p=map.Dom.getBox(p),p.width<0||p.height<0)l.item(h).setAttributeNS(null,"width",0),l.item(h).setAttributeNS(null,"height",0);else{m&&(p.x*=f,p.y*=f,p.width*=f,p.height*=f);var B=map.Scale.normalX(1)*e;l.item(h).setAttributeNS(null,"x",p.x-B);
l.item(h).setAttributeNS(null,"y",p.y-B);l.item(h).setAttributeNS(null,"width",p.width+B*2);l.item(h).setAttributeNS(null,"height",p.height+B*2)}}l=c.getElementsByTagName("text");for(h=0;h<l.length;h++)if((p=l.item(h).parentNode.getAttributeNS(null,"id"))&&p.match(/label/)&&(p=l.item(h),c=p.getAttributeNS(null,"transform"))){c=c.split(" ");for(e=0;e<c.length;e++)c[e].match(/translate/)&&(m=c[e].substr(10,c[e].length-11).split(","),c[e]="translate("+Number(m[0])*f+","+Number(m[1])*f+")");m="";for(e=
0;e<c.length;e++)m=m+c[e]+" ";p.setAttributeNS(null,"transform",m)}};ixMap.Layer.prototype.scaleLineDecorations=function(c,e){c=c.getElementsByTagName("text");for(var f=0;f<c.length;f++)if(c.item(f)&&c.item(f).getAttributeNS(null,"id")&&c.item(f).getAttributeNS(null,"id").match(/linedecoration/)){var m=c.item(f).style.getPropertyValue("dominant-baseline"),l=parseFloat(c.item(f).style.getPropertyValue("baseline-shift")),h=parseFloat(c.item(f).style.getPropertyValue("font-size")),p=0;m=="mathematical"&&
(p+=h/3);m=="hanging"&&(p-=h);p-=l*e;c.item(f).setAttributeNS(null,"dy",p)}};ixMap.Layer.prototype.doLabelScaling=function(c){var e=map.SVGDocument.getElementById("mapstyles");if(e){var f=e.firstChild.nextSibling.nodeValue;var m=__scaleTextStyleString(f,c);e.firstChild.nextSibling.nodeValue=m;map.Scale.fCSSStyleNodeChanged=!0;map.Scale.refreshCSSStyles()}else for(e=map.Scale.canvasNode.getElementsByTagName("g"),f=0;f<e.length;f++)if(!map.antiZoomAndPanList.isContained(e.item(f))){var l=e.item(f).getAttributeNS(null,
"id");if(l&&l.length!==0&&l.match(/label/)&&(m=e.item(f).getAttributeNS(null,"style"))&&m.length)if(c===0)map.Layer.switchLayer(null,l,null,e.item(f).style.getPropertyValue("display")=="none"?!0:!1);else{m=__scaleStyleString(m,c);e.item(f).setAttributeNS(null,"style",m);l=e.item(f).childNodes;for(var h=0;h<l.length;h++)l.item(h).nodeName=="text"&&(m=l.item(h).getAttributeNS(null,"style"))&&m.length&&(m=__scaleStyleString(m,c),l.item(h).setAttributeNS(null,"style",m))}}for(var p in map.Layer.generatedLabelA)if(map.Layer.generatedLabelA[p])for(e=
map.Layer.generatedLabelA[p].getElementsByTagName("text"),f=0;f<e.length;f++)(m=e.item(f).getAttributeNS(null,"style"))&&m.length&&(m=__scaleStyleString(m,c),e.item(f).setAttributeNS(null,"style",m));this.adaptLabel(null)};ixMap.Layer.prototype.changeObjectScaling=function(c,e,f){var m,l;e===0&&(e=1/map.Scale.nObjectScaling);if(f){var h=f.childNodes;for(f=0;f<h.length;f++){if(c=getMatrix(h.item(f)))c[0]*=e,c[3]*=e,setMatrix(h.item(f),c);(m=h.item(f).childNodes[0])&&(c=getMatrix(m))&&(c[4]/=Math.pow(e,
.5),c[5]/=Math.pow(e,.5),setMatrix(m,c))}}else if(!(map.Scale.nObjectScaling*e>8||map.Scale.nObjectScaling*e<.1))for(map.Scale.nObjectScaling*=e,m=map.Layer.objectGroup.childNodes,f=0;f<m.length;f++)if(!map.antiZoomAndPanList.isContained(m.item(f)))for(h=m.item(f).childNodes,l=0;l<h.length;l++)if(c=getMatrix(h.item(l)))c[0]*=e,c[3]*=e,setMatrix(h.item(l),c)};ixMap.Layer.prototype.setObjectRotate=function(c,e,f){var m;if(f){var l=f.childNodes;for(f=0;f<l.length;f++)setRotate(l.item(f),(360+Number(e))%
360)}else for(c=map.Layer.objectGroup.childNodes,f=0;f<c.length;f++)if(!map.antiZoomAndPanList.isContained(c.item(f)))for(l=c.item(f).childNodes,m=0;m<l.length;m++)setRotate(l.item(m),(360+Number(e))%360)};ixMap.Layer.prototype.setPatternRotate=function(c,e,f){f||(f=map.SVGRootElement);c=f.getElementsByTagName("pattern");for(f=0;f<c.length;f++)c.item(f).getAttributeNS(null,"id").match(/antizoomandpan/)||setRotate(c.item(f),(360+Number(e))%360,"patternTransform")};ixMap.Layer.prototype.setSymbolRotate=
function(c,e,f){if(c=map.SVGDocument.getElementById("marker_symbols"))for(c=c.childNodes,f=0;f<c.length;f++)if(c.item(f).nodeType==1){var m=c.item(f).getAttributeNS(null,"id");m&&m.length&&!m.match(/antizoomandpan/)&&(setRotate(c.item(f),(360+Number(e))%360),map.Scale.rotatedSymbolsA["#"+m]=!0)}if(c=map.SVGDocument.getElementById("symbolstore"))for(c=c.getElementsByTagName("g"),f=0;f<c.length;f++)(m=c.item(f).getAttributeNS(null,"id"))&&m.length&&m.match(/symbol/)&&!m.match(/antizoomandpan/)&&(setRotate(c.item(f),
(360+Number(e))%360),map.Scale.rotatedSymbolsA["#"+m]=!0);c=map.SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(f=0;f<c.length;f++)m=c.item(f).getAttributeNS(szXlink,"href"),map.Scale.rotatedSymbolsA[m]&&setRotate(c.item(f),(360+Number(-e))%360);c=map.SVGHiddenGroup.getElementsByTagName("use");for(f=0;f<c.length;f++)m=c.item(f).getAttributeNS(szXlink,"href"),map.Scale.rotatedSymbolsA[m]&&setRotate(c.item(f),(360+Number(-e))%360)};ixMap.Layer.prototype.changeObjectRotate=
function(c,e,f){if(f){var m=f.childNodes;for(f=0;f<m.length;f++){var l=getRotateAttributeValue(m.item(f));setRotate(m.item(f),(360+Number(l)+Number(e))%360)}}else for(c=map.Layer.objectGroup.childNodes,f=0;f<c.length;f++)if(!map.antiZoomAndPanList.isContained(c.item(f)))for(m=c.item(f).childNodes,f=0;f<m.length;f++)l=getRotateAttributeValue(m.item(f)),setRotate(m.item(f),(360+Number(l)+Number(e))%360)};ixMap.Layer.prototype.setLabelRotate=function(c,e){var f;c=map.Layer.layerNode.getElementsByTagName("text");
for(f=0;f<c.length;f++)map.antiZoomAndPanList.isContained(c.item(f))||c.item(f).firstChild&&c.item(f).firstChild.nodeName=="textPath"||setRotate(c.item(f),(360+Number(e))%360);this.adaptLabel()};ixMap.Layer.prototype.changeLabelRotate=function(c,e){var f;c=map.Scale.canvasNode.getElementsByTagName("text");for(f=0;f<c.length;f++)if(!(map.antiZoomAndPanList.isContained(c.item(f))||c.item(f).firstChild&&c.item(f).firstChild.nodeName=="textPath")){var m=getRotateAttributeValue(c.item(f));setRotate(c.item(f),
(360+Number(m)+Number(e))%360)}this.adaptLabel()};ixMap.Layer.prototype.adaptLabel=function(c,e){map.fAdaptLabelToScaling&&this.adaptLabelToScaling(c,e);if(map.fCheckLabelOverlap||map.fCheckLabelSpace||map.fCheckLabelSqueeze)e&&this.prepareCheckOverlap(c,e),this.checkLabelOverlapping(c,e)};ixMap.Layer.prototype.adaptLabelToScaling=function(c,e){e||(e=map.SVGRootElement);if(map.fAdaptLabelToScaling||map.fCheckLabelOnlyOne){c=!1;for(var f in map.Layer.listA){var m=map.Layer.listA[f];m.nRenderer&12&&
m.szType=="line"&&m.szDisplayLabel=="inline"&&(c=!0)}if(c){e=e.getElementsByTagName("textPath");if(map.Scale.oldZoomScale!=map.Scale)for(f=0;f<e.length;f++)e.item(f).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||e.item(f).parentNode.style.setProperty("display","none","");map.Label.fAdaptLabelToScalingPending||(map.Label.fAdaptLabelToScalingPending=!0,map.fAdaptLabelToScaling=="delayed"?map.pushAction(()=>{setTimeout(()=>{map.Label.adaptLabelToScaling(null)},1500)}):map.pushAction(()=>
{map.Label.adaptLabelToScaling(null,null)}))}}};ixMap.Layer.prototype.checkLabelOverlapping=function(c,e){if(map.fCheckLabelOverlap||map.fCheckLabelSpace||map.fCheckLabelSqueeze)e||(e=map.Layer.layerNode),e||(e=map.Scale.canvasNode),map.Label.initCheckOverlap(e)};ixMap.Layer.prototype.prepareCheckOverlap=function(c,e){if(map.fCheckLabelOverlap||map.fCheckLabelSpace)e||(e=map.Layer.layerNode),e||(e=map.Scale.canvasNode),map.Label.prepareCheckOverlap(e)};ixMap.Layer.prototype.addChangedFeatureNode=
function(c){var e;if(this.changedFeatureNodesA){for(e=0;e<this.changedFeatureNodesA.length;e++)if(this.changedFeatureNodesA[e]==c)return;this.changedFeatureNodesA[this.changedFeatureNodesA.length]=c}};ixMap.Layer.prototype.isChangedFeature=function(c){var e;if(this.changedFeatureNodesA)for(e=0;e<this.changedFeatureNodesA.length;e++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[e].getAttributeNS(null,"id"))==c)return!0;return!1};ixMap.Layer.prototype.removeChangedFeatures=function(c){var e,f;
if(this.changedFeatureNodesA)for(e=0;e<this.changedFeatureNodesA.length;e++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[e].getAttributeNS(null,"id"))==c){this.changedFeatureNodesA[e].setAttributeNS(null,"style","");for(f=e;f<this.changedFeatureNodesA.length-1;f++)this.changedFeatureNodesA[f]=this.changedFeatureNodesA[f+1];this.changedFeatureNodesA.length--;e--}};ixMap.Layer.prototype.setPointerEvents=function(c){for(var e in map.Layer.listA){var f=map.Layer.listA[e].szName;if(f){var m=map.SVGDocument.getElementById(f);
f=c==null||c==f?null:"none";m&&(f?m.style.setProperty("pointer-events",f,""):m.style.removeProperty("pointer-events"))}}};ixMap.Layer.prototype.getLayerObj=function(c){if(!c)return null;var e=c.split("#")[0].split(":")[0];e=="legend"&&(e=c.split(":")[2]);return this.listA[e]};ixMap.Layer.prototype.getLayerName=function(c){return(c=this.getLayerObj(c))?c.szName:null};ixMap.Layer.prototype.getLayerObjOfNode=function(c){if(c)for(;c.parentNode&&c.parentNode.nodeName!="SVG";){var e=this.getLayerObj(c.getAttributeNS(null,
"id"));if(e)return e;c=c.parentNode}return null};ixMap.Layer.prototype.getLayerItemNodeOfNode=function(c){for(;c.parentNode&&c.parentNode.nodeName!="SVG";){if(this.getLayerObj(c.getAttributeNS(null,"id")))return c;c=c.parentNode}return null};ixMap.Layer.prototype.getLayerItemNodes=function(c){if(c=this.getLayerItemNodeOfNode(c)){var e=c.getAttributeNS(null,"id");return this.getLayerObj(e).szType=="point"&&map.fTileTextNoClip||map.Tiles.getMasterId(e)==e?Array(c):map.Tiles.getTileNodes(map.Tiles.getMasterId(e))}return[]};
ixMap.Layer.prototype.getStyleOrClass=function(c){var e={};e.szClass=map.Dom.getAttributeByNodeOrParents(c,null,"class");e.szStyle=map.Dom.getAttributeByNodeOrParents(c,null,"style");return e};ixMap.Layer.prototype.isMapObject=function(c){for(;c;){if(c==map.Scale.canvasNode)return!0;c=c.parentNode}return!1};ixMap.Layer.prototype.isLoaded=function(c){return(c=this.getLayerObj(c))?c.szFlag.match(/tiled/)?map.Tiles.isAnyLayerTileLoaded():!0:!1};ixMap.Label=function(c){this.document=c?c.target.ownerDocument:
map.SVGDocument;this.checkItemA=[];this.checkOvlA=[];this.nodeA=[];this.boxA=[];this.rootNode=null;this.zoomScale=0;this.fCheckLabelOverlappingPending=!1;this.ALTS_rootNode=this.ALTS_nodeA=this.ALTS_textA=null;this.killProcess=this.fAdaptLabelToScalingPending=!1};ixMap.Label.prototype=new Map;ixMap.Label.Item=function(c){if(c)this.textNode=c,this.szId=c.getAttributeNS(null,"id")||"noId",this.bgNode=map.SVGDocument.getElementById(this.szId+":bg"),this.bbNode=map.SVGDocument.getElementById(this.szId+
":textbg"),this.poNode=map.SVGDocument.getElementById(this.szId.slice(0,this.szId.length-1)),this.poNode||(c=map.Tiles.getMasterId(this.szId),c=c.slice(0,c.length-1),this.poNode=map.SVGDocument.getElementById(c)),this.bBox=null;else return this.szId="mapLabelNullItem",null};ixMap.Label.Item.prototype.setDisplay=function(c){this.textNode.style.setProperty("display",c,"");this.bgNode&&this.bgNode.style.setProperty("display",c,"");this.bbNode&&this.bbNode.style.setProperty("display",c,"");this.poNode&&
this.poNode.nodeName=="use"&&this.poNode.style.setProperty("display",c,"")};ixMap.Label.Item.prototype.setScale=function(c,e){setScale(this.textNode,c,e);this.bgNode&&setScale(this.bgNode,c,e);this.bbNode&&setScale(this.bbNode,c,e)};ixMap.Label.Item.prototype.scaleBackground=function(){if(this.bbNode&&this.textNode){var c=map.Scale.normalX(2)*map.Scale.nZoomScale,e=map.Dom.getBox(this.textNode),f=getTranslateAttributeValue(this.textNode);e.width>0&&e.height>0&&(this.bbNode.setAttributeNS(null,"x",
e.x+(f.x?f.x-c:0)),this.bbNode.setAttributeNS(null,"y",e.y-c+f.y),this.bbNode.setAttributeNS(null,"width",e.width+c*2),this.bbNode.setAttributeNS(null,"height",e.height+c*2))}};ixMap.Label.prototype.stopProcessing=function(){this.killProcess=!0};ixMap.Label.prototype.prepareCheckOverlap=function(c){c=c.getElementsByTagName("text");for(var e=0;e<c.length;e++)c.item(e).firstChild&&c.item(e).firstChild.nodeName!="textPath"&&!c.item(e).getAttributeNS(null,"id").match(/:bg/)&&(new ixMap.Label.Item(c.item(e))).setDisplay("none")};
ixMap.Label.prototype.initCheckOverlap=function(c){this.killProcess=!1;this.fCheckLabelOverlappingPending||(this.fCheckLabelOverlappingPending=!0,this.checkItemA.length=0,this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0,this.rootNode=c,map.fPDFEmbed||!map.Tiles.dataNode?setTimeout(()=>{map.Label.collectCheckOverlap()},0):map.pushAction(()=>{map.Label.collectCheckOverlap()}))};ixMap.Label.prototype.getCheckItem=function(c){return this.checkItemA[c]};ixMap.Label.prototype.getCheckItemCount=
function(){return this.checkItemA.length};ixMap.Label.prototype.addCheckItem=function(c,e){if(c){var f=map.Layer.getLayerObjOfNode(c);if(f&&(!f||c.parentNode.getAttributeNS(null,"id").match(/value/)||f.szDisplayLabel=="inline")&&(map.fCheckLabelOverlap||f.szType=="polygon")&&c.firstChild&&c.firstChild.nodeName!="textPath"&&!c.getAttributeNS(null,"id").match(/:bg/)){var m=getMatrix(c);m=new point(Number(m[4]),Number(m[5]));var l=map.Scale.getMapOffset(c);m.x+=l.x;m.y+=l.y;m.x<this.zoomBox.x||m.x>this.zoomBox.x+
this.zoomBox.width||m.y<this.zoomBox.y||m.y>this.zoomBox.y+this.zoomBox.height||(c=new ixMap.Label.Item(c),c.fRef=f&&f.szType=="polygon"?!0:!1,c.fScale=e,this.checkItemA[this.checkItemA.length]=c)}}else c=new ixMap.Label.Item(null),this.checkItemA[this.checkItemA.length]=c};ixMap.Label.prototype.addCheckItemTheme=function(c,e){if(c.firstChild){e=getMatrix(c);e=new point(Number(e[4]),Number(e[5]));var f=map.Scale.getMapOffset(c);e.x+=f.x;e.y+=f.y;e.x<this.zoomBox.x||e.x>this.zoomBox.x+this.zoomBox.width||
e.y<this.zoomBox.y||e.y>this.zoomBox.y+this.zoomBox.height||(c=new ixMap.Label.Item(c),c.fRef=!1,c.fScale=!1,this.checkItemA[this.checkItemA.length]=c)}};ixMap.Label.prototype.collectCheckOverlap=function(){var c=!1,e=[],f;for(f in map.Layer.listA)map.Layer.listA[f].szType=="polygon"&&e.push(f);map.fCheckOverlapAllLayer||e.push("resetoverlap");for(f in map.Layer.listA)map.Layer.listA[f].szType!="polygon"&&e.push(f);this.zoomBox=map.Zoom.getBox();for(f=e.length-1;f>=0;f--)if(e[f]=="resetoverlap")this.addCheckItem(null);
else{var m=map.Layer.listA[e[f]];if(m.szFlag.match(/tiled/)){if(!c&&(c=!0,m=map.Tiles.getTileInfo())){this.addCheckItem(null);for(var l=0;l<m.length;l++)if(m[l].tileGroup.style.getPropertyValue("display")=="inline"){var h=m[l].tileGroup.getElementsByTagName("text");for(var p=h.length-1;p>=0;p--)h.item(p).parentNode.style.getPropertyValue("display")!="none"&&this.addCheckItem(h.item(p));map.fCheckOverlapClipOnTiles&&this.addCheckItem(null)}}}else if(m.szName){if(l=map.SVGDocument.getElementById(m.szName+
":label"))if((p=l.getElementsByTagName("g"))&&p.length>0)for(var B=0;B<p.length;B++){if(h=p.item(B).getElementsByTagName("text"),h.length)for(l=h.length-1;l>=0;l--)this.addCheckItem(h.item(l))}else if(h=l.getElementsByTagName("text"),h.length)for(l=h.length-1;l>=0;l--)this.addCheckItem(h.item(l));if(l=map.SVGDocument.getElementById(m.szName+":values"))if(h=l.getElementsByTagName("text"),h.length)for(l=h.length-1;l>=0;l--)this.addCheckItem(h.item(l))}}c=map.Themes.getTextObjects();for(l=0;l<c.length;l++)this.addCheckItemTheme(c[l]);
this.zoomScale=map.Scale.nZoomScale;this.checkItemA.length?setTimeout("map.Label.getBoxCheckOverlap(0)",100):this.fCheckLabelOverlappingPending=!1};ixMap.Label.prototype.getBoxCheckOverlap=function(c){var e=new ixMap.Sleep("map.Label.getBoxCheckOverlap",this.nflushLabelDraw,"");for(_STATUS("ixMap.Label: getBoxCheckOverlap ==== "+c+" ====== >>>");c>=0;c++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;break}if(e.checkSleep(c,10))break;var f=this.getCheckItem(c);if(f)if(f.szId==
"mapLabelNullItem"&&map.fCheckOverlapImplicit)this.nodeA.length=0;else try{f.szOldDisplay=f.textNode.style.getPropertyValue("display");f.textNode.style.setProperty("display","inline","");f.setScale(1,1);f.textNode.setAttributeNS(null,"x",0);f.textNode.setAttributeNS(null,"y",0);f.bgNode&&(f.bgNode.style.setProperty("display","inline",""),f.bgNode.setAttributeNS(null,"x",0),f.bgNode.setAttributeNS(null,"y",0));var m=map.Dom.getBox(f.textNode);f.fScale&&(m.x*=map.Layer.nFeatureScale,m.y*=map.Layer.nFeatureScale,
m.width*=map.Layer.nFeatureScale,m.height*=map.Layer.nFeatureScale);var l=map.Scale.getMapOffset(f.textNode);m.x+=l.x;m.y+=l.y;l=getTranslate(f.textNode);m.x+=l.x;m.y+=l.y;if(map.Zoom.isVisibleBox(m)&&this.checkLabelSpace(f,m)){getRotateAttributeValue(f.textNode)>15&&getRotateAttributeValue(f.textNode)<345&&f.setScale(1,1);f.bBox=m;var h=this.nodeA.length;this.checkOvlA[h]=f;this.nodeA[h]=f.textNode;this.boxA[h]=m;map.fCheckLabelOverlap||(f.setDisplay("inline"),f.scaleBackground());map.fCheckOverlapImplicit&&
this.execCheckLabelOverlappingOne(h)}else f.setDisplay("none")}catch(p){}else{map.fCheckOverlapImplicit?this.fCheckLabelOverlappingPending=!1:setTimeout("map.Label.doCheckOverlap()",100);break}}};ixMap.Label.prototype.checkLabelSpace=function(c,e){if(!c.fRef)return!0;if(c.szId.match(/#/)){var f=c.szId.split("#");f=f[0].substr(0,f[0].length-1)+"#"+f[1]}else f=c.szId.substr(0,c.szId.length-1);if(f=map.SVGDocument.getElementById(f))if(c.refBox=map.Dom.getBox(f),f=c.refBox,f.width*=map.nCheckLabelSpace,
e.width>f.width&&map.fAdaptLabelToScaling){var m=1;map.fCheckLabelSqueeze&&(e.width<=f.width*2||!map.fCheckLabelSpace)&&(m=Math.max(.7,f.width/e.width),e.width*=m,c.setScale(m,1));if(map.fCheckLabelSize&&(e.width<=f.width*1.5||!map.fCheckLabelSpace)){var l=Math.max(.7,f.width/e.width);e.width*=l;e.height*=l;c.setScale(m*l,l)}if(!map.fCheckLabelSpace||e.width<=f.width)c.setDisplay("inline");else return c.setDisplay("none"),!1}else c.setDisplay("inline");else c.setDisplay(c.szOldDisplay);return!0};
ixMap.Label.prototype.doCheckOverlap=function(){map.fCheckLabelOverlap?this.nodeA.length>2E4?(this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0):(this.zoomScale=map.Scale.nZoomScale,map.fCheckLabelOverlap=="delayed"?setTimeout(()=>{map.Label.execCheckLabelOverlappingOnly(0)},2E3):map.pushAction(()=>{map.Label.execCheckLabelOverlappingOnly(0)})):this.fCheckLabelOverlappingPending=!1};ixMap.Label.prototype.execCheckLabelOverlappingOnly=function(c){for(var e=new ixMap.Sleep("map.Label.execCheckLabelOverlappingOnly",
25,"");c<this.checkOvlA.length;c++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;return}if(e.checkSleep(c,10))return;this.execCheckLabelOverlappingOne(c)}this.fCheckLabelOverlappingPending=!1};ixMap.Label.prototype.execCheckLabelOverlappingOne=function(c){var e=this.checkOvlA[c];if(map.Zoom.isVisibleBox(e.bBox)){e.refBox||e.setDisplay("inline");if(map.fCheckLabelOverlap)for(var f=e.textNode.firstChild.nodeValue,m=e.bBox,l=Number(e.textNode.getAttributeNS(szMapNs,"pos")),
h=!1,p=0;p<c;p++){var B=this.checkOvlA[p].textNode.firstChild.nodeValue,C=this.checkOvlA[p].bBox;if(map.fCheckLabelOnlyOne&&f==B){B=Number(e.textNode.getAttributeNS(szMapNs,"partlen"));var N=Number(this.checkOvlA[p].textNode.getAttributeNS(szMapNs,"partlen"));if(B>N){this.checkOvlA[p].bBox=null;this.checkOvlA[p].setDisplay("none");continue}e.setDisplay("none");e.bBox=null}if(B=m&&C&&e.textNode!=this.checkOvlA[p].textNode&&map.Tiles.getMasterId(e.szId)!=map.Tiles.getMasterId(this.checkOvlA[p].szId))B=
m&&C?m.x+m.width<C.x||m.x>C.x+C.width||m.y+m.height<C.y||m.y>C.y+C.height?!1:!0:!1;if(B){if(h){C.height<m.height&&(e.refBox||!this.checkOvlA[p].refBox)?(this.checkOvlA[p].bBox=null,map.fKillOverlappingLabel&&this.checkOvlA[p].setDisplay("none")):(e.bBox=null,map.fKillOverlappingLabel&&e.setDisplay("none"));break}if(e.fRef)m.y>C.y?(e.textNode.setAttributeNS(null,"y",m.height),e.bgNode&&e.bgNode.setAttributeNS(null,"y",m.height),m.y+=m.height):(e.textNode.setAttributeNS(null,"y",-m.height),e.bgNode&&
e.bgNode.setAttributeNS(null,"y",-m.height),m.y-=m.height);else if(B=parseInt(e.textNode.style.getPropertyValue("font-size"))||14,m.y>=C.y&&(l===11||l===12||l===1||l===9||l===3||l===0))e.textNode.setAttributeNS(null,"y",B),e.bgNode&&e.bgNode.setAttributeNS(null,"y",B),m.y+=parseInt(B);else if(m.y<=C.y&&(l===7||l===6||l===5||l===9||l===3||l===0))e.textNode.setAttributeNS(null,"y",-m.height),e.bgNode&&e.bgNode.setAttributeNS(null,"y",-m.height),m.y-=m.height;else if(m.x<=C.x&&(l==1||l==3||l==5))e.textNode.setAttributeNS(null,
"x",-(m.width+50*map.Scale.nZoomScale)),e.bgNode&&e.bgNode.setAttributeNS(null,"x",-(m.width+50*map.Scale.nZoomScale)),m.x-=m.width+50*map.Scale.nZoomScale;else if(m.x>=C.x&&(l==11||l==9||l==7))e.textNode.setAttributeNS(null,"x",+(m.width+50*map.Scale.nZoomScale)),e.bgNode&&e.bgNode.setAttributeNS(null,"x",+(m.width+50*map.Scale.nZoomScale)),m.x+=m.width+50*map.Scale.nZoomScale;else if(C.height<m.height&&(e.refBox||!this.checkOvlA[p].refBox)){this.checkOvlA[p].bBox=null;this.checkOvlA[p].setDisplay("none");
continue}h=!0;p=0}}e.bbNode&&e.scaleBackground()}};ixMap.Label.prototype.adaptLabelToScaling=function(c,e){this.killProcess=!1;e||(e=map.SVGRootElement);this.fAdaptLabelToScalingPending=!1;this.ALTS_nodeA=[];this.ALTS_textA=[];this.ALTS_rootNode=e;c=this.ALTS_nodeA;e=null;var f=map.Tiles.getTileInfo();if(f)for(var m=0;m<f.length;m++)if(f[m].tileGroup.style.getPropertyValue("display")=="inline"){e=f[m].tileGroup.getElementsByTagName("textPath");for(var l=0;l<e.length;l++)e.item(l).parentNode.getAttributeNS(null,
"id").match(/:bg/)||e.item(l).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||(c[c.length]=e.item(l))}if(c==null||c.length===0)for(e=map.SVGRootElement.getElementsByTagName("textPath"),m=0;m<e.length;m++)e.item(m).parentNode.getAttributeNS(null,"id").match(/:bg/)||e.item(m).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||(c[c.length]=e.item(m));map.pushAction(()=>{map.Label.execAdaptLabelToScaling(0)})};ixMap.Label.prototype.execAdaptLabelToScaling=function(c){for(var e=
new ixMap.Sleep("map.Label.execAdaptLabelToScaling",25,""),f=this.ALTS_nodeA,m=this.ALTS_rootNode,l;c<f.length&&!e.checkSleep(c,10);c++){var h=f[c].getAttributeNS(szXlink,"href");h=h.substr(1,h.length-1);var p=m.getElementById(h);if(p){var B=p.parentNode.getAttributeNS(null,"id");l=map.Tiles.getMasterId(B);B=map.Tiles.getTileId(B);if(map.Layer.isScaleDependentLayerOn(l)===!1)f[c].parentNode.style.setProperty("display","none","");else if(l=f[c].firstChild.nodeValue,!(this.ALTS_textA[l+B]&&map.Tiles.getTileNodes(map.Tiles.getMasterId(h)).length<=
1)){var C=map.Dom.getBox(p);f[c].setAttributeNS(szXlink,"href","");f[c].parentNode.style.setProperty("display","inline","");f[c].parentNode.style.setProperty("font-stretch","normal","");var N=map.Dom.getBox(f[c].parentNode);f[c].setAttributeNS(szXlink,"href","#"+h);N=Math.sqrt(N.width*N.width+N.height*N.height);var Y=Math.sqrt(C.width*C.width+C.height*C.height),M=f[c].parentNode,w=map.SVGDocument.getElementById(M.getAttributeNS(null,"id")+":bg");w&&w.style.setProperty("display","inline","");if(N*
.9<Y){if(N*1.3<Y?(M.style.setProperty("font-stretch","normal",""),w&&w.style.setProperty("font-stretch","normal","")):(M.style.setProperty("font-stretch","narrower",""),w&&w.style.setProperty("font-stretch","narrower","")),map.fCheckLabelOnlyOne){var J=map.Scale.getMapOffset(p);C.x+=J.x;C.y+=J.y;J=getTranslate(p);C.x+=J.x;C.y+=J.y;p=new box(C.x,C.y,C.width,C.height);p.scale(N/Y,N/Y);map.Zoom.isCompletelyVisibleBox(p)?map.fTileTextNoClip?this.ALTS_textA[l]=h:this.ALTS_textA[l+B]=h:(M.style.setProperty("display",
"none",""),w&&w.style.setProperty("display","none",""))}}else M.style.setProperty("display","none",""),w&&w.style.setProperty("display","none","")}}}};ixMap.Label.prototype.getLabel=function(c){if(!map.SVGDocument.getElementById(c)){var e=map.Tiles.getTileNodes(map.Tiles.getMasterId(c));if(e.length<1)return null;for(var f=0;f<e.length;f++){var m=this.getLabel(e[f].getAttributeNS(null,"id"));if(m)return m}}c=map.SVGDocument.getElementById(c);if(!c)return null;if(c.tagName=="g")for(e=c.childNodes,f=
0;f<e.length;f++)if(e.item(f).nodeType==1){c=e.item(f);break}if(e=c.getAttributeNS(null,"id"))if(e.match(/#/)?(e=e.split("#"),e=map.SVGDocument.getElementById(e[0]+"T#"+e[1])):e=map.SVGDocument.getElementById(e+"T"),e)return e.firstChild.nodeValue;return c.getAttributeNS(szMapNs,"tooltip")};ixMap.Sleep=function(c,e,f){this.szFunction=c;this.initCheckSleep(e,f);this.fShowProgressBar=this.fEnableProgressBar=!1;this.nCount=0;this.szCancel="__cancelSleep()"};ixMap.Sleep.prototype.initCheckSleep=function(c,
e){this.checkSleepMaxCount=c;this.checkSleepCount=0;this.checkSleepMessage=e;this.runningTime=0;this.fShowProgressBar=this.fMessageDisplay=!1;typeof this.checkSleepMessage=="string"&&this.checkSleepMessage.length&&(map.fExecuteSilent||displayMessage(this.checkSleepMessage,1E3));__timer_reset()};ixMap.Sleep.prototype.checkSleep=function(c,e){return this.checkSleepMaxCount&&this.checkSleepCount++>=this.checkSleepMaxCount?(this.checkSleepCount=0,c=this.szFunction+"('"+String(c)+"')",this.fShowProgressBar?
(this.runningTime=__timer_getSEC(),executeWithProgressBar(c,this.nDoneCount,this.nCount,this.checkSleepMessage,this.szCancel,this.runningTime)):(this.fMessageDisplay||(map.fExecuteSilent||displayMessage(this.checkSleepMessage,1E3),this.fMessageDisplay=!0),setTimeout(c,e?e:1)),!0):!1};ixMap.Sleep.prototype.checkSleepMS=function(c,e){return this.checkSleepMaxCount&&__timer_getMS()>this.checkSleepMaxCount?(__timer_reset(),setTimeout(this.szFunction+"('"+String(c)+"')",e?e:1),!0):!1};ixMap.Tiles=function(){var c=
map.SVGDocument.getElementsByTagNameNS(szMapNs,"tiles");c.length&&(this.tilesNode=map.SVGDocument.getElementsByTagNameNS(szMapNs,"maptiles"),this.dataNode=c.item(0),this.nCount=this.dataNode.getAttributeNS(null,"count"),this.tileWidth=this.dataNode.getAttributeNS(null,"width"),this.tileHeight=this.dataNode.getAttributeNS(null,"height"),this.tilesRoot=this.dataNode.getAttributeNS(null,"root").split(".")[0],this.tilesSuffix=this.dataNode.getAttributeNS(null,"root").split(".")[1],this.depUpper=this.dataNode.getAttributeNS(null,
"upper"),this.depLower=this.dataNode.getAttributeNS(null,"lower"),map.fMarkTiles&&this.markTiles(),this.xLoader=null,this.fDiscardPending=!1)};ixMap.Tiles.prototype=new Map;ixMap.Tiles.prototype.getTileNodes=function(c){var e=[];c=this.getTileNodeIds(c);for(var f=0;f<c.length;f++){var m=map.SVGDocument.getElementById(c[f]);m&&(e[e.length]=m)}return e};ixMap.Tiles.prototype.getTileNodeIds=function(c){var e=c.split(":");c=e[0];for(var f="",m=1;m<e.length;m++)f+=":"+e[m];e=[];for(m=0;m<this.nCount;m++)for(var l=
0;l<this.nCount;l++)e[e.length]=c+"#"+this.buildTileExtension(l,m)+f;return e};ixMap.Tiles.prototype.getTilePositions=function(){for(var c=map.Scale.origMinX,e=map.Scale.origMinY,f=[],m=0;m<this.nCount;m++)for(var l=0;l<this.nCount;l++)if(l<this.nCount&&m<this.nCount){var h=new box(c+l*this.tileWidth,e+m*this.tileHeight,this.tileWidth,this.tileHeight);f[f.length]=h}return f};ixMap.Tiles.prototype.getTileBox=function(c){var e=c.split("#")[1];if(e==null||e.length<=0)return null;c=Number(e.substr(0,
3));e=Number(e.substr(3,3));return new box(e*this.tileWidth-map.Scale.mapOffset.x,c*this.tileHeight-map.Scale.mapOffset.x,this.tileWidth,this.tileHeight)};ixMap.Tiles.prototype.getTileInfo=function(){for(var c=map.Scale.origMinX,e=map.Scale.origMinY,f=[],m=1,l=Math.floor(this.nCount/2);l<=this.nCount&&l>=0;){for(var h=1,p=Math.floor(this.nCount/2);p<=this.nCount&&p>=0;){if(p<this.nCount&&l<this.nCount){var B=this.tilesRoot+"_"+this.buildTileExtension(p,l)+"."+this.tilesSuffix,C="tile"+this.buildTileExtension(p,
l),N=map.SVGDocument.getElementById(C),Y=new box(c+p*this.tileWidth,e+l*this.tileHeight,this.tileWidth,this.tileHeight);f[f.length]={szUrl:B,szGroup:C,tileGroup:N,x:p,y:l,bBox:Y};B=this.tilesRoot+"_"+this.buildTileExtension(p,l)+"_ncl."+this.tilesSuffix;C="tile"+this.buildTileExtension(p,l)+":noclip";(N=map.SVGDocument.getElementById(C))&&(f[f.length]={szUrl:B,szGroup:C,tileGroup:N,x:p,y:l,bBox:Y})}p+=h;h=Math.abs(h)+1;(h&1)===0&&(h=-h)}l+=m;m=Math.abs(m)+1;(m&1)===0&&(m=-m)}c=f.length;m=e=0;for(var M in f)f[M].tileGroup&&
(f[M].tileGroup.hasChildNodes()&&e++,f[M].tileGroup.style.getPropertyValue("display")=="inline"&&m++);_STATUS("Tiling: "+c+"/"+e+"/"+m);return f};ixMap.Tiles.prototype.getMasterId=function(c){if(c==null)return null;c=c.split(":");for(var e=c[0].split("#")[0],f=1;f<c.length;f++)e+=":"+c[f];c.length=0;return e};ixMap.Tiles.prototype.getTileId=function(c){if(c==null)return null;c=c.split(":");var e=c[0];c.length=0;return e};ixMap.Tiles.prototype.buildTileExtension=function(c,e){return __maptheme_formatpart(e,
"0")+__maptheme_formatpart(c,"0")};ixMap.Tiles.prototype.setShapeStyle=function(c,e){if(c&&this.nCount&&(c=new MapObject(c),c!=null)){c=this.getMasterId(c.szId);var f=c.split(":")[0];c=c.substr(f.length,c.length-f.length);f=this.getTileNodeIds(f);for(var m=0;m<f.length;m++){var l=map.SVGDocument.getElementById(f[m]+c);l&&l.setAttributeNS(null,"style",e)}}};ixMap.Tiles.prototype.markTiles=function(){var c=map.SVGDocument.getElementById("maptilesbg");if(c)for(var e=0;e<this.nCount;e++)for(var f=0;f<
this.nCount;f++)map.Dom.newShape("rect",c,-this.tileWidth*this.nCount/2+f*this.tileWidth,-this.tileHeight*this.nCount/2+e*this.tileHeight,this.tileWidth,this.tileHeight,"fill:none;stroke:gray;stroke-width:0.01")};ixMap.Tiles.prototype.switchScaleDependentTiles=function(c){if(map.fDynamicTiles&&!this.clearTiles(c)){var e=!1;if(this.nCount>0){getMatrix(map.Zoom.canvasNode);var f=map.Scale.origMinX,m=map.Scale.origMinY,l=map.Zoom.getBox(),h=this.getTileInfo();if(h)for(var p=0;p<h.length;p++){var B=h[p].szUrl,
C=h[p].szGroup,N=h[p].x,Y=h[p].y,M=h[p].bBox,w=h[p].tileGroup;w&&((N=new box(f+N*this.tileWidth,m+Y*this.tileHeight,this.tileWidth,this.tileHeight),N.x==M.x&&N.y==M.y&&N.width==M.width&&N.height==M.height||alert("switchScaleDependentTiles box error !!"),N.x+N.width<l.x||N.y+N.height<l.y||N.x>l.x+l.width||N.y>l.y+l.height)?w.hasChildNodes()&&(w.getAttributeNS(szMapNs,"type")=="external"?(w.style.setProperty("display","none",""),map.fDiscardTiles&&map.fDiscardTiles!="delayed"&&(map.Themes.removeFromThemeNodesCache(w),
map.Dom.clearGroup(w))):w.style.setProperty("display","none","")):w.hasChildNodes()||w.getAttributeNS(szMapNs,"type")!="external"?w.style.getPropertyValue("display")!="inline"&&(w.style.setProperty("display","inline",""),e=!0,map.fAdaptLabelToScaling&&map.Layer.adaptLabelToScaling(c,w)):(w.style.setProperty("display","inline",""),setTimeout("map.Tiles.loadScaleDependentTiles('"+C+"','"+B+"')",10)))}}map.fDiscardTiles=="delayed"&&this.discardTiles();e&&(map.Layer.adaptLabel(c,map.Layer.layerNode),
map.Layer.doStoredFeatureScaling())}};ixMap.Tiles.prototype.loadScaleDependentTiles=function(c,e){_STATUS("Loading Tile:"+e+","+c);c=map.SVGDocument.getElementById(c);this.xLoader||(this.xLoader=new SVGLoaderTiles);this.xLoader.importSVGFile(e,map.SVGDocument,c,null)&&(map.fTilesLoaded=!0)};ixMap.Tiles.prototype.isLoading=function(){return this.xLoader?this.xLoader.isLoading():!1};ixMap.Tiles.prototype.clearTiles=function(c){if(!map.fDynamicTiles)return!1;try{for(var e in map.Layer.listA){var f=map.Layer.listA[e];
if(f.szFlag.match(/tiled/)&&map.Themes.isThemeLayerUsed(f.szName)&&map.Layer.isScaleDependentLayerOn(f.szName))return!1}}catch(l){}if(this.nCount>0){c=1E11;e=0;f=this.depUpper;var m=this.depLower;f&&f.length&&(c=Number(f.split(":")[1]));m&&m.length&&(e=Number(m.split(":")[1]));if(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=e&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=c)return!1;if(c=this.getTileInfo())for(e=0;e<c.length;e++)(f=c[e].tileGroup)&&f.hasChildNodes()&&(f.style.setProperty("display",
"none",""),map.fDiscardTiles&&map.fDiscardTiles!="delayed"&&(map.Themes.removeFromThemeNodesCache(f),map.Dom.clearGroup(f)))}map.fDiscardTiles=="delayed"&&this.discardTiles();return!0};ixMap.Tiles.prototype.discardTiles=function(c){map.fTilesLoaded&&map.fDiscardTiles&&!this.fDiscardPending&&(setTimeout("map.Tiles.doDiscardTiles()",5E3),this.fDiscardPending=!0)};ixMap.Tiles.prototype.doDiscardTiles=function(c){if(map.fDynamicTiles&&map.fTilesLoaded)if(map.mouseObject)setTimeout("map.Tiles.doDiscardTiles()",
6E3);else{if(map.Tiles&&map.Tiles.nCount>0&&(c=map.Tiles.getTileInfo()))for(var e=0;e<c.length;e++){var f=c[e].tileGroup;if(f&&f.style.getPropertyValue("display")=="none"&&f.hasChildNodes()){map.Themes.removeFromThemeNodesCache(f);map.Dom.clearGroup(f);setTimeout("map.Tiles.doDiscardTiles()",2E3);return}}this.fDiscardPending=!1}else this.fDiscardPending=!1};ixMap.Tiles.prototype.isAnyTiledLayerVisible=function(){for(var c in map.Layer.listA){var e=map.Layer.listA[c];if(e.szFlag.match(/tiled/)&&(e.nState===
!0||e.szDisplay!="none"||e.szDisplayLabel!="none"))return!0}return!1};ixMap.Tiles.prototype.allTilesLoaded=function(){var c=this.getTileInfo();if(c){var e=c.length,f=0,m;for(m in c)c[m].tileGroup&&c[m].tileGroup.hasChildNodes()&&f++;return e==f}return!1};ixMap.Tiles.prototype.isAnyLayerTileLoaded=function(c){if(c=this.getTileInfo())for(var e in c)if(c[e].tileGroup&&c[e].tileGroup.hasChildNodes())return!0;return!1};ixMap.Event=function(){this.fPanDone=!1;this.onoverShape=null;this.fMouseDown=!1;this.contextMenuObj=
null;this.onoverPopup=!1;this.tooltipDone=this.popupContextObj=null};ixMap.Event.prototype=new Map;ixMap.Event.prototype.initUseNodes=function(c){if(c&&(c=c.getElementsByTagName("use"))&&c.length)for(var e=0;e<c.length;e++)c.item(e).style.setProperty("pointer-events","none","")};ixMap.Event.prototype.resolveInstance=function(c){if(!c)return null;if(typeof c.nodeType!="undefined")return c;for(;c.parentNode&&c.correspondingUseElement=="undefined";)c=c.parentNode;return c.correspondingUseElement};ixMap.Event.prototype.stopMouseEvent=
function(c){c&&(c.stopPropagation(),c.preventDefault())};ixMap.Event.prototype.defaultMouseOver=function(c){if(c&&c.target){var e=this.resolveInstance(c.target);if(e.nodeType==1){var f=new MapObject(e);if(f&&f.szId&&f.szId.match(/widget/))ua.onMouseOver(c);if(!this.fMouseDown||!this.fMouseDownMoved){if(map.szMapToolType=="idle")try{if(!f){map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();return}var m=f.szId;if(!(m.match(/legend/)||m.match(/tool/)||m.match(/button/)||m.match(/widget/)||m.match(/movable/)||
m.match(/checked/)||m.match(/unchecked/))){map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();return}}catch(p){}map.SVGPopupGroup.fu.isContained(e)||map.SVGFixedGroup.fu.isContained(e)?(this.popupContextObj&&Z(c,this.popupContextObj),this.onoverPopup=!0):this.onoverPopup=!1;if(map.szMapToolType!==""||this.onoverPopup){if(map.szMapToolType=="clickinfo")try{if(f.szId.match(/text/i)&&(f=new MapObject(e.parentNode)),f.szId.match(/:chart:box/i)&&(m=f.szId.split(":chart:box")[0]+":chartgroup",f=new MapObject(f.objNode.ownerDocument.getElementById(m))),
map.szMapToolType="",map.HTMLWindow.ixmaps.htmlgui_onItemClick(c,f.szId))return m=f,m.objNode||(m=new MapObject(m)),m.objNode&&map.highLightList&&!map.highLightList.checkItem(m.objNode)&&(map.highLightList.unlock(),map.highLightList.removeAll(),map.highLightList.addItem(m.objNode,"circle"),map.highLightList.lock()),map.SVGPopupGroup.fu.clear(),killTooltip(),map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle(),null}catch(p){}if(this.onoverPopup||!Z(c,e)||map.szMapToolType!=="info"&&map.szMapToolType!==
"clickinfo"&&map.szMapToolType!==""){if(e)try{var l=e.getAttributeNS(szMapNs,"origstyle");if(!l||l=="null"){var h=e.getAttributeNS(szMapNs,"onoverstyle");h&&(e.setAttributeNS(szMapNs,"origstyle",e.getAttributeNS(null,"style")),e.setAttributeNS(null,"style",h))}}catch(p){}try{if(map.HTMLWindow.ixmaps.htmlgui_onItemOver(c,f.szId))return null}catch(p){}this.tooltipDone=displayTooltip(c,e);this.onoverShape=e}else{try{if(map.HTMLWindow.ixmaps.htmlgui_onItemOver(c,f.szId,e))return map.SVGPopupGroup.fu.clear(),
map.highLightList.unlock(),map.highLightList.removeAll(),map.highLightList.addItem(f.objNode,"scale"),map.highLightList.lock(),map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle(),null}catch(p){}x(c,e,"delayed|pointer");this.onoverShape=e;try{highlightTheme(new MapObject(e))}catch(p){}}try{e.getAttributeNS(null,"id")=="mapbackground:eventrect"&&map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(p){}}}}}};var Z=function(c,e){var f=new MapObject(e);if(f==null)return!1;c=!0;var m=null;f=f.szId;if(f.length===
0||f.match(/legend/)||f.match(/background/)||f.match(/button/)||f.match(/widget/)||f.match(/textgrid/)||map.szMapToolType!="clickinfo"&&map.szMapToolType!="info"&&map.szMapToolType!=="")return map.highLightList&&map.highLightList.removeAll(),!1;if(map.highLightList&&!map.highLightList.checkItem(e)){f=e;f.nodeName!="g"&&(f=f.parentNode);if((f=f.getAttributeNS(null,"id"))&&!f.match(/chartgroup/)&&map._activeTheme!=map.Tiles.getMasterId(f.split(":")[0]))if(map.fHighlightHint)m="hint",c=!1;else return!1;
map.highLightList.removeAll();e=map.Layer.getLayerItemNodes(e);for(f=0;f<e.length;f++)map.highLightList.addItem(e[f],m)}return c};ixMap.Event.prototype.defaultMouseOut=function(c){if(c&&c.target){var e=this.resolveInstance(c.target),f=new MapObject(e);if(f&&f.szId&&f.szId.match(/widget/))ua.onMouseOut(c);if(e)try{var m=e.getAttributeNS(szMapNs,"origstyle");m&&m.length>2&&(e.removeAttributeNS(szMapNs,"origstyle"),e.setAttributeNS(null,"style",m))}catch(l){}this.onoverShape&&setTimeout("_removeInfo()",
1E3);this.onoverShape&&!map._activeItem&&(map.highLightList.removeItem(this.onoverShape),this.onoverShape=null,highlightThemeRemove());killTooltip();y()}};ixMap.Event.prototype.defaultMouseClick=function(c){if(c&&c.target){var e=this.resolveInstance(c.target);if(e&&e.nodeType==1&&(new MapObject(e),e==this.ondownShape))if(this.fMouseDownMoved>5)this.fMouseDownMoved=0;else{var f=e.parentNode;if(f.nodeName=="a"){f=f.getAttributeNS(szXlink,"href");try{map.HTMLWindow.ixmaps.htmlgui_popupWindow(f),this.stopMouseEvent(c)}catch(l){}}var m=
new MapObject(e);if(m!=null){f=m.objNode;m=m.szId;try{if(map.User.onClick(c,m))return null}catch(l){}try{if(map.HTMLWindow.ixmaps.htmlgui_onItemClick(c,m))return null}catch(l){}if(m){if(ua.onClick(c))return;try{m=="mapbackground:eventrect"&&map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(l){}}map.Legend&&map.Legend.legendMouseClick(c,f)?this.stopMouseEvent(c):!f||f.nodeType!=1||!f.parentNode||f.parentNode.nodeType!=1||map.Legend&&map.Legend.legendMouseClick(c,f.parentNode)||!(m=f.parentNode.getAttributeNS(null,
"id"))||m=="PopupGroup"||m.match(/widget/)||!map.fActivateInfoOnClick&&map.szMapToolType!="info"&&map.szMapToolType!="clickinfo"&&map.szMapToolType!==""&&map.szMapToolType!="zoomrect"||(isActiveTheme(map.Layer.getLayerName(m))?(map.SVGPopupGroup.fu.clear(),x(c,e,"add|fix|pointer")):(activateTheme(m.split(":")[0]),map.szMapToolType.match(/select/),map.Zoom.cancel(),this.defaultMouseOver(c),killTooltip()))}}}};ixMap.Event.prototype.defaultMouseDown=function(c){if(c&&c.target&&!map.fInitializing){var e=
this.resolveInstance(c.target);if(c.button==2)this.contextMenuObj=e,this.contextMenuCurrentObj=c.currentTarget,__setContextMenu(c);else if(!c.button||c.button===0){this.fMouseDown=!0;this.ondownShape=e;this.fMouseDownMoved=0;var f=new MapObject(e);if(f!=null){e=f.objNode;f=String(f.szId);try{if(map.User.onMouseDown(c,f))return null}catch(m){}this.stopMouseEvent(c);ua.onMouseDown(c);if(f.match(/movabley/))map.mouseObject=new Aa(c,e,"yonly");else if(f.match(/movablex/))map.mouseObject=new Aa(c,e,"xonly");
else if(f.match(/movable/))map.mouseObject=new Aa(c,e);else if(f.match(/maptoolnode/))S.onMouseDown(c);else if(f.match(/widget/))ua.onMouseDown(c);else f.match(/legend/)?(c=f.split(":"),c.length>2&&e.ownerDocument.getElementById(c[2])&&(c[1]=="minus"&&setTimeout("__opacityMinus('"+c[2]+"')",200),c[1]=="plus"&&setTimeout("__opacityPlus('"+c[2]+"')",200))):(c.shiftKey||c.altKey||c.crtlKey||!map.Layer.isMapObject(e)||map.szMapToolType&&map.szMapToolType!==""&&new ja(c,map.szMapToolType),c.shiftKey&&
!c.altKey&&!c.crtlKey&&map.Layer.isMapObject(e)&&(map.szMapToolType===""?new ja(c,"pan"):new ja(c,map.szMapToolType)),!map.fTriggerMouseMoveForPan||f.match(/legend/)||f.match(/tool/)||f.match(/button/)||f.match(/widget/)||f.match(/movable/)||f.match(/checked/)||f.match(/unchecked/)||map.szMapToolType!="info"&&map.szMapToolType!==""||(this.triggerMoveForPan=!0))}}}};ixMap.Event.prototype.defaultMouseUp=function(c){if(c&&c.target&&!map.fInitializing){this.stopMouseEvent(c);try{if(map.User.onMouseUp(c))return null}catch(e){}this.fMouseDown=
!1;if(map.mouseObject){try{map.mouseObject.onMouseUp(c)}catch(e){}map.mouseObject=null}ua.onMouseUp(c);this.triggerMoveForPan=!1}};ixMap.Event.prototype.defaultMouseMove=function(c){if(c&&c.target&&!map.fInitializing){var e=this.resolveInstance(c.target);this.triggerMoveForPan&&this.fMouseDownMoved&&(new ja(c,"pan"),this.triggerMoveForPan=!1);if(!map.mouseObject)try{var f=(new MapObject(e)).objNode.getAttributeNS(null,"id");if(!(f.match(/legend/)||f.match(/tool/)||f.match(/button/)||f.match(/widget/)||
f.match(/movable/)||f.match(/checked/)||f.match(/unchecked/)||map.szMapToolType!="idle"&&f!="mapbackground:eventrect")){setTimeout("map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()",1E3);return}}catch(m){}this.stopMouseEvent(c);if(map.mouseObject)try{map.mouseObject.onMouseMove(c)}catch(m){}this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null));this.fMouseDownMoved+=this.fMouseDown?1:0;ua.onMouseMove(c)}};var W=!1,Q=null;ixMap.Event.prototype.defaultKeyDown=function(c){!c||W||!c.shiftKey||c.altKey||
c.crtlKey||(Q=map.szMapToolType,map.szMapToolType=="pan"?pa("zoomrect"):map.szMapToolType=="zoomrect"?pa("pan"):map.szMapToolType=="info"&&pa("pan"),W=!0)};ixMap.Event.prototype.defaultKeyUp=function(c){!c||!W||c.shiftKey||c.altKey||c.crtlKey||(pa(Q),W=!1)};ixMap.Event.prototype._checkSignificantViewChange=function(){var c={changed:!1,zoomChanged:!1,panChanged:!1};c.zoomChanged=map.Scale.oldZoomScale!=map.Scale.nZoomScale;if(c.zoomChanged)return c.changed=!0,c;if(!(map.Scale.szMapProjection||"").match(/albers|lambert|orthographic/i))return c;
try{if(!map.Scale.oldMapCenter||!map.Scale.mapCenter)return c;var e=map.Scale.getGeoCoordinateOfPoint(map.Scale.oldMapCenter.x,map.Scale.oldMapCenter.y),f=map.Scale.getGeoCoordinateOfPoint(map.Scale.mapCenter.x,map.Scale.mapCenter.y);if(e&&f){var m=Math.abs(e.y-f.y),l=Math.abs(e.x-f.x);l>180&&(l=360-l);if(m>.5||l>.5)c.panChanged=!0,c.changed=!0}}catch(h){map.Scale.oldMapCenter&&map.Scale.mapCenter&&(Math.abs(map.Scale.oldMapCenter.x-map.Scale.mapCenter.x)>50||Math.abs(map.Scale.oldMapCenter.y-map.Scale.mapCenter.y)>
50)&&(c.panChanged=!0,c.changed=!0)}return c};ixMap.Event.prototype.doDefaultZoom=function(c){if(!map.fFroozeDynamicContent){map.SVGNotifyGroup.fu.clear();try{map.Themes.getTheme().unlabelMap()}catch(p){}map.showMap();var e=map.SVGRootElement.getAttribute("viewBox").split(" "),f=map.SVGOrigViewBoxString.split(" ");f=1/(Number(f[2])/Number(e[2]));if(e=map.Scale.zoomNode){var m=getMatrix(e);f/=m[0]}map.Scale.oldZoomScale=map.Scale.nZoomScale;map.Scale.oldMapCenter=map.Scale.mapCenter;if(map.Scale.nZoomScale!=
f){map.Dom.clearGroup(map.SVGToolsGroup);map.Dom.clearGroup(map.SVGFixedGroup);map.removeAllHighlights();map.Api.clearHighlight();map.Api.clearAllOverlays();try{map.HTMLWindow.ixmaps.htmlgui_onItemClick(c,"mapbackground:eventrect")}catch(p){}}map.Scale.nZoomScale=f;map.Scale.mapCenter=new point(m[4],m[5]);if(map.fPanByViewer===!1){if(map.SVGRootElement.currentTranslate.x!==0||map.SVGRootElement.currentTranslate.y!==0){e=map.Scale.zoomNode;m=getMatrix(e);f=m[0];var l=m[3],h=map.Scale.rotatePoint(map.SVGRootElement.currentTranslate);
map.SVGRootElement.currentTranslate.x=h.x;map.SVGRootElement.currentTranslate.y=h.y;h=m[4]+map.Scale.scaleX(map.SVGRootElement.currentTranslate.x);m=m[5]+map.Scale.scaleY(map.SVGRootElement.currentTranslate.y);e.setAttributeNS(null,"transform","matrix("+f+" 0 0 "+l+" "+h+" "+m+")");map.Scale.mapCenter=new point(h,m);map.SVGRootElement.currentTranslate.x=0;map.SVGRootElement.currentTranslate.y=0}}else{if(m=map.SVGDocument.getElementById("mapcliprect"))m.setAttributeNS(null,"x",map.Scale.scaleX(-map.SVGRootElement.currentTranslate.x)),
m.setAttributeNS(null,"y",map.Scale.scaleY(-map.SVGRootElement.currentTranslate.y)),m.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),m.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()));if(m=map.SVGDocument.getElementById("mapbackground:eventrect"))m.setAttributeNS(null,"x",map.Scale.scaleX(-map.SVGRootElement.currentTranslate.x)),m.setAttributeNS(null,"y",map.Scale.scaleY(-map.SVGRootElement.currentTranslate.y)),m.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),
m.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()))}c&&map.antiZoomAndPanList.adjustGroups(c);Math.abs(map.Scale.oldZoomScale-map.Scale.nZoomScale)>map.Scale.oldZoomScale/100?(map.fFeatureScaling=="delayed"?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(c,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&map.fDynamicLayer=="delayed"?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):
map.Layer.switchScaleDependentLayer(c),A(c)):map.fDynamicTiles=="delayed"?setTimeout("map.Layer.doStoredFeatureScaling()",500):map.Layer.doStoredFeatureScaling(c);map.fDynamicTiles=="delayed"?setTimeout("map.Tiles.switchScaleDependentTiles(null)",500):map.Tiles.switchScaleDependentTiles(c);if(this.fFrozenDynamicContent||map.Scale.oldZoomScale!=map.Scale.nZoomScale||Math.abs(map.Scale.oldMapCenter.x-map.Scale.mapCenter.x)>10||Math.abs(map.Scale.oldMapCenter.y-map.Scale.mapCenter.y)>10){try{map.HTMLWindow.ixmaps.htmlgui_onZoomAndPan(map.Scale.nZoomScale)}catch(p){}map.fDynamicTiles==
"delayed"||map.fDynamicLayer=="delayed"?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);if(this.fFreezeDynamicContent)this.fFrozenDynamicContent=!0;else try{this.fFrozenDynamicContent?(map.Themes.actualizeActiveTheme(.99),this.fFrozenDynamicContent=!1):map.Scale.oldZoomScale!=map.Scale.nZoomScale?map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/map.Scale.nZoomScale):setTimeout("map.Themes.actualizeActiveTheme("+map.Scale.oldZoomScale/map.Scale.nZoomScale+")",
10)}catch(p){}try{map.HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK"))}catch(p){}}map.zoomAndPanHistory.newItem();map.Scale.refreshCSSStyles()}};ixMap.Event.prototype.doPrintZoom=function(c){map.Scale.nZoomScale/=5;map.Scale.oldZoomScale!=map.Scale.nZoomScale?(map.fFeatureScaling=="delayed"?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(c,map.Scale.nZoomScale),
map.Scale.oldZoomScale>map.Scale.nZoomScale&&map.fDynamicLayer=="delayed"?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(c),A(c)):map.fDynamicTiles=="delayed"?setTimeout("map.Layer.doStoredFeatureScaling()",500):map.Layer.doStoredFeatureScaling(c);map.fDynamicTiles=="delayed"?setTimeout("map.Tiles.switchScaleDependentTiles(null)",500):map.Tiles.switchScaleDependentTiles(c);if(map.Scale.oldZoomScale!=map.Scale.nZoomScale||map.Scale.oldMapCenter.x!=map.Scale.mapCenter.x||
map.Scale.oldMapCenter.y!=map.Scale.mapCenter.y){map.fDynamicTiles=="delayed"||map.fDynamicLayer=="delayed"?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);try{map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/map.Scale.nZoomScale)}catch(e){}}try{map.HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK")),map.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(map.Zoom.getEnvelopeString(),map.Scale.oldZoomScale!=
map.Scale.nZoomScale)}catch(e){}map.Scale.refreshCSSStyles()};ixMap.Event.prototype.doDefaultResize=function(c){map&&map.Layer&&(map.Layer.switchScaleDependentLayer(c),A(c))};ixMap.Event.prototype.doDefaultPan=function(c){c&&!map.mouseObject&&(map.antiZoomAndPanList.adjustGroups(c),map.Event.fPanDone=!0)};ixMap.Event.prototype.doDefaultAdjustPan=function(c){this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null))};ixMap.Event.prototype.moveToFrontOfGroup=function(c){c&&c.currentTarget&&c.currentTarget.parentNode&&
c.currentTarget!=c.currentTarget.parentNode.lastChild&&c.currentTarget.parentNode.appendChild(c.currentTarget)};Ga.prototype.add=function(c){this.historyPointer=this.itemA.length;this.itemA[this.itemA.length]=c};Ga.prototype.newItem=function(){this.fSuspend?this.fSuspend=!1:this.add(new t)};Ga.prototype.backwards=function(){this.historyPointer>0&&(this.fSuspend=!0,this.itemA.length=this.historyPointer,this.historyPointer--,this.itemA[this.historyPointer].exec())};Ga.prototype.forwards=function(){this.historyPointer<
this.itemA.length-1&&(this.fSuspend=!0,this.historyPointer++,this.itemA[this.historyPointer].exec())};Ga.prototype.clear=function(){this.itemA.length=0};t.prototype.exec=function(){try{var c=this.szEnvelope.split("="),e=c[1].split("'")[1],f=c[2].split("'")[1],m=c[3].split("'")[1],l=c[4].split("'")[1];map.Zoom.doZoomMapToEnvelope(e,f,m,l)}catch(h){alert("History Item not valid")}};var xa=function(c,e,f,m,l,h,p){e&&f&&f.length>2&&(this.szId=f+":movable",this.objectNode=map.Dom.newGroup(e,this.szId),
this.ptPosition=m,this.ptOffsetOrig=new point(l.x,l.y),this.ptOffset=l,this.szMode=h,this.szTitle=p,this.nFontheight=14,this.onRemove="",this.fClipped=!0,this.create())};xa.prototype.create=function(){this.ptPosition||(this.ptPosition=new point(1E3,1E3));this.ptOffset||(this.ptOffset=new point(100,100));this.szMode||(this.szMode="");this.szMode.match(/left/)&&(this.ptOffset.x=-(this.ptOffset.x*2),this.ptOffset.y*=3);this.frameNode=map.Dom.newShape("rect",this.objectNode,0,0,map.Scale.normalX(10),
map.Scale.normalY(10),"fill:#ffffff;stroke:black;stroke-width:"+map.Scale.normalX(0));this.frameNode.setAttributeNS(null,"rx",map.Scale.normalX(map.nInfoRoundRect*2));this.frameNode.setAttributeNS(null,"ry",map.Scale.normalX(map.nInfoRoundRect*2));map.SVGDocument.getElementById(map.szShadowFilterToolsId)&&this.frameNode.style.setProperty("filter","url(#"+map.szShadowFilterToolsId+")","");this.canvasNode=map.Dom.newGroup(this.objectNode,this.szId+":canvas");this.canvasNode.fu.setPosition(map.Scale.normalX(1),
map.Scale.normalY(1));this.titleNode=map.Dom.newGroup(this.objectNode,this.szId+":title");this.titleTextNode=map.Dom.newGroup(this.titleNode,this.szId+":titletext");this.szTitle&&map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),map.Scale.normalY(this.nFontheight+10),"font-family:arial;font-size:"+map.Scale.normalY(this.nFontheight/4*3)+"px;fill:black;pointer-events:none",this.szTitle);this.scrollObj=new Ba(null,this.canvasNode,null,10,10,10),this.scrollObj.reformat(),this.workspaceNode=this.scrollObj.workspaceNode;
this.workspaceNode||(this.scrollObj=null,this.workspaceNode=map.Dom.newGroup(this.canvasNode,this.szId+":workspace"),this.workspaceClipRect=map.Dom.setClipRect(this.workspaceNode,new box(0,0,10,10)));this.objectNode.setAttributeNS(null,"onclick","map.Event.moveToFrontOfGroup(evt)");this.objectNode.setAttributeNS(null,"ontouchend","map.Event.moveToFrontOfGroup(evt)");this.szMode.match(/fix/)?(this.deleteButton=new Oa(this.titleNode,this.szId,"BUTTON","#delete_button","map.Dom.removeElementById('"+
this.szId+"');","remove"),this.deleteButton.scale(1,1),this.deleteButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10))):this.szMode.match(/pin/)&&map.SVGDocument.getElementById("pin_button")&&(this.pinButton=new Oa(this.titleNode,this.szId,"BUTTON","#pin_button","doDisplayInfo("+this.ptPosition.x+","+this.ptPosition.y+",'pointer|fix');","","fix it"),this.pinButton.scale(1,1),this.pinButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10)));this.widgetObj=new sa(this.objectNode,this)};
xa.prototype.setTitle=function(c,e){e||(e=map.Scale.tStyle.ContainerTitle);map.Dom.clearGroup(this.titleTextNode);(this.szTitle=c)&&map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),e.nFontHeight*1.3,e.szStyle,this.szTitle);this.reformat()};xa.prototype.reformat=function(){this.bBox=map.Dom.getBox(this.workspaceNode);this.tBox=map.Dom.getBox(this.titleTextNode);this.bBox.height<0&&(this.bBox.height=0);this.bBox.width<0&&(this.bBox.width=0);this.tBox.height<0&&(this.tBox.height=0);if(this.bBox.width!==
0&&this.bBox.height!==0||this.szTitle&&this.szTitle.length){this.bBox.height==1&&(this.bBox.height=-200);var c=map.Scale.normalX(15+map.Scale.nButtonSize);if(this.fClipped){c=Math.min(Math.max(this.bBox.width+c,this.tBox.width+c),map.Scale.bBox.width/2);var e=Math.min(this.bBox.height+this.tBox.height,map.Scale.bBox.height/2.4)}else c=Math.max(this.bBox.width+c,this.tBox.width+c),e=this.bBox.y+this.bBox.height+this.tBox.height+map.Scale.normalY(10);e>map.Scale.bBox.height/4*5&&(c=Math.min(this.bBox.width+
map.Scale.normalX(10)+map.Scale.normalY(10),map.Scale.bBox.width/2.4));c>map.Scale.bBox.width/4*5&&(e=Math.min(this.bBox.height+this.tBox.height+map.Scale.normalY(10),map.Scale.bBox.height/2.4));this.scrollObj?(this.scrollObj.setWidth(c/map.Scale.normalX(1)-1),this.scrollObj.setHeight(e/map.Scale.normalY(1)),this.scrollObj.reformat(),this.scrollObj.hasScrollBars()?(e<this.bBox.height+map.Scale.normalX(this.scrollObj.nScrollBarWidth)&&(this.scrollObj.setHeight(e/map.Scale.normalY(1)+this.scrollObj.nScrollBarWidth+
6),this.scrollObj.reformat(),e+=map.Scale.normalY(this.scrollObj.nScrollBarWidth+1)),this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(8)+this.tBox.height),c+=map.Scale.normalX(10)+map.Scale.normalX(7),e+=map.Scale.normalY(2)+map.Scale.normalY(10)+map.Scale.normalY(5)+this.tBox.height*2):(this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(10)+this.tBox.height*1.3),e+=map.Scale.normalY(10)+this.tBox.height-map.Scale.normalY(7))):(this.workspaceClipRect.setAttributeNS(null,
"width",c),this.workspaceClipRect.setAttributeNS(null,"height",e));var f=map.Scale.tStyle.ContainerTitle;f=map.Scale.normalY(map.Scale.nButtonSize/3)+f.nFontHeight/2;var m=map.Scale.normalY(map.Scale.nButtonSize/3);this.pinButton?this.pinButton.setPosition(c-m,f):this.deleteButton?this.deleteButton.setPosition(c-m,f):c-=map.Scale.normalX(map.Scale.nButtonSize);this.bBox.width=c;this.bBox.height=e;this.frameNode&&(this.frameNode.setAttributeNS(null,"width",this.bBox.width+map.Scale.normalX(5)*2),this.frameNode.setAttributeNS(null,
"height",this.bBox.height+map.Scale.normalX(5)));this.shadowNode&&(this.shadowNode.setAttributeNS(null,"width",this.bBox.width+map.Scale.normalX(5)*2+map.Scale.normalX(.5)),this.shadowNode.setAttributeNS(null,"height",this.bBox.height+map.Scale.normalX(5)+map.Scale.normalY(1)));c=map.Scale.getGroupOffset(this.objectNode);this.newPosition=map.Scale.clipWidgetObjectToSVG(this.objectNode,new point(this.ptPosition.x+c.x,this.ptPosition.y+c.y),this.ptOffsetOrig,this.bBox);this.newPosition.x-=c.x;this.newPosition.y-=
c.y;this.objectNode.fu.setPosition(this.newPosition.x,this.newPosition.y);this.ptOffset.x=this.newPosition.x-this.ptPosition.x;this.ptOffset.y=this.newPosition.y-this.ptPosition.y;this.szMode.match(/pointer/)&&this.makePointer()}else this.remove()};xa.prototype.makePointer=function(){map.Scale.normalX(15);var c=map.Scale.normalX(10);map.Scale.normalX(5);this.pointerObj?(map.Dom.clearGroup(this.pointerObj),map.Dom.clearGroup(this.pointShObj)):(this.pointerObj=map.Dom.newGroup(this.objectNode),this.pointShObj=
map.Dom.newGroup(this.objectNode),this.pointShObj.parentNode.insertBefore(this.pointShObj,this.pointShObj.parentNode.firstChild));if(!(this.ptOffset.y<0&&this.ptOffset.y>-this.bBox.height&&this.ptOffset.x<0&&this.ptOffset.x>-this.bBox.width)){var e=this.ptOffset.y+this.bBox.height/2;var f=this.ptOffset.x+this.bBox.width/2;Math.abs(e)+this.bBox.width/2-this.bBox.height/2>Math.abs(f)?(f=0,this.ptOffset.x>-c*2&&(f=this.ptOffset.x+c*2),this.ptOffset.x<-this.bBox.width+c*2&&(f=this.ptOffset.x+this.bBox.width-
c*2),e>0?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(f-map.Scale.normalX(8))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(f-map.Scale.normalX(7.5))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+
-this.ptOffset.y+" l "+(f-map.Scale.normalX(8))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(f-map.Scale.normalX(7.5))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white"))):(e=0,this.ptOffset.y>-c*2&&(e=this.ptOffset.y+c*2),this.ptOffset.y<-this.bBox.height+c*2&&(e=this.ptOffset.y+
this.bBox.height-c*2),f>0?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(e-map.Scale.normalX(8))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(e-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+
","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(e-map.Scale.normalX(8))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(e-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white")))}};xa.prototype.onMouseMove=function(){if(this.fMouseDown){var c=this.objectNode.fu.getPosition();this.ptOffset.x+=
c.x-this.beforeMovePosition.x;this.ptOffset.y+=c.y-this.beforeMovePosition.y;this.beforeMovePosition=this.objectNode.fu.getPosition();this.szMode.match(/pointer/)&&this.makePointer()}};xa.prototype.onMouseUp=function(){var c=this.objectNode.fu.getPosition();this.ptOffset.x+=c.x-this.beforeMovePosition.x;this.ptOffset.y+=c.y-this.beforeMovePosition.y;this.fMouseDown=!1;this.szMode.match(/pointer/)&&this.makePointer()};xa.prototype.onMouseDown=function(){this.beforeMovePosition=this.objectNode.fu.getPosition();
this.fMouseDown=!0};xa.prototype.setOnRemove=function(c){this.deleteButton&&this.deleteButton.buttonNode&&this.deleteButton.setActionOn("map.Dom.removeElementById('"+this.szId+"');"+c)};xa.prototype.remove=function(){this.objectNode.parentNode.removeChild(this.objectNode);this.objectNode=null};xa.prototype.clear=function(){map.Dom.clearGroup(this.workspaceNode)};var Aa=function(c,e,f,m){e&&(this.objNode=e,this.objNode.fu=new Methods(this.objNode),this.objStartPosition=this.objNode.fu.getPosition(),
this.szFlag=f?f:"",this.parent=m);this.mouseStartPosition=c?map.Scale.getClientMousePosition(c,this.objNode):new point(0,0)};Aa.prototype.onMouseMove=function(c){var e=map.Scale.getClientMousePosition(c,this.objNode);try{if(map.User.onMouseMove(c,this.objNode.getAttributeNS(null,"id"),e))return null}catch(m){}switch(this.szFlag){case "yonly":e.x=this.mouseStartPosition.x;break;case "xonly":e.y=this.mouseStartPosition.y}if(this.objNode&&!this.szFlag.match(/parentonly/)){var f=this.objNode.fu.getScale();
this.objNode.fu.setPosition(this.objStartPosition.x+(e.x-this.mouseStartPosition.x)/f.x,this.objStartPosition.y+(e.y-this.mouseStartPosition.y)/f.y)}if(this.parent)this.parent.onMouseMove(c)};Aa.prototype.onMouseUp=function(c){if(this.parent)this.parent.onMouseUp(c)};var Oa=function(c,e,f,m,l,h,p){this.targetGroup=c;this.szId=e?e:"button:"+String(Math.random());this.szType=f?f:"SIMPLE";this.szStyle=m?m:"";this.szActionOn=l;this.szActionOff=h;this.szTooltip=p?p:"";this.draw()};Oa.prototype.draw=function(c){!this.szType.match(/SELECTED/)||
this.szType.match(/CHECKBOX/)?(this.nodeObj=map.Dom.newGroup(this.targetGroup),this.nodeObj.setAttributeNS(null,"cursor","pointer"),c=map.Dom.constructNode("a",this.nodeObj,{}),this.shapeObj=map.Dom.newGroup(c)):this.shapeObj=this.nodeObj=map.Dom.newGroup(this.targetGroup);this.nodeObj.setAttributeNS(null,"id",this.szId+":button");if(this.szType.match(/CHECKBOX/)){c=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#unchecked_button"});var e=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#checked_button"});
c.setAttributeNS(null,"id",this.szId+":unchecked");e.setAttributeNS(null,"id",this.szId+":checked");this.szType.match(/SELECTED/)&&(this.checked=!0);this.szType.match(/SELECTED/)||(this.checked=!1,e.style.setProperty("display","none",""));c=map.Dom.newShape("rect",this.shapeObj,map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(map.Scale.nButtonSize),map.Scale.normalX(map.Scale.nButtonSize),"fill:red;fill-opacity:0");c.setAttributeNS(null,"id",
this.szId+":widget:eventrect");c.setAttributeNS(szMapNs,"tooltip",this.szTooltip);c.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)");new sa(c,this)}else if(this.szType.match(/TEXTBUTTON/)){e=this.szStyle;c=map.Scale.normalY(map.Scale.nButtonSize*.6);var f="font-family:arial;font-size:"+c+"px;fill:#444444;baseline-shift:-30%;pointer-events:none",m=c/2*e.length;this.szType.match(/SELECTED/)?m=map.Dom.newShape("rect",this.shapeObj,-c/5,-c/3*2,m,c/5*6,"fill:#eeeeff;stroke:black;stroke-width:"+
map.Scale.normalX(1)+";stroke-opacity:0.3"):(m=map.Dom.newShape("rect",this.shapeObj,-c/5,-c/3*2,m,c/5*6,"fill:white;stroke:none;opacity:0"),m.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),m.setAttributeNS(null,"onmouseout","map.Event.stopMouseEvent(evt)"),m.setAttributeNS(null,"onclick",this.szActionOn),m.setAttributeNS(null,"ontouchend",this.szActionOn),m.setAttributeNS(szMapNs,"tooltip",this.szTooltip));e=map.Dom.newText(this.shapeObj,0,0,f,e);this.bBox=new box(-c/5,-c/3*2,e.getComputedTextLength()+
c/5*2,c/5*6);m.setAttributeNS(null,"width",String(this.bBox.width));this.buttonNode=m}else this.szType.match(/BUTTON/)&&(c=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":this.szStyle}),c.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),c.setAttributeNS(null,"onmousedown","map.Event.stopMouseEvent(evt)"),c.setAttributeNS(null,"onclick",this.szActionOn),c.setAttributeNS(null,"ontouchend",this.szActionOn),c.setAttributeNS(szMapNs,"tooltip",this.szTooltip),this.buttonNode=c)};
Oa.prototype.scale=function(c,e){this.nodeObj&&this.nodeObj.fu.scale(c,e)};Oa.prototype.setPosition=function(c,e){this.nodeObj&&this.nodeObj.fu.setPosition(c,e)};Oa.prototype.getPosition=function(c,e){if(this.nodeObj)return this.nodeObj.fu.getPosition()};Oa.prototype.remove=function(){this.nodeObj&&this.nodeObj.parentNode.removeChild(this.nodeObj)};Oa.prototype.setActionOn=function(c){this.szActionOn=c;this.buttonNode&&(this.buttonNode.setAttributeNS(null,"onclick",this.szActionOn),this.buttonNode.setAttributeNS(null,
"ontouchend",this.szActionOn))};Oa.prototype.onClick=function(c){this.toggleCheckBox(c);map.Event.stopMouseEvent(c)};Oa.prototype.toggleCheckBox=function(c){c=map.SVGDocument.getElementById(this.szId+":checked");this.checked?(c.style.setProperty("display","none",""),eval(this.szActionOff)):(c.style.setProperty("display","inline",""),eval(this.szActionOn));this.checked=!this.checked};var aa=function(c,e,f,m,l,h){c&&(this.hBar=this.vBar=0,this.vScale=this.hScale=1,this.maxBox=f,this.bWidth=m,this.bHeight=
l,this.hThumb=f.width,this.vThumb=f.height,this.vValue=this.hValue=this.vThumbOffset=this.hThumbOffset=0,this.contObj=c,this.contBox=c=map.Dom.getBox(c),this.contObj.fu=new Methods(this.contObj),c.width+c.x<=f.width-f.x+1&&c.height+c.y<=f.height-f.y+1||(c.width+c.x>f.width-f.x&&(this.hBar=l),c.height+c.y>f.height-f.y-this.hBar&&(this.vBar=m),c.width+c.x>f.width-f.x-this.vBar&&(this.hBar=l),this.vBar&&(this.maxBox.width-=this.vBar+h),this.hBar&&(this.maxBox.height-=this.hBar+h),this.hMax=this.maxBox.width-
this.hBar*2,this.vMax=this.maxBox.height-this.vBar*2,this.hScale=(c.width+c.x)/this.maxBox.width,this.vScale=(c.height+c.y)/this.maxBox.height,this.hScale>1&&(this.hThumb=Math.floor(this.hMax/this.hScale),this.hThumbOffset=Math.min(this.hMax-this.hThumb,-(e.x/this.hScale)),this.hValue=-e.x/(c.width+c.x-this.maxBox.width)),this.vScale>1&&(this.vThumb=Math.floor(this.vMax/this.vScale),this.vThumbOffset=Math.min(this.vMax-this.vThumb,-(e.y/this.vScale)),this.vValue=-e.y/(c.height+c.y-this.maxBox.height)),
this.hThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.3)+";opacity:0.3",this.vThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalY(.3)+";opacity:0.3"))};aa.prototype.draw=function(c){if(this.contObj){var e="fill:white;stroke:black;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0",f="fill:#e8e8f8;stroke:white;stroke-width:"+map.Scale.normalX(.5)+";opacity:1.0";map.Scale.normalX(2);var m="fill:white;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.2)+
";opacity:1.0";this.remove(c);if(this.hScale!=1||this.vScale!=1){c=map.Dom.newGroup(this.contObj.parentNode);c.setAttributeNS(null,"id","scrollwidget");this.scrollWidget=c;this.vScale>1&&this.hScale>1&&map.Dom.newShape("rect",c,this.maxBox.width,this.maxBox.height,this.bWidth+map.Scale.normalX(1),this.bHeight+map.Scale.normalX(1),e);if(this.hScale>1){map.Dom.newShape("rect",c,this.bWidth,this.maxBox.height,this.hMax,this.bHeight+map.Scale.normalX(.8),m);if(e=map.Dom.newShape("rect",c,this.bWidth,
this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepleft"),new sa(e,this);if(e=map.Dom.newShape("rect",c,this.bWidth+this.hMax/2,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepright"),new sa(e,this);e=map.Dom.newShape("rect",c,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.hThumb-map.Scale.normalX(2)),Math.max(2,this.bHeight-
map.Scale.normalY(2)),this.hThumbStyle?this.hThumbStyle:f);e.fu.setPosition(this.bWidth,this.maxBox.height);this.hThumbObj=new ca(e,new box(0,0,this.hMax-this.hThumb,0));this.hThumbObj.parent=this;this.hThumbObj.setValue(new point(this.hValue,0))}if(this.vScale>1){map.Dom.newShape("rect",c,this.maxBox.width+map.Scale.normalX(2),this.bHeight,this.bWidth-map.Scale.normalX(2),this.vMax,m);if(e=map.Dom.newShape("rect",c,this.maxBox.width,this.bHeight,this.bWidth,this.vMax/2,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,
"id","widget:scrollbar:bigstepup"),new sa(e,this);if(e=map.Dom.newShape("rect",c,this.maxBox.width,this.bHeight+this.vMax/2,this.bWidth,this.vMax/2,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepdown"),new sa(e,this);e=map.Dom.newShape("rect",c,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.bWidth-map.Scale.normalX(2)),Math.max(2,this.vThumb-map.Scale.normalY(2)),this.vThumbStyle?this.vThumbStyle:f);e.fu.setPosition(this.maxBox.width,this.bHeight);
this.vThumbObj=new ca(e,new box(0,0,0,this.vMax-this.vThumb));this.vThumbObj.parent=this;this.vThumbObj.setValue(new point(0,this.vValue))}}else this.contObj.fu.setPosition(0,0)}};aa.prototype.hasScrollBars=function(c){return this.vScale>1||this.hScale>1};aa.prototype.onMouseDown=function(c){};aa.prototype.onMouseMove=function(c){var e=c=0;this.hScale>1&&(c=this.hThumbObj.fraction.x);this.vScale>1&&(e=this.vThumbObj.fraction.y);this.contObj.fu.setPosition(-c*(this.contBox.x+this.contBox.width-this.maxBox.width),
-e*(this.contBox.y+this.contBox.height-this.maxBox.height))};aa.prototype.onMouseUp=function(c){};aa.prototype.onClick=function(c){c=(new MapObject(c.target)).szId;var e=c.match(/big/)?map.Scale.normalX(100):map.Scale.normalX(5);c.match(/stepdown/)?this.vThumbObj.moveThumb(0,e):c.match(/stepup/)?this.vThumbObj.moveThumb(0,-e):c.match(/stepleft/)?this.hThumbObj.moveThumb(-e,0):c.match(/stepright/)&&this.hThumbObj.moveThumb(e,0)};aa.prototype.remove=function(c){this.scrollWidget&&this.scrollWidget.parentNode.removeChild(this.scrollWidget)};
var ca=function(c,e,f,m,l){this.szId=null;this.moveArea=e;this.scaleArea=f;this.value=new point(0,0);this.fraction=new point(0,0);this.onUp=this.onMove=null;l&&(this.valuesA=l.split(","));this.objNode=c;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));c.fu=new Methods(c);this.ptNull=c.fu.getPosition();ua.add(this)};ca.prototype.setMoveArea=function(c){this.moveArea=c};ca.prototype.setId=function(c){this.szId=c};ca.prototype.onMouseOver=function(c){if(this.parent)try{this.parent.onMouseOver(c,
this.szId,this)}catch(e){}};ca.prototype.onMouseOut=function(c){if(this.parent)try{this.parent.onMouseOut(c,this.szId,this)}catch(e){}};ca.prototype.onMouseDown=function(c){map.mouseObject=this.moveArea.width===0?new Aa(c,this.objNode,"yonly"):this.moveArea.height===0?new Aa(c,this.objNode,"xonly"):new Aa(c,this.objNode,null);map.mouseObject.parent=this;if(this.parent)try{this.parent.onMouseDown(c,this.szId,this)}catch(e){}};ca.prototype.onMouseMove=function(c){var e=this.objNode.fu.getPosition();
e.x=Math.min(e.x,this.ptNull.x+this.moveArea.x+this.moveArea.width);e.x=Math.max(e.x,this.ptNull.x+this.moveArea.x);e.y=Math.min(e.y,this.ptNull.y+this.moveArea.y+this.moveArea.height);e.y=Math.max(e.y,this.ptNull.y+this.moveArea.y);this.objNode.fu.setPosition(e.x,e.y);this.value=new point(0,0);this.moveArea.width>0&&(this.value.x=e.x-this.ptNull.x,this.fraction.x=this.value.x/this.moveArea.width);this.moveArea.height>0&&(this.value.y=e.y-this.ptNull.y,this.fraction.y=this.value.y/this.moveArea.height);
if(this.parent)try{this.parent.onMouseMove(c,this.szId,this)}catch(f){}};ca.prototype.onMouseUp=function(c){if(this.parent)try{this.parent.onMouseUp(c,this.szId,this)}catch(e){}};ca.prototype.moveThumb=function(c,e){var f=this.objNode.fu.getPosition();f.x+=c;f.y+=e;this.objNode.fu.setPosition(f.x,f.y);this.onMouseMove()};ca.prototype.setValue=function(c){this.objNode.fu.setPosition(c.x*this.moveArea.width+this.ptNull.x,c.y*this.moveArea.height+this.ptNull.y);this.onMouseMove()};ca.prototype.remove=
function(){ua.removeWidget(this)};var X=function(c,e,f,m,l,h){this.circlethumb=map.Dom.newGroup(c.parentNode,"widget:rotationslider:thumb");this.circlethumb.setAttributeNS(null,"area","-1000,-1000,1000,1000");this.circlethumb.setAttributeNS(null,"range",f);this.circlethumb.setAttributeNS(null,"scale",m);this.nStep=l;this.nSnap=h;this.pBase=c.fu.getPosition();this.circlethumb.fu.setPosition(this.pBase.x,this.pBase.y);this.circlethumbNode=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(5),
"fill:#ff0000;opacity:0.0;pointer-events:none");this.circleOverNode2=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(6),"fill:none;stroke:#ffffff;stroke-width:"+map.Scale.normalX(11)+";opacity:0.6;pointer-events:none;display:none");this.circleOverNode=map.Dom.newShape("path",this.circlethumb,"M-"+map.Scale.normalX(5.5)+",0 a"+map.Scale.normalX(6)+","+map.Scale.normalX(6)+" 0 1,0 "+map.Scale.normalX(5)+","+-map.Scale.normalX(5),"fill:none;stroke:#888888;stroke-width:"+map.Scale.normalX(1)+
";opacity:0.8;pointer-events:none;display:none");setRotate(this.circleOverNode,45);setRotate(this.circleOverNode2,45);e=map.Dom.newNode("defs",this.circlethumb);e=map.Dom.newNode("marker",e);e.setAttributeNS(null,"id","Triangle");e.setAttributeNS(null,"refX","0");e.setAttributeNS(null,"refY","0");e.setAttributeNS(null,"orient","auto");e.setAttributeNS(null,"style","overflow:visible");e.setAttributeNS(null,"path","M 0 0 L "+map.Scale.normalX(10)+" "+map.Scale.normalX(5)+" L 0 "+map.Scale.normalX(10)+
" z");this.circleOverNode.style.setProperty("marker-start","url(#Triangle)","");this.circleOverNode.style.setProperty("marker-end","url(#Triangle)","");this.objNode=c;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));ua.add(this);this.isActive=!1};X.prototype.setValue=function(c){setRotate(this.objNode,c)};X.prototype.onMouseOver=function(c){this.circleOverNode.style.setProperty("display","inline","");this.circleOverNode2.style.setProperty("display","inline","");if(this.parent)try{this.parent.onMouseOver(c)}catch(e){}};
X.prototype.onMouseOut=function(c){this.isActive||(this.circleOverNode.style.setProperty("display","none",""),this.circleOverNode2.style.setProperty("display","none",""));if(this.parent)try{this.parent.onMouseOut(c)}catch(e){}};X.prototype.onMouseDown=function(c){var e=map.Scale.getClientMousePosition(c,map.SVGToolsGroup);this.startPosition=new point(e.x-this.pBase.x,e.y-this.pBase.y);this.circlethumbNode.fu.setPosition(this.startPosition.x,this.startPosition.y);map.mouseObject=new Aa(c,this.circlethumbNode);
map.mouseObject.parent=this;this.isActive=!0;if(this.parent)try{this.parent.onMouseDown(c)}catch(f){}};X.prototype.onMouseMove=function(c){if(this.isActive&&(setRotate(this.objNode,this.getAngle()),this.parent))try{this.parent.onMouseMove(c)}catch(e){}};X.prototype.onMouseUp=function(c){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");if(this.parent){try{this.parent.onMouseUp(c)}catch(e){}this.objNode.style.setProperty("opacity",
"1.0","")}};X.prototype.onClick=function(c){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");setRotate(this.objNode,0);if(this.parent){try{this.parent.onClick(c)}catch(e){}this.objNode.style.setProperty("opacity","1.0","")}};X.prototype.getAngle=function(c){var e=this.circlethumbNode.fu.getPosition();c=e.x;e=e.y;var f=Math.asin(c/Math.sqrt(c*c+e*e))/Math.PI*180;f=isNaN(f)?180:f;c>=0&&e>=0&&(f=180-f);c<0&&e>=0&&
(f=180-f);c<0&&e<0&&(f=360+f);this.nStep&&this.nSnap&&(f%this.nStep<this.nSnap?(f=Math.floor(f/this.nStep)*this.nStep,this.objNode.style.setProperty("opacity","1.0","")):this.objNode.style.setProperty("opacity","0.5",""));return f};var ba=function(){this.widgetA=[]};ba.prototype.add=function(c){this.widgetA[this.widgetA.length]=c};ba.prototype.getWidget=function(c){for(var e in this.widgetA)if(this.widgetA[e].objNode==c)return this.widgetA[e];return null};ba.prototype.onMouseOver=function(c){var e=
new MapObject(c.target);e=this.getWidget(e.objNode);try{e.onMouseOver(c)}catch(f){}try{e.owner.onMouseOver(c)}catch(f){}};ba.prototype.onMouseOut=function(c){var e=new MapObject(c.target);e=this.getWidget(e.objNode);try{e.onMouseOut(c)}catch(f){}try{e.owner.onMouseOut(c)}catch(f){}};ba.prototype.onMouseDown=function(c){var e=new MapObject(c.target);e=this.getWidget(e.objNode);try{e.onMouseDown(c)}catch(f){}try{e.owner.onMouseDown(c)}catch(f){}};ba.prototype.onMouseUp=function(c){var e=new MapObject(c.target);
e=this.getWidget(e.objNode);try{e.onMouseUp(c)}catch(f){}try{e.owner.onMouseUp(c)}catch(f){}};ba.prototype.onMouseMove=function(c){var e=new MapObject(c.target);e=this.getWidget(e.objNode);try{e.onMouseMove(c)}catch(f){}try{e.owner.onMouseMove(c)}catch(f){}};ba.prototype.onClick=function(c){var e=new MapObject(c.target);if(e=this.getWidget(e.objNode)){try{e.onClick(c)}catch(f){}try{e.owner.onClick(c)}catch(f){}return!0}return!1};ba.prototype.removeWidget=function(c){for(var e=0;e<this.widgetA.length;e++)if(this.widgetA[e].objNode==
c){for(;e<this.widgetA.length-1;e++)this.widgetA[e]=this.widgetA[e+1];this.widgetA.length--}};ba.prototype.clear=function(){this.widgetA.length=0};var sa=function(c,e){this.objNode=c;this.owner=e;ua.add(this)};sa.prototype.remove=function(){ua.removeWidget(this)};var ua=new ba;ba=function(){this.toolsA=[]};ba.prototype.add=function(c,e){e&&e<this.toolsA.length-1?this.toolsA.splice(e,0,c):this.toolsA[this.toolsA.length]=c};ba.prototype.getMapTool=function(c){for(var e in this.toolsA)if(this.toolsA[e].objNode==
c.parentNode)return this.toolsA[e];return null};ba.prototype.removeMapTool=function(c){for(var e=0;e<this.toolsA.length;e++)if(this.toolsA[e].objNode==c.parentNode){for(this.toolsA[e].remove();e<this.toolsA.length-1;e++)this.toolsA[e]=this.toolsA[e+1];this.toolsA.length--;this.toolsA.length&&this.toolsA[0].redraw()}};ba.prototype.clear=function(){this.toolsA.length=0};ba.prototype.onMouseDown=function(c){var e=new MapObject(c.target),f=S.getMapTool(e.objNode);f&&(map.mouseObject=new Aa(c,e.objNode,
"parentonly",f),map.mouseObject.parent=f)};var S=new ba,ja=function(c,e,f){this.nFontSize=14;this.szLineStyle="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";opacity:1.0;";this.szLineStyleLite="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(.75)+";opacity:1.0;";this.szLineBgStyle="fill:none;stroke:white;stroke-width:"+map.Scale.normalX(5)+";opacity:0.5;";this.szFillBgStyle="fill:white;stroke:none;opacity:0.6";this.szTextStyle="font-family:arial;font-size:"+map.Scale.normalY(this.nFontSize)+
"px;fill:darkblue;pointer-events:none;";this.szPolylineStyle="fill:none;stroke:blue;stroke-width:"+map.Scale.normalX(2.5)+";stroke-opacity:0.5;";this.szPolygonStyle="fill:blue;stroke:black;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szBufferStyle="fill:blue;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szType=e;this.objNode=map.Dom.newGroup(map.SVGToolsGroup,e+String(Math.random()));var m=this.szPolygonStyle;switch(e){case "coord":map.mouseObject=
new Aa(c,null,"parentonly");map.mouseObject.parent=this;m=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",m,-map.Scale.normalX(this.nFontSize*.3),0,1,1,this.szFillBgStyle);map.Dom.newText(m,0,0,this.szTextStyle,"");map.Dom.newText(m,0,0,this.szTextStyle,"");m=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");m.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",m,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);
map.Dom.newShape("line",m,-map.Scale.normalX(10),0,map.Scale.normalX(10),0,this.szLineStyleLite);map.Dom.newShape("line",m,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",m,0,0,map.Scale.normalX(3.7),this.szLineStyle);m.fu.setPosition(map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y);this.redraw();break;case "polyline":m=this.szPolylineStyle;case "polygon":map.mouseObject=new Aa(c,null,"parentonly");map.mouseObject.parent=this;
c=map.SVGDocument.getElementById("maptools_polypath");c==null&&(c=map.Dom.newNode("path",map.SVGToolsGroup),c.setAttributeNS(null,"id","maptools_polypath"),c.setAttributeNS(szMapNs,"menu","polygonmenu"),c.setAttributeNS(null,"style",m),c.parentNode.insertBefore(c,this.objNode),S.toolShape=c);m=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");m.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",m,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",
m,-map.Scale.normalX(10),0,map.Scale.normalX(10),0,this.szLineStyleLite);map.Dom.newShape("line",m,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",m,0,0,map.Scale.normalX(3.7),this.szLineStyle);m.fu.setPosition(map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y);break;case "measurement":case "measurebuffer":case "selectbuffer":map.mouseObject=new Aa(c,null);map.mouseObject.parent=this;map.Dom.newShape("circle",this.objNode,map.mouseObject.mouseStartPosition.x,
map.mouseObject.mouseStartPosition.y,map.Scale.normalX(1),this.szLineBgStyle);map.Dom.newShape("circle",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(1),this.szType=="measurebuffer"||this.szType=="selectbuffer"?this.szBufferStyle:this.szLineStyle);map.Dom.newShape("line",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,this.szLineBgStyle);
map.Dom.newShape("line",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,this.szLineStyle);m=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",m,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y-map.Scale.normalY(5)-map.Scale.normalY(this.nFontSize*7/7),1E3,map.Scale.normalY(this.nFontSize*1.3),this.szFillBgStyle);map.Dom.newText(m,
map.mouseObject.mouseStartPosition.x+map.Scale.normalX(5),map.mouseObject.mouseStartPosition.y-map.Scale.normalY(5),this.szTextStyle,"test");m=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random()));map.Dom.newShape("circle",m,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",m,map.mouseObject.mouseStartPosition.x-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x+
map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",m,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",m,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);m=map.Dom.newGroup(this.objNode,"startpoint"+
String(Math.random()));map.Dom.newShape("circle",m,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",m,map.mouseObject.mouseStartPosition.x-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x+map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",m,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y-
map.Scale.normalX(10),map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",m,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);break;case "zoomrect":case "selectrect":map.mouseObject=new Aa(c,null);map.mouseObject.parent=this;map.Dom.newShape("rect",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,10,10,this.szLineBgStyle);
map.Dom.newShape("rect",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,10,10,this.szLineStyle);break;case "pan":map.mouseObject=new Aa(c,null),map.mouseObject.parent=this,this.beginPan(c)}this.mapToolList=S;S.add(this,f)};ja.prototype.onMouseDown=function(c){var e=new MapObject(c.target);map.mouseObject=new Aa(c,e.objNode);map.mouseObject.parent=this};ja.prototype.onMouseMove=function(c){var e=map.Scale.getClientMousePosition(c,map.SVGToolsGroup),f=e.x-map.mouseObject.mouseStartPosition.x,
m=e.y-map.mouseObject.mouseStartPosition.y;switch(this.szType){case "coord":c=this.objNode.childNodes;var l=0;c.item(l++);f=c.item(l++);e=map.Scale.clipWidgetPositionToMap(e);f.fu.setPosition(e.x,e.y);this.redraw();break;case "measurement":case "measurebuffer":case "selectbuffer":c=this.objNode.childNodes;l=0;var h=c.item(l++),p=c.item(l++),B=c.item(l++),C=c.item(l++),N=c.item(l++);c=c.item(l++);h.setAttributeNS(null,"r",String(Math.sqrt(f*f+m*m)));p.setAttributeNS(null,"r",String(Math.sqrt(f*f+m*
m)));B.setAttributeNS(null,"x2",String(e.x));B.setAttributeNS(null,"y2",String(e.y));C.setAttributeNS(null,"x2",String(e.x));C.setAttributeNS(null,"y2",String(e.y));c.fu.setPosition(f,m);N.fu.setPosition(f/2,m/2);f=N.firstChild;m=f.nextSibling;e=map.Scale.getDistanceInMeter(map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,e.x,e.y);m.firstChild.nodeValue=map.Scale.formatDistanceString(e);e=map.Dom.getBox(m);f.setAttributeNS(null,"width",e.width+e.height*.7);break;case "zoomrect":case "selectrect":c=
this.objNode.childNodes;l=0;e=c.item(l++);c=c.item(l++);e.setAttributeNS(null,"width",String(Math.max(1,f)));e.setAttributeNS(null,"height",String(Math.max(1,m)));c.setAttributeNS(null,"width",String(Math.max(1,f)));c.setAttributeNS(null,"height",String(Math.max(1,m)));break;case "pan":map.fPDFEmbed||!map.fPanToolByViewer?(map.Zoom.doPanMap(f/map.Scale.normalX(1),m/map.Scale.normalY(1)),map.mouseObject.mouseStartPosition.x=e.x,map.mouseObject.mouseStartPosition.y=e.y):(e=map.Scale.getClientMousePosition(c,
null),f=e.x-map.mouseObject.mouseStartPosition.x,m=e.y-map.mouseObject.mouseStartPosition.y,map.Zoom.doPanMapByViewer(f/map.Scale.normalX(1),m/map.Scale.normalY(1)));break;case "polyline":case "polygon":this.objNode.firstChild.fu.setPosition(e.x,e.y),this.redraw()}};ja.prototype.onMouseUp=function(c){switch(this.szType){case "coord":this.redraw();break;case "polyline":case "polygon":this.redraw();break;case "pan":displayMessage("please wait ...",500);setTimeout("map.Event.doDefaultZoom(null)",map.fPanToolByViewer?
5:200);this.endPan(c);break;case "measurement":case "measurebuffer":var e=this.objNode.childNodes;var f=0;this.szType=="measurement"&&(c=e.item(f++),f=e.item(f++),c.parentNode.removeChild(c),f.parentNode.removeChild(f));break;case "selectbuffer":e=this.objNode.childNodes;f=0;e.item(f++);f=e.item(f++);c=f.parentNode.getAttributeNS(null,"id")+":shape";f.setAttributeNS(null,"id",c);(c=map.Selections.newSelection("activeLayer",c,"type:circle"))?c.mapTool=this:this.remove();break;case "selectrect":e=this.objNode.childNodes;
f=0;e.item(f++);f=e.item(f++);c=f.parentNode.getAttributeNS(null,"id")+":shape";f.setAttributeNS(null,"id",c);(c=map.Selections.newSelection("activeLayer",c,"type:square"))?c.mapTool=this:this.remove();break;case "zoomrect":e=this.objNode.childNodes,f=0,c=e.item(f++),c=map.Dom.getBox(c),this.objNode.parentNode.removeChild(this.objNode),map.Zoom.doZoomMapToWidgetRect(c),pa("")}};ja.prototype.beginPan=function(c){map.fFroozeDynamicContent=!0};ja.prototype.endPan=function(c){map.fFroozeDynamicContent=
!1};ja.prototype.doEndPan=function(c){map.fFroozeDynamicContent=!1};ja.prototype.hideTools=function(c){this.toolsHidden&&this.toolsHidden!==!1||(map.antiZoomAndPanList.setDisplay(c,"none"),this.toolsHidden=!0)};ja.prototype.showTools=function(c){this.toolsHidden===!0&&(map.antiZoomAndPanList.setDisplay(c,"inline"),this.toolsHidden=!1)};ja.prototype.hideLayer=function(c){for(var e in map.Layer.listA)if(c=map.Layer.listA[e],c.szFlag.match(/invisiblepan/)){if(map.Tiles&&map.Tiles.nCount>0)for(var f=
map.Tiles.getTileNodeIds(e),m=0;m<f.length;m++){var l=f[m],h=map.SVGDocument.getElementById(l);h&&(c.szBeforeHideStyle=h.style.getPropertyValue("display"),h.style.setProperty("display","none",""));if(h=map.SVGDocument.getElementById(l+":label"))c.szBeforeHideLabelStyle=h.style.getPropertyValue("display"),h.style.setProperty("display","none","");if(h=map.SVGDocument.getElementById(l+":label:bg"))c.szBeforeHideLabelStyle=h.style.getPropertyValue("display"),h.style.setProperty("display","none","")}if(h=
map.SVGDocument.getElementById(e))c.szBeforeHideStyle=h.style.getPropertyValue("display"),h.style.setProperty("display","none","");if(h=map.SVGDocument.getElementById(e+":label"))c.szBeforeHideLabelStyle=h.style.getPropertyValue("display"),h.style.setProperty("display","none","");if(h=map.SVGDocument.getElementById(e+":label:bg"))c.szBeforeHideLabelStyle=h.style.getPropertyValue("display"),h.style.setProperty("display","none","")}};ja.prototype.showLayer=function(c){for(var e in map.Layer.listA)if(c=
map.Layer.listA[e],c.szFlag.match(/invisiblepan/)){if(map.Tiles&&map.Tiles.nCount>0)for(var f=map.Tiles.getTileNodeIds(e),m=0;m<f.length;m++){var l=f[m],h=map.SVGDocument.getElementById(l);h&&(c.szBeforeHideStyle.length?h.style.setProperty("display",c.szBeforeHideStyle,""):h.style.removeProperty("display"));(h=map.SVGDocument.getElementById(l+":label"))&&(c.szBeforeHideLabelStyle.length?h.style.setProperty("display",c.szBeforeHideLabelStyle,""):h.style.removeProperty("display"));(h=map.SVGDocument.getElementById(l+
":label:bg"))&&(c.szBeforeHideLabelStyle.length?h.style.setProperty("display",c.szBeforeHideLabelStyle,""):h.style.removeProperty("display"))}(h=map.SVGDocument.getElementById(e))&&(c.szBeforeHideStyle.length?h.style.setProperty("display",c.szBeforeHideStyle,""):h.style.removeProperty("display"));(h=map.SVGDocument.getElementById(e+":label"))&&(c.szBeforeHideLabelStyle.length?h.style.setProperty("display",c.szBeforeHideLabelStyle,""):h.style.removeProperty("display"));(h=map.SVGDocument.getElementById(e+
":label:bg"))&&(c.szBeforeHideLabelStyle.length?h.style.setProperty("display",c.szBeforeHideLabelStyle,""):h.style.removeProperty("display"))}};ja.prototype.redraw=function(c){switch(this.szType){case "polygon":var e=map.SVGDocument.getElementById("maptools_polypath");if(e==null)break;var f=[],m=this.mapToolList.toolsA,l="",h=m[0].objNode.firstChild;h.fu=new Methods(h);h=h.fu.getPosition();f[f.length]=h;l+="M"+h.x+","+h.y;for(var p=1;p<m.length;p++)h=m[p].objNode.firstChild,h.fu=new Methods(h),h=
h.fu.getPosition(),f[f.length]=h,l+=" "+h.x+","+h.y;e.setAttributeNS(null,"d",l+"z");(l=map.SVGDocument.getElementById("maptools_phantomPointGroup"))?map.Dom.clearGroup(l):l=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(p=0;p<f.length;p++){m=f[p].x+(f[p<f.length-1?p+1:0].x-f[p].x)/2;h=f[p].y+(f[p<f.length-1?p+1:0].y-f[p].y)/2;var B=map.Dom.newShape("circle",l,m,h,map.Scale.normalX(10),"fill:white;stroke:none;opacity:0.1;");map.Dom.newShape("circle",l,m,h,map.Scale.normalX(2),this.szPolygonStyle+
"pointer-events:none;");B.setAttributeNS(szMapNs,"tooltip","click to add point");B.setAttributeNS(null,"onmousedown","new MapTool(evt,'polygon',"+(p+1)+")")}(l=map.Dom.getObjectById("maptools_polygon_text"))?map.Dom.clearGroup(l):l=map.Dom.newGroup(map.SVGToolsGroup,"maptools_polygon_text");p=__doGetPolygonCenter(f);e=Math.abs(__doGetPolygonSurface(f,!0));f=new Ja(c,l,"maptooltext_template",18);f.setText(map.Scale.formatSurfaceString(e));c=f.textGroup.fu.getBox();f.setPosition(p.x-c.width/2,p.y-c.height/
2);break;case "polyline":m=map.SVGDocument.getElementById("maptools_polypath");if(m==null)break;f=[];e=this.mapToolList.toolsA;l="";h=e[0].objNode.firstChild;h.fu=new Methods(h);h=h.fu.getPosition();f[f.length]=h;l+="M"+h.x+","+h.y;for(p=1;p<e.length;p++)h=e[p].objNode.firstChild,h.fu=new Methods(h),h=h.fu.getPosition(),l+=" "+h.x+","+h.y,f[f.length]=h;m.setAttributeNS(null,"d",l);(l=map.SVGDocument.getElementById("maptools_phantomPointGroup"))?map.Dom.clearGroup(l):l=map.Dom.newGroup(this.objNode,
"maptools_phantomPointGroup");for(p=0;p<f.length-1;p++)m=f[p].x+(f[p+1].x-f[p].x)/2,h=f[p].y+(f[p+1].y-f[p].y)/2,B=map.Dom.newShape("circle",l,m,h,map.Scale.normalX(2),this.szPolygonStyle),B.setAttributeNS(szMapNs,"tooltip","click to add point"),B.setAttributeNS(null,"onmousedown","new MapTool(evt,'polyline',"+(p+1)+")");(l=map.SVGDocument.getElementById("maptools_polyline_textgroup"))?map.Dom.clearGroup(l):l=map.Dom.newGroup(this.objNode,"maptools_polyline_textgroup");m=0;for(p=1;p<e.length;p++){f=
e[p].objNode.firstChild;h=e[p-1].objNode.firstChild.fu.getPosition();var C=f.fu.getPosition();m+=B=map.Scale.getDistanceInMeter(h.x,h.y,C.x,C.y);f=new Ja(c,l,"maptooltext_template",12);f.setText(map.Scale.formatDistanceString(B));f.setPosition(h.x+(C.x-h.x)/2,h.y+(C.y-h.y)/2)}C=e[e.length-1].objNode.firstChild.fu.getPosition();f=new Ja(c,l,"maptooltext_template",18);f.setText(map.Scale.formatDistanceString(m));f.setPosition(C.x+map.Scale.normalX(5),C.y);f.textGroup.setAttributeNS(szMapNs,"menu","polylinemenu");
break;case "coord":e=this.objNode.childNodes,p=0,c=e.item(p++),p=e.item(p++).fu.getPosition(),e=c.firstChild,f=e.nextSibling,l=f.nextSibling,m=map.Scale.getMapPosition(p.x,p.y),m=map.Scale.getMapCoordinate(m.x,m.y),m=map.Scale.getGeoCoordinateOfPoint(m.x,m.y),h="Y="+String(m.y),f.firstChild.nodeValue="X="+String(m.x),l.firstChild.nodeValue=h,m=map.Dom.getBox(f),h=map.Dom.getBox(l),f.setAttributeNS(null,"y",Number(m.height)),l.setAttributeNS(null,"y",Number(m.y)+Number(m.height)+Number(h.height)+map.Scale.normalY(3)),
e.setAttributeNS(null,"width",m.width+map.Scale.normalY(8)),e.setAttributeNS(null,"height",Number(m.height)+Number(h.height)+map.Scale.normalY(12)),p=new point(p.x,p.y),e=new point(map.Scale.normalX(5),map.Scale.normalY(5)),p=map.Scale.clipWidgetObjectToMap(c,p,e),c.fu.setPosition(p.x,p.y)}};ja.prototype.remove=function(c){this.objNode.parentNode.removeChild(this.objNode)};ja.prototype.printPolygon=function(c){(c=map.SVGDocument.getElementById("maptools_polygon"))&&alert(printNode(c))};var pa=function(c){c==
"info"&&map.szMapToolType=="info"&&deactivateTheme(map._activeTheme);c=="pan"&&deactivateTheme(map._activeTheme);killTooltip();y();map.Dom.clearGroup(map.SVGMenuGroup);map.Dom.clearGroup(map.SVGToolsGroup);S.clear();map.szMapToolType=c;map.fPDFEmbed&&map.fSetToolCursor&&setTimeout("setMapToolCursor('"+c+"')",100);try{map.HTMLWindow.ixmaps.htmlgui_setMapTool(c)}catch(e){}},Ja=function(c,e,f,m){(c=map.SVGDocument.getElementById(f))?(this.textGroup=e.appendChild(c.cloneNode(1E3)),this.textGroup.fu=new Methods(this.textGroup),
this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.textGroup.setAttributeNS(null,"id",f+String(Math.random())),e=this.textGroup.getElementsByTagName("rect"),f=this.textGroup.getElementsByTagName("text"),e.length>1?(this.sdNode=e.item(0),this.bgNode=e.item(1)):this.bgNode=e.item(0),this.textNode=f.item(0),m&&this.textNode.style.setProperty("font-size",String(m)+"px",""),this.textNode.parentNode==this.textGroup?(this.workspaceNode=map.Dom.newGroup(this.textGroup,"workspace:"+String(Math.random())),
this.textGroup.insertBefore(this.workspaceNode,this.textNode),this.workspaceNode.appendChild(this.textNode)):this.workspaceNode=this.textNode.parentNode):f=="flat"?(this.textGroup=map.Dom.newGroup(e,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),map.fMapBorder3D&&map.SVGDocument.getElementById(map.szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,
"rx",map.nInfoRoundRect*m/6),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect*m/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:#888888;stroke-width:2;"),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect*m/6),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect*m/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+m+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,
"opacity","0.7")):f=="light"?(this.textGroup=map.Dom.newGroup(e,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),map.fMapBorder3D&&map.SVGDocument.getElementById(map.szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect*m/6),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect*m/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,
0,0,1,1,"fill:#fdfdfd;stroke:#888888;stroke-width:0.1;opacity:1;"),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect*m/6),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect*m/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+m+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.95")):f=="alert"?(this.textGroup=map.Dom.newGroup(e,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),
map.Scale.normalY(1)),this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#666666;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.Scale.normalY(.1)),this.sdNode.setAttributeNS(null,"ry",map.Scale.normalY(.1)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#F9EDB8;stroke:#EDC967;stroke-width:1;opacity:1"),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+m+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode):
(this.textGroup=map.Dom.newGroup(e,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.5;stroke:none"),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:blue;stroke-width:0.1"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect),
this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+m+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode,f=="transparent"&&(this.textGroup.setAttributeNS(null,"opacity","0.4"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect*5),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect*5),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect*5),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect*
5)))};Ja.prototype.setText=function(c){try{return this.textNode.firstChild.nodeValue=c,this.resizeField(),!0}catch(e){return!1}};Ja.prototype.resizeField=function(){try{var c=map.Dom.getBox(this.workspaceNode);this.bgNode&&(this.bgNode.setAttributeNS(null,"x",c.x-12),this.bgNode.setAttributeNS(null,"y",c.y-4),this.bgNode.setAttributeNS(null,"width",c.width+24),this.bgNode.setAttributeNS(null,"height",c.height+10));this.sdNode&&(this.sdNode.setAttributeNS(null,"x",c.x-6+1),this.sdNode.setAttributeNS(null,
"y",c.y-3+2),this.sdNode.setAttributeNS(null,"width",c.width+12+1),this.sdNode.setAttributeNS(null,"height",c.height+6+1))}catch(e){}};Ja.prototype.setPosition=function(c,e){this.textGroup.fu.setPosition(c,e)};var Ba=function(c,e,f,m,l,h){this.nMaxWidth=m?m:100;this.nMaxHeight=l?l:100;this.nScrollBarWidth=h?h:10;e!=null&&(c=":"+String(Math.random()),(m=map.SVGDocument.getElementById(f))?(this.areaGroup=e.appendChild(m.cloneNode(1E3)),this.areaGroup.fu=new Methods(this.areaGroup),this.areaGroup.fu.extendAllIds(this.areaGroup,
c),this.workspaceNode=map.SVGDocument.getElementById(f+":workspace"+c),this.cliprectNode=map.SVGDocument.getElementById(f+":cliprect"+c)):(f="scrollarea",this.areaGroup=map.Dom.newGroup(e,f+c),e=map.Dom.newNode("clipPath",this.areaGroup),e.setAttribute("id",f+":clippath"+c),e.setAttribute("style","pointer-events:all"),this.cliprectNode=map.Dom.newShape("rect",e,0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight),"fill:none;stroke:none"),this.cliprectNode.setAttribute("id",f+":cliprect"+
c),this.areaGroup.setAttributeNS(null,"clip-path","url(#"+f+":clippath"+c+")"),this.workspaceNode=map.Dom.newGroup(this.areaGroup,f+":workspace"+c)),this.szId=f)};Ba.prototype.setWidth=function(c){this.cliprectNode&&(this.nMaxWidth=Number(c),this.cliprectNode.setAttributeNS(null,"width",map.Scale.normalX(Math.max(this.nMaxWidth,0))))};Ba.prototype.setHeight=function(c){this.cliprectNode&&(this.nMaxHeight=Number(c),this.cliprectNode.setAttributeNS(null,"height",map.Scale.normalX(Math.max(this.nMaxHeight,
0))))};Ba.prototype.setPosition=function(c,e){this.areaGroup&&this.areaGroup.fu.setPosition(c,e)};Ba.prototype.reformat=function(c){this.scrollObj&&(this.scrollObj.remove(c),this.scrollObj=null);var e=new box(0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight)),f=getTranslate(this.workspaceNode);if(this.nMaxWidth<0||this.nMaxHeight<0){var m=map.Dom.getBox(this.workspaceNode);e.width=this.nMaxWidth>=0?e.width:m.width+map.Scale.normalX(this.nScrollBarWidth+5);e.height=this.nMaxHeight>=
0?e.height:m.height+map.Scale.normalY(this.nScrollBarWidth+5);this.cliprectNode.setAttributeNS(null,"width",e.width);this.cliprectNode.setAttributeNS(null,"height",e.height)}this.scrollObj=new aa(this.workspaceNode,new point(f.x,f.y),e,map.Scale.normalX(this.nScrollBarWidth),map.Scale.normalY(this.nScrollBarWidth),map.Scale.normalX(1)),this.scrollObj.draw(c)};Ba.prototype.remove=function(c){this.scrollObj&&(this.scrollObj.remove(c),this.scrollObj=null);this.areaGroup&&(this.areaGroup.parentNode.removeChild(this.areaGroup),
this.areaGroup=null)};Ba.prototype.hasScrollBars=function(c){return this.scrollObj?this.scrollObj.hasScrollBars():!1};Ba.prototype.getWidth=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"width"))/map.Scale.normalX(1):0};Ba.prototype.getHeight=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"height"))/map.Scale.normalY(1):0};Ba.prototype.setScrollPosition=function(c){this.scrollObj&&this.scrollObj.vThumbObj&&this.scrollObj.vThumbObj.setValue(c);
this.scrollObj&&this.scrollObj.hThumbObj&&this.scrollObj.hThumbObj.setValue(c)};var d=[];map.removeAllHighlights=function(){for(var c=0;c<d.length;c++)d[c]&&(d[c].unlock(),d[c].removeAll());d.length=0};var a=function(){this.itemA=[];d[d.length]=this};a.prototype.addItem=function(c,e){for(var f=0;f<this.itemA.length;f++)if(this.itemA[f].node==c)return null;c=new H(c,e);this.itemA[this.itemA.length]=c;return c.node};a.prototype.checkItem=function(c){for(var e=0;e<this.itemA.length;e++)if(this.itemA[e].node==
c)return!0;return!1};a.prototype.removeItem=function(c){c=map.Layer.getLayerItemNodeOfNode(c);for(var e=0;e<this.itemA.length;e++)if(this.itemA[e].node==c){for(this.itemA[e].removeHighLight();e<this.itemA.length-1;e++)this.itemA[e]=this.itemA[e+1];--this.itemA.length}};a.prototype.offAll=function(){for(var c=0;c<this.itemA.length;c++)this.itemA[c].removeHighLight()};a.prototype.onAll=function(){for(var c=0;c<this.itemA.length;c++)this.itemA[c].doHighLight()};a.prototype.startToggle=function(){map.nHighlightToggle>
0&&(this.toggleCount=map.nHighlightToggle*2,setTimeout("__highlightObject.toggleAll()",1E3))};a.prototype.toggleAll=function(){for(var c=0;c<this.itemA.length;c++)this.itemA[c].highlighted?this.itemA[c].removeHighLight():this.itemA[c].doHighLight();--this.toggleCount>0&&setTimeout("__highlightObject.toggleAll()",500)};a.prototype.removeAll=function(){if(!this.fLock){for(var c=0;c<this.itemA.length;c++)this.itemA[c].removeHighLight();this.itemA.length=0}};a.prototype.lock=function(){this.fLock=!0};
a.prototype.unlock=function(){this.fLock=!1};H.prototype.doHighLight=function(){var c=this.node;if(c){if(this.szMode&&this.szMode=="circle"&&this.node.parentNode.fu&&this.node.parentNode.fu.getPosition){this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup,":highlightgroup");this.itemNode=map.Dom.newGroup(this.highlightGroup);c=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;var e=map.Scale.normalX(2)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,
f=map.Scale.normalX(1)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;map.Dom.newShape("circle",this.itemNode,0,0,c,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+f+" "+f+";stroke-width:"+e*1.1+"px;pointer-events:none");map.Dom.newShape("circle",this.itemNode,0,0,c,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+f+" "+f+";stroke-width:"+e+"px;pointer-events:none");map.Dom.getBox(this.node);c=this.node.parentNode.fu.getScale();var m=this.node.fu.getPosition().x*c.x;c=
this.node.fu.getPosition().y*c.y;m=this.node.parentNode.fu.getPosition().x+m;c=this.node.parentNode.fu.getPosition().y+c;this.itemNode.fu.setPosition(m,c);this.itemNode.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX);return!0}if(this.szMode&&this.szMode=="isolate"&&this.node.parentNode.fu&&this.node.parentNode.fu.getPosition)return c=c.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,":highlightgroup"),this.itemNode=this.highlightGroup.appendChild(c),
this.itemNode.setAttributeNS(null,"id",""),this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),map.Dom.getBox(this.node),c=this.node.parentNode.fu.getScale(),m=this.node.fu.getPosition().x*c.x,c=this.node.fu.getPosition().y*c.y,m=this.node.parentNode.fu.getPosition().x+m,c=this.node.parentNode.fu.getPosition().y+c,this.itemNode.fu=new Methods(this.itemNode),this.itemNode.fu.setPosition(m,c),m=this.node.fu.getScale(),c=this.node.parentNode.fu.getScale(),this.itemNode.fu.scale(m.x*
c.x,m.y*c.y),this.objectGroupOpacity=map.Layer.objectGroup.style.getPropertyValue("opacity")||1,map.Layer.objectGroup.style.setProperty("opacity","0.3"),m=map.Dom.newGroup(this.itemNode),c=map.Scale.normalX(50)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,e=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,f=map.Scale.normalX(5)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,map.Dom.newShape("circle",m,0,0,c,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+
f+" "+f+";stroke-width:"+e*1.1+"px;pointer-events:none"),map.Dom.newShape("circle",m,0,0,c,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+f+" "+f+";stroke-width:"+e+"px;pointer-events:none"),map.Dom.getBox(this.node),c=this.node.parentNode.fu.getScale(),this.node.fu.getPosition(),this.node.fu.getPosition(),this.node.parentNode.fu.getPosition(),this.node.parentNode.fu.getPosition(),m.fu.scale(1/c.x,1/c.y),m.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX),!0;if(this.szMode&&this.szMode==
"scale"&&this.node.parentNode.fu&&this.node.parentNode.fu.getPosition)return c.nodeName=="g"&&(c=c.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,":highlightgroup"),this.highlightGroup.style.setProperty("pointer-events","none"),this.itemNode=this.highlightGroup.appendChild(c),this.itemNode.setAttributeNS(null,"id",""),this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),map.Dom.getBox(this.node),c=
this.node.parentNode.fu.getScale(),m=this.node.fu.getPosition().x*c.x,c=this.node.fu.getPosition().y*c.y,m=this.node.parentNode.fu.getPosition().x+m,c=this.node.parentNode.fu.getPosition().y+c,this.itemNode.fu=new Methods(this.itemNode),this.itemNode.fu.setPosition(m,c),m=this.node.fu.getScale(),c=this.node.parentNode.fu.getScale(),this.itemNode.fu.scale(m.x*c.x,m.y*c.y),m=map.Dom.newGroup(this.itemNode),c=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,e=map.Scale.normalX(2)*
map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,f=map.Scale.normalX(1)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,map.Dom.newShape("circle",m,0,0,c,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+f+" "+f+";stroke-width:"+e*1.1+"px;pointer-events:none"),map.Dom.newShape("circle",m,0,0,c,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+f+" "+f+";stroke-width:"+e+"px;pointer-events:none"),map.Dom.getBox(this.node),c=this.node.parentNode.fu.getScale(),this.node.fu.getPosition(),
this.node.fu.getPosition(),this.node.parentNode.fu.getPosition(),this.node.parentNode.fu.getPosition(),m.fu.scale(1/c.x,1/c.y),m.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX)),!0;if(this.szMode&&this.szMode=="scalex")return this.node.parentNode.fu&&this.node.parentNode.fu.getPosition&&(c=c.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,":highlightgroup"),this.itemNode=this.highlightGroup.appendChild(c),this.itemNode.setAttributeNS(null,
"id",""),this.itemNode.fu=new Methods(this.itemNode),this.itemNode.fu.scaleBy(0,0)),!0;m=new MapObject(c);e=map.Layer.getLayerObj(m.szId);m=e.szHighlight;if(!m)switch(e.szType){case "point":m="filter:url(#Glow);scale:1.5";break;case "line":m="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":m="fill:yellow"}if(this.szMode&&this.szMode=="hint")switch(e.szType){case "point":m="filter:url(#Glow);scale:1.5";break;case "line":m="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";
break;case "polygon":m="fill:#eeeeff;fill-opacity:0.2;stroke-opacity:0.5;stroke:#eeeeff;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;"}if(m=__scaleStyleString(m,map.Scale.normalX(1/map.Zoom.nZoom))){f=c.parentNode;var l=f.nextSibling;l&&l.nodeType==1&&l.getAttributeNS(null,"id").match(/highlightgroup/)?this.highlightGroup=l:(this.highlightGroup=map.Dom.newGroup(f.parentNode,e.szName+":highlightgroup"),this.highlightGroup=f.parentNode.insertBefore(this.highlightGroup,l),this.highlightGroup.setAttributeNS(null,
"class",f.getAttributeNS(null,"class")));this.highlightGroup.setAttributeNS(null,"style",m+";display:inline;pointer-events:none");c=c.cloneNode(1E3);this.itemNode=this.highlightGroup.appendChild(c);this.itemNode.setAttributeNS(null,"id","");if(m.match(/fill:/)&&(this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),this.itemNode.hasChildNodes))for(c=this.itemNode.childNodes,e=0;e<c.length;e++)c.item(e).nodeType==1&&c.item(e).style.setProperty("fill","inherit",
"");if(m.match(/stroke:/)&&(this.itemNode.style.removeProperty("stroke"),this.itemNode.hasChildNodes))for(c=this.itemNode.childNodes,e=0;e<c.length;e++)c.item(e).nodeType==1&&(c.item(e).style.setProperty("stroke","none",""),c.item(e).style.removeProperty("stroke"));if(m.match(/scale:/)){this.itemNode.fu=new Methods(this.itemNode);m=parseFloat(m.split("scale:")[1]);if(isNaN(m)||m===0)m=1.5;this.itemNode.fu.scaleBy(m,m)}return this.highlighted=!0}return!1}};H.prototype.removeHighLight=function(){this.highlightGroup&&
this.highlightGroup.parentNode&&this.highlightGroup.parentNode.removeChild(this.highlightGroup);this.highlighted=!1;this.objectGroupOpacity&&(map.Layer.objectGroup.style.setProperty("opacity",this.objectGroupOpacity),this.objectGroupOpacity=null)};var g=null,b=null;ixMap.prototype.displayInfo=function(c,e,f){x(c,e,f)};var r=function(c,e,f){var m=null;f&&f.match(/add/)||map.SVGPopupGroup.fu.clear();var l=g?map.Event.popupContextObj=g:map.Event.popupContextObj;if(l==null)return null;var h=l.getAttributeNS(szMapNs,
"info");h!=null&&h.length!==0||!l.parentNode||(l=l.parentNode,h=l.getAttributeNS(szMapNs,"info"));var p=map.Dom.getAttributeByNodeOrParents(l.parentNode,szMapNs,"info"),B=map.Dom.getAttributeByNodeOrParents(l.parentNode,szMapNs,"show"),C=map.Dom.getAttributeByNodeOrParents(l.parentNode,szMapNs,"label");var N=map.Dom.getAttributeByNodeOrParents(l.parentNode,szMapNs,"units");var Y=map.Dom.getAttributeByNodeOrParents(l,null,"id"),M=Y+":info";map.Themes&&map.Themes.activeTheme&&(M+=":"+map.Themes.activeTheme.szId);
if(map.SVGDocument.getElementById(M))return null;var w=null;if(Y&&Y.length){Y=map.Tiles.getMasterId(Y);var J=Y.split(":::")[0];w=map.SVGDocument.getElementById(J+":image")}try{if(map.User.onInfoDisplay(null,Y))return null}catch(Da){}c=new point(c,e);J=new point(map.Scale.normalX(map.nInfoOffsetX),map.Scale.normalY(map.nInfoOffsetY));e="info:"+String(Math.random());J=new xa(map.SVGDocument,map.SVGPopupGroup,e+(f.match(/pointer/)?"":":movable"),c,J,f);var L=J.workspaceNode;L=map.Dom.newGroup(L,M);var G=
new box(0,0,0,0);M=(new MapObject(l)).szId;if(M.match(/chartgroup/)){var F=M.split(":")[1],V=M.split(":")[3];M=F+"::"+V}else{var la=map.Layer.getLayerItemNodeOfNode(l);la&&(M=la.getAttributeNS(null,"id"))}V=(map.Label.getLabel(M)||" ").replace(/<br>/g," ");map.Themes.activeTheme&&(V=map.Themes.getTitle(M,map.Themes.activeTheme));try{var U=map.Themes.getDataRow(M,map.Themes.activeTheme);V=map.HTMLWindow.ixmaps.htmlgui_onInfoTitle(V,U)}catch(Da){}if(V){if(!isNaN(V)){var ka=map.Layer.getLayerObj(F);
V=(ka?ka.szLabel+" ":"")+V}J.setTitle(V,map.Scale.tStyle.InfoContainerTitle)}if(f.match(/short/))return J.reformat(),J?J.objectNode:null;if(map.Themes&&map.Themes.activeTheme){if((ka=map.Layer.getLayerItemNodes(l))&&ka.length>0)for(var Sa="",Ma=0;Ma<map.Themes.themesA.length;Ma++){var Na=map.Themes.themesA[Ma];if(Na.szFields!=Sa&&(F=map.Dom.newGroup(L,"info:chart"),la=map.Tiles.getMasterId(ka[0].getAttributeNS(null,"id")),map.Themes.getChart(la,F,"VALUES|ZOOM|AXIS",Na),F.hasChildNodes()||(la=map.Tiles.getMasterId(ka[0].parentNode.getAttributeNS(null,
"id")))&&map.Themes.getChart(la,F,"VALUES|ZOOM|AXIS",Na),F.hasChildNodes()||(la=l.getAttributeNS(null,"id")||"",(la=la.split(":")[1])&&map.Themes.getChart(la,F,"VALUES|ZOOM|AXIS",Na)),F.hasChildNodes())){Sa=Na.szFields;h="";killTooltip();J.fClipped=!1;U=map.Dom.getBox(F);if(U.width>0&&U.height>0){V=map.Scale.tStyle.Description.nFontHeight*.9;var Qa=__scaleStyleString(map.Scale.tStyle.Description.szStyle,1),Ka=(Na.szTitle||" ").replace(/<br>/g," ");map.Dom.newText(L,map.Scale.normalX(6),G.height+V,
Qa,Ka);V=Na.szFlag.match(/CHART/)?V+map.Scale.normalY(6/1.3):V+map.Scale.normalY(6*1.3);Ka=map.Scale.normalX(Na.szFlag.match(/PLOT/)?200:100)/U.width;F.fu.scale(Ka,Ka);U=map.Dom.getBox(F);F.fu.setPosition(map.Scale.normalX(6)-U.x*Ka,G.height+V-U.y*Ka);U=map.Dom.getBox(F);V=U.y+U.height+map.Scale.normalY(6);if(G=map.Themes.getLabel(la,Na))G=G.length<25?G:G.substr(0,25)+"...",V+=map.Scale.normalY(6*1.3),Qa=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1),map.Dom.newText(F,U.x,V,Qa,G),V+=map.Scale.tStyle.Description.nFontHeight;
var $a=map.Themes.getSummary(la,Na);$a&&(Qa=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1/Ka),map.Dom.newText(F,U.x,V,Qa,$a));G=map.Dom.getBox(L);G.height+=map.Scale.normalY(12)}Na.fShowData&&(m=Na.getDataGrid(la,L))&&(m.setPosition(map.Scale.normalX(5),G.height),m.hasScrollBars&&m.hasScrollBars()&&m.workspaceNode.style.setProperty("display","none",""))}}else{F=map.Dom.newGroup(L,"info:chart");la=(new MapObject(l)).szId;Na=la.split(":")[1];Ma=la.split(":")[3];V=(ka=map.Layer.getLayerObj(Na))?
ka.szSelection+" ":"";(ka=map.Themes.getTheme(la.split(":")[0]))&&ka.szInfoTitle&&(V=ka.szInfoTitle);V=(la=map.Label.getLabel(Na+"::"+Ma))?la:V+Ma;la=Na+"::"+Ma;if(ka.szFlag.match(/PLOT/))for(Ma=0;Ma<map.Themes.themesA.length;Ma++)Na=map.Themes.themesA[Ma],Na.szFlag.match(/PLOT/)&&map.Themes.getChart(la,F,"VALUES|XAXIS|ZOOM|BOX|GRID",Na);else ka.szFlag.match(/POINTER/)&&ka.nOrigSumA.length>1&&ka.partsA.length>1?map.Themes.getChart(la,F,"VALUES|ZOOM|AXIS|HORZ",ka):(map.Themes.getChart(la,F,"VALUES|ZOOM|AXIS",
ka),ka.szFlag.match(/COUNTS/)&&ka.partsA.length>1&&(Na=map.Dom.newGroup(F,"info:chart:x"),Ma=ka.nNormalSizeValue,ka.nNormalSizeValue=map.Themes.getMaxValue(la,ka)*10,map.Themes.getChart(la,Na,"CHART|BAR|HORZ|ZOOM|VALUES|AXIS|NOZERO|SORT",ka),ka.nNormalSizeValue=Ma,Na.fu.setPosition(0,Na.fu.getBox().height+F.fu.getBox().height/2+map.Scale.normalX(5))));ka&&ka.itemA[la]&&ka.itemA[la].szSelectionId&&(V=ka.itemA[la].szSelectionId.split(":").pop());ka&&ka.itemA[la]&&ka.itemA[la].szTitle&&(V=ka.itemA[la].szTitle);
ka&&ka.itemA[la]&&ka.itemA[la].szSelectionId2&&ka.itemA[la].szSelectionId2!="undefined"&&(V+=" ==> "+ka.itemA[la].szSelectionId2);try{U=map.Themes.getDataRow(M,map.Themes.activeTheme),V=map.HTMLWindow.ixmaps.htmlgui_onInfoTitle(V,U)}catch(Da){}if(F.hasChildNodes()){killTooltip();J.fClipped=!1;J.setTitle(V,map.Scale.tStyle.InfoContainerTitle);U=map.Dom.getBox(F);if(U.width>0&&U.height>0){Na=ka.szFlag.match(/PLOT/)?Math.min(map.Scale.normalX(300)/U.height,map.Scale.normalX(400)/U.width):Math.min(map.Scale.normalX(150)/
U.height,map.Scale.normalX(200)/U.width);F.fu.scale(Na,Na);F.fu.setPosition(map.Scale.normalX(6)-U.x*Na,G.height+map.Scale.normalY(6)-U.y*Na);V=U.y+U.height+map.Scale.normalY(6)/Na;G=1.5/Na;Ka=(ka.szTitle||" ").replace(/<br>/," \n ");Qa=__scaleStyleString(map.Scale.tStyle.Description.szStyle,G);V+=map.Scale.tStyle.Description.nFontHeight*G+map.Scale.normalY(2*G);Na=map.Dom.newText(F,U.x,V,Qa,Ka);V+=map.Scale.tStyle.Description.nFontHeight*G+map.Scale.normalY(G);map.Dom.wrapText(Na,U.width);if($a=
map.Themes.getValueComment(la,map.Themes.activeTheme))Qa=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.5),map.Dom.newText(F,U.x,V,Qa,$a),map.Scale.normalY(.5);map.Themes.getSummary(la,map.Themes.activeTheme);G=map.Dom.getBox(L);G.height+=map.Scale.normalY(12)}else if($a=map.Themes.getSummary(la,ka))$a=$a.split("Total:")[1],Qa=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,2.5),map.Dom.newText(L,100,500,Qa,$a+ka.szUnits),G=map.Dom.getBox(L);ka.fShowData&&(m=ka.getDataGrid(la,L))&&(m.setPosition(map.Scale.normalX(5),
G.height),m.hasScrollBars&&m.hasScrollBars()&&m.workspaceNode.style.setProperty("display","none",""))}}G=map.Dom.getBox(L)}w&&(w=w.cloneNode(1E3),w=L.appendChild(w),w.fu=new Methods(w),w.fu.setPosition(map.Scale.normalX(5),G.height+map.Scale.normalY(5)),w.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),G=map.Dom.getBox(L),G.height+=map.Scale.normalX(7));if(h&&h.length&&p.length&&!m){if(B&&B.length){if(U=[],p=p.split("|"),h=h.split("|"),B=B.split("|"),F=C.split("|"),C=N.split("|"),B&&B.length){for(N=
0;N<B.length;N++)for(w=0;w<p.length;w++)B[N]==p[w]&&(U[U.length]=F&&F[N]?map.Dictionary.getLocalText(F[N]):map.Dictionary.getLocalText(p[w]));for(N=0;N<B.length;N++)for(w=0;w<p.length;w++)B[N]==p[w]&&(F=map.Dictionary.getLocalText(h[w]),U[U.length]=n(F),U[U.length-1]+=C[N]?" "+C[N]:"")}}else{U=[];p=p.split("|");C=N.split("|");for(N=0;N<p.length;N++)U[U.length]=map.Dictionary.getLocalText(p[N]);h=h.split("|");for(N=0;N<h.length;N++)isNaN(h[N])?(F=map.Dictionary.getLocalText(p[N]+":"+h[N]),U[U.length]=
F!=p[N]+":"+h[N]?F:map.Dictionary.getLocalText(h[N])):(F=map.Dictionary.getLocalText(p[N]+":"+h[N]),U[U.length]=n(F!=p[N]+":"+h[N]?F:h[N])),U[U.length-1]+=C[N]?" "+C[N]:""}if(U.length){var kb=v(map.SVGDocument,L,e+":textgrid",U,2,14);kb.fu.setPosition(map.Scale.normalX(5),G.height)}try{var ia;if(ia=map.User.onInfoDisplayExtend(null,Y,kb.parentNode,c))ia=kb.appendChild(ia),ia.fu.setPosition(map.Scale.normalX(5),G.height)}catch(Da){}}try{if(ia=map.HTMLWindow.ixmaps.htmlgui_onInfoDisplayExtend(map.SVGDocument,
M))ia=L.appendChild(ia),ia.fu=new Methods(ia),ia.fu.setPosition(map.Scale.normalX(10),G.height+map.Scale.normalX(10))}catch(Da){}L.hasChildNodes()||map.Dom.newShape("rect",L,0,0,1,1,"fill:none;stroke:none;");J.reformat();m&&m.workspaceNode.style.setProperty("display","inline","");f.match(/fix/)&&(J.objectNode.fu.scale(map.nFixedInfoScale,map.nFixedInfoScale),map.SVGFixedGroup.appendChild(J.objectNode),J.highLightList=new a,J.highLightList.addItem(l),J.highLightList.lock(),J.setOnRemove("_doRemoveFixedInfo(map.Dom.popObj('"+
map.Dom.pushObj(J)+"'))"));return J?J.objectNode:null};ixMap.prototype.removeInfo=function(){map.SVGFixedGroup.fu.clear()};var n=function(c){if(c.match(/E+/)){var e=c.split("E+"),f=parseFloat(e[0]);e=parseInt(e[1]);if(!isNaN(f)&&!isNaN(e))return f*=Math.pow(10,e),String(Math.round(f*100)/100)}f=Number(c);return isNaN(f)?c:String(f)},v=function(c,e,f,m,l,h,p,B){c=Math.ceil(m.length/l);h=h?h:12;for(var C=0;C<m.length&&m[C];C++);e=map.Dom.newGroup(e,f);var N=map.SVGDocument.getElementById("TextLinesBgPattern");
B||map.szTextGridStyle.match(/background/);f=[];var Y=[],M=Array(c);for(C=0;C<c;C++)M[C]=Array(l);var w=map.Dom.newNode("g",e),J=map.Scale.normalX(5);B=map.Scale.normalX(3);var L=Math.min(map.Scale.normalX(250),map.Scale.bBox.width/7);for(ka=0;ka<l;ka++){var G=map.Scale.normalY(h);for(C=0;C<c;C++){l>1&&ka===0&&!N&&map.szTextGridStyle.match(/background/)&&map.szTextGridStyle.match(/alternate/);var F=map.Dom.newText(w,0,G,"font-family:arial;font-size:"+map.Scale.normalY(h)+"px;fill:"+map.szInfoBodyColor,
m[C+ka*c]);map.Dom.wrapText(F,L);M[C][ka]=F;Y[C]=F;l>1&&ka===0&&!N&&(map.szTextGridStyle.match(/firstsmall/)&&F.style.setProperty("font-size",String(map.Scale.normalY(h*.9))+"px",""),map.szTextGridStyle.match(/firstitalic/)&&F.style.setProperty("font-style","italic",""),map.szTextGridStyle.match(/firstgray/)&&F.style.setProperty("fill","#888888",""));if(p&&p[C+ka*c])try{var V=__getStyleArray(p[C+ka*c]),la;for(la in V)F.style.setProperty(la,V[la],"")}catch(Sa){}F.setAttribute("transform","matrix(1 0 0 1 "+
J+" "+B+")");F.nodeName!="a"&&F.style.setProperty("pointer-events","none","")}G=map.Dom.getBox(w).width;if(map.szTextGridStyle.match(/firstright/)&&ka===0)for(C=0;C<c;C++)Y[C].setAttribute("transform","matrix(1 0 0 1 "+(J+G)+" "+B+")"),Y[C].style.setProperty("text-anchor","end","");J=G+map.Scale.normalX(h)+map.Scale.normalX(5);if(ka===0)var U=J}m=map.Scale.normalY(h);for(C=0;C<c;C++){p=map.Scale.normalY(h);for(var ka=0;ka<l;ka++)p=Math.max(p,map.Dom.getBox(M[C][ka]).height);for(ka=0;ka<l;ka++)V=getMatrix(M[C][ka]),
V[5]+=m,setMatrix(M[C][ka],V);m+=p+map.Scale.normalY(2)}l=map.Dom.getBox(w);for(C=0;C<c;C++)f[C]&&(map.szTextGridStyle.match(/full/)?f[C].setAttributeNS(null,"width",l.width+map.Scale.normalX(h/2)):f[C].setAttributeNS(null,"width",U-map.Scale.normalX(5)));(U=map.SVGDocument.getElementById("TextLinesBgPattern:antizoomandpan"))&&U.setAttributeNS(null,"patternTransform","matrix(1 0 0 1 0 "+String(B-map.Scale.normalY(h-1))+")");return e};ixMap.Toolbar=function(c){this.init(c)};ixMap.Toolbar.prototype=
new Map;ixMap.Toolbar.prototype.init=function(c){c=map.SVGDocument.getElementById("legend:toolbar");var e=map.SVGDocument.getElementById("toolbar");c&&e&&(e.setAttributeNS(null,"id","toolbar:movable"),map.Dom.clearGroup(c),c.appendChild(e),c.setAttributeNS(null,"cursor","pointer"),this.refresh())};ixMap.Toolbar.prototype.refresh=function(c){if((c=map.SVGDocument.getElementById("legend:toolbar"))&&!(map.Legend&&map.Legend.objNode&&map.Legend.objNode.fu.isContained(c))){var e=map.Scale.normalX(map.nMapBorderWidth);
c.fu=new Methods(c);var f=c.fu.getPosition(),m=c.getAttributeNS(szMapNs,"position");m.match(/NONE/)&&c.style.setProperty("display","none","");m.match(/INMAP/)&&(m.match(/RIGHT/)?(m=c.fu.getBox(),c.fu.setPosition(map.Scale.mapPosition.x+map.Scale.bBox.width-e-map.Scale.normalX(10)-m.width,f.y+e)):c.fu.setPosition(map.Scale.mapPosition.x+map.Scale.normalX(6)+e,f.y+e))}};ixMap.Legend=function(c){c=c?c.target.ownerDocument:map.SVGDocument;var e=c.getElementById("legend:group");if(!e||typeof e=="undefined")return null;
this.fInitializing=!0;this.lastItemObjectA=[];this.objNode=e;this.objNode.fu=new Methods(this.objNode);c=c.getElementById("legend_body");try{map.Dictionary.applyToNode(c)}catch(f){}this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","0","");map.fAllIncluded||map.fPDFEmbed?this.init():setTimeout("map.Legend.init()",500)};ixMap.Legend.prototype=new Map;ixMap.Legend.prototype.init=function(c){if(this.blockRecursion!==!0){var e=map.Scale.mapPosition.x?map.Scale.normalY(10):
map.Scale.normalY(60),f=c?c.target.ownerDocument:map.SVGDocument,m=f.getElementById("legend:group");if(!m)return this.fInitializing=!1;this.objNode=m;this.objNode.fu=new Methods(this.objNode);var l=f.getElementById("legend_title");f.getElementById("legend_onoff_bg:sizeable");var h=f.getElementById("legend_body"),p=f.getElementById("legend:toolbar"),B=f.getElementById("legend_bg"),C=f.getElementById("legend_body_bg"),N=f.getElementById("legend_body_header"),Y=f.getElementById("legend_body_footer"),
M=f.getElementById("legend_body:frame"),w=f.getElementById("legend:off:legend_body"),J=f.getElementById("legend_body:workspace:movabley");try{var L=map.Dom.getBox(J?J:h)}catch(U){this.fHidden||(this.show(),setTimeout("map.Legend.init()",10));this.fInitializing=!1;return}var G=1E5,F=1E5,V=map.SVGDocument.getElementById("legend:param");V&&(G=Number(V.getAttributeNS(szMapNs,"maxwidth")),F=Number(V.getAttributeNS(szMapNs,"maxheight")),G=G?map.Scale.normalX(G):1E6,F=F?map.Scale.normalY(F):1E6);(V=map.SVGDocument.getElementById("test:markerrect"))&&
V.parentNode.removeChild(V);this.fInitializing&&(this.blockRecursion=!0,this.checkGroupCollapse(null),this.blockRecursion=!1);try{L=map.Dom.getBox(J?J:h)}catch(U){L=new box(0,0,map.Scale.normalX(150),map.Scale.normalX(300))}var la=I(c,l);V=I(c,N);J=I(c,Y);p&&p.parentNode==h&&(p.fu=new Methods(p),p=p.fu.getBox(),p.y<=0&&p.width>0&&p.width<1E5&&(V.y+=p.y+p.height,V.width=Math.max(V.width,p.width),N&&(N.fu=new Methods(N),N.fu.setPosition(V.x,V.y))));if(V.y||V.height)M.fu=new Methods(M),M.fu.setPosition(M.fu.getPosition().x,
V.y+V.height);L.height+=map.Scale.normalY(0);(p=map.SVGDocument.getElementById("legend:show:button"))&&p.style.setProperty("display","none","");h&&C&&(map.Scale.legendWidth=Math.max(la.x+la.width+map.Scale.normalX(10),Math.max(L.x+L.width,Math.max(V.x+V.width,J.x+J.width)))+map.Scale.normalX(20),map.Scale.legendWidth=Math.min(map.Scale.legendWidth,G),G=this.objNode.fu.getPosition(),G.x<map.Scale.mapPosition.x&&map.Scale.viewBox.width-map.Scale.bBox.width>0?(map.Scale.legendWidth=map.Scale.mapPosition.x-
map.Scale.normalX(2),F=1E5,this.fInMap=!1,map.fLegendToggleButtons&&(G=Number(C.getAttributeNS(null,"y")),C.setAttributeNS(null,"y",G+map.Scale.normalX(-100)),map.SVGDocument.getElementById("legend:hide:button")||(G=new Oa(m,"legend:hide","BUTTON","#expand_left_button","map.Api.extendMap()","","expand map"),G.nodeObj.style.setProperty("opacity","0.9",""),G.scale(1.8,1.8),G.setPosition(map.Scale.legendWidth-map.Scale.normalX(6),map.Scale.mapPosition.y+map.Scale.normalY(8))),map.SVGDocument.getElementById("legend:show:button")||
(G=new Oa(m.parentNode,"legend:show","BUTTON","#expand_right_button","map.Api.normalMap()","","show legend"),m.parentNode.insertBefore(G.nodeObj,m.parentNode.firstChild),G.scale(1.8,1.8),G.nodeObj.style.setProperty("opacity","0.8",""),G.nodeObj.style.setProperty("display","none",""),map.fMapBorder3D&&map.SVGDocument.getElementById(map.szShadowFilterId)&&G.nodeObj.style.setProperty("filter","url(#"+map.szShadowFilterId+")",""),G.setPosition(map.Scale.normalX(9),map.Scale.mapOffset.y+map.Scale.normalY(14))))):
G.x>=map.Scale.mapPosition.x+map.Scale.bBox.width?(map.Scale.legendWidth=map.Scale.viewBox.width-map.Scale.mapPosition.x-map.Scale.bBox.width-map.Scale.normalX(8),F=1E5,this.fInMap=!1):(this.objNode.fu.setPosition(map.Scale.normalX(8+map.nMapBorderWidth),map.Scale.normalY(map.nMapBorderWidth)),F+=J.height,N&&N.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),w&&w.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),this.fInMap=!0),map.Scale.legendHeight=Math.min(L.y+L.height+V.y+V.height+
J.height+map.Scale.normalY(6),Math.min(F,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-e)),C.setAttributeNS(null,"width",map.Scale.legendWidth),C.setAttributeNS(null,"height",map.Scale.legendHeight-Number(C.getAttributeNS(null,"y"))+map.Scale.normalY(5)),C.setAttributeNS(null,"rx",map.Scale.normalX(2)),C.setAttributeNS(null,"ry",map.Scale.normalX(2)),this.fInMap&&(map.fObjectPseudoShadow&&!this.shadowNode&&(m=(e=C.style.getPropertyValue("opacity"))&&e.length?Number(e):1,
e=C.style.getPropertyValue("fill-opacity"),e=m*(e&&e.length?Number(e):1),e=e==1?e*.5:e*.2,this.shadowNode=map.Dom.newShape("rect",h,map.Scale.normalX(3),map.Scale.normalY(-19),map.Scale.normalX(10),map.Scale.normalY(10),"fill:#444444;stroke:#888888;opacity:"+e+";"),this.shadowNode=h.insertBefore(this.shadowNode,C)),this.shadowNode.setAttributeNS(null,"width",map.Scale.legendWidth),this.shadowNode.setAttributeNS(null,"height",map.Scale.legendHeight-Number(C.getAttributeNS(null,"y"))+map.Scale.normalY(5)),
this.shadowNode.setAttributeNS(null,"rx",map.Scale.normalX(5)),this.shadowNode.setAttributeNS(null,"ry",map.Scale.normalX(5))),C.setAttributeNS(szMapNs,"menu","legendmenu"));h&&B&&B.setAttributeNS(null,"width",L.x+L.width-map.Scale.normalY(15));h&&w&&map.fInitLegendOff&&(h.style.setProperty("display","none",""),w.style.setProperty("display","none",""));if(M)if(h=map.Dom.setClipRect(M,new box(0,0,1,1)),B=map.Scale.legendHeight-V.height-J.height,L.height<=B?(h.setAttributeNS(null,"width",map.Scale.legendWidth),
h.setAttributeNS(null,"height",L.y+L.height+map.Scale.normalY(10))):(h.setAttributeNS(null,"width",map.Scale.legendWidth),h.setAttributeNS(null,"height",B)),Y&&(Y.fu=new Methods(Y),Y.fu.setPosition(0,map.Scale.legendHeight-J.height-map.Scale.normalY(2)),map.Dom.setClipRect(Y,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),map.Scale.viewBox.height))),N&&map.Dom.setClipRect(N,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),B)),l&&map.Dom.setClipRect(l,new box(map.Scale.normalX(-20),map.Scale.normalY(-20),
map.Scale.legendWidth-map.Scale.normalX(0),B)),this.scrollObj)l=new box(h.getAttributeNS(null,"x"),h.getAttributeNS(null,"y"),h.getAttributeNS(null,"width"),h.getAttributeNS(null,"height")),this.scrollObj.setWidth(l.width/map.Scale.normalX(1)),this.scrollObj.setHeight(l.height/map.Scale.normalY(1)),this.scrollObj.reformat(c);else if(N=f.getElementById("legend_body:workspace:movabley"))l=new box(h.getAttributeNS(null,"x"),h.getAttributeNS(null,"y"),h.getAttributeNS(null,"width"),h.getAttributeNS(null,
"height")),this.scrollObj=new Ba(c,null,null,l.width/map.Scale.normalX(1),l.height/map.Scale.normalY(1),10),this.scrollObj.workspaceNode=N,this.scrollObj.cliprectNode=h,this.scrollObj&&this.scrollObj.reformat(c);map.fClipMapToLegend&&(c=f.getElementById("mapcliprect"))&&(f=map.Dom.getBox(c),f=f.x+f.width,l=map.Scale.normalX(5),c.setAttributeNS(null,"x",map.Scale.legendWidth+l),c.setAttributeNS(null,"width",f-map.Scale.legendWidth-l));this.fInitializing=!1;this.objNode.parentNode.appendChild(this.objNode);
this.fHidden||this.show();return!0}};ixMap.Legend.prototype.move=function(c){map.mouseObject=new Aa(c,this.objNode)};ixMap.Legend.prototype.reformat=function(c){this.scrollObj&&this.scrollObj.reformat(c)};ixMap.Legend.prototype.hide=function(c){this.objNode.style.setProperty("display","none","");this.fHidden=!0;(c=map.SVGDocument.getElementById("legend:show:button"))&&c.style.setProperty("display","inline","")};ixMap.Legend.prototype.show=function(c){this.objNode.style.setProperty("display","inline",
"");this.objNode.style.setProperty("opacity","1","");this.fHidden=!1;(c=map.SVGDocument.getElementById("legend:show:button"))&&c.style.setProperty("display","none","")};ixMap.Legend.prototype.getPosition=function(c){return(c=(c?c.target.ownerDocument:map.SVGDocument).getElementById("legend:group"))?(c=getMatrix(c),new point(c[4],c[5])):new point(0,0)};ixMap.Legend.prototype.checkGroupCollapse=function(c,e){var f=c?c.target.ownerDocument:map.SVGDocument;e==null&&(e=f.getElementById("legend_body:workspace:movabley"));
if(e&&e.nodeType==1){e=e.childNodes;for(var m=0;m<e.length;m++)if(e.item(m).nodeType==1){var l=e.item(m).getAttributeNS(szMapNs,"mode");l&&l.match(/HIDDEN/)&&(l=e.item(m).getAttributeNS(null,"id").split(":"),l[0]=="legend"&&l[1]=="item"&&(l=f.getElementById("legend:collapse:"+l[2]),this.legendMouseClick(c,l)));this.checkGroupCollapse(c,e.item(m))}}};ixMap.Legend.prototype.legendMouseClick=function(c,e){if(e==null||e.nodeType!=1)return!1;var f=e.getAttributeNS(null,"id");if(f&&!f.match(/legend/))return!1;
if(f&&f.match(/this:item/))return this.execLegendMouseClickOnItem(c,e,f),!0;f=f.split(":");for(var m=3;m<f.length;m++)f[2]+=":"+f[m];this.execLegendMouseClick(c,e,f[2],f[1])||this.execLegendMouseClickOnTiles(c,e,f[2],f[1])||(clearThemes(),pa(""));f[2]&&!f[2].match(/:label/)&&map.Layer.isScaleDependentLayerOn(f[2]+":label")&&this.execLegendMouseClick(c,e,f[2]+":label",f[1]);return!0};ixMap.Legend.prototype.execLegendMouseClick=function(c,e,f,m,l){if(f==null||m==null)return!1;if(m=="mapzoom"&&!f.match(/label/))return map.Zoom.doZoomMap(f,
"byfactor"),!0;if(m=="textscale"&&!f.match(/label/))return map.Layer.changeLabelScaling(null,f,"byfactor"),!0;if(m=="backwards"&&!f.match(/label/))return map.zoomAndPanHistory.backwards(),!0;if(m=="activatetool"&&!f.match(/label/))return pa(f),!0;var h=map.Dom.getAttributeByNodeOrParents(e,szMapNs,"classname");h.match(/legendgroup/)&&(h=null);switch(m){case "suboff":m="off";case "off":l&&l.length?map.Layer.switchLayerByCSS(c,f,h,"none"):f.match(/'/)?map.Layer.switchLayer(c,f,h,!1):executeWithMessage(()=>
map.Layer.switchLayer(null,f,h,!1),"...");e.style.setProperty("display","none","");!f.match(/label/)&&map.fCheckSublayerCollapse&&ha(e,"collapse");break;case "on":l&&l.length?map.Layer.switchLayerByCSS(c,f,h,"inline"):f.match(/'/)?map.Layer.switchLayer(c,f,h,!0):executeWithMessage(()=>map.Layer.switchLayer(null,f,h,!0),"...");(l=map.SVGDocument.getElementById("legend:off:"+f))&&l.style.setProperty("display","inline","");!f.match(/label/)&&map.fCheckSublayerCollapse&&ha(e,"expand");map.Event.doDefaultZoom(c);
break;case "collapse":e.style.setProperty("display","none","");ha(e,"collapse");break;case "expand":(l=map.SVGDocument.getElementById("legend:collapse:"+f))&&l.style.setProperty("display","inline","");ha(e,"expand");break;case "setactive":activateTheme(f);break;case "item":try{this.lastItemObjectA[f].redraw()}catch(p){}}O(f,m);return!0};ixMap.Legend.prototype.execLegendMouseClickOnItem=function(c,e,f){if((c=map.Dom.getAttributeByNodeOrParents(e,szMapNs,"onactivate"))&&c.length){var m=f.split(":"),
l=m[m.length-1];switch(m[1]){case "off":e.style.setProperty("display","none","");try{this.lastItemObjectA[l]&&this.lastItemObjectA[l].remove()}catch(h){}this.lastItemObjectA[l]=null;break;case "on":if(!this.lastItemObjectA[l]){f="legend:off:"+f.substr(10,f.length-10);(e=map.SVGDocument.getElementById(f))&&e.style.setProperty("display","inline","");try{this.lastItemObjectA[l]=eval(c),this.lastItemObjectA[l]&&(this.lastItemObjectA[l].onremove="map.Legend.setLegendCheckBox(null,'"+f+"','unchecked');map.Legend.lastItemObjectA['"+
l+"']=null;deactivateTheme('"+l+"')",this.lastItemObjectA[l].szItem=l)}catch(h){alert("ERROR: "+h.description+" \nIN: "+c)}}}}return!0};ixMap.Legend.prototype.execLegendMouseClickOnTiles=function(c,e,f,m){var l=!1;if(f&&map.Tiles&&map.Tiles.nCount>0)for(var h=map.Tiles.getTileNodeIds(f),p=0;p<h.length;p++)this.execLegendMouseClick(c,e,h[p],m)&&(l=!0);l||(h=map.Dom.getAttributeByNodeOrParents(e,szMapNs,"classname"))&&h.length&&(l=this.execLegendMouseClick(c,e,f,m,h));return l};ixMap.Legend.prototype.setLegendCheckBox=
function(c,e,f){if(e.match(/legend/)){c=e.split(":");e="legend:off";for(var m=2;m<c.length;m++)e+=":"+c[m]}(e=map.SVGDocument.getElementById(e))&&e.style.setProperty("display",f=="checked"?"inline":"none","")};ixMap.Legend.prototype.switchLegendCheckBox=function(c,e,f){c="legend:off:"+e;var m=map.SVGDocument.getElementById(c);m||=map.SVGDocument.getElementById(c+":byclassname");m&&m.style.setProperty("display",f,"");(m=map.SVGDocument.getElementById("legend:setactive:"+e))&&m.style.setProperty("opacity",
f=="none"?"0.4":"1","")};map.zoomAndPanHistory=new Ga;map.highLightList=new a;window.InfoContainer=xa;window.MapTool=ja;window.TextField=Ja;window.ScrollArea=Ba;window.HighLight=a;window.doDisplayInfo=r;window._removeInfo=function(c){map.Event.onoverShape!=null||map.Event.onoverPopup?setTimeout("_removeInfo()",250):map.SVGPopupGroup.fu.clear()};window._doRemoveFixedInfo=function(c){c.highLightList.unlock();c.highLightList.removeAll()};window.setMapTool=pa;window.createTextGrid=v})();(function(){ixMap.Api=function(t){this.executeWithPush=!1;this.map=t};ixMap.Api.prototype=new Map;typeof thisversion=="string"&&map.checkVersion(thisversion)?map.Api=new ixMap.Api(map):alert("ixMap.Api incompatible !");ixMap.Api.prototype.setMapFeatures=function(t){this.map.setFeatures(t)};ixMap.Api.prototype.getMapFeatures=function(){return this.map.getFeatures()};ixMap.Api.prototype.setMapLocal=function(t,H){H=H.split("|");for(var x=0;x<H.length;x++)loadSVGIncludes(null,t,H[x])};ixMap.Api.prototype.setLocalString=
function(t,H){this.map.Dictionary.replace(t,H)};ixMap.Api.prototype.getLocalString=function(t){this.map.Dictionary.getLocalText(t)};ixMap.Api.prototype.setMapLayer=function(t){if(map.fInitializing||map.isLoading())this.map.pushAction(()=>{map.Api.setMapLayer(t)});else{var H=JSON.parse(t),x;for(x in H){H[x].display&&H[x].display=="none"&&this.switchLayer(String(x),!1);if(H[x].off)for(var y in H[x].off)this.switchLayer(x+"::"+H[x].off[y],!1);if(H[x].on){var A=this.getLayer()[x].categoryA;if(A){for(var I in A)this.switchLayer(x+
"::"+I,!1);for(y in H[x].on)H[x].on[y].length&&this.switchLayer(x+"::"+H[x].on[y],!0)}}}}};ixMap.Api.prototype.loadMap=function(t){map.fInitializing||map.isLoading()?this.map.pushAction(()=>{map.Api.loadMap(t)}):this.map.loadMap(t)};ixMap.Api.prototype.setBookmark=function(){try{var t=this.map.Zoom.getBox(),H=this.map.Scale.getMapCoordinate(t.x,t.y),x=this.map.Scale.getMapCoordinate(t.x+t.width,t.y+t.height);this.map.bookmarkList.createBookmark(null,"MinBoundX='"+H.x+"' MaxBoundX='"+x.x+"' MinBoundY='"+
x.y+"' MaxBoundY='"+H.y)}catch(y){alert("Bookmark could not be set !")}};ixMap.Api.prototype.gotoBookmark=function(t){try{this.map.bookmarkList.exec(t)}catch(H){alert("Bookmarks could not be found !")}};ixMap.Api.prototype.clearBookmarks=function(){try{this.map.bookmarkList.clear()}catch(t){alert("Bookmarks could not be deleted !")}};ixMap.Api.prototype.getMapBox=function(){return new box(this.map.Scale.mapPosition.x/this.map.Scale.normalX(1),this.map.Scale.mapPosition.y/this.map.Scale.normalX(1),
this.map.Scale.bBox.width/this.map.Scale.normalX(1),this.map.Scale.bBox.height/this.map.Scale.normalX(1))};ixMap.Api.prototype.resizeCanvas=function(t,H,x,y,A){return this.map.Scale.resizeCanvas(t,H,x,y,A)};ixMap.Api.prototype.doZoomMapToFullExtend=function(){this.map.Zoom.doZoomMapToLayer("maplayer")};ixMap.Api.prototype.doZoomMap=function(t,H){return this.map.Zoom.doZoomMap(t,H)};ixMap.Api.prototype.doPanMap=function(t,H){this.map.Zoom.setNewPan(t,H)};ixMap.Api.prototype.doZoomMapToWidgetRect=function(t){this.map.Zoom.doZoomMapToWidgetRect(t)};
ixMap.Api.prototype.doCenterMapToGeoPosition=function(t,H){this.map.Zoom.doCenterMapToGeoPosition(t,H)};ixMap.Api.prototype.doCenterMapToGeoBounds=function(t,H,x,y){this.map.Zoom.doCenterMapToGeoBounds(t,H,x,y)};ixMap.Api.prototype.doZoomMapToGeoBounds=function(t,H,x,y){this.map.Zoom.doZoomMapToGeoBounds(t,H,x,y)};ixMap.Api.prototype.doSetMapToGeoBounds=function(t,H,x,y){y-H<180&&(this.map.fPreserveMapRatio=!1);this.map.Zoom.doSetMapToGeoBounds(t,H,x,y);setTimeout("this.map.fPreserveMapRatio = true;",
5E3)};ixMap.Api.prototype.doZoomMapToView=function(t,H){this.map.Zoom.doZoomMapToView(t,H)};ixMap.Api.prototype.getCenterOfMapInGeoPosition=function(){return this.map.Zoom.getCenterOfMapInGeoPosition()};ixMap.Api.prototype.getBoundsOfMapInGeoBounds=function(){return this.map.Zoom.getBoundsOfMapInGeoBounds()};ixMap.Api.prototype.getMapScale=function(){return String(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale))};ixMap.Api.prototype.pendingNewGeoBounds=function(){return this.map.fPendingNewGeoBounds};
ixMap.Api.prototype.setVisibility=function(t){var H=new MapTool(null,"nothing");t=="invisible"?H.hideLayer(null):H.showLayer(null)};ixMap.Api.prototype.hideOverviewMap=function(){};ixMap.Api.prototype.showOverviewMap=function(){};ixMap.Api.prototype.hideNorthArrow=function(){this.map.Viewport.hideNorthArrow()};ixMap.Api.prototype.showNorthArrow=function(){this.map.Viewport.showNorthArrow()};ixMap.Api.prototype.backwards=function(){this.map.zoomAndPanHistory.backwards()};ixMap.Api.prototype.forwards=
function(){this.map.zoomAndPanHistory.forwards()};ixMap.Api.prototype.toggleThemeValues=function(t){try{this.map.Themes.toggleThemeValues(null,t)}catch(H){}};ixMap.Api.prototype.toggleThemeLegends=function(t){try{this.map.Themes.toggleThemeLegends(null,t)}catch(H){}};ixMap.Api.prototype.minimizeThemeLegends=function(){try{this.map.Themes.minimizeThemeLegends(null)}catch(t){}};ixMap.Api.prototype.changeObjectScaling=function(t){this.map.Layer.changeObjectScaling(null,t)};ixMap.Api.prototype.changeLabelScaling=
function(t){this.map.Layer.changeLabelScaling(null,t)};ixMap.Api.prototype.changeLineScaling=function(t){this.map.Layer.changeLineScaling(null,t)};ixMap.Api.prototype.getScaleParam=function(){return this.map.Scale.getScaleParam()};ixMap.Api.prototype.setScaleParam=function(t){this.map.Scale.setScaleParam(t)};ixMap.Api.prototype.changeRotation=function(t){this.map.Scale.changeRotation(null,t)};ixMap.Api.prototype.setRotation=function(t){this.map.Scale.setRotation(null,t)};ixMap.Api.prototype.setMapBackgroundColor=
function(t){this.map.Viewport.setBackgroundColor(t)};ixMap.Api.prototype.togglePanBorder=function(){this.map.Viewport.togglePanBorder()};ixMap.Api.prototype.setPrintScaling=function(){this.map.Event.doPrintZoom()};ixMap.Api.prototype.froozeMap=function(t){this.map.fFroozeDynamicContent=t};ixMap.Api.prototype.freezeMap=function(t){this.map.Event.fFreezeDynamicContent=t};ixMap.Api.prototype.setMapClip=function(t){this.map.Viewport.clipMap(t)};ixMap.Api.prototype.setLayerClip=function(t,H){this.map.Viewport.clipLayer(t,
H)};ixMap.Api.prototype.switchLayer=function(t,H){this.map.Layer.switchLayer(null,t,null,H)};ixMap.Api.prototype.getLayer=function(){return this.map.Layer.listA};ixMap.Api.prototype.getLayerDependency=function(){return this.map.Layer.depListA};ixMap.Api.prototype.getTileInfo=function(){return this.map.Tiles};ixMap.Api.prototype.setMapTool=function(t){setMapTool(t)};ixMap.Api.prototype.getMapTool=function(){return this.map.szMapToolType};ixMap.Api.prototype.isMapTool=function(t){return this.map.szMapToolType==
t?"yes":"no"};ixMap.Api.prototype.isNotMapTool=function(t){return this.isMapTool(t)=="no"?"yes":"no"};ixMap.Api.prototype.switchMapTheme=function(t,H){if(t)if(H=H||(this.map.Layer.isLayerOn(t)?"off":"on"),map.Legend){var x=this.map.this.map.SVGDocument.getElementById("legend:"+H+":this:item:"+t);x?this.map.Legend.execLegendMouseClickOnItem(null,x,"legend:"+H+":this:item:"+t):H=="on"?(this.map.Layer.switchLayer(null,t,null,!0),map.Legend.switchLegendCheckBox(null,t,"inline")):(this.map.Layer.switchLayer(null,
t,null,!1),map.Legend.switchLegendCheckBox(null,t,"none"))}else H=="on"?this.map.Layer.switchLayer(null,t,null,!0):this.map.Layer.switchLayer(null,t,null,!1)};ixMap.Api.prototype.getMapTheme=function(t){var H=t.split("#")[0].split(":")[0];H=="legend"&&(H=t.split(":")[2]);return this.map.Layer.listA[H]};ixMap.Api.prototype.getMapThemeRendererField=function(t){return(t=this.getMapTheme(t))?t.szRenderer:null};ixMap.Api.prototype.getMapThemeDataRow=function(t,H){return(t=map.Themes.getTheme(t))?map.Themes.getDataRow(H,
t):null};ixMap.Api.prototype.getMapThemeItemPosition=function(t,H){return(t=map.Themes.getTheme(t))?(H=t.getItemNodes(H),map.Scale.getScreenPosition(H[0])):null};ixMap.Api.prototype.zoomMapToItem=function(t){this.map.Zoom.doZoomMapToItem(t)};ixMap.Api.prototype.getMapThemeChart=function(t,H,x,y){return(t=map.Themes.getTheme(t))?map.Themes.getChart(H,x,y,t):null};ixMap.Api.prototype.getMapThemeHistogram=function(t,H,x,y){return(H=map.Themes.getTheme(t))?map.Themes.getHistogram(t,x,y,H):null};ixMap.Api.prototype.executeJavascriptWithMessage=
function(t,H,x){t&&typeof(t!="undefined")&&this.map.pushAction(()=>{map.Api.executeWithPush=!0;executeWithMessage(t.replace(/\\/gi,"\\\\").replace(/"/gi,'\\"'),H,x);map.Api.executeWithPush=!1})};ixMap.Api.prototype.displayMessage=function(t,H,x){displayMessage(t,H,x)};ixMap.Api.prototype.flipLegend=function(){var t=getMatrix(this.map.Scale.offsetNode);t[4]=t[4]===0?this.map.Scale.viewBox.width-this.map.Scale.bBox.width:this.map.Scale.viewBox.width-(this.map.Scale.mapPosition.x+this.map.Scale.bBox.width);
setMatrix(this.map.Scale.offsetNode,t);this.map.Scale=new ixMap.Scale;this.map.Viewport=new ixMap.Viewport;var H=this.map.SVGDocument.getElementById("legend:group");H&&(t=getMatrix(H),t[4]===0?(this.map.Dom.getBox(H),t[4]=this.map.Scale.mapPosition.x+this.map.Scale.bBox.width):t[4]=0,setMatrix(H,t),displayScale(null,"bottom"),this.map.Toolbar.refresh())};var Ga=0;ixMap.Api.prototype.extendMap=function(){var t=getMatrix(this.map.Scale.offsetNode);if(Ga=t[4]){t[4]=0;setMatrix(this.map.Scale.offsetNode,
t);this.map.Zoom.doPanMap(Ga/this.map.Scale.normalX(1)/2,0);this.map.Scale.reset();this.map.Viewport.reformat();try{this.map.Legend.hide()}catch(H){}try{this.map.HTMLWindow.ixmaps.htmlgui_onMapResize(window)}catch(H){this.map.Viewport.reformat()}}else this.map.fInitLegendOff=!0};ixMap.Api.prototype.normalMap=function(){if(!(Ga<=0)){var t=getMatrix(this.map.Scale.offsetNode);t[4]=Ga;setMatrix(this.map.Scale.offsetNode,t);this.map.Zoom.doPanMap(-Ga/this.map.Scale.normalX(1)/2,0);this.map.Scale.reset();
this.map.Viewport.reformat();try{this.map.Legend.show()}catch(H){}try{this.map.HTMLWindow.ixmaps.htmlgui_onMapResize(window)}catch(H){this.map.Viewport.reformat()}}};ixMap.Api.prototype.hideLegend=function(){var t=this.map.SVGDocument.getElementById("legend:group");t&&t.style.setProperty("display","none","")};ixMap.Api.prototype.showLegend=function(){var t=this.map.SVGDocument.getElementById("legend:group");t&&t.style.setProperty("display","inline","")};ixMap.Api.prototype.clearAll=function(){this.map.clearAll()};
ixMap.Api.prototype.clearAllCharts=function(){this.map.Themes&&this.map.Themes.removeAllCharts()};ixMap.Api.prototype.clearAllChoropleth=function(){this.map.Themes&&this.map.Themes.removeAllChoropleth()};ixMap.Api.prototype.clearAllOverlays=function(){this.map.SVGPopupGroup&&this.map.SVGToolsGroup.fu.clear();this.map.SVGPopupGroup&&this.map.SVGFixedGroup.fu.clear();this.map.SVGPopupGroup&&this.map.SVGPopupGroup.fu.clear();this.map.SVGPopupGroup&&this.map.SVGMessageGroup.fu.clear();this.map.Themes&&
this.map.Themes.removeAllSelections()};ixMap.Api.prototype.getActualEnvelopeString=function(){return this.map.Zoom.getEnvelopeString()};ixMap.Api.prototype.getActualEnvelopeCoordinates=function(){return this.map.Zoom.getEnvelope()};ixMap.Api.prototype.printActualEnvelope=function(){var t=this.map.Zoom.getBox(),H=this.map.Scale.getMapCoordinate(t.x,t.y);t=this.map.Scale.getMapCoordinate(t.x+t.width,t.y+t.height);var x='<ENVELOPE minx="'+H.x+'"\n';x+='          maxx="'+t.x+'"\n';x+='          miny="'+
t.y+'"\n';x+='          maxy="'+H.y+'" name="Initial_Extent" />';try{htmlgui_prettyPrintXML("Actual zoom Envelope (for SVGGIS XML)",x+"\n")}catch(y){alert(x)}};ixMap.Api.prototype.createTextLink=function(t,H,x){t=this.map.Dom.newGroup(t);if(x.match(/javascript/)){var y=this.map.Dom.constructNode("a",t,{"xlink:href":""});H=this.map.Dom.newText(y,0,this.map.Scale.normalY(this.map.nNormalFontSize*.75),"font-family:arial;font-size:"+this.map.Scale.normalY(this.map.nNormalFontSize*.75)+"px;fill:blue;",
H);y=this.map.Dom.newShape("rect",y,0,0,this.map.Scale.normalX(this.map.nNormalFontSize*10),this.map.Scale.normalY(this.map.nNormalFontSize+3),"fill:#fffff0;stroke:#000000;opacity:0");H&&(y.setAttributeNS(null,"onclick",x),y.setAttributeNS(null,"onmousedown","this.map.Event.stopMouseEvent(evt)"),y.setAttributeNS(null,"onmouseup","this.map.Event.stopMouseEvent(evt)"))}else y=this.map.Dom.constructNode("a",t,{"xlink:href":x}),this.map.Dom.newText(y,0,this.map.Scale.normalY(this.map.nNormalFontSize*
.75),"font-family:arial;font-size:"+this.map.Scale.normalY(this.map.nNormalFontSize*.75)+"px;fill:blue;",H);return t};ixMap.Api.prototype.createInfoBubble=function(t,H,x){if(t&&H){x||=1;var y="bubble:"+String(Math.random()+":movable");H=createTextGrid(this.map.SVGDocument,this.map.SVGFixedGroup,y,H,x);x=new point(this.map.Scale.normalX(-10),this.map.Scale.normalY(15));var A=this.map.Scale.getScreenPosition(t),I=this.map.Scale.clipWidgetObjectToSVG(H,A,x);H.fu.setPosition(I.x,I.y);t=this.map.Dom.getBox(H);
(new Button(H,"xx","BUTTON","#delete_button","this.map.Dom.removeElementById('"+y+"')","","remove")).setPosition(t.width,this.map.Scale.normalY(9));t.width+=this.map.Scale.normalY(9);y=I.y==A.y+x.y?"top":"bottom";y=I.x==A.x+x.x?y+"left":y+"right";this.map.Scale.normalX(15);A=this.map.Scale.normalX(5);I=this.map.Scale.normalX(5);var O=this.map.Scale.normalX(5),ha=x.y,Z=this.map.Scale.normalX(15);x=-x.x-A-I;var W="M"+t.x+","+t.y+" ";W+="m"+I+",0 ";y=="topleft"?(W=W+("l"+A+",0 l")+(x+","+-ha+" l")+(-x+
Z+","+ +ha+" "),W+="l"+(t.width-I*2-A-Z)+",0 "):y=="topright"?(W+="l"+(t.width-I*2-A-Z)+",0 ",W+="l"+(-x+Z)+","+-ha+" ",W+="l"+x+","+ +ha+" ",W+="l"+A+",0 "):W+="l"+(t.width-I*2)+",0 ";W+="q"+I+",0 "+I+","+O+" ";W+="l0,"+(t.height-O*2)+" ";W+="q0,"+O+" "+-I+","+O+" ";y=="bottomright"?(W=W+("l"+-A+",0 l")+(-x+","+ha+" l")+(+x-Z+","+-ha+" "),W+="l"+(-t.width+I*2+A+Z)+",0 "):y=="bottomleft"?(W+="l"+(-t.width+I*2+A+Z)+",0 ",W+="l"+(x-Z)+","+ha+" ",W+="l"+-x+","+-ha+" ",W+="l"+-A+",0 "):W+="l"+(-t.width+
I*2)+",0 ";W+="q"+-I+",0 "+-I+","+-O+" ";W+="l0,"+(-t.height+O*2)+" ";W+="q0,"+-O+" "+I+","+-O+" ";W+="z";t=this.map.Dom.newShape("path",H,W,"fill:white;stroke:grey");H.style.setProperty("filter","url(#DropShadowFilterTools)","");t.parentNode.insertBefore(t,t.parentNode.firstChild)}};ixMap.Api.prototype.createInfoContainer=function(t,H,x,y,A,I){if(t&&H)return I||="fix",x=new point(y,A),y=new point(0,0),I=new InfoContainer(this.map.SVGDocument,this.map.SVGPopupGroup,t+":more"+(I.match(/pointer/)?"":
":movable"),x,y,I),t=createTextGrid(this.map.SVGDocument,I.workspaceNode,t+":more:textgrid",H,2),this.map.Dictionary.applyToNode(t),I.reformat(),this.map.Event.stopMouseEvent(),I};ixMap.Api.prototype.getContextMenuTarget=function(){return this.map.Event.contextMenuObj};ixMap.Api.prototype.getMapToolShape=function(){return mapToolList.toolShape};ixMap.Api.prototype.getShapePoints=function(t){if(t.nodeName=="path"){var H=[],x=null,y=new point(0,0);t=t.getAttributeNS(null,"d");t=t.substr(1,t.length-
2);t.replace("M","M ");t=t.split(" ");for(var A=0;A<t.length;A++)if(t[A]=="l"||t[A]=="L")x=t[A];else if(t[A]&&t[A].length){var I=t[A].split(",");H[H.length]=x=="l"?new point(y.x+Number(I[0]),y.y+Number(I[1])):new point(Number(I[0]),Number(I[1]));y=H[H.length-1]}return H}return null};ixMap.Api.prototype.getShapeCoordinates=function(t){if(t.nodeName=="path"&&(t=this.getShapePoints(t))){var H=[],x;for(x in t){var y=this.map.Scale.getMapPosition(t[x].x,t[x].y);y=this.map.Scale.getMapCoordinate(y.x,y.y);
H[H.length]=new point(y.x,y.y)}return H}return null};ixMap.Api.prototype.getShape=function(t,H,x){x=[];x.push(t);for(var y in x)if(t=this.map.SVGDocument.getElementById(x[y])){for(y=t;!(x=y.getAttribute("style"))&&y.parentNode;)y=y.parentNode;y=t.cloneNode(1E3);y.setAttribute("style",x);y.fu=new Methods(y);t.fu=new Methods(t);t=t.fu.getBox();x=Math.min(4E3/t.width,4E3/t.height);y.fu.setPosition(-t.x*x,-t.y*x-3E3);y.fu.scale(x,x);y.style.setProperty("stroke-width",20/x+"px");H.appendChild(y);break}};
ixMap.Api.prototype.getSurface=function(t){if(t){if(t.parentNode.nodeName=="g"){var H=t.parentNode.getAttributeNS(szMapNs,"area");if(H&&H.length)return Number(H)}if(t=this.getShapePoints(t))return __doGetPolygonSurface(t)}return null};ixMap.Api.prototype.printSurface=function(t){if(t){var H=this.getSurface(t);if(H)return H=this.map.Scale.formatSurfaceString(H)+"  ",this.createInfoBubble(t,Array(H),1)}};ixMap.Api.prototype.displayContextMenuTargetInfo=function(){var t=this.map.Event.contextMenuObj;
t&&displayInfoDelayed(null,t,10)};ixMap.Api.prototype.removeContextMenuTarget=function(){this.map.Event.contextMenuObj&&(this.map.Dom.clearGroup(map.SVGToolsGroup),mapToolList.clear())};ixMap.Api.prototype.removeContextMapTool=function(){var t=this.map.Event.contextMenuObj;if(t)for(;t;t=t.parentNode)if(t.getAttributeNS(null,"id").match(/maptoolnode/)){mapToolList.removeMapTool(t);break}};ixMap.Api.prototype.createContextMenuTargetBuffer=function(){var t=this.map.Event.contextMenuObj;if(t){t=new MapObject(t);
if(t.szId.match(/legend:setactive/)){var H=t.szId.split("legend:setactive:")[1],x=H.split("::")[0];H=H.split("::")[1];var y=this.map.Layer.getLayerObjOfNode(t.objNode)}this.map.Themes.newTheme(x,y.szRenderer,"","type:CHART|BUFFER;align:center;colorscheme:#aa4400;ranges:"+H+";buffersize:1000;opacity:0.3;label:Ripetitore","Buffer (1 km)","Ripetitore")}};ixMap.Api.prototype.createTheme=function(t,H,x,y,A,I,O){return this.map.Themes.newTheme(t,H,x,y,A,I,O)};ixMap.Api.prototype.newMapTheme=function(t,
H,x,y,A,I){if(this.map.Zoom.fExternalZoom)this.map.pushAction(()=>{map.Api.newMapTheme(t,H,x,szStyl,A,I)});else if(this.executeWithPush)this.map.pushAction(()=>{map.Themes.newTheme(t,H,x,y,A,I)});else return this.map.Themes.newTheme(t,H,x,y,A,I)};ixMap.Api.prototype.newMapThemeByObj=function(t,H){return this.map.Themes.newThemeByObj(t,H)};ixMap.Api.prototype.refreshTheme=function(t){this.map.Themes.refreshTheme(t)};ixMap.Api.prototype.redrawTheme=function(t){this.map.Themes.redrawTheme(t)};ixMap.Api.prototype.resetTheme=
function(t){this.map.Themes.resetTheme(t)};ixMap.Api.prototype.changeContextThemeStyle=function(t,H){t=new MapObject(t);this.map.Themes.changeThemeStyle(null,t.szId,H)};ixMap.Api.prototype.changeThemeStyle=function(t,H,x){this.map.Themes.changeThemeStyle(null,t,H,x)};ixMap.Api.prototype.showThemeClass=function(t,H,x){this.map.Themes.showClass(null,t,H,x)};ixMap.Api.prototype.hideThemeClass=function(t,H,x){this.map.Themes.hideClass(null,t,H,x)};ixMap.Api.prototype.markThemeClass=function(t,H,x){this.map.Themes.markClass(null,
t,H,x)};ixMap.Api.prototype.unmarkThemeClass=function(t,H,x){this.map.Themes.unmarkClass(null,t,H,x)};ixMap.Api.prototype.setThemeTimeFrame=function(t,H,x){this.map.Themes.setTimeFrame(null,t,H,x)};ixMap.Api.prototype.filterThemeItems=function(t,H,x){this.map.Themes.filterItems(null,t,H,x)};ixMap.Api.prototype.selectFilterItems=function(t){this.map.Themes.selectFilterItems(null,t)};ixMap.Api.prototype.popupThemeStyleMenu=function(t){this.map.Themes.chartTypeMenu(null,t)};ixMap.Api.prototype.highlightThemeItems=
function(t,H,x){this.map.Themes.doHighlightItems(t,H,x)};ixMap.Api.prototype.clearHighlightThemeItems=function(t){this.map.Themes.clearHighlightItems(null,t)};ixMap.Api.prototype.zoomToTheme=function(t){this.map.Themes.zoomTo(null,t)};ixMap.Api.prototype.nextClipFrame=function(t){this.map.Themes.nextClipFrame(t)};ixMap.Api.prototype.setClipFrame=function(t,H){this.map.Themes.setClipFrame(t,H)};ixMap.Api.prototype.pauseClip=function(t){this.map.Themes.pauseClip(t)};ixMap.Api.prototype.startClip=function(t,
H){this.map.Themes.startClip(t,H)};ixMap.Api.prototype.getTheme=function(t){return this.map.Themes.getTheme(t)};ixMap.Api.prototype.getAllThemes=function(){return this.map.Themes.getAllThemes()};ixMap.Api.prototype.getMapThemeDefinitionStrings=function(){return this.map.Themes.getAllThemeDefinitionStrings()};ixMap.Api.prototype.getMapThemeStyleString=function(t){return this.map.Themes.getMapThemeStyleString(t)};ixMap.Api.prototype.getMapThemeDefinitionObj=function(t){return this.map.Themes.getMapThemeDefinitionObj(t)};
ixMap.Api.prototype.updateAlbersParameters=function(t,H){if(!t||H===void 0)return null;var x=parseFloat(t[0]);const y=parseFloat(t[1]);if(!Number.isFinite(x)||!Number.isFinite(y))return console.warn("updateAlbersParameters: invalid center coordinates",{center:t,zoom:H}),null;if(this.map&&this.map.Scale&&typeof this.map.Scale.calculateAlbersParameters==="function"){t=this.map.Scale.calculateAlbersParameters(x,y,H);if(!t)return null;H=this.map.Scale.lastAlbersParams;x=!1;if(!H)x=!0;else if(Math.abs(t.lat1-
H.lat1)>.5||Math.abs(t.lat2-H.lat2)>.5||Math.abs(t.lat0-H.lat0)>.5||Math.abs(t.lon0-H.lon0)>.5)x=!0;this.map.Scale.lastAlbersParams={lat1:t.lat1,lat2:t.lat2,lat0:t.lat0,lon0:t.lon0};return{params:t,changed:x}}return null};ixMap.Api.prototype.updateLambertParameters=function(t,H){if(!t)return null;let x;if(Array.isArray(t)&&t.length>=2){var y=t[0];x=t[1]}else typeof t==="object"&&t!==null&&(y=t.lat??t.latitude??t[0],x=t.lng??t.lon??t.longitude??t[1]);y=parseFloat(y);x=parseFloat(x);if(!Number.isFinite(y)||
!Number.isFinite(x))return console.warn("updateLambertParameters: invalid center coordinates",{center:t,zoom:H}),null;if(this.map&&this.map.Scale&&typeof this.map.Scale.calculateLambertAzimuthalParameters==="function"){t=this.map.Scale.calculateLambertAzimuthalParameters(y,x);if(!t)return null;H=this.map.Scale.lastLambertParams;y=!1;if(!H)y=!0;else if(Math.abs(t.lat0-H.lat0)>.5||Math.abs(t.lon0-H.lon0)>.5)y=!0;this.map.Scale.lastLambertParams={lat0:t.lat0,lon0:t.lon0};return{params:t,changed:y}}return null};
ixMap.Api.prototype.updateLambertParametersFromBounds=function(t){if(!t||!this.map||!this.map.Scale||typeof this.map.Scale.calculateLambertAzimuthalParametersFromBounds!=="function")return null;let H,x,y,A;if(Array.isArray(t)&&t.length>=4)[H,x,y,A]=t;else if(typeof t==="object"){const I=t.sw||t.southWest||t.SW;t=t.ne||t.northEast||t.NE;I&&t&&(H=I.lat??I.latitude??I[0],x=I.lng??I.lon??I.longitude??I[1],y=t.lat??t.latitude??t[0],A=t.lng??t.lon??t.longitude??t[1])}return this.map.Scale.calculateLambertAzimuthalParametersFromBounds(H,
x,y,A)};ixMap.Api.prototype.updateOrthographicParameters=function(t,H){if(!t)return null;let x;if(Array.isArray(t)&&t.length>=2){var y=t[0];x=t[1]}else typeof t==="object"&&t!==null&&(y=t.lat??t.latitude??t[0],x=t.lng??t.lon??t.longitude??t[1]);y=parseFloat(y);x=parseFloat(x);if(!Number.isFinite(y)||!Number.isFinite(x))return console.warn("updateOrthographicParameters: invalid center coordinates",{center:t,zoom:H}),null;if(H!==void 0&&H<2&&Math.abs(y)<.1&&Math.abs(x)<.1)return console.warn("updateOrthographicParameters: rejecting [0, 0] center at low zoom",
{center:t,zoom:H}),null;if(this.map&&this.map.Scale&&typeof this.map.Scale.calculateOrthographicParameters==="function"){t=this.map.Scale.calculateOrthographicParameters(y,x);if(!t)return null;if(Math.abs(t.lat0)<.1&&Math.abs(t.lon0)<.1&&(y=this.map.Scale.lastOrthographicParams)&&(Math.abs(y.lat0)>.1||Math.abs(y.lon0)>.1))return console.warn("updateOrthographicParameters: rejecting [0, 0] parameters when valid ones exist",{newParams:t,lastParams:y,zoom:H}),null;this.map.Scale.lastOrthographicParams=
{lat0:t.lat0,lon0:t.lon0};return{params:t,changed:!0}}return null};ixMap.Api.prototype.updateOrthographicParametersFromBounds=function(t){if(!t||!this.map||!this.map.Scale||typeof this.map.Scale.calculateOrthographicParametersFromBounds!=="function")return null;let H,x,y,A;if(Array.isArray(t)&&t.length>=4)[H,x,y,A]=t;else if(typeof t==="object"){const I=t.sw||t.southWest||t.SW;t=t.ne||t.northEast||t.NE;I&&t&&(H=I.lat??I.latitude??I[0],x=I.lng??I.lon??I.longitude??I[1],y=t.lat??t.latitude??t[0],A=
t.lng??t.lon??t.longitude??t[1])}return this.map.Scale.calculateOrthographicParametersFromBounds(H,x,y,A)};ixMap.Api.prototype.showTheme=function(t){this.map.Themes.showTheme(null,t)};ixMap.Api.prototype.hideTheme=function(t){this.map.Themes.hideTheme(null,t)};ixMap.Api.prototype.toggleTheme=function(t){this.map.Themes.toggleTheme(null,t)};ixMap.Api.prototype.removeTheme=function(t,H){return this.map.Themes.removeTheme(null,t,H)};ixMap.Api.prototype.removeAllThemes=function(){this.map.Themes.removeAll()};
ixMap.Api.prototype.getThemeId=function(t){return t?t.szId:null};ixMap.Api.prototype.setThemeExternalData=function(t,H,x){this.map.Themes.setExternalData(t,H,x)};ixMap.Api.prototype.getThemeRenderPosition=function(t){return this.map.Themes.getThemeRenderPosition(t)};ixMap.Api.prototype.moveThemeToPosition=function(t,H){return this.map.Themes.moveThemeToPosition(t,H)};ixMap.Api.prototype.moveThemeUp=function(t){return this.map.Themes.moveThemeUp(t)};ixMap.Api.prototype.moveThemeDown=function(t){return this.map.Themes.moveThemeDown(t)};
ixMap.Api.prototype.moveThemeToFront=function(t){return this.map.Themes.moveThemeToFront(t)};ixMap.Api.prototype.moveThemeToBack=function(t){return this.map.Themes.moveThemeToBack(t)};ixMap.Api.prototype.getThemeArrayPosition=function(t){return this.map.Themes.getThemeIndex(t)};ixMap.Api.prototype.moveThemeToArrayPosition=function(t,H){return this.map.Themes.moveThemeToArrayPosition(t,H)};ixMap.Api.prototype.removeElementById=function(t){(t=this.map.SVGDocument.getElementById(t))&&t.parentNode&&t.parentNode.removeChild(t)};
ixMap.Api.prototype.getShapeId=function(t){return t=new MapObject(t),t.szId};ixMap.Api.prototype.getShapeLayerObj=function(t){return(t=this.map.Layer.getLayerObjOfNode(t))?t:null};ixMap.Api.prototype.getShapeLayerName=function(t){return(t=this.map.Layer.getLayerObjOfNode(t))?t.szName:null};ixMap.Api.prototype.getShapeMetadataArray=function(t){var H=this.map.Dom.getAttributeByNodeOrParents(t,szMapNs,"info");t=new MapObject(t);if((t=this.map.Dom.getAttributeByNodeOrParents(t.objNode.parentNode,szMapNs,
"info"))&&H&&(t=t.split("|"),H=H.split("|"),t.length&&H.length)){for(var x=[],y=0;y<t.length;y++)x[t[y]]=H[y];return x}return null};ixMap.Api.prototype.highlightItem=function(t){var H=this.map.SVGDocument.getElementById(t);if(t.match(/:chart/))this.map.highLightList.unlock(),this.map.highLightList.removeAll(),this.map.highLightList.addItem(H,"circle");else{this.map.highLightList.unlock();this.map.highLightList.removeAll();for(t=0;t<x.length;t++)this.map.highLightList.removeItem(x[t]),this.map.highLightList.addItem(x[t],
"circle");this.map.highLightList.lock();var x=map.Layer.getLayerItemNodes(H);this.map.highLightList.unlock();this.map.highLightList.removeAll();for(t=0;t<x.length;t++)this.map.highLightList.removeItem(x[t]),this.map.highLightList.addItem(x[t])}this.map.highLightList.lock()};ixMap.Api.prototype.clearHighlight=function(){this.map.highLightList.unlock();this.map.highLightList.removeAll()};ixMap.Api.prototype.getLayerLegendSVG=function(t){alert(t)};ixMap.Api.prototype.newMapSelection=function(t,H,x,y){map.Selections.newSelection(t,
H,x,y)};ixMap.Api.prototype.selectItemByPosition=function(t,H){return map.Selections.selectItemByPosition(t,H)};ixMap.Api.prototype.selectItemByBoundingBox=function(t,H){return map.Selections.selectItemByBoundingBox(t,H)}})();(function(){ixMap.Query=function(x){this.themesA=[];this.infoThemesA=[];this.foundNodesA=[];this.searchRecursion=0;this.map=x};ixMap.Query.prototype=new Map;typeof thisversion=="string"&&map.checkVersion(thisversion)?map.Query=new ixMap.Query(map):alert("ixMap.Query incompatible !");ixMap.Query.prototype.xgetThemes=function(){if(this.themesA.length===0&&this.map.SVGDocument){var x=this.map.SVGDocument.getElementById("mapzoomandpan");if(x){x=x.childNodes;for(var y=0;y<x.length;y++)x.item(y).nodeName==
"g"&&(x.item(y).getAttributeNS(null,"id").match(/label/)||(this.themesA[this.themesA.length]=x.item(y).getAttributeNS(null,"id")))}}return this.themesA};ixMap.Query.prototype.getThemes=function(){if(this.themesA.length===0&&this.map.SVGDocument){var x=this.map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(x)for(var y=0;y<x.length;y++)this.themesA[this.themesA.length]=x.item(y).getAttributeNS(null,"name")}return this.themesA};ixMap.Query.prototype.getThemesWithInfo=function(){if(this.infoThemesA.length===
0&&this.map.SVGDocument){var x=this.map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(x)for(var y=0;y<x.length;y++)x.item(y).getAttributeNS(null,"flag").match(/info/)&&(this.infoThemesA[this.infoThemesA.length]=x.item(y).getAttributeNS(null,"name"))}return this.infoThemesA};ixMap.Query.prototype.getThemesWithSelection=function(){if(this.infoThemesA.length===0&&this.map.SVGDocument){var x=this.map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(x)for(var y=0;y<x.length;y++)x.item(y).getAttributeNS(null,
"selection").length&&(this.infoThemesA[this.infoThemesA.length]=x.item(y).getAttributeNS(null,"name"))}return this.infoThemesA};ixMap.Query.prototype.getActiveTheme=function(){return this.map._activeTheme};ixMap.Query.prototype.getFieldsOfTheme=function(x){var y=[];if(this.map.SVGDocument){var A=this.map.SVGDocument.getElementById(x);if(A==null&&map.Tiles&&map.Tiles.nCount>0)for(var I=0;I<map.Tiles.nCount&&A==null;I++)for(var O=0;O<map.Tiles.nCount&&A==null;O++)A=this.map.SVGDocument.getElementById(x+
"#00"+String(I)+"00"+String(O));A&&(y=A.getAttributeNS(szMapNs,"info").split("|"))}return y};ixMap.Query.prototype.getValuesOfFieldAndTheme=function(x,y,A){var I=[];if(x==null||y==null)return I;A||=1E5;if(this.map.SVGDocument){var O=this.map.SVGDocument.getElementById(x);if(O==null){O=map.Tiles.getTileNodes(x);for(x=0;x<O.length;x++){for(var ha=this.getValuesOfFieldAndTheme(O[x].getAttributeNS(null,"id"),y,A),Z=0;Z<ha.length;Z++)I[I.length]=ha[Z];if((A-=ha.length)<0)break}return I}if(O){Z=O.getAttributeNS(szMapNs,
"info").split("|");ha=-1;for(x=0;x<Z.length;x++)Z[x]==y&&(ha=x);if(ha>=0){Z=O.getElementsByTagName("g");for(x=0;x<Z.length;x++)if(Z.item(x).nodeType==1&&(y=(Z.item(x).getAttributeNS(szMapNs,"info")||"").split("|"),y.length>ha&&y[ha].length&&(I[I.length]=y[ha],I.length>A)))return I;Z=O.getElementsByTagName("path");for(x=0;x<Z.length;x++)if(Z.item(x).nodeType==1&&(y=(Z.item(x).getAttributeNS(szMapNs,"info")||"").split("|"),y.length>ha&&y[ha].length&&(I[I.length]=y[ha],I.length>A)))return I;Z=O.getElementsByTagName("use");
for(x=0;x<Z.length&&!(Z.item(x).nodeType==1&&(y=(Z.item(x).getAttributeNS(szMapNs,"info")||"").split("|"),y.length>ha&&y[ha].length&&(I[I.length]=y[ha],I.length>A)));x++);}}}return I};ixMap.Query.prototype.getSelectionValuesOfTheme=function(x,y){var A=[];if(x==null)return A;y||=1E5;if(this.map.SVGDocument){var I=this.map.SVGDocument.getElementById(x);x=I==null?map.Tiles.getTileNodes(x):Array(I);for(I=0;I<x.length;I++)for(var O=x[I].getElementsByTagName("g"),ha=0;ha<O.length;ha++){var Z=map.Tiles.getMasterId(O.item(ha).getAttributeNS(null,
"id")).split(":");A.push(Z.pop());if(A.length>y)return A}}return A};ixMap.Query.prototype.getValueOfFieldAndItem=function(x,y){if(this.map.SVGDocument){var A=this.map.SVGDocument.getElementById(x);A==null&&(A=map.Tiles.getTileNodes(x)[0]);if(A){var I=A.getAttributeNS(szMapNs,"info");if(!I||I.length===0){var O=A.childNodes;for(x=0;x<O.length;x++)O.item(x).nodeType==1&&(I=O.item(x).getAttributeNS(szMapNs,"info"))}I=I.split("|");if((A=A.parentNode.getAttributeNS(szMapNs,"info"))&&A.length)for(A=A.split("|"),
x=0;x<A.length;x++)if(A[x]==y)return I[x]}}return"?"};ixMap.Query.prototype.getClassnameOfItem=function(x){var y=null;if(this.map.SVGDocument){var A=this.map.SVGDocument.getElementById(x);A==null&&(A=map.Tiles.getTileNodes(x)[0]);if(A){y=A.getAttributeNS(null,"class");if(!y||!y.length){x=A.childNodes();for(var I=0;I<x.length;I++){var O=x.item(I);if(O.nodeType==1&&(y=O.getAttributeNS(null,"class"))&&y.length)break}}if(!y||!y.length)for(x=A.childNodes(),I=0;I<x.length&&(O=x.item(I),O.nodeType!=1||!(y=
O.getAttributeNS(szMapNs,"value"))||!y.length);I++);}}return y};ixMap.Query.prototype.addFoundNode=function(x,y,A,I){var O=map.Tiles.getMasterId(x.parentNode.getAttributeNS(null,"id")),ha=O.split(":")[0];if(ha&&ha.length&&O&&O.length){for(var Z=0;Z<this.foundNodesA.length;Z++)if(this.foundNodesA[Z].id==O&&this.foundNodesA[Z].feature==y&&this.foundNodesA[Z].item==A)return;this.foundNodesA[this.foundNodesA.length]={node:x,id:O,theme:ha,feature:y,item:A,itemA:I}}};ixMap.Query.prototype.searchItem=function(x,
y,A){this.foundNodesA.length=0;if(x.length===0)return this.foundNodesA;this.szQuery=x;var I=x.toLowerCase(),O=x.toUpperCase(),ha=x.substr(0,1).toUpperCase()+x.substr(1,x.length-1).toLowerCase();I=ha!=x?[x,ha,I,O]:[x,I];this.szThemesA=A.split("|");O=[];ha=map.Scale.canvasNode.getElementsByTagName("path");for(A=0;A<ha.length;A++)O[O.length]=ha.item(A);ha=map.Scale.canvasNode.getElementsByTagName("use");for(A=0;A<ha.length;A++)O[O.length]=ha.item(A);for(A=0;A<O.length;A++)if(O[A].nodeType==1){var Z=
!1;if(this.szThemesA[0]=="all")Z=!0;else if((ha=map.Tiles.getMasterId(O[A].parentNode.getAttributeNS(null,"id")))&&ha.length!==0){ha=ha.split(":")[0];for(var W=0;W<this.szThemesA.length;W++)ha==this.szThemesA[W]&&(Z=!0)}if(Z){ha=O[A].getAttributeNS(szMapNs,"info")||O[A].getAttributeNS(szMapNs,"tooltip");if(ha==null||ha.length===0)ha=O[A].parentNode.getAttributeNS(szMapNs,"info")||O[A].parentNode.getAttributeNS(szMapNs,"tooltip");Z=ha.split("|");if(x=="*")this.addFoundNode(O[A],"*","*",Z);else for(W=
0;W<Z.length;W++)if(Z[W].length&&this.isEqualA(I,y,Z[W])){var Q=map.Dom.getAttributeByNodeOrParents(O[A].parentNode,szMapNs,"info");Q=Q.split("|");ha=map.Tiles.getMasterId(O[A].parentNode.getAttributeNS(null,"id"));ha.split(":");this.addFoundNode(O[A],Q[W],Z[W],Z)}}}return this.foundNodesA};ixMap.Query.prototype.isEqualA=function(x,y,A){for(var I=0;I<x.length;I++)if(this.isEqual(x[I],y,A))return!0;return!1};ixMap.Query.prototype.isEqual=function(x,y,A){switch(y){case "any":return A.indexOf(x)>=0;
case "begin":return A.indexOf(x)===0;case "whole":return A==x}return!1};ixMap.Query.prototype.searchItemAdvanced=function(x,y){var A;this.searchRecursion===0&&(this.foundNodesA.length=0,this.szThemesA=Array(y));if(x.length===0)return this.foundNodesA;this.szQuery=x;var I=[],O=x.split(" ");I[I.length]="";for(A=0;A<O.length;A++)O[A].length&&("< == > <= <> >= and or like".indexOf(O[A])!=-1?(I[I.length]=O[A],I[I.length]=""):(I[I.length-1].length&&(I[I.length-1]+=" "),I[I.length-1]+=O[A]));if(I.length<
3)return this.foundNodesA;for(A=1;A<I.length;A+=2)if("< == > <= <> >= and or like".indexOf(I[A])==-1)return alert(I[A]+" is not an operator"),this.foundNodesA;O=new Ga;O.newPart();for(A=0;A<I.length;A+=4)switch(O.actPart.addCondition(I[A],I[A+1],I[A+2]),I[A+3]){case "and":break;case "or":O.newPart();break;default:A=1E4}if(this.map.SVGDocument){var ha=this.map.SVGDocument.getElementById(y);if(ha==null){A=map.Tiles.getTileNodes(y);this.searchRecursion++;for(O=0;O<A.length;O++)this.searchItemAdvanced(x,
A[O].getAttributeNS(null,"id"));this.searchRecursion=0;return this.foundNodesA}if(ha){x=ha.getAttributeNS(szMapNs,"info").split("|");for(A=0;A<x.length;A++)x[x[A]]=A;I=null;(y=ha.getElementsByTagName("path"))&&y.length&&(I=y.item(0).getAttributeNS(szMapNs,"info"));if(I==null||I.length===0)y=ha.getElementsByTagName("use");y&&y.length&&(I=y.item(0).getAttributeNS(szMapNs,"info"));if(I==null||I.length===0)y=ha.getElementsByTagName("g");for(A=0;A<y.length;A++)if(y.item(A).nodeType==1){I=y.item(A).getAttributeNS(szMapNs,
"info").split("|");ha=O.partA.length;for(var Z=0;Z<ha;Z++){for(var W=!0,Q=O.partA[Z].conditionA.length,xa=0;xa<Q;xa++){var Aa=x[O.partA[Z].conditionA[xa].szTopic];switch(O.partA[Z].conditionA[xa].szOperator){case "<":W=Number(I[Aa])<O.partA[Z].conditionA[xa].szValue;break;case "==":W=I[Aa]==O.partA[Z].conditionA[xa].szValue;break;case ">":W=Number(I[Aa])>O.partA[Z].conditionA[xa].szValue;break;case "<=":W=Number(I[Aa])<=O.partA[Z].conditionA[xa].szValue;break;case "<>":W=Number(I[Aa])!=O.partA[Z].conditionA[xa].szValue;
break;case ">=":W=Number(I[Aa])>=O.partA[Z].conditionA[xa].szValue}if(W===!1)break}W&&(Aa=O.partA[0].conditionA[0].szTopic,this.addFoundNode(y.item(A),Aa,null,I))}}}}return this.foundNodesA};ixMap.Query.prototype.searchItemByAttribute=function(x,y){this.foundNodesA.length=0;for(var A=[],I=map.SVGRootElement.getElementsByTagName("path"),O=0;O<I.length;O++)A[A.length]=I.item(O);I=map.SVGRootElement.getElementsByTagName("use");for(O=0;O<I.length;O++)A[A.length]=I.item(O);I=map.SVGRootElement.getElementsByTagName("g");
for(O=0;O<I.length;O++)A[A.length]=I.item(O);for(O=0;O<A.length;O++){if(A[O].getAttributeNS(null,x)==y){I=A[O].getAttributeNS(szMapNs,"info");if(I==null||I.length===0)I=A[O].parentNode.getAttributeNS(szMapNs,"info");I=I.split("|");this.addFoundNode(A[O],null,null,I)}if(A[O].getAttributeNS(szMapNs,x)==y){I=A[O].getAttributeNS(szMapNs,"info");if(I==null||I.length===0)I=A[O].parentNode.getAttributeNS(szMapNs,"info");I=I.split("|");this.addFoundNode(A[O],null,null,I)}}return this.foundNodesA};ixMap.Query.prototype.gotoFoundItem=
function(x,y,A){map.Query&&(y=="0"?map.Query.execGotoFoundItem(x,y,A):(displayMessage("please wait ...",500),setTimeout("map.Query.execGotoFoundItem("+x+",'"+y+"',"+A+")",100)))};ixMap.Query.prototype.execGotoFoundItem=function(x,y,A){map.SVGPopupGroup&&map.SVGPopupGroup.fu.clear();if(y==null||y=="undefined")y="3";if(x<0)if(y=="select")map.Selections.newSelection(this.szThemesA[0],this.foundNodesA,"type:queryresult",this.szQuery);else if(y=="zoomto"){if(this.map.SVGDocument.getElementById("mapzoomandpan")){y=
new point(1E5,1E5);var I=new point(-1E5,-1E5);for(x=0;x<this.foundNodesA.length;x++){A=map.Dom.getBox(this.foundNodesA[x].node);if(A.width===0||A.height===0){var O=getMatrix(this.foundNodesA[x].node);A.x+=O[4];A.y+=O[5];A.width=map.Scale.viewBox.width/20;A.height=map.Scale.viewBox.height/20;A.x-=A.width/2;A.y-=A.height/2}O=map.Scale.getMapOffset(this.foundNodesA[x].node);A.x+=O.x;A.y+=O.y;y.x=Math.min(y.x,A.x);y.y=Math.min(y.y,A.y);I.x=Math.max(I.x,A.x+A.width);I.y=Math.max(I.y,A.y+A.height)}y=new box(y.x,
y.y,I.x-y.x,I.y-y.y);y.scale(1.2);y=map.Zoom.clipArea(y);map.Zoom.setNewArea(y);this.foundNodesA.length==1&&displayInfoDelayed(null,this.foundNodesA[0].node,1E3)}}else for(clearThemes(),map.highLightList.removeAll(),x=0;x<this.foundNodesA.length;x++){if(!y.match(/info/)||!map.Themes.isNodePartOfAnyTheme(this.foundNodesA[x].node)){A=map.Layer.getLayerItemNodes(this.foundNodesA[x].node);for(O=0;O<A.length;O++)map.highLightList.addItem(A[O]);map.highLightList.startToggle()}y.match(/info/)&&displayInfo(null,
this.foundNodesA[x].node,"add|fix")}else if(x<this.foundNodesA.length){x=this.foundNodesA[x].node;this.map._activeItem=x;this.map._activeTheme=null;clearThemes();map.highLightList.removeAll();if(!map.Themes.isNodePartOfAnyTheme(x)){A=map.Layer.getLayerItemNodes(x);for(O=0;O<A.length;O++)map.highLightList.addItem(A[O]);map.highLightList.startToggle()}if(y=="0"&&map.Scale.nZoomScale==1)displayInfo(null,x);else{A=map.Dom.getBox(x);A=new box(A.x,A.y,A.width,A.height);if(A.width===0||A.height===0)I=map.Zoom.getBox(),
O=getMatrix(x),A.x+=O[4],A.y+=O[5],A.width=Math.min(I.width,map.Scale.bBox.width/10),A.height=Math.min(I.height,map.Scale.bBox.height/10),A.x-=A.width/2,A.y-=A.height/2;O=map.Scale.getMapOffset(x);A.x+=O.x;A.y+=O.y;if(y=="0"){if(map.Zoom.isVisibleBox(A)){displayInfo(null,x);return}I=map.Zoom.getBox();A.scale(Math.min(I.width/A.width,I.height/A.height))}else A.scale(2);A=map.Zoom.clipArea(A);y=="0"?map.Zoom.setNewCenter(A):map.Zoom.setNewArea(A);displayInfoDelayed(null,x,1E3)}}};var Ga=function(){this.partA=
[]};Ga.prototype.newPart=function(){this.partA[this.partA.length]=this.actPart=new t};var t=function(){this.conditionA=[]};t.prototype.addCondition=function(x,y,A){this.conditionA[this.conditionA.length]=new H(x,y,A)};var H=function(x,y,A){this.szTopic=x;this.szOperator=y;this.szValue=A}})();(function(){function Ga(d){d=map.Themes.getMapThemeDefinitionObj(d.szId);for(var a="",g=0;g<W.length;g++){a:{var b=d.style[W[g].style];var r=W[g].style;var n=W[g].type,v=W[g].delimiter;v=v?v:",";if(typeof b!="undefined"&&b!=null)if(n&&typeof n!="undefined")if(n=="array"&&b&&b.length&&typeof b=="object"){b=b.join(v);r=r+":"+b+";";break a}else{if(n=="object"&&b){r=r+":"+JSON.stringify(b)+";";break a}}else{r=r+":"+String(b)+";";break a}r=""}a+=r}return a.replace(/"/gi,'\\"')}function t(d){return typeof d!==
"undefined"&&d!=null}function H(d,a,g){d=Number(d)||0;a=Number(a)||0;return g&&g.match(/pow/)?Math.pow(d,a):g&&g.match(/factor/)?d*a:g&&(g.match(/add/)||g.match(/delta/))?d+a:a}function x(d,a,g){d=d||0;a=a||0;return g&&g.match(/factor/)?a:g&&g.match(/add/)?(d+a)/d:a/d}function y(d,a,g,b,r){this.szName=d;this.coTable=g;this.szSelectionField=b;this.szItemField=r;this.nIndex=a;this.nFieldIndexA=[];this.nField100IndexA=[];this.nFieldSelectionIndex=-1;this.nFieldSelectionIndexA=[];this.nLabelFieldIndex=
this.nValueFieldIndex=this.nFieldItemIndex=-1;this.leadOffset=!1}function A(d,a,g,b,r,n,v){var c;this.fDone=!1;this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nNoData=this.nCount=this.nSum=0;this.szThemes=d||"";this.szThemesA=this.szThemes.split("|");this.checkTheme();this.objThemesA=[];this.szFields=a||"$item$";this.szFieldsA=this.szFields.split("|");this.szField100=g||"";this.szField100A=g?g.split("|"):null;this.nFieldsA=[];this.nFields100A=[];this.nFieldsSelectionA=[];this.nMinA=[];
this.nMaxA=[];this.nSumA=[];this.nMeanA=[];this.nMedianA=[];this.nDeviationA=[];this.nOrigMinA=[];this.nOrigMaxA=[];this.nOrigSumA=[];for(c=0;c<this.szFieldsA.length;c++)this.nMinA[c]=Number.MAX_VALUE,this.nMaxA[c]=-Number.MAX_VALUE,this.nSumA[c]=0,this.nOrigMinA[c]=Number.MAX_VALUE,this.nOrigMaxA[c]=-Number.MAX_VALUE,this.nOrigSumA[c]=0,this.nMedianA[c]=0,this.nMeanA[c]=0;this.nMin100=Number.MAX_VALUE;this.nMax100=-Number.MAX_VALUE;this.nSum100=0;this.nMinSize=Number.MAX_VALUE;this.nMaxSize=-Number.MAX_VALUE;
this.nSumSize=0;this.nMinAlpha=Number.MAX_VALUE;this.nMaxAlpha=-Number.MAX_VALUE;this.nSumAlpha=0;this.nMinX=Number.MAX_VALUE;this.nMaxX=-Number.MAX_VALUE;this.nSumX=0;this.nMinY=Number.MAX_VALUE;this.nMaxY=-Number.MAX_VALUE;this.nSumY=0;this.nDominantDFilter=this.szDominantFilter=null;this.nFilterA=[];this.dbTableA=[];this.dbFieldsA=[];this.dbRecordsA=[];if(r)for(c in this.origColorScheme=[],r)this.origColorScheme[c]=r[c];else this.origColorScheme=null;this.defaultColorScheme=["#008888","#00aaaa",
"#00cccc","#00eeee","#00ffff"];this.szTitle=n?n:d+" ["+a+"]";this.szTitle=map.Dictionary.getLocalText(this.szTitle);this.szTitle=this.szTitle.length>60?this.szTitle.slice(0,50)+" ...":this.szTitle;this.szUnits="";this.szXaxisA=this.szAlphaValueUnits=this.szSizeValueUnits=null;this.szOrigLabelA=this.szLabelA=v;this.szLegendLabelA=[];this.szLegendStyle="";this.evidenceMode="isolate";this.szAggregation="sum";this.nValuesA=[];this.szExactA=this.szRangesA=this.szValuesA=null;this.itemA=[];this.fDataCache=
this.fVisible=!0;this.fEditor=!1;this.fUndefinedValuePossible=this.fNegativeValuePossible=this.fNullIsValue=!0;this.fCheckRecordLength=!1;this.nStringToValue=1;this.nStringToValueA=[];this.szOrigFlag=this.szFlag=b?b:"CHOROPLETH";this.nValueScale=this.nScale=1;this.nRefreshTimeout=0;this.szId="theme"+String(Math.random());this.szShapeType="polygon";if(d=map.Layer.getLayerObj(this.szThemesA[0]))this.szShapeType=d.szType,this.szShapeType=="line"&&this.szOrigFlag.match(/BUFFER/)&&(this.szShapeType+="+buffer");
this.hiddenLayerA=[];this.szFlag.match(/CHART/)||(this.szFlag.match(/PIE/)?this.szOverviewChart="PIE":this.szFlag.match(/DONUT/)&&(this.szOverviewChart="DONUT"));this.szFlag.match(/ZEROISNOTVALUE/)&&(this.fNullIsValue=!1);this.szFlag.match(/ZEROISVALUE/)&&(this.fNullIsValue=!0);this.szFlag.match(/NEGATIVEISNOTVALUE/)&&(this.fNegativeValuePossible=!1);this.szFlag.match(/NEGATIVEISVALUE/)&&(this.fNegativeValuePossible=!0);this.szFlag.match(/UNDEFINEDISVALUE/)&&(this.fUndefinedValuePossible=!0);this.szFlag.match(/UNDEFINEDISNOTVALUE/)&&
(this.fUndefinedValuePossible=!1);this.szFlag.match(/CHECKRECORDLENGTH/)&&(this.fCheckRecordLength=!0);this.szFlag.match(/SUM/)&&(this.szAggregation="sum");this.szFlag.match(/MEAN/)&&(this.szAggregation="mean");this.szFlag.match(/MAX/)&&(this.szAggregation="max");if(this.szFlag.match(/CHART/)){if(this.szFlag.match(/CATEGORICAL/)||this.szFieldsA.length>1)this.fNullIsValue=!0;this.szFlag.match(/BUFFER/)||(this.fShadow=this.fOrigShadow=!0)}this.szFlag.match(/CATEGORICAL/)&&!this.szFlag.match(/AGGREGATE/)&&
(this.fNegativeValuePossible=!1);this.szFlag.match(/CATEGORICAL/)&&!this.szLabelA&&(this.szLabelA=[]);this.fGrayNoMember=this.fSortBeforeDraw=this.fClipCharts=!0;this.nClipTimeout=1E3;this.paintedShapeNodesA=[];this.szChoroplethInfoStyle=map.Themes.szChoroplethInfoStyle;this.nMaxThemeCharts=map.Themes.nMaxThemeCharts;this.nMaxShadowCharts=map.Themes.nMaxShadowCharts;this.nflushPaintShape=map.Themes.nflushPaintShape;this.nflushChartDraw=map.Themes.nflushChartDraw;this.themeNodesPosA=this.szFlag.match(/AGGREGATE|GROUP/)?
[]:map.Themes.themeNodesPosA;this.style={theme:this};this.setProperties=function(e){this.szFields=e.field||e.fields||this.szFields;this.szField100=e.field100||this.szField100;this.szFieldsA=a.split("|");this.szField100A=g?g.split("|"):null;this.style.setProperties(e)};this.style.setProperties=function(e){map.Themes.parseStyle(this.theme,e)}}function I(d,a){return d.y>a.y?1:-1}function O(d){Ba[d]||(Ba[d]=new ha(d));return Ba[d]}function ha(d){typeof d!="string"&&(d="#ffffff");this.mainColor=d;this.lowColor=
ColorScheme.getDerivateColor(d,.7);this.highColor=ColorScheme.getDerivateColor(d,1.3);this.borderColor=ColorScheme.getBorderColor(d);this.textColor=ColorScheme.getTextColor(d)}function Z(d){if(typeof d=="string"&&d.match(/&#x/)){d=d.split("&#x");var a=d[0];for(var g=1;g<d.length;g++){var b=String,r=b.fromCharCode;var n=d[g].substr(0,2);n=parseInt(n,16);a+=r.call(b,n);a+=d[g].substr(3,d[g].length-3)}return a}return d}var W=[{style:"opacity",obj:"nOpacity"},{style:"fillopacity",obj:"fillOpacity"},{style:"autoopacity",
obj:"autoOpacity"},{style:"shadow",obj:"fOrigShadow"},{style:"blur",obj:"nBlur"},{style:"filter",obj:"szFilter"},{style:"dfilter",obj:"nDeltaFilter"},{style:"filterfield",obj:"szFilterField"},{style:"visible",obj:"fVisible"},{style:"dbtable",obj:"coTable"},{style:"dbtableUrl",obj:"coTableUrl"},{style:"dbtableType",obj:"coTableType"},{style:"dbtableExt",obj:"coTableExt"},{style:"dbtableProcess",obj:"coTableProcess"},{style:"dbtableQuery",obj:"coTableQuery"},{style:"datacache",obj:"fDataCache"},{style:"itemfield",
obj:"szItemField"},{style:"lookupfield",obj:"szSelectionField"},{style:"lookuptoupper",obj:"fSelectionFieldToUpper"},{style:"lookupsuffix",obj:"szSelectionFieldSuffix"},{style:"lookupdigits",obj:"nSelectionFieldDigits"},{style:"lookuptonumber",obj:"fSelectionFieldToNumber"},{style:"lookupfield2",obj:"szSelectionField2"},{style:"showdata",obj:"fShowData"},{style:"datafields",obj:"szDataFieldsA",type:"array"},{style:"userdraw",obj:"userDraw"},{style:"child",obj:"fChild"},{style:"crsdatum",obj:"szCRSDatum"},
{style:"crsutmzone",obj:"szCRSUTMZone"},{style:"server",obj:"szServer"},{style:"ranges",obj:"szRangesA",type:"array"},{style:"rangecentervalue",obj:"nRangeCenterValue"},{style:"symbols",obj:"szSymbolsA",type:"array"},{style:"values",obj:"szValuesA",type:"array",delimiter:"|"},{style:"colorvalues",obj:"szColorValuesA",type:"array",delimiter:"|"},{style:"symbolvalues",obj:"szSymbolValuesA",type:"array",delimiter:"|"},{style:"label",obj:"szOrigLabelA",type:"array",delimiter:"|"},{style:"valuemap",obj:"valueMap",
type:"object"},{style:"xaxis",obj:"szXaxisA",type:"array"},{style:"units",obj:"szUnits"},{style:"labelunits",obj:"szLabelUnits"},{style:"titleunits",obj:"szTitleUnits"},{style:"units100",obj:"szUnits100"},{style:"sizevalueunits",obj:"szSizeValueUnits"},{style:"alphavalueunits",obj:"szAlphaValueUnits"},{style:"legendunits",obj:"szLegendUnits"},{style:"weights",obj:"szWeights"},{style:"align",obj:"szAlign"},{style:"offsetx",obj:"nOffsetX"},{style:"offsety",obj:"nOffsetY"},{style:"rotation",obj:"nRotation"},
{style:"refreshtimeout",obj:"nRefreshTimeout"},{style:"normalsizevalue",obj:"nNormalSizeValue"},{style:"normalsizescale",obj:"szNormalSizeScale"},{style:"scale",obj:"nScale"},{style:"rangescale",obj:"nRangeScale"},{style:"sizepow",obj:"nSizePow"},{style:"outlierscale",obj:"nOutlierScale"},{style:"colorfield",obj:"szColorField"},{style:"symbolfield",obj:"szSymbolField"},{style:"valuefield",obj:"szValueField"},{style:"labelfield",obj:"szLabelField"},{style:"sizefield",obj:"szSizeField"},{style:"timefield",
obj:"szTimeField"},{style:"alphafield",obj:"szAlphaField"},{style:"alphafield100",obj:"szAlphaField100"},{style:"xfield",obj:"szXField"},{style:"yfield",obj:"szYField"},{style:"dopacitypow",obj:"nDopacityPow"},{style:"dopacityramp",obj:"szDopacityRamp"},{style:"dopacityscale",obj:"nDopacityScale"},{style:"brightness",obj:"nBrightness"},{style:"buffersize",obj:"nBufferSize"},{style:"bufferstep",obj:"nBufferSizeStep"},{style:"field100min",obj:"nField100Min"},{style:"fractionscale",obj:"nFractionScale"},
{style:"minvalue",obj:"nMinValue"},{style:"maxvalue",obj:"nMaxValue"},{style:"lowvalue",obj:"nLowValue"},{style:"highvalue",obj:"nHighValue"},{style:"textfont",obj:"szTextFont"},{style:"textcolor",obj:"szTextColor"},{style:"textscale",obj:"nTextScale"},{style:"linecolor",obj:"szLineColor"},{style:"linecolor",obj:"szLineColorA",type:"array"},{style:"linewidth",obj:"nLineWidth"},{style:"markersize",obj:"nMarkerSize"},{style:"gapsize",obj:"nGapSize"},{style:"bordercolor",obj:"szBorderColor"},{style:"borderstyle",
obj:"szBorderStyle"},{style:"borderwidth",obj:"szBorderWidth"},{style:"borderradius",obj:"nBorderRadius"},{style:"boxcolor",obj:"szBoxColor"},{style:"boxopacity",obj:"nBoxOpacity"},{style:"boxmargin",obj:"nBoxMargin"},{style:"textplacement",obj:"szTextPlacement"},{style:"infotitle",obj:"szInfoTitle"},{style:"titlefield",obj:"szTitleField"},{style:"snippetfield",obj:"szSnippetField"},{style:"exclude",obj:"szExcludeA",type:"array"},{style:"nodatacolor",obj:"szNoDataColor"},{style:"titleupper",obj:"szTitleUpper"},
{style:"titlelower",obj:"szTitleLower"},{style:"labelupper",obj:"szLabelUpper"},{style:"labellower",obj:"szLabelLower"},{style:"valueupper",obj:"szValueUpper"},{style:"valuelower",obj:"szValueLower"},{style:"glowupper",obj:"szGlowUpper"},{style:"glowlower",obj:"szGlowLower"},{style:"chartupper",obj:"szChartUpper"},{style:"chartlower",obj:"szChartLower"},{style:"layerupper",obj:"szLayerUpper"},{style:"layerlower",obj:"szLayerLower"},{style:"featureupper",obj:"szFeatureUpper"},{style:"featurelower",
obj:"szFeatureLower"},{style:"boxupper",obj:"szBoxUpper"},{style:"boxlower",obj:"szBoxLower"},{style:"shadowupper",obj:"szShadowUpper"},{style:"shadowlower",obj:"szShadowLower"},{style:"declutterupper",obj:"szDeclutterUpper"},{style:"valuescale",obj:"nValueScale"},{style:"valuecolor",obj:"szValueColor"},{style:"minvaluesize",obj:"nValueSizeMin"},{style:"minvaluevalue",obj:"nValueValueMin"},{style:"valuedecimals",obj:"nValueDecimals"},{style:"fadevaluepow",obj:"szFadeValuePow"},{style:"fadenegative",
obj:"nFadeNegative"},{style:"centerpart",obj:"szCenterPart"},{style:"clipframes",obj:"nClipFrames"},{style:"clipframerate",obj:"nClipFrameRate"},{style:"cliplegend",obj:"nClipColorLegend"},{style:"clipparts",obj:"nClipParts"},{style:"minchartsize",obj:"nChartSizeMin"},{style:"maxcharts",obj:"nMaxCharts"},{style:"showparts",obj:"szShowParts"},{style:"gridx",obj:"nGridX"},{style:"gridwidth",obj:"nGridWidth"},{style:"gridmatrix",obj:"nGridMatrix"},{style:"gridwidthpx",obj:"nGridWidthPx"},{style:"gridoffsetx",
obj:"nGridOffsetX"},{style:"gridoffsety",obj:"nGridOffsetY"},{style:"aggregationfield",obj:"szAggregationField"},{style:"aggregationscale",obj:"szAggregationFieldA",type:"array"},{style:"aggregation",obj:"szAggregation"},{style:"minaggregation",obj:"szMinAggregation"},{style:"aggregationupper",obj:"szAggregationUpper"},{style:"aggregationlower",obj:"szAggregationLower"},{style:"clipupper",obj:"szClipUpper"},{style:"cliplower",obj:"szClipLower"},{style:"dominantfilter",obj:"szDominantFilter"},{style:"dominantdfilter",
obj:"nDominantDFilter"},{style:"overviewchart",obj:"szOverviewChart"},{style:"evidence",obj:"evidenceMode"},{style:"markclass",obj:"markedClass"},{style:"markclasses",obj:"markedClassesA",type:"array"},{style:"name",obj:"szName"},{style:"title",obj:"szTitle"},{style:"snippet",obj:"szSnippet"},{style:"splash",obj:"szSplash"},{style:"description",obj:"szDescription"},{style:"tooltip",obj:"szTooltip"}],Q=function(d){if(!/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(d))throw Error("Invalid global object name: "+
d);if(typeof window!=="undefined"&&window.hasOwnProperty(d))return window[d];if(typeof global!=="undefined"&&global.hasOwnProperty(d))return global[d]},xa=function(d){typeof d!=="string"&&(d=String(d));return d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},Aa=function(d,a,g){try{g=g?"g":"gi";var b=xa(a);return(new RegExp(b,g)).test(d)}catch(r){return!1}},Oa=function(d){typeof d!=="string"&&(d=String(d));return d.replace(/'/g,"\\'").replace(/"/g,"&quot;")},aa=function(d){try{var a=JSON.parse(d);if(a&&typeof a===
"object"){"__proto__"in a&&delete a.__proto__;"constructor"in a&&delete a.constructor;for(var g in a)a.hasOwnProperty(g)&&typeof a[g]==="object"&&a[g]!==null&&(a[g]=aa(JSON.stringify(a[g])))}return a}catch(b){return console.error("JSON parse error: "+b.message),null}};ixMap.Themes=function(){this.themesA=[];this.themeNodesA=[];this.themeNodesPosA=[];this.themeNodesBoxA=[];this.themeNodes=0;this.activeBuffer=this.activeTheme=null;this.switchedLayerA=[];this.enableMultiChoropleth=this.enableChartOffset=
!1;this.enableSubThemes=!0;this.szChoroplethInfoStyle="histogram|";this.nMaxThemeCharts=1E6;this.nMaxShadowCharts=1E3;this.nflushPaintShape=5E3;this.nflushChartDraw=1E3;this.nColorSchemeMaxHeight=120;this.autoHideInfoTools=this.allwaysShowValues=!1;this.themeDataCacheA=[];this.__lastActualizeParam=this.__actualizeTimeout=this.__wmsRedrawTimeout=null};ixMap.Themes.prototype=new Map;if(typeof thisversion=="string"&&map.checkVersion(thisversion)){map.Themes=new ixMap.Themes;try{map.HTMLWindow&&map.HTMLWindow.ixmaps&&
map.HTMLWindow.ixmaps.htmlgui_onInitThemes&&map.HTMLWindow.ixmaps.htmlgui_onInitThemes()}catch(d){}}else alert("ixMap.Themes incompatible !");ixMap.Themes.prototype.addTheme=function(d){this.themesA[this.themesA.length]=d;if(!d.szFlag.match(/selection/i))try{map.HTMLWindow.ixmaps.htmlgui_onNewTheme(d.szId)}catch(a){}};ixMap.Themes.prototype.getThemeCount=function(){return this.themesA.length};ixMap.Themes.prototype.getAllThemes=function(){return this.themesA};ixMap.Themes.prototype.getThemes=function(){return this.themesA};
ixMap.Themes.prototype.isTheme=function(d){for(var a=0;a<this.themesA.length;a++)if(this.themesA[a].szIdStr&&this.themesA[a].szIdStr==d)return this.themesA[a];return!1};ixMap.Themes.prototype.isIdle=function(){for(var d=0;d<this.themesA.length;d++)if(!this.themesA[d].fRealizeDone)return!1;return!0};ixMap.Themes.prototype.isArray=function(d){return Object.prototype.toString.call(d)==="[object Array]"};ixMap.Themes.prototype.isObject=function(d){return Object.prototype.toString.call(d)==="[object Object]"};
ixMap.Themes.prototype.toArray=function(d){if(this.isObject(d)){var a=[],g;for(g in d)a.push(g),a.push(d[g]);return a}return this.isArray(d)?d:String(d).match(/\|/)||String(d).match(/RGB/)?String(d).split("|"):String(d).split(",")};ixMap.Themes.prototype.toString=function(d){return this.isArray(d)?d.join("|"):d};ixMap.Themes.prototype.newTheme=function(d,a,g,b,r,n){var v=b.split("style=");b=v&&v.length>1?__getStyleObj(v[1]):__getStyleObj(b);b.label=n&&n!="undefined"?n.split("|"):b.label||null;b.szTitle=
r;return this.newThemeByObj({layer:d,field:a,field100:g,style:b})};ixMap.Themes.prototype.newThemeByObj=function(d,a){if(map.isIdle()){if(this.newThemeObjA&&this.newThemeObjA.length&&(d&&this.newThemeObjA.push(d),d=this.newThemeObjA.shift()),d){var g=JSON.stringify(d);if(this.isTheme(g)&&d.style.type.match(/TOGGLE/))return this.removeTheme(null,this.isTheme(g).szId),null;var b=null,r=d.style;if(!r)return null;if(this.isArray(r.label)){b=r.label;var n=r.label.join("|")}else b=(n=r.label)&&n!="undefined"?
n.split("|"):null;n=[5,"white","blue"];r.colorscheme&&(n=this.toArray(r.colorscheme));d.layer=this.toString(d.layer);d.field=this.toString(d.field);r.type.match(/\bEXACT\b/)&&!r.type.match(/\bCATEGORICAL\b/)&&(r.type+="|CATEGORICAL");b=new A(d.layer,d.field,d.field100,r.type,n,r.title,b);b.nOrder=this.getThemeCount();b.szIdStr=g;b.origDef=d;this.parseStyle(b,r);this.allwaysShowValues&&(b.szFlag+="|VALUES");b.parent=this;this.addTheme(b);b.fRealize=!0;b.szFlag.match(/CHOROPLETH||BUFFER/)||b.createChartGroup(map.Layer.objectGroup);
map.Event.doDefaultZoom();a&&a.match(/fast|silent|direct/)?map.Themes.execute():executeWithMessage(()=>map.Themes.execute(),"... processing ...");return b}}else d&&(this.newThemeObjA=this.newThemeObjA||[],this.newThemeObjA.push(d)),setTimeout(function(){map.Themes.newThemeByObj()},100)};ixMap.Themes.prototype.parseStyle=function(d,a){if(d&&a){if(t(a.classes)){if(isNaN(Number(d.origColorScheme[0]))){var g=d.origColorScheme[d.origColorScheme.length-1];d.origColorScheme[1]=d.origColorScheme[0];d.origColorScheme[2]=
g}d.origColorScheme[0]=Number(a.classes)}t(a.colorstyle)&&d.origColorScheme[1]=="spectrum"&&(d.origColorScheme[2]=a.colorstyle);t(a.dominantdfilter)&&(d.nDominantDFilter=Number(a.dominantdfilter));t(a.dominantfilter)&&(d.szDominantFilter=String(a.dominantfilter));t(a.filter)&&(d.szFilter=String(a.filter));t(a.filterfield)&&(d.szFilterField=String(a.filterfield));t(a.filtervalue)&&(d.szFilterValue=String(a.filtervalue));t(a.overviewchart)&&(d.szOverviewChart=a.overviewchart);t(a.evidence)&&(d.evidenceMode=
a.evidence);t(a.markclass)&&(d.markedClass=a.markclass,d.markedClasses||(d.markedClasses=[],d.markedClasses[d.markedClass]=!0,d.markedClassesA=[d.markedClass]));t(a.markclasses)&&(d.markedClassesA=this.toArray(a.markclasses),d.markedClasses=[],d.markedClassesA.forEach(function(b,r){b.length&&(d.markedClasses[b]=!0,d.markedClass=b)}));t(a.fillopacity)&&(a.fillopacity=="auto"?(d.autoOpacity=!0,d.fillOpacity=0):d.fillOpacity=Number(a.fillopacity));t(a.opacity)&&(a.opacity=="auto"?(d.autoOpacity=!0,d.fillOpacity=
0):d.nOpacity=Number(a.opacity));t(a.autoopacity)&&(d.autoOpacity=!0,d.fillOpacity=0);t(a.shadow)?d.fShadow=d.fOrigShadow=aa(a.shadow):d.fShadow=d.fOrigShadow=!1;t(a.maxshadow)&&(d.nMaxShadowCharts=Number(a.maxshadow));t(a.blur)&&(d.nBlur=Number(a.blur));t(a.dbtable)&&(g=a.dbtable.split(" "),d.coTable=g[0],g.length==2&&(d.coTableType="jsonDB",d.coTableUrl=g[1].split("(")[1].split(")")[0]),g.length==3&&(d.coTableType=g[1],d.coTableUrl=g[2].split("(")[1].split(")")[0]),g.length==4&&(d.coTableType=g[1],
d.coTableUrl=g[2].split("(")[1].split(")")[0],d.coTableExt=g[3].split("(")[1].split(")")[0]));t(a.dbtableType)&&(d.coTableType=a.dbtableType);t(a.dbtableUrl)&&(d.coTableUrl=a.dbtableUrl);t(a.dbtableExt)&&(d.coTableExt=a.dbtableExt);t(a.dbtableProcess)&&(d.coTableProcess=a.dbtableProcess);t(a.dbtableQuery)&&(d.coTableQuery=a.dbtableQuery);t(a.lookupfield)&&(d.szSelectionField=d.szItemField=a.lookupfield);t(a.lookupfield2)&&(d.szSelectionField2=a.lookupfield2);t(a.lookuptoupper)&&(d.fSelectionFieldToUpper=
aa(a.lookuptoupper));t(a.lookupsuffix)&&(d.szSelectionFieldSuffix=a.lookupsuffix);t(a.lookupprefix)&&(d.szSelectionFieldPrefix=a.lookupprefix);t(a.lookupdigits)&&(d.nSelectionFieldDigits=Number(a.lookupdigits));t(a.lookuptonumber)&&(d.fSelectionFieldToNumber=aa(a.lookuptonumber));t(a.crsutmzone)&&(d.szCRSUTMZone=a.crsutmzone);t(a.crsdatum)&&(d.szCRSDatum=a.crsdatum);t(a.server)&&(d.szServer=a.server);t(a.itemfield)&&(d.szItemField=a.itemfield);t(a.ranges)&&(d.szRangesA=this.toArray(a.ranges),d.szRanges=
this.toString(a.ranges));t(a.symbols)&&(d.szSymbolsA=this.toArray(a.symbols));if(t(a.values)&&(d.szValuesA=this.toArray(a.values),a.type.match(/CATEGORICAL/)&&d.szValuesA.length))for(g=0;g<d.szValuesA.length;g++)d.getStringValueIndex(d.szValuesA[g],"set");t(a.means)&&(d.szMeansA=this.toArray(a.means));t(a.colorvalues)&&(d.szColorValuesA=this.toArray(a.colorvalues));t(a.symbolvalues)&&(d.szSymbolValuesA=this.toArray(a.symbolvalues));t(a.align)&&(d.szAlign=a.align);t(a.offsetx)&&(d.nOffsetX=Number(a.offsetx)||
0);t(a.offsety)&&(d.nOffsetY=Number(a.offsety)||0);t(a.rotation)&&(d.nRotation=Number(a.rotation)||0);t(a.units)&&(d.szUnits=a.units);t(a.units100)&&(d.szUnits100=a.units100);t(a.sizevalueunits)&&(d.szSizeValueUnits=" "+a.sizevalueunits);t(a.alphavalueunits)&&(d.szAlphaValueUnits=" "+a.alphavalueunits);t(a.legendunits)&&(d.szLegendUnits=" "+a.legendunits);t(a.labelunits)&&(d.szLabelUnits=" "+a.labelunits);t(a.titleunits)&&(d.szTitleUnits=" "+a.titleunits);t(a.xaxis)&&(d.szXaxisA=this.toArray(a.xaxis));
t(a.id)&&(d.szId=unescape(a.id));t(a.name)&&(d.szId=d.szName=unescape(a.name));t(a.title)&&(d.szTitle=unescape(a.title));t(a.snippet)&&(d.szSnippet=unescape(a.snippet));t(a.splash)&&(d.szSplash=unescape(a.splash));t(a.description)&&(d.szDescription=unescape(a.description));t(a.tooltip)&&(d.szTooltip=unescape(a.tooltip));t(a.label)&&(d.szLabelA=d.szOrigLabelA=this.toArray(a.label));t(a.weights)&&(d.szWeightsA=this.toArray(a.weights),d.szWeights=this.toString(a.weights));t(a.weight)&&(d.szWeightsA=
[a.weights],d.szWeights=a.weight);t(a.scale)&&(d.nScale=Number(a.scale));t(a.colorfield)&&(d.szColorField=a.colorfield);t(a.symbolfield)&&(d.szSymbolField=a.symbolfield);t(a.valuefield)&&(d.szValueField=a.valuefield);t(a.labelfield)&&(d.szLabelField=a.labelfield);t(a.titlefield)&&(d.szTitleField=a.titlefield);t(a.snippetfield)&&(d.szSnippetField=a.snippetfield);t(a.sizefield)&&(d.szSizeField=a.sizefield);t(a.timefield)&&(d.szTimeField=a.timefield);t(a.alphafield)&&(d.szAlphaField=a.alphafield);t(a.alphafield100)&&
(d.szAlphaField100=a.alphafield100);t(a.xfield)&&(d.szXField=a.xfield);t(a.yfield)&&(d.szYField=a.yfield);t(a.refresh)&&(d.nRefreshTimeout=Number(a.refresh)*1E3);t(a.refreshtimeout)&&(d.nRefreshTimeout=Number(a.refreshtimeout));t(a.buffersize)&&(d.nBufferSize=a.buffersize);t(a.bufferstep)&&(d.nBufferSizeStep=a.bufferstep);t(a.field100min)&&(d.nField100Min=a.field100min);t(a.fractionscale)&&(d.nFractionScale=a.fractionscale);t(a.minvalue)&&(d.nMinValue=a.minvalue);t(a.maxvalue)&&(d.nMaxValue=a.maxvalue);
t(a.lowvalue)&&(d.nLowValue=a.lowvalue);t(a.highvalue)&&(d.nHighValue=a.highvalue);t(a.showdata)&&(d.fShowData=aa(a.showdata));t(a.datacache)&&(d.fDataCache=aa(a.datacache));t(a.editor)&&(d.fEditor=aa(a.editor));t(a.datafields)&&(d.szDataFieldsA=this.toArray(a.datafields));t(a.textcolor)&&(d.szTextColor=a.textcolor);t(a.textfont)&&(d.szTextFont=a.textfont);t(a.textscale)&&(d.nTextScale=Number(a.textscale));t(a.linecolor)&&(d.szLineColorA=this.toArray(a.linecolor),d.szLineColor=d.szLineColorA[d.szLineColorA.length-
1]);t(a.linewidth)&&(d.nLineWidth=a.linewidth);t(a.markersize)&&(d.nMarkerSize=a.markersize);t(a.gapsize)&&(d.nGapSize=a.gapsize);t(a.bordercolor)&&(d.szBorderColor=a.bordercolor);t(a.borderstyle)&&(d.szBorderStyle=a.borderstyle);t(a.borderwidth)&&(d.szBorderWidth=a.borderwidth);t(a.borderradius)&&(d.nBorderRadius=Number(a.borderradius));t(a.boxcolor)&&(d.szBoxColor=a.boxcolor);t(a.boxopacity)&&(d.nBoxOpacity=a.boxopacity);t(a.boxmargin)&&(d.nBoxMargin=a.boxmargin);t(a.textplacement)&&(d.szTextPlacement=
a.textplacement);t(a.infotitle)&&(d.szInfoTitle=a.infotitle);t(a.exclude)&&(d.szExcludeA=this.toArray(a.exclude));t(a.aggregation)&&(d.szAggregation=a.aggregation);t(a.rangecentervalue)&&(d.nRangeCenterValue=Number(a.rangecentervalue));t(a.rangescale)&&(d.nRangeScale=a.rangescale);t(a.normalsizevalue)&&(d.nNormalSizeValue=a.normalsizevalue);t(a.normalsizescale)&&(d.szNormalSizeScale=a.normalsizescale,d.nNormalSizeScale=X(d.szNormalSizeScale));t(a.nodatacolor)&&(d.szNoDataColor=ca(a.nodatacolor));
t(a.boxupper)&&(d.szBoxUpper=a.boxupper,d.nBoxUpper=X(d.szBoxUpper));t(a.boxlower)&&(d.szBoxLower=a.boxlower,d.nBoxLower=X(d.szBoxLower));t(a.titleupper)&&(d.szTitleUpper=a.titleupper,d.nTitleUpper=X(d.szTitleUpper));t(a.titlelower)&&(d.szTitleLower=a.titlelower,d.nTitleLower=X(d.szTitleLower));t(a.labelupper)&&(d.szLabelUpper=a.labelupper,d.nLabelUpper=X(d.szLabelUpper));t(a.labellower)&&(d.szLabelLower=a.labelupper,d.nLabelLower=X(d.szLabelLower));t(a.valueupper)&&(d.szValueUpper=a.valueupper,d.nValueUpper=
X(d.szValueUpper));t(a.valuesupper)&&(d.szValueUpper=a.valuesupper,d.nValueUpper=X(d.szValueUpper));t(a.valuelower)&&(d.szValueLower=a.valuelower,d.nValueLower=X(d.szValueLower));t(a.valueslower)&&(d.szValueLower=a.valueslower,d.nValueLower=X(d.szValueLower));t(a.glowupper)&&(d.szGlowUpper=a.glowupper,d.nGlowUpper=X(d.szGlowUpper));t(a.glowlower)&&(d.szGlowLower=a.glowlower,d.nGlowLower=X(d.szGlowLower));t(a.chartupper)&&(d.szChartUpper=a.chartupper,d.nChartUpper=X(d.szChartUpper));t(a.chartlower)&&
(d.szChartLower=a.chartlower,d.nChartLower=X(d.szChartLower));t(a.layerupper)&&(d.szLayerUpper=a.layerupper,d.nLayerUpper=X(d.szLayerUpper));t(a.layerlower)&&(d.szLayerLower=a.layerlower,d.nLayerLower=X(d.szLayerLower));t(a.featureupper)&&(d.szFeatureUpper=a.featureupper,d.nFeatureUpper=X(d.szFeatureUpper));t(a.featurelower)&&(d.szFeatureLower=a.featurelower,d.nFeatureLower=X(d.szFeatureLower));t(a.shadowupper)&&(d.szShadowUpper=a.shadowupper,d.nShadowUpper=X(d.szShadowUpper));t(a.shadowlower)&&(d.szShadowLower=
a.shadowlower,d.nShadowLower=X(d.szShadowLower));t(a.declutterupper)&&(d.szDeclutterUpper=a.declutterupper,d.nDeclutterUpper=X(d.szDeclutterUpper));t(a.valuecolor)&&(d.szValueColor=a.valuecolor);t(a.valuescale)&&(d.nValueScale=Number(a.valuescale));t(a.clipframes)&&(d.nClipFrames=a.clipframes);t(a.clipframerate)&&(d.nClipFrameRate=a.clipframerate,d.nClipTimeout=1/Number(a.clipframerate)*1E3);t(a.cliplegend)&&(d.nClipColorLegend=Number(a.cliplegend));t(a.clipvaluesize)&&(d.nValueSizeMin=Number(a.clipvaluesize));
t(a.minvaluesize)&&(d.nValueSizeMin=Number(a.minvaluesize));t(a.minvaluevalue)&&(d.nValueValueMin=Number(a.minvaluevalue));t(a.valuedecimals)&&(d.nValueDecimals=a.valuedecimals);t(a.fadevaluepow)&&(d.szFadeValuePow=a.fadevaluepow);t(a.dopacityscale)&&(d.nDopacityScale=a.dopacityscale);t(a.dopacityramp)&&(d.szDopacityRamp=a.dopacityramp);t(a.dopacitypow)&&(d.nDopacityPow=a.dopacitypow);t(a.fadenegative)&&(d.nFadeNegative=Number(a.fadenegative)||.5);t(a.brightness)&&(d.nBrightness=a.brightness);t(a.clipparts)&&
(d.nClipParts=Number(a.clipparts)||0);t(a.minsize)&&(d.nChartSizeMin=Number(a.minsize)||0);t(a.minchartsize)&&(d.nChartSizeMin=Number(a.minchartsize)||0);t(a.maxcharts)&&(d.nMaxCharts=Math.round(Number(a.maxcharts))||0);t(a.clipsize)&&(d.nChartSizeMin=Number(a.clipsize)||0);t(a.sizepow)&&(d.nSizePow=a.sizepow);t(a.outlierscale)&&(d.nOutlierScale=a.outlierscale);t(a.showparts)&&(d.szShowParts=this.toString(a.showparts),d.szShowPartsA=this.toArray(a.showparts));t(a.gridx)&&(d.nGridX=Number(a.gridx)||
1);t(a.gridwidth)&&(String(a.gridwidth).match(/px/)&&(d.nGridWidthPx=parseFloat(a.gridwidth)||50,map.Themes.doChangeThemeStyle(d.szId,"AUTOGRID","add")),d.nGridWidth=Number(a.gridwidth)||0);t(a.gridmatrix)&&(d.nGridMatrix=Number(a.gridmatrix)||20,map.Themes.doChangeThemeStyle(d.szId,"AUTOGRID","add"));t(a.gridwidthpx)&&(d.nGridWidthPx=Number(a.gridwidthpx)||50,map.Themes.doChangeThemeStyle(d.szId,"AUTOGRID","add"));t(a.gridoffsetx)&&(d.nGridOffsetX=Number(a.gridoffsetx)||0);t(a.gridoffsety)&&(d.nGridOffsetY=
Number(a.gridoffsety)||0);t(a.aggregationfield)&&(d.szAggregationField=a.aggregationfield);t(a.aggregationscale)&&(d.szAggregationFieldA=this.toArray(a.aggregationscale));t(a.aggregation)&&(d.szAggregationFieldA=this.toArray(a.aggregation));t(a.minaggregation)&&(d.szMinAggregation=a.minaggregation,d.nMinAggregation=Number(a.minaggregation)||0);t(a.aggregationupper)&&(d.szAggregationUpper=a.aggregationupper,d.nAggregationUpper=X(d.szAggregationUpper));t(a.aggregationlower)&&(d.szAggregationLower=a.aggregationlower,
d.nAggregationLower=X(d.szAggregationLower));t(a.clipupper)&&(d.szClipUpper=a.clipupper,d.nClipUpper=X(d.szClipUpper));t(a.cliplower)&&(d.szClipLower=a.cliplower,d.nClipLower=X(d.szClipLower));t(a.userdraw)&&(d.userDraw=a.userdraw);t(a.centerpart)&&(d.szCenterPart=this.toString(a.centerpart));t(a.child)&&(d.fChild=!0);t(a.valuemap)&&(d.valueMap=a.valuemap);t(a.visible)&&(d.fVisible=aa(a.visible))}};ixMap.Themes.prototype.getAllThemeDefinitionStrings=function(){for(var d=[],a=0;a<this.themesA.length;a++)d.push(this.getThemeDefinitionString(this.themesA[a]));
return d};var ca=function(d){try{if(d.charAt(0)=="#"){var a="0123456789abcdef";var g=parseInt(d.substr(1,2),16);var b=parseInt(d.substr(3,2),16);a=parseInt(d.substr(5,2),16);return"RGB("+g+","+b+","+a+")"}}catch(r){}return d},X=function(d){return String(d).match(/:/)?Number(d.split(":")[1]):Number(d)};ixMap.Themes.prototype.cleanUpThemeObj=function(d,a){d.field=a.field;a&&a.style&&(t(a.style.values)&&(d.style.values=a.style.values),t(a.style.label)&&(d.style.label=a.style.label),t(a.style.xaxis)&&
(d.style.xaxis=a.style.xaxis));a=d.style;if(a.colorscheme){var g=a.colorscheme[0];for(var b in a.colorscheme)if(a.colorscheme[b]!=g){g=null;break}g&&(a.colorscheme.length=1)}if(a.symbols){g=a.symbols[0];for(b in a.symbols)if(a.symbols[b]!=g){g=null;break}g&&(a.symbols.length=1)}a.aggregationscale?(a.aggregationfield=null,a.gridwidth=null,a.gridwidthpx=null):a.aggregationfield?(a.gridwidth=null,a.gridwidthpx=null):a.gridwidthpx&&(a.gridwidth=null);a.evidence&&a.evidence=="isolate"&&(a.evidence=null);
a.aggregation&&(a.aggregation=null);a.type.match(/DOMINANT/)||a.type.match(/PERCENTOFMEAN/)||a.type.match(/OFFSETMEAN/)||a.type.match(/PERCENTOFMEAN/)||a.type.match(/DEVIATION/)||(a.dominantfilter=null,a.dominantdfilter=null);a.itemfield&&a.lookupfield&&a.itemfield==a.lookupfield&&(a.itemfield=null);return d};ixMap.Themes.prototype.getThemeDefinitionString=function(d){var a='map.Api.newMapTheme("'+d.szThemes+'","'+(d.szFields||"")+'","'+(d.szField100||"")+'","type:'+d.szFlag+";colorscheme:";var g=
d.origColorScheme;for(var b=0;b<g.length;b++)g[b]=ca(g[b]);g=g.join("|");return a+g+";"+Ga(d)+';child:true;");'};ixMap.Themes.prototype.getMapThemeStyleString=function(d){return(d=this.getTheme(d)||this.activeTheme)&&d.colorScheme?"type:"+d.szFlag+";colorscheme:"+d.colorScheme+";"+Ga(d):null};ixMap.Themes.prototype.getMapThemeDefinitionObj=function(d){d=this.getTheme(d)||this.activeTheme;var a={};a.layer=d.szThemes;a.field=d.szFields||"";a.field100=d.szField100||"";if(d.szFlag.match(/\bWMS|IMAGE\b/)){var g=
{type:d.szFlag,server:d.szServer,opacity:d.nOpacity,title:d.szTitle,name:d.szName};a.style=g;return a}d.szFlag.match(/\bCATEGORICAL\b/)&&d.colorScheme&&d.colorScheme.length>3&&(!d.szValuesA||!d.szValuesA.length)&&d.szLabelA&&d.szLabelA.length&&d.szLabelA.length<=100&&(d.szValuesA=d.szLabelA.slice(0));g={type:d.szFlag,colorscheme:d.origColorScheme};for(var b={},r=0;r<W.length;r++)d[W[r].obj]!=null&&d[W[r].obj]!="undefined"&&(b[W[r].style]=d[W[r].obj]);for(var n in b)g[n]=b[n];a.style=g;return this.cleanUpThemeObj(a,
d.origDef)};ixMap.Themes.prototype.getTheme=function(d){if(!d)return this.activeTheme;if(d&&typeof d!="string"&&!isNaN(Number(d))&&Number(d)<this.themesA.length)return this.themesA[Number(d)];d=d.split(":")[0];for(var a=0;a<this.themesA.length;a++)if(this.themesA[a].szId==d||this.themesA[a].szName==d)return this.themesA[a];return!isNaN(Number(d))&&Number(d)<this.themesA.length?this.themesA[Number(d)]:this.activeTheme};ixMap.Themes.prototype.getThemeIndex=function(d){for(var a=0;a<this.themesA.length;a++)if(this.themesA[a].szId==
d)return a;return-1};ixMap.Themes.prototype.moveThemeToArrayPosition=function(d,a){if(!this.getTheme(d))return console.log("moveThemeToArrayPosition: Theme not found: "+d),!1;var g=this.getThemeIndex(d);if(g===-1)return console.log("moveThemeToArrayPosition: Theme not found in array: "+d),!1;a<0&&(a=0);a>=this.themesA.length&&(a=this.themesA.length-1);if(g===a)return console.log("moveThemeToArrayPosition: Theme already at position",a),!0;console.log("moveThemeToArrayPosition: Moving theme",d,"from index",
g,"to index",a);d=this.themesA[g];if(g<a)for(;g<a;g++)this.themesA[g]=this.themesA[g+1];else for(;g>a;g--)this.themesA[g]=this.themesA[g-1];this.themesA[a]=d;console.log("moveThemeToArrayPosition: Theme moved successfully");return!0};ixMap.Themes.prototype.refreshTheme=function(d){if(d=this.getTheme(d))d.initValues(),d.szValuesA=null,d.szFlag.match(/RANGES/)||(d.szRangesA=null),d.szExactA=null,d.fRealize=!0,d.fRedraw=!0,d.szFlag.match(/FEATURE/)&&(d.fClearOnProjectionChange=!0),!map.fAllIncluded&&
d.coTable?this.loadExternalData(d.coTable,!0,d):(d.animateTimeout&&clearTimeout(d.animateTimeout),executeWithMessage(()=>map.Themes.execute(),"... processing ..."))};ixMap.Themes.prototype.resetTheme=function(d){var a=map.Themes.getTheme(d);if(a){var g=a.chartGroup;a=map.Themes.getMapThemeDefinitionObj(d);map.Themes.themesA.splice(map.Themes.getThemeIndex[d],1);a.style.datacache=!1;a=map.Themes.newThemeByObj(a);a.chartGroup=g}};ixMap.Themes.prototype.nextClipFrame=function(d){(d=this.getTheme(d))&&
d.realizeNextClipFrame()};ixMap.Themes.prototype.setClipFrame=function(d,a){(d=d?this.getTheme(d):this.activeTheme)&&d.setClipFrame(a)};ixMap.Themes.prototype.pauseClip=function(d){(d=this.getTheme(d))&&d.pauseClip()};ixMap.Themes.prototype.startClip=function(d){(d=this.getTheme(d))&&d.startClip()};ixMap.Themes.prototype.loadExternalData=function(d,a,g){this.coTableExt||(this.coTableExt=[]);if(d){var b=map.Dictionary.getLocalText("... creating theme ...");if(a){try{var r=Q(d);r!==void 0&&r.table&&
(r.table=null)}catch(v){}b=map.Dictionary.getLocalText("... refreshing theme ...")}this.__test=null;try{if((r=Q(d))&&r.table)this.__test=r.table;else{var n=Q(d+"_table");n&&(this.__test=n)}}catch(v){}a=g.fEditor||!(g.coTableUrl&&g.coTableExt)||!1;this.themeDataCacheA[d]&&((this.themeDataCacheA[d].coTableUrl||g.coTableUrl)&&this.themeDataCacheA[d].coTableUrl!=g.coTableUrl||(this.themeDataCacheA[d].coTableExt||g.coTableExt)&&this.themeDataCacheA[d].coTableExt!=g.coTableExt||(a=!0));if(this.__test&&
a&&g.fDataCache===!0)this.fWaitforData=!1,g.fWaitingforData=!1,executeWithMessage(()=>map.Themes.execute(),b),g&&g.coTableExt&&(g.coTableExt=this.coTableExt[g.coTable]);else if(g&&(g.coTableUrl||g.coTableExt||g.coTableType=="ext"))try{this.themeDataCacheA[d]={coTableUrl:g.coTableUrl,coTableExt:g.coTableExt},this.fWaitforData=!0,g.fWaitingforData=!0,map.HTMLWindow.ixmaps.htmlgui_loadExternalData(g.coTableUrl,{theme:g,type:g.coTableType,name:g.coTable,ext:g.coTableExt}),this.coTableExt[g.coTable]=g.coTableExt}catch(v){}}};
ixMap.Themes.prototype.loadExternalDataZipped=function(d,a,g){this.fWaitforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var b=new JSLoader;b.finishedCallback="map.Themes.loadExternalDataFinish('"+g+"')";b.errorCallback="map.Themes.loadExternalDataDefault('"+d+"',"+a+",'"+g+"')";b.szMessage=map.Dictionary.getLocalText("... loading data ...");b.loadScript(map.mapRoot+d+".js.gz",a)};ixMap.Themes.prototype.loadExternalDataDefault=function(d,a,g){this.fWaitforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));
var b=new JSLoader;b.finishedCallback="map.Themes.loadExternalDataFinish('"+g+"')";b.errorCallback="map.Themes.loadExternalDataFinish('"+g+"')";b.szMessage=map.Dictionary.getLocalText("... loading data ...");b.loadScript(map.mapRoot+d+".js",a)};ixMap.Themes.prototype.loadExternalDataFinish=function(d){this.fWaitforData=!1;executeWithMessage(()=>map.Themes.execute(),d)};ixMap.Themes.prototype.setExternalData=function(d,a,g){if(a){this._dataObj=a;try{typeof window!=="undefined"&&/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(g)&&
(window[g]=this._dataObj)}catch(r){console.error("Error setting window property: "+r.message)}}this.fWaitforData=!1;d=this.getAllThemes();for(var b in d)d[b].coTable==g&&(d[b].fWaitingforData=!1);this.execute()};ixMap.Themes.prototype.activateTheme=function(d,a){if(a=this.getTheme(a))a.fRedraw=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ...");d.stopPropagation();d.preventDefault()};ixMap.Themes.prototype.showTheme=function(d,a){if(a=this.getTheme(a))a.fShow=!0,executeWithMessage(()=>
map.Themes.execute(),"... processing ...");d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.hideTheme=function(d,a){if(a=this.getTheme(a))a.fHide=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ...");d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.toggleTheme=function(d,a){if(a=this.getTheme(a))a.fToggle=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ...");d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.removeTheme=
function(d,a,g){if(!a)return d&&(d.stopPropagation(),d.preventDefault()),!1;a=String(a).split(":")[0];for(var b=null,r=0;r<this.themesA.length;r++){var n=this.themesA[r],v=n.szId?String(n.szId).split(":")[0]:null,c=n.szName?String(n.szName).split(":")[0]:null;if(v&&v==a||c&&c==a){b=n;break}}!b&&!isNaN(Number(a))&&Number(a)<this.themesA.length&&(b=this.themesA[Number(a)]);if(!b)return d&&(d.stopPropagation(),d.preventDefault()),!1;r=b.szId&&String(b.szId).split(":")[0]==a;n=b.szName&&String(b.szName).split(":")[0]==
a;if(!(r||n||!isNaN(Number(a))&&Number(a)<this.themesA.length)||b.szFlag&&b.szFlag.match(/LOCKED/))return d&&(d.stopPropagation(),d.preventDefault()),!1;if(g)return this.themesA.length>1&&!b.szFlag.match(/SELECTION/)&&!b.szFlag.match(/CHART/)&&this.activateNextPaint(b),b.removeElements(),this.remove(b),this.reformat(),d&&(d.stopPropagation(),d.preventDefault()),!0;b.szFlag&&b.szFlag.match(/CHART/)&&(b.fToggle=!0);b.fRemove=!0;executeWithMessage(()=>map.Themes.execute(),"... processing ...");d&&(d.stopPropagation(),
d.preventDefault());return!0};ixMap.Themes.prototype.getThemeRenderPosition=function(d){console.log("getThemeRenderPosition: Called with szId =",d);var a=this.getTheme(d);if(!a)return console.log("getThemeRenderPosition: Theme not found for szId =",d),-1;console.log("getThemeRenderPosition: Theme found - szId =",a.szId,"szName =",a.szName);if(!a.chartGroup)return console.log("getThemeRenderPosition: Theme has no chartGroup"),-1;console.log("getThemeRenderPosition: chartGroup found:",a.chartGroup);
d=a.chartGroup.parentNode;if(!d||!d.childNodes)return console.log("getThemeRenderPosition: No parent or parent has no childNodes"),-1;console.log("getThemeRenderPosition: Parent found:",d,"tagName =",d.tagName);d=d.childNodes;console.log("getThemeRenderPosition: Total childNodes in parent:",d.length);for(var g=[],b=0;b<d.length;b++)d[b].nodeType===1&&g.push(d[b]);console.log("getThemeRenderPosition: Element nodes only:",g.length);b=-1;for(var r=0;r<d.length;r++)if(d[r]===a.chartGroup){b=r;break}r=
-1;for(var n=0;n<g.length;n++)if(g[n]===a.chartGroup){r=n;break}console.log("getThemeRenderPosition: Position in all childNodes:",b);console.log("getThemeRenderPosition: Position in element nodes only:",r);b>=0&&b>0&&console.log("getThemeRenderPosition: Previous node type:",d[b-1].nodeType,d[b-1].nodeType===1?"element ("+d[b-1].tagName+")":"non-element");b>=0&&b<d.length-1&&console.log("getThemeRenderPosition: Next node type:",d[b+1].nodeType,d[b+1].nodeType===1?"element ("+d[b+1].tagName+")":"non-element");
console.log("getThemeRenderPosition: Returning position:",b);return b};ixMap.Themes.prototype.moveThemeToPosition=function(d,a){d=this.getTheme(d);if(!d||!d.chartGroup)return!1;var g=d.chartGroup.parentNode;if(!g)return!1;for(var b=[],r=0;r<g.childNodes.length;r++)g.childNodes[r].nodeType===1&&b.push(g.childNodes[r]);r=-1;for(var n=0;n<b.length;n++)if(b[n]===d.chartGroup){r=n;break}if(r===-1)return!1;a<0&&(a=0);a>=b.length&&(a=b.length-1);if(r===a)return!0;g.removeChild(d.chartGroup);a>=b.length-
1?g.appendChild(d.chartGroup):(a=a>r?a+1:a,a<b.length&&b[a]!==d.chartGroup?(a=b[a],a.parentNode===g?g.insertBefore(d.chartGroup,a):g.appendChild(d.chartGroup)):g.appendChild(d.chartGroup));d.szFlag&&d.szFlag.match(/CHART/)&&(g=getMatrix(d.chartGroup))&&setMatrix(d.chartGroup,g);return!0};ixMap.Themes.prototype.moveThemeUp=function(d){var a=this.getThemeRenderPosition(d);return a===-1?!1:this.moveThemeToPosition(d,a+1)};ixMap.Themes.prototype.moveThemeDown=function(d){var a=this.getThemeRenderPosition(d);
return a===-1||a===0?!1:this.moveThemeToPosition(d,a-1)};ixMap.Themes.prototype.moveThemeToFront=function(d){var a=this.getTheme(d);if(!a||!a.chartGroup)return!1;a=a.chartGroup.parentNode;if(!a)return!1;for(var g=0,b=0;b<a.childNodes.length;b++)a.childNodes[b].nodeType===1&&g++;return this.moveThemeToPosition(d,g-1)};ixMap.Themes.prototype.moveThemeToBack=function(d){return this.moveThemeToPosition(d,0)};ixMap.Themes.prototype.removeAll=function(d){this.__wmsRedrawTimeout&&(clearTimeout(this.__wmsRedrawTimeout),
this.__wmsRedrawTimeout=null);this.__actualizeTimeout&&(clearTimeout(this.__actualizeTimeout),this.__lastActualizeParam=this.__actualizeTimeout=null);for(var a=0;a<this.themesA.length;a++)this.themesA[a].szFlag.match(/LOCKED/)||(this.themesA[a].fRemove=!this.themesA[a].fRealize||this.themesA[a].fOutOfScale);setTimeout(function(){map.Themes.execute()},100);d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.removeAllCharts=function(d){for(var a=0;a<this.themesA.length;a++)this.themesA[a].szFlag.match(/CHART/)&&
!this.themesA[a].szFlag.match(/LOCKED/)&&(this.themesA[a].fRemove=!0);this.fWaitforData=!0;map.Themes.execute();d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.removeAllChoropleth=function(d){for(var a=0;a<this.themesA.length;a++)this.themesA[a].szFlag.match(/CHOROPLETH/)&&!this.themesA[a].szFlag.match(/LOCKED/)&&(this.themesA[a].fRemove=!this.themesA[a].fRealize);this.fWaitforData=!0;executeWithMessage(()=>map.Themes.execute(),"... processing ...");d&&(d.stopPropagation(),d.preventDefault())};
ixMap.Themes.prototype.removeAllSelections=function(d){for(var a=0;a<this.themesA.length;a++)this.themesA[a].szFlag.match(/SELECTION/)&&(this.themesA[a].fRemove=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ..."));d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.redrawInfoAll=function(d){for(var a=0;a<this.themesA.length;a++)this.themesA[a].fRedrawInfo=!0;map.Themes.execute();d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.reformat=function(d){for(var a=
this.minY=this.minX=0;a<this.themesA.length;a++)this.themesA[a].fRepositionInfo=!0,this.themesA[a].fRedrawInfo=!0;map.Themes.execute();d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.execute=function(){var d=null,a=null,g=0;if(!map.isIdle())setTimeout(function(){map.Themes.execute()},100);else if(!this.fWaitforData)if(map.Tiles.isLoading())setTimeout(function(){map.Themes.execute()},250),this.fExecuteDelayed=!0;else if(this.fExecuteDelayed)this.fExecuteDelayed=!1,executeWithMessage(()=>
map.Themes.execute()," ... ");else{for(g=0;g<this.themesA.length;g++)(this.themesA[g].fRealize||this.themesA[g].fRedraw||this.themesA[g].fToFront)&&this.themesA[g].szFlag.match(/CHOROPLETH/)&&!this.themesA[g].szFlag.match(/SUBTHEME/)&&(d=this.themesA[g].szShapeType,a=this.themesA[g].szThemes);if(d&&this.enableMultiChoropleth)for(g=0;g<this.themesA.length;g++)this.themesA[g].szFlag&&this.themesA[g].szFlag.match(/CHOROPLETH/)&&this.themesA[g].szShapeType==d&&(this.themesA[g].disable(),this.themesA[g].isVisible=
!1,this.themesA[g].fRedrawInfo=!1);if(d&&!this.enableMultiChoropleth)for(g=0;g<this.themesA.length;g++)!this.themesA[g].szFlag||!this.themesA[g].szFlag.match(/CHOROPLETH/)||this.themesA[g].szShapeType!=d||this.themesA[g].szThemes!=a||this.themesA[g].fRealize||this.themesA[g].fRedraw||this.themesA[g].fToFront||(this.themesA[g].fRemove=!0);for(g=0;g<this.themesA.length;g++){if(this.themesA[g].fWaitingforData)return;if(this.themesA[g].fShow&&this.themesA[g].fDone){this.themesA[g].toggle(!0);this.themesA[g].fShow=
!1;break}if(this.themesA[g].fHide&&this.themesA[g].fDone){this.themesA[g].toggle(!1);this.themesA[g].fHide=!1;break}if(this.themesA[g].fToggle&&this.themesA[g].fDone){this.themesA[g].toggle();this.themesA[g].fToggle=!1;this.execute();break}if(this.themesA[g].fRemove){this.themesA.length>1&&!this.themesA[g].szFlag.match(/SELECTION/)&&!this.themesA[g].szFlag.match(/CHART/)&&this.activateNextPaint(this.themesA[g]);this.themesA[g].removeElements();this.remove(this.themesA[g]);this.reformat();this.execute();
break}if(this.themesA[g].fRealize)this.themesA[g].nChartUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.themesA[g].nChartUpper||this.themesA[g].nChartLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.themesA[g].nChartLower?(this.themesA[g].chartGroup&&this.themesA[g].chartGroup.style.setProperty("display","none",""),this.themesA[g].fOutOfScale=!0):(this.themesA[g].fOutOfScale=!1,this.themesA[g].fEnableProgressBar=!0,this.themesA[g].fRealize=!1,this.themesA[g].realize());else if(this.themesA[g].fRedraw)this.themesA[g].fRedraw=
!1,this.themesA[g].fActualize=!1,this.themesA[g].checkHiddenLayerState&&this.themesA[g].checkHiddenLayerState()?(this.themesA[g].fRealize=!0,this.themesA[g].fRedraw=!1,this.themesA[g].fReload=!1,this.themesA[g].unpaintMap(),map.Themes.execute()):(this.themesA[g].fEnableProgressBar=!0,this.themesA[g].szFlag.match(/FEATURE/)||this.themesA[g].unpaintMap(),this.themesA[g].redraw(!1));else if(this.themesA[g].fActualize)this.themesA[g].fActualize=!1,this.themesA[g].checkHiddenLayerState&&this.themesA[g].checkHiddenLayerState()?
(this.themesA[g].fRealize=!0,this.themesA[g].fRedraw=!1,this.themesA[g].fReload=!1,this.themesA[g].unpaintMap(),map.Themes.execute()):(this.themesA[g].fEnableProgressBar=!0,this.themesA[g].redraw(!1));else if(this.themesA[g].fToFront)this.themesA[g].fEnableProgressBar=!1,this.themesA[g].toFront(),this.themesA[g].fToFront=!1;else if(this.themesA[g].fResize)this.themesA[g].resize(this.themesA[g].fResize),this.themesA[g].fResize=!1;else if(this.themesA[g].fOpacity)this.themesA[g].opacity(this.themesA[g].fOpacity),
this.themesA[g].fOpacity=!1;else if(this.themesA[g].fBlur)this.themesA[g].blur(this.themesA[g].nBlur),this.themesA[g].fBlur=!1;else if(this.themesA[g].fOffset)this.themesA[g].offset(this.themesA[g].fOffset),this.themesA[g].fOffset=!1;else if(this.themesA[g].fRedrawInfo)this.themesA[g].widgetNode&&this.themesA[g].showInfo(),this.themesA[g].fRedrawInfo=!1;else if(this.themesA[g].fResort){try{this.themesA[g].sortChartObjects()}catch(r){}this.themesA[g].fResort=!1}else if(this.themesA[g].fDeclutter){try{this.themesA[g].declutterCharts()}catch(r){}this.themesA[g].fDeclutter=
!1}}if(this.executeCallback){try{if(typeof this.executeCallback==="function")this.executeCallback();else if(typeof this.executeCallback==="string")if(/^[a-zA-Z_$][a-zA-Z0-9_$]*(\.[a-zA-Z_$][a-zA-Z0-9_$]*)*\([^)]*\)$/.test(this.executeCallback.trim())){var b=(new Function("return "+this.executeCallback))();typeof b==="function"&&b()}else console.warn("Unsafe callback pattern detected, ignoring: "+this.executeCallback)}catch(r){console.error("Error executing callback: "+r.message)}this.executeCallback=
null}clearMessage();clearMessage(1E3)}};ixMap.Themes.prototype.executeContinue=function(){for(var d=0;d<this.themesA.length;d++)this.themesA[d].fAnalyze?(this.themesA[d].fAnalyze=!1,this.themesA[d].realize_analyze()):this.themesA[d].fDraw?(this.themesA[d].fDraw=!1,this.themesA[d].realize_draw()):this.themesA[d].fContinue?(this.themesA[d].fContinue=!1,this.themesA[d].realizeContinue(this.themesA[d].continueIndex)):this.themesA[d].fContinueLoadAndAggregate&&(this.themesA[d].fContinueLoadAndAggregate=
!1,this.themesA[d].loadAndAggregateValuesOfTheme(this.themesA[d].szThemeLayer,this.themesA[d].continueIndex))};ixMap.Themes.prototype.realizeDone=function(d){for(var a=0;a<this.themesA.length;a++)this.themesA[a].szFlag.match(/SELECTION/)&&(this.themesA[a].fRealize=!0);d.fRealizeDone=!0;d.szFlag.match(/BUFFER/)?this.activeBuffer=d:this.activeTheme=d;try{map.HTMLWindow.ixmaps.htmlgui_setActualTheme(d.szId)}catch(g){}try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(d.szId)}catch(g){}(d.szFlag.match(/TEXTONLY/)||
d.szLabelField)&&setTimeout(function(){map.Layer.adaptLabel()},10);d.szFlag.match(/ANIMATEPOSITION/)&&(d.animateTimeout&&clearTimeout(d.animateTimeout),d.animateTimeout=setTimeout(function(){map.Themes.animateChartPosition(null,d.szId)},100));d.userChartDrawError&&d.userChartDrawError==d.nDoneCount&&displayMessage("User draw function error! ",5E3);this.isIdle()&&clearMessage();setTimeout("map.Themes.execute()",100)};ixMap.Themes.prototype.showProgressBar=function(){for(var d=0;d<this.themesA.length;d++)(this.themesA[d].fRealize||
this.themesA[d].fContinue||this.themesA[d].fAnalyze||this.themesA[d].fDraw)&&this.themesA[d].nCount/this.themesA[d].nDoneCount>2&&this.themesA[d].mapSleep?this.themesA[d].mapSleep.fShowProgressBar=!0:(this.themesA[d].fRealize||this.themesA[d].fContinue||this.themesA[d].fAnalyze||this.themesA[d].fDraw)&&setTimeout(function(){map.Themes.showProgressBar()},1E3)};ixMap.Themes.prototype.remove=function(d){d==this.activeTheme&&(this.activeTheme=null);d==this.activeBuffer&&(this.activeBuffer=null);for(var a=
0;a<this.themesA.length;a++)if(this.themesA[a]==d){for(;a<this.themesA.length-1;a++)this.themesA[a]=this.themesA[a+1];this.themesA.length--}d.removeValues()};ixMap.Themes.prototype.cancelExecute=function(){this.activeTheme.fCancel=!0};ixMap.Themes.prototype.sequence=function(){this.sequenceNr=0;this.sequenceNext()};ixMap.Themes.prototype.sequenceNext=function(){this.sequenceNr<this.themesA.length&&(this.themesA[this.sequenceNr].fRedraw=!0,map.Themes.executeCallback="setTimeout('map.Themes.sequenceNext()',500)",
map.Themes.execute(),this.sequenceNr++)};ixMap.Themes.prototype.activateNextPaint=function(d){d=this.getThemeIndex(d.szId);for(var a=d-1;a!=d;a--){a<0&&(a=this.themesA.length-1);if(a==d)break;if(this.themesA[a].isChecked&&!this.themesA[a].szFlag.match(/CHART/))return this.themesA[a].fRedraw=!0,this.themesA[a].fRedrawInfo=!1,!0}return!1};ixMap.Themes.prototype.toggleThemeValues=function(d,a){this.toggleValueDisplay(d,this.activeTheme.szId,!this.activeTheme.szFlag.match(/VALUES/))};ixMap.Themes.prototype.toggleThemeLegends=
function(d,a){map.SVGThemeGroup.style.setProperty("display",a?"inline":"none","")};ixMap.Themes.prototype.minimizeThemeLegends=function(d){this.fMinimizedLegends=!0;for(var a=0;a<this.themesA.length;a++)this.minimizeInfo(d,this.themesA[a].szId)};ixMap.Themes.prototype.changeAllChartScaling=function(d,a){for(a=0;a<this.themesA.length;a++)this.themesA[a].fResize=999,executeWithMessage(()=>map.Themes.execute(),"... processing ...");d.stopPropagation();d.preventDefault()};ixMap.Themes.prototype.changeChartScaling=
function(d,a,g){if(a=this.getTheme(a))a.fResize=g,executeWithMessage(()=>map.Themes.execute(),"... processing ...");d.stopPropagation();d.preventDefault()};ixMap.Themes.prototype.changeChartOpacity=function(d,a,g){if(a=this.getTheme(a))a.fOpacity=g,executeWithMessage(()=>map.Themes.execute(),"... processing ...");d.stopPropagation();d.preventDefault()};ixMap.Themes.prototype.changeChartOffset=function(d,a,g){if((d=this.getTheme(a))&&d.leadOffset&&(g=map.SVGDocument.getElementById(g))){g.fu=new Methods(g);
a=g.fu.getPosition();var b=g.fu.getGroupScale();d.fOffset=new point(a.x-d.leadOffset.x,a.y-d.leadOffset.y);g.fu.setPosition(d.leadOffset.x,d.leadOffset.y);d.fOffset.x/=map.Zoom.nZoom/b.x;d.fOffset.y/=map.Zoom.nZoom/b.y;d.offset(d.fOffset);d.fOffset=!1;d.leadOffset=!1}};ixMap.Themes.prototype.tellChartOffset=function(d,a,g){(d=this.getTheme(a))&&!d.leadOffset&&this.enableChartOffset&&(g=map.SVGDocument.getElementById(g))&&(g.fu=new Methods(g),d.leadOffset=g.fu.getPosition())};ixMap.Themes.prototype.initChartOffset=
function(d,a,g){if(this.getTheme(a)){var b=map.SVGDocument.getElementById(g);b&&(b.origPosition||(b.origPosition=b.fu.getPosition()),b.onMouseMove=function(r){b.actualPosition=b.fu.getPosition();map.Themes.makeChartOffsetPointer(b)},b.widgetObj=new Widget(b,b))}};ixMap.Themes.prototype.endChartOffset=function(d,a,g){this.getTheme(a)&&(d=map.SVGDocument.getElementById(g))&&d.widgetObj.remove()};ixMap.Themes.prototype.makeChartOffsetPointer=function(d,a){a=a||1;d.pointerObj?(map.Dom.clearGroup(d.pointerObj),
map.Dom.clearGroup(d.pointShObj)):(d.pointerObj=map.Dom.newGroup(d),d.pointShObj=map.Dom.newGroup(d),d.pointerObj.parentNode.insertBefore(d.pointerObj,d.pointerObj.parentNode.firstChild),d.pointShObj.parentNode.insertBefore(d.pointShObj,d.pointShObj.parentNode.firstChild));if(d.origPosition||d.actualPosition){var g=new box(0,0,100,75),b=new point(d.actualPosition.x-d.origPosition.x,d.actualPosition.y-d.origPosition.y);map.Scale.normalX(15);map.Scale.normalX(5);var r=map.Scale.normalX(10);map.Scale.normalX(5);
var n=b.y+g.height/2;var v=b.x+g.width/2;Math.abs(n)+g.width/2-g.height/2>Math.abs(v)?(g.width/3>r&&(b.x>-g.width/3&&(v-=g.width/3),b.x<-g.width/3*2&&(v+=g.width/3)),n>0?(map.Dom.newShape("path",d.pointShObj,"M"+-b.x+","+-b.y+" l "+(v-map.Scale.normalX(5/a))+","+(b.y+map.Scale.normalX(1/a))+" "+map.Scale.normalX(4/a)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",d.pointerObj,"M"+-b.x+","+-b.y+" l "+(v-map.Scale.normalX(5/a))+","+(b.y+map.Scale.normalX(1/a))+" "+map.Scale.normalX(3/
a)+",0 z","fill:white")):(map.Dom.newShape("path",d.pointShObj,"M"+-b.x+","+-b.y+" l "+(v-map.Scale.normalX(4/a))+","+(b.y+g.height)+" "+map.Scale.normalX(4/a)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",d.pointerObj,"M"+-b.x+","+-b.y+" l "+(v-map.Scale.normalX(4/a))+","+(b.y+g.height)+" "+map.Scale.normalX(3/a)+",0 z","fill:white"))):(g.height/5>r&&(b.y>-g.height/3&&(n-=g.height/3),b.y<-g.height/3*2&&(n+=g.height/3)),v>0?(map.Dom.newShape("path",d.pointShObj,"M"+-b.x+","+-b.y+" l "+
(b.x-g.width)+","+(n-map.Scale.normalX(4/a))+" 0,"+map.Scale.normalX(4/a)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",d.pointerObj,"M"+-b.x+","+-b.y+" l "+(b.x-g.width)+","+(n-map.Scale.normalX(4/a))+" 0,"+map.Scale.normalX(3/a)+" z","fill:white")):(map.Dom.newShape("path",d.pointShObj,"M"+-b.x+","+-b.y+" l "+(b.x+g.width)+","+(n-map.Scale.normalX(4/a))+" 0,"+map.Scale.normalX(4/a)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",d.pointerObj,"M"+-b.x+","+-b.y+" l "+(b.x+
g.width)+","+(n-map.Scale.normalX(4/a))+" 0,"+map.Scale.normalX(3/a)+" z","fill:white")))}};ixMap.Themes.prototype.animateChartPosition=function(d,a){var g=this.getTheme(a);if(g){d=g.chartGroup.childNodes;for(let n=0;n<d.length;n++){a=d[n].fu.getPosition();var b=new point(d[n].getAttributeNS(szMapNs,"xEnd"),d[n].getAttributeNS(szMapNs,"yEnd")),r=d[n].getAttributeNS(szMapNs,"dur");d[n].fu.setPosition(a.x+(b.x-a.x)/r,a.y+(b.y-a.y)/r);d[n].setAttributeNS(szMapNs,"dur",--r)}g.animateTimeout&&clearTimeout(g.animateTimeout);
g.animateTimeout=setTimeout(function(){map.Themes.animateChartPosition(null,g.szId)},100)}};A.prototype.declutterCharts=function(){if(!(this.szDeclutterUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nDeclutterUpper)){var d=this.chartGroup.childNodes;for(b=0;b<d.length;b++)d[b].actualPosition&&(d[b].fu.setPosition(d[b].origPosition.x,d[b].origPosition.y),d[b].origPosition=null,d[b].actualPosition=null,d[b].pointerObj&&(map.Dom.clearGroup(d[b].pointerObj),map.Dom.clearGroup(d[b].pointShObj)),
d[b].pointerObj=null,d[b].pointShObj=null);if(!d[0].actualPosition){var a=d[0].fu.getBox();map.Zoom.getBox();for(var g=[],b=0;b<d.length;b++){var r=!1,n=d[b].fu.getPosition(),v=d[b].fu.getBox();v.x+=n.x;v.y+=n.y;for(var c in g)for(var e in g[c])if(!(v.y+v.height<g[c][e].box.y-g[c][e].box.height*.3||v.y>g[c][e].box.y+g[c][e].box.height*1.3||v.x+v.width<g[c][e].box.x-g[c][e].box.width||v.x>g[c][e].box.x+g[c][e].box.width*2)){g[c].push({node:d[b],y:d[b].fu.getPosition().x,box:v});r=!0;break}r||g.push([{node:d[b],
y:d[b].fu.getPosition().x,box:v}])}for(c=0;c<g.length;c++)if(d=g[c],d.sort(this.sortUpChartObjectsCompare),d.length>1&&d.length<5){r=d[0].node.fu.getPosition();for(b=0;b<d.length;b++)n=d[b].node.fu.getPosition(),n.y<r.y&&(r.x=n.x,r.y=n.y);r.y-=map.Scale.normalX(50)*map.Scale.nZoomScale;n=d[0].node.fu.getPosition();for(b=0;b<d.length;b++)d[b].node.origPosition=d[b].node.fu.getPosition(),d[b].node.fu.setPosition(n.x+a.width*1.2*b,r.y),d[b].node.actualPosition=new point(n.x+a.width*1.2*b,r.y),v=d[b].node.fu.getScale().x,
d[b].node.actualPosition.x=d[b].node.origPosition.x-(d[b].node.origPosition.x-d[b].node.actualPosition.x)/v,d[b].node.actualPosition.y=d[b].node.origPosition.y-(d[b].node.origPosition.y-d[b].node.actualPosition.y)/v,map.Themes.makeChartOffsetPointer(d[b].node,this.nScale)}}}};A.prototype.animateCharts=function(d){var a=this.chartGroup.childNodes;if(d=="scale")for(i=0;i<a.length;i++){var g=a[i].firstChild;g.setAttributeNS(null,"transform","scale(1 1)");map.Dom.constructNode("animateTransform",g,{attributeName:"transform",
type:"scale",from:"0 0",to:"1 1",begin:String(Math.random()*.2)+"s",dur:"2s",repeatCount:"1"})}if(d=="fire")for(i=0;i<a.length;i++)g=a[i].firstChild,g.setAttributeNS(null,"transform","scale(1 1)"),map.Dom.constructNode("animateTransform",g,{attributeName:"transform",type:"scale",from:"0 0",to:"1 1",begin:String(Math.random()*1)+"s",dur:"0.5s",repeatCount:"3"})};ixMap.Themes.prototype.toggleValueDisplay=function(d,a,g){var b=this.getTheme(a);if(b){var r="";a=b.szFlag.split("|");for(var n=0;n<a.length;n++)a[n]!=
"VALUES"&&(r+=(r.length?"|":"")+a[n]);g&&(r+="|VALUES");executeWithMessage(()=>map.Themes.doChangeThemeStyle(b.szId,"type:"+r),"... processing ...")}d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.toggleDopacity=function(d,a,g){var b=this.getTheme(a);if(b){var r="";a=b.szFlag.split("|");for(var n=0;n<a.length;n++)a[n].match(/DOPACITY/)||(r+=(r.length?"|":"")+a[n]);g&&(r+="|DOPACITYMAX");executeWithMessage(()=>map.Themes.doChangeThemeStyle(b.szId,"type:"+r),"... processing ...")}d&&
(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.changeDopacityAlphaRamp=function(d,a,g){var b=this.getTheme(a);if(b){var r=b.szFlag;b.nDopacityScale=b.nDopacityScale||1;b.nDopacityScale*=g;executeWithMessage(()=>map.Themes.doChangeThemeStyle(b.szId,"type:"+r),"... processing ...")}d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.toggleChartDisplay=function(d,a,g){if(a=this.getTheme(a))a.fToggle=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ...");
d.stopPropagation();d.preventDefault()};ixMap.Themes.prototype.zoomTo=function(d,a){(d=this.getTheme(a)||this.activeTheme)&&d.zoomTo()};ixMap.Themes.prototype.zoomToClass=function(d,a,g,b){setTimeout(function(){map.Themes.doZoomToClass(a,g,b)},100)};ixMap.Themes.prototype.markClass=function(d,a,g,b){var r=this.getTheme(a);r&&r.isVisible&&!r.showInfoMore&&(typeof r.markedClass!="undefined"&&r.markedClass==g||typeof r.markedClasses!="undefined"&&r.markedClasses[g]?this.unmarkClass(d,a,g):(r.fMarkEnable=
!0,r.fUnmarkEnable=!1,this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),displayMessage("...",500,!0),this.markTimeout=setTimeout(function(){map.Themes.doMarkClass(a,g,b)},50)))};ixMap.Themes.prototype.unmarkClass=function(d,a,g){(d=this.getTheme(a))&&d.isVisible&&!d.showInfoMore&&(displayMessage("...",500,!0),this.unmarkTimeout=setTimeout(function(){map.Themes.doUnmarkClass(a,g)},50),d.fUnmarkEnable=!0,d.fMarkEnable=!1)};ixMap.Themes.prototype.doZoomToClass=
function(d,a,g){(d=this.getTheme(d))&&d.zoomToClass(Number(a),Number(g))};ixMap.Themes.prototype.doMarkClass=function(d,a,g){if(d=this.getTheme(d)){d.markedClass=a;d.markedClasses=d.markedClasses||[];d.markedClasses[a]=!0;d.markedClassesA=[];for(var b in d.markedClasses)d.markedClasses[b]===!0&&d.markedClassesA.push(b);d.markClass(Number(a),Number(g));try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(d.szId)}catch(r){}}};ixMap.Themes.prototype.doUnmarkClass=function(d,a){if(d=this.getTheme(d)){d.markedClass=
null;if(d.markedClasses){d.markedClasses[a]=!1;d.markedClassesA=[];for(var g in d.markedClasses)d.markedClasses[g]===!0&&d.markedClassesA.push(g);if(d.markedClassesA.length){displayMessage("...",500,!0);d.fMarkEnable=!0;d.markClass(d.markedClassesA[0],1);d.fMarkEnable=!1;try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(d.szId)}catch(b){}return}delete d.markedClassesA;delete d.markedClasses}d.unmarkClass();try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(d.szId)}catch(b){}}};ixMap.Themes.prototype.hideClass=
function(d,a,g,b){(d=this.getTheme(a))&&d.isVisible&&d.showClass(Number(g),Number(b),!1)};ixMap.Themes.prototype.showClass=function(d,a,g,b){(d=this.getTheme(a))&&d.isVisible&&d.showClass(Number(g),Number(b),!0)};ixMap.Themes.prototype.classesToRanges=function(d,a){(d=this.getTheme(a))&&d.isVisible&&d.classesToRanges()};ixMap.Themes.prototype.filterItems=function(d,a,g,b){(d=a?this.getTheme(a):this.activeTheme)&&d.isVisible&&!d.showInfoMore&&(d.fMarkEnable=!0,d.fUnmarkEnable=!1,this.markTimeout&&
clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),this.opt=b,this.markTimeout=setTimeout(function(){map.Themes.doFilterItems(a,g)},500))};ixMap.Themes.prototype.doFilterItems=function(d,a){executeWithMessage(()=>map.Themes.doFilterItemsGo(d,a),"applying filter ...")};ixMap.Themes.prototype.doFilterItemsGo=function(d,a){clearMessage();if(d=this.getTheme(d?d:null))d.filterItems(a,this.opt),this.activeTheme=d};ixMap.Themes.prototype.selectFilterItems=function(d,a){(d=
this.getTheme(a))&&d.selectFilterItems()};ixMap.Themes.prototype.highlightItems=function(d,a,g,b){(d=a?this.getTheme(a):this.activeTheme)&&d.isVisible&&(this.highlightTimeout&&clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout(function(){map.Themes.doHighlightItems(a,g,b)},500))};ixMap.Themes.prototype.doHighlightItems=function(d,a,g){(d=d?this.getTheme(d):this.activeTheme)&&d.highlightItems(a,g)};ixMap.Themes.prototype.clearHighlightItems=function(d,a){(d=a?this.getTheme(a):this.activeTheme)&&
d.isVisible&&(this.highlightTimeout&&clearTimeout(this.highlightTimeout),d.clearHighlightItems())};ixMap.Themes.prototype.setTimeFrame=function(d,a,g,b){(d=this.getTheme(a))&&d.isVisible&&!d.showInfoMore&&(this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),this.markTimeout=setTimeout(function(){map.Themes.doSetTimeFrame(a,g,b)},1))};ixMap.Themes.prototype.doSetTimeFrame=function(d,a,g){if(d==null){d=this.getThemes();for(var b in d)d[b].setTimeFrame(a,
g)}else(b=this.getTheme(d))&&b.setTimeFrame(a,g)};ixMap.Themes.prototype.changeThemeStyle=function(d,a,g,b){if(a==null){themesA=this.getThemes();for(var r in themesA)themesA[r].szFlag.match(/FEATURE/)||this.changeThemeStyle(d,themesA[r].szId,g,b)}else b&&b.match(/fast|silent|direct/)?map.Themes.doChangeThemeStyle(a,g.replace(/'/g,"\\'"),b):executeWithMessage(()=>map.Themes.doChangeThemeStyle(a,g.replace(/'/g,"\\'"),b),"... processing ..."),d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.doChangeThemeStyle=
function(d,a,g){console.log("doChangeThemeStyle",d,a,g);var b=this.getTheme(d);if(b){if(a=__getStyleObj(a)){if(a.type){a.origType=a.type;if(g&&g.match(/add/)){var r=a.type.split("|");this.szTempStyle=b.szFlag;for(var n=0;n<r.length;n++)Aa(this.szTempStyle,r[n],!1)||(this.szTempStyle+="|"+r[n]);a.type=this.szTempStyle}else if(g&&g.match(/remove/)){r=b.szFlag.split("|");var v="";for(n=0;n<r.length;n++)r[n]!=a.type&&(v+=(v.length?"|":"")+r[n]);a.type=v}else if(g&&g.match(/toggle/)){r=b.szFlag.split("|");
v="";var c=!1;for(n=0;n<r.length;n++)r[n]!=a.type?v+=(v.length?"|":"")+r[n]:c=!0;a.type=v+(c?"":"|"+a.type)}else b.szFlag.match(/FRACTION/)&&(a.type+="|FRACTION"),b.szFlag.match(/PERMILLE/)&&(a.type+="|PERMILLE"),b.szFlag.match(/CALCVAL/)&&(a.type+="|CALCVAL"),b.szFlag.match(/CALC100/)&&(a.type+="|CALC100"),b.szFlag.match(/PRODUCT/)&&(a.type+="|PRODUCT"),b.szFlag.match(/RELATIVE/)&&(a.type+="|RELATIVE"),b.szFlag.match(/INVERT/)&&(a.type+="|INVERT"),b.szFlag.match(/INVERTSIZE/)&&(a.type+="|INVERTSIZE"),
b.szFlag.match(/DENSITY/)&&(a.type+="|DENSITY"),b.szFlag.match(/SUM/)&&(a.type+="|SUM"),b.szFlag.match(/CALCMEAN/)&&(a.type+="|CALCMEAN"),b.szFlag.match(/AUTO100/)&&(a.type+="|AUTO100");a.type.match(/LOCKED/)&&(b.fRedrawInfo=!0,map.Themes.execute());if(a.type.match(/CHART/)&&!b.szFlag.match(/CHART/)||a.type.match(/CHOROPLETH/)&&!b.szFlag.match(/CHOROPLETH/))b.unpaintMap(),this.activateNextPaint(b);!a.type.match(/CATEGORICAL/)&&(a.type.match(/EQUIDISTANT/)||a.type.match(/POW2/)||a.type.match(/POW3/)||
a.type.match(/LOG/)||a.type.match(/QUANTILE/))&&(b.szOldRanges=b.szRanges?b.szRanges:b.szOldRanges,b.szRanges=null,b.szOldLabelA=b.szLabelA?b.szLabelA:b.szOldLabelA,b.szLabelA=null,b.fRealize=!0);a.type.match(/RANGES/)&&a.ranges&&(b.szRanges=b.szOldRanges?b.szOldRanges:b.szRanges,b.szRangesA=a.ranges.split(a.ranges.match(/\|/)?"|":","),b.szLabelA=b.szOldLabelA?b.szOldLabelA:b.szLabelA,Number(b.origColorScheme[0])&&b.szRanges&&(b.origColorScheme[0]=b.szRangesA.length-1),b.fRealize=!0);if(a.type.match(/RANGES/)&&
!a.ranges){b.szRangesA=[b.partsA[0].min];for(var e in b.partsA)b.szRangesA.push(b.partsA[e].max)}e=b.szFlag;b.szFlag=a.type;!b.szFlag.match(/CHART/)||b.szFlag.match(/BUFFER/)||e.match(/CHART/)||(b.fShadow=b.fOrigShadow=!0);a.origType.match(/AGGREGATE/)||a.origType.match(/GROUP/)||a.origType.match(/\bRECT\b/)||a.origType.match(/RELOCATE/)?(b.fRealize=!0,b.fRedraw=!1,b.unpaintMap(),b.themeNodesPosA=[]):(b.fRedraw=!0,b.fRedrawInfo=!0);a.type.match(/VALUES/)!=e.match(/VALUES/)&&(b.fRedraw=!0);a.type.match(/DTEXT/)!=
e.match(/DTEXT/)&&b.unlabelMap();a.type.match(/AUTO100/)!=e.match(/AUTO100/)&&(b.fRealize=!0,b.fRedraw=!1,b.unpaintMap());a.type.match(/DIFFERENCE/)!=e.match(/DIFFERENCE/)&&(b.fRealize=!0,b.fRedraw=!1,b.unpaintMap());a.type.match(/NOOUTLIER/)!=e.match(/NOOUTLIER/)&&(b.fRealize=!0,b.fRedraw=!1,b.unpaintMap());a.type.match(/OUTLIER/)!=e.match(/OUTLIER/)&&(b.fRealize=!0,b.fRedraw=!1,b.unpaintMap());a.type.match(/NEGATIVEISNOTVALUE/)!=e.match(/NEGATIVEISNOTVALUE/)&&(b.fNegativeValuePossible=!a.type.match(/NEGATIVEISNOTVALUE/),
b.fRealize=!0,b.fRedraw=!0,b.unpaintMap())}else if(g&&g.match(/remove/)){for(r in a)for(v in W)W[v].style==r&&(b[W[v].obj]=null);b.fReload=!0;b.fRealize=!0;b.unpaintMap();executeWithMessage(()=>map.Themes.execute(),"... processing ...");return}t(a.field)&&(b.szFields=a.field,b.szFieldsA=b.szFields.split("|"),b.fRealize=!0);t(a.classes)&&(isNaN(Number(b.origColorScheme[0]))&&(b.origColorScheme[3]=b.origColorScheme[b.origColorScheme.length/2],b.origColorScheme[4]="2colors",e=b.origColorScheme[b.origColorScheme.length-
1],b.origColorScheme[1]=b.origColorScheme[0],b.origColorScheme[2]=e),b.origColorScheme[0]=Number(a.classes),b.szFlag.match(/CHART/)&&b.unpaintMap(),b.szOldRanges=b.szRanges,b.szRanges=null,b.fRealize=!0);t(a.ranges)&&(b.szRanges=a.ranges,b.szRangesA=a.ranges.split(a.ranges.match(/\|/)?"|":","),b.fRealize=!0);t(a.colorstyle)&&b.origColorScheme[1]=="spectrum"&&(b.origColorScheme[2]=a.colorstyle,b.szFlag.match(/CHART/)&&b.unpaintMap(),b.fRealize=!0);t(a.colordef)&&(b.origColorScheme=a.colordef.match(/\|/)?
a.colordef.split("|"):a.colordef.split(","),b.colorScheme=b.origColorScheme,b.fRedraw=!0,b.szFlag.match(/CHART/)||(b.fRealize=!0),b.fRedrawInfo=!0,b.showInfo());if(t(a.colorscheme)&&(typeof a.colorscheme==="object"&&(a.colorscheme=a.colorscheme.join("|"),alert(a.colorscheme)),(e=a.colorscheme.match(/\|/)?a.colorscheme.split("|"):a.colorscheme.split(","))&&e.length)){isNaN(Number(b.origColorScheme[0]))&&(b.origColorScheme[0]=b.origColorScheme.length);b.origColorScheme.length=1;for(n=0;n<5;n++)b.origColorScheme[n+
1]=n<e.length?e[n]:null;try{b.colorScheme=ColorScheme.createColorScheme(b.origColorScheme[1],b.origColorScheme[2],b.origColorScheme[0],b.origColorScheme[3],b.origColorScheme[4])}catch(f){b.colorScheme=b.defaultColorScheme}b.fRealize=!0;b.szFlag.match(/CHART/);b.unpaintMap();b.fRedrawInfo=!0;b.showInfo()}if(t(a.colorschemegeneration)&&!isNaN(Number(b.origColorScheme[0]))){switch(a.colorschemegeneration){case "warm":b.origColorScheme[4]="#FFFDD8";break;case "cold":b.origColorScheme[4]="#FFFFFF";break;
default:b.origColorScheme[4]=a.colorschemegeneration}b.szFlag.match(/CHART/)&&b.unpaintMap();try{b.colorScheme=ColorScheme.createColorScheme(b.origColorScheme[1],b.origColorScheme[2],b.origColorScheme[0],b.origColorScheme[3],b.origColorScheme[4])}catch(f){b.colorScheme=b.defaultColorScheme}b.fRedraw=!0;b.fRedrawInfo=!0}t(a.symbols)&&(b.szSymbolsA=a.symbols.split(a.symbols.match(/\|/)?"|":","),b.fRealize=!0);if(t(a.values)){e=this.toArray(a.values);b.nStringToValueA=[];b.nStringToValue=1;if(e.length)for(n=
0;n<e.length;n++)b.getStringValueIndex(e[n],"set");b.szValuesA=[];b.szLabelA=[];b.szOrigLabelA=[];for(n in b.nStringToValueA)b.szValuesA.push(n),b.szLabelA.push(n),b.szOrigLabelA.push(n);b.fRealize=!0}t(a.dominantdfilter)&&(b.nDominantDFilter=Number(a.dominantdfilter),b.fRealize=!0);t(a.dominantfilter)&&(b.szDominantFilter=String(a.dominantfilter),b.fRealize=!0);t(a.filter)&&(g&&g.match(/remove/)?b.szFilter="":b.szFilter=String(a.filter),b.fRealize=!0,b.unpaintMap(),b.szFlag.match(/FEATURE/)&&map.Dom.clearGroup(b.chartGroup));
t(a.filterfield)&&(b.szFilterField=String(a.filterfield),b.fRealize=!0);t(a.markclasses)&&(b.markedClassesA=this.toArray(a.markclasses),b.markedClasses=[],b.unmarkClass(),b.markedClassesA.forEach(function(f,m){f>=0&&(b.markedClasses[f]=!0)}),b.markClass());t(a.field100min)&&(b.nField100Min=a.field100min,b.fRealize=!0);t(a.overviewchart)&&!b.szFlag.match(/CHART/)&&(b.szOverviewChart=a.overviewchart,b.fRedrawInfo=!0);t(a.evidence)&&(b.evidenceMode=a.evidence);t(a.aggregation)&&(b.szAggregation=a.aggregation);
t(a.opacity)&&(b.fOpacity=H(b.fOpacity,Number(a.opacity),g),b.autoOpacity=null,b.fRedraw=!0);t(a.fillopacity)&&(b.fillOpacity=H(b.fillOpacity||(Number(a.fillopacity)<1?1:0),Number(a.fillopacity),g),b.autoOpacity=null,b.fillOpacity=Math.min(Math.max(b.fillOpacity,.001),1),b.unpaintMap(),b.fRedraw=!0);t(a.shadow)&&(b.fShadow=a.shadow=="toggle"?b.fOrigShadow=!b.fOrigShadow:b.fOrigShadow=a.shadow,b.fRedraw=!0);t(a.showdata)&&(b.fShowData=a.showdata=="toggle"?!b.fShowData:aa(a.showdata),b.fRedraw=!0);
t(a.blur)&&(a.blur=="toggle"?b.nBlur?(b.nOldBlur=b.nBlur,b.nBlur=0):b.nBlur=b.nOldBlur||1:b.nBlur=H(b.nBlur,Number(a.blur),g),b.fBlur=!0);t(a.scale)&&(b.fResize=x(b.nScale,Number(a.scale),g));t(a.dopacityscale)&&(b.nDopacityScale=H(b.nDopacityScale,Number(a.dopacityscale),g),b.fRedraw=!0);t(a.d_dopacityscale)&&(b.nDopacityScale*=Number(a.d_dopacityscale),b.fRedraw=!0);t(a.alphafield)&&(b.szAlphaField=String(a.alphafield),b.fRealize=!0);t(a.alphafield100)&&(b.szAlphaField100=String(a.alphafield100),
b.fRealize=!0);t(a.dopacityramp)&&(b.szDopacityRamp=a.dopacityramp,b.fRealize=!0);t(a.dopacitypow)&&(b.nDopacityPow=H(b.nDopacityPow,Number(a.dopacitypow),g),b.fRealize=!0);t(a.brightness)&&(b.nBrightness=H(b.nBrightness||1,Number(a.brightness),g),b.fRealize=!0);t(a.rangescale)&&(b.nRangeScale=H(b.nRangeScale||1,Number(a.rangescale),g),b.fRedraw=!0);t(a.sizefield)&&(b.szSizeField=String(a.sizefield),b.fRealize=!0);t(a.timefield)&&(b.szTimeField=String(a.timefield),b.fRealize=!0);t(a.xfield)&&(b.szXField=
String(a.xfield),b.fRealize=!0);t(a.yfield)&&(b.szYField=String(a.yfield),b.fRealize=!0);t(a.labelfield)&&(b.szLabelField=String(a.labelfield),b.fRealize=!0);t(a.colorfield)&&(b.szColorField=String(a.colorfield),b.fRealize=!0);t(a.symbolfield)&&(b.szSymbolField=String(a.symbolfield),b.fRealize=!0);t(a.valuefield)&&(b.szValueField=String(a.valuefield),b.fRealize=!0);t(a.normalsizevalue)&&(b.nNormalSizeValue||(b.nNormalSizeValue=b.szSizeField?b.nMaxSize:b.nMax),b.nNormalSizeValue=H(b.nNormalSizeValue,
Number(a.normalsizevalue),g),b.fRedraw=!0);t(a.minvalue)&&(b.nMinValue=H(b.nMinValue||1,Number(a.minvalue),g),b.fRedraw=!0);t(a.maxvalue)&&(b.nMaxValue=H(b.nMaxValue||1,Number(a.maxvalue),g),b.fRedraw=!0);t(a.valuedecimals)&&(b.nValueDecimals=a.valuedecimals,b.fRedraw=!0);t(a.valuescale)&&(b.nValueScale=H(b.nValueScale,Number(a.valuescale),g),b.fRedraw=!0);t(a.linewidth)&&(b.nLineWidth=H(b.nLineWidth,Number(a.linewidth),g),b.fRealize=!0);t(a.markersize)&&(b.nMarkerSize=H(b.nMarkerSize,Number(a.markersize),
g),b.fRedraw=!0);t(a.gapsize)&&(b.nGapSize=H(b.nGapSize,Number(a.gapsize),g),b.fRedraw=!0);t(a.offsetx)&&(b.nOffsetX=H(b.nOffsetX,Number(a.offsetx),g),b.fRedraw=!0);t(a.offsety)&&(b.nOffsetY=H(b.nOffsetY,Number(a.offsety),g),b.fRedraw=!0);t(a.rotation)&&(b.nRotation=H(b.nRotation,Number(a.rotation),g),b.fRedraw=!0);t(a.align)&&(b.szAlign=String(a.align),b.fRedraw=!0);t(a.linecolor)&&(b.szLineColorA=this.toArray(String(a.linecolor)),b.szLineColor=b.szLineColorA[b.szLineColorA.length-1],b.fRealize=
!0);t(a.valueupper)&&(b.szValueUpper=a.valueupper,b.nValueUpper=X(b.szValueUpper),b.fRedraw=!0);t(a.valuelower)&&(b.szValueLower=a.valuelower,b.nValueLower=X(b.szValueLower),b.fRedraw=!0);t(a.titleupper)&&(b.szTitleUpper=a.titleupper,b.nTitleUpper=X(b.szTitleUpper),b.fRedraw=!0);t(a.titlelower)&&(b.szTitleLower=a.titlelower,b.nTitleLower=X(b.szTitleLower),b.fRedraw=!0);t(a.boxupper)&&(b.szBoxUpper=a.boxupper,b.nBoxUpper=X(b.szBoxUpper),b.fRedraw=!0);t(a.boxlower)&&(b.szBoxLower=a.boxlower,b.nBoxLower=
X(b.szBoxLower),b.fRedraw=!0);t(a.shadowupper)&&(b.szShadowUpper=a.shadowupper,b.nShadowUpper=X(b.szShadowUpper),b.fRedraw=!0);t(a.shadowlower)&&(b.szShadowLower=a.shadowlower,b.nShadowLower=X(b.szShadowLower),b.fRedraw=!0);t(a.declutterupper)&&(b.szDeclutterUpper=a.declutterupper,b.nDeclutterUpper=X(b.szdeclutterUpper),b.fRedraw=!0);t(a.aggregationupper)&&(b.szAggregationUpper=a.aggregationupper,b.nAggregationUpper=X(b.szAggregationUpper),b.fRedraw=!0);t(a.aggregationlower)&&(b.szAggregationLower=
a.aggregationlower,b.nAggregationLower=X(b.szAggregationLower),b.fRedraw=!0);t(a.clipupper)&&(b.szClipUpper=a.clipupper,b.nClipUpper=X(b.szClipUpper),b.fRedraw=!0);t(a.cliplower)&&(b.szClipLower=a.cliplower,b.nClipLower=X(b.szClipLower),b.fRedraw=!0);t(a.minvaluesize)&&(b.nValueSizeMin=H(b.nValueSizeMin,Number(a.minvaluesize),g),b.fRedraw=!0);t(a.minvaluevalue)&&(b.nValueValueMin=H(b.nValuevalueMin,Number(a.minvaluevalue),g),b.fRedraw=!0);t(a.clipvaluesize)&&(b.nValueSizeMin=H(b.nValueSizeMin,Number(a.clipvaluesize),
g),b.fRedraw=!0);t(a.minsize)&&(b.nChartSizeMin=H(b.nChartSizeMin,Number(a.minsize),g),b.fRedraw=!0);t(a.minchartsize)&&(b.nChartSizeMin=H(b.nChartSizeMin,Number(a.minchartsize),g),b.fRedraw=!0);t(a.maxcharts)&&(b.nMaxCharts=H(b.nMaxCharts,Number(a.maxcharts),g),b.nMaxCharts=Math.max(1,Math.round(b.nMaxCharts)),b.unpaintMap(),b.fRedraw=!0);t(a.sizepow)&&(b.nSizePow=H(b.nSizePow,Number(a.sizepow),g),b.fRedraw=!0);t(a.outlierscale)&&(b.nOutlierScale=H(b.nOutlierScale,Number(a.outlierscale),g),b.fRedraw=
!0);t(a.clipsize)&&(b.nChartSizeMin=H(b.nChartSizeMin,Number(a.clipsize),g),b.fRedraw=!0);t(a.clipparts)&&(b.nClipParts=Number(a.clipparts),b.fRedraw=!0);t(a.showparts)&&(b.szShowParts=a.showparts,b.szShowPartsA=a.showparts.split(a.showparts.match(/\|/)?"|":","),map.Themes.unmarkClass(null,d),b.fRedraw=!0);t(a.clipframerate)&&(b.nClipFrameRate=H(b.nClipFrameRate||1,Number(a.clipframerate),g),b.nClipTimeout=1/b.nClipFrameRate*1E3,b.fRedraw=!0);t(a.refresh)&&(b.nRefreshTimeout=Number(a.refresh)*1E3,
b.fRealize=!0);t(a.refreshtimeout)&&(b.nRefreshTimeout=Number(a.refreshtimeout),b.fRealize=!0);t(a.gridx)&&(b.nGridX=Number(a.gridx)||7,b.fRedraw=!0);t(a.gridwidth)&&(b.szAggregationField=null,a.gridwidth=="auto"?b.nGridWidthPx=b.nGridWidthPx||50:String(a.gridwidth).match(/px/)?b.nGridWidthPx=H(b.nGridWidthPx||1,Number(a.gridwidth),g):g=="factor"?t(b.nGridWidthPx)?b.nGridWidthPx=H(b.nGridWidthPx||1,Number(a.gridwidth),g):b.nGridWidth=H(b.nGridWidth||1E3,Number(a.gridwidth),g):(b.nGridWidthPx=null,
b.nGridWidth=H(b.nGridWidth||1,Number(a.gridwidth),g)),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.themeNodesPosA=[],b.unpaintMap());t(a.gridmatrix)&&(b.szAggregationField=null,b.nGridMatrix=H(b.nGridMatrix||1,Number(a.gridmatrix),g),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.unpaintMap(),b.themeNodesPosA=[]);t(a.gridwidthpx)&&(b.szAggregationField=null,b.nGridWidthPx=H(b.nGridWidthPx||50,Number(a.gridwidthpx),g),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=
!0,b.unpaintMap(),b.themeNodesPosA=[]);t(a.gridoffsetx)&&(b.nGridOffsetX=H(b.nGridOffsetX||0,Number(a.gridoffsetx),g),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.unpaintMap(),b.themeNodesPosA=[]);t(a.gridoffsety)&&(b.nGridOffsetY=H(b.nGridOffsetY||0,Number(a.gridoffsety),g),b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=!0,b.unpaintMap(),b.themeNodesPosA=[]);t(a.aggregationfield)&&(b.szAggregationField=a.aggregationfield,b.fRealize=!0,b.fRedraw=!0,b.fSuppressAggregationScale=
!0,b.unpaintMap(),b.themeNodesPosA=[]);t(a.snippet)&&(b.szSnippet=unescape(a.snippet),b.fRealize=!0);t(a.title)&&(b.szTitle=unescape(a.title),b.fRealize=!0);t(a.units)&&(b.szUnits=unescape(a.units),b.fRealize=!0);t(a.child)&&(b.fChild=!0)}b.fRedrawInfo=!0;map.Themes.execute()}};ixMap.Themes.prototype.getThemeLayerList=function(){for(var d=[],a,g=0;g<this.themesA.length;g++)if(this.themesA[g].objThemesA&&!this.themesA[g].fRemove)for(a in this.themesA[g].objThemesA)d[d.length]=a;return d};ixMap.Themes.prototype.isThemeLayerUsed=
function(d){for(var a=this.getThemeLayerList(),g=0;g<a.length;g++)if(d==a[g])return!0;return!1};ixMap.Themes.prototype.isNodePartOfAnyTheme=function(d){if(d=map.Layer.getLayerObjOfNode(d))for(var a=map.Themes.getThemeLayerList(),g=0;g<a.length;g++)if(d.szName==a[g])return!0;return!1};ixMap.Themes.prototype.resetThemeNodesCache=function(){this.themeNodesA=[];this.themeNodes=0};ixMap.Themes.prototype.addToThemeNodesCache=function(d){var a=0;d=d.getElementsByTagName("g");for(var g=0;g<d.length;g++){var b=
String(map.Tiles.getMasterId(d.item(g).getAttributeNS(null,"id")));b&&(map.Themes.themeNodesA[b]||(map.Themes.themeNodesA[b]=[]),map.Themes.themeNodesA[b].push(d.item(g)),map.Themes.themeNodes++,a++)}};ixMap.Themes.prototype.removeFromThemeNodesCache=function(d){var a=0;d=d.getElementsByTagName("g");for(var g=0;g<d.length;g++){var b=String(map.Tiles.getMasterId(d.item(g).getAttributeNS(null,"id")));if(b&&map.Themes.themeNodesA[b]){var r=map.Themes.themeNodesA[b].indexOf(d.item(g));r>-1&&(map.Themes.themeNodesA[b].splice(r,
1),a++)}}};ixMap.Themes.prototype.setActive=function(d){this.activeTheme=d};ixMap.Themes.prototype.minimizeInfo=function(d,a){if(d=this.getTheme(a)){var g=d.widgetNode.firstChild;if(g){a=Number(g.getAttributeNS(szMapNs,"titleheight"));a<=0&&(a=420);g=g.childNodes;for(var b=0;b<g.length;b++){var r=g.item(b),n=r.getAttributeNS(null,"id");n.match(/body/)&&r.style.setProperty("display","none","");n.match(/footer/)&&r.style.setProperty("display","none","");n.match(/backgroundrect/)&&(r.setAttributeNS(szMapNs,
"maxheight",r.getAttributeNS(null,"height")),r.setAttributeNS(null,"height",a));n.match(/shadowrect/)&&(r.setAttributeNS(szMapNs,"maxheight",r.getAttributeNS(null,"height")),r.setAttributeNS(null,"height",String(a-100)));n.match(/minimizebutton/)&&r.style.setProperty("display","none","")}d.minimizebutton.nodeObj.style.setProperty("display","none","");d.morebutton.nodeObj.style.setProperty("display","none","");d.addDefinitionToFlag("MINIMIZED")}}};ixMap.Themes.prototype.maximizeInfo=function(d,a){if(d=
this.getTheme(a))if(a=d.widgetNode.firstChild){a=a.childNodes;for(var g=0;g<a.length;g++){var b=a.item(g),r=b.getAttributeNS(null,"id");r.match(/body/)&&b.style.setProperty("display","inline","");r.match(/footer/)&&b.style.setProperty("display","inline","");r.match(/backgroundrect/)&&b.setAttributeNS(null,"height",b.getAttributeNS(szMapNs,"maxheight"));r.match(/shadowrect/)&&b.setAttributeNS(null,"height",b.getAttributeNS(szMapNs,"maxheight"));r.match(/minimizebutton/)&&b.style.setProperty("display",
"inline","")}d.minimizebutton.nodeObj.style.setProperty("display","inline","");d.morebutton.nodeObj.style.setProperty("display","inline","");d.removeDefinitionFromFlag("MINIMIZED")}};ixMap.Themes.prototype.getChartAll=function(d,a,g){for(var b=a.getAttributeNS(null,"id"),r=0,n=0;n<this.themesA.length;n++){var v=map.Dom.newGroup(a,b+":C1");this.getChart(d,v,g,this.themesA[n]);var c=map.Dom.getBox(v);c.width<0&&(c=new box(0,0,0,0));v.fu.setPosition(0,r);r+=c.height+map.Scale.normalY(10);this.themesA[n].szFlag.match(/AGGREGATE/)&&
(c=d.split("::")[0]+"::"+this.themesA[n].getNodePosition(d).x+","+this.themesA[n].getNodePosition(d).y,this.getChart(c,v,g,this.themesA[n]),c=map.Dom.getBox(v),c.width<0&&(c=new box(0,0,0,0)),v.fu.setPosition(0,r),r+=c.height+map.Scale.normalY(10))}};ixMap.Themes.prototype.getChart=function(d,a,g,b){b||(b=this.activeTheme);if(!b)return null;d&&d.substr(d.length-6,6)==":paint"&&(d=d.substr(0,d.length-6));if(b.szFlag.match(/CHOROPLETH/)&&b.szFlag.match(/DOMINANT|COMPOSE/)){var r=30;b.nOrigSumA.length>
2&&(r=15*b.nOrigSumA.length/Math.log(b.nOrigSumA.length));g=map.Dom.newGroup(a,a.getAttributeNS(null,"id")+":1");if(b.szFlag.match(/PERCENTOFMEAN/)||b.szFlag.match(/PERCENTOFMEDIAN/)||b.szFlag.match(/DEVIATION/)){b.drawChart(g,d,r,"CHART|BAR|VALUES|ZOOM",d&&b.itemA[d]?b.itemA[d].nDominant:null);var n=map.Dom.getBox(g);n.width<0&&(n=new box(0,0,0,0));g=map.Dom.newGroup(a,a.getAttributeNS(null,"id")+":2");a=b.szUnit;b.szUnit="";b.drawChart(g,d,r,"VALUES|ZOOM|XAXIS");b.szUnit=a;d=map.Dom.getBox(g);a=
b.nOrigSumA.length>1?n.width/d.width*1.015:d.width/d.height;g.fu.setPosition(d.x-n.x,n.height+n.y+Math.min(map.Scale.normalY(200),Math.max(map.Scale.normalY(10),-d.y+map.Scale.normalY(6))));g.fu.scale(a,1);b=b.szFlag.match(/PERCENTOFMEDIAN/)?"median":"mean";d=d.width;map.Dom.newText(g,d,map.Scale.normalY(.9),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText(b));map.Dom.newText(g,d,map.Scale.normalY(5.5),"font-family:arial;font-size:"+map.Scale.normalY(4)+
"px;fill:#808080",map.Dictionary.getLocalText("-"));map.Dom.newText(g,d,map.Scale.normalY(-3.7),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText("+"))}else a="CHART|BAR|SPACED|VALUES|ZOOM",b.szFlag.match(/3D/)&&(a+="|3D"),b.szFlag.match(/\bSORT\b/)&&(a+="|SORT"),b.szFlag.match(/HORZ/)&&(a+="|HORZ|AXIS"),b.drawChart(g,d,r,a,null);return new point(0,map.Scale.normalY(30))}if(b.szFlag.match(/BUFFER/)&&b.szFlag.match(/CHART/))return null;if(b.szFlag.match(/CHOROPLETH/)&&
b.itemA[d])return r=b.itemA[d].nValuesA[b.nActualFrame||0],g=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1),b.szFlag.match(/CATEGORICAL/)&&b.szLabelA&&b.szLabelA.length?r=b.szLabelA[r-1]:(n=b.nMax-b.nMin<10?2:0,r=b.formatValue(r,b.nValueDecimals||n)+b.szUnit),b.szFlag.match(/\bCLIP\b/)&&b.szXaxisA&&map.Dom.newText(a,-40,-280,__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.8)+";font-weight:normal;fill:#888888",b.szXaxisA[b.nActualFrame]),map.Dom.newText(a,-40,0,g+";font-weight:normal;stroke:#ffffff;stroke-width:20;stroke-opacity:0.3",
r),map.Dom.newText(a,-40,0,g+";font-weight:normal;fill:#444444",r),__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.8),!b.szFlag.match(/CATEGORICAL/)&&(b.szChoroplethInfoStyle.match(/HISTOGRAM/)||b.szChoroplethInfoStyle.match(/histogram/)||b.szChoroplethInfoStyle.match(/CLASSES/)||b.szChoroplethInfoStyle.match(/classes/))&&(r=b.szChoroplethInfoStyle.match(/HISTOGRAM/)||b.szChoroplethInfoStyle.match(/histogram/),g=map.Dom.newGroup(a,a.getAttributeNS(null,"id")+":histogram"),this.getHistogram(d,
g,r?"DISTRIBUTION":"CLASSES",b),g.fu.setPosition(0,map.Scale.normalY(4))),new point(0,0);if(b.szFlag.match(/INFOSIZE/))return b.drawChart(a,d,30,g);r=30;b.szFlag.match(/SEQUENCE/)&&(r=25);b.szFlag.match(/BAR/)&&(b.szFlag.match(/STACKED/)?r=300:b.nOrigSumA.length<=2?r=30:(b.szFlag.match(/\bUP\b/)||b.szFlag.match(/CENTER/)||b.szFlag.match(/SEQUENCE/),r=15*b.nOrigSumA.length/Math.log(b.nOrigSumA.length)));return b.drawChart(a,d,r,g)};ixMap.Themes.prototype.getSummary=function(d,a){a||(a=this.activeTheme);
if(!a||!d)return null;if(!a.itemA[d]){var g=d.split("::");g.length>1&&(d=g[0]+"::"+String(g[1]).toUpperCase())}if(!a.itemA[d])return null;g=a.itemA[d].nOrigValuesA;for(var b=0,r=0;r<g.length;r++)isNaN(g[r])&&(g[r]=0),b+=g[r];a.szFlag.match(/DIFFERENCE/)&&(b=g[g.length-1]);if(a.itemA[d].nValue100A[0]){a.szUnits100=a.szUnits100||"";if(a.szFlag.match(/RELATIVE/)||a.szFlag.match(/DIFFERENCE/))return map.Dictionary.getLocalText("Relative to")+": "+String(a.formatValue(a.itemA[d].nValue100A[0],a.nValueDecimals||
0))+" "+(a.szUnits100||"");if(a.itemA[d].nSize){if(a.szAggregation.match(/sum/))return map.Dictionary.getLocalText("Counted")+": "+String(a.formatValue(a.itemA[d].nSize,a.nValueDecimals||0))+" "+(a.szUnits100||"")}else if(b!=a.itemA[d].nValue100A[0])return String(__formatValue(b,2))+" / "+String(a.formatValue(a.itemA[d].nValue100A[0],a.nValueDecimals||0))+" "+(a.szUnits100||"")}else if(a.itemA[d].nSize){if(a.szFlag.match(/CATEGORICAL/)&&a.itemA[d].nValuesA.length==1&&a.szValueField)return a.szLabelA[a.itemA[d].nValuesA[0]-
1]}else{if(a.itemA[d].nAlpha)return map.Dictionary.getLocalText("Alpha value")+": "+String(a.formatValue(a.itemA[d].nAlpha,a.nValueDecimals||0))+" "+(a.szAlphaValueUnits||"");!a.szFlag.match(/SUM/)||a.szFlag.match(/SEQUENCE/)||a.szFlag.match(/\bCLIP\b/)}return null};ixMap.Themes.prototype.getValueComment=function(d,a){a||(a=this.activeTheme);if(!a||!d)return null;if(!a.itemA[d]){var g=d.split("::");g.length>1&&(d=g[0]+"::"+String(g[1]).toUpperCase())}if(!a.itemA[d])return null;g=a.itemA[d].nOrigValuesA;
for(var b=0;b<g.length;b++)isNaN(g[b])&&(g[b]=0);a.szFlag.match(/DIFFERENCE/);return a.szFlag.match(/OFFSETMEAN/)?map.Dictionary.getLocalText("value")+": "+String(__formatValue(a.itemA[d].nValuesA[0],2))+" "+map.Dictionary.getLocalText("mean")+": "+String(__formatValue(a.nMeanA[0],2)):null};ixMap.Themes.prototype.getTitle=function(d,a){a||(a=this.activeTheme);if(!a||!d)return null;d=String(map.Tiles.getMasterId(d));if(!a.itemA[d]){var g=d.split("::");g.length>1&&(d=g[0]+"::"+String(g[1]).toUpperCase())}return a.itemA[d]?
a.itemA[d].szTitle||null:null};ixMap.Themes.prototype.getLabel=function(d,a){a||(a=this.activeTheme);if(!a||!d)return null;if(!a.itemA[d]){var g=d.split("::");g.length>1&&(d=g[0]+"::"+String(g[1]).toUpperCase())}return a.itemA[d]?a.itemA[d].szLabel||null:null};ixMap.Themes.prototype.getTextObjects=function(){for(var d=[],a=0;a<this.themesA.length;a++)if((this.themesA[a].szLabelField||this.themesA[a].szFlag.match(/TEXTONLY/))&&this.themesA[a].chartGroup)if(typeof this.themesA[a].markedClass!="undefined"&&
this.themesA[a].markedClass!=null)for(var g=this.themesA[a].markedClass,b=this.themesA[a].chartGroup.getElementsByTagName("text"),r=0;r<b.length;r++)b.item(r).firstChild.nodeValue.length>0&&Number(b.item(r).getAttributeNS(szMapNs,"class"))==g&&d.push(b.item(r));else for(b=this.themesA[a].chartGroup.getElementsByTagName("text"),r=0;r<b.length;r++)b.item(r).firstChild.nodeValue.length>0&&d.push(b.item(r));return d};ixMap.Themes.prototype.getMaxValue=function(d,a){a||(a=this.activeTheme);if(!a||!d)return null;
var g=0;d=a.itemA[d].nValuesA;for(a=0;a<d.length;a++)isNaN(d[a])&&(d[a]=0),g=Math.max(g,d[a]);return g};ixMap.Themes.prototype.getDataRow=function(d,a){a||(a=this.activeTheme);if(!a||!d)return null;if(!a.itemA[d]){var g=d.split("::");g&&g.length>1&&(d=g[0]+"::"+String(g[1]).toUpperCase())}if(!a.itemA[d])return null;g=a.objThemesA[a.szThemesA[0]];var b=[];if(a.szDataFieldsA)for(var r=0;r<a.szDataFieldsA.length;r++)for(var n=0;n<g.dbFields.length;n++)a.szDataFieldsA[r]==g.dbFields[n].id&&b.push(n);
else for(n=0;n<g.dbFields.length;n++)b.push(n);var v=[];if(g.dbRecords){if(typeof a.itemA[d].dbIndexA!="undefined"&&a.itemA[d].dbIndexA.length){for(var c in a.itemA[d].dbIndexA)for(c>0&&v.push("--------------------"),n=0;n<b.length;n++)v.push(g.dbFields[b[n]].id);for(c in a.itemA[d].dbIndexA)for(c>0&&v.push("--------------------"),r=a.itemA[d].dbIndexA[c],n=0;n<b.length;n++)v.push(g.dbRecords[r][b[n]]);return v}if(typeof a.itemA[d].dbIndex!="undefined"){r=a.itemA[d].dbIndex;for(n=0;n<b.length;n++)v.push(g.dbFields[b[n]].id);
for(n=0;n<b.length;n++)v.push(g.dbRecords[r][b[n]]);return v}d=d.split("::")[1];for(r=0;r<g.dbRecords.length;r++)if(g.dbRecords[r]&&g.dbRecords[r][g.nFieldSelectionIndex]&&String(g.dbRecords[r][g.nFieldSelectionIndex]).toUpperCase()==String(d).toUpperCase()){for(n=0;n<g.dbFields.length;n++)v.push(g.dbFields[n].id);for(n=0;n<g.dbFields.length;n++)v.push(g.dbRecords[r][n]);break}}return v};ixMap.Themes.prototype.getFieldIndexArray=function(d){d||(d=this.activeTheme);if(!d||d.szDataFieldsA)return[];
d.fieldIndexArray=[];for(var a=0;a<d.objThemesA[d.szThemesA[0]].nFieldIndexA.length;a++)d.fieldIndexArray.push(d.objThemesA[d.szThemesA[0]].nFieldIndexA[a]);for(a=0;a<d.objThemesA[d.szThemesA[0]].nField100IndexA.length;a++)d.fieldIndexArray.push(d.objThemesA[d.szThemesA[0]].nField100IndexA[a]);return d.fieldIndexArray};ixMap.Themes.prototype.getScatterArray=function(d,a,g){d||(d=this.activeTheme);var b=d.nMin,r=d.nMax,n=0,v;g.match(/LOG/)?(n=1-b,b=Math.log(b+n),r=Math.log(r+n)):g.match(/POW2/)&&(n=
1-b,b=Math.pow(b+n,.5),r=Math.pow(r+n,.5));g.match(/POW3/)&&(n=1-b,b=Math.pow(b+n,1/3),r=Math.pow(r+n,1/3));r=(r-b)/a;for(var c=[],e=0;e<a+1;e++)c[e]=0;for(v in d.itemA)e=d.itemA[v].nValuesA[0],typeof e=="number"&&(g.match(/LOG/)?e=Math.log(e+n):g.match(/POW2/)?e=Math.pow(e+n,.5):g.match(/POW3/)&&(e=Math.pow(e+n,1/3)),c[Math.max(0,Math.min(a-1,Math.floor((e-b)/r)))]++);return c};ixMap.Themes.prototype.getResolutionQualityOfArray=function(d){for(var a=d.length,g=-1E6,b=0;b<a;b++)g=Math.max(g,d[b]);
var r=0;for(b=0;b<a;b++)d[b]>g/10&&r++;return r/a*100};ixMap.Themes.prototype.getDeviationOfArray=function(d){for(var a=d.length,g=0,b=0,r=0;r<a;r++)g+=d[r];g/=a;for(r=0;r<a;r++)b+=(d[r]-g)*(d[r]-g);return Math.sqrt(b/a)};ixMap.Themes.prototype.getHistogram=function(d,a,g,b){if(!a)return null;b||(b=this.activeTheme);if(!b||b.nMin==b.nMax)return null;if(d){if(!b.itemA[d]){var r=d.split("::");r.length>1&&(d=r[0]+"::"+String(r[1]).toUpperCase())}if(!b.itemA[d])return null}this.histGroup=map.Dom.newGroup(a,
a.getAttributeNS(null,"id")+":group");this.histFlag=g;this.histTheme=b;a=map.Scale.normalX(70);g=map.Scale.normalY(20);map.Dom.newShape("rect",this.histGroup,0,0,a-map.Scale.normalX(.5),g,"fill:none;stroke:none;");d?(map.Themes.makeHistogram(d),setTimeout(function(){map.Themes.makeHistogram(d)},100)):setTimeout(function(){map.Themes.makeHistogram()},100)};ixMap.Themes.prototype.makeHistogram=function(d){var a=this.histGroup,g=this.histFlag,b=this.histTheme;if(g.match("CLASSES")){for(var r=map.Scale.normalX(50),
n=map.Scale.normalY(5),v,c=0,e=0,f=d?b.itemA[d].nValuesA[0]:0,m=0,l=0;l<b.partsA.length;l++){v=r/b.nCount*b.partsA[l].nCount;var h=map.Dom.newShape("rect",a,c,e,v,n,"fill:"+b.colorScheme[l]+";stroke:black;stroke-width:1;");h&&h.setAttributeNS(szMapNs,"tooltip",b.szLegendLabelA[l]+" ("+b.formatValue(b.partsA[l].nCount)+" "+map.Dictionary.getLocalText("members")+")");c+=v;f>b.partsA[l].max?m+=v:f>b.partsA[l].min&&(m+=v/(b.partsA[l].max-b.partsA[l].min)*(f-b.partsA[l].min))}map.Dom.newShape("circle",
a,m,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#444444;stroke:none;")}else if(g.match("DISTRIBUTION")){if(!isFinite(b.nMin)||!isFinite(b.nMax))return a;m=Math.min(500,Math.max(20,b.nCount/5));r=map.Scale.normalX(70);n=map.Scale.normalY(12);g.match("INTERACTIVE")&&(n=map.Scale.normalY(20));var p=r/m;f=d?b.itemA[d].nValuesA[0]:0;var B=0,C=b.nMin,N=b.nMax,Y=0,M=this.getScatterArray(b,m,"");l=this.getDeviationOfArray(M);c=this.getScatterArray(b,m,"LOG");e=this.getDeviationOfArray(c);var w=!1,J=
(N-C)/m;e&&e<l&&(M=c,Y=1-C,C=Math.log(C+Y),N=Math.log(N+Y),f=Math.log(f+Y),J=(N-C)/m,w=!0);for(l=0;l<m;l++)B=Math.max(B,M[l]);c=-20;e=0;b.histogram=new ixMap.Histogram(b);b.histogram.fDoLog=w;b.histogram.dValue=Y;b.histogram.nWidth=r;b.histogram.nMin=C;b.histogram.nMax=N;var L=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4),G=0;for(l=0;l<b.partsA.length;l++){v=(w?r/(N-C)*(Math.min(N,Math.log(b.partsA[l].max+Y))-C):r/(N-C)*(Math.min(N,b.partsA[l].max)-C))-c;h=1;if(b.szFlag.match(/DOPACITY/)){h=
b.partsA[l].min+(b.partsA[l].max-b.partsA[l].min)/2;var F=1/(b.nDopacityPow||1);h=b.szFlag.match(/DOPACITYMINMAX/)?h>=b.nMedianA[0]?Math.pow(Math.abs(h-b.nMedianA[0]),F)/Math.pow(b.nMax-b.nMedianA[0],F)*(b.fillOpacity||1)*(b.nDopacityScale||1):Math.pow(Math.abs(h-b.nMedianA[0]),F)/Math.pow(b.nMedianA[0]-b.nMin,F)*(b.fillOpacity||1)*(b.nDopacityScale||1):b.szFlag.match(/DOPACITYMIN/)?Math.pow(b.nMax-h,F)/Math.pow(b.nMax-b.nMin,F)*(b.fillOpacity||1)*(b.nDopacityScale||1):b.szFlag.match(/DOPACITYMAX/)?
Math.pow(h-b.nMin,F)/Math.pow(b.nMax-b.nMin,F)*(b.fillOpacity||1)*(b.nDopacityScale||1):b.szFlag.match(/DOPACITYLOG/)?Math.log(h-b.nMin)/Math.log(b.nMedianA[0]-b.nMin)*.5*(b.fillOpacity||1)*(b.nDopacityScale||1):b.szFlag.match(/DOPACITY/)?(h-b.nMin)/(b.nMedianA[0]-b.nMin)*.5*(b.fillOpacity||1)*(b.nDopacityScale||1):(l+m/10)/m}if(h=map.Dom.newShape("rect",a,c,e,v,n,"fill:"+b.colorScheme[l]+";fill-opacity:"+h+";stroke:black;stroke-width:"+map.Scale.normalX(.2)+";stroke-opacity:0.1")){h.setAttributeNS(szMapNs,
"tooltip",b.szLegendLabelA[l]+" ("+b.formatValue(b.partsA[l].nCount)+" "+map.Dictionary.getLocalText("members")+")");h.setAttributeNS(szMapNs,"onoverstyle","fill:"+b.colorScheme[l]+";stroke:black;stroke-width:"+map.Scale.normalX(.5)+";");F=Oa(b.szId);var V=Oa(String(l));h.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+F+"','"+V+"','1')");h.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+F+"')")}b.histogram.classRectA[l]=h;b.histogram.classRectXA[l]=c;b.histogram.classRectWidthA[l]=
v;b.histogram.classRectMaxA[l]=b.partsA[l].max;if(g.match("INTERACTIVE")){h=map.Dom.newGroup(a,"");F=null;if(l>0){map.Dom.newShape("line",h,c,e-map.Scale.normalY(2),c,e+n,"stroke:black;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.5");if(F=map.Dom.newShape("rect",h,c-map.Scale.normalY(1.5),e-map.Scale.normalY(6),map.Scale.normalX(3),map.Scale.normalY(5),"fill:"+b.colorScheme[l]+";stroke:black;styroke-width(1);"))F.setAttributeNS(null,"rx",map.Scale.normalX(2)),F.setAttributeNS(null,"ry",
map.Scale.normalY(1.5));F=map.Dom.newText(h,c,e-map.Scale.normalY(7),L+"display:none;font-weight:normal;text-anchor:middle",b.formatValue(b.partsA[l-1].max,1))}G=new Slider(h,new box(-G,0,G+v,0));G.setId(String(l));G.parent=b.histogram;G.textObj=F;G=v}c+=v}c=p/3;e=0;v=.9;l=this.getResolutionQualityOfArray(M);l<10&&(v=10-l);for(l=0;l<m;l++){N=M[l]/B*n*v;G=w?Math.exp(C+l*J)-Y:C+l*J;h=w?Math.exp(C+(l+1)*J)-Y:C+(l+1)*J;L="black";N=N&&!isNaN(N)?Math.min(n,Math.max(map.Scale.normalY(.5),N)):0;if(L=map.Dom.newShape("line",
a,c,e+n,c,e+n-N,"stroke:"+L+";stroke-width:"+p+";"))L.setAttributeNS(szMapNs,"tooltip",b.formatValue(G,2)+" ... "+b.formatValue(h,2)+b.szUnit+" ("+M[l]+" members)"),L.setAttributeNS(szMapNs,"onoverstyle","stroke:yellow;stroke-width:"+Math.max(map.Scale.normalX(1),p)+";");c+=p}map.Dom.newShape("line",a,-map.Scale.normalX(.5),n+1,r-map.Scale.normalX(.5),n+1,"stroke:black;stroke-width:"+map.Scale.normalX(.1)+";");m=-map.Scale.normalX(.5);r-=map.Scale.normalX(.5);c=map.Scale.normalX(2);map.Dom.newShape("line",
a,m,n,m,n+c,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");map.Dom.newShape("line",a,r,n,r,n+c,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");v=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4);e=map.Scale.tStyle.Summary.nFontHeight*.4;M=n+c+e*.8;l=b.formatValue(b.nMin,0);B=b.formatValue(b.nMax,0);map.Dom.newText(a,m-10,M,v+";font-weight:normal;text-anchor:start",l);b.nMin<0&&b.nMax>0&&(m=(0-C)/J*p,map.Dom.newShape("line",a,m,n,m,n+c,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+
";"),map.Dom.newText(a,m,M,v+";font-weight:normal;text-anchor:start","0"));N=0;for(l=10;l<b.nMax;l*=10)for(L=1;L<9&&!(l*L>b.nMax||l*L<b.nMin);L++)m=((w?Math.log(l*L+Y):l*L)-C)/J*p,G=b.formatValue(l*L,0),m>N+G.length*e*3/8?(map.Dom.newShape("line",a,m,n,m,n+c,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";"),map.Dom.newText(a,m,M,v+";font-weight:normal;text-anchor:middle",G),N=m+G.length*e*3/8):map.Dom.newShape("line",a,m,n,m,n+c/2,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");r>N+
B.length*e*3/8&&map.Dom.newText(a,r,M,v+";font-weight:normal;text-anchor:middle;",B);d&&!g.match("INTERACTIVE")&&(m=(f-C)/J*p,map.Dom.newShape("circle",a,m,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#dd0000;stroke:none;"),map.Dom.newShape("line",a,-10,-5,m-10,-5,"stroke:#000000;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3"))}else{r=map.Scale.normalX(70);n=map.Scale.normalY(12);v=r/700;e=c=0;N=b.nMax;d=n/N;p=Math.max(1,Math.ceil(b.nCount/700));g=[];C=0;Y=[];for(f in b.itemA)Y.push(b.itemA[f].nValuesA[0]);
Y.sort(b.sortUp);for(f in Y)C%p?g[g.length-1]+=Y[f]/p:g[g.length]=Y[f]/p,C++;g.sort(b.sortUp);for(l=0;l<g.length;l++){h=g[l];N=g[l]*d*.9;L="black";for(f=0;f<b.partsA.length;f++)if(g[l]<b.partsA[f].max){L=b.colorScheme[f];break}L=map.Dom.newShape("line",a,c,e,c,n,"stroke:"+L+";stroke-width:"+v+";");L.setAttributeNS(szMapNs,"tooltip",b.formatValue(h,2)+b.szUnit);isNaN(N)&&(N=0);L=map.Dom.newShape("line",a,c,e+n,c,e+n-N,"stroke:#000000;stroke-width:"+v+";");L.setAttributeNS(szMapNs,"tooltip",b.formatValue(h,
2)+b.szUnit);c+=v}l=b.formatValue(b.nMin,0);B=b.formatValue(b.nMax,0);v=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4);map.Dom.newText(a,c+map.Scale.normalX(1),e+n,v+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",l);map.Dom.newText(a,c+map.Scale.normalX(1),e+map.Scale.normalY(3.5),v+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",B);a&&a.fu.scale(r/c,1)}return a};ixMap.Histogram=function(d){this.mapTheme=d;this.fDoLog=!1;this.dValue=0;this.classRectA=[];this.classRectXA=
[];this.classRectWidthA=[];this.classRectMaxA=[]};ixMap.Histogram.prototype=new Map;ixMap.Histogram.prototype.onMouseOver=function(d,a,g){g.textObj&&g.textObj.style.setProperty("display","inline","")};ixMap.Histogram.prototype.onMouseOut=function(d,a,g){g.textObj&&g.textObj.style.setProperty("display","none","")};ixMap.Histogram.prototype.onMouseMove=function(d,a,g){if(d=this.classRectA[Number(a)])d.setAttributeNS(null,"x",this.classRectXA[Number(a)]+g.value.x),d.setAttributeNS(null,"width",this.classRectWidthA[Number(a)]-
g.value.x);if(d=this.classRectA[Number(a)-1]){d.setAttributeNS(null,"width",this.classRectWidthA[Number(a)-1]+g.value.x);var b=this.nMin+(this.nMax-this.nMin)/this.nWidth*(this.classRectXA[Number(a)]+g.value.x);b=this.fDoLog?Math.exp(b)-this.dValue:b;this.classRectMaxA[Number(a)-1]=b}g.textObj&&(g.textObj.firstChild.nodeValue=__formatValue(b,1))};ixMap.Histogram.prototype.onMouseUp=function(d,a,g){(g=this.classRectA[Number(a)-1])&&(this.classRectWidthA[Number(a)-1]=g.getAttributeNS(null,"width"));
a="ranges:"+String(this.nMin);for(g=0;g<this.classRectMaxA.length;g++)a+=","+String(this.classRectMaxA[g]);map.Themes.changeThemeStyle(d,this.mapTheme.szId,a)};ixMap.Themes.prototype.showErrorInfo=function(d,a){(d=this.getTheme(a))&&d.showErrorInfo()};ixMap.Themes.prototype.redraw=function(d){return this.actualize(d)};ixMap.Themes.prototype.actualizeActiveTheme=function(d){return this.actualize(d)};ixMap.Themes.prototype._debouncedRedrawWMS=function(){this.__wmsRedrawTimeout&&(clearTimeout(this.__wmsRedrawTimeout),
this.__wmsRedrawTimeout=null);this.__wmsRedrawTimeout=setTimeout(()=>{for(var d=0;d<this.themesA.length;d++)this.themesA[d].szFlag&&this.themesA[d].szFlag.match(/WMS/)&&(this.themesA[d].fRealize=!0);executeWithMessage(()=>map.Themes.execute(),"...",0);this.__wmsRedrawTimeout=null},100)};ixMap.Themes.prototype._debouncedActualize=function(d){this.__lastActualizeParam=d;this.__actualizeTimeout&&(clearTimeout(this.__actualizeTimeout),this.__actualizeTimeout=null);this.__actualizeTimeout=setTimeout(()=>
{var a=this.__lastActualizeParam;this.__lastActualizeParam=this.__actualizeTimeout=null;this._actualize(a)},0)};ixMap.Themes.prototype.actualize=function(d,a){a?(this.__actualizeTimeout&&(clearTimeout(this.__actualizeTimeout),this.__lastActualizeParam=this.__actualizeTimeout=null),this._actualize(d)):this._debouncedActualize(d)};ixMap.Themes.prototype._actualize=function(d){for(var a=0;a<this.themesA.length;a++)if(d&&d!=1&&this.themesA[a].szFlag.match(/FEATURE/)&&(this.themesA[a].nFeatureUpper||this.themesA[a].nFeatureLower)&&
(this.themesA[a].fDone||(this.themesA[a].fRealize=!this.themesA[a].fDone),setTimeout("map.Themes.execute()",100)),this.themesA[a].fDone)if(this.themesA[a].szFlag.match(/WMS/))this._debouncedRedrawWMS();else if(this.themesA[a].szFlag.match(/FEATURE/)&&this.themesA[a].szFlag.match(/CLIPTOGEOBOUNDS|CLIPTOVIEW/))this.themesA[a].fRealize=!0,executeWithMessage(()=>map.Themes.execute(),"...",100);else{if(this.themesA[a].szFlag.match(/CHART/)&&(this.themesA[a].__fClipToGeoBounds&&(this.themesA[a].fRealize=
!0),d&&d!=1&&this.themesA[a].szFlag.match(/DYNAMICSCALE/)&&(this.themesA[a].nScale*=Math.sqrt(d),this.themesA[a].fRealize=!0),d&&d!=1&&this.themesA[a].szFlag.match(/BEZIER/)&&(this.themesA[a].fRedraw=!0),this.themesA[a].szFlag.match(/DECLUTTER/)&&(this.themesA[a].fDeclutter=!0,map.Themes.execute()),d&&d!=1)){if(this.themesA[a].fRealizeDone){if(this.themesA[a].szAggregationFieldA){for(var g=this.themesA[a].nGridWidth,b=this.themesA[a].szAggregationField,r=0;r<this.themesA[a].szAggregationFieldA.length;r++){var n=
Number(this.themesA[a].szAggregationFieldA[r].split(":")[1]);n&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>n&&(isNaN(parseFloat(this.themesA[a].szAggregationFieldA[r+1]))?this.themesA[a].szAggregationField=this.themesA[a].szAggregationFieldA[r+1]:(this.themesA[a].szAggregationFieldA[r+1].match(/px/)?this.themesA[a].nGridWidthPx=parseFloat(this.themesA[a].szAggregationFieldA[r+1]):(this.themesA[a].nGridWidth=parseFloat(this.themesA[a].szAggregationFieldA[r+1]),this.themesA[a].nGridWidthPx=0),this.themesA[a].szAggregationField=
null));r++}this.themesA[a].szAggregationField!=b||this.themesA[a].nGridWidth!=g?(this.themesA[a].fRealize=!0,this.themesA[a].themeNodesPosA=[]):this.themesA[a].fRedraw=!0}this.themesA[a].nGridWidthPx?(g=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.themesA[a].nGridWidthPx),1E3),this.themesA[a].nGridWidth=g/map.Scale.nZoomScale,this.themesA[a].fRealize=!0,this.themesA[a].themeNodesPosA=[]):this.themesA[a].nGridMatrix&&(g=map.Zoom.getBox(),g=map.Scale.getDistanceInMeter(1E3,1E3,1E3+
g.width,1E3),this.themesA[a].nGridWidth=g/(this.themesA[a].nGridMatrix||20)/map.Scale.nZoomScale,this.themesA[a].fRealize=!0,this.themesA[a].themeNodesPosA=[]);if(this.themesA[a].szAggregationUpper||this.themesA[a].szAggregationLower)this.themesA[a].fRealize=this.themesA[a].szAggregationUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.themesA[a].nAggregationUpper||this.themesA[a].szAggregationLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.themesA[a].nAggregationLower?this.themesA[a].__fAggregate!=
0:this.themesA[a].__fAggregate==0}this.themesA[a].autoOpacity&&(this.themesA[a].fRedraw=!0);if(this.themesA[a].nValueUpper||this.themesA[a].nValueLower||this.themesA[a].nChartUpper||this.themesA[a].nChartLower||this.themesA[a].nBoxUpper||this.themesA[a].nBoxLower||this.themesA[a].nTitleUpper||this.themesA[a].nTitleLower||this.themesA[a].nLabelUpper||this.themesA[a].nLabelLower||this.themesA[a].nMaxCharts)this.themesA[a].fRedraw=!0}this.themesA[a].fRealize?(this.themesA[a].fRedraw=!1,this.themesA[a].fActualize=
!1):this.themesA[a].fActualize=this.themesA[a].fRedraw?!1:!0}executeWithMessage(()=>map.Themes.execute(),"working ...",100);return null};ixMap.Themes.prototype.resortCharts=function(d){var a=!1;if(this.themesA.length){for(var g=0;g<this.themesA.length;g++)this.themesA[g].fDone&&(a=this.themesA[g].fResort=!0);a&&map.Themes.execute()}d&&(d.stopPropagation(),d.preventDefault())};ixMap.Themes.prototype.clear=function(){this.themesA.length=0};y.prototype.getFields=function(){this.szFields=this.theme.szFields;
this.szFieldsA=this.theme.szFields.split("|");for(var d in this.szFieldsA)this.szFieldsA[d]=this.szFieldsA[d].trim();this.theme.szFieldsA=this.szFieldsA;this.szField100A=this.theme.szField100A;this.szColorField=this.theme.szColorField;this.szSymbolField=this.theme.szSymbolField;this.szValueField=this.theme.szValueField;this.szLabelField=this.theme.szLabelField;this.szTitleField=this.theme.szTitleField;this.szSnippetField=this.theme.szSnippetField;this.szSizeField=this.theme.szSizeField;this.szAlphaField=
this.theme.szAlphaField;this.szAlphaField100=this.theme.szAlphaField100;this.szXField=this.theme.szXField;this.szYField=this.theme.szYField;this.szTimeField=this.theme.szTimeField;this.szFilterField=this.theme.szFilterField;this.szAggregationField=this.theme.szAggregationField;this.szSelectionFieldsA=(this.theme.szSelectionField||"").split("|");this.nFieldIndexA[0]=-1;this.nFieldSelectionIndexA[0]=-1;this.theme.szSelectionField2&&(this.szSelectionField2=this.theme.szSelectionField2||null,this.szSelectionFields2A=
(this.theme.szSelectionField2||"").split("|"),this.nFieldSelection2IndexA=[-1]);var a;d=this.coTable?this.coTable:this.szName;if(!this.szFields||this.szFields==="")return!0;try{if((a=Q(d))&&a.table)this.dbTable=a.table;else{var g=Q(d+"_table");g&&(this.dbTable=g)}}catch(r){}if(this.coTable&&!this.dbTable)return displayMessage("Data not loaded!",1E3,!0),!1;if(this.dbTable){try{if((a=Q(d))&&a.fields)this.dbFields=a.fields;else{var b=Q(d+"_fields");b&&(this.dbFields=b)}}catch(r){}this.dbTable.fields=
this.dbFields.length;if(this.dbTable.fields==0||this.dbTable.records==0)return!1;try{this.szSelectionField||(this.szSelectionField=map.Layer.getLayerObj(this.szName).szSelection)}catch(r){return alert("no selection field found !!"),!1}for(a=0;a<this.dbTable.fields;a++)if(!this.dbFields||this.dbFields.length===0||!this.dbFields[a])return alert("ERROR: theme '"+this.szName+"' - table '"+d+"' - object 'fields' incorrect !"),!1;if(this.szFields=="$table$"){this.szFieldsA=[];for(a=0;a<this.dbFields.length;a++)this.dbFields[a].id!=
this.szSelectionField&&this.dbFields[a].id!="Total"&&this.szFieldsA.push(this.dbFields[a].id);this.theme.szFields=this.szFieldsA.join("|");this.theme.szFieldsA=this.szFieldsA;this.theme.szLabelA=this.szFieldsA}for(a=0;a<this.dbFields.length;a++){typeof this.szItemField!="undefined"&&String(this.dbFields[a].id).toLowerCase()==String(this.szItemField).toLowerCase()&&(this.nFieldItemIndex=a);typeof this.szSelectionField!="undefined"&&String(this.dbFields[a].id).toLowerCase()==String(this.szSelectionField).toLowerCase()&&
(this.nFieldSelectionIndex=a);if(typeof this.szSelectionField2!="undefined")for(String(this.dbFields[a].id).toLowerCase()==String(this.szSelectionField2).toLowerCase()&&(this.nFieldSelection2Index=a),d=0;d<this.szSelectionFields2A.length;d++)this.dbFields[a].id==this.szSelectionFields2A[d]&&(this.nFieldSelection2IndexA[d]=a);for(d=0;d<this.szSelectionFieldsA.length;d++)this.dbFields[a].id==this.szSelectionFieldsA[d]&&(this.nFieldSelectionIndexA[d]=a);for(d=0;d<this.szFieldsA.length;d++)this.szFieldsA[d].substr(0,
1)=="!"?this.dbFields[a].id==this.szFieldsA[d].substr(1,this.szFieldsA[d].length-1)&&(this.nFieldIndexA[d]=a):this.dbFields[a].id==this.szFieldsA[d]&&(this.nFieldIndexA[d]=a);if(this.szField100A)for(d=0;d<this.szField100A.length;d++)this.dbFields[a].id==this.szField100A[d]&&(this.nField100IndexA[d]=a);this.szColorField&&this.dbFields[a].id==this.szColorField&&(this.nColorFieldIndex=a);this.szSymbolField&&this.dbFields[a].id==this.szSymbolField&&(this.nSymbolFieldIndex=a);this.szValueField&&this.dbFields[a].id==
this.szValueField&&(this.nValueFieldIndex=a);this.szLabelField&&this.dbFields[a].id==this.szLabelField&&(this.nLabelFieldIndex=a);this.szTitleField&&this.dbFields[a].id==this.szTitleField&&(this.nTitleFieldIndex=a);this.szSnippetField&&this.dbFields[a].id==this.szSnippetField&&(this.nSnippetFieldIndex=a);this.szSizeField&&this.dbFields[a].id==this.szSizeField&&(this.nSizeFieldIndex=a);this.szTimeField&&this.dbFields[a].id==this.szTimeField&&(this.nTimeFieldIndex=a);this.szXField&&this.dbFields[a].id==
this.szXField&&(this.nXFieldIndex=a);this.szYField&&this.dbFields[a].id==this.szYField&&(this.nYFieldIndex=a);this.szAlphaField&&this.dbFields[a].id==this.szAlphaField&&(this.nAlphaFieldIndex=a);this.szAlphaField100&&this.dbFields[a].id==this.szAlphaField100&&(this.nAlphaField100Index=a);this.szFilterField&&this.dbFields[a].id==this.szFilterField&&(this.nFilterFieldIndex=a);this.szAggregationField&&this.dbFields[a].id==this.szAggregationField&&(this.nAggregationFieldIndex=a)}this.nFieldSelectionIndex==
-1&&this.nFieldSelectionIndexA[0]==-1&&(this.szSelectionField&&this.szSelectionField.length?_ERROR("ERROR on load theme data: selection field '"+this.szSelectionField+"' not found !"):_ERROR("ERROR on load theme data: selection not defined !"));for(d=0;d<this.szFieldsA.length;d++)if(typeof this.nFieldIndexA[d]=="undefined")return _ERROR("ERROR on load theme data: value field '"+this.szFieldsA[d]+"' not found !"),!1;if(this.szField100A)for(d=0;d<this.szField100A.length;d++)if(typeof this.nField100IndexA[d]==
"undefined")return _ERROR("ERROR on load theme data: value 100 field '"+this.szFieldsA[d]+"' not found !"),!1;this.szColorField&&!this.szColorField.match(/\$/)&&typeof this.nColorFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: colorfield: '"+this.szColorField+"' not found !");this.szSymbolField&&!this.szSymbolField.match(/\$/)&&typeof this.nSymbolFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: symbolfield: '"+this.szSymbolField+"' not found !");this.szValueField&&!this.szValueField.match(/\$/)&&
typeof this.nValueFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: valuefield: '"+this.szValueField+"' not found !");this.szLabelField&&!this.szLabelField.match(/\$/)&&typeof this.nLabelFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: labelfield '"+this.szLabelField+"' not found !");this.szTitleField&&!this.szTitleField.match(/\$/)&&typeof this.nTitleFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: titlefield '"+this.szTitleField+"' not found !");this.szSnippetField&&
!this.szSnippetField.match(/\$/)&&typeof this.nSnippetFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: snippetfield '"+this.szSnippetField+"' not found !");this.szSizeField&&!this.szSizeField.match(/\$/)&&typeof this.nSizeFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: sizefield '"+this.szSizeField+"' not found !");this.szTimeField&&!this.szTimeField.match(/\$/)&&typeof this.nTimeFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: timefield '"+this.szTimeField+"' not found !");
this.szXField&&!this.szXField.match(/\$/)&&typeof this.nXFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: xfield '"+this.szXField+"' not found !");this.szYField&&!this.szYField.match(/\$/)&&typeof this.nYFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: yfield '"+this.szYField+"' not found !");this.szAlphaField&&!this.szAlphaField.match(/\$/)&&typeof this.nAlphaFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: alphafield '"+this.szAlphaField+"' not found !");this.szAlphaField100&&
!this.szAlphaField100.match(/\$/)&&typeof this.nAlphaField100Index=="undefined"&&_ERROR("ERROR on load theme data: alpha100field '"+this.szAlphaField100+"' not found !");this.szFilterField&&!this.szFilterField.match(/\$/)&&typeof this.nFilterFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: filterfield '"+this.szFilterField+"' not found !");this.szAggregationField&&!this.szAggregationField.match(/\$/)&&typeof this.nAggregationFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: aggregationfield '"+
this.szAggregationField+"' not found !");!this.szItemField||this.szItemField==this.szSelectionField||this.szItemField.match(/\$/)||typeof this.nFieldItemIndex!="undefined"&&this.nFieldItemIndex!=-1||alert("ERROR on load theme data: itemfield '"+this.szItemField+"' not found !")}else{d=map.SVGDocument.getElementById(this.szName);d==null&&(a=map.Tiles.getTileNodes(this.szName))&&(d=a[0]);if(!d)return this.szName="",!1;d=d.getAttributeNS(szMapNs,"info");if(d==null||d==="")return this.szName="",!1;g=
d.split("|");for(a=0;a<g.length;a++){for(d=0;d<this.szFieldsA.length;d++)this.szFieldsA[d].substr(0,1)=="!"?g[a]==this.szFieldsA[d].substr(1,this.szFieldsA[d].length-1)&&(this.nFieldIndexA[d]=a):g[a]==this.szFieldsA[d]&&(this.nFieldIndexA[d]=a);for(d=0;d<this.szField100A.length;d++)g[a]==this.szField100A[d]&&(this.nField100IndexA[d]=a);this.szColorField&&g[a]==this.szColorField&&(this.nColorFieldIndex=a);this.szSymbolField&&g[a]==this.szSymbolField&&(this.nSymbolFieldIndex=a);this.szValueField&&g[a]==
this.szValueField&&(this.nValueFieldIndex=a);this.szLabelField&&g[a]==this.szLabelField&&(this.nLabelFieldIndex=a);this.szTimeField&&g[a]==this.szTimeField&&(this.nTimeFieldIndex=a);this.szSizeField&&g[a]==this.szSizeField&&(this.nSizeFieldIndex=a);this.szXField&&g[a]==this.szXField&&(this.nXFieldIndex=a);this.szYField&&g[a]==this.szXField&&(this.nYFieldIndex=a);this.szAlphaField&&g[a]==this.szAlphaField&&(this.nAlphaFieldIndex=a);this.szAlphaField100&&g[a]==this.szAlphaField100&&(this.nAlphaField100Index=
a)}}for(d=0;d<this.szFieldsA.length;d++)this.nFieldIndexA[d]<0&&(this.szFieldsA[d]!="$item$"&&this.szFieldsA[d]!="$index$"&&_ERROR("ERROR on load theme data: '"+this.szFieldsA[d]+"' not found !"),this.szName="");return!0};A.prototype.checkTheme=function(){if(!this.szThemesA)return!1;for(var d=0;d<this.szThemesA.length;d++)if(this.szThemesA[d]=="generic"||map.Layer.isLoaded(this.szThemesA[d]))return!0;this.ErrorMessage="theme layer not loaded ! zoom in ?";return!1};A.prototype.def=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};
A.prototype.getDefinitionObject=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};A.prototype.set=function(d){map.Themes.parseStyle(this,d)};A.prototype.setDefinitionObject=function(d){map.Themes.parseStyle(this,d)};A.prototype.initValues=function(){this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;for(var d=this.nNoData=this.nCount=this.nSum=0;d<this.szFieldsA.length;d++)this.nMinA[d]=Number.MAX_VALUE,this.nMaxA[d]=-Number.MAX_VALUE,this.nSumA[d]=0,this.nOrigMinA[d]=Number.MAX_VALUE,
this.nOrigMaxA[d]=-Number.MAX_VALUE,this.nOrigSumA[d]=0,this.nMedianA[d]=0,this.nMeanA[d]=0,this.nDeviationA[d]=0;this.nMin100=Number.MAX_VALUE;this.nMax100=-Number.MAX_VALUE;this.nSum100=0;this.itemA=[];this.posItemA=[];this.chartPosA=[];this.exactCountA=[];this.exactSizeA=[];this.quantileA=[];this.szAggregation||(this.szAggregation=this.szField100?"mean":"sum");if(this.szAggregationFieldA&&!this.fSuppressAggregationScale)for(d=0;d<this.szAggregationFieldA.length;d++){var a=Number(this.szAggregationFieldA[d].split(":")[1]);
a&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>a&&(isNaN(parseFloat(this.szAggregationFieldA[d+1]))?this.szAggregationField=this.szAggregationFieldA[d+1]:(this.szAggregationFieldA[d+1].match(/px/)?this.nGridWidthPx=parseFloat(this.szAggregationFieldA[d+1]):(this.nGridWidth=parseFloat(this.szAggregationFieldA[d+1]),this.nGridWidthPx=0),this.szAggregationField=null));d++}this.fSuppressAggregationScale=!1;this.nWrongRecordLengthCount=0;this.missedA=[];this.coTable&&this.coTable!="genericTable"||!this.loadTableFromMap()||
(this.coTable="genericTable")};A.prototype.removeValues=function(){this.missedA=this.quantileA=this.exactSizeA=this.exactCountA=this.chartPosA=this.posItemA=this.itemA=null};A.prototype.getMeanMedianQuantile=function(){if(!this.quantileA||!this.quantileA.length)for(var d=0;d<this.nMaxA.length;d++){var a=[],g=0,b;for(b in this.itemA)a.push(this.itemA[b].nValuesA[d]),g+=this.itemA[b].nValuesA[d];this.szFieldsA[d]&&this.szFieldsA[d]!="$item$"&&a.sort(this.sortUp);this.nMedianA[d]=a[Math.round(a.length/
2)];this.nMeanA[d]=g/a.length;this.quantileA[d]=a}};A.prototype.getHeadTail=function(){var d=[],a;for(a in this.itemA)d.push(this.itemA[a].nValuesA[0]);return{mean:function(g){var b=g.length;return g.reduce(function(r,n){return r+n},0)/b},headTail:function(g){var b=Math.min.apply(null,g),r=this.mean(g);b=[b];for(b.push(r);g.length>1;)g=g.filter(function(n){return n>r}),r=this.mean(g),b.push(r);return b}}.headTail(d)};A.prototype.realize=function(){_LOG("theme realize start - "+this.szId+this.szFlag);
if(this.szFlag.match(/WMS/)){this.chartGroup||(this.chartGroup=map.Dom.newGroup(map.Layer.layerNode,this.szThemesA[0]),map.Layer.listA[this.szThemesA[0]]=new ixMap.Layer.Item(null),map.Layer.listA[this.szThemesA[0]].szName=this.szThemesA[0],this.isChecked=this.fDone=!0);var d=map.Zoom.getBoundsOfMapInGeoBounds(),a=map.Scale.viewBox.width/map.Zoom.nZoomX,g=map.Scale.viewBox.height/map.Zoom.nZoomY,b=map.Scale.bBox.width/20,r=map.Scale.bBox.height/20;this.nLayerLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=
this.nLayerLower?this.clearWMS():this.nLayerUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nLayerUpper?this.clearWMS():(map.Dom.constructNode("image",this.chartGroup,{"xlink:href":this.szServer+"?f=image&transparent=true&bbox="+d[0].x+","+d[0].y+","+d[1].x+","+d[1].y+"&bboxSR=4326&size="+b+","+r,x:-map.Scale.mapCenter.x/map.Zoom.nZoomX-a/2,y:-map.Scale.mapCenter.y/map.Zoom.nZoomY-g/2,style:"width:"+a+";height:"+g+";opacity:"+(this.nOpacity||.8)+";pointer-events:none;",onload:'map.Themes.getTheme("'+
this.szId+'").cleanWMS();'}),this.fDone=!0)}else if(!this.szFlag.match(/FEATURE/)||!(this.nFeatureLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nFeatureLower||this.nFeatureUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nFeatureUpper)){if(this.szFlag.match(/CHART|CHOROPLETH/)&&(!this.nChartLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nChartLower)&&(!this.nChartUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nChartUpper))for(d in a=map.Themes.getAllThemes(),
a)if(a[d]!=this&&a[d].szFlag.match(/FEATURE/)&&a[d].szThemesA[0]==this.szThemesA[0]&&!a[d].fDone){this.fRealize=!0;setTimeout("map.Themes.execute()",500);return}if(this.coTable){this.__test=null;try{if((g=Q(this.coTable))&&g.table)this.__test=g.table;else if(b=Q(this.coTable+"_table"))this.__test=b}catch(v){try{if(b=Q(this.coTable+"_table"))this.__test=b}catch(c){}}if(!this.__test){map.Themes.loadExternalData(this.coTable,this.nRefreshTimeout,this);this.fRealize=!0;return}}a=new Date;this.fShowProgressBar=
!0;this.initValues();if(this.getFields()&&this.loadValues())if(this.szFlag.match(/\bPOSITION\b/)){_LOG("start");a=this.szThemesA[0];g=this.objThemesA[a];b=g.nFieldItemIndex;r=g.nFieldSelectionIndexA[0];var n=g.nFieldSelectionIndexA[1];for(d in g.dbRecords)map.Themes.themeNodesPosA[a+"::"+g.dbRecords[d][b]]=map.Scale.getMapPositionOfLatLon(Number(g.dbRecords[d][r].replace(",",".")),Number(g.dbRecords[d][n].replace(",",".")));_LOG("stop");this.fDraw=this.fAnalyze=!1;this.fDone=!0}else this.fDone=!1,
this.timeLoading=new Date-a,(this.timeLoading>1E3||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage(()=>map.Themes.executeContinue(),this.szFlag.match(/AGGREGATE/)?"aggregating":"parsing data"):map.Themes.executeContinue()}};A.prototype.cleanWMS=function(){this.chartGroup.childNodes.length>1&&this.chartGroup.removeChild(this.chartGroup.firstChild)};A.prototype.clearWMS=function(){map.Dom.clearGroup(this.chartGroup)};A.prototype.realize_analyze=function(){var d=new Date;
(this.fDraw=this.distributeValues())||this.realizeDone();this.timeAggregating=new Date-d;(this.timeLoading>1E3||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage(()=>map.Themes.executeContinue(),"drawing"):map.Themes.executeContinue()};A.prototype.realize_draw=function(){var d=map.Layer.getLayerObj(this.szThemesA[0]);d&&(this.szShapeType=d.szType,this.szShapeType=="line"&&this.szOrigFlag.match(/BUFFER/)&&(this.szShapeType+="+buffer"));this.szOrigFlag.match(/FEATURE/)&&
this.szOrigFlag.match(/LINES/)&&(this.szShapeType="line");_LOG("theme draw start - "+this.szId);this.timeStart=new Date;this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nSkipCount=this.nDoneCount=0;d=this.szFlag.match(/\bLAST\b/);var a=this.szFlag.match(/\bCLIP\b/),g=this.nActualFrame;g=a&&this.nClipFrames&&g===this.nClipFrames-1;this.nActualFrame=(d||g)&&a&&this.nClipFrames?this.nClipFrames-1:0;d=this.szFlag.match(/VERBOSE/)?"drawing":"";this.mapSleep=new ixMap.Sleep("map.Themes.executeContinue",
this.nflushPaintShape,map.Dictionary.getLocalText(d));this.mapSleep.nCount=this.nCount;this.mapSleep.szCancel="map.Themes.cancelExecute()";this.szFlag.match(/\bCLIP\b/)&&(this.mapSleep=null,this.nClipIncr=1);this.szFlag.match(/FEATURE/)?(this.mapSleep=null,this.unpaintMap(),this.chartGroup&&this.fClearOnProjectionChange&&(this.chartGroup.style.setProperty("display","inline",""),map.Dom.clearGroup(this.chartGroup),this.fClearOnProjectionChange=!1),this.chartMap()):this.szFlag.match(/CHART/)?(this.mapSleep&&
(this.mapSleep.initCheckSleep(this.nflushChartDraw,d),this.mapSleep.fShowProgressBar=!0),this.chartMap()):(this.unlabelMap(),this.paintMap(),this.makeVisible());this.isChecked=!0;!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/SYMBOL/)||this.szFlag.match(/BAR/)&&this.colorScheme&&this.nOrigSumA&&this.nOrigSumA.length!=this.colorScheme.length?this.isMarkable=!0:this.isMarkable=!1};A.prototype.realizeContinue=function(d){this.fMakeLabel?this.labelMap(d):
this.szFlag.match(/CHART/)?this.chartMap(d):this.paintMap(d)};A.prototype.realizeNextClipFrame=function(){if(this.szFlag.match(/\bCLIP\b/)&&!this.fClipPause){var d=this.szId;this.nActualFrame+=this.nClipIncr;this.nActualFrame>=this.nClipFrames?this.szFlag.match(/BACK/)?(this.nClipIncr=-this.nClipIncr,this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(d)},1E3)):this.szFlag.match(/LOOP/)?(this.nActualFrame=-1,this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(d)},1E3)):(this.nActualFrame=
this.nClipFrames-1,this.pauseClip()):this.nActualFrame<0?this.szFlag.match(/BACK/)?(this.nClipIncr=-this.nClipIncr,this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(d)},10)):(this.nActualFrame=0,this.pauseClip()):(this.mapSleep=null,this.szFlag.match(/CHART/)?(this.chartPosA=[],this.posItemA=[],this.fDone=!1,this.fRedraw=!0,this.chartMap()):this.paintMap(),this.fRedrawInfo=!0)}};A.prototype.setClipFrame=function(d){this.fClipPause=!0;this.nActualFrame=Math.min(d,this.nClipFrames);this.mapSleep=
null;this.szFlag.match(/CHART/)?(this.chartPosA=[],this.posItemA=[],this.fDone=!1,this.chartMap()):this.paintMap();this.fRedrawInfo=!0};A.prototype.startClip=function(d){var a=map.SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");a&&a.style.setProperty("display","inline","");(a=map.SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&a.style.setProperty("display","none","");this.fClipPause=!1;this.nActualFrame=d||this.nActualFrame;this.realizeNextClipFrame()};
A.prototype.pauseClip=function(){var d=map.SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");d&&d.style.setProperty("display","none","");(d=map.SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&d.style.setProperty("display","inline","");this.clipTimeout&&clearTimeout(this.clipTimeout);this.fClipPause=!0};A.prototype.realizeDone=function(){var d=this.szId;this.nRefreshTimeout&&(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=
setTimeout(function(){map.Themes.refreshTheme(d)},this.nRefreshTimeout));if(this.szFlag.match(/\bCLIP\b/)){var a=this.szFlag.match(/\bLAST\b/);this.szFlag.match(/\bPAUSE\b/)&&(this.removeDefinitionFromFlag("PAUSE"),this.fClipPause=!0);if(a){this.removeDefinitionFromFlag("LAST");var g=this.nClipFrames-1;setTimeout(function(){map.Themes.setClipFrame(d,g)},10)}a||(this.clipTimeout&&clearTimeout(this.clipTimeout),this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(d)},this.nActualFrame?this.nClipTimeout:
1E3))}this.nWrongRecordLengthCount&&map.fDebug&&displayMessage("Data Error:  "+this.nWrongRecordLengthCount+" items have wrong record length",1E4,"notify");this.fRealize=this.fRedraw=!1;this.fDone=!0;this.timeRealizing=new Date-this.timeStart;_LOG("theme done - "+this.szId);var b=this;this.szFlag.match(/SHOW/)&&(this.removeDefinitionFromFlag("SHOW"),this.szFlag.match(/FEATURE/)?setTimeout(function(){b.zoomTo()},10):this.zoomTo());this.szFlag.match(/ZOOMTO/)&&(this.removeDefinitionFromFlag("ZOOMTO"),
this.szFlag.match(/FEATURE/)?setTimeout(function(){map&&map.Scale&&map.Zoom&&map.Scale.getMapCoordinateOfLatLon?b.zoomTo():setTimeout(function(){b.zoomTo()},100)},50):this.zoomTo());map.Themes.realizeDone(this)};A.prototype.beginDraw=function(){};A.prototype.endDraw=function(){};A.prototype.redraw=function(d){if(!this.szFlag.match(/FEATURE/)){this.clipTimeout&&clearTimeout(this.clipTimeout);this.fDataIncomplete&&this.__themeNodes!=map.Themes.themeNodes&&(this.fDataIncomplete=!1,this.initValues(),
this.loadValues(),this.distributeValues());if(this.szFlag.match(/CHART/)){if(this.fClipCharts||this.fRedraw)this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nDoneCount=this.nSkipCount=0,this.chartMap()}else if(this.isChecked){if(this.partsA)for(var a=0;a<this.partsA.length;a++)this.partsA[a].nCount=0,this.partsA[a].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,"painting map");this.makeVisible();this.paintMap()}d&&this.enable()}};
A.prototype.toFront=function(){if(this.szFlag.match(/CHART/)){this.chartGroup.parentNode.appendChild(this.chartGroup);var d=getMatrix(this.chartGroup);d&&setMatrix(this.chartGroup,d);this.enable()}else if(this.isChecked){for(d=0;d<this.partsA.length;d++)this.partsA[d].nCount=0,this.partsA[d].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,"painting map");this.paintMap()}else this.enable()};A.prototype.getFields=function(){for(var d=0;d<this.szThemesA.length;d++){var a=this.szThemesA[d];
this.objThemesA[a]=new y(a,d,this.coTable,this.szSelectionField,this.szItemField);this.objThemesA[a].theme=this;if(!this.objThemesA[a].getFields()){try{map.HTMLWindow.ixmaps.htmlgui_onErrorTheme(a)}catch(g){}return!1}}return!0};A.prototype.addItemValues=function(d,a,g,b,r){if(!this.szFlag.match(/RAW/)||g|b|r){var n;if(this.szExcludeA)for(n=0;n<this.szExcludeA.length;n++)if(d.split("::")[1]==this.szExcludeA[n])return;if(!(this.nField100Min&&g&&g[0]&&g[0]<this.nField100Min)){if(this.nMinValue&&a&&!g){var v=
!1;for(n=a.length-1;n>=0;n--)a[n]>=this.nMinValue&&(v=!0);if(!v)return}v=1;if(this.__fDensity||this.__fDensityAlpha)if(v=this.getNodeArea(d),!v&&this.__fTiledLayer){this.fDataIncomplete=!0;return}if(this.szWeights)for(n=0;n<a.length;n++)a[n]*=this.szWeightsA[n]||this.szWeightsA[0];if(this.__fAuto100){var c=0;for(n=0;n<a.length;n++)c+=a[n]||0;for(n=0;n<a.length;n++)g[n]=c;this.fField100=!0}this.itemA[d]={nOrigValuesA:[],nValuesA:a,nValue100A:g,nValueSum:0};for(n=0;n<a.length;n++)this.itemA[d].nOrigValuesA[n]=
isNaN(a[n])?0:a[n],this.itemA[d].nValueSum+=a[n]||0,this.fField100&&(g?(c=a[n],c!==0||this.szFlag.match(/ZEROISVALUE/)?this.szFieldsA[n].substr(0,1)=="!"?(c=g[n]-c,this.itemA[d].nOrigValuesA[n]=c):this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?(c=g[n]?Math.round(c*g[n]/100):c,this.itemA[d].nOrigValuesA[n]=c):this.szFlag.match(/PRODUCT/)?c=g[n]?c*g[n]:c:this.szFlag.match(/DIFFERENCE/)&&a.length==1&&!this.szFlag.match(/RELATIVE/)?(g[n]=n>0?a[n-1]:this.itemA[d].nValue100A[n],c-=g[n]):(c=
g[n]?c/g[n]:1,this.szFlag.match(/FRACTION/)?c*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?c*=1E3:(c*=100,c>0&&this.szFlag.match(/RELATIVE/)?c-=100:c>0&&this.szFlag.match(/INVERT/)&&(c=100-c))):c=0,a[n]=c):a[n]=0),this.__fDensity&&(a[n]=v?a[n]/v:null);if(this.__fDifference&&a.length>1){for(n=0;n<a.length;n++)n<a.length-1?(c=a[n],a[n]=a[n+1]-a[n],this.szFlag.match(/RELATIVE/)&&(a[n]=c?100/c*a[n]:a[n]?100:0)):this.szFlag.match(/STACKED/)||(a[n]=0);a.pop()}for(n=0;n<a.length;n++){if(!this.nSumA)return;
!isNaN(a[n])&&isFinite(a[n])&&(this.nMin=Math.min(this.nMin,a[n]),this.nMax=Math.max(this.nMax,a[n]),this.nSum+=a[n],this.nMinA[n]=Math.min(this.nMinA[n],a[n]),this.nMaxA[n]=Math.max(this.nMaxA[n],a[n]),this.nSumA[n]+=a[n],this.nOrigMinA[n]=Math.min(this.nOrigMinA[n],this.itemA[d].nOrigValuesA[n]),this.nOrigMaxA[n]=Math.max(this.nOrigMaxA[n],this.itemA[d].nOrigValuesA[n]),this.nOrigSumA[n]+=this.itemA[d].nOrigValuesA[n]);a[n]<0&&(this.fNegativeValues=!0)}!isNaN(g[0])&&isFinite(g[0])&&(this.nMin100=
Math.min(this.nMin100,g[0]),this.nMax100=Math.max(this.nMax100,g[0]),this.nSum100+=g[0]);this.szSizeField&&(!isNaN(b)&&isFinite(b)?(this.itemA[d].nSize=b,this.nMinSize=Math.min(this.nMinSize,b),this.nMaxSize=Math.max(this.nMaxSize,b),this.nSumSize+=b):this.itemA[d].nSize=0);this.szAlphaField&&r!=null&&!isNaN(r)&&isFinite(r)&&(this.__fDensityAlpha&&(r=v?r/v:0),this.itemA[d].nAlpha=r,this.nMinAlpha=Math.min(this.nMinAlpha,r),this.nMaxAlpha=Math.max(this.nMaxAlpha,r),this.nSumAlpha+=r);if(this.__fExact&&
this.exactCountA)for(n=0;n<a.length;n++)a[n]&&(this.exactCountA[a[n]-1]?(this.exactCountA[a[n]-1]++,this.exactSizeA[a[n]-1]+=this.itemA[d].nSize||1):(this.exactCountA[a[n]-1]=1,this.exactSizeA[a[n]-1]=this.itemA[d].nSize||1));this.nCount++}}else{this.itemA[d]={nOrigValuesA:[],nValuesA:a,nValue100A:g,nValueSum:0};for(n=0;n<a.length;n++){if(!this.nSumA)return;isNaN(a[n])||(this.nMin=Math.min(this.nMin,a[n]),this.nMax=Math.max(this.nMax,a[n]),this.nSum+=a[n]);a[n]<0&&(this.fNegativeValues=!0);this.__fExact&&
this.exactCountA&&a[n]&&(this.exactCountA[a[n]-1]?(this.exactCountA[a[n]-1]++,this.exactSizeA[a[n]-1]+=this.itemA[d].nSize||1):(this.exactCountA[a[n]-1]=1,this.exactSizeA[a[n]-1]=this.itemA[d].nSize||1))}this.nCount++}};A.prototype.getStringValueIndex=function(d,a){if(d.length===0||d==" ")if(this.szFlag.match(/UNDEFINEDISVALUE/))d="undefined";else return-1;this.szFlag.match(/IGNORECASE/)&&(d=d.toUpperCase());d=d.trim();typeof this.nStringToValueA[d]!="undefined"||this.szValuesA&&this.szValuesA.length&&
a!="set"||(this.szLabelA=this.szLabelA||[],this.szExactA=this.szExactA||[],this.nStringToValueA[d]=this.nStringToValue,this.szLabelA[this.nStringToValue-1]=this.szLabelA[this.nStringToValue-1]||d,this.szExactA.push(this.nStringToValue),this.nStringToValue++);return this.nStringToValueA[d]};A.prototype.checkHiddenLayerState=function(){for(var d=0;d<this.szThemesA.length;d++)if(map.Layer.isScaleDependentLayer(this.szThemesA[d])&&(this.hiddenLayerA[this.szThemesA[d]]&&map.Layer.isScaleDependentLayerOn(this.szThemesA[d])||
!this.hiddenLayerA[this.szThemesA[d]]&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[d])))return!0;return!1};var ba=function(d){return String(d).match(/,/)?parseFloat(String(d).replace(/\./gi,"").replace(/,/gi,".")):parseFloat(String(d).replace(/ /gi,""))};A.prototype.loadValues=function(){this.nMissingLookupCount=0;this.__fExact=this.szFlag.match(/CATEGORICAL/);this.__fMax=this.szFlag.match(/\bMAX\b/);this.__fMin=this.szFlag.match(/\bMin\b/);this.__fFirst=this.szFlag.match(/\bFIRST\b/);this.__fLast=
this.szFlag.match(/\bLAST\b/);this.__fDifference=this.szFlag.match(/DIFFERENCE/);this.__fFilter=this.szFilter&&this.szFilter.length;this.__fDensity=this.szFlag.match(/DENSITY/);this.__fDensityAlpha=!this.szFlag.match(/CHART/)&&this.szAlphaField100&&this.szAlphaField100.match(/\$density\$/i);this.__fAggregate=this.szFlag.match(/AGGREGATE/);this.__fAuto100=this.szFlag.match(/AUTO100/)&&!this.szFlag.match(/AGGREGATE/);this.__fTiledLayer=map.Layer.getLayerObj(this.szThemesA[0])?map.Layer.getLayerObj(this.szThemesA[0]).szFlag.match(/tiled/):
!1;this.__themeNodes=map.Themes.themeNodes;for(var d=0;d<this.szThemesA.length;d++)if(map.Layer.isScaleDependentLayer(this.szThemesA[d])&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[d]))this.fRealize=this.hiddenLayerA[this.szThemesA[d]]=!0;else if(this.hiddenLayerA[this.szThemesA[d]]=!1,!this.loadValuesOfTheme(this.szThemesA[d]))return!1;return!0};A.prototype.filterValues=function(d){if(this.szFilter.match(/WHERE/)){if(!this.objTheme.filterQueryA){for(var a=this.szFilter.split("WHERE ")[1].split(" "),
g=0;g<a.length;g++)if(a[g].length){if(a[g][0]=='"'&&a[g][a[g].length-1]!='"'){do a[g]=a[g]+" "+a[g+1],a.splice(g+1,1);while(a[g][a[g].length-1]!='"')}if(a[g][0]=="("&&a[g][a[g].length-1]!=")"){do a[g]=a[g]+" "+a[g+1],a.splice(g+1,1);while(a[g][a[g].length-1]!=")")}}else a.splice(g,1),g--;this.objTheme.filterQueryA=[];var b={};do{var r=0;a.length>=3&&(b={},b.szFilterField=a[0].replace(/("|)/g,""),b.szFilterOp=a[1],b.szFilterValue=a[2].replace(/("|)/g,""),r=3);b.szFilterOp=="BETWEEN"&&a.length>=5&&
a[3]=="AND"&&(b.szFilterValue2=a[4].replace(/("|)/g,""),r=5);if(r){if(b.szFilterField=="*")b.nFilterFieldIndex=-1;else for(g=0;g<this.objTheme.dbFields.length;g++)this.objTheme.dbFields[g].id==b.szFilterField&&(b.nFilterFieldIndex=g),"$"+this.objTheme.dbFields[g].id+"$"==b.szFilterValue&&(b.nFilterValueIndex=g);this.objTheme.filterQueryA.push(b);a.splice(0,r)}else{alert("ixmaps - filter error - incomplete query!\nquery: "+this.szFilter);break}if(a.length&&a[0]=="AND")a.splice(0,1);else break}while(a.length)}for(var n in this.objTheme.filterQueryA){this.__szValue=
this.objTheme.filterQueryA[n].nFilterFieldIndex==-1?this.objTheme.dbRecords[d].join("|"):String(this.objTheme.dbRecords[d][this.objTheme.filterQueryA[n].nFilterFieldIndex]);this.__szFilterOp=this.objTheme.filterQueryA[n].szFilterOp.toUpperCase();this.__szFilterValue=this.objTheme.filterQueryA[n].szFilterValue;this.__szFilterValue2=this.objTheme.filterQueryA[n].szFilterValue2;this.objTheme.filterQueryA[n].nFilterValueIndex!=null&&(this.__szFilterValue=String(this.objTheme.dbRecords[d][this.objTheme.filterQueryA[n].nFilterValueIndex]));
a=!0;g=ba(this.__szValue);if(this.__szFilterOp=="=")a=this.__szValue==this.__szFilterValue||g==Number(this.__szFilterValue);else if(this.__szFilterOp=="!=")a=!(this.__szValue==this.__szFilterValue||g==Number(this.__szFilterValue));else if(this.__szFilterOp=="<>")a=!(this.__szValue==this.__szFilterValue||g==Number(this.__szFilterValue));else if(this.__szFilterOp==">")a=g>Number(this.__szFilterValue);else if(this.__szFilterOp=="<")a=g<Number(this.__szFilterValue);else if(this.__szFilterOp==">=")a=g>=
Number(this.__szFilterValue);else if(this.__szFilterOp=="<=")a=g<=Number(this.__szFilterValue);else if(this.__szFilterOp=="LIKE")a=this.__szFilterValue=="*"?this.__szValue.length:Aa(this.__szValue,this.__szFilterValue,!1);else if(this.__szFilterOp=="NOT")a=!Aa(this.__szValue,this.__szFilterValue,!1);else if(this.__szFilterOp=="IN"){g=this.__szValue;b=this.__szFilterValue;try{var v=xa(g);a=(new RegExp("\\("+v+"\\,|\\("+v+"\\)|\\,"+v+"\\,|\\,"+v+"\\)","i")).test(b)}catch(c){a=!1}}else a=this.__szFilterOp==
"BETWEEN"?g>=Number(this.__szFilterValue)&&g<=Number(this.__szFilterValue2):Aa(this.__szValue,this.__szFilterValue,!1);if(!a)return!1}}else if(this.__szValue=this.objTheme.dbRecords[d].join(" "),!Aa(this.__szValue,this.szFilter,!1))return!1;return!0};A.prototype.getSelectionId=function(d,a){if(!this.fSelection){this.fSelection="lookup";if(this.objTheme.nFieldSelectionIndexA&&this.objTheme.nFieldSelectionIndexA.length>1)this.fSelection=this.szCRSDatum?"UTM":"LatLon",this.nSelection_0=this.objTheme.nFieldSelectionIndexA[0],
this.nSelection_1=this.objTheme.nFieldSelectionIndexA[1];else if(this.objTheme.nFieldSelectionIndex>=0){var g=Z(String(this.objTheme.dbRecords[a][this.objTheme.nFieldSelectionIndex]));g.match(/MultiPoint/)?this.fSelection="MultiPoint":g.match(/Point/i)?this.fSelection="MultiPoint":g.match(/LineString/)?this.fSelection="LineString":g.match(/MultiLineString/)?this.fSelection="MultiLineString":g.match(/Polygon/)?this.fSelection="MultiPolygon":g.match(/MultiPolygon/)&&(this.fSelection="MultiPolygon")}this.objTheme.nFieldSelection2IndexA&&
this.objTheme.nFieldSelection2IndexA.length>1?(this.fSelection2=this.szCRSDatum?"UTM":"LatLon",this.nSelection2_0=this.objTheme.nFieldSelection2IndexA[0],this.nSelection2_1=this.objTheme.nFieldSelection2IndexA[1]):typeof this.objTheme.nFieldSelection2Index!="undefined"&&(g=Z(String(this.objTheme.dbRecords[a][this.objTheme.nFieldSelection2Index])),g.match(/MultiPoint/)?this.fSelection2="MultiPoint":g.match(/Point/)?this.fSelection2="MultiPoint":this.fSelection2="mapshape")}if(this.fSelection=="LatLon"||
this.fSelection=="UTM")return d+"::"+(String(this.objTheme.dbRecords[a][this.nSelection_0]).replace(/,/g,".")+","+String(this.objTheme.dbRecords[a][this.nSelection_1]).replace(/,/g,"."))+(this.szSelectionFieldSuffix||"").replace(/,/g,".");if(this.fSelection=="Point"||this.fSelection=="MultiPoint"){g=this.objTheme.dbRecords[a][this.objTheme.nFieldSelectionIndex];var b;return(b=g.match(Ja))?d+"::"+(b[2]+","+b[1])+(this.szSelectionFieldSuffix||""):null}return this.fSelection=="LineString"||this.fSelection==
"MultiLineString"||this.fSelection=="Polygon"||this.fSelection=="MultiPolygon"?d+"::"+String(a)+(this.szSelectionFieldSuffix||""):this.objTheme.nFieldSelectionIndex>=0?(g=Z(String(this.objTheme.dbRecords[a][this.objTheme.nFieldSelectionIndex])),this.nSelectionFieldDigits&&(g=("000000000000000"+g).slice(-this.nSelectionFieldDigits)),this.fSelectionFieldToNumber&&(g=String(Number(g))),this.fSelectionFieldToUpper&&(g=String(g).toUpperCase()),d+"::"+g+(this.szSelectionFieldSuffix||"")):null};A.prototype.loadValuesOfTheme=
function(d){if(this.szFlag.match(/FAST/)||this.szFlag.match(/VECTOR/)||this.szFlag.match(/BEZIER/)||typeof this.szSelectionField2!="undefined"||this.szFlag.match(/AGGREGATE/)&&!this.szFlag.match(/COMPATIBLE|PERCENTOFMEAN/))return this.__fAggregateOnLoad=!0,_LOG("loadAndAggregateValuesOfTheme ===>"),this.loadAndAggregateValuesOfTheme(d);var a,g,b,r;this.fNegativeValues=this.fField100=!1;this.szUnit=(this.szUnits?this.szUnits.substr(0,1)=="."?"":" ":"")+(this.szUnits||"");var n=!0;this.objTheme=this.objThemesA[d];
this.objTheme.nField100IndexA[0]&&this.objTheme.nField100IndexA[0]>0&&(this.fField100=!0);if(this.objTheme.dbTable&&d&&d.length){if(this.coTable){try{if((a=Q(this.coTable))&&a.records)this.objTheme.dbRecords=a.records;else if(b=Q(this.coTable+"_records"))this.objTheme.dbRecords=b}catch(f){}if(!this.objTheme.dbRecords)return displayMessage("Data "+this.coTable+" could not be loaded!",2E3,!0),!1}else try{if((r=Q(d))&&r.records)this.objTheme.dbRecords=r.records;else if(g=Q(d+"_records"))this.objTheme.dbRecords=
g}catch(f){}this.objTheme.nFieldSelectionIndexA.length||delete this.objTheme.nFieldSelectionIndexA;if(this.szFieldsA[0]!="$item$"&&!this.szFlag.match(/CATEGORICAL/))for(b=Math.min(40,this.objTheme.dbRecords.length),a=0;a<b;a++)if(this.objTheme.dbRecords[a])for(g=0;g<this.szFieldsA.length;g++){var v=this.objTheme.dbRecords[a][this.objTheme.nFieldIndexA[g]];if(ba(v)!=parseFloat(v)){this.__fScanValue=!0;a=b;break}}for(a=0;a<this.objTheme.dbRecords.length;a++)if(!this.objTheme.dbRecords[a]||this.fCheckRecordLength&&
this.objTheme.dbRecords[a].length<this.objTheme.dbFields.length)this.nWrongRecordLengthCount++;else if(!this.__fFilter||this.filterValues(a)){b=[];if(this.szFieldsA[0]=="$item$")b[0]=1;else if(this.szFieldsA[0]=="$index$")b[0]=a+1;else for(g=0;g<this.szFieldsA.length;g++){v=this.objTheme.dbRecords[a][this.objTheme.nFieldIndexA[g]];this.__fExact?(v=this.valueMap?this.valueMap[String(v)]:v,v=this.getStringValueIndex(String(v))):v=this.__fScanValue?ba(v):parseFloat(v);if(isNaN(v))if(this.fUndefinedValuePossible)v=
0;else continue;if(v!==0||this.fNullIsValue)v<0&&!this.fNegativeValuePossible||(b[g]=v)}b.length=this.szFieldsA.length;r=[];if(this.szField100A&&this.szField100A.length){if(this.szField100A[0]=="$item$")r[0]=1;else for(g=0;g<this.szField100A.length;g++)if(v=ba(this.objTheme.dbRecords[a][this.objTheme.nField100IndexA[g]]),v!==0||this.fNullIsValue)v<0&&!this.fNegativeValuePossible||(r[g]=v);if(r.length>0)for(g=r[r.length-1];r.length<this.szFieldsA.length;)r.push(g)}if(this.szSizeField&&this.szSizeField!=
"$item$"){var c=this.objTheme.dbRecords[a][this.objTheme.nSizeFieldIndex];c=this.valueMap?this.valueMap[String(c)]||ba(c):ba(c);c=isFinite(c)&&!isNaN(c)?c:0;if(c===0)continue;if(c<0)continue}else c=1;var e=null;this.szAlphaField&&(e=ba(this.objTheme.dbRecords[a][this.objTheme.nAlphaFieldIndex]),isNaN(e)&&(e=0));this.szAlphaField100&&this.objTheme.nAlphaField100Index&&(e*=100/ba(this.objTheme.dbRecords[a][this.objTheme.nAlphaField100Index]),isNaN(e)&&(e=0));if(v=g=this.getSelectionId(d,a)){this.objTheme.nFieldItemIndex>=
0&&this.objTheme.nFieldItemIndex!=this.objTheme.nFieldSelectionIndex&&(g=Z(String(this.objTheme.dbRecords[a][this.objTheme.nFieldItemIndex])),this.fSelectionFieldToUpper&&(g=String(g).toUpperCase()),g=d+"::"+g);if(this.itemA[g]){if(this.szFlag.match(/\bDOT\b/))continue;g+="*"+Math.random();if(this.itemA[g])continue}this.addItemValues(g,b,r,c,e);this.itemA[g]&&(this.szColorField&&(this.itemA[g].szColor=this.szColorField=="$index$"?a+1:Z(this.objTheme.dbRecords[a][this.objTheme.nColorFieldIndex])),
this.szSymbolField&&(this.itemA[g].szSymbol=this.szSymbolField=="$index$"?a+1:Z(this.objTheme.dbRecords[a][this.objTheme.nSymbolFieldIndex])),this.szValueField&&(this.itemA[g].szValue=this.szValueField=="$index$"?a+1:Z(this.objTheme.dbRecords[a][this.objTheme.nValueFieldIndex])),this.szTimeField&&(this.itemA[g].szTime=this.szTimeField=="$index$"?a+1:Z(this.objTheme.dbRecords[a][this.objTheme.nTimeFieldIndex]),isNaN(this.itemA[g].szTime)&&(this.itemA[g].szTime=this.itemA[g].szTime.replace(/ - /g,""))),
this.szLabelField&&(this.itemA[g].szLabel=this.szLabelField=="$index$"?a+1:Z(this.objTheme.dbRecords[a][this.objTheme.nLabelFieldIndex])),this.szTitleField&&(this.itemA[g].szTitle=Z(this.objTheme.dbRecords[a][this.objTheme.nTitleFieldIndex])),this.szSnippetField&&(this.itemA[g].szSnippet=Z(this.objTheme.dbRecords[a][this.objTheme.nSnippetFieldIndex])),this.itemA[g].szSelectionId=v?v:g,this.szAggregationField&&(this.itemA[g].szAggregation=Z(this.objTheme.dbRecords[a][this.objTheme.nAggregationFieldIndex])),
this.szXField&&(this.itemA[g].nX=ba(this.objTheme.dbRecords[a][this.objTheme.nXFieldIndex]),isNaN(this.itemA[g].nX)||(this.nMinX=Math.min(this.nMinX,this.itemA[g].nX),this.nMaxX=Math.max(this.nMaxX,this.itemA[g].nX),this.nSumX+=this.itemA[g].nXField)),this.szYField&&(this.itemA[g].nY=ba(this.objTheme.dbRecords[a][this.objTheme.nYFieldIndex]),isNaN(this.itemA[g].nY)||(this.nMinY=Math.min(this.nMinY,this.itemA[g].nY),this.nMaxY=Math.max(this.nMaxY,this.itemA[g].nY),this.nSumY+=this.itemA[g].nYField)),
this.itemA[g].dbIndex=a)}else this.nMissingLookupCount++}}else n=!1;if(n)return this.fAnalyze=!0};A.prototype.loadAndAggregateValuesOfTheme=function(d,a){var g,b,r,n;if(!a){console.log("*** F A S T ***");this.fNegativeValues=this.fField100=!1;this.__fMultiParts=this.szFlag.match(/CATEGORICAL/)&&!(this.szFlag.match(/PIE/)||this.szFlag.match(/BAR/)||this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/PLOT/)||this.szFlag.match(/DOMINANT/)||this.szFlag.match(/COMPOSECOLOR/)||this.szFlag.match(/\bUSER\b/)||
this.szFlag.match(/WAFFLE/));this.__fClipToGeoBounds=!1;this.szFlag.match(/CLIPTOGEOBOUNDS/)&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<(this.nClipUpper||1E9)&&(this.__fClipToGeoBounds=!0);this.szUnit=(this.szUnits?this.szUnits.substr(0,1)=="."?"":" ":"")+(this.szUnits||"");this.objTheme=this.objThemesA[d];this.objTheme.nField100IndexA[0]&&this.objTheme.nField100IndexA[0]>0&&(this.fField100=!0);if(!(this.objTheme.dbTable&&d&&d.length))return!1;if(this.coTable){try{if((r=Q(this.coTable))&&r.records)this.objTheme.dbRecords=
r.records;else{var v=Q(this.coTable+"_records");v&&(this.objTheme.dbRecords=v)}}catch(U){}if(!this.objTheme.dbRecords)return displayMessage("Data "+this.coTable+" could not be loaded!",2E3,!0),!1}else try{var c=Q(d);if(c&&c.records)this.objTheme.dbRecords=c.records;else{var e=Q(d+"_records");e&&(this.objTheme.dbRecords=e)}}catch(U){}this.objTheme.nFieldSelectionIndexA.length||delete this.objTheme.nFieldSelectionIndexA;this.createChartGroup(map.Layer.objectGroup);if(this.szFieldsA[0]!="$item$"&&!this.szFlag.match(/CATEGORICAL/))for(v=
Math.min(40,this.objTheme.dbRecords.length),r=0;r<v;r++)if(this.objTheme.dbRecords[r])for(n=0;n<this.szFieldsA.length;n++){var f=this.objTheme.dbRecords[r][this.objTheme.nFieldIndexA[n]];if(ba(f)!=parseFloat(f)){this.__fScanValue=!0;r=v;break}}this.szSizeField=="$item$"&&(this.oldSizefield=this.szSizeField,this.szSizeField=null);this.nGridWidthPx&&(this.nGridWidth=r=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.nGridWidthPx),1E3));this.nGridMatrix&&(r=map.Zoom.getBox(),r=map.Scale.getDistanceInMeter(1E3,
1E3,1E3+r.width,1E3),this.nGridWidth=r/(this.nGridMatrix||20)/map.Scale.nZoomScale);this.nGridWidthMap=this.nGridWidth?Math.round(map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/20)*map.Scale.nZoomScale*20:0;this.nGridWidth&&!this.nGridWidthMap&&(this.nGridWidthMap=this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)*map.Scale.nZoomScale:0);this.nGridWidthPx||(this.nGridWidthMap=this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)*map.Scale.nZoomScale:0,r=Math.pow(10,
Math.floor(Math.log10(1/map.Scale.nZoomScale))),this.nGridWidthMap=Math.round(this.nGridWidthMap*r)/r);this.dY=this.dX=0;this.szFlag.match(/FIXGRID/)&&(this.dX=map.Scale.mapCenter.x*map.Scale.nZoomScale,this.dY=map.Scale.mapCenter.y*map.Scale.nZoomScale);this.nGridOffsetX&&(this.dX-=this.nGridWidthMap/100*this.nGridOffsetX);this.nGridOffsetY&&(this.dY+=this.nGridWidthMap/100*this.nGridOffsetY);this.nHexaWidth=this.nGridWidthMap*1.15;this.nHexaHalf=this.nGridWidthMap*1.15/2;this.nHexa4th=this.nGridWidthMap/
4;this.getSelectionId(d,0);this.aggregationCount=0;this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinSize=Number.MAX_VALUE;this.nMaxSize=-Number.MAX_VALUE;this.nSumSize=0;this.nMinAlpha=Number.MAX_VALUE;this.nMaxAlpha=-Number.MAX_VALUE;this.nSumAlpha=0;if(this.__fExact)this.nMinA=[],this.nMaxA=[],this.nSumA=[],this.nOrigMinA=[],this.nOrigMaxA=[],this.nOrigSumA=[],this.nMedianA=[],this.nMeanA=[],this.nCountA=[];else for(b=0;b<this.szFieldsA.length;b++)this.nMinA[b]=Number.MAX_VALUE,this.nMaxA[b]=
-Number.MAX_VALUE,this.nSumA[b]=0,this.nOrigMinA[b]=Number.MAX_VALUE,this.nOrigMaxA[b]=-Number.MAX_VALUE,this.nOrigSumA[b]=0,this.nMedianA[b]=0,this.nMeanA[b]=0;this.nEmptyValuesA=[];for(var m in this.szValuesA)this.nEmptyValuesA.push(0);this.szFlag.match(/DUMP/)&&(this.nChartGroupScale=map.fObjectScaling?(this.nAutoScale||this.nScale)*map.Layer.nObjectScale*map.Scale.nObjectScaling:(this.nAutoScale||this.nScale)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling,this.chartGroup=map.Dom.newGroup(map.Layer.objectGroup,
this.szId+":chartgroup"));if(!this.szWeightsA)for(this.szWeightsA=[],b=0;b<this.szFieldsA.length;b++)this.szWeightsA.push(1);else if(this.szWeightsA.length&&this.szWeightsA.length!=this.szFieldsA.length)for(r=this.szWeightsA[this.szWeightsA.length-1],b=this.szWeightsA.length;b<this.szFieldsA.length;b++)this.szWeightsA.push(r)}if(this.szAggregationUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nAggregationUpper||this.szAggregationLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nAggregationLower)this.__fAggregate=
!1;m=map.Zoom.getBoundsOfMapInGeoBounds();v=map.Zoom.getBox();c=this.objTheme.dbRecords.length>2E5;for(r=a||0;r<this.objTheme.dbRecords.length;r++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);return}if(c&&r>(a||0)&&r%5E4===0)return this.fContinueLoadAndAggregate=!0,this.continueIndex=r,this.szThemeLayer=d,displayMessage(__formatValue(r/this.objTheme.dbRecords.length*100,0)+"% "+map.Dictionary.getLocalText("aggregated")),displayProgressBar(r,this.objTheme.dbRecords.length,""),setTimeout(function(){map.Themes.executeContinue()},
10),!0;if(!this.objTheme.dbRecords[r]||this.fCheckRecordLength&&this.objTheme.dbRecords[r].length<this.objTheme.dbFields.length){this.nWrongRecordLengthCount++;continue}if(this.__fFilter&&!this.filterValues(r))continue;if(this.__fClipToGeoBounds&&this.fSelection=="LatLon"&&(e=parseFloat(String(this.objTheme.dbRecords[r][this.nSelection_0]).replace(/,/g,".")),b=parseFloat(String(this.objTheme.dbRecords[r][this.nSelection_1]).replace(/,/g,".")),b<m[0].x||b>m[1].x||e<m[0].y||e>m[1].y))continue;var l=
null,h=null;if(this.fSelection=="UTM")var p=(l=map.Scale.getMapPositionOfUTM(parseFloat(String(this.objTheme.dbRecords[r][this.nSelection_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[r][this.nSelection_1]).replace(/,/g,".")),this.szCRSDatum,this.szCRSUTMZone))?String(l.x)+","+String(l.y):"";else this.fSelection=="LatLon"?(p=String(this.objTheme.dbRecords[r][this.nSelection_0]).replace(/,/g,".")+","+String(this.objTheme.dbRecords[r][this.nSelection_1]).replace(/,/g,"."),l=this.getNodePosition(d+
"::"+p)):this.fSelection=="Point"||this.fSelection=="MultiPoint"||this.fSelection=="LineString"||this.fSelection=="MultiLineString"?(p=this.objTheme.dbRecords[r][this.objTheme.nFieldSelectionIndex],(b=String(p).match(Ja))&&(l=map.Scale.getMapPositionOfLatLon(parseFloat(b[2]),parseFloat(b[1])))):(p=this.objTheme.dbRecords[r][this.objTheme.nFieldSelectionIndex],this.fSelectionFieldToUpper&&(p=String(p).toUpperCase()),this.nSelectionFieldDigits&&(p=("000000000000000"+p).slice(-this.nSelectionFieldDigits)),
this.fSelectionFieldToNumber&&(p=String(Number(p))),l=this.getNodePosition(d+"::"+p));if(this.szFlag.match(/DUMP/)){if(!l||l.x===void 0||l.y===void 0)continue;e=map.Dom.newGroup(this.chartGroup,this.szId+":"+p+":chart");e.fu.setMatrix([this.nChartGroupScale,0,0,this.nChartGroupScale,l.x,l.y]);map.Dom.newShape("circle",e,0,0,map.Scale.normalX(3),"fill:blue;fill-opacity:0.2;stroke:none;")}if(!l||isNaN(l.x)||isNaN(l.y)){this.fDataIncomplete=!0;continue}e=l;var B=null;var C=null;if(this.fSelection2){if(this.fSelection2==
"UTM")C=(B=map.Scale.getMapPositionOfUTM(parseFloat(String(this.objTheme.dbRecords[r][this.nSelection2_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[r][this.nSelection2_1]).replace(/,/g,".")),this.szCRSDatum,this.szCRSUTMZone))?String(B.x)+","+String(B.y):"";else if(this.fSelection2=="LatLon")B=map.Scale.getMapPositionOfLatLon(parseFloat(String(this.objTheme.dbRecords[r][this.nSelection2_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[r][this.nSelection2_1]).replace(/,/g,
"."))),C=l&&l.x!==void 0&&l.y!==void 0?String(l.x)+","+String(l.y):"";else if(this.fSelection=="Point"||this.fSelection=="MultiPoint"||this.fSelection=="LineString"||this.fSelection=="MultiLineString")C=this.objTheme.dbRecords[r][this.objTheme.nFieldSelection2Index],(b=p.match(Ja))&&(B=map.Scale.getMapPositionOfLatLon(parseFloat(b[2]),parseFloat(b[1])));else for(C=this.objTheme.dbRecords[r][this.objTheme.nFieldSelection2Index],this.nSelectionFieldDigits&&(C=("000000000000000"+p).slice(-this.nSelectionFieldDigits)),
this.fSelectionFieldToUpper&&(C=String(C).toUpperCase()),b=0;b<this.szThemesA.length;b++)B=B||this.getNodePosition(this.szThemesA[b]+"::"+C);C=Z(String(this.objTheme.dbRecords[r][this.objTheme.nFieldSelection2Index]));this.fSelectionFieldToUpper&&(C=String(C).toUpperCase());var N=C;C=d+"::"+C;this.themeNodesPosA[C]=B}if(this.__fClipToGeoBounds&&(l.x<v.x||l.x>v.x+v.width||l.y<v.y||l.y>v.y+v.height))continue;var Y=(Na,Qa,Ka,$a)=>isNaN(Na)?Qa?0:!1:Na===0&&!$a||Na<0&&!Ka?!1:!0,M=!1;b=Array(this.szFieldsA.length).fill(null);
if(this.szFieldsA[0]==="$item$")b[0]=1;else if(this.szFieldsA[0]==="$index$")b[0]=r+1;else for(n=0;n<this.szFieldsA.length;n++){f=this.objTheme.dbRecords[r][this.objTheme.nFieldIndexA[n]];f=this.valueMap?this.valueMap[String(f)]||f:f;this.__fExact?(f=this.getStringValueIndex(String(f)),this.exactCountA[f-1]=(this.exactCountA[f-1]||0)+1):f=this.__fScanValue?ba(f)*(this.szWeightsA[n]||1):parseFloat(f)*(this.szWeightsA[n]||1);if(isNaN(f))if(this.fUndefinedValuePossible)f=0;else{M=!0;continue}f!==0||
this.fNullIsValue?f<0&&!this.fNegativeValuePossible?M=!0:b[n]=f:M=!0}n=this.szField100A?Array(this.szField100A.length).fill(null):[];if(this.szField100A&&this.szField100A.length)if(this.szField100A[0]==="$item$")n[0]=1;else if(this.szField100A[0]==="$index$")n[0]=r+1;else{for(var w=0;w<this.szField100A.length;w++){var J=ba(this.objTheme.dbRecords[r][this.objTheme.nField100IndexA[w]]);if(!Y(J,!1,!1,!1)){M=!0;break}n[w]=J}if(n.length>0)for(w=n[n.length-1];n.length<this.szFieldsA.length;)n.push(w)}w=
this.szSizeField&&this.szSizeField!=="$item$"?ba(this.objTheme.dbRecords[r][this.objTheme.nSizeFieldIndex]):1;Y(w,!1,this.fNegativeValuePossible,this.fNullIsValue)||(M=!0);Y=this.szAlphaField?ba(this.objTheme.dbRecords[r][this.objTheme.nAlphaFieldIndex]):null;J=this.szTitleField?this.objTheme.dbRecords[r][this.objTheme.nTitleFieldIndex]:null;const U=this.szColorField?this.szColorField==="$index$"?r+1:Z(this.objTheme.dbRecords[r][this.objTheme.nColorFieldIndex]):null,ka=this.szTimeField?this.szTimeField===
"$index$"?r+1:Z(this.objTheme.dbRecords[r][this.objTheme.nTimeFieldIndex]).replace(/ - /g," "):null;var L=this.szXField?ba(this.objTheme.dbRecords[r][this.objTheme.nXFieldIndex]):null;const Sa=this.szYField?ba(this.objTheme.dbRecords[r][this.objTheme.nYFieldIndex]):null,Ma=this.szValueField?this.objTheme.dbRecords[r][this.objTheme.nValueFieldIndex]:null;if(this.__fAggregate&&this.nGridWidthMap){h=this.szFlag.match(/\bRECT\b/);var G=this.dX||this.dY;if(h)l=new point(Math.round((l.x+(G?this.dX:0))/
this.nGridWidthMap)*this.nGridWidthMap-(G?this.dX:0),Math.round((l.y+(G?this.dY:0))/this.nGridWidthMap)*this.nGridWidthMap-(G?this.dY:0));else{if(this.szFlag.match(/PLOTY/))h=Math.round(l.y/this.nGridWidthMap),G=h%2?this.nHexaHalf:0,h=new point(Math.round((l.x+G)/this.nHexaWidth)*this.nHexaWidth-G,h*this.nGridWidthMap);else{h=Math.round(l.x/this.nGridWidthMap);var F=h%2?this.nHexaHalf:0;h=new point(h*this.nGridWidthMap,Math.round((l.y+F)/this.nHexaWidth)*this.nHexaWidth-F)}if(Math.abs(h.x-l.x)>this.nHexa4th){G=
[];var V=[];F=F===0?this.nHexaHalf:0;h.x>l.x?(G[0]=new point(h.x-this.nGridWidthMap,h.y-this.nHexaHalf),G[1]=new point(h.x-this.nGridWidthMap,h.y+this.nHexaHalf)):(G[0]=new point(h.x+this.nGridWidthMap,h.y-this.nHexaHalf),G[1]=new point(h.x+this.nGridWidthMap,h.y+this.nHexaHalf));V[0]=Math.sqrt(Math.pow(G[0].x-l.x,2)+Math.pow(G[0].y-l.y,2));V[1]=Math.sqrt(Math.pow(G[1].x-l.x,2)+Math.pow(G[1].y-l.y,2));V[3]=Math.sqrt(Math.pow(h.x-l.x,2)+Math.pow(h.y-l.y,2));V[0]<V[3]?h=new point(Math.round(G[0].x/
this.nGridWidthMap)*this.nGridWidthMap,Math.round((G[0].y+F)/this.nHexaWidth)*this.nHexaWidth-F):V[1]<V[3]&&(h=new point(Math.round(G[1].x/this.nGridWidthMap)*this.nGridWidthMap,Math.round((G[1].y+F)/this.nHexaWidth)*this.nHexaWidth-F))}l=h}}this.__fAggregate&&this.nGridWidthMap&&B&&!this.szFlag.match(/\bORIGIN\b/)&&(this.szFlag.match(/\bRECT\b/)?B=this.dX||this.dY?new point(Math.round((B.x+this.dX)/this.nGridWidthMap)*this.nGridWidthMap-this.dX,Math.round((B.y+this.dY)/this.nGridWidthMap)*this.nGridWidthMap-
this.dY):new point(Math.round(B.x/this.nGridWidthMap)*this.nGridWidthMap,Math.round(B.y/this.nGridWidthMap)*this.nGridWidthMap):(this.szFlag.match(/PLOTY/)?(h=Math.round(B.y/this.nGridWidthMap),G=h%2?this.nHexaHalf:0,h=new point(Math.round((B.x+G)/this.nHexaWidth)*this.nHexaWidth-G,h*this.nGridWidthMap)):(h=Math.round(B.x/this.nGridWidthMap),F=h%2?this.nHexaHalf:0,h=new point(h*this.nGridWidthMap,Math.round((B.y+F)/this.nHexaWidth)*this.nHexaWidth-F)),Math.abs(h.x-B.x)>this.nHexa4th&&(G=[],V=[],F=
F===0?this.nHexaHalf:0,h.x>B.x?(G[0]=new point(h.x-this.nGridWidthMap,h.y-this.nHexaHalf),G[1]=new point(h.x-this.nGridWidthMap,h.y+this.nHexaHalf)):(G[0]=new point(h.x+this.nGridWidthMap,h.y-this.nHexaHalf),G[1]=new point(h.x+this.nGridWidthMap,h.y+this.nHexaHalf)),V[0]=Math.sqrt(Math.pow(G[0].x-B.x,2)+Math.pow(G[0].y-B.y,2)),V[1]=Math.sqrt(Math.pow(G[1].x-B.x,2)+Math.pow(G[1].y-B.y,2)),V[3]=Math.sqrt(Math.pow(h.x-B.x,2)+Math.pow(h.y-B.y,2)),V[0]<V[3]?h=new point(Math.round(G[0].x/this.nGridWidthMap)*
this.nGridWidthMap,Math.round((G[0].y+F)/this.nHexaWidth)*this.nHexaWidth-F):V[1]<V[3]&&(h=new point(Math.round(G[1].x/this.nGridWidthMap)*this.nGridWidthMap,Math.round((G[1].y+F)/this.nHexaWidth)*this.nHexaWidth-F))),B=h),this.themeNodesPosA[C]=B);C=p;this.szAggregationField?(h=Z(this.objTheme.dbRecords[r][this.objTheme.nAggregationFieldIndex]),p=d+"::"+h,this.szTitleField=="$aggregation$"&&(J=h)):(p=d+"::"+String(l.x)+","+String(l.y)+(this.__fMultiParts?","+String(f):""),this.themeNodesPosA[p]=
l);B&&this.szFlag.match(/VECTOR/)&&(p+="&"+String(B.x)+","+String(B.y),this.themeNodesPosA[p]=B);if(this.__fAggregate)if(L=this.itemA[p],!L||this.__fLast){if(!M){this.aggregationCount++;M=0;if(this.__fMultiParts)M=w;else if(this.__fExact)if(L=b[0]-1,isNaN(L))continue;else{b=this.nEmptyValuesA.slice(0);M=b[L]=w;var la=this.nEmptyValuesA.slice(0);la[L]=1}else for(L=0;L<this.szFieldsA.length;L++)M=Math.max(M,b[L]||0);this.itemA[p]={nOrigValuesA:[],nValuesA:b,nValue100A:n,nValueSum:0,nCount:1,nCountA:la,
szTitle:J,szSelectionId:String(C),szSelectionId2:String(N),nSize:Math.abs(w||(this.objTheme.nSizeFieldIndex?0:M)),nAlpha:Y||1,szColor:U,szTime:ka,szValue:Ma,dbIndexA:[r],ptPos:l,ptPos2:B,ptPosA:[e]};this.nCount++}}else{if(!M&&!this.__fFirst){p=0;if(this.__fMultiParts)p=w;else if(this.__fExact)if(b=b[0]-1,isNaN(b))continue;else L.nValuesA[b]=this.__fMax?Math.max(L.nValuesA[b]||0,w):(L.nValuesA[b]||0)+w,L.nCountA[b]=(L.nCountA[b]||0)+1,p=w;else for(l=this.szFieldsA.length,B=0;B<l;B++)M=b[B]||0,L.nValuesA[B]=
this.__fMax?Math.max(L.nValuesA[B],M):L.nValuesA[B]+M,L.nValue100A[B]=this.__fMax?Math.max(L.nValue100A[B],n[B]):L.nValue100A[B]+n[B],p=Math.max(p,M);this.__fMax?(L.nSize=Math.max(L.nSize,w||(this.objTheme.nSizeFieldIndex?0:p)),L.nAlpha=Math.max(L.nAlpha,Y||1),L.ptPosA=[e],L.szTitle=J,L.dbIndexA.push(r)):(L.nSize+=Math.abs(w||(this.objTheme.nSizeFieldIndex?0:p)),L.nAlpha+=Y||1,L.ptPosA.push(e),L.nCount++,L.dbIndexA.push(r),J&&J===L.szTitle||(L.szTitle=this.szAggregation+" of "+L.nCount+" items"))}}else this.itemA[p]&&
(p+="*"+Math.random()),this.aggregationCount++,this.itemA[p]={nOrigValuesA:[],nValuesA:b,nValue100A:n,nValueSum:0},this.itemA[p].szSelectionId=String(d+"::"+C),this.itemA[p].szSelectionId2=String(d+"::"+N),this.itemA[p].nSize=w||0,this.itemA[p].ptPos=l,this.itemA[p].ptPos2=B,this.itemA[p].dbIndexA=[r],this.itemA[p].nX=L,this.itemA[p].nY=Sa,this.itemA[p].szColor=U,this.itemA[p].szTime=ka,this.itemA[p].szValue=Ma,this.itemA[p].szTitle=J,this.nCount++}if(this.objTheme.nField100IndexA.length>0)if(this.fField100=
!0,this.szFlag.match(/DIFFERENCE/)&&this.itemA[g]&&this.itemA[g].nValuesA&&this.itemA[g].nValuesA.length==1&&!this.szFlag.match(/RELATIVE/))for(g in this.itemA)for(n=0;n<this.itemA[g].nValuesA.length;n++)this.itemA[g].nValuesA[n]-=this.itemA[g].nValue100A[n];else if(this.szFlag.match(/FRACTION/))for(g in this.itemA)for(n=0;n<this.itemA[g].nValuesA.length;n++)this.itemA[g].nValuesA[n]=this.itemA[g].nValuesA[n]/this.itemA[g].nValue100A[n]*(this.nFractionScale||1);else if(this.szFlag.match(/PRODUCT/))for(g in this.itemA)for(n=
0;n<this.itemA[g].nValuesA.length;n++)this.itemA[g].nValuesA[n]*=this.itemA[g].nValue100A[n];else if(this.szFlag.match(/CALCVAL/))for(g in this.itemA)for(n=0;n<this.itemA[g].nValuesA.length;n++)this.itemA[g].nValuesA[n]=Math.round(this.itemA[g].nValuesA[n]*this.itemA[g].nValue100A[n]/100);else if(this.szFlag.match(/PERMILLE/))for(g in this.itemA)for(n=0;n<this.itemA[g].nValuesA.length;n++)this.itemA[g].nValuesA[n]*=1E3/this.itemA[g].nValue100A[n];else for(g in this.itemA)for(n=0;n<this.itemA[g].nValuesA.length;n++)this.itemA[g].nValue100A[n]>
(this.nField100Min||0)?(this.itemA[g].nValuesA[n]*=100/this.itemA[g].nValue100A[n],this.itemA[g].nValuesA[n]>0&&this.szFlag.match(/RELATIVE/)?this.itemA[g].nValuesA[n]-=100:this.itemA[g].nValuesA[n]>0&&this.szFlag.match(/INVERT/)&&(this.itemA[g].nValuesA[n]=100-this.itemA[g].nValuesA[n])):this.itemA[g].nValuesA[n]=0;else if(this.__fAggregate&&this.szFlag.match(/MEAN/))if(this.__fMultiParts)for(g in this.itemA)this.itemA[g].nSize/=this.itemA[g].nCount;else for(g in this.itemA){if(this.itemA[g].nCountA)for(n=
0;n<this.itemA[g].nValuesA.length;n++)this.itemA[g].nValuesA[n]/=this.itemA[g].nCountA[n]||1;else for(n=0;n<this.itemA[g].nValuesA.length;n++)this.itemA[g].nValuesA[n]/=this.itemA[g].nCount;this.szFlag.match(/SIZESUM/)||(this.itemA[g].nSize/=this.itemA[g].nCount)}if(this.szFlag.match(/DIFFERENCE/))for(g in this.itemA){for(b=0;b<this.itemA[g].nValuesA.length;b++)b<this.itemA[g].nValuesA.length-1?(d=this.itemA[g].nValuesA[b],this.itemA[g].nValuesA[b]=this.itemA[g].nValuesA[b+1]-this.itemA[g].nValuesA[b],
this.szFlag.match(/RELATIVE/)&&(this.itemA[g].nValuesA[b]=d>(this.nField100Min||0)?100/d*this.itemA[g].nValuesA[b]:0)):this.szFlag.match(/STACKED/)||(this.itemA[g].nValuesA[b]=0);this.itemA[g].nValuesA.pop()}if(this.szFlag.match(/AUTO100/))if(this.nGridX)for(g in this.itemA){b=0;do{for(a=d=0;a<this.nGridX;a++)d+=this.itemA[g].nValuesA[b+a]||0;for(a=0;a<this.nGridX;a++)this.itemA[g].nValuesA[b+a]/=d/100;b+=this.nGridX}while(b<this.itemA[g].nValuesA.length)}else for(g in this.itemA){for(b=d=0;b<this.itemA[g].nValuesA.length;b++)d+=
this.itemA[g].nValuesA[b]||0;for(b=0;b<this.itemA[g].nValuesA.length;b++)this.itemA[g].nValue100A[b]=d;this.fField100=!0;for(b=0;b<this.itemA[g].nValuesA.length;b++)this.itemA[g].nValuesA[b]/=this.itemA[g].nValue100A[b]/100}if(this.szFlag.match(/RELOCATE/)||this.szAggregationField)for(g in this.itemA)if(this.itemA[g].ptPosA){for(d=e=b=0;d<this.itemA[g].ptPosA.length;d++)b+=this.itemA[g].ptPosA[d].x,e+=this.itemA[g].ptPosA[d].y;this.itemA[g].ptPos={x:b/this.itemA[g].nCount,y:e/this.itemA[g].nCount}}if(this.szMinAggregation){a=
d=0;for(g in this.itemA)a+=this.itemA[g].nCount,d++;a/=d;for(g in this.itemA)this.itemA[g].nCount&&this.itemA[g].nCount<(this.nMinAggregation||Math.sqrt(a)-1)&&delete this.itemA[g]}this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinA=[];this.nMaxA=[];if(this.__fExact||this.szSizeField)for(g in this.itemA)isFinite(this.itemA[g].nSize)&&!isNaN(this.itemA[g].nSize)&&(this.nMin=this.nMinSize=Math.min(this.nMinSize,this.itemA[g].nSize),this.nMax=this.nMaxSize=Math.max(this.nMaxSize,this.itemA[g].nSize),
this.nSumSize+=this.itemA[g].nSize);else for(g in this.itemA)for(m=0;m<this.itemA[g].nValuesA.length;m++)isFinite(this.itemA[g].nValuesA[m])&&!isNaN(this.itemA[g].nValuesA[m])&&(this.nMin=Math.min(this.itemA[g].nValuesA[m],this.nMin),this.nMax=Math.max(this.itemA[g].nValuesA[m],this.nMax));for(g in this.itemA)for(m=0;m<this.itemA[g].nValuesA.length;m++)isFinite(this.itemA[g].nValuesA[m])&&!isNaN(this.itemA[g].nValuesA[m])?(this.nMinA[m]=Math.min(this.itemA[g].nValuesA[m],this.nMinA[m]||Number.MAX_VALUE),
this.nMaxA[m]=Math.max(this.itemA[g].nValuesA[m],this.nMaxA[m]||-Number.MAX_VALUE),this.nSumA[m]+=this.itemA[g].nValuesA[m]):(this.nMinA[m]=this.nMinA[m]||Number.MAX_VALUE,this.nMaxA[m]=this.nMaxA[m]||-Number.MAX_VALUE);if(this.szAlphaField)for(g in this.itemA)isFinite(this.itemA[g].nAlpha)&&!isNaN(this.itemA[g].nAlpha)&&(this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[g].nAlpha),this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[g].nAlpha),this.nSumAlpha+=this.itemA[g].nAlpha);if(this.szSizeField)for(g in this.itemA)isFinite(this.itemA[g].nSize)&&
!isNaN(this.itemA[g].nSize)&&(this.nMinSize=Math.min(this.nMinSize,this.itemA[g].nSize),this.nMaxSize=Math.max(this.nMaxSize,this.itemA[g].nSize),this.nSumSize+=this.itemA[g].nSize);if(this.szXField)for(g in this.itemA)isNaN(this.itemA[g].nX)||(this.nMinX=Math.min(this.nMinX,this.itemA[g].nX),this.nMaxX=Math.max(this.nMaxX,this.itemA[g].nX),this.nSumX+=this.itemA[g].nX);if(this.szYField)for(g in this.itemA)isNaN(this.itemA[g].nY)||(this.nMinY=Math.min(this.nMinY,this.itemA[g].nY),this.nMaxY=Math.max(this.nMaxY,
this.itemA[g].nY),this.nSumY+=this.itemA[g].nY);if(this.szValueField&&this.szSizeField==this.szValueField)for(g in this.itemA)this.itemA[g].szValue=String(this.itemA[g].nSize);this.oldSizefield&&(this.szSizeField=this.oldSizefield,this.oldSizeField=null);_LOG("loadAndAggregateValuesOfTheme === E N D");return this.fAnalyze=!0};A.prototype.loadTableFromMap=function(){var d,a,g={table:{fields:0,records:0},fields:[],records:[]},b=map.SVGDocument.getElementById(this.szThemesA[0]);if(b==null){var r=map.Tiles.getTileNodes(this.szThemesA[0]);
r&&(b=r[0])}if(!b)return this.szThemes="",null;b=b.getAttributeNS(szMapNs,"info");if(b==null||b==="")return this.szThemes="",null;b=b.split("|");b.push("FeatureId");for(d in b)g.fields.push({id:b[d]}),g.table.fields++;b=[];var n=[];for(d=0;d<this.szThemesA.length;d++){this.objTheme=this.objThemesA[this.szThemesA[d]];r=map.Layer.getLayerObj(this.szThemesA[d]);if(r==null)return alert("MapTheme error: no layer like '"+this.szThemesA[d]+"'"),!1;if(r.szFlag.match(/tiled/)){n[0]=map.Scale.canvasNode;n.length=
1;this.fDataIncomplete=!map.Tiles.allTilesLoaded();break}else n[n.length]=map.SVGDocument.getElementById(r.szName)}r=!0;for(a=0;a<n.length;a++){var v=n[a].getElementsByTagName("path");var c=n[a].getElementsByTagName("use"),e=n[a].getElementsByTagName("circle");for(d=0;d<v.length;d++)b[b.length]=v.item(d);for(d=0;d<c.length;d++)b[b.length]=c.item(d);for(d=0;d<e.length;d++)b[b.length]=e.item(d)}if(b.length===0)for(r=!1,a=0;a<n.length;a++)for(v=n[a].getElementsByTagName("g"),d=0;d<v.length;d++)b[b.length]=
v.item(d);for(d=0;d<b.length;d++)if(b[d].nodeType==1&&b[d].hasAttributeNS(szMapNs,"info")){v=r?b[d].parentNode.getAttributeNS(null,"id"):b[d].getAttributeNS(null,"id");n=-1;if(v&&v.length!==0)for(c=map.Tiles.getMasterId(v).split(":")[0],a=0;a<this.szThemesA.length;a++)c==this.szThemesA[a]&&(n=a);a=map.Tiles.getMasterId(v);!this.itemA[a]&&n>=0&&(n=b[d].getAttributeNS(szMapNs,"info").split("|"),n.push(a.split("::")[1]),g.records.push(n),g.table.records++,this.itemA[a]=1)}this.itemA=[];return g};A.prototype.aggregateValues=
function(){if(!(this.__fAggregateOnLoad||!this.szFlag.match(/AGGREGATE/)&&!this.szFlag.match(/GROUP/)||this.szAggregationUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nAggregationUpper||this.szAggregationLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nAggregationLower)){var d=[],a=[],g=[],b=[],r=[],n=0;this.nTopicsSkipedByZeroExclusion=0;if(this.nGridWidthPx){var v=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.nGridWidthPx),1E3);this.nGridWidth=v}this.nGridMatrix&&
(v=map.Zoom.getBox(),v=map.Scale.getDistanceInMeter(1E3,1E3,1E3+v.width,1E3),this.nGridWidth=v/(this.nGridMatrix||20)/map.Scale.nZoomScale);v=this.nGridWidth?Math.round(map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/20)*map.Scale.nZoomScale*20:0;a:{for(c in this.itemA)break a;var c=void 0}var e="undefined",f=this.itemA[c].szSelectionId.split("::")[0],m=v*1.15,l=v*1.15/2,h=v/4;if(this.szAggregationField)for(var p in this.itemA){c=c||p;e=this.itemA[p].szAggregation;d[e]||(d[e]=[],b[e]=new point(0,
0),a[e]=0,g[e]=0,n++);d[e][p]=this.itemA[p];d[e][p].nSize=this.itemA[p].nSize||1;d[e][p].szTitle=this.itemA[p].szTitle||e;g[e]+=d[e][p].nSize;var B=this.getNodePosition(this.itemA[p].szSelectionId);B&&(b[e].x+=B.x,b[e].y+=B.y,a[e]++)}else if(this.nGridWidth)for(p in this.itemA)if(B=this.getNodePosition(this.itemA[p].szSelectionId)){if(this.szFlag.match(/\bRECT\b/))if(this.szFlag.match(/FIXGRID/)){var C=map.Scale.mapCenter.x*map.Scale.nZoomScale;e=map.Scale.mapCenter.y*map.Scale.nZoomScale;C=new point(Math.round((B.x+
C)/v)*v-C,Math.round((B.y+e)/v)*v-e)}else C=new point(Math.round(B.x/v)*v,Math.round(B.y/v)*v);else{if(this.szFlag.match(/PLOTY/))C=Math.round(B.y/v),e=C%2?l:0,C=new point(Math.round((B.x+e)/m)*m-e,C*v);else{C=Math.round(B.x/v);var N=C%2?l:0;C=new point(C*v,Math.round((B.y+N)/m)*m-N)}if(Math.abs(G-B.x)>h){e=[];var Y=[];N=N===0?l:0;G>B.x?(e[0]=new point(C.x-v,C.y-l),e[1]=new point(C.x-v,C.y+l)):(e[0]=new point(C.x+v,C.y-l),e[1]=new point(C.x+v,C.y+l));Y[0]=Math.sqrt(Math.pow(e[0].x-B.x,2)+Math.pow(e[0].y-
B.y,2));Y[1]=Math.sqrt(Math.pow(e[1].x-B.x,2)+Math.pow(e[1].y-B.y,2));Y[3]=Math.sqrt(Math.pow(C.x-B.x,2)+Math.pow(C.y-B.y,2));Y[0]<Y[3]?C=new point(Math.round(e[0].x/v)*v,Math.round((e[0].y+N)/m)*m-N):Y[1]<Y[3]&&(C=new point(Math.round(e[1].x/v)*v,Math.round((e[1].y+N)/m)*m-N))}}e=f+"::"+String(C.x)+","+String(C.y);this.themeNodesPosA[p]=C;this.themeNodesPosA[e]=C;d[e]||(d[e]=[],b[e]=new point(0,0),a[e]=0,n++);d[e][p]=this.itemA[p];d[e][p].nSize=this.itemA[p].nSize||1;b[e].x+=B.x;b[e].y+=B.y;a[e]++}else d[e]||
(d[e]=[],b[e]=new point(0,0),a[e]=0,this.fDataIncomplete=map.fTilesLoaded,n++),d[e][p]=this.itemA[p],d[e][p].nSize=this.itemA[p].nSize||1,a[e]++,this.fDataIncomplete=!0;else for(p in this.itemA)(B=this.getNodePosition(this.itemA[p].szSelectionId))?(e=this.itemA[p].szSelectionId,d[e]||(d[e]=[],b[e]=new point(0,0),a[e]=0,n++),d[e][p]=this.itemA[p],d[e][p].nSize=this.itemA[p].nSize||1,b[e].x+=B.x,b[e].y+=B.y,a[e]++):(d[e]||(d[e]=[],b[e]=new point(0,0),a[e]=0,this.fDataIncomplete=map.fTilesLoaded,n++),
d[e][p]=this.itemA[p],d[e][p].nSize=this.itemA[p].nSize||1,a[e]++,this.fDataIncomplete=!0);if(this.szFlag.match(/GROUP/)){this.itemA=[];for(var M in d){n=d[M];this.indexA=[];for(p in n)this.indexA.push(p);a=[];for(var w=0;w<this.indexA.length;w++)a.push({a:this.indexA[w],y:n[this.indexA[w]].nValuesA[0]});this.szFlag.match(/\bUP\b/)?a.sort(this.sortDownChartObjectsCompare):a.sort(this.sortUpChartObjectsCompare);for(w in a)n[a[w].a].szSelectionId=M,this.itemA[M+"*"+Math.random()]=n[a[w].a]}}else{if(this.szFlag.match(/CATEGORICAL/))for(M in this.szSizeField||
(this.szSizeField="$aggregation$"),d){n=d[M];r[M]=0;N=[];for(p in n)r[M]++,N[n[p].nValuesA[0]]||(N[n[p].nValuesA[0]]={itemA:[]}),N[n[p].nValuesA[0]].itemA[p]=n[p];d[M]=[];for(w in N)for(p in f=N[w].itemA,m=null,f)if(m==null)m=d[M][p]=f[p],m.nCount=1,m.dbIndexA=m.dbIndexA||[],m.nSize=m.nSize||1,m.nAlpha=m.nAlpha||1;else{m.nCount+=1;for(w=0;w<n[p].nValue100A.length;w++)m.nValue100A[w]+=n[p].nValue100A[w]||0;m.nSize+=f[p].nSize||1;m.nAlpha+=f[p].nAlpha||1;m.szValue=String(m.nSize);v&&!this.szAggregationField&&
(!m.szTitle||m.nCount>3)&&(m.szTitle="("+m.nCount+")");m.dbIndexA.push(f[p].dbIndex)}}else for(M in d){n=d[M];if(!this.szFlag.match(/SUM/)&&!this.szFlag.match(/ZEROISVALUE/)){v=[];N=0;for(p in n)if(N++,n[p])for(w=0;w<n[p].nValuesA.length;w++)if(n[p].nOrigValuesA[w]===0){v[p]=p;break}if(N>1)for(p in v)delete n[p],this.nTopicsSkipedByZeroExclusion++}d[M]=[];m=null;for(p in n)if(m==null)m=d[M][p]=n[p],m.nCount=1,m.dbIndexA=m.dbIndexA||[],m.nSize=m.nSize||1,m.nAlpha=m.nAlpha||1;else{for(w=0;w<n[p].nValuesA.length;w++)m.nValuesA[w]+=
n[p].nValuesA[w]||0,m.nOrigValuesA[w]+=n[p].nOrigValuesA[w]||0;m.nCount+=1;for(w=0;w<n[p].nValue100A.length;w++)m.nValue100A[w]+=n[p].nValue100A[w]||0;m.nSize+=n[p].nSize||1;m.nAlpha+=n[p].nAlpha||1;m.szValue=String(m.nSize);m.szTitle="("+this.formatValue(m.nCount,0)+")";m.dbIndexA.push(n[p].dbIndex)}}if(this.szAggregationField||this.szFlag.match(/RELOCATE/)){var J=new point(0,0),L=0;w=1E6;v=0;for(M in d)w=Math.min(w,b[M].x/a[M]),L=Math.max(L,b[M].y/a[M]),J.x+=b[M].x*(g[M]||1),J.y+=b[M].y*(g[M]||
1),v+=a[M]*(g[M]||1);J.x/=v;J.y/=v;new point(w,J.y);L=new point(J.x,L)}this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinSize=Number.MAX_VALUE;this.nSumSize=this.nMaxSize=0;this.nMinAlpha=Number.MAX_VALUE;this.nSumAlpha=this.nMaxAlpha=0;this.szFlag.match(/CATEGORICAL/)&&(this.nMinA=[],this.nMaxA=[],this.nSumA=[],this.nOrigMinA=[],this.nOrigMaxA=[],this.nOrigSumA=[],this.nMedianA=[],this.nMeanA=[],this.nCountA=[]);g="[";v=this.nStringToValue-1;for(w=0;w<v;w++)g+="0,";g+="]";this.itemA=
[];N=0;f=Math.max(this.szRangesA?this.szRangesA.length:0,this.szExactA?this.szExactA.length:0)-(this.szFlag.match(/CATEGORICAL/)?0:1);m=this.szFlag.match(/CATEGORICAL/)&&(this.szFlag.match(/PIE/)||this.szFlag.match(/BAR/)||this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/PLOT/)||this.szFlag.match(/DOMINANT/)||this.szFlag.match(/\bUSER\b/)||this.szFlag.match(/WAFFLE/));for(M in d)if(N++,M!="undefined")if(n=d[M],m){for(p in n){var G=p;break}this.itemA[G]={};w=[];try{w=aa(g)||[]}catch(V){for(l=0;l<
v;l++)w.push(0)}this.itemA[G].szSelectionId=G;this.itemA[G].szTitle=n[G].szTitle;if(this.szAggregationField||this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?(this.itemA[G].szSelectionId=c,this.szFlag.match(/\bUP\b/)?this.themeNodesPosA[G]=new point(L.x,L.y):this.themeNodesPosA[G]=new point(J.x,J.y)):this.themeNodesPosA[G]=new point(b[M].x/a[M],b[M].y/a[M]);this.itemA[G].dbIndexA=[];h=l=0;for(p in n){w[n[p].nValuesA[0]-1]=n[p].nSize/(this.szFlag.match(/SUM/)?1:n[p].nCount);l+=n[p].nSize;h+=
n[p].nCount;this.itemA[G].dbIndexA.push(n[p].dbIndex);for(var F in n[p].dbIndexA)this.itemA[G].dbIndexA.push(n[p].dbIndexA[F]);delete this.itemA[G].dbIndex}this.itemA[G].nValuesA=this.itemA[G].nOrigValuesA=w;this.itemA[G].nMinA=[];this.itemA[G].nMaxA=[];this.itemA[G].nSize=l/(this.szFlag.match(/SUM/)?1:h);this.itemA[G].nCount=h;this.itemA[G].nAlpha=n[p].nAlpha;this.itemA[G].szTitle=this.nGridWidth&&!this.szAggregationField&&r[M]>1?__formatValue(r[M],0)+" item(s) aggregated":this.itemA[G].szTitle||
M;this.itemA[G].szValue=this.itemA[G].szTitle;this.itemA[G].szLabel=this.itemA[G].szTitle;this.nMin=this.nMinSize=Math.min(this.nMinSize,this.itemA[G].nSize);this.nMax=this.nMaxSize=Math.max(this.nMaxSize,this.itemA[G].nSize);this.nSumSize+=l/(this.szFlag.match(/SUM/)?1:h);this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[G].nAlpha);this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[G].nAlpha);this.nSumAlpha+=this.itemA[G].nAlpha;if(this.szFlag.match(/AUTO100/)){for(w=h=0;w<this.itemA[G].nValuesA.length;w++)h+=
this.itemA[G].nValuesA[w]||0;for(w=0;w<this.itemA[G].nValuesA.length;w++)this.itemA[w].nValue100A[0]=h;this.fField100=!0;for(w=0;w<this.itemA[G].nValuesA.length;w++)this.itemA[G].nValuesA[w]=this.itemA[G].nOrigValuesA[w]/this.itemA[G].nValue100[w]*100}if(this.szFlag.match(/CATEGORICAL/)&&(this.szFlag.match(/CATEGORICAL/)||!this.nNormalSizeValue)){if(!this.nMinA.length)for(w=0;w<this.itemA[G].nValuesA.length;w++)this.nMinA[w]=null,this.nMaxA[w]=null,this.nSumA[w]=0,this.nOrigMinA[w]=null,this.nOrigMaxA[w]=
null,this.nOrigSumA[w]=0,this.nMedianA[w]=0,this.nMeanA[w]=0,this.nCountA[w]=0;for(w=0;w<this.itemA[G].nValuesA.length;w++)this.nMinA[w]=Math.min(this.nMinA[w]||this.itemA[G].nValuesA[w],this.itemA[G].nValuesA[w]),this.nMaxA[w]=Math.max(this.nMaxA[w]||this.itemA[G].nValuesA[w],this.itemA[G].nValuesA[w]),this.nSumA[w]+=this.itemA[G].nValuesA[w],this.nOrigMinA[w]=Math.min(this.nOrigMinA[w]||this.itemA[G].nOrigValuesA[w],this.itemA[G].nOrigValuesA[w]),this.nOrigMaxA[w]=Math.max(this.nOrigMaxA[w]||this.itemA[G].nOrigValuesA[w],
this.itemA[G].nOrigValuesA[w]),this.nOrigSumA[w]+=this.itemA[G].nOrigValuesA[w],this.itemA[G].nValuesA[w]&&this.nCountA[w]++}this.nCount=N*f}else for(p in n)if(n[p]){l=p;this.szAggregationField||(l=M,this.itemA[l]&&(l=l.split("*")[0]+"*"+Math.random()));this.itemA[l]=n[p];n[p].szValue=n[p].szValue||1;this.nMinSize=Math.min(this.nMinSize,this.itemA[l].nSize);this.nMaxSize=Math.max(this.nMaxSize,this.itemA[l].nSize);this.nSumSize+=this.itemA[l].nSize;this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[l].nAlpha);
this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[l].nAlpha);this.nSumAlpha+=this.itemA[l].nAlpha;this.szFlag.match(/SUM/)||(h=this.szFlag.match(/SUM/)?1:n[p].nCount,this.itemA[l].nSize/=h,this.itemA[l].szValue/=h,this.itemA[l].nValue100A[0]/=h);if(this.nGridWidth||this.szAggregationField)for(h=this.szFlag.match(/SUM/)||this.szFlag.match(/CATEGORICAL/)?1:n[p].nCount,this.itemA[l].szSelectionId=p,w=0;w<this.itemA[l].nValuesA.length;w++)this.itemA[l].nValuesA[w]/=h,this.itemA[l].nOrigValuesA[w]/=h,
this.itemA[l].nValue100A[w]&&(this.itemA[l].nValuesA[w]=this.itemA[l].nOrigValuesA[w]/this.itemA[l].nValue100A[w],this.szFlag.match(/FRACTION/)||(this.itemA[l].nValuesA[w]*=this.szFlag.match(/PERMILLE/)?1E3:100),this.szFlag.match(/INVERT/)&&(this.itemA[l].nValuesA[w]=100-this.itemA[l].nValuesA[w])),this.nMin=Math.min(this.itemA[l].nValuesA[w]||Number.MAX_VALUE,this.nMin||Number.MAX_VALUE),this.nMax=Math.max(this.itemA[l].nValuesA[w]||-Number.MAX_VALUE,this.nMax||-Number.MAX_VALUE);else this.nMin=
Math.min(this.itemA[l].nSize,this.nMin||Number.MAX_VALUE),this.nMax=Math.max(this.itemA[l].nSize,this.nMax||-Number.MAX_VALUE);if(this.szFlag.match(/AUTO100/)){for(w=h=0;w<this.itemA[l].nValuesA.length;w++)h+=this.itemA[l].nValuesA[w]||0;for(w=0;w<this.itemA[l].nValuesA.length;w++)this.itemA[l].nValue100A[w]=h;this.fField100=!0;for(w=0;w<this.itemA[l].nValuesA.length;w++)this.itemA[l].nValuesA[w]=this.itemA[l].nOrigValuesA[w]/this.itemA[l].nValue100A[w]*100}if(this.szAggregationField||this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?
this.szFlag.match(/\bUP\b/)?this.themeNodesPosA[l]=new point(L.x,L.y):this.themeNodesPosA[l]=new point(J.x,J.y):(this.themeNodesPosA[p]=new point(b[M].x/a[M],b[M].y/a[M]),this.themeNodesPosA[l]=new point(b[M].x/a[M],b[M].y/a[M]))}if(this.szMinAggregation){d=h=0;for(p in this.itemA)d+=this.itemA[p].nCount,h++;d/=h;for(p in this.itemA)this.itemA[p].nCount&&this.itemA[p].nCount<(this.nMinAggregation||d/2)&&delete this.itemA[p];this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;for(p in this.itemA)for(w=
0;w<this.itemA[p].nValuesA.length;w++)this.nMin=Math.min(this.itemA[p].nValuesA[w],this.nMin),this.nMax=Math.max(this.itemA[p].nValuesA[w],this.nMax)}this.fSorted=!0}}};A.prototype.distributeValues=function(){if(this.nCount===0)return this.szFlag.match(/CATEGORICAL/)&&displayMessage("theme: no matching values !",3E3),!1;if(this.szFlag.match(/OUTLIER/)){var d=this.szFieldsA.length;this.getMeanMedianQuantile();if(this.szFlag.match(/PLOT/)){for(var a in this.itemA){for(var g=[],b=0;b<d;b++)this.itemA[a].nValuesA[b]&&
g.push(this.itemA[a].nValuesA[b]);this.nDeviationA[a]=this.parent.getDeviationOfArray(g)}for(a in this.itemA)for(b=0;b<d;b++)Math.abs(this.itemA[a].nValuesA[b]-this.itemA[a].nValuesA[b-1])>this.nDeviationA[a]*(this.nOutlierScale||2)&&this.szFlag.match(/NOOUTLIER/)&&(this.itemA[a].nValuesA[b]=this.itemA[a].nValuesA[b-1])}else{for(b=0;b<d;b++){g=[];for(a in this.itemA)this.itemA[a].nValuesA[b]&&g.push(this.itemA[a].nValuesA[b]);this.nDeviationA[b]=this.parent.getDeviationOfArray(g)}for(b=0;b<d;b++)for(a in this.itemA)Math.abs(this.itemA[a].nValuesA[b]-
this.nMeanA[b])>this.nDeviationA[b]*(this.nOutlierScale||3)?this.szFlag.match(/NOOUTLIER/)&&delete this.itemA[a]:this.szFlag.match(/NOOUTLIER/)||delete this.itemA[a]}this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;for(a in this.itemA)for(var r=0;r<this.itemA[a].nValuesA.length;r++)isNaN(this.itemA[a].nValuesA[r])||(this.nMin=Math.min(this.itemA[a].nValuesA[r],this.nMin),this.nMax=Math.max(this.itemA[a].nValuesA[r],this.nMax))}(this.szFlag.match(/AGGREGATE/)||this.szFlag.match(/GROUP/))&&this.aggregateValues();
this.szSizeField=="$aggregation$"&&(this.szSizeField=null);if(this.szFlag.match(/CATEGORICAL/)&&(!this.szExactA||!this.szExactA.length)&&(this.szExactA=this.szExactA||[],this.nStringToValueA))for(a in this.nStringToValueA)this.szExactA.push(this.nStringToValueA[a]);!this.szFlag.match(/CATEGORICAL/)||this.szLabelA&&this.szLabelA.length||!this.szValuesA||(this.szLabelA=this.szValuesA);if(this.szColorField)if(this.colorFieldA=[],this.colorClassA=[],this.colorClassUsedA=[],this.szColorValuesA)for(b in this.szColorValuesA)this.colorFieldA[this.szColorValuesA[b]]=
!0;else if(this.szValuesA)for(b in this.szValuesA)this.colorFieldA[this.szValuesA[b]]=!0;else for(a in this.itemA)this.colorFieldA[this.itemA[a].szColor]=!0;if(this.szSymbolField)if(this.symbolFieldA=[],this.szSymbolValuesA)for(b in this.szSymbolValuesA)this.symbolFieldA[this.szSymbolValuesA[b]]=this.szSymbolsA[b];else for(a in this.itemA)this.symbolFieldA[this.itemA[a].szSymbol]=this.szSymbolsA[b];this.origColorScheme||(this.origColorScheme=this.colorScheme=this.defaultColorScheme);if(isNaN(Number(this.origColorScheme[0])))this.colorScheme=
this.origColorScheme.slice(0);else{this.szFlag.match(/SEQUENCE/)&&this.szFieldsA.length>this.origColorScheme[0]&&(this.origColorScheme[0]=this.szFieldsA.length);this.szFlag.match(/CATEGORICAL/)&&(this.origColorScheme[0]=this.szExactA.length||1);if(this.szColorField){d=0;for(a in this.colorFieldA)d++;this.origColorScheme[0]=d}try{this.colorScheme=ColorScheme.createColorScheme(this.origColorScheme[1],this.origColorScheme[2],this.origColorScheme[0],this.origColorScheme[3],this.origColorScheme[4])}catch(c){this.colorScheme=
this.defaultColorScheme}if(this.szFlag.match(/CATEGORICAL/)&&this.szFlag.match(/ORDER/)){d=this.colorScheme.slice();g=this.szValuesA?this.szValuesA.slice():this.szLabelA.slice();if(this.szColorField)for(a in g=[],this.colorFieldA)g.push(a),this.getStringValueIndex(a,"set");if(g.length&&d.length&&g.length==d.length)for(g.sort(),this.colorScheme=[],b=0;b<g.length;b++)this.colorScheme[this.nStringToValueA[g[b]]-1]=d[b]}}if(this.szColorField){b=0;for(a in this.colorFieldA)this.colorClassA[a]=b,this.colorFieldA[a]=
this.colorScheme[b++];for(a in this.itemA)this.itemA[a].nClass=this.colorClassA[this.itemA[a].szColor],this.itemA[a].szColor=this.colorFieldA[this.itemA[a].szColor]}if(this.szSymbolField)for(a in b=0,this.itemA)this.itemA[a].szSymbol=this.symbolFieldA[this.itemA[a].szSymbol];try{if(this.colorScheme&&this.colorScheme[0]&&/^[a-zA-Z_$][a-zA-Z0-9_$.]*$/.test(this.colorScheme[0])){d=null;if(this.colorScheme[0].indexOf(".")!==-1){var n=this.colorScheme[0].split(".");g=window;for(b=0;b<n.length;b++)if(g&&
g[n[b]])g=g[n[b]];else{g=null;break}g&&typeof g==="function"&&(d=g)}else map.HTMLWindow&&map.HTMLWindow[this.colorScheme[0]]&&(d=map.HTMLWindow[this.colorScheme[0]]);d&&(window.__defineColorScheme=d,window.__defineColorScheme(this),window.__defineColorScheme=null)}}catch(c){}if(this.colorScheme[0].match(/function||=>/))try{eval("var __defineColorScheme = "+this.colorScheme),__defineColorScheme(this)}catch(c){}try{map.HTMLWindow.ixmaps.htmlgui_colorScheme(this)}catch(c){}if(this.szFlag.match(/DOMINANT/))for(;this.colorScheme.length<
this.szFieldsA.length;)this.colorScheme[this.colorScheme.length]="#dddddd";if(this.szFieldsA)if(this.colorScheme.length<this.szFieldsA.length&&this.nGridX)for(;this.colorScheme.length<this.nGridX;)this.colorScheme[this.colorScheme.length]=this.colorScheme[this.colorScheme.length-1]||"#dddddd";else if(!this.szFlag.match(/\bCLIP\b|\bDIFFERENCE\b/))for(;this.colorScheme.length<this.szFieldsA.length;)this.colorScheme[this.colorScheme.length]=this.colorScheme[this.colorScheme.length-1]||"#dddddd";if(this.szFlag.match(/NORMALIZE/)&&
this.nMax){g=this.nMax-this.nMin;for(a in this.itemA)this.itemA[a].nValuesA[0]=(this.itemA[a].nValuesA[0]-this.nMin)/g;this.nMin=0;this.nMax=1}if(this.szFlag.match(/HARMONIZE/)&&this.nMax){if(this.nMaxA){this.nRangeA=[];for(r in this.nMaxA)this.nRangeA.push(this.nMaxA[r]-this.nMinA[r]);for(a in this.itemA)for(r in this.itemA[a].nValuesA)this.itemA[a].nValuesA[r]=(this.itemA[a].nValuesA[r]-this.nMinA[r])/this.nRangeA[r];for(r in this.nMaxA)this.nMinA[r]=0,this.nMaxA[r]=1}else{for(a in this.itemA)this.itemA[a].nValuesA[0]/=
this.nMax;this.nMin/=this.nMax;this.nMax/=this.nMax}this.nMin=0;this.nMax=1}if(this.szFlag.match(/INVERTSIZE/)&&this.szSizeField){for(a in this.itemA)this.itemA[a].nSize=this.nMaxSize-this.itemA[a].nSize;this.nNormalSizeValue=this.nNormalSizeValue||this.nMaxSize}this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/SEQUENCE/)||this.getMeanMedianQuantile();d=this.colorScheme.length;g=this.nMax-this.nMin;n=this.nMin;r=this.nMax;this.nRangeCenterValue==null||isNaN(this.nRangeCenterValue)||(b=Math.max(Math.abs(this.nRangeCenterValue-
n),Math.abs(r-this.nRangeCenterValue)),n=this.nRangeCenterValue-b,r=this.nRangeCenterValue+b,g=r-n);if(this.szFlag.match(/INTEGER/))d>g?d=g:d>g/2?d=Math.floor(g/2):g+=d-g%d;else{var v=1;for(this.szField100&&(v=.01);g>v*1E3;)v*=10;v>1?(n=Math.floor(n/v)*v,r=Math.ceil(r/v)*v):r+=r/1E5;g=r-n}if(this.szFlag.match(/CHART|CHOROPLETH/)&&(isNaN(g)||!isFinite(g)))return _ERROR("ERROR on distributeValues: infinite range !"),displayMessage("ERROR: infinite value range !",3E3),!1;if(this.szColorField)for(a in this.nRangesA=
[],b=0,this.colorFieldA)this.nRangesA.push(b++);else this.nRangesA=this.szRangesA||this.szExactA;if(this.nRangesA&&this.nRangesA.length){v=this.szFlag.match(/CATEGORICAL/)?0:1;this.szFlag.match(/BAR/)&&this.szFlag.match(/SEQUENCE/)&&(v=1);d=this.nRangesA.length-v;if(this.szSymbolsA&&this.szSymbolsA.length)for(;this.szSymbolsA.length<d;)this.szSymbolsA[this.szSymbolsA.length]=this.szSymbolsA[this.szSymbolsA.length-1];if(this.colorScheme&&this.colorScheme.length)for(;this.colorScheme.length<d;)this.colorScheme[this.colorScheme.length]=
this.colorScheme[this.colorScheme.length-1]||"#dddddd";this.partsA=[];for(b=0;b<d;b++)n=Number(this.nRangesA[b]),r=Number(this.nRangesA[b+v])+1E-9,this.partsA[this.partsA.length]={min:n,max:r,color:this.colorScheme[b],nCount:0,nSum:0};if(this.szFlag.match(/CATEGORICAL/)&&this.exactCountA)for(b=0;b<d;b++)this.partsA[b].nCount=this.exactCountA[b];if(this.szFlag.match(/PLOTVAR/)||this.szFlag.match(/DOMINANT/))for(this.getMeanMedianQuantile(),b=0;b<d;b++){g=[];for(a in this.itemA)this.itemA[a].nValuesA[b]&&
g.push(this.itemA[a].nValuesA[b]);this.nDeviationA[b]=this.parent.getDeviationOfArray(g);this.szDominantFilter=this.szDominantFilter||"min";this.nDominantDFilter=this.nDominantDFilter||0;this.szDominantFilter.match(/min/)?this.nFilterA[b]=this.nMinA[b]+(this.nMaxA[b]-this.nMinA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/max/)?this.nFilterA[b]=this.nMinA[b]+(this.nMaxA[b]-this.nMinA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/mean/)?this.nFilterA[b]=this.nMeanA[b]+(this.nMaxA[b]-
this.nMeanA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/median/)&&(this.nFilterA[b]=this.nMedianA[b]+(this.nMaxA[b]-this.nMedianA[b])/100*this.nDominantDFilter)}}else{g/=d;g>v&&(g=Math.floor(g/v)*v);this.nMin==this.nMax&&(d=1);this.partsA=[];for(b=0;b<d;b++)this.partsA[this.partsA.length]={min:n+b*g,max:n+(b+1)*g,color:this.colorScheme[b],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=r;if(this.szFlag.match(/HEADTAIL/)){v=this.getHeadTail();for(b=0;b<this.partsA.length;b++)this.partsA[b].min=
v[b],this.partsA[b].max=v[b+1]-1E-6;this.partsA[this.partsA.length-1].max=r}if(this.szFlag.match(/QUANTILE/)){this.getMeanMedianQuantile();v=Math.round(this.quantileA[0].length/d);for(b=0;b<this.partsA.length;b++)this.partsA[b].min=this.quantileA[0][b*v],this.partsA[b].max=this.quantileA[0][(b+1)*v];this.partsA[this.partsA.length-1].max=r}if(this.szFlag.match(/LOG/)){n=Math.log(this.nMin?this.nMin:Math.min(.1,this.nMax/10));g=Math.log(this.nMax?this.nMax:.1)-n;g/=d;this.partsA=[];for(b=0;b<d;b++)this.partsA[this.partsA.length]=
{min:Math.exp(n+b*g),max:Math.exp(n+(b+1)*g),color:this.colorScheme[b],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}else if(this.szFlag.match(/POW2/)){n=Math.pow(this.nMin?this.nMin:1,.5);g=Math.pow(this.nMax?this.nMax:1,.5)-Math.pow(this.nMin?this.nMin:1,.5);g/=d;this.partsA=[];for(b=0;b<d;b++)this.partsA[this.partsA.length]={min:Math.pow(n+b*g,2),max:Math.pow(n+(b+1)*g,2),color:this.colorScheme[b],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}else if(this.szFlag.match(/POW3/)){n=
Math.pow(this.nMin?this.nMin:1,1/3);g=Math.pow(this.nMax?this.nMax:1,1/3)-Math.pow(this.nMin?this.nMin:1,1/3);g/=d;this.partsA=[];for(b=0;b<d;b++)this.partsA[this.partsA.length]={min:Math.pow(n+b*g,3),max:Math.pow(n+(b+1)*g,3),color:this.colorScheme[b],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}if(this.szFlag.match(/DOMINANT/)||this.szFlag.match(/OFFSETMEAN/)||this.szFlag.match(/OFFSETMEDIAN/)||this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/)){this.getMeanMedianQuantile();
for(b=0;b<this.szFieldsA.length;b++){v=[];for(a in this.itemA)this.itemA[a].nValuesA[b]&&v.push(this.itemA[a].nValuesA[b]);this.szFieldsA[b]!="$item$"&&v.sort(this.sortUp);this.nMedianA[b]=v[Math.round(v.length/2)];this.szMeansA?this.nMeanA[b]=Number(this.szMeansA[b]):this.nSum100?this.szFlag.match(/DIFFERENCE/)?this.nMeanA[b]=this.nSumA[b]/this.nCount:(this.nMeanA[b]=this.nOrigSumA[b]/this.nSum100,this.szFlag.match(/FRACTION/)?this.nMeanA[b]*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?
this.nMeanA[b]*=1E3:(this.nMeanA[b]*=100,this.szFlag.match(/RELATIVE/)?this.nMeanA[b]-=100:this.szFlag.match(/INVERT/)&&(this.nMeanA[b]=100-this.nMeanA[b]))):this.nMeanA[b]=this.nSumA[b]/this.nCount}for(b=0;b<this.partsA.length;b++)this.szDominantFilter=this.szDominantFilter||"min",this.nDominantDFilter=this.nDominantDFilter||0,this.szDominantFilter.match(/min/)?this.nFilterA[b]=this.nMinA[b]+(this.nMaxA[b]-this.nMinA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/max/)?this.nFilterA[b]=
this.nMinA[b]+(this.nMaxA[b]-this.nMinA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/mean/)?this.nFilterA[b]=this.nMeanA[b]+(this.nMaxA[b]-this.nMeanA[b])/100*this.nDominantDFilter:this.szDominantFilter.match(/median/)&&(this.nFilterA[b]=this.nMedianA[b]+(this.nMaxA[b]-this.nMedianA[b])/100*this.nDominantDFilter);if(this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/))for(b=0;b<this.szFieldsA.length;b++){g=[];for(a in this.itemA)this.itemA[a].nValuesA[b]&&g.push(this.itemA[a].nValuesA[b]);
this.nDeviationA[b]=this.parent.getDeviationOfArray(g)}}}this.partsA[this.partsA.length-1]&&(this.partsA[this.partsA.length-1].max+=.001);this.szColorField&&(this.nRangesA=this.szRangesA||this.szExactA);this.szFlag.match(/COMPOSECOLOR/)&&S(this.colorScheme.slice(0));this.nAllMaxValue=-Number.MAX_VALUE;this.nAllMinValue=Number.MAX_VALUE;for(b in this.nMaxA)this.nAllMaxValue=Math.max(this.nAllMaxValue,this.nMaxA[b]),this.nAllMinValue=Math.min(this.nAllMinValue,this.nMinA[b]);return!0};A.prototype.sortUp=
function(d,a){return d-a};A.prototype.sortIndexUp=function(d,a){return d.value-a.value};A.prototype.sortIndexDown=function(d,a){return a.value-d.value};A.prototype.sortPartsUp=function(d,a){return d.nCount-a.nCount};A.prototype.sortMeanUp=function(d,a){return d.mean-a.mean};A.prototype.shuffleArray=function(d,a){for(var g=d.length-1;g>0;g--){var b=Math.floor((a&&a[g]?a[g]:Math.random())*g+1),r=d[g];d[g]=d[b];d[b]=r}};A.prototype.getRandomNumberArray=function(d){for(var a=[],g=0;g<d;g++)a.push(Math.random());
return a};var sa=0,ua=0,S=function(d){for(var a=ua=sa=0;a<d.length;a++){var g=ColorScheme.getHexaColor(d[a]);ua+=Math.max(Math.max(parseInt(g.substr(1,2),16),parseInt(g.substr(3,2),16)),parseInt(g.substr(5,2),16));sa+=parseInt(g.substr(1,2),16)+parseInt(g.substr(3,2),16)+parseInt(g.substr(5,2),16)}sa/=d.length;ua/=d.length},ja=function(d,a,g,b){for(var r=0,n=0,v=0,c=0;c<d.length;c++){var e=ColorScheme.getHexaColor(a[c]);r+=parseInt(e.substr(1,2),16)*((d[c]||0)/(g||1));n+=parseInt(e.substr(3,2),16)*
((d[c]||0)/(g||1));v+=parseInt(e.substr(5,2),16)*((d[c]||0)/(g||1))}d=Math.max(Math.max(r,n),v);r=Math.floor(r/d*(b||ua));n=Math.floor(n/d*(b||ua));v=Math.floor(v/d*(b||ua));return ColorScheme.getHexaColor("rgb("+r+","+n+","+v+")")},pa=function(d,a,g,b){b=b||Math.min(Math.floor(sa),300)||255;for(var r=0,n=0,v=0,c=0;c<d.length;c++){var e=ColorScheme.getHexaColor(a[c]);r+=(255-parseInt(e.substr(1,2),16))*((d[c]||0)/(g||1));n+=(255-parseInt(e.substr(3,2),16))*((d[c]||0)/(g||1));v+=(255-parseInt(e.substr(5,
2),16))*((d[c]||0)/(g||1))}d=Math.max(Math.max(r,n),v);r=Math.min(255,b-Math.floor(r/d*ua));n=Math.min(255,b-Math.floor(n/d*ua));v=Math.min(255,b-Math.floor(v/d*ua));return ColorScheme.getHexaColor("rgb("+r+","+n+","+v+")")};A.prototype.paintMap=function(d){if(this.nChartUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nChartUpper)this.unpaintMap(),this.fVisible=!1,this.realizeDone();else if(this.nChartLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nChartLower)this.unpaintMap(),
this.fVisible=!1,this.realizeDone();else{this.beginDraw();this.mapSleep&&(this.mapSleep.checkSleepMessage="painting map");var a=0,g=0,b=0,r=0,n=0,v=0,c="",e="";map.Dictionary.getLocalText("of mean");map.Dictionary.getLocalText("of median");var f=!1,m=0,l=b=c=0;r=null;this.fillOpacity=this.fillOpacity?this.fillOpacity:this.nOpacity;this.szStyle="fill-opacity:"+String(this.fillOpacity?this.fillOpacity:map.fTransparentMap?.6:1);this.autoOpacity&&(m=map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale,
this.szStyle="fill-opacity:"+String(Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom/m))))));this.szShapeType.match(/line/)&&(this.szStyle=this.fillOpacity?"stroke-opacity:"+this.fillOpacity+";":"stroke-opacity:1");if(!d||d===0){d=0;this.indexA=[];for(l in this.itemA)this.indexA[this.indexA.length]=l,this.itemA[l].todo=!0;for(c=0;c<this.partsA.length;c++)this.partsA[c].nCount=0,this.partsA[c].nSum=0;this.nDoneCount=0;this.szFlag.match(/COMPOSECOLOR/)&&S(this.colorScheme.slice(0));if(this.parentTheme)for(b=
0;b<this.parentTheme.paintedShapeNodesA.length;b++)this.parentTheme.unPaintShape(this.parentTheme.paintedShapeNodesA[b])}for(;d<this.indexA.length;d++){if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(d,10))){this.fContinue=!0;this.continueIndex=d;this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);return}l=this.indexA[d];this.nDoneCount++;f=!1;m=0;if(this.szFlag.match(/COMPOSECOLOR/)){a=this.szFlag.match(/SUBTRACTIVE/)?
pa(this.itemA[l].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):ja(this.itemA[l].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255));r=this.getItemNodes(l);for(b=0;b<r.length;b++)if(n=this.paintShape(r[b],a,-1,-1),this.szFlag.match(/DOPACITY/)){if(this.szAlphaField)v=0,typeof this.itemA[l].nAlpha!="undefined"&&(v=1/(this.nDopacityPow||1),v=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,v)*Math.pow(this.itemA[l].nAlpha,v));else{v=1/(this.nDopacityPow||1);
m=(isNaN(this.itemA[l].nValueSum)?0:this.itemA[l].nValueSum)/(this.itemA[l].nValue100A[0]/100||1);var h=isNaN(this.nMax)?0:this.nMax;v=(this.nDopacityScale||1)*Math.pow(m,v)/Math.pow(h,v)}n.style.setProperty(this.szShapeType.match(/line/)?"stroke-opacity":"fill-opacity",String(v),"")}f=!0}else if(this.szFlag.match(/DOMINANT/)){f=!0;var p=-1;for(c=0;c<this.itemA[l].nValuesA.length;c++)a=this.itemA[l].nValuesA[c],g=100/this.nMeanA[c]*a,b=100/this.nMedianA[c]*a,r=(a-this.nMeanA[c])/this.nDeviationA[c],
n=a,this.szFlag.match(/PERCENTOFMEAN/)&&(n=g),this.szFlag.match(/PERCENTOFMEDIAN/)&&(n=b),this.szFlag.match(/DEVIATION/)&&(n=r),a>this.nFilterA[c]&&n>m&&(this.itemA[l].nClass=c,m=n,p=c);if(p>=0){this.itemA[l].nDominant=p;a=this.itemA[l].nValuesA[p];c=" "+this.szFieldsA[p]+" ";this.szLabelA&&this.szLabelA[p]&&(c=" "+this.szLabelA[p]+" ");if(this.szFlag.match(/PERCENTOFMEAN/)||this.szFlag.match(/DEVIATION/))e=map.Dictionary.getLocalText(" ( mean: ")+this.formatValue(this.nMeanA[p],1)+this.szUnit+")";
this.szFlag.match(/PERCENTOFMEDIAN/)&&(e=map.Dictionary.getLocalText(" ( median: ")+this.formatValue(this.nMedianA[p],1)+this.szUnit+")");this.itemA[l].nValue=this.itemA[l].nValuesA[p];this.itemA[l].szLabel=c;this.itemA[l].szColor=this.colorScheme[p];this.itemA[l].nClass=p;r=this.getItemNodes(l);for(b=0;b<r.length;b++)n=this.paintShape(r[b],this.colorScheme[p],this.itemA[l].nValue,p),n.setAttributeNS(szMapNs,"tooltip",this.formatValue(a,2)+this.szUnit+c+e),this.szFlag.match(/DOPACITY/)&&(v=h=m=0,
m=isNaN(this.itemA[l].nValuesA[p])?0:this.itemA[l].nValuesA[p],h=isNaN(this.nMaxA[p])?0:this.nMaxA[p],this.szAlphaField?(v=0,typeof this.itemA[l].nAlpha!="undefined"&&(v=1/(this.nDopacityPow||1),v=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,v)*Math.pow(this.itemA[l].nAlpha,v))):this.szFlag.match(/DOPACITYLOGMEAN/)?v=Math.log((this.nDopacityScale||1)*(g-100))/Math.log(100):this.szFlag.match(/DOPACITYPOWMEAN/)?(v=1/(this.nDopacityPow||1),v=Math.pow((this.nDopacityScale||1)*(g-100),v)/Math.pow(100,
v)):this.szFlag.match(/DOPACITYMEAN/)?(v=1/(this.nDopacityPow||1),v=Math.pow((this.nDopacityScale||1)*(g-100),v)/Math.pow(100,v)):this.szFlag.match(/DOPACITYLOGMAX/)?v=Math.log(m)/Math.log(h):this.szFlag.match(/DOPACITYPOWMAX/)?(v=1/(this.nDopacityPow||1),v=(this.nDopacityScale||1)*Math.pow(m,v)/Math.pow(h,v)):this.szFlag.match(/DOPACITYMAX/)?(v=1/(this.nDopacityPow||1),v=(this.nDopacityScale||1)*Math.pow(m,v)/Math.pow(h,v)):v=Math.log((this.nDopacityScale||1)*m)/Math.log(h),v=v<1E-4?0:v,v=Math.min(this.nOpacity||
.9,v),this.autoOpacity&&(m=map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale,v*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom/m))))),n.style.setProperty(this.szShapeType.match(/line/)?"stroke-opacity":"fill-opacity",String(v),""));this.partsA[p].nCount++}else for(r=this.getItemNodes(l),b=0;b<r.length;b++)this.unPaintShape(r[b]),r[b].removeAttributeNS(szMapNs,"tooltip")}else for(a=this.szFlag.match(/\bCLIP\b/)&&this.nClipFrames?this.nClipFrames==this.itemA[l].nValuesA.length?
Number(this.itemA[l].nValuesA[this.nActualFrame]):this.itemA[l].nValuesA[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.itemA[l].nValuesA[1]*this.nActualFrame/(this.nClipFrames-1):this.itemA[l].nValuesA[0],c=0;c<this.partsA.length;c++)if(a<this.partsA[c].max){this.itemA[l].nValue=a;this.itemA[l].szColor=this.partsA[c].color;this.itemA[l].nClass=c;if(this.itemA[l].todo){r=this.getItemNodes(l);for(b=0;b<r.length;b++)n=this.paintShape(r[b],this.partsA[c].color,a,c),this.szLabelA&&
this.szLabelA[c]&&this.szFlag.match(/CATEGORICAL/)?n.setAttributeNS(szMapNs,"tooltip",this.szLabelA[c]):this.itemA[l].nValue100A[0]?n.setAttributeNS(szMapNs,"tooltip",this.formatValue(a,2)+this.szUnit):(n.setAttributeNS(szMapNs,"tooltip",this.formatValue(a,2)+this.szUnit),n.setAttributeNS(szMapNs,"tooltip",(this.itemA[l].szTitle?this.itemA[l].szTitle:"")+" "+this.formatValue(a,2)+this.szUnit)),this.szFlag.match(/DOPACITY/)&&(this.szAlphaField?(v=0,typeof this.itemA[l].nAlpha!="undefined"&&(v=1/(this.nDopacityPow||
1),v=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,v)*Math.pow(this.itemA[l].nAlpha,v))):this.nMin<0&&this.nMax>0?(v=0,this.szFlag.match(/DOPACITYMAX/)?(v=1/(this.nDopacityPow||1),v=Math.pow(Math.abs(a),v)/Math.pow(this.nMedianA[0]-this.nMin,v)*(this.fillOpacity||1)*(this.nDopacityScale||1)):v=this.szFlag.match(/DOPACITYLOG/)?Math.log(Math.abs(a))/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.abs(a)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||
1)*(this.nDopacityScale||1)):this.szFlag.match(/BIPOLAR/)||this.szFlag.match(/DOPACITYMINMAX/)?(v=0,this.szFlag.match(/DOPACITYMAX/)?(v=1/(this.nDopacityPow||1),v=a>=this.nMeanA[0]?Math.pow(Math.abs(a-this.nMeanA[0]),v)/Math.pow(Math.abs(this.nMax-this.nMeanA[0]),v)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(this.nMeanA[0]-a),v)/Math.pow(Math.abs(this.nMeanA[0]-this.nMin),v)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?v=a>=this.nMedianA[0]?
Math.log(Math.abs(a-this.nMedianA[0]))/Math.log(this.nMax-this.nMedianA[0])*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.log(Math.abs(a-this.nMedianA[0]))/Math.log(this.nMedianA[0]-this.nMin)*(this.fillOpacity||1)*(this.nDopacityScale||1):(v=1/(this.nDopacityPow||1),v=a>=this.nMedianA[0]?Math.pow(Math.abs(a-this.nMedianA[0]),v)/Math.pow(this.nMax-this.nMedianA[0],v)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(a-this.nMedianA[0]),v)/Math.pow(this.nMedianA[0]-this.nMin,v)*
(this.fillOpacity||1)*(this.nDopacityScale||1))):this.szFlag.match(/DOPACITYMIN/)?(v=1/(this.nDopacityPow||1),v=Math.pow(this.nMax-a,v)/Math.pow(this.nMax-this.nMin,v)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYMAX/)?(v=1/(this.nDopacityPow||1),v=Math.pow(a-this.nMin,v)/Math.pow(this.nMax-this.nMin,v)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?v=Math.log(a-this.nMin)/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*
(this.nDopacityScale||1):this.szFlag.match(/DOPACITY/)&&(v=(a-this.nMin)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1)),v=v<1E-4?0:v,v=Math.min(this.nOpacity||.9,v),this.autoOpacity&&(m=map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale,v*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom/m))))),n.style.setProperty("fill-opacity",String(v),""));this.itemA[l].todo=!1}this.partsA[c].nCount++;this.partsA[c].nSum+=a;f=!0;break}if(!f)for(this.itemA[l].szColor=
this.szNoDataColor?this.szNoDataColor:"white",r=this.getItemNodes(l),b=0;b<r.length;b++)n=this.paintShape(r[b],this.szNoDataColor?this.szNoDataColor:"white",-1,-1),n.setAttributeNS(szMapNs,"tooltip","no value"),this.szFlag.match(/DOPACITY/),this.nNoData++}this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;this.showInfo();this.endDraw();this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);this.szFlag.match(/\bCLIP\b/)?this.nClipFrames==this.itemA[l].nValuesA.length?
this.szXaxisA&&this.szXaxisA[this.nActualFrame]?displayMessage(this.szXaxisA[this.nActualFrame],3E3,"big"):this.szLabelA&&this.szLabelA[this.nActualFrame]&&displayMessage(this.szLabelA[this.nActualFrame],3E3,"big"):(g=this.szXaxisA||this.szLabelA)&&(this.nActualFrame===0?displayMessage(g[0],3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(g[1],3E3,"big"):displayMessage(" ... ",3E3,"big")):this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();
this.szFlag.match(/VALUES/)&&(!this.szValueUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nValueUpper)&&(!this.szValueLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nValueLower)?(this.mapSleep&&this.mapSleep.initCheckSleep(25),this.fContinue=this.fMakeLabel=!0,this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nSkipCount=this.nDoneCount=this.continueIndex=0,g=this.szFlag.match(/\bLAST\b/),e=this.szFlag.match(/\bCLIP\b/),l=this.nActualFrame,
l=e&&this.nClipFrames&&l===this.nClipFrames-1,this.nActualFrame=(g||l)&&e&&this.nClipFrames?this.nClipFrames-1:0,setTimeout(function(){map.Themes.executeContinue()},1E3)):this.unlabelMap()}};A.prototype.unpaintMap=function(){if(!this.szFlag.match(/FEATURE/))if(this.szFlag.match(/CHART/)){if(this.chartGroup){if(this.chartGroup.childNodes.length===0&&this.itemA){var d=null,a;for(a in this.itemA)(d=map.SVGDocument.getElementById(this.szId+":"+a+":chartgroup"))&&d.parentNode.removeChild(d)}this.fAutoScaleLeader&&
(map.Themes.autoScale=null);map.Dom.clearGroup(this.chartGroup)}}else if(!this.szFlag.match(/LOCKED/)){this.beginDraw();for(d=0;d<this.paintedShapeNodesA.length;d++)this.unPaintShape(this.paintedShapeNodesA[d]),this.paintedShapeNodesA[d].removeAttributeNS(szMapNs,"tooltip");this.paintedShapeNodesA.length=0;this.unlabelMap();this.endDraw();this.isVisible=!1;this.checkVisible();setTimeout(function(){map.Layer.adaptLabel(null)},10)}};A.prototype.paintShape=function(d,a,g,b){this.paintedShapeNodesA.push(d);
switch(this.szShapeType){case "line":if(!d.getAttributeNS(szMapNs,"save-style")){var r=d.getAttributeNS(null,"style");r&&r.match(/stroke:\s*[^;n]/)&&!r.match(/stroke:\s*none/)?d.setAttributeNS(szMapNs,"save-style","none"):r?d.setAttributeNS(szMapNs,"save-style",r):d.setAttributeNS(szMapNs,"save-style","none")}d.setAttributeNS(null,"style","fill:none;stroke:"+a+";"+this.szStyle);break;case "line+buffer":r=d.getAttributeNS(null,"id");if(!r.match(":paint")){var n=map.SVGDocument.getElementById(r+":paint");
n||(n=d.cloneNode(1E3),d.parentNode.insertBefore(n,d),n.setAttributeNS(null,"id",r+":paint"));d=n}r=4;if(this.nBufferSize)if(this.nBufferSize.match(/\$value\$/)){g=this.nBufferSize.split("$value$");n="";for(var v=0;v<g.length;v++)n+=g[v],v<g.length-1&&(n+="nValue");try{/^[0-9+\-*/().\s]*$/.test(n)?r=(new Function("return "+n))():console.warn("Unsafe expression in nBufferSize evaluation: "+n)}catch(c){console.error("Error evaluating stroke width: "+c.message)}}else r=this.nBufferSize.match(/value/)?
100/(this.nMin+1E-9)*(this.nMax-this.nMin)>1E3?6+Math.log(g/this.nMax):10*g/(this.nMax-this.nMin):this.nBufferSize;r*=Math.log(1+1/__featureScaling_lastScale);d.setAttributeNS(null,"style","stroke:"+a+";stroke-width:"+map.Scale.normalX(r)*map.Scale.nZoomScale+";"+this.szStyle+";stroke-linecap:butt;");break;default:d.setAttributeNS(null,"style","fill:"+a+";"+this.szStyle)}d.setAttributeNS(szMapNs,"class",b);return d};A.prototype.unPaintShape=function(d){if(this.szShapeType=="line+buffer"){var a=d.getAttributeNS(null,
"id");(a=map.SVGDocument.getElementById(a+":paint"))&&a.parentNode.removeChild(a)}(a=d.getAttributeNS(szMapNs,"save-style"))?a=="none"||a.match(/stroke:\s*none/i)?this.szShapeType=="line"?d.setAttributeNS(null,"style","stroke:none;"):d.removeAttributeNS(null,"style"):d.setAttributeNS(null,"style",a):(a=d.getAttributeNS(null,"style"))&&a.match(/stroke:\s*[^;n]/)&&!a.match(/stroke:\s*none/i)?this.szShapeType=="line"?d.setAttributeNS(null,"style","stroke:none;"):d.removeAttributeNS(null,"style"):d.removeAttributeNS(null,
"style");d.removeAttributeNS(szMapNs,"class")};A.prototype.zoomToClass=function(d,a){var g=0;if(this.szFlag.match(/DOMINANT/))for(var b in this.itemA)this.itemA[b].nClass==d&&g++;else g=this.partsA[d].nCount;if(g===0)displayMessage("No members !");else{var r;if(this.szFlag.match(/CHART/))for(b=this.chartGroup.childNodes,r=0;r<b.length;r++)if(g=b.item(r),g.getAttributeNS(szMapNs,"class")==null||g.getAttributeNS(szMapNs,"class")===""){g=g.firstChild.childNodes;for(var n=0;n<g.length;n++)g.item(n).getAttributeNS(szMapNs,
"class")}else g.getAttributeNS(szMapNs,"class");else if(this.szFlag.match(/DOMINANT/))for(b in this.itemA)if(this.itemA[b].nClass==d&&this.evidenceMode=="highlight")for(a=this.getItemNodes(b),r=0;r<a.length;r++);else{if(this.itemA[b].nClass!=d&&this.evidenceMode!="highlight")for(a=this.getItemNodes(b),r=0;r<a.length;r++);}else{g=new point(1E5,1E5);n=new point(-1E5,-1E5);var v=this.partsA[d].min,c=this.partsA[d].max;for(r=1;r<a;r++)v=Math.min(v,this.partsA[d+r].min),c=Math.max(c,this.partsA[d+r].max);
this.szFlag.match(/CATEGORICAL/)&&(v++,c++);for(b in this.itemA)if(this.itemA[b].nValuesA[0]>v&&this.itemA[b].nValuesA[0]<c)for(a=this.getItemNodes(b),r=0;r<a.length;r++){d=map.Dom.getBox(a[r]);if(d.width===0||d.height===0){var e=getMatrix(a[r]);d.x+=e[4];d.y+=e[5];d.width=map.Scale.viewBox.width/20;d.height=map.Scale.viewBox.height/20;d.x-=d.width/2;d.y-=d.height/2}e=map.Scale.getMapOffset(a[r]);d.x+=e.x;d.y+=e.y;g.x=Math.min(g.x,d.x);g.y=Math.min(g.y,d.y);n.x=Math.max(n.x,d.x+d.width);n.y=Math.max(n.y,
d.y+d.height)}b=new box(g.x,g.y,n.x-g.x,n.y-g.y);b.scale(1.2);b=map.Zoom.clipArea(b);map.Zoom.setNewArea(b)}}};A.prototype.markClass=function(d,a){if(this.fMarkEnable!==!1)if(map.Themes.enableSubThemes&&this.szFlag.match(/DOMINANT|COMPOSE/)&&!this.szFlag.match(/CHART/))this.szFlag.match(/SUBTHEME/)||this.createSubTheme(d);else if(isNaN(d))displayMessage("no class!");else{var g=this.szItemFilter&&this.szItemFilter.length;if(!this.szFlag.match(/CHART/)||g)this.fUnmarkEnable=!0,this.unmarkClass(),this.fUnmarkEnable=
!1;if(this.fMarkEnable!==!1){var b=0;if(this.szFlag.match(/DOMINANT/)&&!this.szFlag.match(/CHART/))for(var r in this.itemA)this.itemA[r].nClass==d&&b++;else b=this.partsA.length==1&&this.szFlag.match(/DOPACITY/)?99:this.partsA[d]?this.partsA[d].nCount:0;if(b>500&&this.evidenceMode=="highlight")displayMessage("Sorry ! to many members");else if(b===0)displayMessage("class has no members !",3E3);else{clearMessage();map.highLightList.removeAll();b=0;for(v in this.markedClasses)b++;v=null;var n=(this.fShadow?
5:10)/this.nScale;if(this.szFlag.match(/CHART/)){r=this.chartGroup.childNodes;d=[];for(var v=0;v<r.length;v++)if(a=r.item(v),a.getAttributeNS(szMapNs,"class")==null||a.getAttributeNS(szMapNs,"class")==="")for(var c=a.getElementsByTagName("g"),e=0;e<c.length;e++)for(var f=c.item(e).childNodes,m=0;m<f.length;m++){var l=f.item(m);if(l.getAttributeNS&&l.getAttributeNS(szMapNs,"class")){if(this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/PLOT/)&&this.evidenceMode!="isolate_gray"){var h=l.getAttributeNS(null,
"transform");h&&h.length&&(l.setAttributeNS(szMapNs,"orig-transform",h),l.setAttributeNS(null,"transform",""))}h=Number(l.getAttributeNS(szMapNs,"class"));if(this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(this.szFieldsA.length>1||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/CATEGORICAL/)))this.markedClasses[h]===!0?(l.setAttributeNS(null,"transform","matrix(1 0 0 1 -10 6.6)"),l.style.setProperty("fill-opacity","1","")):(l.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),
l.style.setProperty("fill-opacity","0.85",""));else if(this.markedClasses[h]===!0){if(!g){l.style.setProperty("display","inline","");l.getAttributeNS(szMapNs,"save-style")&&l.setAttributeNS(null,"style",l.getAttributeNS(szMapNs,"save-style"));if(this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/PLOT/)&&this.evidenceMode!="isolate_gray"&&(h=l.getAttributeNS(szMapNs,"orig-transform"))&&h.length){var p=l.nodeName&&l.nodeName.toLowerCase()||l.tagName&&l.tagName.toLowerCase()||"",B=null;l.getAttributeNS&&
(B=l.getAttributeNS("http://www.w3.org/1999/xlink","href"));if((p==="use"||B&&B.length&&B.length>0)&&b>1)l.setAttributeNS(null,"transform",h);else if(p=/matrix\(([0-9., -e]*)\)/,h=h.match(/matrix\(([^,]*)\)/)||h.match(p))h=h[1].split(/[\s,]+/),h.length>=4&&l.setAttributeNS(null,"transform","matrix("+(Number(h[0])||1)+" 0 0 "+(Number(h[3])||1)+" 0 0)")}d.push(a)}}else this.evidenceMode=="isolate_gray"?(l.getAttributeNS(szMapNs,"save-style")||l.setAttributeNS(szMapNs,"save-style",l.getAttributeNS(null,
"style")),l.style.setProperty("fill","#bbbbbb",""),l.style.getPropertyValue("stroke")!="none"&&l.style.setProperty("stroke","#888888",""),h=l.style.getPropertyValue("fill-opacity"),this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/WAFFLE/)?(l.style.setProperty("fill-opacity","0",""),l.style.setProperty("stroke-opacity",String(h*.9),""),l.style.setProperty("stroke-width",String(n),"")):l.style.setProperty("fill-opacity","0","")):l.style.setProperty("display","none","")}}else h=Number(a.getAttributeNS(szMapNs,
"class")),this.markedClasses[h]===!0?g||(this.szFlag.match(/VECTOR/)?(a.firstChild.style.setProperty("stroke","",""),a.firstChild.style.setProperty("stroke-opacity","",""),a.firstChild.style.setProperty("marker-end","",""),a.style.setProperty("display","inline","")):(a.style.setProperty("display","inline",""),(h=a.getAttributeNS(szMapNs,"fill"))&&a.style.setProperty("fill",h,"")),d.push(a)):this.evidenceMode=="isolate_gray"?this.szFlag.match(/VECTOR/)?(a.firstChild.style.setProperty("stroke","#888888",
""),a.firstChild.style.setProperty("stroke-opacity","0.5",""),a.firstChild.style.setProperty("marker-end","none","")):(a.setAttributeNS(szMapNs,"fill",a.style.getPropertyValue("fill")),a.style.setProperty("fill","#bbbbbb",""),a.setAttributeNS(szMapNs,"stroke",a.style.getPropertyValue("fill")),a.style.setProperty("stroke","#888888",""),a.setAttributeNS(szMapNs,"fill-opacity",a.style.getPropertyValue("fill-opacity")),a.style.setProperty("fill-opacity","0.05","")):a.style.setProperty("display","none",
"");d.forEach(function(C){C.parentNode.appendChild(C)})}else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(r in this.itemA)if(this.itemA[r].nClass==d&&this.evidenceMode=="highlight")for(v=this.getItemNodes(r),g=0;g<v.length;g++)map.highLightList.addItem(v[g]);else{if(this.itemA[r].nClass!=d&&this.evidenceMode!="highlight")for(v=this.getItemNodes(r),g=0;g<v.length;g++)v[g].setAttributeNS(szMapNs,"themestyle",v[g].getAttributeNS(null,"style")),v[g].style.setProperty("display","none","")}else{for(v=
1;v<a;v++);for(r in this.itemA)if(g=!1,this.markedClasses&&this.markedClasses[this.itemA[r].nClass]&&(g=!0),g){if(this.evidenceMode=="highlight")for(v=this.getItemNodes(r),g=0;g<v.length;g++)map.highLightList.addItem(v[g])}else if(this.evidenceMode!="highlight")for(v=this.getItemNodes(r),g=0;g<v.length;g++)if(this.szFlag.match(/BUFFER/))(b=map.SVGDocument.getElementById(v[g].getAttributeNS(null,"id")+":paint"))&&b.style.setProperty("display","none","");else{v[g].setAttributeNS(szMapNs,"themestyle",
v[g].getAttributeNS(null,"style"));v[g].setAttributeNS(null,"style",v[g].getAttributeNS(szMapNs,"origthemestyle"));n=v[g].getAttribute("id");v[g].firstChild&&v[g].firstChild.nextSibling&&(n=v[g].firstChild.nextSibling.getAttribute("id")||n);if(b=map.SVGDocument.getElementById(n+"L"))b.setAttributeNS(szMapNs,"display",b.style.getPropertyValue("display")),b.style.setProperty("display","none","");if(b=map.SVGDocument.getElementById(n+"L:bg"))b.setAttributeNS(szMapNs,"display",b.style.getPropertyValue("display")),
b.style.setProperty("display","none","");if(b=map.SVGDocument.getElementById(n+":::value"))b.setAttributeNS(szMapNs,"display",b.style.getPropertyValue("display")),b.style.setProperty("display","none","");if(b=map.SVGDocument.getElementById(n+":::value:bg"))b.setAttributeNS(szMapNs,"display",b.style.getPropertyValue("display")),b.style.setProperty("display","none","")}}this.endDraw();this.fMarkClass=!0}}}}};A.prototype.unmarkClass=function(d){if(this.fUnmarkEnable!==!1)if(this.subTheme)this.removeSubTheme();
else if(this.szItemFilter&&this.szItemFilter.length)this.fMarkEnable=!0,this.filterItems(this.szItemFilter,this.itemFilterOpt);else if(clearMessage(),this.szFlag.match(/CHART/)){var a=this.chartGroup.childNodes;for(d=0;d<a.length;d++){var g=a.item(d);if(g.getAttributeNS(szMapNs,"class")==null||g.getAttributeNS(szMapNs,"class")===""){g=g.getElementsByTagName("g");for(var b=0;b<g.length;b++)for(var r=g.item(b).childNodes,n=0;n<r.length;n++){var v=r.item(n);if(v.getAttributeNS&&v.getAttributeNS(szMapNs,
"class")){if(this.szFlag.match(/SEQUENCE/)){var c=v.getAttributeNS(szMapNs,"orig-transform");c&&c.length&&(v.removeAttributeNS(szMapNs,"orig-transform"),v.setAttributeNS(null,"transform",c))}this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(v.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),v.style.setProperty("fill-opacity","1",""));v.style&&(v.style.setProperty("display","inline",""),v.getAttributeNS(szMapNs,"save-style")&&v.setAttributeNS(null,"style",v.getAttributeNS(szMapNs,
"save-style")))}}}else this.szFlag.match(/VECTOR/)&&(g.firstChild.style.setProperty("stroke","",""),g.firstChild.style.setProperty("stroke-opacity","",""),g.firstChild.style.setProperty("marker-end","","")),g.style.setProperty("display","inline","")}this.szFlag.match(/TEXTONLY/)&&setTimeout(function(){map.Layer.adaptLabel()},10)}else{this.beginDraw();if(this.evidenceMode!="highlight")for(a in this.itemA)for(d=this.getItemNodes(a),g=0;g<d.length;g++)this.szFlag.match(/BUFFER/)?(b=map.SVGDocument.getElementById(d[g].getAttributeNS(null,
"id")+":paint"))&&b.style.setProperty("display","inline",""):(b=d[g].getAttributeNS(szMapNs,"themestyle"))&&b.length&&b!="null"&&(d[g].setAttributeNS(null,"style",b),d[g].removeAttributeNS(szMapNs,"themestyle"),r=d[g].getAttribute("id"),d[g].firstChild&&d[g].firstChild.nextSibling&&(r=d[g].firstChild.nextSibling.getAttribute("id")||r),(b=map.SVGDocument.getElementById(r+"L"))&&b.style.setProperty("display",b.getAttributeNS(szMapNs,"display"),""),(b=map.SVGDocument.getElementById(r+"L:bg"))&&b.style.setProperty("display",
b.getAttributeNS(szMapNs,"display"),""),(b=map.SVGDocument.getElementById(r+":::value"))&&b.style.setProperty("display",b.getAttributeNS(szMapNs,"display"),""),(b=map.SVGDocument.getElementById(r+":::value:bg"))&&b.style.setProperty("display",b.getAttributeNS(szMapNs,"display"),""));else map.highLightList.removeAll();this.endDraw();this.fMarkClass=!1}};A.prototype.showClass=function(d,a,g){var b=0;if(this.szFlag.match(/DOMINANT/))for(var r in this.itemA)this.itemA[r].nClass==d&&b++;clearMessage();
var n;b=g?"inline":"none";if(this.szFlag.match(/CHART/))for(g=this.chartGroup.childNodes,n=0;n<g.length;n++){var v=g.item(n);if(v.getAttributeNS(szMapNs,"class")==null||v.getAttributeNS(szMapNs,"class")===""){v=v.firstChild.childNodes;for(var c=0;c<v.length;c++)a=v.item(c),r=Number(a.getAttributeNS(szMapNs,"class")),r==d&&a.style.setProperty("display",b,"")}else r=Number(v.getAttributeNS(szMapNs,"class")),r==d&&v.style.setProperty("display",b,"")}else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(r in this.itemA){if(this.itemA[r].nClass==
d)for(a=this.getItemNodes(r),n=0;n<a.length;n++)a[n].setAttributeNS(szMapNs,"themestyle",a[n].getAttributeNS(null,"style")),a[n].style.setProperty("display",b,"")}else{v=this.partsA[d].min;c=this.partsA[d].max;for(n=1;n<a;n++)v=Math.min(v,this.partsA[d+n].min),c=Math.max(c,this.partsA[d+n].max);this.szFlag.match(/CATEGORICAL/)&&(v++,c++);for(r in this.itemA)if(this.szFlag.match(/CATEGORICAL/)&&this.itemA[r].nValuesA[0]==v||this.itemA[r].nValuesA[0]>v&&this.itemA[r].nValuesA[0]<c)for(a=this.getItemNodes(r),
n=0;n<a.length;n++)this.szFlag.match(/BUFFER/)?(d=map.SVGDocument.getElementById(a[n].getAttributeNS(null,"id")+":paint"))&&d.style.setProperty("display",b,""):g?(d=a[n].getAttributeNS(szMapNs,"themestyle"))&&d.length&&d!="null"&&(a[n].setAttributeNS(null,"style",d),a[n].removeAttributeNS(szMapNs,"themestyle")):(a[n].setAttributeNS(szMapNs,"themestyle",a[n].getAttributeNS(null,"style")),a[n].setAttributeNS(null,"style",a[n].getAttributeNS(szMapNs,"origthemestyle")))}this.endDraw()}};A.prototype.setTimeFrame=
function(d,a){clearMessage();map.highLightList.removeAll();var g=this.szItemFilter&&this.szItemFilter.length,b=(this.fShadow?5:10)/this.nScale,r=this.chartGroup.childNodes;this.szFlag.match(/CHART/)&&(r=this.chartGroup.parentNode.childNodes);for(var n=[],v=0;v<r.length;v++){var c=r.item(v);if(c.getAttributeNS(szMapNs,"time")==null||c.getAttributeNS(szMapNs,"time")==="")for(var e=c.getElementsByTagName("g"),f=0;f<e.length;f++)for(var m=e.item(f).childNodes,l=0;l<m.length;l++){var h=m.item(l);if(h.getAttributeNS&&
h.getAttributeNS(szMapNs,"time")){var p=Number(h.getAttributeNS(szMapNs,"time"));this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(this.szFieldsA.length>1||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/CATEGORICAL/))?p>=d&&p<=a?(h.setAttributeNS(null,"transform","matrix(1 0 0 1 -10 6.6)"),h.style.setProperty("fill-opacity","1","")):(h.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),h.style.setProperty("fill-opacity","0.85","")):p>=d&&p<=a?g||(h.style.setProperty("display",
"inline",""),h.getAttributeNS(szMapNs,"save-style")&&h.setAttributeNS(null,"style",h.getAttributeNS(szMapNs,"save-style")),n.push(c)):this.evidenceMode=="isolate_gray"?(h.getAttributeNS(szMapNs,"save-style")||h.setAttributeNS(szMapNs,"save-style",h.getAttributeNS(null,"style")),h.style.setProperty("fill","#bbbbbb",""),h.style.getPropertyValue("stroke")!="none"&&h.style.setProperty("stroke","#888888",""),p=h.style.getPropertyValue("fill-opacity"),this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/WAFFLE/)?
(h.style.setProperty("fill-opacity","0",""),h.style.setProperty("stroke-opacity",String(p*.9),""),h.style.setProperty("stroke-width",String(b),"")):h.style.setProperty("fill-opacity","0","")):h.style.setProperty("display","none","")}}else if(p=Number(c.getAttributeNS(szMapNs,"time")),p>=d&&p<=a){if(!g){if(this.szFlag.match(/VECTOR/))c.firstChild.style.setProperty("stroke","",""),c.firstChild.style.setProperty("stroke-opacity","",""),c.firstChild.style.setProperty("marker-end","",""),c.style.setProperty("display",
"inline","");else{c.style.setProperty("display","inline","");var B;(B=c.getAttributeNS(szMapNs,"fill"))&&c.style.setProperty("fill",B,"")}n.push(c)}}else this.evidenceMode=="isolate_gray"?this.szFlag.match(/VECTOR/)?(c.firstChild.style.setProperty("stroke","#888888",""),c.firstChild.style.setProperty("stroke-opacity","0.5",""),c.firstChild.style.setProperty("marker-end","none","")):(c.setAttributeNS(szMapNs,"fill",c.style.getPropertyValue("fill")),c.style.setProperty("fill","#bbbbbb",""),c.setAttributeNS(szMapNs,
"stroke",c.style.getPropertyValue("fill")),c.style.setProperty("stroke","#888888",""),c.setAttributeNS(szMapNs,"fill-opacity",c.style.getPropertyValue("fill-opacity")),c.style.setProperty("fill-opacity","0.05","")):c.style.setProperty("display","none","")}n.forEach(function(C){C.parentNode.appendChild(C)})};A.prototype.createSubTheme=function(d){this.subTheme&&this.removeSubTheme();if(d!=null||this.markedClasses&&this.markedClasses.length){var a="";this.coTable&&typeof this.coTable!="undefined"&&
(a+="dbtable:"+this.coTable+";");this.szSelectionField&&typeof this.szSelectionField!="undefined"&&(a+="lookupfield:"+this.szSelectionField+";");this.szAlphaField&&typeof this.szAlphaField!="undefined"&&(a+="alphafield:"+this.szAlphaField+";");this.szAlphaField100&&typeof this.szAlphaField100!="undefined"&&(a+="alphafield100:"+this.szAlphaField100+";");this.szTitleField&&typeof this.szTitleField!="undefined"&&(a+="titlefield:"+this.szTitleField+";");this.nDopacityScale&&typeof this.nDopacityScale!=
"undefined"&&(a+="dopacityscale:"+this.nDopacityScale+";");this.nDopacityPow&&typeof this.nDopacityPow!="undefined"&&(a+="dopacitypow:"+this.nDopacityPow+";");var g="lookuptoupper:"+(this.fSelectionFieldToUpper||null)+";";g+="lookupsuffix:"+(this.szSelectionFieldSuffix||null)+";";g+="lookupprefix:"+(this.szSelectionFieldPrefix||null)+";";g+="lookupdigits:"+(Number(this.nSelectionFieldDigits)||null)+";";g+="lookuptonumber:"+(this.fSelectionFieldToNumber||null)+";";g+="lookuptoupper:"+(this.fSelectionFieldToUpper||
null)+";";a+=g;this.szAggregationField&&typeof this.szAggregationField!="undefined"&&(a+="aggregationfield:"+this.szAggregationField+";");this.szUnits&&typeof this.szUnits!="undefined"&&(a+="units:"+this.szUnits+";");var b="";this.szFlag.match(/DOPACITY/)&&(b+="DOPACITYMAX|");this.szFlag.match(/AGGREGATE/)&&(b+="AGGREGATE|");this.szFlag.match(/GROUP/)&&(b+="GROUP|");this.szFlag.match(/SUM/)&&(b+="SUM|");this.szFlag.match(/ZEROISVALUE/)&&(b+="ZEROISVALUE|");this.szFlag.match(/VALUES/)&&(b+="VALUES|");
map.Themes.enableMultiChoropleth=!0;if(this.szFlag.match(/CATEGORICAL/)&&this.szFlag.match(/AGGREGATE/)&&this.szLabelA){var r=[],n=[];for(g=0;g<this.markedClassesA.length;g++)r.push(this.szLabelA[this.markedClassesA[g]]),n.push(this.colorScheme[this.markedClassesA[g]]);this.markedClassesA&&this.markedClassesA.length>1?(a=this.getDefinitionObject(),a.style.type+="|NOINFO",a.style.values=r,a.style.colorscheme=n,this.subTheme=map.Themes.newThemeByObj(a)):(a+='filter:WHERE "'+this.szFields+'" IN "('+
r.join(",")+')";',this.subTheme=map.Themes.newTheme(this.szThemes,this.szFields,this.szField100,"type:CHOROPLETH|CATEGORICAL|NOINFO|NOLEGEND|SUBTHEME|"+b+";colorscheme:7|white|"+this.colorScheme[d]+";"+a,this.szLabelA[d],""),this.subTheme.parentTheme=this)}else if(this.markedClassesA&&this.markedClassesA.length>1){d=this.szFields.split("|");b=n=r="";for(g=0;g<this.markedClassesA.length;g++)r+=(r.length?"|":"")+d[this.markedClassesA[g]],n+=(n.length?"|":"")+this.colorScheme[this.markedClassesA[g]],
b+=(b.length?"|":"")+this.szLabelA[this.markedClassesA[g]];this.subTheme=map.Themes.newTheme(this.szThemes,r,this.szField100,"type:"+this.szFlag+"|SUBTHEME|NOINFO;colorscheme:"+n+";label:"+b+";"+a)}else d=this.markedClassesA[0]||d,this.subTheme=map.Themes.newTheme(this.szThemes,this.szFields.split("|")[d],this.szField100,"type:CHOROPLETH|LOG|DOPACITY|NOINFO|NOLEGEND|SUBTHEME|"+b+";colorscheme:7|white|"+this.colorScheme[d]+";"+a+";alphafield:null;alphafield100:null;dopacitypow:1;dopacityscale:2;",
this.szLabelA?this.szLabelA[d]:"","");this.subTheme.szTitle=map.Dictionary.getLocalText("actual selection");map.Themes.subTheme=this}};A.prototype.removeSubTheme=function(){map.Themes.enableMultiChoropleth=!1;this.subTheme&&(map.Themes.subTheme=!1,map.Themes.removeTheme(null,this.subTheme.szId),this.subTheme=null,map.Themes.realizeDone(this))};A.prototype.isItemInFilter=function(d,a,g,b){if(g.length===0&&(typeof b=="undefined"||!b.field))return!0;if(typeof a.dbIndex!="undefined"||typeof a.dbIndexA!=
"undefined")if(a=a.dbIndex||a.dbIndexA[0],g.length){if(this.__szValue=d.dbRecords[a].join(" "),Aa(this.__szValue,g,!1))return!0}else if(b&&b.field){for(g=0;g<d.dbFields.length;g++)if(d.dbFields[g].id==b.field&&(b.min&&d.dbRecords[a][g]<b.min||b.max&&d.dbRecords[a][g]>b.max||b.txt&&d.dbRecords[a][g]!=b.txt))return!1;return!0}return!1};A.prototype.filterItems=function(d,a){if(this.fMarkEnable!==!1){this.szItemFilter=d;this.itemFilterOpt=a;this.filterNodesA=d.length||a&&a.field?[]:null;for(var g=null,
b=0;b<this.szThemesA.length&&(!(g=this.objThemesA[this.szThemesA[b]])||!g.dbRecords);b++);if(g&&g.dbRecords){if(this.szFlag.match(/CHART/)){var r=this.chartGroup.childNodes;for(b=0;b<r.length;b++){var n=[],v=r.item(b);n.push(v);for(var c=0;c<n.length;c++){var e=n[c].getAttributeNS(null,"id");e=e.split(":")[1]+"::"+e.split(":")[3];this.itemA[e]?this.isItemInFilter(g,this.itemA[e],d,a)?(v.style.setProperty("display","inline",""),this.filterNodesA&&this.filterNodesA.push(e)):v.style.setProperty("display",
"none",""):v.style.setProperty("display","inline","")}}}else{this.beginDraw();for(r in this.itemA)if(this.itemA[r]&&typeof this.itemA[r].dbIndex!="undefined")if(this.isItemInFilter(g,this.itemA[r],d,a))for(this.filterNodesA&&this.filterNodesA.push(r),b=this.getItemNodes(r),n=0;n<b.length;n++)this.szFlag.match(/BUFFER/)?(v=map.SVGDocument.getElementById(b[n].getAttributeNS(null,"id")+":paint"))&&v.style.setProperty("display","inline",""):(v=b[n].getAttributeNS(szMapNs,"themestyle"))&&v.length&&v!=
"null"&&(b[n].setAttributeNS(null,"style",v),b[n].removeAttributeNS(szMapNs,"themestyle"),(v=map.SVGDocument.getElementById(b[n].firstChild.nextSibling.getAttribute("id")+"L"))&&v.style.setProperty("display",v.getAttributeNS(szMapNs,"display"),""),(v=map.SVGDocument.getElementById(b[n].firstChild.nextSibling.getAttribute("id")+"L:bg"))&&v.style.setProperty("display",v.getAttributeNS(szMapNs,"display"),""));else for(b=this.getItemNodes(r),n=0;n<b.length;n++)if(this.szFlag.match(/BUFFER/))(v=map.SVGDocument.getElementById(b[n].getAttributeNS(null,
"id")+":paint"))&&v.style.setProperty("display","none","");else{b[n].getAttributeNS(szMapNs,"themestyle")||b[n].setAttributeNS(szMapNs,"themestyle",b[n].getAttributeNS(null,"style"));b[n].setAttributeNS(null,"style",b[n].getAttributeNS(szMapNs,"origthemestyle"));if(v=map.SVGDocument.getElementById(b[n].firstChild.nextSibling.getAttribute("id")+"L"))v.setAttributeNS(szMapNs,"display",v.style.getPropertyValue("display")),v.style.setProperty("display","none","");if(v=map.SVGDocument.getElementById(b[n].firstChild.nextSibling.getAttribute("id")+
"L:bg"))v.setAttributeNS(szMapNs,"display",v.style.getPropertyValue("display")),v.style.setProperty("display","none","")}this.endDraw()}this.fMarkClass=!0}}};A.prototype.selectFilterItems=function(){map.Selections.newSelection("generic",this.filterNodesA,"type:queryresult",this.szItemFilter)};A.prototype.highlightItems=function(d,a){if(d==="")this.clearHighlightItems();else{map.highLightList.removeAll();var g=this;d.split(a||",").forEach(function(b){if(g.szFlag.match(/CHART/)){var r=map.SVGDocument.getElementById(g.szId+
":"+b+":chartgroup");r||(b=g.szThemesA[0]+"::"+b,r=map.SVGDocument.getElementById(g.szId+":"+b+":chartgroup"));map.highLightList.addItem(r.parentNode,"isolate");map.displayInfo(null,r.firstChild,"add|fix")}else{b=g.getItemNodes(b);for(r=0;r<b.length;r++)map.highLightList.addItem(b[r]);map.displayInfo(null,b[0].firstChild.nextSibling,"add|fix")}})}};A.prototype.clearHighlightItems=function(){map.highLightList.removeAll();map.removeInfo()};A.prototype.labelMap=function(d){var a=map.Zoom.getBox(),g=
null;this.szValuesTextStyle="font-family:verdana;font-size:"+map.Scale.normalX(11)+"px;pointer-events:none";if(!d||d===0){var b=0;d=0;this.indexA=[];var r=0,n=0;if(this.fClipCharts)for(b in this.itemA){if(n++,this.itemA[b].nValuesA&&this.itemA[b].nValuesA.length>0&&(g=this.getNodePosition(this.itemA[b].szSelectionId)))if(g.x<a.x||g.x>a.x+a.width||g.y<a.y||g.y>a.y+a.height){if(this.nSkipCount++,g=map.SVGDocument.getElementById(this.szId+":"+b+":chart"))g.parentNode.removeChild(g),this.chartPosA[this.itemA[b].szSelectionId]=
null,this.posItemA[this.itemA[b].szSelectionId]=null}else this.indexA[this.indexA.length]=b,r++}else for(b in this.itemA)this.indexA[this.indexA.length]=b,n++,r++;r>this.nMaxThemeCharts&&(this.indexA.length=0,this.nSkipCount=r);this.mapSleep&&(this.mapSleep.nCount=r);this.fEnableProgressBar=!1}for(;d<this.indexA.length;d++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);this.fCancel=!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(d,10))){this.fContinue=
!0;this.continueIndex=d;return}b=this.indexA[d];this.nDoneCount++;if(this.itemA[b].nValuesA&&this.itemA[b].nValuesA.length>0)if(g=this.getNodePosition(this.itemA[b].szSelectionId))if(this.fClipCharts&&!this.szFlag.match(/BUFFER/)&&(g.x<a.x||g.x>a.x+a.width||g.y<a.y||g.y>a.y+a.height))this.nSkipCount++;else for(g=this.getItemNodes(b),r=0;r<g.length;r++)n=this.itemA[b].nValue,!this.szValueField&&this.itemA[b].szLabel&&(n=this.itemA[b].szLabel),this.labelShape(g[r],this.itemA[b].szColor,n);else this.nMissingPositionCount++}this.fMakeLabel=
!1;setTimeout(function(){map.Layer.adaptLabel(null)},10)};A.prototype.unlabelMap=function(){for(var d in map.Layer.generatedLabelA)map.Dom.removeElementById(d),map.Layer.generatedLabelA[d]=null};A.prototype.labelShape=function(d,a,g){if(this.szFlag.match(/VALUES/)&&g!="undefined"&&typeof g!="undefined"&&(!this.szFlag.match(/NOZERO/)||g!==0)){var b=d.parentNode.getAttributeNS(null,"id"),r=map.SVGDocument.getElementById(b+":label");if(r){var n=map.SVGDocument.getElementById(b+":values:bg");n||(n=map.Dom.newGroup(r.parentNode,
b+":values:bg"),map.Layer.generatedLabelA[b+":values:bg"]=n);var v=map.SVGDocument.getElementById(b+":values");v||(v=map.Dom.newGroup(r.parentNode,b+":values"),map.Layer.generatedLabelA[b+":values"]=v);try{var c=d.firstChild.nextSibling.getAttributeNS(null,"id").split("#"),e=c[0]+"L"+(c[1]?"#"+c[1]:"")}catch(m){e=d.getAttributeNS(null,"id")+":::value"}if(!map.SVGDocument.getElementById(e)){r=O(a);a=typeof g=="string"?g:this.formatValue(g,this.nValueDecimals||0)+(this.szUnit.match(/%/)?"%":"");b=this.szTextColor||
r.highColor;c=r.lowColor;var f=1;r=Math.max(.3,d.style.getPropertyValue("fill-opacity")||"1");this.szFlag.match(/DTEXT/)&&(f=Math.max(.7,Math.min(1.5,2/Math.sqrt(this.nMax)*Math.sqrt(g))));g=map.Scale.normalX(11)*map.Scale.nZoomScale*f*map.Scale.nLabelScaling*(this.nLabelScale||1);n=map.Dom.newText(n,0,0,"font-family:verdana;font-weight:normal;font-size:"+g+"px;text-anchor:middle;fill:none;stroke:"+c+";stroke-width:"+map.Scale.normalX(4)*map.Scale.nZoomScale+";stroke-opacity:0.5;pointer-events:none;display:none;stroke-linejoin:bevel;",
a);v=map.Dom.newText(v,0,0,"font-family:verdana;font-weight:normal;font-size:"+g+"px;text-anchor:middle;fill:"+b+";stroke:none;pointer-events:none;display:none;",a);v.setAttributeNS(null,"id",e);n.setAttributeNS(null,"id",e+":bg");this.szFlag.match(/DOPACITY/)&&(v.style.setProperty("fill-opacity",r,""),n.style.setProperty("stroke-opacity",r*.3,""));(e=d.getAttributeNS(szMapNs,"center"))?(d=e.split(","),d=new point(Number(d[0].split(":")[1]),Number(d[1].split(":")[1]))):d=this.getNodePosition(d.getAttributeNS(null,
"id"));d&&(v.fu.setPosition(d.x,d.y),n.fu.setPosition(d.x,d.y))}}}};A.prototype.zoomTo=function(){var d=new point(1E5,1E5),a=new point(-1E5,-1E5),g=0;if(this.szFlag.match(/FEATURE/)){d.x=1E5;d.y=1E5;a.x=-1E5;a.y=-1E5;g=0;var b=90,r=-90,n=180,v=-180,c=!1;if(this.itemA&&Object.keys(this.itemA).length>0&&this.objTheme&&this.objTheme.dbRecords){for(var e in this.itemA){var f=this.itemA[e];if(f.dbIndex!==void 0&&this.objTheme.dbRecords[f.dbIndex]){var m=this.objTheme.dbRecords[f.dbIndex],l=this.objTheme.nFieldSelectionIndex;
if(l!==void 0&&m[l]&&(m=m[l],typeof m==="string"&&m.match(/coordinates/i)))try{var h=aa(m);if(h&&h.coordinates){var p=function(Y,M){if(M==="Point")return{minLon:Y[0],maxLon:Y[0],minLat:Y[1],maxLat:Y[1]};if(M==="LineString"||M==="MultiPoint"){var w=180,J=-180,L=90,G=-90;for(M=0;M<Y.length;M++){var F=Y[M][0],V=Y[M][1];w=Math.min(w,F);J=Math.max(J,F);L=Math.min(L,V);G=Math.max(G,V)}return{minLon:w,maxLon:J,minLat:L,maxLat:G}}if(M==="Polygon"){w=180;J=-180;L=90;G=-90;for(var la=0;la<Y.length;la++)for(M=
0;M<Y[la].length;M++)F=Y[la][M][0],V=Y[la][M][1],w=Math.min(w,F),J=Math.max(J,F),L=Math.min(L,V),G=Math.max(G,V);return{minLon:w,maxLon:J,minLat:L,maxLat:G}}if(M==="MultiLineString"||M==="MultiPolygon"){w=180;J=-180;L=90;G=-90;for(F=0;F<Y.length;F++)V=p(Y[F],M==="MultiLineString"?"LineString":"Polygon"),w=Math.min(w,V.minLon),J=Math.max(J,V.maxLon),L=Math.min(L,V.minLat),G=Math.max(G,V.maxLat);return{minLon:w,maxLon:J,minLat:L,maxLat:G}}return null},B=p(h.coordinates,h.type);B&&(b=Math.min(b,B.minLat),
r=Math.max(r,B.maxLat),n=Math.min(n,B.minLon),v=Math.max(v,B.maxLon),c=!0,g++)}}catch(Y){}}}if(c&&g>0){map.Zoom.fExternalZoom=!0;map.Zoom.doSetMapToGeoBounds(b,n,r,v);setTimeout(function(){try{this.fRealize=!0,this.themeNodesPosA=[],map.Themes.actualize(2)}catch(Y){}}.bind(this),50);setTimeout(function(){try{if(map.HTMLWindow&&map.HTMLWindow.ixmaps&&map.HTMLWindow.ixmaps.htmlMap){var Y=map.HTMLWindow,M=map.fPendingNewGeoBounds;map.fPendingNewGeoBounds=!0;var w="htmlMap_setBounds([{lat: "+b+", lng: "+
n+"}, {lat: "+r+", lng: "+v+"}], true);";try{Y.eval(w)}catch(F){var J=Y.ixmaps.fInSVGSync;Y.ixmaps.fInSVGSync=!1;var L=new point(n,b),G=new point(v,r);Y.ixmaps.htmlgui_setCurrentEnvelopeByGeoBounds(L,G);Y.ixmaps.fInSVGSync=!0;setTimeout(function(){Y&&Y.ixmaps&&(Y.ixmaps.fInSVGSync=J)},100)}setTimeout(function(){map.fPendingNewGeoBounds=M;map.Zoom.fExternalZoom=!1},200)}else map.Zoom.fExternalZoom=!1}catch(F){map.Zoom.fExternalZoom=!1,map.fPendingNewGeoBounds!==void 0&&(map.fPendingNewGeoBounds=!1)}},
10);return}}if(g===0&&this.chartGroup&&this.chartGroup.childNodes){e=this.chartGroup.childNodes;for(var C=0;C<e.length;C++)l=e[C],l.nodeType===1&&(c=map.Dom.getBox(l))&&c.width>=0&&c.height>=0&&(l=map.Scale.getMapOffset(l),c.x+=l.x,c.y+=l.y,d.x=Math.min(d.x,c.x),d.y=Math.min(d.y,c.y),a.x=Math.max(a.x,c.x+c.width),a.y=Math.max(a.y,c.y+c.height),g++)}g>0&&d.x<a.x&&d.y<a.y&&d.x!==1E5&&a.x!==-1E5&&(d=new box(d.x,d.y,a.x-d.x,a.y-d.y),d.scale(1),d=map.Zoom.clipArea(d),d.width>0&&d.height>0&&map.Zoom.setNewArea(d))}else if(this.itemA&&
Object.keys(this.itemA).length!==0){if(this.szFlag.match(/CHART|BUBBLE/)&&!this.szFlag.match(/FEATURE/)){b=90;r=-90;n=180;v=-180;c=!1;var N=0;if(this.itemA&&Object.keys(this.itemA).length>0&&this.objTheme&&this.objTheme.dbRecords){l=null;if(this.objTheme.nFieldSelectionIndex!==void 0)l=this.objTheme.nFieldSelectionIndex;else if(this.objTheme.dbFields)for(C=0;C<this.objTheme.dbFields.length;C++)if(this.objTheme.dbFields[C].id&&this.objTheme.dbFields[C].id.toLowerCase().match(/geometry|geom|geo/)){l=
C;break}if(l!==null)for(e in this.itemA){f=this.itemA[e];C=[];if(f.dbIndexA&&Array.isArray(f.dbIndexA)&&f.dbIndexA.length>0)C=f.dbIndexA;else if(f.dbIndex!==void 0)C=[f.dbIndex];else continue;for(f=0;f<C.length;f++)if(m=C[f],this.objTheme.dbRecords[m]&&(m=this.objTheme.dbRecords[m],m[l]&&(m=m[l],typeof m==="string"&&m.match(/coordinates/i))))try{(h=aa(m))&&h.coordinates&&(p=function(Y,M){if(M==="Point")return{minLon:Y[0],maxLon:Y[0],minLat:Y[1],maxLat:Y[1]};if(M==="LineString"||M==="MultiPoint"){var w=
180,J=-180,L=90,G=-90;for(M=0;M<Y.length;M++){var F=Y[M][0],V=Y[M][1];w=Math.min(w,F);J=Math.max(J,F);L=Math.min(L,V);G=Math.max(G,V)}return{minLon:w,maxLon:J,minLat:L,maxLat:G}}if(M==="Polygon"){w=180;J=-180;L=90;G=-90;for(var la=0;la<Y.length;la++)for(M=0;M<Y[la].length;M++)F=Y[la][M][0],V=Y[la][M][1],w=Math.min(w,F),J=Math.max(J,F),L=Math.min(L,V),G=Math.max(G,V);return{minLon:w,maxLon:J,minLat:L,maxLat:G}}if(M==="MultiLineString"||M==="MultiPolygon"){w=180;J=-180;L=90;G=-90;for(F=0;F<Y.length;F++)V=
p(Y[F],M==="MultiLineString"?"LineString":"Polygon"),w=Math.min(w,V.minLon),J=Math.max(J,V.maxLon),L=Math.min(L,V.minLat),G=Math.max(G,V.maxLat);return{minLon:w,maxLon:J,minLat:L,maxLat:G}}return null},B=p(h.coordinates,h.type))&&(b=Math.min(b,B.minLat),r=Math.max(r,B.maxLat),n=Math.min(n,B.minLon),v=Math.max(v,B.maxLon),c=!0,N++)}catch(Y){}}}if(c&&N>0){map.Zoom.fExternalZoom=!0;map.Zoom.doSetMapToGeoBounds(b,n,r,v);setTimeout(function(){try{this.fRealize=!0,this.themeNodesPosA=[],map.Themes.actualize(2)}catch(Y){}}.bind(this),
50);setTimeout(function(){try{if(map.HTMLWindow&&map.HTMLWindow.ixmaps&&map.HTMLWindow.ixmaps.htmlMap){var Y=map.HTMLWindow,M=map.fPendingNewGeoBounds;map.fPendingNewGeoBounds=!0;var w="htmlMap_setBounds([{lat: "+b+", lng: "+n+"}, {lat: "+r+", lng: "+v+"}], true);";try{Y.eval(w)}catch(F){var J=Y.ixmaps.fInSVGSync;Y.ixmaps.fInSVGSync=!1;var L=new point(n,b),G=new point(v,r);Y.ixmaps.htmlgui_setCurrentEnvelopeByGeoBounds(L,G);Y.ixmaps.fInSVGSync=!0;setTimeout(function(){Y&&Y.ixmaps&&(Y.ixmaps.fInSVGSync=
J)},100)}setTimeout(function(){map.fPendingNewGeoBounds=M;map.Zoom.fExternalZoom=!1},200)}else map.Zoom.fExternalZoom=!1}catch(F){map.Zoom.fExternalZoom=!1,map.fPendingNewGeoBounds!==void 0&&(map.fPendingNewGeoBounds=!1)}},10);return}}if(this.szFlag.match(/CHART/))for(e in this.itemA)!(c=this.itemA[e].ptPos||(this.itemA[e].szSelectionId?this.getNodePosition(this.itemA[e].szSelectionId):null))||c.x===void 0||c.y===void 0||isNaN(c.x)||isNaN(c.y)||(d.x=Math.min(d.x,c.x),d.y=Math.min(d.y,c.y),a.x=Math.max(a.x,
c.x),a.y=Math.max(a.y,c.y),g++);else for(e in this.itemA)if((h=this.getItemNodes(e))&&h.length>0)for(B=0;B<h.length;B++){c=map.Dom.getBox(h[B]);if(c.width===0||c.height===0)l=getMatrix(h[B]),c.x+=l[4],c.y+=l[5],c.width=map.Scale.viewBox.width/20,c.height=map.Scale.viewBox.height/20,c.x-=c.width/2,c.y-=c.height/2;l=map.Scale.getMapOffset(h[B]);c.x+=l.x;c.y+=l.y;d.x=Math.min(d.x,c.x);d.y=Math.min(d.y,c.y);a.x=Math.max(a.x,c.x+c.width);a.y=Math.max(a.y,c.y+c.height);g++}g===0||d.x>=a.x||d.y>=a.y||d.x===
1E5||a.x===-1E5||(d=new box(d.x,d.y,a.x-d.x,a.y-d.y),d.scale(1),d=map.Zoom.clipArea(d),d.width>0&&d.height>0&&map.Zoom.setNewArea(d))}};A.prototype.createChartGroup=function(d){if(!this.chartGroup){if(this.szFlag.match(/FEATURE/)){if(this.chartGroup=map.Dom.newGroup(map.Layer.layerNode,this.szThemesA[0]),map.Dom.newGroup(map.Layer.layerNode,this.szThemesA[0]+":label"),map.Layer.listA[this.szThemesA[0]]=new ixMap.Layer.Item(null),map.Layer.listA[this.szThemesA[0]].szName=this.szThemesA[0],map.Layer.listA[this.szThemesA[0]].szHighlight=
"fill:url(#DiagUp200000000);stroke:black;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;",map.Layer.listA[this.szThemesA[0]].szSelection=this.szItemField,this.nFeatureLower||this.nFeatureUpper)map.Layer.depListA[this.szThemesA[0]]={},map.Layer.depListA[this.szThemesA[0]].nLower=this.nFeatureLower||0,map.Layer.depListA[this.szThemesA[0]].nUpper=this.nFeatureUpper||1E9,map.Layer.depListA[this.szThemesA[0]].shapeId=this.szThemesA[0],map.Layer.depListA[this.szThemesA[0]].szDisplayAttribute=
"none",map.Layer.depListA[this.szThemesA[0]].szFeature=this.szThemesA[0],setTimeout("map.Layer.switchScaleDependentLayer(null)",10)}else this.chartGroup=map.Dom.newGroup(d,this.szId+":chartgroup");this.chartGroup.style.setProperty("opacity",String(this.nOpacity?this.nOpacity:1),"");this.fVisible==0&&this.chartGroup.style.setProperty("display","none","");this.szFlag.match(/SILENT/)&&this.chartGroup.style.setProperty("pointer-events","none","");this.szFlag.match(/VECTOR/)&&map.antiZoomAndPanList.addGroup(this.chartGroup);
this.szFlag.match(/NOSCALE/)&&map.antiZoomAndPanList.addGroup(this.chartGroup);this.szFlag.match(/AGGREGATE/)&&(this.szFlag.match(/AUTOSIZE/)||this.szFlag.match(/GRIDSIZE/))&&map.antiZoomAndPanList.addGroup(this.chartGroup);this.szFlag.match(/GRIDSIZE/)&&!this.szFlag.match(/AGGREGATE/)&&map.antiZoomAndPanList.addGroup(this.chartGroup);if(this.szFlag.match(/BUFFER/)){this.szFlag.match(/OVERLAY/)&&!this.szShapeType.match(/line/)&&this.chartGroup.style.setProperty("opacity","1","");map.Layer.getLayerObj(this.szThemesA[0]);
this.chartGroup.style.setProperty("pointer-events","none","");map.antiZoomAndPanList.addGroup(this.chartGroup);d=this.colorScheme[0];var a=this.colorScheme[1]?this.colorScheme[1]:"red";typeof this.szBorderColor!="undefined"&&(a=this.szBorderColor);var g="stroke-width:0;";if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":g="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":g="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:300,300;";
break;case "solid":g="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":g="stroke-width:0;"}if(typeof this.szBorderWidth!="undefined")switch(this.szBorderWidth){case "thin":g+="stroke-width:"+map.Scale.normalX(.5)+";";break;case "thick":g+="stroke-width:"+map.Scale.normalX(1.5)+";";break;default:g+="stroke-width:"+map.Scale.normalX(this.szBorderWidth)+";"}this.chartGroup.setAttributeNS(null,"style","fill:"+d+";fill-opacity:"+(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0)+
";stroke:"+a+";"+g+";")}}};A.prototype.chartMap=function(d){this.chartGroup&&this.szFlag&&this.szFlag.match(/CHART/)&&this.fClearOnProjectionChange&&(!d||d===0)&&(this.chartGroup.style.setProperty("display","inline",""),map.Dom.clearGroup(this.chartGroup),this.fClearOnProjectionChange=!1);if(this.nChartUpper||this.nChartLower){if(this.nChartUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nChartUpper||this.nChartLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nChartLower){this.chartGroup||
this.createChartGroup(map.Layer.objectGroup);this.chartGroup.style.setProperty("display","none","");this.fVisible=!1;this.realizeDone();return}this.chartGroup||this.createChartGroup(map.Layer.objectGroup);this.chartGroup.style.setProperty("display","inline","");this.fVisible=!0}this.chartGroup&&!d&&(this.chartPosA=[]);var a=this.nChartSize?this.nChartSize:30,g=map.Zoom.getBox(),b=this.szFlag.match(/AGGREGATE/)&&this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth||0)*map.Scale.nZoomScale:
map.Scale.normalX(30)*map.Scale.nZoomScale;g.x-=b/2;g.y-=b/2;g.width+=b;g.height+=b;var r=map.Zoom.getBoundsOfMapInGeoBounds();r&&r[0]&&r[1]&&r[0].x!==void 0&&r[0].y!==void 0&&r[1].x!==void 0&&r[1].y!==void 0||(r=[new point(-180,-90),new point(180,90)]);var n=Math.floor(Math.round(1/((r[1].x-r[0].x)/2)*100)/100);r[0].x=Math.floor(r[0].x*n)/n;r[0].y=Math.floor(r[0].y*n)/n;r[1].x=Math.ceil(r[1].x*n)/n;r[1].y=Math.ceil(r[1].y*n)/n;if(this.mapGeoBounds&&this.szFlag.match(/FEATURE/)&&this.szFlag.match(/CLIPTOGEOBOUNDS|CLIPTOVIEW/)&&
r[0].x==this.mapGeoBounds[0].x&&r[0].y==this.mapGeoBounds[0].y&&r[1].x==this.mapGeoBounds[1].x&&r[1].y==this.mapGeoBounds[1].y)this.realizeDone();else{this.mapGeoBounds=[new point(r[0].x,r[0].y),new point(r[1].x,r[1].y)];var v=null,c=8;if(!d||d===0){if(!this.partsA){this.realizeDone();return}var e=0;d=0;this.indexA=[];this.szValuesLineStyle="stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.5;";this.szValuesLineBgStyle="stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;";
this.szValuesTextStyle="font-family:"+(this.szTextFont||"arial")+";font-size:"+map.Scale.normalX(c)+"px;fill:#777777;pointer-events:none";this.szValuesTextBgStyle="font-family:"+(this.szTextFont||"arial")+";font-size:"+map.Scale.normalX(c)+"px;fill:none;stroke:white;stroke-width:"+map.Scale.normalY(c)/5+";stroke-opacity:0.8;pointer-events:none;stroke-linejoin:bevel;pointer-events:none";var f=map.Layer.objectGroup;this.chartGroup||this.createChartGroup(f);this.blur(this.nBlur);if(this.autoOpacity){var m=
map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale;this.fillOpacity=1*Math.max(.1,Math.min(1,20/Math.max(1,Math.pow(map.Zoom.nZoom/m,.5))))}this.mapSleep&&(this.mapSleep.checkSleepMessage="creating charts");this.szFlag.match(/LINEAR/)||this.szFlag.match(/SIZEP1/)?this.nSizePow=1:this.szFlag.match(/SIZEP1H/)?this.nSizePow=1.5:this.szFlag.match(/SIZELOG/)?this.nSizePow=10:this.szFlag.match(/SIZEP10/)?this.nSizePow=10:this.szFlag.match(/SIZEP4/)?this.nSizePow=4:this.szFlag.match(/SIZEP3/)||
this.szFlag.match(/SIZEVOLUME/)?this.nSizePow=3:this.nSizePow=this.nSizePow||2;this.nCharSizeNormal=a;var l=getRotateAttributeValue(map.Scale.canvasNode);if(this.szFlag.match(/\bSORT\b/)&&!this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/3D/)){this.indexA=[];for(e in this.itemA)this.indexA[this.indexA.length]=e;for(var h=[],p=0;p<this.indexA.length;p++){var B=this.itemA[this.indexA[p]].nValuesA[this.nActualFrame||0];this.itemA[this.indexA[p]].nSize?B=this.itemA[this.indexA[p]].nSize:this.szFlag.match(/SIZE/)&&
this.itemA[this.indexA[p]].nValueSum&&(B=this.itemA[this.indexA[p]].nValueSum);isNaN(B)||h.push({a:this.indexA[p],y:B})}this.szFlag.match(/\bUP\b/)?h.sort(this.sortDownChartObjectsCompare):h.sort(this.sortUpChartObjectsCompare);if(this.szValueField&&this.szValueField=="$index$")for(p=0;p<h.length;p++)this.itemA[h[p].a].szValue=String(h.length-p);this.indexA=[]}if(this.szFlag.match(/CHART/)&&!this.szFlag.match(/CATEGORICAL/)){for(var C=0;C<this.partsA.length;C++)this.partsA[C].nCount=0,this.partsA[C].nSum=
0;this.fRedrawInfo=!0;this.szFlag.match(/SEQUENCE/)&&(this.nFadeNegative=this.nFadeNegative||1)}var N=0,Y=0,M=0;if(!this.fClipCharts||this.szFlag.match(/BUFFER/)||this.szFlag.match(/\bPOSITION\b/)||this.szFlag.match(/FEATURE/))for(e in this.itemA)this.indexA[this.indexA.length]=e,Y++,N++;else{for(p=0;p<this.partsA.length;p++)this.partsA[p].nCount=0,this.partsA[p].nSum=0;for(e in this.itemA)if(Y++,this.itemA[e].nValuesA&&this.itemA[e].nValuesA.length>0)if(v=this.itemA[e].ptPos||this.getNodePosition(this.itemA[e].szSelectionId)){if(!this.szFlag.match(/NOCLIPTOVIEW/)&&
(v.x<g.x||v.x>g.x+g.width||v.y<g.y||v.y>g.y+g.height))if(this.szFlag.match(/\b(VECTOR|BEZIER)\b/)){v=this.itemA[e].ptPos2||(this.szLabelA?this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[this.itemA[e].nValuesA[0]-1]):null);if(!v)continue;if(v.x<g.x||v.x>g.x+g.width||v.y<g.y||v.y>g.y+g.height){this.nSkipCount++;(w=this.itemA[e].chartNode)&&w.parentNode&&(w.parentNode&&w.parentNode.removeChild(w),this.itemA[e].chartNode=null,this.chartPosA[this.itemA[e].szSelectionId]=null,this.posItemA[this.itemA[e].szSelectionId]=
null);continue}}else{this.nSkipCount++;var w;(w=this.itemA[e].chartNode)&&w.parentNode&&(w.parentNode&&w.parentNode.removeChild(w),this.itemA[e].chartNode=null,this.chartPosA[this.itemA[e].szSelectionId]=null,this.posItemA[this.itemA[e].szSelectionId]=null);continue}this.indexA[this.indexA.length]=e;if(this.szFlag.match(/CHART/))if(this.szFlag.match(/CATEGORICAL/))if(this.nMaxA.length>1)for(p=0;p<this.partsA.length;p++)this.partsA[p].nCount+=this.itemA[e].nCountA&&this.itemA[e].nCountA[p]&&!isNaN(this.itemA[e].nCountA[p])?
this.itemA[e].nCountA[p]:0,this.partsA[p].nSum+=this.itemA[e].nValuesA&&this.itemA[e].nValuesA[p]&&!isNaN(this.itemA[e].nValuesA[p])?this.itemA[e].nValuesA[p]:0;else this.szAlphaField?this.szColorField&&this.partsA[this.itemA[e].nClass]?(this.partsA[this.itemA[e].nClass].nCount++,this.partsA[this.itemA[e].nClass].nSum+=isNaN(this.itemA[e].nAlpha)?isNaN(this.itemA[e].nSize)?1:this.itemA[e].nSize:this.itemA[e].nAlpha):this.partsA[this.itemA[e].nValuesA[0]-1]&&(this.partsA[this.itemA[e].nValuesA[0]-
1].nCount++,this.partsA[this.itemA[e].nValuesA[0]-1].nSum+=isNaN(this.itemA[e].nAlpha)?isNaN(this.itemA[e].nSize)?1:this.itemA[e].nSize:this.itemA[e].nAlpha):this.szColorField&&this.partsA[this.itemA[e].nClass]?(this.partsA[this.itemA[e].nClass].nCount++,this.partsA[this.itemA[e].nClass].nSum+=isNaN(this.itemA[e].nSize)?1:this.itemA[e].nSize):this.partsA[this.itemA[e].nValuesA[0]-1]&&(this.partsA[this.itemA[e].nValuesA[0]-1].nCount++,this.partsA[this.itemA[e].nValuesA[0]-1].nSum+=isNaN(this.itemA[e].nSize)?
1:this.itemA[e].nSize);else if(this.nMaxA.length>1)for(p=0;p<this.partsA.length;p++){if(!this.szFlag.match(/MEAN/)||this.itemA[e].nValuesA[p])this.partsA[p].nCount++,this.partsA[p].nSum+=isNaN(this.itemA[e].nValuesA[p])?0:this.itemA[e].nValuesA[p]}else for(p=0;p<this.partsA.length;p++)this.itemA[e].nValuesA[0]>=this.partsA[p].min&&this.itemA[e].nValuesA[0]<this.partsA[p].max&&(this.partsA[p].nCount++,this.partsA[p].nSum+=isNaN(this.itemA[e].nValuesA[0])?0:this.itemA[e].nValuesA[0]);N++}else this.missedA[e]=
e,M++;if(Y==M&&!map.Tiles.allTilesLoaded()){this.fRedraw=this.fDataIncomplete=!0;map.Tiles.switchScaleDependentTiles();setTimeout(function(){map.Themes.execute()},1);return}}if(N>this.nMaxThemeCharts)for(e in this.ErrorMessage="max charts ("+this.nMaxThemeCharts+") exceeded; please zoom in",this.indexA.length=0,this.nSkipCount=N,this.itemA)(w=map.SVGDocument.getElementById(this.szId+":"+e+":chart"))&&w.parentNode.removeChild(w);this.fRedrawAllCharts=!1;N>this.nMaxShadowCharts?(this.fShadow&&(this.fRedrawAllCharts=
!0),this.fShadow=!1):(this.fOrigShadow&&!this.fShadow&&(this.fRedrawAllCharts=!0),this.fShadow=this.fOrigShadow);this.szShadowUpper&&(map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nShadowUpper?(this.xOrigShadow=this.xOrigShadow||this.fOrigShadow,this.fShadow=this.fOrigShadow=!1):this.fOrigShadow=this.xOrigShadow||this.fOrigShadow);this.szShadowLower&&(map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nShadowLower?(this.xOrigShadow=this.xOrigShadow||this.fOrigShadow,this.fShadow=this.fOrigShadow=
!1):this.fOrigShadow=this.xOrigShadow||this.fOrigShadow);this.mapSleep&&(this.mapSleep.nCount=N);this.fSorted=!1;if(this.fSortBeforeDraw&&(this.nMin!=this.nMax||this.szSizeField)&&!this.szFlag.match(/NOSRT/)&&!this.szFlag.match(/\bDOT\b/)&&(!this.szFlag.match(/NOSIZE/)||this.szFlag.match(/3D/)||this.szFlag.match(/\bSORT\b/))&&(!this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/AGGREGATE/)||this.szSizeField||this.szFlag.match(/\bSORT\b/))){var J=[];if((this.szFlag.match(/3D/)||this.szFlag.match(/PLOT/)||
this.szFlag.match(/xxxBOXxxx/)||this.szFlag.match(/POINTER/)&&this.szFlag.match(/BAR/))&&(!this.szFlag.match(/MULTIPLE/)&&!this.szFlag.match(/MULTIGRID/)||this.szFlag.match(/AGGREGATE/)))for(p=0;p<this.indexA.length;p++)(v=this.itemA[this.indexA[p]].ptPos||this.getNodePosition(this.itemA[this.indexA[p]].szSelectionId))?J[p]=l?{a:this.indexA[p],y:v.x*Math.sin(l)+v.y*Math.cos(l)}:{a:this.indexA[p],y:v.y}:J[p]={a:this.indexA[p],y:0};else if(this.szSizeField||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/SUM/))for(p=
0;p<this.indexA.length;p++)B=this.itemA[this.indexA[p]].nSize,isNaN(B)||J.push({a:this.indexA[p],y:B});else if(this.szSizeField||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/MEAN/))for(p=0;p<this.indexA.length;p++)B=this.itemA[this.indexA[p]].nValuesA[this.nActualFrame||0],isNaN(B)||J.push({a:this.indexA[p],y:B});else if(this.szFlag.match(/SIZE/))for(p=0;p<this.indexA.length;p++)B=this.szFlag.match(/AGGREGATE/)?this.itemA[this.indexA[p]].nSize:this.itemA[this.indexA[p]].nValueSum,B==null||isNaN(B)||
J.push({a:this.indexA[p],y:B});else for(p=0;p<this.indexA.length;p++)B=this.itemA[this.indexA[p]].nValuesA[this.nActualFrame||0],isNaN(B)||J.push({a:this.indexA[p],y:B});this.szFlag.match(/\bSORT\b/)&&this.szFlag.match(/\bUP\b/)&&!this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/3D/)?J.sort(this.sortDownChartObjectsCompare):J.sort(this.sortUpChartObjectsCompare);for(p=0;p<J.length;p++)this.indexA[p]=J[p].a;this.fSorted=!0}if(this.nMaxCharts&&N>this.nMaxCharts){this.fContinue=!0;this.continueIndex=
N-this.nMaxCharts;this.indexA.slice(N-this.nMaxCharts-1,this.nMaxCharts);map.Themes.executeContinue();return}this.fDone||this.unpaintMap()}this.chart={szColor:this.colorScheme[0],szLineColor:this.colorScheme[1]?this.colorScheme[1]:"none",szTextColor:this.colorScheme[1]?this.colorScheme[1]:"none"};if(this.colorScheme.length>2||this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.colorScheme.length-1],this.chart.szLineColor=this.colorScheme[0];if(this.szFlag.match(/NOLINES/))this.chart.szLineColor=
"none";else if(this.chart.szLineColor=="none"){var L=O("#777777");this.chart.szLineColor=L.textColor}this.nXLen=this.nMaxA.length/(this.nGridX||1);if(this.szFlag.match(/PLOT/)&&(this.szFlag.match(/GRIDSIZE/)||this.szFlag.match(/AUTOSIZE/))){var G=0,F=map.Layer.nDynamicObjectScale,V=this.szFlag.match(/GAP/)?1.2:1;G=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/V*this.nScale/F:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/V*this.nScale/F:map.Scale.normalX(a/3);this.nAutoScale=
G/map.Scale.normalX((this.itemA[e]?this.itemA[e].nValuesA.length:1)/(this.nGridX||1)*a);this.nGridSize=G}else this.szFlag.match(/GRIDSIZE/)&&(F=map.Layer.nDynamicObjectScale,V=this.szFlag.match(/\bRECT\b/)||!this.szFlag.match(/AGGREGATE/)?this.szFlag.match(/GAP/)?1.15:1:this.szFlag.match(/GAP/)?.8:.75,this.nGridSize=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/V/F:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/V/F:map.Scale.normalX(a/3));this.szFlag.match(/PLOTXY/)&&
(F=map.Layer.nDynamicObjectScale,V=1.15,this.nChartWidth=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/V/this.nScale/F:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/V/this.nScale/F:map.Scale.normalX(a/3),this.nChartWidth-=map.Scale.normalX(this.nBoxMargin||0)*2,this.nChartHeight=this.nChartWidth-map.Scale.normalY(this.szFlag.match(/TITLE/)?10:0),this.nGridSize=this.nChartWidth,this.nAutoScale=1,this.nRangeX=this.nMaxX-this.nMinX,this.nRangeY=this.nMaxY-this.nMinY);
this.nChartGroupScaleX=this.nChartGroupScale=map.fObjectScaling?(this.nAutoScale||this.nScale)*map.Layer.nObjectScale*map.Scale.nObjectScaling:(this.nAutoScale||this.nScale)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling;this.nChartGroupScaleY=this.nChartGroupScale/map.Zoom.nZoomY*map.Zoom.nZoomX;this.fGlowInScale=!1;(!this.szGlowUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)&&(!this.szGlowLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower)&&(this.fGlowInScale=
!0);this.fDoRedraw=!1;if(this.indexA.length<1E3||this.fRedraw||this.fRedrawAllCharts||this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.fDoRedraw=!this.fDone;this.fHideValues=this.szValueUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nValueUpper||this.szValueLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nValueLower;if(this.szFlag.match(/\bUSER\b/))try{var la={target:this.chartGroup,theme:this};if(this.userDraw){this.opt=la;try{if(this.userDraw&&/^[a-zA-Z_$][a-zA-Z0-9_$.]*$/.test(this.userDraw)){var U=
null,ka=this.userDraw+"_init";if(ka.indexOf(".")!==-1){var Sa=ka.split("."),Ma=window;for(p=0;p<Sa.length;p++)if(Ma&&Ma[Sa[p]])Ma=Ma[Sa[p]];else{Ma=null;break}Ma&&typeof Ma==="function"&&(U=Ma)}else map.HTMLWindow&&map.HTMLWindow.ixmaps&&map.HTMLWindow.ixmaps[ka]&&(U=map.HTMLWindow.ixmaps[ka]);typeof U==="function"&&U(map.SVGDocument,this.opt)}}catch(gb){console.error("Error calling userDraw_init: "+gb.message)}delete this.opt}else map.HTMLWindow.ixmaps.htmlgui_initChart(map.SVGDocument,la)}catch(gb){displayMessage("'"+
(this.userDraw||"USER chart")+"' undefined!",5E3)}if(this.szFlag.match(/FEATURE/)){this.chartGroup.style.setProperty("fill",this.chart.szColor||"white");this.chartGroup.style.setProperty("fill-opacity",this.fillOpacity||.7);this.chartGroup.style.setProperty("stroke",this.szLineColor||"red");this.chartGroup.style.setProperty("stroke-width",map.Scale.normalX(this.nLineWidth||1)*this.nChartGroupScaleY/(map.fFeatureScalingDynamic?1:map.Layer.nDynamicObjectScale));if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":this.chartGroup.style.setProperty("stroke-dasharray",
"0.1 0.2");break;case "dashed":this.chartGroup.style.setProperty("stroke-dasharray","0.5 0.2")}this.szFlag.match(/DASH/)&&this.chartGroup.style.setProperty("stroke-dasharray","0.1 0.2");this.chartGroup.style.setProperty("stroke-opacity","1");this.chartGroup.style.setProperty("stroke-linecap","butt");this.chartGroup.style.setProperty("stroke-linejoin","round");if(this.szFlag.match(/SILENT/))this.chartGroup.style.setProperty("pointer-events","none","");else{var Na="";for(p=0;p<this.objTheme.dbFields.length-
1;p++)Na+=(p?"|":"")+this.objTheme.dbFields[p].id;this.chartGroup.setAttributeNS(szMapNs,"info",Na)}if(this.fShadow===!0&&map.SVGDocument.getElementById(map.szShadowFilterShapeId))this.chartGroup.style.setProperty("filter","url(#"+map.szShadowFilterShapeId+")","");else if(this.fShadow===!0){var Qa=map.Dom.newNode("filter",this.chartGroup.parentNode);Qa.setAttributeNS(null,"id",map.szShadowFilterShapeId);Qa.setAttributeNS(null,"x","-1");Qa.setAttributeNS(null,"y","-1");Qa.setAttributeNS(null,"width",
"2000%");Qa.setAttributeNS(null,"height","2000%");var Ka=map.Dom.newNode("feGaussianBlur",Qa);Ka.setAttributeNS(null,"stdDeviation","0.3");Ka.setAttributeNS(null,"result","BlurAlpha");Ka=map.Dom.newNode("feOffset",Qa);Ka.setAttributeNS(null,"in","BlurAlpha");Ka.setAttributeNS(null,"dx","0.2");Ka.setAttributeNS(null,"dy","0.5");Ka.setAttributeNS(null,"result","OffsetBlurAlpha");Ka=map.Dom.newNode("feColorMatrix",Qa);Ka.setAttributeNS(null,"in","OffsetBlurAlpha");Ka.setAttributeNS(null,"type","matrix");
Ka.setAttributeNS(null,"values","0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0 0 0 1 0");Ka.setAttributeNS(null,"result","matrixOut");Ka=map.Dom.newNode("feMerge",Qa);var $a=map.Dom.newNode("feMergeNode",Ka);$a.setAttributeNS(null,"in","matrixOut");$a=map.Dom.newNode("feMergeNode",Ka);$a.setAttributeNS(null,"in","SourceGraphic");this.chartGroup.style.setProperty("filter","url(#"+map.szShadowFilterShapeId+")","")}}G=0;this.nGridWidth?G=map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/2*20:
(G=map.Scale.normalX(a/3),G=G*map.Scale.nZoomScale*20);for(var kb=d;kb<this.indexA.length;kb++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);this.fCancel=!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(kb,10))){this.fContinue=!0;this.continueIndex=kb;this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);this.markedClass!=null&&this.markClass(this.markedClass,1);return}var ia=null;e=this.indexA[kb];
this.nDoneCount++;if(this.itemA[e]&&this.itemA[e].nValuesA&&this.itemA[e].nValuesA.length!==0){var Da=this.itemA[e].szSelectionId;if(!this.szFlag.match(/FEATURE/)){(v=this.itemA[e].ptPos||this.getNodePosition(Da))&&v.x!==void 0&&v.y!==void 0&&(v.x=isNaN(v.x)?0:v.x,v.y=isNaN(v.y)?0:v.y);if(!v||v.x===void 0||v.y===void 0||isNaN(v.x)||isNaN(v.y)){this.nMissingPositionCount++;continue}this.fRedraw&&(this.itemA[e].chartNode=this.itemA[e].chartNode||map.SVGDocument.getElementById(this.szId+":"+e+":chart"));
if(this.itemA[e].chartNode&&this.itemA[e].chartNode.parentNode)if(this.fDoRedraw)this.itemA[e].chartNode.parentNode.removeChild(this.itemA[e].chartNode),this.itemA[e].chartNode=null;else{this.nRealizedCount++;continue}}var Cb=new point(0,0);if(this.szFlag.match(/FEATURE/))if(e.match(/\*/)&&(ia=map.SVGDocument.getElementById(e.split("*")[0])),ia||=map.Dom.newGroup(this.chartGroup,e),this.objTheme.dbRecords[this.itemA[e].dbIndex][this.objTheme.nFieldSelectionIndex]){function gb(mc,ec,Oc,fc,Sb){if(Oc!==
void 0&&fc!==void 0){for(var Dc=0,da=1,Ia=0;Ia<12;Ia++){var Za=(Dc+da)/2,Ec=map.Scale.getMapPositionOfLatLon(Oc+(mc-Oc)*Za,fc+(ec-fc)*Za);Ec&&Ec.x!==void 0&&Ec.y!==void 0?Dc=Za:da=Za}if(Dc>0&&(mc=Oc+(mc-Oc)*Dc,ec=fc+(ec-fc)*Dc,(fc=map.Scale.getMapPositionOfLatLon(mc,ec))&&fc.x!==void 0&&fc.y!==void 0))return{pt:fc,lat:mc,lon:ec}}return Sb&&Sb.lat!==void 0&&(ec=map.Scale.getMapPositionOfLatLon(Sb.lat,Sb.lon))&&ec.x!==void 0&&ec.y!==void 0?{pt:ec,lat:Sb.lat,lon:Sb.lon}:null}if(this.objTheme.dbRecords[this.itemA[e].dbIndex][this.objTheme.nFieldSelectionIndex].match(/coordinates/i)){var Bb=
aa(this.objTheme.dbRecords[this.itemA[e].dbIndex][this.objTheme.nFieldSelectionIndex]);if(Bb){if(this.szFlag.match(/CLIPTOGEOBOUNDS|CLIPTOVIEW/)&&Bb.type=="Polygon"){var Hb=Bb.coordinates,Zb=!0;for(p in Hb){var Ya=Hb[p];for(let mc in Ya)if(Ya[mc][0]>r[0].x&&Ya[mc][0]<r[1].x&&Ya[mc][1]>r[0].y&&Ya[mc][1]<r[1].y){Zb=!1;break}}if(Zb){ia.parentNode.removeChild(ia);for(p in map.Themes.themeNodesA[e])map.Themes.themeNodesA[e][p].parentNode&&map.Themes.themeNodesA[e][p].parentNode.removeChild(map.Themes.themeNodesA[e][p]);
map.Themes.themeNodesA[e]=[];continue}else if(map.Themes.themeNodesA[e]&&map.Themes.themeNodesA[e].length)continue}if(this.szFlag.match(/SILENT/))ia.style.setProperty("pointer-events","none","");else{Na="";var vc=this.objTheme.dbRecords[this.itemA[e].dbIndex];for(p=0;p<vc.length-1;p++)Na+=(p?"|":"")+vc[p];ia.setAttributeNS(szMapNs,"info",Na);ia.setAttributeNS(szMapNs,"tooltip",e)}if(this.szTimeField){var dc=(new Date(this.itemA[e].szTime)).getTime()||this.itemA[e].szTime;ia.setAttributeNS(szMapNs,
"time",dc)}if(this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.itemA[e].nValuesA[0]-1];else if(this.partsA.length>1)for(this.chart.szColor=this.szNoDataColor?this.szNoDataColor:"white",p=0;p<this.partsA.length;p++)this.itemA[e].nValuesA[0]>=this.partsA[p].min&&this.itemA[e].nValuesA[0]<this.partsA[p].max&&(this.chart.szColor=this.colorScheme[p],this.itemA[e].nClass=p,this.partsA[p].nCount++);ia.setAttributeNS(null,"style","stroke:"+this.chart.szColor);ia.setAttributeNS(szMapNs,
"class",typeof this.itemA[e].nClass!="undefined"?this.itemA[e].nClass:String(this.itemA[e].nValuesA[0]-1));var rb=map.Scale.getMapPositionOfLatLon(80,180),Ta=map.Scale.getMapPositionOfLatLon(80,-180),ob=rb&&Ta&&rb.x!==void 0&&Ta.x!==void 0?rb.x-Ta.x:1E7;if(Bb.type=="Point"){map.Layer.listA[this.szThemesA[0]].szType="point";Ya=Bb.coordinates;var na=map.Scale.getMapPositionOfLatLon(Ya[1],Ya[0]);if(!na||na.x===void 0||na.y===void 0)continue;ia.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,
na.x,na.y]);var jb=map.Dom.newShape("circle",ia,0,0,map.Scale.normalX(1),"fill:#dd0000;fill-opacity:0.3;stroke:#dd0000;stroke-opacity:1;stroke-width:1")}if(Bb.type=="LineString"){this.chartGroup.style.setProperty("fill","none");map.Layer.listA[this.szThemesA[0]].szType="line";Ya=Bb.coordinates;for(var k=[],u=null,q=!1,z=0;z<Ya.length;z++){var D=Ya[z][1],E=Ya[z][0];if((na=map.Scale.getMapPositionOfLatLon(D,E))&&na.x!==void 0&&na.y!==void 0){if(u&&Math.abs(na.x-u.x)>ob*.99){var K=map.Scale.getMapPositionOfLatLon(D,
E+(na.x<0?360:-360));if(K&&K.x!==void 0&&K.y!==void 0)na=K;else{u=null;continue}}u?(k.push(" l "+(na.x-u.x)+","+(na.y-u.y)),q=!0):k.push((k.length?" M ":"M ")+na.x+","+na.y);u=new point(na.x,na.y)}else u=null}if(!q)continue;var P=k.join("");jb=map.Dom.newShape("path",ia,P,"")}if(Bb.type=="MultiLineString")for(p in this.chartGroup.style.setProperty("fill","none"),map.Layer.listA[this.szThemesA[0]].szType="line",Hb=Bb.coordinates,Hb){Ya=Hb[p];k=[];u=null;q=!1;for(z=0;z<Ya.length;z++)if(D=Ya[z][1],E=
Ya[z][0],(na=map.Scale.getMapPositionOfLatLon(D,E))&&na.x!==void 0&&na.y!==void 0){if(u&&Math.abs(na.x-u.x)>ob*.99)if((K=map.Scale.getMapPositionOfLatLon(D,E+(na.x<0?360:-360)))&&K.x!==void 0&&K.y!==void 0)na=K;else{u=null;continue}u?(k.push(" l "+(na.x-u.x)+","+(na.y-u.y)),q=!0):k.push((k.length?" M ":"M ")+na.x+","+na.y);u=new point(na.x,na.y)}else u=null;q&&(P=k.join(""),jb=map.Dom.newShape("path",ia,P,""))}if(Bb.type=="Polygon"){map.Layer.listA[this.szThemesA[0]].szType="polygon";Hb=Bb.coordinates;
P="";var T=0,fa=0,wa=0;for(p in Hb){Ya=Hb[p];var Fa=u=null,Ha=null,Ua=null,fb=(na=map.Scale.getMapPositionOfLatLon(Ya[0][1],Ya[0][0]))&&na.x!==void 0&&na.y!==void 0;if(fb){P+="M "+na.x+","+na.y;u=new point(na.x,na.y);T+=na.x;fa+=na.y;wa++;Fa=Ya[0][1];Ha=Ya[0][0];for(var Ab=1;Ab<Ya.length;Ab++){D=Ya[Ab][1];E=Ya[Ab][0];var Db=(na=map.Scale.getMapPositionOfLatLon(D,E))&&na.x!==void 0&&na.y!==void 0;if(Db){if(Math.abs(na.x-u.x)>ob*.99&&(na=map.Scale.getMapPositionOfLatLon(D,E+(na.x<0?360:-360)),!na||
na.x===void 0||na.y===void 0))continue;T+=na.x;fa+=na.y;wa++;P+=" l "+(na.x-u.x)+","+(na.y-u.y);u=new point(na.x,na.y)}else if(map.Scale.szMapProjection==="Orthographic"){var bb=gb(D,E,Fa,Ha,Ua);if(bb&&bb.pt){m=Math.abs(bb.pt.x-u.x);var va=Math.abs(bb.pt.y-u.y),Ca=Math.sqrt(m*m+va*va),cd=ob*.5;Ca<cd&&(Ua||={lat:bb.lat,lon:bb.lon},P+=" l "+(bb.pt.x-u.x)+","+(bb.pt.y-u.y),u=new point(bb.pt.x,bb.pt.y))}}Fa=D;Ha=E}P+=" z"}}P.length>0&&wa>0&&(jb=map.Dom.newShape("path",ia,P,""),ia.setAttributeNS(szMapNs,
"center","x:"+T/wa+",y:"+fa/wa),ia.setAttributeNS(szMapNs,"area",this.itemA[e].nSize),ia.setAttributeNS(null,"style","fill:"+this.chart.szColor+";"))}if(Bb.type=="MultiPolygon"){T=[];fa=[];wa=[];map.Layer.listA[this.szThemesA[0]].szType="polygon";var vb=Bb.coordinates;for(hb in vb){Hb=vb[hb];P="";T[hb]=0;fa[hb]=0;wa[hb]=0;for(p in Hb)if(Ya=Hb[p],Ua=Ha=Fa=u=null,fb=(na=map.Scale.getMapPositionOfLatLon(Ya[0][1],Ya[0][0]))&&na.x!==void 0&&na.y!==void 0){P+="M "+na.x+","+na.y;u=new point(na.x,na.y);T[hb]+=
na.x;fa[hb]+=na.y;wa[hb]++;Fa=Ya[0][1];Ha=Ya[0][0];for(Ab=1;Ab<Ya.length;Ab++){D=Ya[Ab][1];E=Ya[Ab][0];if(Db=(na=map.Scale.getMapPositionOfLatLon(D,E))&&na.x!==void 0&&na.y!==void 0){if(Math.abs(na.x-u.x)>ob*.99&&(na=map.Scale.getMapPositionOfLatLon(D,E+(na.x<0?360:-360)),!na||na.x===void 0||na.y===void 0))continue;T[hb]+=na.x;fa[hb]+=na.y;wa[hb]++;P+=" l "+(na.x-u.x)+","+(na.y-u.y);u=new point(na.x,na.y)}else map.Scale.szMapProjection==="Orthographic"&&(bb=gb(D,E,Fa,Ha,Ua))&&bb.pt&&(m=Math.abs(bb.pt.x-
u.x),va=Math.abs(bb.pt.y-u.y),Ca=Math.sqrt(m*m+va*va),cd=ob*.5,Ca<cd&&(Ua||={lat:bb.lat,lon:bb.lon},P+=" l "+(bb.pt.x-u.x)+","+(bb.pt.y-u.y),u=new point(bb.pt.x,bb.pt.y)));Fa=D;Ha=E}P+=" z"}P.length>0&&wa[hb]>0&&(jb=map.Dom.newShape("path",ia,P,""))}var ea=0;for(hb in wa)wa[hb]>ea&&(ia.setAttributeNS(szMapNs,"center","x:"+T[hb]/wa[hb]+",y:"+fa[hb]/wa[hb]),ia.setAttributeNS(szMapNs,"area",this.itemA[e].nSize),ea=wa[hb]);ea>0&&ia.setAttributeNS(null,"style","fill:"+this.chart.szColor+";")}}}else(v=
this.itemA[e].ptPos||this.getNodePosition(Da))&&v.x!==void 0&&v.y!==void 0&&ia.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,v.x,v.y])}else(v=this.itemA[e].ptPos||this.getNodePosition(Da))&&v.x!==void 0&&v.y!==void 0&&ia.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,v.x,v.y]);else if(this.szFlag.match(/\bDOT\b/)){if((v=this.itemA[e].ptPos||this.getNodePosition(Da))&&v.x!==void 0&&v.y!==void 0){ia=map.Dom.newGroup(this.chartGroup,this.szId+":"+Da+":chartgroup");
ia.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,v.x,v.y]);if(this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.itemA[e].nValuesA[0]-1];else if(this.partsA.length>1)for(p=0;p<this.partsA.length;p++)this.itemA[e].nValuesA[0]>=this.partsA[p].min&&this.itemA[e].nValuesA[0]<this.partsA[p].max&&(this.chart.szColor=this.colorScheme[p]);this.itemA[e].chartNode=map.Dom.newShape("circle",ia,0,0,map.Scale.normalX(3),"fill:"+this.chart.szColor+";fill-opacity:"+(this.fillOpacity||
1)+";stroke:none;")}}else if(this.szFlag.match(/\bQUAD\b/)){if(v&&v.x!==void 0&&v.y!==void 0){ia=map.Dom.newGroup(this.chartGroup,this.szId+":"+Da+":chart");ia.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,v.x,v.y]);if(this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.itemA[e].nValuesA[0]-1];else if(this.partsA.length>1)for(p=0;p<this.partsA.length;p++)this.itemA[e].nValuesA[0]>=this.partsA[p].min&&this.itemA[e].nValuesA[0]<this.partsA[p].max&&(this.chart.szColor=
this.colorScheme[p]);this.itemA[e].chartNode=map.Dom.newShape("rect",ia,-G,-G,G*2,G*2,"fill:"+this.chart.szColor+";stroke:none;")}}else if(this.szFlag.match(/\bBEZIER\b/)){if(!(this.nMinValue&&this.itemA[e].nSize<this.nMinValue)){var wb=this.itemA[e].ptPos,lb=this.itemA[e].ptPos2||(this.szLabelA?this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[this.itemA[e].nValuesA[0]-1]):null);if(wb&&lb&&wb!=lb){ia=this.itemA[e].chartNode=map.Dom.newGroup(this.chartGroup,this.szId+":"+e+(e?":chartgroup":
":ochrtgroup"));this.chart.szColor=this.szLineColor||this.itemA[e].szColor||this.colorScheme[this.itemA[e].nValuesA[0]-1]||this.szNoDataColor;var tb=1/(this.nSizePow||1),Jb=this.nLineWidth||10/Math.pow(this.nNormalSizeValue||this.nMaxSize,tb)*Math.pow(Math.abs(this.itemA[e].nSize),tb),ub=Number(this.nGapSize||20),Tb=Jb+(this.szFlag.match(/\bGAP\b/)?ub:3);Jb=map.Scale.normalX(Jb)*this.nChartGroupScaleY*this.nScale;if(!(Jb<=0)){if(this.szFlag.match(/\bREVERSE\b/)||this.itemA[e].nSize<0){var vd=wb;wb=
lb;lb=vd}var Qb=Math.sqrt((lb.y-wb.y)*(lb.y-wb.y)+(lb.x-wb.x)*(lb.x-wb.x));T=lb.x-wb.x;fa=lb.y-wb.y;Qb=Math.sqrt(T*T+fa*fa);this.szFlag.match(/\bDYNAMICWIDTH\b/)&&(Jb*=Math.max(1,Math.log10(Qb)));if(!(Qb<=0)){var Ib=this.nRangeScale;this.szFlag.match(/\bRANDOM\b/)&&(Ib-=this.nRangeScale*.66*Math.random());this.szFlag.match(/\bSHORT\b/)?(m=fa/Qb*(Ib||5)*100*this.nChartGroupScaleY,va=T/Qb*(Ib||5)*100*this.nChartGroupScaleY):this.szFlag.match(/\bLONG\b/)?(m=fa/5E4*Math.max(Qb,500)*(Ib||5),va=T/5E4*Math.max(Qb,
500)*(Ib||5)):(m=fa/50*(Ib||5),va=T/50*(Ib||5));this.szFlag.match(/\bPOINTER|ARROW\b/)&&(T-=T/Qb*map.Scale.normalX(Tb)*this.nChartGroupScaleY*this.nScale*(this.nMarkerSize||1),fa-=fa/Qb*map.Scale.normalX(Tb)*this.nChartGroupScaleY*this.nScale*(this.nMarkerSize||1));var md=0,Ub=0;this.szFlag.match(/\bGAP\b/)&&(T+=m/500*Tb,fa-=va/500*Tb,md=T/Qb*ub*20*this.nChartGroupScaleY,Ub=fa/Qb*ub*20*this.nChartGroupScaleY);P="M"+md+","+Ub+" C"+(T/4+m)+","+(fa/4-va)+" "+(T/2+m)+","+(fa/2-va)+" "+T+","+fa;jb=map.Dom.newShape("path",
ia,P,"stroke-linecap:butt;fill:none;stroke:"+this.chart.szColor+";stroke-width:"+Jb+";stroke-opacity:"+(this.fillOpacity||.3)+";");if(this.szFlag.match(/DOPACITYMIN/)){tb=1/(this.nDopacityPow||1);var ta=Math.pow(this.nMax-this.itemA[e].nSize,tb)/Math.pow(this.nMax-this.nMin,tb)*(this.fillOpacity||1)*(this.nDopacityScale||1);jb.style.setProperty("stroke-opacity",String(ta),"")}else this.szFlag.match(/DOPACITY/)&&(tb=1/(this.nDopacityPow||1),ta=Math.pow(this.itemA[e].nSize-this.nMin,tb)/Math.pow(this.nMax-
this.nMin,tb)*(this.fillOpacity||1)*(this.nDopacityScale||1),jb.style.setProperty("stroke-opacity",String(ta),""));if(this.szFlag.match(/\bDASH\b/)){var eb=1E3*this.nChartGroupScaleY,Eb=100*this.nChartGroupScaleY+Jb;jb.style.setProperty("stroke-dasharray",String(eb)+" "+String(Eb));jb.style.setProperty("stroke-dashoffset","0");jb.style.setProperty("stroke-linecap","round");var Vb=Math.random()*eb,Va=Vb+eb+Eb,wc=Vb;map.Dom.constructNode("animate",jb,{attributeType:"XML",attributeName:"stroke-dashoffset",
from:String(Va),to:String(wc),dur:"2s",repeatCount:"indefinite"})}if(this.szFlag.match(/\bGRADIENT\b|\bFADEIN\b/)){var xc=this.szLineColorA?this.szLineColorA[0]:this.chart.szColor,$b=this.szFlag.match(/\bFADEIN\b/)?.2:2,Fc="Gradient"+Math.random();if(Math.abs(fa)>Math.abs(T)){var hc=map.Dom.constructNode("linearGradient",ia,{id:Fc,x1:"0%",y1:"0%",x2:"0%",y2:"100%"});map.Dom.constructNode("stop",hc,{offset:"0","stop-color":fa<0?this.chart.szColor:xc,"stop-opacity":fa<0?"2":$b});map.Dom.constructNode("stop",
hc,{offset:"1","stop-color":fa<0?xc:this.chart.szColor,"stop-opacity":fa<0?$b:"2"})}else hc=map.Dom.constructNode("linearGradient",ia,{id:Fc}),map.Dom.constructNode("stop",hc,{offset:"0","stop-color":T<0?this.chart.szColor:xc,"stop-opacity":T<0?"2":$b}),map.Dom.constructNode("stop",hc,{offset:"1","stop-color":T<0?xc:this.chart.szColor,"stop-opacity":T<0?$b:"2"});jb.style.setProperty("stroke","");jb.style.setProperty("fill","none");jb.setAttributeNS(null,"stroke","url(#"+Fc+")")}if(this.szFlag.match(/\bPOINTER|ARROW\b/)){var ic=
"ArrowMarker"+Math.random(),Tc=map.Dom.newNode("defs",ia),oc=Math.min(5,2.5+100/(Jb/this.nChartGroupScale))*(this.nMarkerSize||1),Gc=map.Dom.constructNode("marker",Tc,{id:ic,markerWidth:oc,markerHeight:oc,refX:oc/1.7,refY:oc/2,orient:"auto",markerUnits:"strokeWidth"}),Uc=map.Dom.constructNode("path",Gc,{d:"M0,"+oc+" L"+oc+","+oc/2+" L0,0 Z",style:"fill:"+this.chart.szColor+";opacity:"+(this.fillOpacity||.3)*2+";stroke:none;stroke-width:0.03"});jb.setAttributeNS(null,"marker-end","url(#"+ic+")");this.szFlag.match(/DOPACITYMIN/)?
(tb=1/(this.nDopacityPow||1),ta=Math.pow(this.nMax-this.itemA[e].nSize,tb)/Math.pow(this.nMax-this.nMin,tb)*(this.fillOpacity||1)*(this.nDopacityScale||1),Uc.style.setProperty("opacity",String(ta),"")):this.szFlag.match(/DOPACITY/)&&(tb=1/(this.nDopacityPow||1),ta=Math.pow(this.itemA[e].nSize-this.nMin,tb)/Math.pow(this.nMax-this.nMin,tb)*(this.fillOpacity||1)*(this.nDopacityScale||1),Uc.style.setProperty("opacity",String(ta),""))}if(this.szFlag.match(/\bVALUES\b/)&&!this.fHideValues){var dd="VectorPath"+
Math.random();T<0?(P="M"+T+","+fa+" C"+(T/2+m)+","+(fa/2-va)+" "+(T/4+m)+","+(fa/4-va)+" "+md+","+Ub,map.Dom.newShape("path",ia,P,"fill:none;stroke:none").setAttributeNS(null,"id",dd)):jb.setAttributeNS(null,"id",dd);c=Math.min(Qb,Math.sqrt(this.itemA[e].nSize)/Math.sqrt(this.nNormalSizeValue||this.nMaxSize)*this.nValueScale);c=24*map.Scale.normalX(c)*this.nChartGroupScaleY*this.nScale;var wd=this.formatValue(this.itemA[e].nSize,this.nValueDecimals||(this.itemA[e].nSize<1?2:0),"ROUND")+this.szUnit;
map.Dom.newTextOnPath(ia,dd,wd,"font-family:arial;font-size:"+c+"px;fill:"+this.chart.szColor+";stroke:#ffffff;stroke-width:"+Jb/10+"px;baseline-shift:-35%","40%")}ia.setAttributeNS(szMapNs,"class",typeof this.itemA[e].nClass!="undefined"?this.itemA[e].nClass:String(this.itemA[e].nValuesA[0]-1));ia.setAttributeNS(szMapNs,"tooltip",this.formatValue(this.itemA[e].nSize,this.nValueDecimals||(this.itemA[e].nSize<1?2:0),"ROUND")+this.szUnit);this.szTimeField&&(dc=(new Date(this.itemA[e].szTime)).getTime()||
this.itemA[e].szTime,ia.setAttributeNS(szMapNs,"time",dc));ia.fu.setMatrix([1,0,0,1,wb.x,wb.y])}}}}}else if(this.szFlag.match(/\bVECTOR\b/))this.nMinValue&&this.itemA[e].nSize<this.nMinValue||(wb=this.itemA[e].ptPos,lb=this.itemA[e].ptPos2||(this.szLabelA?this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[this.itemA[e].nValuesA[0]-1]):null),wb&&lb&&(ia=this.itemA[e].chartNode=map.Dom.newGroup(this.chartGroup,this.szId+":"+e+(e?":chartgroup":":ochrtgroup")),this.chart.szColor=this.szLineColor||
this.colorScheme[this.itemA[e].nValuesA[0]-1],Jb=this.nLineWidth||2/(this.nNormalSizeValue||1)/this.nMaxSize*this.itemA[e].nSize,jb=map.Dom.newShape("line",ia,0,0,lb.x-wb.x,lb.y-wb.y,"stroke:"+this.chart.szColor+";stroke-width:"+map.Scale.normalX((Jb||.1)*this.nChartGroupScaleY)+";stroke-opacity:"+(this.fillOpacity||.3)+";"),this.szFlag.match(/\bDASH\b/)&&(eb=1E3*this.nChartGroupScaleY,Eb=300*this.nChartGroupScaleY,jb.style.setProperty("stroke-dasharray",String(eb)+" "+String(Eb)),jb.style.setProperty("stroke-dashoffset",
"0"),Vb=Math.random()*eb,Va=Vb+eb+Eb,wc=Vb,map.Dom.constructNode("animate",jb,{attributeType:"XML",attributeName:"stroke-dashoffset",from:String(Va),to:String(wc),dur:"1s",repeatCount:"indefinite"})),this.szFlag.match(/\bPOINTER|ARROW\b/)&&(Tc=map.Dom.newNode("defs",ia),Gc=map.Dom.constructNode("marker",Tc,{id:this.szId+":"+Da+":chartgroup:ArrowMarker",markerWidth:"4",markerHeight:"4",refX:"4",refY:"2",orient:"auto",markerUnits:"strokeWidth"}),Uc=map.Dom.constructNode("path",Gc,{d:"M0,4 L4,2 L0,0 Z",
style:"fill:"+this.chart.szColor+";opacity:"+(this.fillOpacity||.3)*2+";stroke:white;stroke-width:0.1"}),jb.setAttributeNS(null,"marker-end","url(#"+this.szId+":"+Da+":chartgroup:ArrowMarker)")),ia.setAttributeNS(szMapNs,"class",typeof this.itemA[e].nClass!="undefined"?this.itemA[e].nClass:String(this.itemA[e].nValuesA[0]-1)),ia.setAttributeNS(szMapNs,"tooltip",this.formatValue(this.itemA[e].nSize,this.nValueDecimals||(this.itemA[e].nSize<1?2:0),"ROUND")+this.szUnit),ia.fu.setMatrix([1,0,0,1,wb.x,
wb.y])));else{ia=null;if(Da)if(ia=map.SVGDocument.getElementById(this.szId+":"+Da+":chart"))ia.fu=new Methods(ia);else if(ia=map.Dom.newGroup(this.chartGroup,this.szId+":"+Da+":chart"),this.szFlag.match(/BOX/)){var Vc="#bbbbbb";typeof this.szBorderColor!="undefined"&&(Vc=this.szBorderColor);var yc="stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3;";if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":yc="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";
break;case "dashed":yc="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":yc="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":yc="stroke-width:0;"}if(typeof this.szBorderWidth!="undefined")switch(this.szBorderWidth){case "thin":yc+="stroke-width:"+map.Scale.normalX(.3)+";";break;case "thick":yc+="stroke-width:"+map.Scale.normalX(1.5)+";"}var nd=map.Dom.newShape("rect",ia,0,0,1,1,"fill:"+(this.szBoxColor||"white")+";fill-opacity:"+(this.nBoxOpacity||
1)+";stroke:"+Vc+";"+yc);nd.setAttributeNS(null,"id",this.szId+":"+Da+":chart:box");nd.style.setProperty("pointer-events","none","");switch(this.szSymbolBoxStyle){case "frame":this.boxShape.setAttributeNS(null,"fill-opacity",0);break;case "field":this.boxShape.setAttributeNS(null,"fill-opacity",1)}}this.itemA[e].chartNode=ia;ia.setAttributeNS(szMapNs,"value",String(this.itemA[e].nValuesA[0]));Cb=this.drawChart(ia,e,a,this.szFlag);var xd=this.nScale;this.nScale=this.nAutoScale||this.nScale;var pc=
1;this.nMaxValue=="auto"&&(pc=1/Math.pow(this.nMax,1/3)*Math.pow(this.nMaxValuePlot,1/3),map.Themes.autoScale||(this.fAutoScaleLeader=!0,map.Themes.autoScale=[]),pc=map.Themes.autoScale[e]=map.Themes.autoScale[e]||pc);Cb&&v&&v.x!==void 0&&v.y!==void 0&&ia&&(this.szFlag.match(/PLOT/)&&this.nGridSize&&this.nAutoScale&&(Cb.x+=this.nGridSize/2/this.nAutoScale*pc,Cb.y-=this.nGridSize/2/this.nAutoScale*pc),this.szFlag.match(/NOSCALE/)?ia.fu.setMatrix([this.nScale,0,0,this.nScale,v.x-Cb.x*this.nScale,v.y-
Cb.y*this.nScale]):ia.fu.setMatrix([this.nChartGroupScaleX*pc,0,0,this.nChartGroupScaleY*pc,v.x-Cb.x*map.Layer.nObjectScale*this.nScale,v.y-Cb.y*map.Layer.nObjectScale*this.nScale]),this.itemA[e].ptPos&&this.itemA[e].ptPos2&&(ia.setAttributeNS(szMapNs,"xEnd",this.itemA[e].ptPos2.x),ia.setAttributeNS(szMapNs,"yEnd",this.itemA[e].ptPos2.y),ia.setAttributeNS(szMapNs,"dur",10)));this.nScale=xd;if(Cb){Da=Da.split("*")[0];if((this.szFlag.match(/MULTIPLE/)||this.szFlag.match(/ALIGN/))&&ia.lastChild.firstChild){var qa=
map.Dom.getBox(ia.lastChild),Kb=this.szFlag.match(/\bUP\b/)?qa.height:qa.width;if(this.chartPosA[Da]){this.chartPosA[Da]+=this.szFlag.match(/TEXTONLY/)?5:Kb*.5;var xb=ia.lastChild.fu.getPosition(),mb=Kb*(this.nGridX||10);this.szFlag.match(/\bUP\b/)?ia.lastChild.fu.setPosition(xb.x+qa.width*Math.floor(this.chartPosA[Da]/mb),xb.y-qa.y-qa.height/2-this.chartPosA[Da]%mb):ia.lastChild.fu.setPosition(xb.x+this.chartPosA[Da]%mb,xb.y-qa.height*Math.floor(this.chartPosA[Da]/mb));this.chartPosA[Da]+=this.szFlag.match(/TEXTONLY/)?
Kb:Kb*.5}else this.chartPosA[Da]=this.szFlag.match(/TEXTONLY/)?Kb:-qa.y;this.posItemA&&(this.posItemA[Da]||(this.posItemA[Da]=[]),this.posItemA[Da].push(this.itemA[e]))}else if((this.szFlag.match(/MULTIFIX/)||this.szFlag.match(/MULTIGRID/))&&ia.lastChild){Kb=1;var Lb=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1)),Hc=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1));if(v=this.getNodePosition(Da)){Da=String(v.x)+String(v.y);if(this.chartPosA[Da]){xb=ia.lastChild.fu.getPosition();
var pb=this.chartPosA[Da];mb=this.nGridX||7;this.szFlag.match(/\bUP\b/)?ia.lastChild.fu.setPosition(xb.x+Lb*Math.floor(pb/mb),xb.y-pb%mb*Hc):ia.lastChild.fu.setPosition(xb.x+pb%mb*Lb,xb.y-Hc*Math.floor(pb/mb));this.chartPosA[Da]+=Kb}else this.chartPosA[Da]=Kb;this.posItemA&&(this.posItemA[Da]||(this.posItemA[Da]=[]),this.posItemA[Da].push(this.itemA[e]));this.itemA[e].labelGroup&&pb%mb!=mb-1&&this.itemA[e].labelGroup.style.setProperty("display","none","")}}else if((this.szFlag.match(/MULTISQUARE/)||
this.szFlag.match(/MULTIQUAD/))&&ia.lastChild&&(Kb=1,Lb=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1)),Hc=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1)),v=this.getNodePosition(Da))){Da=String(v.x)+String(v.y);if(this.chartPosA[Da]){xb=ia.lastChild.fu.getPosition();pb=this.chartPosA[Da];var qb=Math.floor(Math.sqrt(pb));qb<(this.nGridX||1E7)?(mb=pb-qb*qb,T=mb<=qb?mb:qb,fa=mb<=qb?qb:qb-(mb-qb),ia.lastChild.fu.setPosition(xb.x+T*Lb,xb.y-fa*Hc)):(xb=ia.lastChild.fu.getPosition(),
pb=this.chartPosA[Da],mb=this.nGridX||7,this.szFlag.match(/\bUP\b/)?ia.lastChild.fu.setPosition(xb.x+Lb*Math.floor(pb/mb),xb.y-pb%mb*Hc):ia.lastChild.fu.setPosition(xb.x+pb%mb*Lb,xb.y-Hc*Math.floor(pb/mb)));this.chartPosA[Da]+=Kb}else this.chartPosA[Da]=Kb;this.posItemA&&(this.posItemA[Da]||(this.posItemA[Da]=[]),this.posItemA[Da].push(this.itemA[e]));this.itemA[e].labelGroup&&pb%mb!=mb-1&&this.itemA[e].labelGroup.style.setProperty("display","none","")}if(this.szFlag.match(/TEXTONLY/)&&map.fCheckLabelOverlap){var jc=
map.SVGDocument.getElementById(this.szId+":"+e+":text");jc&&new ixMap.Label.Item(jc)}l&&setRotate(ia,-Number(l));this.fShadow===!0&&map.SVGDocument.getElementById(map.szShadowFilterId)?ia.style.setProperty("filter","url(#"+map.szShadowFilterId+")",""):this.fShadow===!0&&(Qa=map.Dom.newNode("filter",this.chartGroup.parentNode),Qa.setAttributeNS(null,"id",map.szShadowFilterId),Qa.setAttributeNS(null,"filterUnits","objectBoundingBox"),Qa.setAttributeNS(null,"x","-50%"),Qa.setAttributeNS(null,"y","-50%"),
Qa.setAttributeNS(null,"width","200%"),Qa.setAttributeNS(null,"height","200%"),Ka=map.Dom.newNode("feGaussianBlur",Qa),Ka.setAttributeNS(null,"stdDeviation","10"),Ka.setAttributeNS(null,"result","BlurAlpha"),Ka=map.Dom.newNode("feOffset",Qa),Ka.setAttributeNS(null,"in","BlurAlpha"),Ka.setAttributeNS(null,"dx","10"),Ka.setAttributeNS(null,"dy","10"),Ka.setAttributeNS(null,"result","OffsetBlurAlpha"),Ka=map.Dom.newNode("feColorMatrix",Qa),Ka.setAttributeNS(null,"in","OffsetBlurAlpha"),Ka.setAttributeNS(null,
"type","matrix"),Ka.setAttributeNS(null,"values","0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0 0 0 1 0"),Ka.setAttributeNS(null,"result","matrixOut"),Ka=map.Dom.newNode("feMerge",Qa),$a=map.Dom.newNode("feMergeNode",Ka),$a.setAttributeNS(null,"in","matrixOut"),$a=map.Dom.newNode("feMergeNode",Ka),$a.setAttributeNS(null,"in","SourceGraphic"),qa=map.Dom.getBox(ia.lastChild),qa.width&&qa.height&&ia.style.setProperty("filter","url(#"+map.szShadowFilterId+")",""))}}}}if(this.szFlag.match(/BOX/))if(this.nBoxUpper&&
map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nBoxUpper||this.nBoxLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nBoxLower){var db=map.SVGDocument.getElementById(this.szId+":"+hb+":chart:box");db&&db.parentNode.removeChild(db)}else for(kb=0;kb<this.indexA.length;kb++)if(e=this.indexA[kb],this.itemA[e].fDone){var hb=this.itemA[e].szSelectionId;ia=map.SVGDocument.getElementById(this.szId+":"+hb+":chart");w=map.SVGDocument.getElementById(this.szId+":"+hb+":chartgroup");db=map.SVGDocument.getElementById(this.szId+
":"+hb+":chart:box");if(ia&&db&&!db.getAttributeNS(szMapNs,"boxed")){this.szFlag.match(/\bPLOT\b/)&&w&&w.style.setProperty("display","none");qa=map.Dom.getBox(ia);var Wb=map.Scale.normalX(this.nBoxMargin||2);Wb=Math.min(Wb*2,Wb*(qa.width/map.Scale.normalX(a)));var ac=new point(qa.x+qa.width/2,qa.y+qa.height/2);if(this.szFlag.match(/CIRCULAR/)){var Mb=Math.max(qa.width,qa.height)/2*1.1+Wb,ed=map.Dom.newShape("circle",db.parentNode,ac.x,ac.y,Mb,"fill:"+(this.szBoxColor||"#eeeeee")+";stroke:"+(this.szBorderColor||
"#dddddd")+";fill-opacity:"+(this.nBoxOpacity||1));db.parentNode.insertBefore(ed,db.parentNode.firstChild);db.parentNode.removeChild(db);qa.x-=(Mb*2-qa.width)/2;qa.y-=(Mb*2-qa.height)/2;qa.height=qa.width=Mb*2}if(this.szFlag.match(/TITLE/)&&this.szTitleField&&(!this.szTitleUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nTitleUpper)&&(!this.szTitleLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nTitleLower)){c=map.Scale.normalX(5);this.szFlag.match(/DTEXT/)&&(c=Math.max(map.Scale.normalX(.9),
Math.min(qa.width/5,map.Scale.normalX(14/this.nScale))));this.szFlag.match(/GRIDSIZE/)&&(c=Math.max(qa.width/10,map.Scale.normalX(6)));c*=this.nTextScale||this.nValueScale||1;var bc=this.itemA[e].szTitle;try{bc=map.HTMLWindow.ixmaps.htmlgui_onInfoTitle(this.itemA[e].szTitle,this.itemA[e])}catch(gb){}bc+=this.szTitleUnits||"";var Wa=this.szTextColor||"#888888",qc=this.szFlag.match(/BOTTOMTITLE/)?qa.y+qa.height+c*1:qa.y-c*.7;this.szFlag.match(/BAR/)&&!this.szFlag.match(/BOTTOMTITLE/)&&(qc=this.nMaxValue?
-this.nMaxValue*a/this.nScale:qc);var Xb=null,ma=null;this.szFlag.match(/CIRCULAR/)?(ma=map.Dom.newText(ia,ac.x+10,qc,"font-family:arial;font-size:"+c+"px;text-anchor:middle;fill:none;stroke:white;stroke-width:"+c/7+"px;opacity:0.5;pointer-events:none;",String(bc||" ")),Xb=map.Dom.newText(ia,ac.x+10,qc,"font-family:arial;font-size:"+c+"px;text-anchor:middle;fill:"+Wa+";stroke:none;pointer-events:none;",String(bc||" "))):this.szAlign&&this.szAlign.match(/right/)?(ma=map.Dom.newText(ia,qa.x+qa.width,
qc,"font-family:arial;font-size:"+c+"px;text-anchor:end;fill:none;stroke:white;stroke-width:"+c/7+"px;opacity:0.5;pointer-events:none;",String(bc||" ")),Xb=map.Dom.newText(ia,qa.x+qa.width,qc,"font-family:arial;font-size:"+c+"px;text-anchor:end;fill:"+Wa+";stroke:none;pointer-events:none;",String(bc||" "))):(ma=map.Dom.newText(ia,qa.x,qc,"font-family:arial;font-size:"+c+"px;text-anchor:start;fill:none;stroke:white;stroke-width:"+c/7+"px;opacity:0.5;pointer-events:none;",String(bc||" ")),Xb=map.Dom.newText(ia,
qa.x,qc,"font-family:arial;font-size:"+c+"px;text-anchor:start;fill:"+Wa+";stroke:none;pointer-events:none;",String(bc||" ")));map.Dom.wrapText(ma,qa.width);var yb=map.Dom.wrapText(Xb,qa.width);this.szFlag.match(/BOTTOMTITLE/)||(ma.fu.setPosition(Xb.fu.getPosition().x,Xb.fu.getPosition().y-c*1*(yb-1)),Xb.fu.setPosition(Xb.fu.getPosition().x,Xb.fu.getPosition().y-c*1*(yb-1)));if(this.szFlag.match(/CLIPPEDTITLE/)){var zc=qa.height;qa.height+=c*1.8;qa.y-=qa.height-zc;map.Dom.setClipRect(Xb,new box(qa.x,
qa.y-c*10,qa.width-c/3,c*20))}else qa=map.Dom.getBox(ia),qa.y+=c*.1,qa.height-=c*.1;this.szTimeField&&(dc=(new Date(this.itemA[e].szTime)).getTime()||this.itemA[e].szTime,Xb.setAttributeNS(szMapNs,"time",dc))}if(this.szFlag.match(/\bPLOTX\b/))zc=qa.height,qa.height=map.Scale.normalX(a),qa.y=-map.Scale.normalX(a/2),qa.width=this.nMax*map.Scale.normalX(a*1.1)/this.nMax*5*(this.nRangeScale||1);else if(this.szFlag.match(/\bPLOTY\b/)){zc=qa.height;var Nb=qa.width;qa.width=map.Scale.normalX(a);qa.height=
this.nMax*map.Scale.normalX(a*1.1)/this.nMax*5*(this.nRangeScale||1);qa.x-=(qa.width-Nb)/2;qa.y-=(qa.height-zc)/2}var yd=qa.height+Wb*2;qa.width+Wb*2>=0&&yd>=0&&(db.setAttributeNS(null,"x",qa.x-Wb),db.setAttributeNS(null,"y",qa.y-Wb),db.setAttributeNS(null,"width",qa.width+Wb*2),db.setAttributeNS(null,"height",qa.height+Wb*2));(this.szFlag.match(/AUTOSIZE/)||this.szFlag.match(/GRIDSIZE/))&&qa.width>qa.height&&(db.setAttributeNS(null,"y",qa.y-Wb-(qa.width-qa.height)),db.setAttributeNS(null,"height",
qa.width+Wb*2));if(typeof this.nBorderRadius!="undefined"&&!isNaN(this.nBorderRadius)){var ya=Math.min(map.Scale.normalX(this.nBorderRadius),map.Scale.normalX(this.nBorderRadius*(qa.width/map.Scale.normalX(a))));db.setAttributeNS(null,"rx",ya);db.setAttributeNS(null,"ry",ya)}var od=map.Scale.normalX((this.szBorderWidth||1)*.2*(qa.width/map.Scale.normalX(a)));db.style.setProperty("stroke-width",od);db.setAttributeNS(szMapNs,"boxed","1");this.szFlag.match(/\bPLOT\b/)&&w&&w.style.setProperty("display",
"inline");this.szTimeField&&(dc=(new Date(this.itemA[e].szTime)).getTime()||this.itemA[e].szTime,db.setAttributeNS(szMapNs,"time",dc))}}if(this.szFlag.match(/FEATURE/)){map.Themes.addToThemeNodesCache(this.chartGroup);var kc=map.Themes.getAllThemes();for(p in kc)kc[p]!=this&&!kc[p].szFlag.match(/FEATURE/)&&kc[p].szThemesA.includes(this.szThemesA[0])&&kc[p].fDone&&(kc[p].fRealize=!0,setTimeout("map.Themes.execute()",500),kc[p].coTableType=="ext"&&kc[p].coTableQuery&&setTimeout('map.Themes.refreshTheme("'+
kc[p].szId+'")',500))}this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);this.markedClass!=null&&this.markClass(this.markedClass,1);this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;displayProgressBar(1,1,"",1,"",1);this.showInfo();this.szFlag.match(/SHOWSTATISTIC/)&&this.showErrorInfo();if(this.szFlag.match(/\bCLIP\b/))if(this.nClipFrames==this.itemA[e].nValuesA.length)this.szXaxisA&&this.szXaxisA[this.nActualFrame]?displayMessage(this.szXaxisA[this.nActualFrame],
3E3,"big"):this.szLabelA&&this.szLabelA[this.nActualFrame]&&displayMessage(this.szLabelA[this.nActualFrame],3E3,"big");else{var fd=this.szXaxisA||this.szLabelA;fd&&(this.nActualFrame===0?displayMessage(fd[0],3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(fd[1],3E3,"big"):displayMessage(" ... ",3E3,"big"))}else this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();this.fSorted||(this.fResort=!0,map.Themes.execute());this.szFlag.match(/DECLUTTER/)&&
this.declutterCharts();this.szFlag.match(/\bANIMATESCALE\b/)&&this.animateCharts("scale");this.szFlag.match(/\bANIMATESCALEXX\b/)&&this.animateCharts("fire");if(this.szFlag.match(/\bUSER\b/))try{if(la={target:this.chartGroup,theme:this},this.userDraw){this.opt=la;try{if(this.userDraw&&/^[a-zA-Z_$][a-zA-Z0-9_$.]*$/.test(this.userDraw)){var Wc=null;ka=this.userDraw+"_finish";if(ka.indexOf(".")!==-1){Sa=ka.split(".");Ma=window;for(p=0;p<Sa.length;p++)if(Ma&&Ma[Sa[p]])Ma=Ma[Sa[p]];else{Ma=null;break}Ma&&
typeof Ma==="function"&&(Wc=Ma)}else map.HTMLWindow&&map.HTMLWindow.ixmaps&&map.HTMLWindow.ixmaps[ka]&&(Wc=map.HTMLWindow.ixmaps[ka]);typeof Wc==="function"&&Wc(map.SVGDocument,this.opt)}}catch(gb){console.error("Error calling userDraw_finish: "+gb.message)}delete this.opt}}catch(gb){}}};A.prototype.sortChartObjects=function(){if(!(!this.chartGroup||this.szFlag.match(/NOSRT/)||this.szFlag.match(/NOSIZE/)&&!this.szFlag.match(/3D/)||this.szFlag.match(/CATEGORICAL/)&&!this.szFlag.match(/AGGREGATE/)&&
!this.szSizeField)){var d=[],a=this.chartGroup.childNodes;if(this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/TEXTONLY/)||this.szFlag.match(/SYMBOL/))for(var g=0;g<a.length;g++){var b=a.item(g);d[g]={node:b,y:Math.abs(Number(b.getAttributeNS(szMapNs,"value")||0))}}else{var r=getRotateAttributeValue(map.Scale.canvasNode)/180*Math.PI;for(g=0;g<a.length;g++)b=a.item(g),d[g]=r?{node:b,y:getTranslate(b).x*Math.sin(r)+getTranslate(b).y*Math.cos(r)}:
{node:b,y:getTranslate(b).y}}this.szFlag.match(/\bSORT\b/)&&this.szFlag.match(/\bUP\b/)&&!this.szFlag.match(/SEQUENCE/)?d.sort(this.sortDownChartObjectsCompare):d.sort(this.sortUpChartObjectsCompare);for(g=0;g<d.length;g++)d[g].node.parentNode.appendChild(d[g].node);var n;(n=getMatrix(this.chartGroup))&&setMatrix(this.chartGroup,n)}};A.prototype.sortUpChartObjectsCompare=function(d,a){return d.y-a.y};A.prototype.sortDownChartObjectsCompare=function(d,a){return a.y-d.y};A.prototype.getChartSize=function(d,
a,g,b){if(g.match(/NOSIZE/))return Math.max(5,a/4);b=Math.abs(b);var r=Math.max(5,a/2),n=this.nMax-this.nMin;this.nNormalSizeValue&&(n=this.nMaxSize=this.nNormalSizeValue);var v=this.itemA[d].nValue100A[0];g.match(/SIZE/)&&!g.match(/NORMSIZE/)&&this.szSizeField&&d&&this.itemA[d]?r=g.match(/SIZELOG/)?Math.max(1,r/Math.log(this.nMaxSize)*Math.log(this.itemA[d].nSize)):r/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[d].nSize,1/this.nSizePow):g.match(/SIZE/)&&!g.match(/NORMSIZE/)&&(r=g.match(/SIZELOG/)?
Math.max(1,r/Math.log(n)*Math.log(b)):r/Math.pow(n,1/this.nSizePow)*Math.pow(b,1/this.nSizePow));map.Scale.normalX(10);!g.match(/HEIGHT/)||g.match(/NORMSIZE/)||g.match(/SIZE/)||v&&this.nMax100&&this.nMin100&&g.match(/FRACTION/);g.match(/ZOOM/)&&(this.origSize=r*=map.Scale.nObjectScaling,r=a/10+r*1/(Math.log(Math.abs(n))*Math.log(Math.abs(b))||1),r=Math.min(r,a),r=Math.max(r,a/5));return Math.abs(r)};A.prototype.checkChartSize=function(d,a,g,b){return this.nChartSizeMin&&!g.match(/ZOOM/)&&this.getChartSize(d,
a,g,b)/map.Layer.nObjectScale<this.nChartSizeMin?!1:!0};A.prototype.getChart=function(d,a,g,b,r){this.fRealizeDone||this.realize();return this.drawChart(d,a,g,b,r)};A.prototype.drawChart=function(d,a,g,b,r){var n=null,v=0,c=0;this.szChartFlag=b;if(a){if(!this.itemA[a])return null;this.itemA[a].fDone=!1;n=this.itemA[a].nValuesA;v=this.itemA[a].nValue100A[0];c=Math.max(this.nMax,Math.abs(this.nMin));var e=0;if(!this.szFlag.match(/BUFFER/))for(var f=0;f<n.length;f++)isNaN(n[f])&&(n[f]=0),e+=n[f];if(this.szFlag.match(/MORPH/)&&
this.szFlag.match(/\bCLIP\b/)&&this.nClipFrames){n=[];var m=this.itemA[a].nValuesA;for(f=0;f<m.length/2;f++){var l=m[f]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+m[f+m.length/2]*this.nActualFrame/(this.nClipFrames-1);n[f]=l}for(f=e=0;f<n.length;f++)isNaN(n[f])&&(n[f]=0),e+=n[f]}if(b.match(/NOPE/))return new point(0,0);if(b.match(/\bDOT\b/)){var h=1;l=n[0];if(b.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[l];else if(this.colorScheme.length>2||this.szRanges&&this.szRanges.length)for(Ub=
!1,f=0;f<this.partsA.length;f++)if(l<this.partsA[f].max){this.chart.szColor=this.colorScheme[f];var p=O(J);b.match(/NOLINES/)?this.chart.szLineColor="none":this.chart.szLineColor=p.textColor;b.match(/RANGE/)&&!b.match(/RANGES/)&&(h=map.Scale.normalX(2+5*(f+1)/this.partsA.length));ta=f;Ub=!0;break}F=map.Dom.newShape("circle",d,0,0,map.Scale.normalX(3),"fill:"+this.chart.szColor+";stroke:none;");return new point(0,0)}}else{n=[];e=0;b=b||this.szFlag+"|XAXIS";if(this.szOrigFlag.match(/CATEGORICAL/))if(this.szOrigFlag.match(/SUM/))for(f=
0;f<this.colorScheme.length;f++)this.partsA[f]&&(n[f]=this.partsA[f].nSum,c=Math.max(c,this.partsA[f].nSum),e+=n[f]);else if(this.szOrigFlag.match(/COUNT/))for(f=0;f<this.colorScheme.length;f++)n[f]=this.partsA[f].nSum*100,c=Math.max(c,this.partsA[f].nSum*100),e+=n[f];else for(f=0;f<this.colorScheme.length;f++)n[f]=this.nOrigSumA[f]||this.exactCountA[f]||1,c=Math.max(c,this.nOrigSumA[f]||this.exactCountA[f]||1);else if(this.szOrigFlag.match(/COUNT/))for(f=0;f<this.colorScheme.length;f++)n[f]=this.partsA[f].nCount,
c=Math.max(c,this.partsA[f].nCount),e+=n[f];else for(f=0;f<this.colorScheme.length;f++)n[f]=this.partsA[f].nSum,c=Math.max(c,this.partsA[f].nSum),e+=n[f];if(v=this.nSum100){c=0;e=v;for(f=n.length-1;f>=0;f--)this.szFlag.match(/DIFFERENCE/)?v=f>0?n[f-1]:this.nSum100:this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?n[f]=n[f]:this.szFlag.match(/PRODUCT/)?n[f]=n[f]:(n[f]/=v,c=Math.max(c,n[f]),this.szFlag.match(/PERMILLE/)?n[f]*=1E3:this.szFlag.match(/FRACTION/)||(n[f]*=100),this.szFlag.match(/RELATIVE/)&&
(n[f]-=100),this.szFlag.match(/INVERT/)&&(n[f]=100-n[f]));if(this.szFlag.match(/STACKED/)){if(c=100,this.szFlag.match(/NORMSIZE/)||b.match(/NORMSIZE/))for(f=c=0;f<n.length;f++)c+=n[f]}else c*=100,c+=c/10,c=this.nMax}else{if(this.szFlag.match(/DIFFERENCE/))for(f=n.length-1;f>=0;f--)f>0?n[f]-=n[f-1]:this.szFlag.match(/STACKED/)||(n[f]=0);if(a&&this.szAggregation&&this.szAggregation.match(/mean/)){for(f=0;f<n.length;f++)n[f]/=this.nCount;c=this.szFlag.match(/MENUSIZE/)?c/this.nCount:this.nMax}if(this.szFlag.match(/MEAN/))for(f=
0;f<n.length;f++)n[f]/=this.partsA[f].nCount;if(this.szFlag.match(/STACKED/)&&(this.szFlag.match(/NORMSIZE/)||b.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||b.match(/MENUSIZE/)))for(f=c=0;f<n.length;f++)c+=n[f]}}if(this.nChartSizeMin&&!b.match(/ZOOM/)){if(h=a?this.getChartSize(a,g,b,e):1,h/map.Layer.nObjectScale<this.nChartSizeMin)return null}else if(!this.szFlag.match(/MULTIFIX|MULTIGRID|MULTIQUAD/)&&(h=a?this.getChartSize(a,g,b,e):1,isNaN(h)||h===0))return null;var B=new point(0,0);if(!b)b=
this.szFlag;else if(!b.match(/CHART/)&&b.match(/VALUES/)||b.match(/NORMSIZE/)||b.match(/MENUSIZE/))b=this.szFlag+"|"+b;b.match(/DOMINANT|COMPOSE/)&&!b.match(/CHART/)&&(b=b.match(/PERCENTOFMEAN/)?"BAR|OFFSETMEAN|POINTER|XAXIS|VALUES|ZOOM":b.match(/PERCENTOFMEDIAN/)?"BAR|OFFSETMEDIAN|POINTER|XAXIS|VALUES|ZOOM":b.match(/DEVIATION/)?"BAR|DEVIATION|POINTER|VALUES|ZOOM":"BAR|XAXIS|HORZ|SORT|VALUES|ZOOM");b.match(/ZOOM/)&&b.match(/BAR/)&&b.match(/POINTER/)&&n.length>1&&(b=this.removeDefinition(b,"SIZE")+
"|COMPRESSMAX");if(n.length==1&&n[0]===0&&!b.match(/ZEROISVALUE|AUTOCOMPLETE|CATEGORICAL/))return this.nZeroValueCount++,null;b.match(/VALUES/)&&(this.fHideValues=!1,b.match(/ZOOM/)||(this.fHideValues=this.szValueUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nValueUpper||this.szValueLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nValueLower),b.match(/ZOOM/)&&b.match(/PIE/)&&n.length>25&&(b=this.removeDefinition(b,"VALUES")));var C=map.Dom.newGroup(d,this.szId+":"+a+(a?":chartgroup":
":ochrtgroup")),N=null,Y=null;b.match(/MOVABLE/)&&(C.setAttributeNS(null,"id",C.getAttributeNS(null,"id")+":movable"),C.setAttributeNS(null,"onmousedown",'map.Themes.initChartOffset(evt,"'+this.szId+'","'+this.szId+":"+a+':chartgroup:movable")'),C.setAttributeNS(null,"onmouseup",'map.Themes.endChartOffset(evt,"'+this.szId+'","'+this.szId+":"+a+':chartgroup:movable")'));if(b.match(/CHOROPLETH/)){var M=map.Scale.normalX(g/2),w=M*2/3,J=this.colorScheme[0],L=this.colorScheme[1]?this.colorScheme[1]:"none",
G=map.Scale.normalX(.1)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling,F=map.Dom.constructNode("use",C,{"xlink:href":"#choropleth_icon"});F.fu.scale(2,2);g=w*2/map.Scale.normalX(1);B.x=0;B.y=w+map.Scale.normalY(5)}if(b.match(/BLANK/))return null;if(b.match(/\bUSER\b/))try{M=map.Scale.normalX(g/2);if(b.match(/AUTOSIZE/)){var V=map.Layer.nDynamicObjectScale,la=b.match(/\bRECT\b/)?b.match(/GAP/)?2.3:2:b.match(/GAP/)?1.7:1.6;U=Math.max(this.nAllMaxValue,this.nMax);M=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/
la/V:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/la/V:M}var U=Math.max(this.nMax,this.nMaxA[0]);this.nNormalSizeValue&&(this.nMaxSize=U=this.nNormalSizeValue);l=this.itemA[a].nValuesA[0];J=this.colorScheme[0];L=this.colorScheme[1]?this.colorScheme[1]:"none";var ka=this.colorScheme[1]?this.colorScheme[1]:"white";if(this.colorScheme.length>2||b.match(/CATEGORICAL/))J=this.colorScheme[this.colorScheme.length-1],L=this.colorScheme[0];b.match(/NOLINES/)?L="none":L=="none"&&(p=
O(J),L=p.lowColor);if(b.match(/CATEGORICAL/))ta=l-1,J=this.colorScheme[ta]||this.colorScheme[0],p=O(J),ka=p.textColor,L=b.match(/NOLINES/)?"none":p.lowColor,b.match(/RANGE/)&&!b.match(/RANGES/)&&(w=map.Scale.normalX(2+5*(f+1)/this.partsA.length)),Ub=!0;else if(this.szFlag.match(/COMPOSECOLOR/))this.szFlag.match(/SUBTRACTIVE/)?this.itemA[a].szColor=pa(this.itemA[a].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):this.itemA[a].szColor=ja(this.itemA[a].nValuesA,this.colorScheme,
this.nMax,Math.floor(this.nBrightness*255));else if(this.colorScheme.length>2||this.partsA.length>1||this.szRanges&&this.szRanges.length)if(Ub=!1,this.szFlag.match(/DOMINANT/)){var Sa=0,Ma=0;ma=-1;for(f=0;f<this.itemA[a].nValuesA.length;f++){l=this.itemA[a].nValuesA[f];var Na=100/this.nMeanA[f]*l,Qa=100/this.nMedianA[f]*l,Ka=(l-this.nMeanA[f])/this.nDeviationA[f];Sa=l;this.szFlag.match(/PERCENTOFMEAN/)&&(Sa=Na);this.szFlag.match(/PERCENTOFMEDIAN/)&&(Sa=Qa);this.szFlag.match(/DEVIATION/)&&(Sa=Ka);
l>this.nFilterA[f]&&Sa>Ma&&(this.itemA[a].nClass=f,Ma=Sa,ma=f)}ma>=0&&(this.itemA[a].nDominant=ma,l=this.itemA[a].nValuesA[ma],T=" "+this.szFieldsA[ma]+" ",this.szLabelA&&this.szLabelA[ma]&&(T=" "+this.szLabelA[ma]+" "),this.itemA[a].nValue=this.itemA[a].nValuesA[ma],this.itemA[a].szLabel=T,J=this.colorScheme[ma],p=O(J),ka=p.textColor,L=b.match(/NOLINES/)?"none":p.lowColor,ta=ma,Ub=!0,l=n[ta||0])}else for(f=0;f<this.partsA.length;f++)if(l>=this.partsA[f].min&&l<this.partsA[f].max){J=this.colorScheme[f];
p=O(J);ka=p.textColor;L=b.match(/NOLINES/)?"none":p.lowColor;b.match(/RANGE/)&&!b.match(/RANGES/)&&(w=map.Scale.normalX(2+5*(f+1)/this.partsA.length));ta=f;Ub=!0;break}if(this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(this.nClipFrames==n.length?(l=Number(n[this.nActualFrame]),U=this.nNormalSizeValue||this.nMaxA[this.nActualFrame]):l=n[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+n[n.length-1]*this.nActualFrame/(this.nClipFrames-1),l===0&&!b.match(/ZEROISVALUE/))||
b.match(/INVERTSIZE/)&&U-n[0]===0&&!b.match(/ZEROISVALUE/))return null;var $a=a&&this.itemA[a]&&this.szSizeField?this.itemA[a].nSize||0:l,kb=a&&this.itemA[a]&&this.szSizeField?this.nMaxSize:U;if($a===0&&!b.match(/NOSIZE/)||this.nMinValue&&$a<this.nMinValue)return null;w=b.match(/GRIDSIZE/)?this.nGridSize:b.match(/MENUSIZE/)?map.Scale.normalX(g/2.5):b.match(/CATEGORICAL/)&&!this.szSizeField?M/3/(this.nNormalSizeValue||1):b.match(/NOSIZE/)?M/2:b.match(/FIXSIZE/)?M/2/(this.nNormalSizeValue||1):b.match(/NORMSIZE/)?
M*2/3/(b.match(/CATEGORICAL/)?1:Math.log(kb)*Math.log(Math.abs($a))):b.match(/SUM/)&&!a?M*2/3:M/Math.pow(kb,1/this.nSizePow)*Math.pow(Math.abs($a),1/this.nSizePow);C.parentNode.setAttributeNS(szMapNs,"value",String(l));C.parentNode.setAttributeNS(szMapNs,"class",String(ta));var ia=O(J).lowColor,Da=this.objThemesA[this.szThemesA[0]],Cb={target:C,theme:this,item:this.itemA[a],value:l,values:n,size:w,maxSize:M,color:J,textcolor:ia,ccolor:O(J),class:ta,flag:b,mark:r,dbRecord:Da.dbRecords?Da.dbRecords[this.itemA[a].dbIndex]:
null};this.ptNullUser=null;if(this.userDraw){this.opt=Cb;try{if(this.userDraw&&/^[a-zA-Z_$][a-zA-Z0-9_$.]*$/.test(this.userDraw)){var Bb=null;if(this.userDraw.indexOf(".")!==-1){var Hb=this.userDraw.split("."),Zb=window;for(f=0;f<Hb.length;f++)if(Zb&&Zb[Hb[f]])Zb=Zb[Hb[f]];else{Zb=null;break}Zb&&typeof Zb==="function"&&(Bb=Zb)}else map.HTMLWindow&&map.HTMLWindow.ixmaps&&map.HTMLWindow.ixmaps[this.userDraw]&&(Bb=map.HTMLWindow.ixmaps[this.userDraw]);typeof Bb==="function"&&(this.ptNullUser=Bb(map.SVGDocument,
this.opt))}}catch(zd){console.error("Error calling userDraw: "+zd.message)}delete this.opt}else this.ptNullUser=map.HTMLWindow.ixmaps.htmlgui_drawChart(map.SVGDocument,Cb);this.ptNullUser?(C.fu.setPosition(C.fu.getPosition().x-this.ptNullUser.x,C.fu.getPosition().y-this.ptNullUser.y),this.ptNullUser.x=0,this.ptNullUser.y=0):this.userChartDrawError=(this.userChartDrawError||0)+1}catch(zd){}if(b.match(/PIE/)){if(e===0&&!b.match(/AUTOCOMPLETE/))return null;if(b.match(/\bSORT\b/)){this.sortedIndex=[];
for(f=0;f<n.length;f++)this.sortedIndex[f]={index:f,value:n[f]};this.sortedIndex.sort(this.sortIndexDown)}else this.sortedIndex=null;if(b.match(/\bREVERSE\b/))for(this.sortedIndex=[],f=0;f<n.length;f++)this.sortedIndex[f]={index:n.length-f,value:n[f]};this.nCenterValue=0;if(b.match(/CENTER/)){for(var Ya=this.nCenter=0,vc=-Number.MAX_VALUE,dc=Number.MAX_VALUE,rb=0;rb<(this.nClipParts||n.length);rb++){var Ta=this.sortedIndex?this.sortedIndex[rb].index:rb;Ya+=n[Ta]||0;n[Ta]<dc&&(dc=n[Ta],this.nCenterMin=
Ta);n[Ta]>vc&&(vc=n[Ta],this.nCenterMax=Ta)}this.szCenterPart=this.szCenterPart||"max",this.szCenterPart=="first"?this.nCenter=0:this.szCenterPart=="last"?this.nCenter=n.length-1:this.szCenterPart=="min"?this.nCenter=this.nCenterMin:this.szCenterPart=="max"?this.nCenter=this.nCenterMax:Number(this.szCenterPart)&&(this.nCenter=Number(this.szCenterPart));this.nCenterValue=n[this.nCenter];this.nCenterSize=this.nCenterValue/Ya*200}var ob=0;h=Math.max(5,g/2);var na=this.nMax-this.nMin,jb=this.nMax100-
this.nMin100;this.nNormalSizeValue&&(na=jb=this.nNormalSizeValue);b.match(/GRIDSIZE/)&&!b.match(/NORMSIZE/)?h=this.nGridSize/g*(b.match(/\bRECT\b/)?.72:.6):b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&this.szSizeField&&a&&this.itemA[a]?h=b.match(/SIZELOG/)?Math.max(1,h/Math.log(this.nMaxSize)*Math.log(this.itemA[a].nSize)):h/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[a].nSize,1/this.nSizePow):b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&(h=b.match(/SIZELOG/)?Math.max(1,h/Math.log(na)*Math.log(e)):
h/Math.pow(na,1/this.nSizePow)*Math.pow(e,1/this.nSizePow));ob=map.Scale.normalX(10);b.match(/HEIGHT/)&&!b.match(/NORMSIZE/)&&(ob=b.match(/SIZE/)?this.szSizeField&&a&&this.itemA[a]?ob*Math.pow(10/na*this.itemA[a].nSize,1/3)*3:ob*Math.pow(10/na*e,1/3)*3:v&&this.nMax100&&this.nMin100&&!b.match(/FRACTION/)?ob*10/jb*v:ob*10/na*e);b.match(/ZOOM/)&&(this.origSize=h*=map.Scale.nObjectScaling,h=g/10+h*3/Math.log(na)*Math.log(e)*map.Layer.nDynamicObjectScale,h=Math.min(h,g*1.2),h=Math.max(h,g/2));for(var k=
[],u=0;u<(this.nGridX||1);u++){var q=DonutCharts.newChart(map.SVGDocument,C,0,0,map.Scale.normalX(h),0);q.ident=u;B.x=0;B.y=map.Scale.normalY(h)+map.Scale.normalY(5);q.setStyle("flat");q.setLine("#555566");q.setLineWidth(map.Scale.normalX(this.nLineWidth||.1));b.match(/NOLINES/)&&q.setLine("none");b.match(/WHITELINES/)&&q.setLine("white");this.szLineColor&&q.setLine(this.szLineColor);if(b.match(/3D/)){q.setStyle("3D");var z=.5;b.match(/P3/)?z=1/3:b.match(/P4/)&&(z=.25);b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&
this.szSizeField&&a&&this.itemA[a]?ob=ob/Math.pow(this.nMaxSize,z)*Math.pow(this.itemA[a].nSize,z):b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&(ob=ob/Math.pow(na,z)*Math.pow(e,z));b.match(/ZOOM/)&&(ob*=map.Scale.nObjectScaling,ob=ob/this.origSize*h);B.y*=.7}b.match(/VOLUME/)&&q.addStyle("VOLUME");if(b.match(/DONUT/))b.match(/3D/)?q.setRadInner(map.Scale.normalX(h*.5)):b.match(/XTHIN/)?q.setRadInner(map.Scale.normalX(h*.95)):b.match(/THIN/)?q.setRadInner(map.Scale.normalX(h*.66)):b.match(/THICK/)?q.setRadInner(map.Scale.normalX(h*
.25)):q.setRadInner(map.Scale.normalX(h*.42));else if(b.match(/CENTER/)){var D=Math.sqrt(Math.pow(map.Scale.normalX(h),2)/100*this.nCenterSize);q.setRadInner(D)}b.match(/STARBURST/)&&(q.addStyle("STARBURST"),B.y*=.8);if(b.match(/XLFLOWER/)||b.match(/XLRAYS/))q.addStyle("XLRAYS"),B.y*=.8;else if(b.match(/LFLOWER/)||b.match(/LRAYS/))q.addStyle("LRAYS"),B.y*=.8;else if(b.match(/XSFLOWER/)||b.match(/XSRAYS/))q.addStyle("XSRAYS"),B.y*=.8;else if(b.match(/SFLOWER/)||b.match(/SRAYS/))q.addStyle("SRAYS"),
B.y*=.8;else if(b.match(/FLOWER/)||b.match(/RAYS/))q.addStyle("RAYS"),B.y*=.8;b.match(/SILENT/)&&q.addStyle("SILENT");b.match(/AUTOCOMPLETE/)&&(q.addStyle("AUTOCOMPLETE"),q.szNoDataColor=this.szNoDataColor||"#eeeeee");b.match(/BIGTOTOP/)&&q.addStyle("BIGTOTOP");b.match(/NOROTATE/)&&q.addStyle("NOROTATE");b.match(/ROTATE/)&&q.addStyle("ROTATE");b.match(/SYMMETRIC/)&&q.addStyle("SYMMETRIC");b.match(/HALFPLUS20/)&&(q.addStyle("HALFPLUS20"),q.addStyle("NOROTATE"));b.match(/HALFMINUS20/)&&(q.addStyle("HALFMINUS20"),
q.addStyle("NOROTATE"));b.match(/HALFPLUS10/)&&(q.addStyle("HALFPLUS10"),q.addStyle("NOROTATE"));b.match(/HALFMINUS10/)&&(q.addStyle("HALFMINUS10"),q.addStyle("NOROTATE"));b.match(/HALF/)&&(q.addStyle("HALF"),q.addStyle("NOROTATE"));b.match(/DIRECTION/)&&q.addStyle("DIRECTION");b.match(/DIRECTED/)&&q.addStyle("DIRECTED");b.match(/POLAR/)&&u==(this.nGridX||1)-1&&q.addStyle("POLAR");var E=0,K=0;U=0;if(b.match(/DONUT/))for(f=0;f<n.length;f++)n[f]>n[E]&&(E=f),n[f]<n[K]&&(K=f);if(b.match(/STARBURST/)){for(f=
0;f<n.length;f++)n[f]=Math.max(n[f],0),U=Math.max(U,this.nMaxA[f]);b.match(/\bSIZE\b/)||q.setNormalSizeValue(this.nNormalSizeValue||this.nMaxValue||U);q.setMaxValue(this.nMaxValue||U)}b.match(/BOW/)&&(q.nBow=1.3);b.match(/SBOW/)&&(q.nBow=1.2);b.match(/XSBOW/)&&(q.nBow=1.1);b.match(/LBOW/)&&(q.nBow=1.5);b.match(/XLBOW/)&&(q.nBow=1.8);k.push(q)}for(f=0;f<(this.nClipParts?Math.min(this.nClipParts,n.length):n.length);f++){var P=f%(this.nGridX||1);q=k[P];var T="";Ta=f;this.sortedIndex&&(Ta=this.sortedIndex[Ta].index);
var fa=Ta;if(!b.match(/CENTER/)||b.match(/DONUT/)||Ta!=this.nCenter){T=this.szLabelA&&this.szLabelA[Ta]?" '"+this.szLabelA[Ta]+"'":" '"+this.szFieldsA[Ta]+"'";J=a?this.itemA[a].szColor||this.colorScheme[Ta]:this.colorScheme[Ta];J=a?this.itemA[a].szColor||this.colorScheme[Ta%(this.nGridX||1E5)]:this.colorScheme[Ta%(this.nGridX||1E6)];if(b.match(/CLASSES/)||n.length==1)for(ub=0;ub<this.partsA.length;ub++)if(b.match(/CATEGORICAL/)&&n[Ta]==this.partsA[ub].min||!b.match(/CATEGORICAL/)&&n[Ta]<this.partsA[ub].max){J=
this.colorScheme[ub];fa=ub;break}var wa=(b.match(/AUTOCOMPLETE/)&&!this.szUnit.match(/%/)?" % ":"")+this.szUnit;if(this.szShowParts){var Fa=J;J="none";for(rb in this.szShowPartsA)this.szShowPartsA[rb]==Ta&&(J=Fa)}if(n[Ta]>0||n[Ta]===0&&!b.match(/ZEROISNOTVALUE/)){if(b.match(/COUNT/)&&this.itemA[a].nCountA)var Ha=q.addPart(n[Ta],ob,J,0,this.formatValue(this.itemA[a].nCountA[Ta],this.nValueDecimals||(this.itemA[a].nCountA[Ta]<1?2:0),"ROUND")+wa,T);else P==0&&(bc=0),Ha=q.addPart(n[Ta]+(b.match(/STACKED/)?
bc:0),ob,J,0,(this.szAggregation&&this.szAggregation.match(/sum/),this.formatValue(n[Ta],this.nValueDecimals||(n[Ta]<1?2:0),"ROUND")+wa),T),bc+=n[Ta];Ha.nClass=fa;if(b.match(/DIRECTION|DIRECTED/)){var Ua=this.itemA[a].ptPos,fb=this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[Ta]);Ua&&fb&&(Ha.nAngle=(450-180/Math.PI*Math.atan2(Ua.y-fb.y,fb.x-Ua.x))%360)}}this.colorScheme[f]=="none"&&q.setLine(this.szLineColor||"black")}}q.partsA.length<2&&a&&this.itemA[a].nCount==1&&(q.nRadInner=0);for(u=
(this.nGridX||1)-1;u>=0;u--)k[u].realize();if(b.match(/CENTER/)&&!b.match(/DONUT/)){w=Math.sqrt(Math.pow(map.Scale.normalX(h),2)/100*this.nCenterSize);J=this.colorScheme[this.nCenter];var Ab=map.Dom.newShape("circle",C,0,0,w*.9,"fill:"+J+";");Ab&&(Ab.setAttributeNS(szMapNs,"class",String(this.nCenter)),Ab.setAttributeNS(szMapNs,"tooltip",this.szLabelA?this.szLabelA[this.nCenter]+": "+n[this.nCenter]+this.szUnit:n[this.nCenter]+this.szUnit));if(b.match(/GLOW/)&&!b.match(/ZOOM/)&&(!this.szGlowUpper||
map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)&&(!this.szGlowLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower)){var Db=map.Dom.newShape("circle",C,0,0,w*6,"fill:"+J+";stroke:none;fill-opacity:0.05;pointer-events:none;");Db&&Db.setAttributeNS(szMapNs,"class",String(Xa));var bb=map.Dom.newShape("circle",C,0,0,w*2,"fill:"+J+";stroke:none;fill-opacity:0.1;pointer-events:none;");bb&&bb.setAttributeNS(szMapNs,"class",String(Xa))}if(b.match(/CENTERVALUE/)||b.match(/ZOOM/)||
b.match(/VALUES/)&&!this.fHideValues){var va=this.formatValue(this.nCenterValue,this.nValueDecimals||0,"ROUND")+(this.szUnit.length<=5?this.szUnit:"");p=O(J);ka=p.textColor;var Ca=String(Math.min(w*.8,3.3/va.length*w)*this.nValueScale),cd=map.Dom.newText(C,0,Ca*.33,"font-family:arial;font-size:"+Ca+"px;font-weight:bold;text-anchor:middle;fill:"+ka+";opacity:"+String(this.nOpacity?this.nOpacity:1)+";stroke:none;pointer-events:none",va);cd&&cd.setAttributeNS(szMapNs,"class",String(this.nCenter))}}else if(b.match(/CENTERVALUE/)){va=
String(this.itemA[a].nCount||this.itemA[a].nSize);ka=this.szValueColor||this.szTextColor||"#888888";w=map.Scale.normalX(h);Ca=String(Math.min(w*.5,2/va.length*w));var vb=this.nValueSizeMin?Ca/map.Scale.normalX(5):1;map.Dom.newText(C,0,Ca*.35,"font-family:arial;font-size:"+Ca+"px;text-anchor:middle;fill:none;stroke:black;stroke-width:"+Ca/40+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",va);var ea=map.Dom.newText(C,0,Ca*.35,"font-family:arial;font-size:"+Ca+"px;text-anchor:middle;fill:"+
ka+";opacity:"+vb+";stroke:none;pointer-events:none",va)}!b.match(/VALUES/)||b.match(/STACKED/)||!b.match(/ZOOM/)&&this.fHideValues||(Ca=Math.min(h*.8,3.4/(q.partsA[0]?q.partsA[0].szText.length:1)*h),n.length>1||b.match(/NOINLINETEXT/)||b.match(/ZOOM/)&&Ca<6?(Ca=b.match(/ZOOM/)||b.match(/NORMSIZE/)?map.Scale.normalX(8):map.Scale.normalX(5*(this.nValueScale||1)),this.drawDonutText(q,Ca)):(va=q.partsA[0]?q.partsA[0].szText:"",p=O(J),ka=this.szValueColor||this.szTextColor||p.textColor,w=map.Scale.normalX(h),
Ca=String(Math.min(w*.8,3.4/va.length*w)),vb=this.nValueSizeMin?Ca/map.Scale.normalX(5):1,b.match(/VOLUME/)&&(ob=q.donutPartsA[0].nHeight),b.match(/3D/)||(ob=w*.6),ea=map.Dom.newText(C,0,-ob+w/2+Ca*.45,"font-family:arial;font-size:"+Ca+"px;text-anchor:middle;fill:"+ka+";opacity:"+vb+";stroke:none;pointer-events:none",va),b.match(/3D/)&&(ea.fu.setPosition(0,-w/2+Ca*(b.match(/VOLUME/)?.5:.25)),ea.fu.scale(1,.5))));this.fillOpacity&&C.setAttributeNS(null,"fill-opacity",String(this.fillOpacity));this.nOpacity&&
(C.setAttributeNS(null,"fill-opacity",String(this.nOpacity)),C.setAttributeNS(null,"stroke-opacity",String(this.nOpacity)));if(b.match(/FADEDEVIATION/)){var wb=(n[0]-this.nMeanA[0])/this.nDeviationA[0];wb>10&&(vb=3.1622776601683795/Math.pow(wb,.5),C.setAttributeNS(null,"opacity",String(vb)))}else b.match(/LIMITDEVIATION/)&&(wb=(n[0]-this.nMeanA[0])/this.nDeviationA[0],wb>10&&C.setAttributeNS(null,"opacity","0"));b.match(/ZOOM/)&&b.match(/STARBURST/);if(n.length==1&&b.match(/CATEGORICAL/))q.donutPartsA[0]&&
(q.donutPartsA[0].objNode.setAttributeNS(szMapNs,"class",d.getAttributeNS(szMapNs,"class")),q.donutPartsA[0].objNode.setAttributeNS(szMapNs,"part",String(f)),q.donutPartsA[0].textNode&&(q.donutPartsA[0].textNode.setAttributeNS(szMapNs,"class",d.getAttributeNS(szMapNs,"class")),q.donutPartsA[0].textNode.setAttributeNS(szMapNs,"part",String(f))));else for(f=0;f<q.donutPartsA.length;f++)q.donutPartsA[f]&&(q.donutPartsA[f].objNode.setAttributeNS(szMapNs,"class",String(q.partsA[f].nClass)),q.donutPartsA[f].objNode.setAttributeNS(szMapNs,
"part",String(f)),q.donutPartsA[f].textNode&&(q.donutPartsA[f].textNode.setAttributeNS(szMapNs,"class",String(q.partsA[f].nClass)),q.donutPartsA[f].textNode.setAttributeNS(szMapNs,"part",String(f))));this.nRealizedCount++}else if(b.match(/WAFFLE/)){var lb=map.Scale.normalX(g);b.match(/GRIDSIZE/)?lb=this.nGridSize*1.05:b.match(/AUTOSIZE/)&&(V=map.Layer.nDynamicObjectScale,la=b.match(/\bRECT\b/)?b.match(/GAP/)?2.3:2:b.match(/GAP/)?1.7:1.6,U=Math.max(this.nAllMaxValue,this.nMax),lb=this.nGridWidthPx?
map.Scale.normalX(this.nGridWidthPx)/la/V:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/la/V:M,lb=lb/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[a].nSize));lb*=.97;F=map.Dom.newShape("rect",C,-(lb/2)+10,-(lb/2)+10,lb-20,lb-20,"fill:"+(this.szBoxColor||"back")+";stroke:"+(this.szBorderColor||"none")+";stroke-width:"+(this.szBorderWidth||2)+";fill-opacity:"+(this.nBoxOpacity||.05)+";opacity:1;");lb*=.9;if(b.match(/\bSORT\b/)){this.sortedIndex=[];for(f=0;f<n.length;f++)this.sortedIndex[f]=
{index:f,value:n[f]};this.sortedIndex.sort(this.sortIndexDown)}else this.sortedIndex=null;c=Math.max(this.nMax,Math.abs(this.nMin));var tb=this.nGridX||(b.match(/WAFFLE100/)?10:Math.max(5,Math.round(Math.sqrt(c))));b.match(/AUTO100/)&&(tb=10);var Jb=lb/(tb*1.1),ub=-lb/2,Tb=lb/2,vd=0,Qb=1E5;b.match(/WAFFLE100/)&&(Qb=100);for(f=0;f<n.length;f++){var Ib=this.sortedIndex?this.sortedIndex[f].index:f;n[Ib]=Math.round(n[Ib]);if(n[Ib]){var md=Math.min(n[Ib],Qb);Qb-=n[Ib];for(Wa=0;Wa<md;Wa++)F=map.Dom.newShape("rect",
C,ub,Tb-Jb,Jb,Jb,"fill:"+this.colorScheme[Ib]+";stroke:null;fill-opacity:"+(this.fillOpacity||1)+";opacity:"+(this.nOpacity||1)+";"),F.setAttributeNS(szMapNs,"class",String(Ib)),F.setAttributeNS(szMapNs,"tooltip",this.szLabelA?this.szLabelA[Ib]+": "+n[Ib]+this.szUnit:n[Ib]+this.szUnit),ub+=Jb*1.1,++vd>=tb&&(ub=-lb/2,Tb-=Jb*1.1,vd=0)}}this.nRealizedCount++}else if(b.match(/BUBBLE/)||b.match(/SQUARE/)||b.match(/LABEL/)){M=map.Scale.normalX(g/2);b.match(/AUTOSIZE/)&&(V=map.Layer.nDynamicObjectScale,
la=b.match(/\bRECT\b/)?b.match(/GAP/)?2.3:2:b.match(/GAP/)?1.7:1.6,U=Math.max(this.nAllMaxValue,this.nMax),M=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/la/V:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/la/V:M);U=Math.max(this.nMax,this.nMaxA[0]);this.nNormalSizeValue&&(this.nMaxSize=U=this.nNormalSizeValue);l=n[0];if(this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(this.nClipFrames==n.length?(l=Number(n[this.nActualFrame]),U=this.nNormalSizeValue||
this.nMaxA[this.nActualFrame]):l=n[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+n[n.length-1]*this.nActualFrame/(this.nClipFrames-1),l===0&&!b.match(/ZEROISVALUE/))||b.match(/INVERTSIZE/)&&U-n[0]===0&&!b.match(/ZEROISVALUE/))return null;$a=a&&this.itemA[a]&&this.szSizeField?this.itemA[a].nSize||0:l;kb=a&&this.itemA[a]&&this.szSizeField?this.nMaxSize:U;if($a===0&&!b.match(/NOSIZE/)||this.nMinValue&&$a<this.nMinValue)return null;w=b.match(/MENUSIZE/)?map.Scale.normalX(g/2.5):b.match(/CATEGORICAL/)&&
!this.szSizeField?M/3/(this.nNormalSizeValue||1):b.match(/NOSIZE/)?M/2:b.match(/FIXSIZE/)?M/2/(this.nNormalSizeValue||1):b.match(/NORMSIZE/)?M*2/3/(b.match(/CATEGORICAL/)?1:Math.log(kb)*Math.log(Math.abs($a))):b.match(/SUM/)&&!a?M*2/3:M/Math.pow(kb,1/this.nSizePow)*Math.pow(Math.abs($a),1/this.nSizePow);var Ub=!0,ta=null,eb=F=null,Eb=ea=bb=Db=null,Vb=null;J=this.colorScheme[0];L=this.colorScheme[1]?this.colorScheme[1]:"none";ka=this.colorScheme[1]?this.colorScheme[1]:"white";if(this.colorScheme.length>
2||b.match(/CATEGORICAL/))J=this.colorScheme[this.colorScheme.length-1],L=this.colorScheme[0];b.match(/NOLINES/)?L="none":L=="none"&&(p=O(J),L=p.lowColor);if(b.match(/CATEGORICAL/))ta=l-1,J=this.colorScheme[ta]||this.colorScheme[0],p=O(J),ka=p.textColor,L=b.match(/NOLINES/)?"none":p.lowColor,b.match(/RANGE/)&&!b.match(/RANGES/)&&(w=map.Scale.normalX(2+5*(f+1)/this.partsA.length)),Ub=!0;else if(this.szFlag.match(/COMPOSECOLOR/))this.szFlag.match(/SUBTRACTIVE/)?this.itemA[a].szColor=pa(this.itemA[a].nValuesA,
this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):this.itemA[a].szColor=ja(this.itemA[a].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255));else if(this.colorScheme.length>2||this.partsA.length>1||this.szRanges&&this.szRanges.length)if(Ub=!1,this.szFlag.match(/DOMINANT/)){Ma=Sa=0;ma=-1;for(f=0;f<this.itemA[a].nValuesA.length;f++)l=this.itemA[a].nValuesA[f],Na=100/this.nMeanA[f]*l,Qa=100/this.nMedianA[f]*l,Ka=(l-this.nMeanA[f])/this.nDeviationA[f],Sa=l,this.szFlag.match(/PERCENTOFMEAN/)&&
(Sa=Na),this.szFlag.match(/PERCENTOFMEDIAN/)&&(Sa=Qa),this.szFlag.match(/DEVIATION/)&&(Sa=Ka),l>this.nFilterA[f]&&Sa>Ma&&(this.itemA[a].nClass=f,Ma=Sa,ma=f);ma>=0&&(this.itemA[a].nDominant=ma,l=this.itemA[a].nValuesA[ma],T=" "+this.szFieldsA[ma]+" ",this.szLabelA&&this.szLabelA[ma]&&(T=" "+this.szLabelA[ma]+" "),this.itemA[a].nValue=this.itemA[a].nValuesA[ma],this.itemA[a].szLabel=T,J=this.colorScheme[ma],p=O(J),ka=p.textColor,L=b.match(/NOLINES/)?"none":p.lowColor,ta=ma,Ub=!0)}else for(f=0;f<this.partsA.length;f++)if(l>=
this.partsA[f].min&&l<this.partsA[f].max){J=this.colorScheme[f];p=O(J);ka=p.textColor;L=b.match(/NOLINES/)?"none":p.lowColor;b.match(/RANGE/)&&!b.match(/RANGES/)&&(w=map.Scale.normalX(2+5*(f+1)/this.partsA.length));ta=f;Ub=!0;break}this.itemA[a]&&(this.itemA[a].szColor=J);ka=this.szValueColor||this.szTextColor||ka;L=this.szLineColor||L;if(Ub){G=this.nLineWidth||.1;G=b.match(/OUTLINE/)?map.Scale.normalX(Math.min(1,1/M*w)):map.Scale.normalX(G/Math.sqrt(M)*Math.sqrt(w));if(b.match(/BUBBLE/)){var Va=
null;this.szTimeField=="$item$"?Va=(new Date(this.szFieldsA[ma].split(" ")[0])).getTime():a&&(Va=(new Date(this.itemA[a].szTime)).getTime());if(b.match(/GLOW/)&&!b.match(/ZOOM/)&&this.fGlowInScale){if(F=map.Dom.newShape("circle",C,0,0,w*6,"fill:"+J+";stroke:none;fill-opacity:0.05;pointer-events:none;"))F.setAttributeNS(szMapNs,"class",String(ta)),F.setAttributeNS(szMapNs,"time",Va);if(F=map.Dom.newShape("circle",C,0,0,w*2,"fill:"+J+";stroke:none;fill-opacity:0.1;pointer-events:none;"))F.setAttributeNS(szMapNs,
"class",String(ta)),F.setAttributeNS(szMapNs,"time",Va)}else b.match(/AURA/)&&!b.match(/ZOOM/)&&this.fGlowInScale&&(F=map.Dom.newShape("circle",C,0,0,w*1.3,"fill:"+(this.szLineColor||J)+";stroke:none;fill-opacity:0.3;"))&&(F.setAttributeNS(szMapNs,"class",String(ta)),F.setAttributeNS(szMapNs,"time",Va));F=map.Dom.newShape("circle",C,0,0,w,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";")}else if(b.match(/SQUARE/))F=map.Dom.newShape("rect",C,-w,-w,w*2,w*2,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";");
else if(b.match(/TEXTONLY/))F=map.Dom.newShape("rect",C,-w,-8,w*2.05,8,"fill:none;stroke:none;");else if(b.match(/LABEL/)){va=this.formatValue(l,this.nValueDecimals||(l<1||U<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:"");l===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/SIGN/))?va="+-"+va:l>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/SIGN/))&&(va="+"+va);var wc=Math.min(w*.8,3.4/va.length*w);if(!this.fShadow&&
this.fOrigShadow&&w>map.Scale.normalX(5)){if(F=map.Dom.newShape("rect",C,-w+w*.02,-wc*.83+w*.02,w*2.05,wc*1.6,"fill:#000000;stroke:none;opacity:"+.4*(this.fillOpacity?this.fillOpacity:1)))F.setAttributeNS(null,"rx",map.Scale.normalX(2*w/M)),F.setAttributeNS(null,"ry",map.Scale.normalX(2*w/M));if(F=map.Dom.newShape("rect",C,-w+w*.03,-wc*.83+w*.03,w*2.05,wc*1.6,"fill:"+J+";stroke:none;opacity:"+.2*(this.fillOpacity?this.fillOpacity:1)))F.setAttributeNS(null,"rx",map.Scale.normalX(2*w/M)),F.setAttributeNS(null,
"ry",map.Scale.normalX(2*w/M))}if(F=map.Dom.newShape("rect",C,-w,-wc*.83,w*2.05,wc*1.6,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";"))F.setAttributeNS(null,"rx",map.Scale.normalX(2*w/M)),F.setAttributeNS(null,"ry",map.Scale.normalX(2*w/M))}if(F){b.match(/SILENT/)||(b.match(/CATEGORICAL/)&&this.szLabelA&&this.szLabelA[l-1]?F.setAttributeNS(szMapNs,"tooltip",this.szLabelA[l-1]+" "+this.szTitle):F.setAttributeNS(szMapNs,"tooltip",this.formatValue(l,2)+this.szUnit+" "+this.szTitle));ea=null;if(b.match(/VALUES/)&&
!this.fHideValues)if(va=null,this.szValueField&&this.szValueField=="$title$"?va=this.itemA[a].szTitle:this.szValueField&&this.itemA[a].szValue?(va=this.itemA[a].szValue,isNaN(va)||(va=this.formatValue(ba(this.itemA[a].szValue),this.nValueDecimals||(this.itemA[a].szValue<1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),l===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))?va="+/-"+va:l>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||
this.szFlag.match(/\bSIGN\b/))&&(va="+"+va))):this.szValueField&&this.szValueField==this.szSizeField&&$a?(va=this.formatValue(ba($a),this.nValueDecimals||($a<1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),$a===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))?va="+/-"+va:$a>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))&&(va="+"+va)):b.match(/CATEGORICAL/)&&this.szLabelA?va=this.szLabelA[l-
1]||"?":(va=this.formatValue(l,this.nValueDecimals||(l<1||U<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),l===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))?va="+/-"+va:l>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))&&(va="+"+va)),Ca=String(Math.min(w*.8,3.3/va.length*w)*this.nValueScale),b.match(/TEXTONLY/)){p=O(J);ka=p.textColor;Ca=w*.8*this.nValueScale;if(this.nValueSizeMin&&!b.match(/ZOOM/)&&
Ca*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin)||this.nValueValueMin&&!b.match(/ZOOM/)&&l<this.nValueValueMin)return null;var xc=this.szTextFont||"arial";Eb=map.Dom.newText(C,0,Ca*.33,"font-family:"+xc+";font-size:"+Ca+"px;font-weight:normal;text-anchor:middle;fill:none;stroke:"+J+";stroke-width:"+Ca/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",va);Eb.setAttributeNS(null,"id",this.szId+":"+a+":text:bg");ea=map.Dom.newText(C,0,Ca*.33,"font-family:"+xc+";font-size:"+
Ca+"px;font-weight:normal;text-anchor:middle;fill:"+(this.szValueColor||this.szTextColor||"#000000")+";opacity:"+vb+";stroke:none;",va);ea.setAttributeNS(null,"id",this.szId+":"+a+":text");F.parentNode.removeChild(F)}else if(b.match(/LABEL/)||Ca>map.Scale.normalX(1))vb=this.nValueSizeMin?Ca/map.Scale.normalX(5):1,ea=map.Dom.newText(C,0,Ca*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+Ca+"px;font-weight:bold;text-anchor:middle;fill:"+ka+";opacity:"+vb+";stroke:none;pointer-events:none",
va);if(b.match(/DTEXT/)&&a&&!b.match(/ZOOM/)){var $b=Math.pow(Math.abs(w),1/3)/Math.pow(M,1/3);F.style.setProperty("fill-opacity",String($b),"");F.style.setProperty("stroke-opacity",String($b),"");ea&&ea.style.setProperty("fill-opacity",String($b),"")}else F.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:1),""),b.match(/OUTLINE/)||this.szLineColor?F.style.setProperty("stroke-opacity","1",""):F.style.setProperty("stroke-opacity",String(this.fillOpacity&&this.fillOpacity<
.5?1:.3),"")}ta!=null&&(F&&(F.setAttributeNS(szMapNs,"value",String(l)),F.setAttributeNS(szMapNs,"class",String(ta))),ea&&(ea.setAttributeNS(szMapNs,"value",String(l)),ea.setAttributeNS(szMapNs,"class",String(ta))),Eb&&(Eb.setAttributeNS(szMapNs,"value",String(l)),Eb.setAttributeNS(szMapNs,"class",String(ta))));this.szTimeField&&(Va=null,Va=this.szTimeField=="$item$"?(new Date(this.szFieldsA[ma].split(" ")[0])).getTime():(new Date(this.itemA[a].szTime)).getTime(),F&&F.setAttributeNS(szMapNs,"time",
Va),ea&&ea.setAttributeNS(szMapNs,"time",Va),Eb&&Eb.setAttributeNS(szMapNs,"time",Va));g=w*2/map.Scale.normalX(1);B.x=0;B.y=b.match(/TEXTONLY/)?w:w+map.Scale.normalY(5);this.nRealizedCount++}else return this.nMissingRangeCount++,null}else if(b.match(/SYMBOL/)){if(typeof this.szSymbolBoxStyle!="undefined"){L="#dddddd";typeof this.szBorderColor!="undefined"&&(L=this.szBorderColor);var Fc="stroke-width:0;";if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":Fc="stroke-width:"+
map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":Fc="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":Fc="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":Fc="stroke-width:0;"}var hc=map.Dom.newShape("rect",C,0,0,1,1,"fill:white;stroke:"+L+";"+Fc);switch(this.szSymbolBoxStyle){case "frame":hc.setAttributeNS(null,"fill-opacity",0);break;case "field":hc.setAttributeNS(null,"fill-opacity",1)}}if(!this.szSymbolsA)for(this.szSymbolsA=
[],f=0;f<n.length;f++)this.szSymbolsA.push("circle");else if(this.szSymbolsA.length<n.length)for(f=this.szSymbolsA.length;f<n.length;f++)this.szSymbolsA.push(this.szSymbolsA[this.szSymbolsA.length-1]);var ic=null;b.match(/VALUES|AXIS/)&&(ic=map.Dom.newGroup(C,this.szId+":"+a+":textgroup"));this.initAngle=0;if(b.match(/\bSORT\b/))if(b.match(/\bBYMEAN\b/)){this.sortedIndex=[];for(f=this.sortedMax=0;f<n.length;f++)this.sortedIndex[f]={index:f,value:n[f],tvalue:n[f],mean:this.nMeanA[f]},this.sortedMax=
Math.max(this.sortedMax,n[f]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(b.match(/\bBYMEDIAN\b/)){this.sortedIndex=[];for(f=this.sortedMax=0;f<n.length;f++)this.sortedIndex[f]={index:f,value:n[f],tvalue:n[f],mean:this.nMedianA[f]},this.sortedMax=Math.max(this.sortedMax,n[f]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(b.match(/\bUP\b/)){this.sortedIndex=[];for(f=this.sortedMax=0;f<n.length;f++)this.sortedIndex[f]={index:f,value:n[f],tvalue:n[f]},this.sortedMax=
Math.max(this.sortedMax,n[f]);this.sortedIndex.sort(this.sortIndexUp);this.initAngle=0}else if(b.match(/\bDOWN\b/)){this.sortedIndex=[];for(f=this.sortedMax=0;f<n.length;f++)this.sortedIndex[f]={index:f,value:n[f],tvalue:n[f]},this.sortedMax=Math.max(this.sortedMax,n[f]);this.sortedIndex.sort(this.sortIndexDown);this.initAngle=0}else{if(b.match(/\bRANDOM\b/)){this.sortedIndex=[];this.sortedMax=0;if(this.nClipParts&&this.nClipParts<n.length){var Tc=[];for(f=0;f<n.length;f++)Tc[f]={index:f,value:n[f],
tvalue:n[f]};Tc.sort(this.sortIndexDown);for(f=0;f<this.nClipParts;f++){var oc=Tc[f].index;this.sortedIndex[f]={index:oc,value:n[oc],tvalue:n[oc]};this.sortedMax=Math.max(this.sortedMax,n[f])}}else for(f=0;f<n.length;f++)this.sortedIndex[f]={index:f,value:n[f],tvalue:n[f]},this.sortedMax=Math.max(this.sortedMax,n[f]);a?(this.itemA[a].randomA||(this.itemA[a].randomA=this.getRandomNumberArray(n.length+1)),this.shuffleArray(this.sortedIndex,this.itemA[a].randomA),this.initAngle=Math.floor(this.itemA[a].randomA[0]*
360)):this.initAngle=0}}else this.sortedIndex=null;if(b.match(/RINGS/)){if(this.sortedIndex){var Gc=0;for(f=0;f<this.sortedIndex.length;f++)this.sortedIndex[f].value&&(this.sortedIndex[f].value+=Gc,Gc=this.sortedIndex[f].value)}else for(Gc=0,this.sortedIndex=[],f=0;f<n.length;f++)this.sortedIndex[f]={index:f,value:n[f],tvalue:n[f]},this.sortedIndex[f].value&&(this.sortedIndex[f].value+=Gc,Gc=this.sortedIndex[f].value);this.sortedIndex.sort(this.sortIndexDown)}if(b.match(/\bSMOOTH\b/)&&!b.match(/\bZOOM\b/)){var Uc=
n.slice();for(f=n.length-2;f>=1;f--){n[f]=Uc[f];n[f]+=Uc[f+1];for(Pc=1;Pc<2;Pc++)n[f]+=Uc[f-Pc];n[f]/=3}}if(b.match(/\bLINREG\b/)){var dd=0,wd=0;for(f=0;f<n.length;f++)dd+=f,wd+=n[f];var Vc=dd/n.length,yc=wd/n.length,nd=0,xd=0;for(f=0;f<n.length;f++)ub=f,Tb=n[f],nd+=(ub-Vc)*(Tb-yc),xd+=(ub-Vc)*(ub-Vc);var pc=nd/xd,qa=yc-pc*Vc}var Kb=null,xb=null,mb=null;ta=0;var Lb="",Hc=0,pb=0,qb=0,jc=0,db=0,hb=0,Wb=0,ac=!1,Mb=0;E=n.length;this.nClipParts&&this.nClipParts<n.length&&(b.match(/\bUP\b/)?Mb=n.length-
this.nClipParts:E=this.nClipParts);if(this.szFlag.match(/DOMINANT/)){Ma=Sa=0;var ed=-1;for(f=0;f<this.itemA[a].nValuesA.length;f++)l=this.itemA[a].nValuesA[f],Na=100/this.nMeanA[f]*l,Qa=100/this.nMedianA[f]*l,Ka=(l-(this.nMeanA[f]||0))/this.nDeviationA[f],Sa=l,this.szFlag.match(/PERCENTOFMEAN/)&&(Sa=Na),this.szFlag.match(/PERCENTOFMEDIAN/)&&(Sa=Qa),this.szFlag.match(/DEVIATION/)&&(Sa=Ka),l>(this.nFilterA[f]||0)&&Sa>Ma&&(this.itemA[a].nClass=f,Ma=Sa,ed=f);ed>=0&&(Mb=this.itemA[a].nDominant=ed,E=Mb+
1,ta=ed)}else this.szFlag.match(/COMPOSECOLOR/)&&(this.szFlag.match(/SUBTRACTIVE/)?this.itemA[a].szColor=pa(this.itemA[a].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):this.itemA[a].szColor=ja(this.itemA[a].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)));this.szFlag.match(/\bCLIP\b/)&&(E=Mb+1);for(f=Mb;f<E;f++)hb+=n[f]!==0,db=Math.max(db,n[f]);if(this.szFlag.match(/STACKED/)&&this.nGridX)for(f=Mb;f<E;){for(var bc=0,Wa=0;Wa<this.nGridX;Wa++)bc+=n[f++];
db=Math.max(db,bc)}var qc=this.formatValue(Math.max(this.nAllMaxValue,this.nMax),this.nValueDecimals||"")+(this.szUnit.length<=5?this.szUnit:""),Xb=0;for(f=Mb;f<E;f++){var ma=f;l=n[ma];var yb=n[ma];b.match(/COUNT/)&&this.itemA[a].nCountA&&(yb=this.itemA[a].nCountA[ma]);this.sortedIndex&&(l=this.sortedIndex[ma].value,yb=this.sortedIndex[ma].tvalue,ma=this.sortedIndex[ma].index);this.szValueField&&this.itemA[a]&&this.szValueField=="$title$"?yb=this.itemA[a].szTitle:this.szValueField&&this.itemA[a]&&
this.itemA[a].szValue&&(yb=isNaN(this.itemA[a].szValue)?this.itemA[a].szValue:ba(this.itemA[a].szValue));if(this.szShowParts){var zc=!0;for(rb in this.szShowPartsA)this.szShowPartsA[rb]==ma%(this.nGridX||1E6)&&(zc=!1);if(zc)continue}if(!b.match(/ZOOM/)||!this.markedClasses||this.markedClasses[ma]){ta=ma;this.nGridX&&b.match(/PLOT/)&&(ta%=this.nGridX);b.match(/STACKED/)&&(ta==0&&(Xb=0),Xb=yb+=Xb);if((b.match(/ZOOM/)||b.match(/NORMSIZE/))&&this.szLabelA){var Nb=this.formatValue(yb,yb<1?2:0);Lb=Nb+this.szUnit;
Lb+=" "+this.szLabelA[ma%(this.nGridX||1E7)]}else Nb=this.formatValue(yb,2),Lb=" "+Nb+this.szUnit;Va=null;this.szTimeField&&(Va=this.szTimeField=="$item$"?(new Date(this.szFieldsA[ma].split(" ")[0])).getTime():(new Date(this.itemA[a].szTime)).getTime());if(!b.match(/CATEGORICAL/)||b.match(/AGGREGATE/)||b.match(/GROUP/)){M=map.Scale.normalX(g/2);U=this.nNormalSizeValue||this.nAllMaxValue;b.match(/MENUSIZE/)?U=db*5:!this.nNormalSizeValue||b.match(/SEQUENCE/)&&this.szSizeField||(this.nMaxSize=U=this.nNormalSizeValue);
db&&b.match(/ZOOM/)&&b.match(/SEQUENCE/)&&(U=db/2+db/2*Math.pow(U,.5)/Math.pow(db,.5));if(b.match(/INVERTSIZE/)&&U-l===0&&!b.match(/ZEROISVALUE/))return null;this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(yb=l=this.nClipFrames==n.length?Number(n[this.nActualFrame]):n[ma]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+n[n.length-1]*this.nActualFrame/(this.nClipFrames-1));if(l||b.match(/PLOT|NOSIZE/)){w=0;b.match(/AUTOSIZE/)&&(V=map.Layer.nDynamicObjectScale,
la=b.match(/\bRECT\b/)?b.match(/GAP/)?2.3:2:b.match(/GAP/)?1.6:1.5,U=Math.max(this.nAllMaxValue,this.nMax),M=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/la/V:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/la/V:M);w=b.match(/GRIDSIZE/)&&!b.match(/PLOT/)?this.nGridSize/2:b.match(/NOSIZE/)?map.Scale.normalX(g/3):b.match(/FIXSIZE/)?map.Scale.normalX(g/3)/(this.nNormalSizeValue||1):M/Math.pow(U,1/this.nSizePow)*Math.pow(l,1/this.nSizePow);b.match(/SEQUENCE/)?b.match(/MENUSIZE/)||
b.match(/SUM/)&&!a?w*=this.szField100?1:2:b.match(/ZOOM/)&&!b.match(/PLOT/)?w*=2:b.match(/AGGREGATE/)&&b.match(/CATEGORICAL/)||!this.szSizeField||!a||!this.itemA[a]||(w=w/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[a].nSize,1/this.nSizePow)):b.match(/MENUSIZE/)||b.match(/SUM/)&&!a?w=M*1.5:b.match(/ZOOM/)&&!b.match(/PLOT/)?w=Math.max(w,M*2/3):b.match(/NOSIZE/)?w=M/5:(!b.match(/GRIDSIZE/)&&this.szSizeField&&a&&this.itemA[a]&&(w=M/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[a].nSize,
1/this.nSizePow)),b.match(/PLOTXY/)&&(w/=5));if(isNaN(w)||!w){if(!b.match(/STAR|STACKED|PLOT/))continue;w=1}La=this.szSymbolsA[ma];if(this.nRangesA&&this.nRangesA.length)for(Wa=0;Wa<this.nRangesA.length;Wa++)if(l==this.nRangesA[Wa]||Number(l)==Number(this.nRangesA[Wa])){La=this.szSymbolsA[Wa]||this.szSymbolsA[0]||"circle";break}La=this.itemA[a]?this.itemA[a].szSymbol||La:La;b.match(/SEQUENCE/)&&(La=this.szSymbolsA[ma]);if(a&&this.itemA[a].szColor)J=this.itemA[a].szColor,ta=this.itemA[a].nClass,this.colorClassUsedA&&
(this.colorClassUsedA[ta]=!0);else if((b.match(/SEQUENCE/)||b.match(/DOMINANT/))&&this.colorScheme.length>=this.partsA.length)J=this.colorScheme[ma%(this.nGridX||1E4)],L=this.colorScheme[ma];else if(J=this.colorScheme[0],L=this.colorScheme[1]?this.colorScheme[1]:"none",this.colorScheme.length>2&&(J=this.colorScheme[this.colorScheme.length-1],L=this.colorScheme[0]),b.match(/NOLINES/)?L="none":L=="none"&&(p=O(J),L=p.textColor),this.colorScheme.length>2||this.szRanges&&this.szRanges.length){for(Wa=0;Wa<
this.partsA.length;Wa++)if(b.match(/CATEGORICAL/)&&l==this.partsA[Wa].min||!b.match(/CATEGORICAL/)&&l<this.partsA[Wa].max){J=this.colorScheme[Wa];p=O(J);L=p.textColor;b.match(/RANGE/)&&!b.match(/RANGES/)&&(w=map.Scale.normalX(2+5*(Wa+1)/this.partsA.length));ta=Wa;break}else if(this.szRanges&&this.szRanges.length&&l<this.partsA[Wa].min){J=this.colorScheme[Wa-1];p=O(J);L=p.textColor;ta=Wa-1;break}b.match(/NOLINES/)&&(L="none")}L=L||J;this.nSymbolScale=w/map.Scale.normalX(g);if(La=="circle"||La=="square"||
La=="roundrect"||La=="carot"||La=="diamond"||La=="triangle"||La=="hexagon"||La=="empty"||La=="label"||La=="cross"){L=this.szLineColor||L;G=(this.nLineWidth||1)*map.Scale.normalX(Math.min(2*w/M,.2));switch(La){case "empty":F=map.Dom.newShape("circle",C,0,0,w,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+G+";");break;case "circle":!this.fShadow&&this.fOrigShadow&&(eb=map.Dom.newShape("circle",C,map.Scale.normalX(.5)+w*.02,map.Scale.normalX(.5)+w*.02,w*1.02,"fill:#000000;stroke:none;opacity:"+
.6*(this.fillOpacity?this.fillOpacity:1)));bb=Db=null;if(!b.match(/GLOW/)||this.sortedIndex&&f!=Mb||b.match(/ZOOM/)||this.szGlowUpper&&!(map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)||this.szGlowLower&&!(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower))b.match(/AURA/)&&f==Mb&&!b.match(/ZOOM/)&&(!this.szGlowUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)&(!this.szGlowLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower)&&(Db=map.Dom.newShape("circle",
C,0,0,w*1.3,"fill:"+(this.szLineColor||J)+";stroke:none;fill-opacity:0.3;"))&&(Db.setAttributeNS(szMapNs,"class",String(ta)),Db.setAttributeNS(szMapNs,"time",String(Va)));else{if(Db=map.Dom.newShape("circle",C,0,0,w*6,"fill:"+J+";stroke:none;fill-opacity:0.05;pointer-events:none;"))Db.setAttributeNS(szMapNs,"class",String(ta)),Db.setAttributeNS(szMapNs,"time",Va);if(bb=map.Dom.newShape("circle",C,0,0,w*2,"fill:"+J+";stroke:none;fill-opacity:0.1;pointer-events:none;"))bb.setAttributeNS(szMapNs,"class",
String(ta)),bb.setAttributeNS(szMapNs,"time",String(Va))}F=map.Dom.newShape("circle",C,0,0,w,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";");break;case "square":F=map.Dom.newShape("rect",C,-w,-w,w*2,w*2,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";");break;case "roundrect":F=map.Dom.newShape("rect",C,-w,-w,w*2,w*2,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";");F.setAttributeNS(null,"rx",w*.3);break;case "cross":F=map.Dom.newShape("rect",C,-w*1.6,-w*.4,w*2*1.6,w*2*.4,"fill:"+J+";stroke:"+L+";stroke-width:"+
map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");F=map.Dom.newShape("rect",C,-w*.4,-w*1.6,w*2*.4,w*2*1.6,"fill:"+J+";stroke:"+L+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "carot":case "diamond":(F=map.Dom.newShape("rect",C,-w,-w,w*2,w*2,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";"))&&F.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":F=map.Dom.newShape("path",C,"M 0,"+w+" l"+w*1.2+",-"+w*2+" -"+w*2.4+",0 "+w*1.2+","+w*2+"z","fill:"+
J+";stroke:"+L+";stroke-width:"+G+";");break;case "hexagon":Rb=w/2;Gb=w*Math.sin(60/180*Math.PI);pd=w;F=map.Dom.newShape("path",C,"M -"+w+",0 l "+Rb+",-"+Gb+" "+pd+",0 "+Rb+","+Gb+" -"+Rb+","+Gb+" -"+pd+",0 -"+Rb+",-"+Gb+" z","fill:"+J+";stroke:"+L+";stroke-width:"+G+";");break;case "label":if(va=this.formatValue(yb,this.nValueDecimals||(yb<1||U<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),b.match(/TEXTONLY/))ka=O(J).textColor,Ca=String(Math.max(Math.min(w*.8,map.Scale.normalX(500)),map.Scale.normalX(2))),
this.nValueSizeMin&&!b.match(/ZOOM/)&&Ca*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin)?(F=map.Dom.newShape("rect",C,0,0,0,0,"fill:none;"),eb=map.Dom.newShape("rect",C,0,0,0,0,"fill:none;")):this.nValueValueMin&&!b.match(/ZOOM/)&&l<this.nValueValueMin?(F=map.Dom.newShape("rect",C,0,0,0,0,"fill:none;"),eb=map.Dom.newShape("rect",C,0,0,0,0,"fill:none;")):(xc=this.szTextFont||"arial",eb=map.Dom.newText(C,0,0,"font-family:"+xc+";font-size:"+Ca+"px;font-weight:bold;text-anchor:middle;fill:none;stroke:"+
J+";stroke-width:"+Ca/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",va),eb.setAttributeNS(null,"id",this.szId+":"+a+":text:bg"),F=map.Dom.newText(C,0,0,"font-family:"+xc+";font-size:"+Ca+"px;font-weight:bold;text-anchor:middle;fill:"+(this.szValueColor||this.szTextColor||"#000000")+";opacity:"+vb+";stroke:none;",va),F.setAttributeNS(null,"id",this.szId+":"+a+":text"));else if(Ca=String(Math.max(1,Math.min(w*.8,3.4/va.length*w))),this.nValueSizeMin&&!b.match(/ZOOM/)&&Ca*map.Layer.nDynamicObjectScale<
map.Scale.normalX(this.nValueSizeMin))F=map.Dom.newShape("rect",C,0,0,0,0,"fill:none;");else if(this.nValueValueMin&&!b.match(/ZOOM/)&&l<this.nValueValueMin)F=map.Dom.newShape("rect",C,0,0,0,0,"fill:none;");else if(Kd=Ca*1.6,F=map.Dom.newShape("rect",C,-w,-Ca*.83,w*2.05,Ca*1.6,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";"))F.setAttributeNS(null,"rx",map.Scale.normalX(2*w/M)),F.setAttributeNS(null,"ry",map.Scale.normalX(2*w/M))}F&&(b.match(/OUTLINE/)?(F.style.setProperty("stroke-width",String(map.Scale.normalX(.5))),
F.style.setProperty("stroke-opacity","1"),F.style.setProperty("fill-opacity","0.7")):b.match(/RANDOM/)?(F.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),F.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:1),""),b.match(/DOPACITY/)&&(z=1/(this.nDopacityPow||1),vb=Math.pow(l,z)/Math.pow(this.sortedMax,z)*(this.nOpacity||1)*(this.nDopacityScale||1),F.style.setProperty("fill-opacity",String(vb),""))):b.match(/\bSORT\b/)&&
b.match(/DOPACITY/)?(F.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),z=1/(this.nDopacityPow||1),vb=Math.pow(l,z)/Math.pow(this.sortedMax,z)*(this.nOpacity||1)*(this.nDopacityScale||1),F.style.setProperty("fill-opacity",String(vb),"")):b.match(/DOPACITY/)&&this.szAlphaField?a&&typeof this.itemA[a].nAlpha!="undefined"&&(z=1/(this.nDopacityPow||1),vb=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,z)*Math.pow(this.itemA[a].nAlpha,z),F.style.setProperty("fill-opacity",
String(vb),"")):b.match(/DOPACITY/)?(z=1/(this.nDopacityPow||1),vb=Math.pow(l-this.nMin,z)/Math.pow(this.nMax-this.nMin,z)*(this.fillOpacity||1)*(this.nDopacityScale||1),F.style.setProperty("fill-opacity",String(vb),""),b.match(/CATEGORICAL/)||(ta=Math.min(6,Math.ceil((l-this.nMin)/(this.nMax-this.nMin)*7)),F.setAttributeNS(szMapNs,"class",String(ta)),C.setAttributeNS(szMapNs,"class",String(ta)),d.setAttributeNS(szMapNs,"class",String(ta)))):F.style.setProperty("fill-opacity",String(this.fillOpacity?
this.fillOpacity:this.nOpacity?this.nOpacity:1),""),this.chartGroup&&this.chartGroup.style.setProperty("opacity","1",""),F.setAttributeNS(szMapNs,"tooltip",Lb),F.setAttributeNS(szMapNs,"time",Va))}else La.match(/.svg|.png|.jpeg/)?(F=map.Dom.constructNode("image",C,{"xlink:href":La}),F.setAttributeNS(null,"x",String(map.Scale.normalX(-g/2))),F.setAttributeNS(null,"y",String(map.Scale.normalY(-g/2))),F.setAttributeNS(null,"width",String(map.Scale.normalX(g))),F.setAttributeNS(null,"height",String(map.Scale.normalY(g)))):
F=map.Dom.constructNode("use",C,{"xlink:href":"#"+La+":antizoomandpan"}),map.Dom.newShape("circle",C,0,0,w*.5,"fill:white;stroke:none;opacity:0"),F.fu.scale(w/M,w/M),F.setAttributeNS(null,"style","fill:"+J+";stroke:"+L);if(F&&b.match(/VALUES/)&&!b.match(/TEXTONLY/)&&!this.fHideValues&&(!this.nValueValueMin||l>=this.nValueValueMin))if(ea=null,va=yb,isNaN(yb)||(va=this.formatValue(yb,this.nValueDecimals||"")+(this.szUnit.length<=5?this.szUnit:"")),p=O(J),ka=this.szValueColor||this.szTextColor||p.textColor,
Ld=Math.max((yb?.length||0)+1,qc.length),Ca=String(Math.min(M*1,(La=="hexagon"?2.7:3.2)/Ld*M)),Ca*=w/M*this.nValueScale,b.match(/ZOOM/)&&b.match(/LINES/)&&!b.match(/INLINETEXT/)&&(this.nGridX==null||this.nGridX<=1||b.match(/STACKED/))){ka="black";Y=Y||map.Dom.newGroup(d,this.szId+":"+a+":textchartontop");Ca=4+.5*n.length/(this.nGridX?this.nGridX*2:1);var yd=Math.log(n.length)/3;ea=this.createTextLabel(map.SVGDocument,Y,"",va,Ca*yd*this.nValueScale,"","rgba(255,255,255,0)",p.lowColor,"GLOW");ea.setAttributeNS(null,
"opacity","0.9");Y.fu.setPosition(-map.Scale.normalX(Ca*yd)*3,-map.Scale.normalY(8/(this.nGridX||1)))}else if(La=="circle"||La=="square"||La=="roundrect"||La=="triangle"||La=="hexagon"||La=="label"||La=="empty")if(b.match(/CENTERVALUES/))ta===0&&(ea=map.Dom.newText(C,0,Ca*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+Ca+"px;text-anchor:middle;fill:"+ka+";stroke:none;pointer-events:none",va));else if((b.match(/\bCENTER\b/)||b.match(/\bTOP\b/)||b.match(/\bBOTTOM\b/))&&!b.match(/\bDOMINANT\b/)){if(l){var ya=
6;this.szChartFlag+="|VALUEBACKGROUND";N=N||map.Dom.newGroup(d,this.szId+":"+a+":chartontop");jc=jc?jc:w;var od=-map.Scale.normalX(1),kc=-map.Scale.normalX(ya*1.33)*(hb-Wb-1);ea=this.createTextLabel(map.SVGDocument,N,"",va,ya,"",this.colorScheme[ma%(this.nGridX||1E4)],this.szTextColor);ea.fu.setPosition(od,kc);if(a&&(b.match(/ZOOM/)||b.match(/NORMSIZE/))&&this.szLabelA){var fd=ea.fu.getBox().width;Eb=map.Dom.newText(N,0,0,this.szValuesTextBgStyle,this.szLabelA[ma]);Eb.fu.setPosition(od+fd+map.Scale.normalX(6),
kc-map.Scale.normalX(-1));Eb.fu.scale(.6,.6);ea=map.Dom.newText(N,0,0,this.szValuesTextStyle+";fill:#000;fill-opacity:0.8",this.szLabelA[ma]);ea.fu.setPosition(od+fd+map.Scale.normalX(6),kc-map.Scale.normalX(-1));ea.fu.scale(.6,.6)}ea.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6)));ea=null;Wb++}}else if(this.szValueField&&b.match(/2VALUES/)){ea=map.Dom.newText(C,0,-Ca*.2,"font-family:"+(this.szTextFont||"arial")+";font-size:"+Ca+"px;text-anchor:middle;fill:"+ka+";stroke:none;pointer-events:none",
va);var Wc=Math.min(Ca*.8,120);Nb=this.formatValue(l,this.nValueDecimals||0)+this.szUnit;Vb=map.Dom.newText(C,0,Ca-Wc*.2,"font-family:"+(this.szTextFont||"arial")+";font-size:"+Wc+"px;text-anchor:middle;fill:"+ka+";stroke:none;pointer-events:none",Nb)}else ea=map.Dom.newText(C,0,Ca*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+Ca+"px;text-anchor:middle;fill:"+ka+";stroke:none;pointer-events:none",va);else Ca=Math.max(w*.8,1)*this.nValueScale,N=N||map.Dom.newGroup(d,this.szId+":"+a+":chartontop"),
ea=this.createTextLabel(map.SVGDocument,N,"",va,Ca/map.Scale.normalX(1),"","rgba(255,255,255,0.3)",p.lowColor,"GLOW"),ea.fu.setPosition(map.Scale.normalX(0)+pb,map.Scale.normalY(0)+qb);if(F&&(F.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),F.setAttributeNS(szMapNs,"time",Va),ea&&(ea.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ea.setAttributeNS(szMapNs,"time",Va),ea.setAttributeNS(szMapNs,"tooltip",Lb)),Vb&&(Vb.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||
1E6))),Vb.setAttributeNS(szMapNs,"time",Va)),eb&&(eb.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),eb.setAttributeNS(szMapNs,"time",Va)),!b.match(/CENTER/))){var gb=null;if(b.match(/STAR/)){if(f===0&&(Kb=F,xb=ea,mb=Vb,jc=w,b.match(/EXPAND/)&&b.match(/\bSORT\b/)&&b.match(/\bUP\b/)&&(jc=b.match(/LINEAR/)||b.match(/SIZEP1/)?(b.match(/EXPANDMAX/)?2:.5)*M/U*this.sortedIndex[n.length-1].value:(b.match(/EXPANDMAX/)?2:.5)*M/Math.sqrt(U)*Math.sqrt(this.sortedIndex[n.length-1].value)),b.match(/ZOOM/)&&
b.match(/STAR/)&&b.match(/\bUP\b/)?jc*=2:b.match(/COMPRESS/)&&(jc*=b.match(/COMPRESSMAX/)?.25:.5)),(f>0||b.match(/\bUP\b/))&&w){var mc=this.nClipParts&&this.nClipParts<this.partsA.length?this.nClipParts:this.partsA.length,ec=w,Oc=jc+w,fc=90-Math.asin(ec*Math.sqrt(Math.pow(Oc,2)-Math.pow(ec,2))/Oc/ec)/Math.PI*180,Sb=jc+w;b.match(/\bUP\b/)&&(f>5&&(fc/=1+w/M*2),Sb=jc*(1+mc/5));b.match(/ZOOM/)||(Sb=this.nRangeScale?Sb*this.nRangeScale:b.match(/EXPANDMAX/)?Sb*2:b.match(/EXPAND/)?Sb*1.5:Sb);this.initAngle+=
fc;pb=Math.cos(this.initAngle/180*Math.PI)*Sb;qb=Math.sin(this.initAngle/180*Math.PI)*Sb;this.initAngle+=fc;b.match(/ZOOM/)&&La.match(/.svg|.png|.jpeg/)&&(pb*=2,qb*=1.5);gb=new point(map.Scale.normalX(0)+pb,map.Scale.normalY(0)+qb)}}else if(b.match(/RANDOM/)){var Dc=b.match(/EXPANDMAX/)?w*2:b.match(/EXPAND/)?w*1.5:w;b.match(/ZOOM/)&&(M*=2,Dc*=2);pb=Math.cos(this.initAngle+360/this.partsA.length*f/180*Math.PI)*Math.min(M,Dc);qb=Math.sin(this.initAngle+360/this.partsA.length*f/180*Math.PI)*Math.min(M,
Dc);gb=new point(map.Scale.normalX(0)+pb,map.Scale.normalY(0)+qb)}else b.match(/HORZ/)?(pb+=w,gb=new point(map.Scale.normalX(0)+pb,map.Scale.normalY(0)+qb),pb+=w):b.match(/BOTTOM/)?gb=new point(map.Scale.normalX(0),-w):b.match(/TOP/)?gb=new point(-w*.3,w*.7-M):b.match(/CONE/)?gb=new point(map.Scale.normalY(f*.33),-map.Scale.normalY(f*1)):b.match(/BASE/)&&(gb=new point(map.Scale.normalX(0),qb-w),qb-=w*(b.match(/VALUES/)?1.25:1));gb?(F.fu.setPosition(gb.x,gb.y),eb&&eb.fu.setPosition(gb.x,gb.y),Db&&
Db.fu.setPosition(gb.x,gb.y),bb&&bb.fu.setPosition(gb.x,gb.y),ea&&ea.fu.setPosition(gb.x,gb.y),Vb&&Vb.fu.setPosition(gb.x,gb.y)):Vb&&Vb.fu.setPosition(0,0);if(b.match(/PLOT/)){l!==0||b.match(/STACKED/)||(F.parentNode.removeChild(F),eb&&eb.parentNode.removeChild(eb),ea&&ea.parentNode.removeChild(ea));var da=map.Scale.normalX(g)*(b.match(/LINES/),1),Ia=f*da;this.nGridX&&(Ia=b.match(/PLOTVAR/)?Math.floor(f%this.nGridX)*da:Math.floor(f/this.nGridX)*da);var Za=0;U=this.nAllMaxValue||this.nMax;U=Math.max(db,
U);U=this.nMaxValuePlot=typeof this.nMaxValue!=="undefined"?this.nMaxValue:U;Za=this.nMinValuePlot=typeof this.nMinValue!=="undefined"?this.nMinValue:Math.min(this.nMin,this.nAllMinValue);this.nMaxValue=="auto"&&(U=this.nMaxValuePlot=db);if(this.nMaxValue=="inherit"){this.nMaxValuePlot=this.nMinValuePlot=null;for(var Ec=0;Ec<this.parent.themesA.length;Ec++)this.parent.themesA[Ec]!=this&&this.parent.themesA[Ec].nMaxValuePlot&&(U=this.parent.themesA[Ec].nMaxValuePlot)}oa=map.Scale.normalX(g)/(U-Za)*
(this.nGridX||n.length-1)*(this.nRangeScale||1);if(!ac){var ie=this.szId+":"+this.itemA[a].szSelectionId+":chartgrid",cb=null;if(!cb||b.match(/ZOOM/))N=N||map.Dom.newGroup(d,this.szId+":"+a+":chartontop"),cb=map.Dom.newGroup(N,ie)}if(b.match(/PLOTXY/))ac||(ac=!0,b.match(/BOX/)&&b.match(/\bGRID\b/)&&!cb.childNodes.length&&(map.Dom.newShape("line",cb,0,0,this.nChartWidth+100,0,"stroke:#888888;stroke-width:"+map.Scale.normalX(.3)+";"),map.Dom.newShape("line",cb,0,0,0,-this.nChartHeight-100,"stroke:#888888;stroke-width:"+
map.Scale.normalX(.3)+";"),map.Dom.newText(cb,10,80,"font-family:arial;font-size:80px;text-anchor:start;fill:#444444;stroke:none;pointer-events:none;",String(this.nMinX)),map.Dom.newText(cb,this.nChartWidth+100,80,"font-family:arial;font-size:80px;text-anchor:end;fill:#444444;stroke:none;pointer-events:none;",String(this.nMaxX)),map.Dom.newText(cb,-10,10,"font-family:arial;font-size:80px;text-anchor:end;fill:#444444;stroke:none;pointer-events:none;",String(this.nMinY)),map.Dom.newText(cb,-10,-this.nChartHeight-
100+80,"font-family:arial;font-size:80px;text-anchor:end;fill:#444444;stroke:none;pointer-events:none;",String(this.nMaxY)))),ub=50+(this.itemA[a].nX-this.nMinX)*this.nChartWidth/this.nRangeX,Tb=-100-(this.itemA[a].nY-this.nMinY)*this.nChartHeight/this.nRangeY,F.fu.setPosition(ub,Tb),eb&&eb.fu.setPosition(ub,Tb),Db&&Db.fu.setPosition(ub,Tb),bb&&bb.fu.setPosition(ub,Tb),ea&&ea.fu.setPosition(ub,Tb);else if(b.match(/PLOTYX/))F.fu.setPosition((U+Math.abs(U-l))*oa,Ia),eb&&eb.fu.setPosition((U+Math.abs(U-
l))*oa,Ia),ea&&ea.fu.setPosition((U+Math.abs(U-l))*oa,Ia);else if(b.match(/PLOTY/)){F.fu.setPosition(0,(-U+Math.abs(U-l))*oa);eb&&eb.fu.setPosition(0,(-U+Math.abs(U-l))*oa);ea&&ea.fu.setPosition(0,(-U+Math.abs(U-l))*oa);var ab=1;ab=U/5;ab=Math.floor(Math.log(ab))*10*Math.ceil(ab/(Math.floor(Math.log(ab))*10))||1;U=Math.ceil(U/ab)*ab;if(!ac&&(ac=!0,b.match(/BOX/)&&b.match(/\bGRID\b/)))for(u=map.Scale.normalX(g)/2;u<U*oa;u+=oa*ab)map.Dom.newShape("line",cb,-20,-u,20,-u,"stroke:#444444;stroke-width:"+
map.Scale.normalX(1)+";")}else if(b.match(/PLOTX/)){if(F.fu.setPosition((U-Math.abs(U-l))*oa,0),eb&&eb.fu.setPosition((U-Math.abs(U-l))*oa,0),ea&&ea.fu.setPosition((U-Math.abs(U-l))*oa,0),ab=1,ab=U/5,ab=Math.floor(Math.log(ab))*10*Math.ceil(ab/(Math.floor(Math.log(ab))*10))||1,U=Math.ceil(U/ab)*ab,!ac&&(ac=!0,b.match(/BOX/)&&b.match(/\bGRID\b/)))for(u=map.Scale.normalX(g);u<U*oa+map.Scale.normalX(g);u+=oa*ab)map.Dom.newShape("line",cb,u,-20,u,20,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+
";")}else{ab=1;ab=Math.ceil(U-Za)/5;ab<.5&&(ab=Math.ceil(U-Za)/10);if(ab>1){var Wd=Math.pow(10,Math.floor(Math.log10(ab)));ab=Math.ceil(ab/Wd)*Wd||1}U=Math.ceil(U/ab)*ab;for(Za=Math.floor(Za/ab)*ab;(U-Za)/ab<5;)ab/=2;(U-Za)/ab>5&&(ab*=2);if(!ac){ac=!0;this.plot_last_last_position=[];this.plot_last_position=[];this.plot_last_value=[];this.plot_last_stacked_value=[];this.plot_last_shape=[];this.plot_last_mean=[];this.plot_last_areaValue=[];this.plot_area_points=[];this.plot_area_shapes=[];this.plot_area_shapes[0]=
map.Dom.newShape("path",C,"M0,0","fill:"+J+";fill-opacity:"+(this.fillOpacity||1)+";stroke:none");var Ac=n.length/(this.nGridX||1),rc=map.Scale.normalX(Math.max(n.length/(this.nGridX||1),3));rc*=(b.match(/ZOOM/),1);var sc=map.Dom.newGroup(C,"");sc.parentNode.insertBefore(sc,C.firstChild);if(b.match(/BOX/)&&b.match(/\bGRID\b/)&&(b.match(/ZOOM/)||!(this.nBoxUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nBoxUpper||this.nBoxLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nBoxLower))){if(!b.match(/ZOOM/)){var gd=
-da/(b.match(/LINES/)?3:1),tc=da*(this.nGridX?n.length/this.nGridX-1:n.length-1);map.Dom.newShape("rect",C,0,-(U-Za)*oa,tc,(U-Za)*oa,"fill:#ffffff;fill-opacity:0;stroke:none;pointer-events:none")}var Xd=.8,je=0;for(u=0;u<=(U-Za)*oa;u+=oa*ab){var Ad=this.formatValue(Math.round(b.match(/INVERT/)?U-u/oa+Za:(u/oa+Za)*100)/100,2);U>5&&(Ad=String(Math.round(b.match(/INVERT/)?U-u/oa+Za:u/oa+Za)));var nc=u;b.match(/LOG/)&&(nc=100*Math.pow(10,je++),nc>U&&(u=U*oa),Ad=this.formatValue(nc,0),nc=Math.log10(nc)*
U/Math.ceil(Math.log10(U))*oa);gd=-da/(b.match(/LINES/)?5:1);tc=da*(this.nGridX?n.length/this.nGridX-1:n.length-1);b.match(/PLOTVAR/)&&n.length/this.nGridX>1&&(tc=da*this.nGridX);if(b.match(/GRADIENT/)&&u!==0){var Yd=tc+(b.match(/LINES/),0);ra=map.Dom.newShape("path",C,"M0,"+-u+" L "+Yd+","+-u+" "+Yd+","+(-u+oa*ab)+" 0,"+(-u+oa*ab)+" z","fill:#d8d8dd;fill-opacity:"+Xd+";stroke:none;");Xd-=.3}nc===-Za*oa?map.Dom.newShape("line",cb,gd,-nc,tc,-nc,"stroke:#444444;stroke-opacity:1;stroke-width:"+map.Scale.normalX(.05*
Ac)+";"):map.Dom.newShape("line",cb,gd,-nc,tc,-nc,"stroke:#888888;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.05*Ac)+";stroke-dasharray:"+6*Ac+" "+3*Ac+";");b.match(/RIGHT/)?map.Dom.newText(cb,tc+map.Scale.normalX(15),-nc+rc*.3,"font-family:arial;font-size:"+rc+"px;text-anchor:start;fill:"+(b.match(/\bCOLOR\b/)?J:"#888888")+";stroke:none;pointer-events:none;",Ad):map.Dom.newText(cb,gd*1.1,-nc+rc*.3,"font-family:arial;font-size:"+rc+"px;text-anchor:end;fill:"+(b.match(/\bCOLOR\b/)?J:"#888888")+
";stroke:none;pointer-events:none;",Ad);this.nPlotHeight=u}b.match(/ZOOM/)&&(this.nLowValue&&(map.Dom.newShape("line",cb,gd,-(this.nLowValue-Za)*oa,tc,-(this.nLowValue-Za)*oa,"stroke:#dd0000;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.1*Ac)+";stroke-dasharray:"+6*Ac+" "+3*Ac+";"),b.match(/ZOOM/)&&map.Dom.newText(cb,tc*1.06,-(this.nLowValue-Za)*oa+rc*.3,"font-family:arial;font-size:"+rc+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",this.nLowValue)),this.nHighValue&&(map.Dom.newShape("line",
cb,gd,-(this.nHighValue-Za)*oa,tc,-(this.nHighValue-Za)*oa,"stroke:#dd0000;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.1*Ac)+";stroke-dasharray:"+6*Ac+" "+3*Ac+";"),b.match(/ZOOM/)&&map.Dom.newText(cb,tc*1.06,-(this.nHighValue-Za)*oa+rc*.3,"font-family:arial;font-size:"+rc+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",this.nHighValue)));map.Dom.newShape("line",cb,Ia,0,Ia,-(U-Za)*oa,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(.1)+";");if(this.szXaxisA&&this.szXaxisA.length)for(u=
0;u<this.szXaxisA.length;u++)if(this.szXaxisA[u].length&&this.szXaxisA[u]!=" "||u==0||u==this.szXaxisA.length-1)map.Dom.newShape("line",cb,da*u,100,da*u,-(U-Za)*oa,"stroke:#888888;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.05*this.szXaxisA.length)+";stroke-dasharray:"+6*this.szXaxisA.length+" "+3*this.szXaxisA.length+";"),map.Dom.newText(cb,da*u,rc*1.5,"font-family:arial;font-size:"+rc+"px;text-anchor:middle;fill:#888888;stroke:none;pointer-events:none;",this.szXaxisA[u])}b.match(/NOCLIP/)||
map.Dom.setClipRect(C,{x:-100,y:-(U-Za)*oa,width:100+E/(this.nGridX||1)*da,height:100+(U-Za)*oa})}var Bc=this.nGridX?Math.floor(f/this.nGridX)+1:1,Pa=this.nGridX?f%this.nGridX:1;b.match(/LOG/)&&l&&(l=Math.log10(l)*U/Math.ceil(Math.log10(U)));var zb=b.match(/INVERT/)?U-l:l;zb-=Za;zb+=b.match(/STACKED/)?this.plot_last_stacked_value[Bc]||0:0;F.fu.setPosition(Ia,-zb*oa);eb&&eb.fu.setPosition(Ia,-zb*oa);if(ea&&ea.parentNode){if(this.nXLen>10){var Zd=Math.floor(f/(this.nGridX||1));Zd!=0&&Zd!=this.nXLen-
1&&ea.parentNode.removeChild(ea)}ea&&ea.parentNode&&(b.match(/\bINLINETEXT\b/)?ea.fu.setPosition(Ia,-zb*oa):b.match(/\bSTACKED\b/)?ea.parentNode.removeChild(ea):b.match(/LINES/)&&(this.nGridX==null||this.nGridX<=1)?(ea.fu.setPosition(Ia-map.Scale.normalX(g*this.nGridX||1),-zb*oa),ea.fu.scale(2.5,2.5)):(ea.fu.scale(1.5*this.nValueScale,1.5*this.nValueScale),ea.fu.setPosition(Ia-map.Scale.normalX(g/7),-zb*oa)))}if(b.match(/LINES/)){var ra=null;if(b.match(/ZEROISVALUE/)&&!b.match(/ZEROISNOTVALUE/)&&
this.plot_last_position[Pa]&&(l||this.plot_last_position[Pa].y)||l&&this.plot_last_position[Pa]&&this.plot_last_position[Pa].y)if(b.match(/AREA/)){if(ra=map.Dom.newShape("path",sc,"M"+(this.plot_last_position[Pa].x-2)+","+this.plot_last_position[Pa].y+"L"+Ia+","+-zb*oa+" "+Ia+","+(-zb+l)*oa+" "+(this.plot_last_position[Pa].x-2)+","+((this.plot_last_last_position[Pa-1]?this.plot_last_last_position[Pa-1].y:0)+Za*oa)+" z","fill:"+J+";fill-opacity:"+(this.fillOpacity||1)+";")){ra.setAttributeNS(szMapNs,
"value",String(l));ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6)));var Md=this.nXLen<25?this.formatValue(this.plot_last_areaValue[Pa],this.nValueDecimals||2)+" ... "+this.formatValue(l,this.nValueDecimals||2):this.formatValue(l,this.nValueDecimals||2);ra.setAttributeNS(szMapNs,"tooltip",Md+this.szUnit+" "+(this.szLabelA?this.szLabelA[ma%(this.nGridX||1E6)]:""));ra.setAttributeNS(szMapNs,"time",String(Va));if(this.szFlag.match(/\bFADE\b/)){var $d="Gradient"+Math.random(),ae=map.Dom.constructNode("linearGradient",
C,{id:$d,gradientTransform:"rotate(90)"});map.Dom.constructNode("stop",ae,{offset:"0","stop-color":J,"stop-opacity":"1"});map.Dom.constructNode("stop",ae,{offset:"1","stop-color":J,"stop-opacity":"0.1"});ra.style.setProperty("fill","url(#"+$d+")")}}var ke=f==1||f==E-1||Bc==2||Bc==E/(this.nGridX||1)?"but":"round";if(ra=map.Dom.newShape("line",sc,this.plot_last_position[Pa].x,this.plot_last_position[Pa].y,Ia,-zb*oa,"stroke:"+J+";stroke-width:"+map.Scale.normalX(b.match(/STACKED/)?1:this.nLineWidth||
3)+";stroke-linecap:"+ke+";"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"tooltip",this.formatValue(l,this.nValueDecimals||2)+this.szUnit+" "+(this.szLabelA?this.szLabelA[ta%(this.nGridX||1E6)]:""))}else{ra=map.Dom.newShape("line",sc,this.plot_last_position[Pa].x,this.plot_last_position[Pa].y,Ia,-zb*oa,"stroke:"+(this.szLineColor||J)+";stroke-width:"+map.Scale.normalX(this.nLineWidth||3)+";stroke-linecap:round;");Md=this.nXLen<25?this.formatValue(this.plot_last_areaValue[Pa],
this.nValueDecimals||2)+" ... "+this.formatValue(l,this.nValueDecimals||2):this.formatValue(l,this.nValueDecimals||2);ra&&(ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"tooltip",Md+this.szUnit+" "+(this.szLabelA?this.szLabelA[ta%(this.nGridX||1E6)]:"")),ra.setAttributeNS(szMapNs,"time",String(Va)));try{C.insertBefore(ra,this.plot_last_shape[Pa])}catch(zd){}}b.match(/LOLLIPOP/)&&l&&(ra=map.Dom.newShape("line",
sc,Ia,Za*oa,Ia,-zb*oa,"stroke:"+J+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:butt;"))&&(ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"time",String(Va)));b.match(/LASTPOP/)&&l&&f>=E-(this.nGridX||1)&&(console.log("=== LASTPOP CREATION ==="),console.log("szFlag:",b),console.log("nValue:",l),console.log("i:",f),console.log("nMaxI:",E),console.log("this.nGridX:",this.nGridX),console.log("condition (i >= nMaxI - (this.nGridX || 1)):",
f>=E-(this.nGridX||1)),console.log("this.szId:",this.szId),(ra=map.Dom.newShape("circle",sc,Ia,-zb*oa,map.Scale.normalX((this.nLineWidth||5)*(this.nMarkerSize||1.5)),"fill:"+J+";stroke:"+L+";stroke-width:"+G+";"))?(console.log("LASTPOP plotShape created:",ra),ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"time",String(Va))):console.log("LASTPOP plotShape creation FAILED"));if(ra&&this.szFlag.match(/\bLASTARROW\b/)&&f>=E-(this.nGridX||1)){var be="ArrowMarker"+Math.random(),
le=map.Dom.newNode("defs",sc),Xc=Math.min(5,2.5+100/((this.nLineWidth||1)/this.nChartGroupScale))*(this.nMarkerSize||3),me=map.Dom.constructNode("marker",le,{id:be,markerWidth:Xc,markerHeight:Xc,refX:Xc/1.7,refY:Xc/2,orient:"auto",markerUnits:"strokeWidth"});map.Dom.constructNode("path",me,{d:"M0,"+Xc+" L"+Xc+","+Xc/2+" L0,0 Z",style:"fill:"+J+";opacity:1;stroke:none;stroke-width:0.03"});ra.setAttributeNS(null,"marker-end","url(#"+be+")")}b.match(/\bLASTVALUE\b/)&&!b.match(/\bZOOM\b/)&&l&&f>=E-(this.nGridX||
1)&&(console.log("=== LASTVALUE CREATION ==="),console.log("szFlag:",b),console.log("nValue:",l),console.log("i:",f),console.log("nMaxI:",E),console.log("this.nGridX:",this.nGridX),console.log("condition (i >= nMaxI - (this.nGridX || 1)):",f>=E-(this.nGridX||1)),console.log("this.szId:",this.szId),(ea=this.createTextLabel(map.SVGDocument,C,"",l,3/this.nScale*this.nValueScale,"","rgba(255,255,255,0)",this.szTextColor||"#444444","GLOW"))?(console.log("LASTVALUE newText created:",ea),ea.fu.setPosition(Ia-
2E3,-zb*oa-1E3)):console.log("LASTVALUE newText creation FAILED"));if(b.match(/PLOTVAR/)){var Ob=b.match(/MEDIAN/)?this.nMedianA[ma]:this.nMeanA[ma];Ob-=Za;this.plot_last_mean[Pa]&&((ra=map.Dom.newShape("path",cb,"M"+this.plot_last_mean[Pa].x+","+(this.plot_last_mean[Pa].y-this.nDeviationA[ma-1]*oa)+" L "+Ia+","+(-Ob-this.nDeviationA[ma])*oa+" "+Ia+","+(-Ob+this.nDeviationA[ma])*oa+" "+this.plot_last_mean[Pa].x+","+(this.plot_last_mean[Pa].y+this.nDeviationA[ma-1]*oa)+" z","fill:#d8d8dd;fill-opacity:0.2;stroke:none;"))&&
ra.setAttributeNS(szMapNs,"tooltip","standard deviation"),(ra=map.Dom.newShape("line",C,this.plot_last_mean[Pa].x,this.plot_last_mean[Pa].y,Ia,-Ob*oa,"stroke:#888888;stroke-width:"+map.Scale.normalX(2)+";stroke-linecap:round;stroke-dasharray:10 80;"))&&ra.setAttributeNS(szMapNs,"tooltip","mean"));this.plot_last_mean[Pa]=new point(Ia,-Ob*oa)}this.plot_last_last_position[Pa]=b.match(/STACKED/)?this.plot_last_position[Pa]||new point(0,0):new point(0,0);this.plot_last_position[Pa]=zb>=0?new point(Ia,
-zb*oa):new point(Ia,0);this.plot_last_shape[Pa]=F;this.plot_last_areaValue[Pa]=l;this.plot_area_points.push(new point(Ia,-zb*oa))}else if(b.match(/LOLLIPOP/)&&l){if(ra=map.Dom.newShape("line",sc,Ia,Za*oa,Ia,-zb*oa,"stroke:"+J+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:butt;"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"time",String(Va))}else if(b.match(/LASTPOP/)&&l){if(ra=map.Dom.newShape("line",
sc,Ia,0,Ia,-zb*oa,"stroke:"+J+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:round;"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"time",String(Va))}else if(n.length/this.nGridX>1)if(b.match(/PLOTVAR/)){F.style.setProperty("fill-opacity",Bc==n.length/this.nGridX?"1":"0.2","");F.style.setProperty("stroke-width",Bc==n.length/this.nGridX?"0":"3","");ra=null;if(this.plot_last_position[Pa])if(b.match(/PLOTVAR/)){if(ra=
map.Dom.newShape("line",C,this.plot_last_position[Pa].x,this.plot_last_position[Pa].y,Ia,-zb*oa,"stroke:"+J+";stroke-width:"+map.Scale.normalX(2)+";"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"time",String(Va)),ra.parentNode.insertBefore(ra,ra.parentNode.firstChild);if(ra=map.Dom.newShape("line",C,this.plot_last_position[Pa].x-40,this.plot_last_position[Pa].y,this.plot_last_position[Pa].x+40,this.plot_last_position[Pa].y,
"stroke:"+J+";stroke-width:"+map.Scale.normalX(this.nLineWidth||3)+";"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"time",String(Va)),ra.parentNode.insertBefore(ra,ra.parentNode.firstChild);if(ra=map.Dom.newShape("line",C,Ia,0,Ia,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||
1E6))),ra.setAttributeNS(szMapNs,"time",String(Va)),ra.parentNode.insertBefore(ra,ra.parentNode.firstChild)}else if(ra=map.Dom.newShape("line",C,this.plot_last_position[Pa].x,this.plot_last_position[Pa].y,Ia,-zb*oa,"stroke:"+J+";stroke-width:"+map.Scale.normalX(this.nLineWidth||3)+";"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"time",String(Va)),C.insertBefore(ra,this.plot_last_shape[Pa]);this.plot_last_last_position[Pa]=
this.plot_last_position[Pa]||new point(0,0);this.plot_last_position[Pa]=new point(Ia,-zb*oa);this.plot_last_shape[Pa]=F}else b.match(/BOX/)&&map.Dom.newShape("line",cb,Ia,0,Ia,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";");else if(b.match(/PLOTVAR/)){ra=null;Ob=b.match(/MEDIAN/)?this.nMedianA[ma]:this.nMeanA[ma];Ob-=Za;if(ra=map.Dom.newShape("line",cb,Ia,-(Ob-this.nDeviationA[ma])*oa,Ia,-(Ob+this.nDeviationA[ma])*oa,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+
";"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"time",String(Va));if(ra=map.Dom.newShape("line",cb,Ia-40,-Ob*oa,Ia+40,-Ob*oa,"stroke:#444444;stroke-width:"+map.Scale.normalX(2)+";"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"time",String(Va));if(ra=map.Dom.newShape("line",cb,Ia-80,-(Ob-this.nDeviationA[ma])*oa,Ia+
80,-(Ob-this.nDeviationA[ma])*oa,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||1E6))),ra.setAttributeNS(szMapNs,"time",String(Va));if(ra=map.Dom.newShape("line",cb,Ia-80,-(Ob+this.nDeviationA[ma])*oa,Ia+80,-(Ob+this.nDeviationA[ma])*oa,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";"))ra.setAttributeNS(szMapNs,"value",String(l)),ra.setAttributeNS(szMapNs,"class",String(ta%(this.nGridX||
1E6))),ra.setAttributeNS(szMapNs,"time",String(Va));map.Dom.newShape("line",cb,Ia,0,Ia,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";");this.plot_last_position[Pa]&&(ra=map.Dom.newShape("line",cb,this.plot_last_position[Pa].x,this.plot_last_position[Pa].y,Ia,-Ob*oa,"stroke:#888888;stroke-width:"+map.Scale.normalX(1)+";"));this.plot_last_last_position[Pa]=this.plot_last_position[Pa]||new point(0,0);this.plot_last_position[Pa]=new point(Ia,-Ob*oa)}else b.match(/BOX/)&&map.Dom.newShape("line",
cb,Ia,0,Ia,-this.nPlotHeight,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(.25)+";");this.plot_last_value[Bc]=l;this.plot_last_stacked_value[Bc]=zb}qb=0}else La=="label"&&(qb-=Kd/1.95),F.fu.setPosition(map.Scale.normalX(0)+pb,map.Scale.normalY(0)+qb),eb&&eb.fu.setPosition(map.Scale.normalX(0)+pb,map.Scale.normalY(0)+qb),ea&&ea.fu.setPosition(pb,map.Scale.normalY(0)+qb),qb=La=="label"?qb-Kd/1.95:qb-w}}}else{var La="";if(this.nRangesA&&this.nRangesA.length)for(Wa=0;Wa<this.nRangesA.length;Wa++)if(l==
this.nRangesA[Wa]||Number(l)==Number(this.nRangesA[Wa])){La=this.szSymbolsA[Wa]||this.szSymbolsA[0]||"circle";ta=Wa;break}La=this.itemA[a].szSymbol||La;Lb=String(l);T=String(l);this.szLabelA&&this.szLabelA[ta]&&(Lb=this.szLabelA[ta],T=this.szLabelA[ta]);La.length||ma!==0||(La="empty",Lb=T="no data",ta=0);if(La.length){Hc++;F=null;ta=typeof this.itemA[a].nClass!="undefined"?this.itemA[a].nClass:ta;J=typeof this.itemA[a].szColor!="undefined"?this.itemA[a].szColor:this.colorScheme[ta];if(b.match(/NOLINES/))L=
"none";else if(L=this.itemA[a].szColor||this.colorScheme[ta],J=="white"||J=="#ffffff")L="gray";L=this.szLineColor||L;w=map.Scale.normalX(g/2);b.match(/FIXSIZE/)?w=map.Scale.normalX(g/2)/(this.nNormalSizeValue||1):b.match(/NOSIZE/)?w=map.Scale.normalX(g/2):a&&this.itemA[a]&&this.itemA[a].nSize&&(w=w/Math.pow(this.nNormalSizeValue||this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[a].nSize,1/this.nSizePow));if(La=="circle"||La=="square"||La=="roundrect"||La=="label"||La=="carot"||La=="diamond"||La==
"triangle"||La=="hexagon"||La=="cross"||La=="empty"){M=map.Scale.normalX(g/2);G=(this.nLineWidth||1)*map.Scale.normalX(Math.min(w/M,1));switch(La){case "empty":F=map.Dom.newShape("circle",C,0,0,w,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+G+";");break;case "circle":F=map.Dom.newShape("circle",C,0,0,w,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";");break;case "square":F=map.Dom.newShape("rect",C,-w*.8,-w*.8,w*2*.8,w*2*.8,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";");break;case "roundrect":F=
map.Dom.newShape("rect",C,-w*.8,-w*.8,w*2*.8,w*2*.8,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";");F.setAttributeNS(null,"rx",w*.3);break;case "cross":var Rb=w*.4,Gb=w*.8;F=map.Dom.newShape("path",C,"M 0,-"+(Gb+Rb/2)+" l"+Rb/2+",0 0,"+Gb+" "+Gb+",0 0,"+Rb+" -"+Gb+",0 0,"+Gb+" -"+Rb+",0 0,-"+Gb+" -"+Gb+",0 0,-"+Rb+" "+Gb+",0 0,-"+Gb+" "+Rb/2+",0 z","fill:"+J+";stroke:"+L+";stroke-width:"+G+";");break;case "diamond":case "carot":(F=map.Dom.newShape("rect",C,-w*.8,-w*.8,w*2*.8,w*2*.8,"fill:"+J+";stroke:"+
L+";stroke-width:"+G+";"))&&F.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":F=map.Dom.newShape("path",C,"M 0,"+w+" l"+w*1.2+",-"+w*2+" -"+w*2.4+",0 "+w*1.2+","+w*2+"z","fill:"+J+";stroke:"+L+";stroke-width:"+G+";");break;case "hexagon":Rb=w/2;Gb=w*Math.sin(60/180*Math.PI);var pd=w;F=map.Dom.newShape("path",C,"M -"+w+",0 l "+Rb+",-"+Gb+" "+pd+",0 "+Rb+","+Gb+" -"+Rb+","+Gb+" -"+pd+",0 -"+Rb+",-"+Gb+" z","fill:"+J+";stroke:"+L+";stroke-width:"+G+";");break;case "label":var Kd=
w*2*.4;F=map.Dom.newShape("rect",C,-w*.8,-w*.4,w*2*.8,w*2*.4,"fill:"+J+";stroke:"+L+";stroke-width:"+G+";")}if(!F)continue;if(b.match(/HORZ/)){b.match(/LEFT/)&&(ma=-ma);b.match(/VALUES/)&&(p=O(J),L=p.textColor,ea=map.Dom.newText(ic,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(w/2)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",T),ea.fu.setPosition(ma*w*2,-w-map.Scale.normalX(5)),n.length>1&&setRotate(ea,-45));if(b.match(/AXIS/)&&this.szXaxisA&&
(!this.fHideValues||b.match(/ZOOM/))){p=O(J);L=p.textColor;var Bd=this.szXaxisA[f];ea=map.Dom.newText(ic,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(w)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",Bd);ea.fu.setPosition(ma*w*2+map.Scale.normalX(2),w+map.Scale.normalX(1));n.length>1&&setRotate(ea,45)}F.setAttributeNS(szMapNs,"tooltip",Lb);F.fu.setPosition(ma*w*2,0);b.match(/LEFT/)&&(ma=-ma)}else{if(b.match(/VALUES/)&&(!this.fHideValues||
b.match(/ZOOM/))){p=O(J);ka=this.szValueColor||this.szTextColor||p.textColor;var Ld=Math.max((yb?.length||0)+1,qc.length);b.match(/INLINETEXT/)?(va=this.formatValue(yb,this.nValueDecimals||(yb<1||U<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),Ca=String(Math.min(M*1,(La=="hexagon"?2.7:3.2)/Ld*M)),Ca*=w/M*this.nValueScale,ea=map.Dom.newText(C,0,Ca*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+Ca+"px;text-anchor:middle;fill:"+ka+";stroke:none;pointer-events:none",va)):(p=O(J),
L=p.textColor,va=this.formatValue(yb,this.nValueDecimals||(yb<1||U<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),ea=map.Dom.newText(ic,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(w/2*this.nValueScale)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",va),ea.fu.setPosition(w+map.Scale.normalX(3),-ma*(w*2-map.Scale.normalY(0))))}F.setAttributeNS(szMapNs,"tooltip",Lb);F.fu.setPosition(0,-ma*(w*2-map.Scale.normalY(0)))}b.match(/OUTLINE/)?
(F.style.setProperty("stroke-width",String(map.Scale.normalX(.5))),F.style.setProperty("stroke-opacity","1"),F.style.setProperty("fill-opacity","0.7")):b.match(/DOPACITY/)&&this.szAlphaField?a&&typeof this.itemA[a].nAlpha!="undefined"&&(z=1/(this.nDopacityPow||1),vb=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,z)*Math.pow(this.itemA[a].nAlpha,z),F.style.setProperty("fill-opacity",String(vb),"")):F.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:
1),"")}else{La.match(/.svg|.png|.jpeg/)?(F=map.Dom.constructNode("image",C,{"xlink:href":La}),F.setAttributeNS(null,"x",String(map.Scale.normalX(-g/2))),F.setAttributeNS(null,"y",String(map.Scale.normalY(-g))),F.setAttributeNS(null,"width",String(map.Scale.normalX(g))),F.setAttributeNS(null,"height",String(map.Scale.normalY(g)))):F=map.Dom.constructNode("use",C,{"xlink:href":"#"+La+":antizoomandpan"});F.setAttributeNS(null,"style","fill:"+J+";stroke:"+L);if(this.szSizeField&&a&&this.itemA[a]){var oa=
1/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[a].nSize);F.fu.scale(oa,oa)}F.fu.scale(w/g,w/g);F.fu.setPosition(map.Scale.normalX(0)+ma*map.Scale.normalX(20),map.Scale.normalY(0));ma>0&&(map.Dom.newText(C,map.Scale.normalX(-9)+ma*map.Scale.normalX(20),0,"font-family:"+(this.szTextFont||"arial")+";font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:none;stroke:black;stroke-width:60;pointer-events:none;opacity:0.3;","+"),map.Dom.newText(C,map.Scale.normalX(-9)+ma*map.Scale.normalX(20),0,"font-family:"+
(this.szTextFont||"arial")+";font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:white;stroke:none;pointer-events:none;opacity:0.8;","+"));b.match(/VALUES/)&&(p=O(J),L=p.textColor,ea=map.Dom.newText(ic,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(w/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",T),ea.fu.setPosition(w/2+map.Scale.normalX(3),w*2*-ma),b.match(/MULTILINE/)&&this.szSizeField&&a&&this.itemA[a]&&(ea=map.Dom.newText(ic,
0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(w/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",String(this.itemA[a].nSize)+this.szSizeValueUnits),ea.fu.setPosition(w/2+map.Scale.normalX(3),w*2*-ma+w/2)))}F.setAttributeNS(szMapNs,"value",String(l));F.setAttributeNS(szMapNs,"class",String(ta));F.setAttributeNS(szMapNs,"time",String(Va));this.nRealizedCount++}else this.nMissingRangeCount++}}}ic&&ic.parentNode&&ic.parentNode.appendChild(ic);
Kb&&Kb.parentNode&&Kb.parentNode.appendChild(Kb);xb&&xb.parentNode&&xb.parentNode.appendChild(xb);mb&&mb.parentNode&&mb.parentNode.appendChild(mb);if(0&b.match(/AREA/)&&!this.nGridX&&this.plot_area_points&&this.plot_area_points.length){var ce=!0,Nd=this.plot_area_points.length;for(rb=0;rb<Nd;rb++)this.plot_area_points[rb].y===0&&(ce=!1);if(ce||b.match(/ZEROISVALUE/)){var qd="M"+this.plot_area_points[0].x+","+this.plot_area_points[0].y+" L ";for(rb=1;rb<Nd;rb++)qd+=this.plot_area_points[rb].x+","+
this.plot_area_points[rb].y+" ";qd+=this.plot_area_points[Nd-1].x+",0 ";qd+="0,0 ";qd+="z ";this.plot_area_shapes[0].setAttributeNS(null,"d",qd)}}if(b.match(/\bLINREG\b/)){var Ic=0,Jc=n.length-1,Yc=pc*Ic+qa,hd=pc*Jc+qa;L=this.szLineColorA?this.szLineColorA[0]:this.chart.szColor;map.Dom.newShape("line",sc,Ic*da,-Yc*oa,Jc*da,-hd*oa,"stroke:"+L+";stroke-width:50;stroke-dasharray:50 50").setAttributeNS(szMapNs,"tooltip","linerar regression")}if(typeof this.szSymbolBoxStyle!="undefined"){var de=map.Dom.getBox(C);
hc.setAttributeNS(null,"x",-map.Scale.normalX(15));hc.setAttributeNS(null,"y",-map.Scale.normalY(15));hc.setAttributeNS(null,"width",map.Scale.normalX(30*Hc));hc.setAttributeNS(null,"height",map.Scale.normalY(30));hc.setAttributeNS(null,"fill-opacity",1)}B.x=map.Scale.normalY(0);B.y=map.Scale.normalY(b.match(/ZOOM/)||b.match(/MENUSIZE/)?20:w/map.Scale.normalY(1)+5)}else if(b.match(/BUFFER/)){U=this.nMaxA[0];l=n[0];w=this.nBufferSize?this.nBufferSize:1E3;this.szShapeType.match(/line/)&&(w*=this.nScale);
w=map.Scale.getDeltaXofDistanceInMeter(w);J=this.colorScheme[0];if(this.szFields&&this.szFields.length&&this.nRangesA&&this.nRangesA.length&&(J=null,this.nRangesA.length==this.colorScheme.length))for(f=0;f<this.nRangesA.length;f++)if(l==this.nRangesA[f]||Number(l)==Number(this.nRangesA[f])){J=this.colorScheme[f];p=O(J);L=typeof this.szBorderColor!="undefined"?this.szBorderColor:this.fillOpacity<.8?"#888888":p.textColor;break}if(this.szShapeType.match(/dummy||point/))if(J){g=w*2/map.Scale.normalX(1);
B.x=0;B.y=w+map.Scale.normalY(5);this.szFlag.match(/OVERLAY/);F=map.Dom.newShape("circle",C,0,0,w,"");if(this.szFlag.match(/VALUE/)){var Zc="font-family:arial;font-size:"+map.Scale.normalX(30)+"px;fill:#222222;fill-opacity:1;stroke:white;stroke-opacity:0.2;stroke-dasharray:none;pointer-events:none;";ea=map.Dom.newText(C,w-map.Scale.normalX(20),0,Zc,ixMap.Scale.prototype.formatDistanceString(this.nBufferSize))}this.nRealizedCount++}else return new point(0,0);if(this.szShapeType.match(/line/)){var Cd=
map.SVGDocument.getElementById(a),Od=Cd.getAttributeNS(null,"id");if(!Od.match(":paint")){var rd=map.SVGDocument.getElementById(Od+":paint");rd||(rd=Cd.cloneNode(1E3),C.appendChild(rd),rd.setAttributeNS(null,"id",Od+":paint"));Cd=rd;this.nRealizedCount++}var ne=w*2/map.Scale.normalX(1);Cd.setAttributeNS(null,"style","fill:none;stroke:"+J+";stroke-linejoin:round;stroke-linecap:round;stroke-width:"+map.Scale.normalX(ne)*map.Scale.nZoomScale+";stroke-opacity:"+String(this.fillOpacity?this.fillOpacity:
this.nOpacity?this.nOpacity:0));return null}}else if(b.match(/BAR/)||b.match(/BARS/)){var za=0,sb=0,oe=g,Fb=1;ob=0;h=1;na=this.nMax-this.nMin;jb=this.nMax100-this.nMin100;this.nNormalSizeValue&&(na=jb=this.nMaxSize=this.nNormalSizeValue);if(b.match(/SIZE/)&&!b.match(/NORMSIZE/)&&this.szSizeField&&a&&this.itemA[a])Fb=b.match(/SIZELOG/)?1/Math.max(1,Math.log(this.nMaxSize)*Math.log(this.itemA[a].nSize)):1/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[a].nSize,1/this.nSizePow);else if(b.match(/SIZE/)&&
!b.match(/NORMSIZE/)){var Dd=e;b.match(/POINTER/)&&(Dd/=n.length);Fb=b.match(/SIZELOG/)?1/Math.max(1,Math.log(na)*Math.log(Math.abs(Dd))):1/Math.pow(na,1/this.nSizePow)*Math.pow(Math.abs(Dd),1/this.nSizePow)}Fb===0&&e!==0&&(Fb=30/g);g*=Fb;var R=map.Scale.normalX(g/n.length*.66);b.match(/STACKED/)&&(R=map.Scale.normalX(g/3),this.nGridX&&!b.match(/MULTI/)&&(R/=2));b.match(/MENUSIZE/)&&n.length==1&&(R=map.Scale.normalX(g/2));ya=R<map.Scale.normalX(5)?R*4/5:R*5/5;$b=1;b.match(/COLUMN/)&&(R*=b.match(/THICK/)?
2:b.match(/THIN/)?1:1.5);b.match(/THIN/)&&(R*=.6,ya*=.75);b.match(/THICK/)&&(R*=1.5,ya*=1.5);b.match(/STACKED/)?ya=map.Scale.normalX(5):(b.match(/ZOOM/)||b.match(/NORMSIZE/))&&n.length==1&&(ya*=2.5);b.match(/STACKED/)&&!b.match(/ZOOM/)&&(ya*=Fb);ya*=this.nValueScale||1;Zc="font-family:arial;font-size:"+ya*.95+"px;fill:#606060;pointer-events:none;";Zc=map.Scale.tStyle.Values.szStyle+"font-size:"+ya*.95+"px";b.match(/NORMSIZE/)||b.match(/MENUSIZE/)||this.szFlag.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||
!this.nNormalSizeValue||this.szField100&&!b.match(/POINTER/)||(c=this.nNormalSizeValue);this.nOverrideMax&&(c=this.nOverrideMax);da=map.Scale.normalX(oe)/c;if(b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)||b.match(/DEVIATION/))da=map.Scale.normalX(g)/300;b.match(/SIZE/)&&b.match(/SEQUENCE/)&&a&&n.length>1&&!this.szSizeField&&!this.szField100?da=da*n.length/Fb:b.match(/SIZE/)&&a&&n.length>1&&!b.match(/EXPAND/)&&(da=this.szField100||b.match(/POINTER/)?da*Fb:da/(b.match(/SIZEP4/)?Fb*Fb:Fb));this.nRangeScale&&
(da*=this.nRangeScale);b.match(/COMPRESSMAX/)?da/=4:b.match(/COMPRESSMORE/)?da/=3:b.match(/COMPRESS/)?da/=2:b.match(/EXPANDMAX/)?da*=4:b.match(/EXPANDMORE/)?da*=3:b.match(/EXPAND/)&&(da*=2);b.match(/POINTER/)&&!b.match(/NORMSIZE/)&&(da*=1.2);var sd=map.Dom.newGroup(C,"");if(b.match(/\bSORT\b/)){this.sortedIndex=[];for(f=0;f<n.length;f++)this.sortedIndex[f]={index:f,value:n[f]};this.sortedIndex.sort(b.match(/STACKED/)?this.sortIndexUp:this.sortIndexDown)}else this.sortedIndex=null;Mb=0;b.match(/\bUP\b/)&&
(Mb=n.length-1);var Xa=1;b.match(/CENTER/)&&(Xa=2);var $c=new point(0,0),Ed=null,Cc=null,Kc=null,Lc=null,Yb=null,Pd=null,Fd=Dd=0;ta=null;var pe=da;for(f=this.nClipParts&&this.nClipParts<n.length?n.length-this.nClipParts:0;f<n.length;f++){if(this.szShowParts){zc=!0;for(rb in this.szShowPartsA)this.szShowPartsA[rb]==f&&(zc=!1);if(zc)continue}da=pe;ma=Math.abs(Mb-f);this.sortedIndex&&(ma=this.sortedIndex[ma].index);l=n[ma];this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&
(l=this.nClipFrames==n.length?Number(n[this.nActualFrame]):n[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+n[n.length-1]*this.nActualFrame/(this.nClipFrames-1),ma=this.nActualFrame,f=n.length);var cc=l;b.match(/INVERT/)&&(l!==0||b.match(/ZEROISVALUE/))&&(l=this.nMax-l);Nb=this.formatValue(l,this.nValueDecimals||2);b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)?(b.match(/OFFSETMEAN/)&&(l*=100/this.nMeanA[ma]),b.match(/OFFSETMEDIAN/)&&(l*=100/this.nMedianA[ma]),l-=100,cc=l=isFinite(l)&&
!isNaN(l)?l:0,c=100,Nb=this.formatValue(l,this.nValueDecimals||2),l>0&&(Nb="+"+Nb)):b.match(/DEVIATION/)&&(l=(l-this.nMeanA[ma])/this.nDeviationA[ma],cc=l=isFinite(l)&&!isNaN(l)?l:0,l*=100,Nb=this.formatValue(l,this.nValueDecimals||2),l>0&&(Nb="+"+Nb));var ib=this.colorScheme[ma]||this.colorScheme[ma%(this.nGridX||1E6)];ta=ma%(this.nGridX||1E6);if((b.match(/SEQUENCE|CLIP/)||n.length==1)&&this.colorScheme.length>=2)for(ib=this.colorScheme[this.partsA.length-1],Wa=0;Wa<this.partsA.length;Wa++)if(l<
this.partsA[Wa].max){ib=this.colorScheme[Wa];ta=Wa;break}b.match(/LEFT/)&&b.match(/HORZ/)&&(l=-l);l<0&&!b.match(/STACKED/)&&(sb=-l*da,l=-l);b.match(/VOLUME/)&&b.match(/3D/)?(da=1,l=this.szSizeField&&a?R=map.Scale.normalX(g/3*2)*Math.pow(1/this.nMaxSize*this.itemA[a].nSize,1/3):R=map.Scale.normalX(g/3*2)*Math.pow(1/c*l,1/3)):(b.match(/POINTER/)&&b.match(/SIZE/)&&a&&(R=b.match(/WIDTH/)&&v&&(!(b.match(/DIFFERENCE/)||b.match(/RELATIVE/)||b.match(/FRACTION/))||b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)||
b.match(/DEVIATION/))?map.Scale.normalX(g)*Math.pow(Math.abs(1/this.nMax100*v),.5):map.Scale.normalX(g)*Math.pow(Math.abs(1/c*l),1/3),ya=R*.6,this.nValueSizeMin&&!b.match(/ZOOM/)&&(ya=ya*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?ya:0),this.nValueValueMin&&!b.match(/ZOOM/)&&(ya=l>this.nValueValueMin?ya:0),b.match(/ZOOM|XAXIS/)||($b=Math.pow(Math.abs(l),.5)/Math.pow(this.nMax,.5),this.szFadeValuePow&&Number(this.szFadeValuePow)&&($b=Math.pow(Math.abs(l),Number(this.szFadeValuePow))/
Math.pow(c,Number(this.szFadeValuePow))))),b.match(/DTEXT/)&&a&&!b.match(/ZOOM/)?(ya=map.Scale.normalX(g/3*2)*Math.pow(Math.abs(1/c*l),.5)*.75,this.nValueSizeMin&&!b.match(/ZOOM/)&&(ya=ya*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?ya:0),this.nValueValueMin&&!b.match(/ZOOM/)&&(ya=l>this.nValueValueMin?ya:0),$b=Math.pow(Math.abs(l),1/3)/Math.pow(c,1/3)):(this.nValueSizeMin&&!b.match(/ZOOM/)&&(ya=ya*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?ya:0),this.nValueValueMin&&
!b.match(/ZOOM/)&&(ya=l>this.nValueValueMin?ya:0)));l=isFinite(l)&&!isNaN(l)?l:0;if(l===0&&b.match(/NOZERO/))sb=0;else if(cc<0&&b.match(/NONEGATIVE/))sb=0;else if(cc>0&&b.match(/ONLYNEGATIVE/))sb=0;else{var Ea=map.Dom.newGroup(sd,"");this.szFlag.match(/MENUSIZE/)&&n.length==1&&!b.match(/VOLUME/)&&(R*=.8,l=R/da*1.7,map.Dom.newShape("rect",Ea,0,-map.Scale.normalY(g*.75),map.Scale.normalX(g*.5),map.Scale.normalY(g*.75),"fill:red;stroke:none;fill-opacity:0"));var nb=l;if(b.match(/COLUMN/))l*da>0&&(q=
DonutCharts.newChart(map.SVGDocument,Ea,za+R/2,0,R/2,0),q.setStyle("3D"),q.addStyle("SILENT"),q.addPart(100,l*da*2-(b.match(/SPACED/)?R/2:R/5),ib,0,(this.szAggregation&&this.szAggregation.match(/sum/),this.formatValue(n[Ta],this.nValueDecimals||(n[Ta]<5?1:0),"ROUND")+this.szUnit),this.formatValue(n[Ta],2)+this.szUnit+T),q.realize());else if(b.match(/3D/)){p=O(ib);if(b.match(/VOLUME/)&&Cc){var Pb=(l*da-Cc)/15;sb+=Pb;J="white";J="#444444";J=Pd.borderColor;var ee=Pd.mainColor,Qd=.3;Cc<l*da&&(Qd=.2);
map.Dom.newShape("line",Ea,Kc+Yb,Lc-Pb,za,sb-Pb,"stroke:"+J+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",Ea,Kc+Yb,Lc-Cc-Pb,za,sb-l*da-Pb,"stroke:"+J+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",Ea,Kc+Yb+Yb/3,Lc-Yb/4-Pb,za+R/3,sb-R/4-Pb,"stroke:"+J+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",Ea,Kc+Yb+Yb/3,Lc-Cc-Yb/4-Pb,za+R/3,sb-l*da-R/4-Pb,"stroke:"+J+";stroke-width:"+map.Scale.normalX(.25));map.Dom.newShape("path",Ea,"M"+(Kc+
Yb)+","+(Lc-Pb)+" L "+za+","+(sb-Pb)+" "+za+","+(sb-l*da-Pb)+" "+(Kc+Yb)+","+(Lc-Cc-Pb)+" z","fill:"+ee+";stroke:"+J+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:"+Qd);Cc-l*da>-R/4&&map.Dom.newShape("path",Ea,"M"+(Kc+Yb)+","+(Lc-Cc-Pb)+" L "+za+","+(sb-l*da-Pb)+" "+(za+R/3)+","+(sb-l*da-R/4-Pb)+" "+(Kc+Yb+Yb/3)+","+(Lc-Cc-Yb/4-Pb)+" z","fill:"+ee+";stroke:"+J+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:"+Qd)}Cc=l*da;Kc=za;Lc=sb;Yb=R;Pd=p;if(nb=this.nFilterA[ma]){var td="fill:#FFFFFF;stroke:gray;stroke-width:"+
map.Scale.normalX(.5)+";fill-opacity:0.1;stroke-opacity:0.1";map.Dom.newShape("path",Ea,"M"+za+",0 l "+R+",0 "+R/3+","+-R/4+" "+-R+" 0 z",td);map.Dom.newShape("rect",Ea,za+R/3,-nb*da/Xa-R/4,R,nb*da,td);map.Dom.newShape("path",Ea,"M"+za+",0 l 0,"+-nb*da/Xa+" "+R/3+","+-R/4+" 0,"+nb*da+" z",td);map.Dom.newShape("rect",Ea,za,-nb*da/Xa,R,nb*da,td);map.Dom.newShape("path",Ea,"M"+(za+R)+",0 l 0,"+-nb*da/Xa+" "+R/3+","+-R/4+" 0,"+nb*da+" z",td);p.highColor=ColorScheme.getDerivateColor(ib,.9)}sb<=0||b.match(/LEFT/)||
b.match(/VOLUME/)?(l&&(l===0&&(p=O("none")),map.Dom.newShape("rect",Ea,za,-l*da/Xa,R,l*da,"fill:"+p.mainColor+";stroke:"+p.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:0.3"),map.Dom.newShape("path",Ea,"M"+(za+R)+",0 l 0,"+-l*da/Xa+" "+R/3+","+-R/4+" 0,"+l*da+" z","fill:"+p.lowColor+";stroke:"+p.borderColor+";stroke-width:"+map.Scale.normalX(.05)),p.highColor=ColorScheme.getDerivateColor(ib,.9)),map.Dom.newShape("path",Ea,"M"+za+","+-l*da/Xa+" l "+R+",0 "+R/3+","+-R/4+" "+-R+
" 0 z","fill:"+p.highColor+";stroke:"+p.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:1")):(map.Dom.newShape("path",Ea,"M"+za+",0 l "+R+",0 "+R/3+","+-R/4+" "+-R+" 0 z","fill:"+p.highColor+";stroke:"+p.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.2"),map.Dom.newShape("rect",Ea,za+R/3,-l*da/Xa-R/4,R,l*da,"fill:"+p.mainColor+";stroke:"+p.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",Ea,"M"+za+",0 l 0,"+
-l*da/Xa+" "+R/3+","+-R/4+" 0,"+l*da+" z","fill:"+p.lowColor+";stroke:"+p.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),p.highColor=ColorScheme.getDerivateColor(ib,.9),map.Dom.newShape("rect",Ea,za,-l*da/Xa,R,l*da,"fill:"+p.mainColor+";stroke:"+p.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",Ea,"M"+(za+R)+",0 l 0,"+-l*da/Xa+" "+R/3+","+-R/4+" 0,"+l*da+" z","fill:"+p.lowColor+";stroke:"+p.borderColor+";stroke-width:"+map.Scale.normalX(.05)+
";fill-opacity:0.4"),p.highColor=ColorScheme.getDerivateColor(ib,.9));nb&&(map.Dom.newShape("rect",Ea,za,-nb*da/Xa,R,nb*da,"fill:#FFFFFF;stroke:none;stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.25"),nb>l?map.Dom.newShape("path",Ea,"M"+za+","+-nb*da/Xa+" l "+R+",0 "+R/3+","+-R/4+" "+-R+" 0 z","fill:#8888FF;stroke:#444488;stroke-width:"+map.Scale.normalX(.1)+";fill-opacity:0.2"):map.Dom.newShape("path",Ea,"M"+za+","+-nb*da/Xa+" l "+R+",0 "+R/3+","+-R/4+" "+-R+" 0 z","fill:#8888FF;stroke:"+
p.borderColor+";stroke-width:"+map.Scale.normalX(.1)+";fill-opacity:0.1;stroke-opacity:0.4"))}else if(b.match(/Border/))map.Dom.newShape("rect",Ea,za,-l*da/Xa,R,l*da,"fill:"+ib+";stroke:none;"),Ic=za+2,Jc=za+R-2,Yc=2-l*da/Xa,hd=Yc+l*da-2,p=O(ib),map.Dom.newShape("line",Ea,Ic,Yc,Ic,hd,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0"),map.Dom.newShape("line",Ea,Ic,Yc,Jc,Yc,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0"),map.Dom.newShape("line",Ea,
Ic,hd,Jc,hd,"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9"),map.Dom.newShape("line",Ea,Jc,Yc,Jc,hd,"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9");else if(b.match(/POINTER/)&&l){(b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)||b.match(/DEVIATION/))&&Math.abs(l*da)>1E3&&(da=(1E3+(Math.abs(l*da)-1E3)/10+Math.abs(l*da)%1E3)/Math.abs(l));var Mc="fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-opacity:0.5;stroke-width:"+
map.Scale.normalX(this.nLineWidth)*Math.sqrt(Fb||1);if(sb<=0)if(!this.fShadow&&this.fOrigShadow&&map.Dom.newShape("path",Ea,"M"+(za+R/7+10)+","+(-l*da/Xa+10)+" l "+-R/7+",0 0,"+-R/15+" "+R/2+","+-R/3+" "+R/2+","+R/3+" 0,"+R/15+" "+-R/7+",0 0,"+l*da+" "+-R*5/7+",0 z","fill:000000;fill-opacity:0.5;stroke:none;"),b.match(/SMALLARROW/)){var ud=map.Dom.newShape("path",Ea,"m "+(za+Fb*10)+",-230.68306 49.394,-49.394 v 263.787999 c 0,8.2839998 6.716001,14.9999998 15.000001,14.9999998 8.284001,0 15.000001,-6.716 15.000001,-14.9999998 V -280.07706 l 49.394,49.394 c 2.928,2.929 6.767,4.394 10.606,4.394 3.839,0 7.678,-1.465 10.606,-4.394 5.858,-5.857 5.858,-15.355 0,-21.213 l -75,-75 c -5.857001,-5.858 -15.355001,-5.858 -21.213001,0 l -75.0000008,75 c -5.85799995,5.857 -5.85799995,15.355 0,21.213 5.8579998,5.857 15.3559998,5.857 21.2129998,0 z",
Mc);ud.fu.setPosition(30+l*da/40,0);ud.fu.scale(l*da/250,l*da/220)}else b.match(/ARROW/)?map.Dom.newShape("path",Ea,"M"+(za+R/3)+","+-l*da*.9/Xa+" l "+-R/3+",0 0,"+-R/15+" "+R/2+","+-R/1.5+" "+R/2+","+R/1.5+" 0,"+R/15+" "+-R/3+",0 0,"+l*da*.9+" "+-R/3+",0 z",Mc):map.Dom.newShape("path",Ea,"M"+(za+R/7)+","+-l*da/Xa+" l "+-R/7+",0 0,"+-R/15+" "+R/2+","+-R/2+" "+R/2+","+R/2+" 0,"+R/15+" "+-R/7+",0 0,"+l*da+" "+-R*5/7+",0 z",Mc);else b.match(/NONEGATIVE/)||(b.match(/LEFT/)||(b.match(/ZOOM/)||b.match(/NORMSIZE/)?
Mc="fill:"+ib+";stroke:"+ib+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.5":this.partsA.length>2?(p=O(ib),Mc="fill:"+ib+";stroke:"+p.lowColor+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*Fb||.25)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:0.8"):(p=O(ib),Mc="fill:"+ib+";stroke:"+p.highColor+";stroke-width:"+map.Scale.normalX(this.nLineWidth)*Math.sqrt(Fb||1)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:1")),b.match(/SMALLARROW/)?(ud=map.Dom.newShape("path",
Ea,"m 155.27191,-100.6065 -49.394,49.393999 V -315.0005 c 0,-8.284 -6.716003,-15 -15.000003,-15 -8.284,0 -15,6.716 -15,15 v 263.787999 l -49.394,-49.393999 c -2.928,-2.929 -6.767,-4.394 -10.606,-4.394 -3.839,0 -7.6779996,1.465 -10.6059996,4.394 -5.85799995,5.856999 -5.85799995,15.354999 0,21.212999 L 80.271907,-4.3935012 c 5.857,5.858 15.355,5.858 21.213003,0 l 75,-74.9999998 c 5.858,-5.857 5.858,-15.355 0,-21.212999 -5.858,-5.857 -15.356,-5.857 -21.213,0 z",Mc),ud.fu.setPosition(20+l/30,l/3),ud.fu.scale(l*
da/250,l*da/220)):b.match(/ARROW/)?map.Dom.newShape("path",Ea,"M"+(za+R/3)+","+-l*da/Xa+" l "+R/3+",0 0,"+l*da+" "+R/3+",0 "+-R/2+","+R/2+" "+-R/2+","+-R/2+" "+R/3+",0 z",Mc):map.Dom.newShape("path",Ea,"M"+(za+R/7)+","+-l*da/Xa+" l "+R*5/7+",0 0,"+l*da+" "+R/7+",0 "+-R/2+","+R/4+" "+-R/2+","+-R/4+" "+R/7+",0 z",Mc))}else if(b.match(/DOTTED/))if(c<1E3){sb==0&&map.Dom.newShape("rect",Ea,za,0,R,2,"fill:none;stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*Fb||
.2)+";stroke-opacity:"+(this.nLineWidth?1:.1));var Qc=R*.8;da=Qc;tb=Math.min(5,Math.ceil(c/20));Qc/=tb;da=Qc/tb;for(var Pc=0;Pc<l;Pc++)map.Dom.newShape("circle",Ea,za+Qc/2+Pc%tb*Qc,-Qc*Math.floor(Pc/tb)-Qc/2,Qc/2.2,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*Fb||.2)+";stroke-opacity:"+(this.nLineWidth?1:.1));l=Math.ceil(l/tb)*tb+(l?.5:0)}else b.match(/NOZERO/)||(l=l||1E-5),sb<=0||b.match(/LEFT/)?map.Dom.newShape("rect",
Ea,za,-l*da/Xa,R,l*da,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*Fb||.2)+";stroke-opacity:"+(this.nLineWidth?1:.1)):map.Dom.newShape("rect",Ea,za,-l*da/Xa,R,l*da,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+ib+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.3"),(nb=this.nFilterA[ma])&&(sb<=0||b.match(/LEFT/)?map.Dom.newShape("rect",Ea,za,-nb*da/Xa,R,nb*da,"fill:none;stroke:black;stroke-width:"+
map.Scale.normalX(.5)+";stroke-opacity:0.1"):map.Dom.newShape("rect",Ea,za,-nb*da/Xa,R,nb*da,"fill:none;stroke:"+ib+";stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.3"));else b.match(/NOZERO/)||(l=l||1E-5),sb<=0||b.match(/LEFT/)?map.Dom.newShape("rect",Ea,za,-l*da/Xa,R,l*da,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*Fb||.2)+";stroke-opacity:"+(this.nLineWidth?1:.1)):map.Dom.newShape("rect",
Ea,za,-l*da/Xa,R,l*da,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+ib+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.3"),(nb=this.nFilterA[ma])&&(sb<=0||b.match(/LEFT/)?map.Dom.newShape("rect",Ea,za,-nb*da/Xa,R,nb*da,"fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.1"):map.Dom.newShape("rect",Ea,za,-nb*da/Xa,R,nb*da,"fill:none;stroke:"+ib+";stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.3"));if(!(!b.match(/VALUES/)&&!this.szXaxisA||sb>
0&&b.match(/NONEGATIVE/)||!b.match(/ZOOM/)&&this.fHideValues)){l||=0;if(b.match(/AXIS/)&&(this.szLabelA||this.szXaxisA)){Bc=ma/(this.nGridX||1);Bd=(this.szXaxisA?this.szXaxisA[Bc]:this.szLabelA?this.szLabelA[Bc]:" ")||" ";var Rd=R*.5;b.match(/\bUP\b/)&&(Rd=R*.6);b.match(/\bHORZ\b/)&&(Rd=R*.7);ea=map.Dom.newText(Ea,0,0,Zc+";fill:#888888;text-anchor:end;font-size:"+Rd+"px"," "+Bd+" ");var Ra=new point(map.Scale.normalX(.8),R/2+ya/5*2);this.fNegativeValues?ea.setAttributeNS(null,"transform","translate("+
(za+Ra.y)+","+(-Ra.x+ya*.9+10)+") rotate(270)"):b.match(/CENTER/)?ea.setAttributeNS(null,"transform","translate("+(za+Ra.y)+","+(map.Scale.normalX(g/2)+ya*.9)+") rotate(270)"):b.match(/HORZ/)?ea.setAttributeNS(null,"transform","translate("+(za+Ra.y)+","+(-Ra.x+ya*.9+5)+") rotate(270)"):(ea.style.setProperty("text-anchor","end",""),n.length==1?ea.setAttributeNS(null,"transform","translate("+(za+(b.match(/VOLUME/)?R*1.3:Ra.y*1.5))+","+-Ra.x+") "):Bd.length>1?ea.setAttributeNS(null,"transform","translate("+
(za+Ra.y*.66)+","+(ya*.66+10)+") rotate(315)"):ea.setAttributeNS(null,"transform","translate("+(za+Ra.y*.1)+","+(-Ra.x+ya)+")"))}if(b.match(/VALUES/)&&ya>0&&!(this.nGridX&&this.partsA.length/this.nGridX>2)){va=this.formatValue(cc,this.nValueDecimals||(this.nMax<=1?1:0));b.match(/POINTER/)&&cc>0&&(this.nMin<0||b.match(/OFFSETMEAN/)||b.match(/OFFSETMEDIAN/)||this.szFlag.match(/\bSIGN\b/))&&(va="+"+va);b.match(/VOLUME/)||(va+=this.szUnit?" "+this.szUnit+" ":"");!b.match(/STACKED/)||cc===0||v||this.nGridX||
(va=va+" ("+Math.round(cc/e*100)+"%)");b.match(/STACKED/)&&(ya=b.match(/ZOOM/)?map.Scale.normalX(18):map.Scale.normalX(5),ya*=this.nValueScale||1);var Gd=va.length*ya*4/8;ea=this.createTextLabel(map.SVGDocument,Ea,"",va,ya/map.Scale.normalX(1),null,cc>0&&(b.match(/CTEXT/)||b.match(/VALUEBACKGROUND/))?ib:null,parseFloat(va)<0?this.szValueColor||"red":this.szTextColor);ea.style.setProperty("opacity",String($b),"");var Sd=Eb=null;this.szXaxisA&&b.match(/CATEGORICAL/)&&!b.match(/AXIS/)&&(Sd=map.Dom.newTSpan(ea,
"fill:fill:#444444;font-size:"+ya+"px"," "+this.szXaxisA[f]));var id=ea.fu.getBox().width;Ra=new point(map.Scale.normalX(-4),R/2+ya*.15);var fe=!0;if(b.match(/DOINLINETEXT/)&&!b.match(/ZOOM/)&&!b.match(/NORMSIZE/)||!b.match(/VALUE/)||b.match(/VOLUME/)&&!b.match(/ZOOM/)||!(b.match(/THIN/)||b.match(/NOINLINETEXT/)||b.match(/DTEXT/)||b.match(/SIZE/)||id+map.Scale.normalX(1)>l*da/Xa||b.match(/STACKED/)||b.match(/NORMSIZE/)||b.match(/ZOOM/))){p=O(ib);ea.removeChild(ea.firstChild);ea.firstChild.style.setProperty("fill",
p.textColor,"");Sd&&Sd.style.setProperty("fill",p.textColor,"");Eb&&Eb.parentNode.removeChild(Eb);var qe=map.Scale.normalX(0),jd=map.Scale.normalY(.5);b.match(/VOLUME/)?(oa=l*da/(id+map.Scale.normalX(2)),ea.parentNode.removeChild(ea),ea=map.Dom.newText(Ea,za+l*da/2,ya*oa/4-l*da/2,"font-family:arial;font-size:"+ya*oa+"px;text-anchor:middle;fill:"+p.textColor+";opacity:"+vb+";stroke:none;pointer-events:none",va)):(oa=Math.min(1,l*da/id),oa<.33?ea.parentNode.removeChild(ea):(cc>0&&(Ra.x+=Math.max(map.Scale.normalX(1),
l*da-(id+map.Scale.normalX(3))*oa)),jd/=oa,ea.firstChild.style.setProperty("font-size",String(ya*oa)),ea.firstChild.setAttributeNS(null,"transform","translate("+(za+Ra.y-jd)+","+(-Ra.x-qe)+") rotate(270)\t")));$c.x=Math.max(0,$c.x-l*da)}else if(fe=!1,b.match(/STACKED/))if(l!==0||b.match(/ZEROISVALUE/))if(this.nGridX&&n.length/this.nGridX>2)ea.parentNode.removeChild(ea);else{Ra.x=0;b.match(/3D/)&&(Ra.x+=R/4,Ra.y+=R/3);var Hd=l*da/(b.match(/SUM/),2);$c.x=Math.max(0,$c.x+(ya*.75-Hd));var Id=new point($c.x+
Ra.x+Hd-ya/3,0),Nc=map.Scale.normalX(.5)*Fb,Rc=za+Ra.y+R/3,Sc=za+Ra.y+R*7/8,ad=-Ra.x-Hd,bd=-Id.x-ya/3;if(this.nGridX&&Fd<this.nGridX){Ra.y-=R*2+ea.fu.getBox().width;var re=Sc;Sc=Rc-(b.match(/3D/)?R*1.5:R*1.4);Rc=re-(b.match(/3D/)?R*7/4:R*1.4);b.match(/3D/)&&(ad+=R/5,bd+=R/5,Id.x-=R/7);Nc=-Nc}ea.setAttributeNS(null,"transform","translate("+(za+Ra.y+R+Nc-ya)+","+(-Id.x-ya*.25)+") ");var Td=map.Dom.newGroup(Ea,""),Ud=map.Dom.newGroup(Ea,"");map.Dom.newShape("line",Td,Rc,ad,Rc+Nc,ad,"stroke-width:"+map.Scale.normalX(.15)+
";stroke:white;opacity:0.2;");map.Dom.newShape("line",Ud,Rc,ad,Rc+Nc,ad,"stroke-width:"+map.Scale.normalX(.05)+";stroke:#888888;");map.Dom.newShape("line",Td,Rc+Nc,ad,Sc,bd,"stroke-width:"+map.Scale.normalX(.15)+";stroke:white;opacity:0.2;stroke-linecap:round;");map.Dom.newShape("line",Ud,Rc+Nc,ad,Sc,bd,"stroke-width:"+map.Scale.normalX(.05)+";stroke:#888888;");map.Dom.newShape("line",Td,Sc,bd,Sc+Nc,bd,"stroke-width:"+map.Scale.normalX(.15)+";stroke:white;opacity:0.2;");map.Dom.newShape("line",Ud,
Sc,bd,Sc+Nc,bd,"stroke-width:"+map.Scale.normalX(.05)+";stroke:#888888;");$c.x=Math.max(0,$c.x+(ya*2/3-(l*da-Hd)))}else ea.parentNode.removeChild(ea);else{Ra.x+=R/4;b.match(/3D/)&&(Ra.x+=R/4,Ra.y=R*.3+ya/2);b.match(/POINTER/)&&cc>0&&(Ra.x+=R*.25);var kd=l;id+map.Scale.normalX(1)>(nb-l)*da/Xa&&(kd=Math.max(l,nb),nb>l&&(kd+=R/da*.2,map.Dom.newShape("line",Ea,za+R*.6,-Ra.x-l*da/Xa+R/3,za+R*.6,-Ra.x-nb*da/Xa-R*.4,"stroke:white;")));b.match(/VOLUME/)&&(kd+=R/5);if(n.length!=1||b.match(/HORZ/)||b.match(/VOLUME/))b.match(/VOLUME/)?
ea.setAttributeNS(null,"transform","translate("+(za+Ra.y)+","+(-Ra.x-kd*da/Xa)+")  scale(0.9,0.9)"):ea.setAttributeNS(null,"transform","translate("+(za+Ra.y)+","+(-10-R*.25-kd*da/Xa)+") rotate(270) scale(0.9,0.9)");else{if(b.match(/ZOOM/)||b.match(/NORMSIZE/)){Ra.y+=b.match(/3D/)?R*.75:R*.5;var se=Math.min(0,ya*.55-l*da),ge=ya;!b.match(/3D/)&&!b.match(/ZOOM/)||b.match(/SIZE/)||(ge=0);ea.setAttributeNS(null,"transform","translate("+(za+ge)+","+(se-ya*.5)+")")}else Ra.y+=b.match(/3D/)?b.match(/VOLUME/)?
R*.75:R*.6:R*.2,ea.setAttributeNS(null,"transform","translate("+(za-R*.8)+","+(-kd*da/Xa-ya*.8-(b.match(/POINTER/)&&cc>0?R*.5:0))+")");cc<0&&ea.style.setProperty("opacity",String($b*.75),"")}ea.style.setProperty("fill","#404040","")}}}r!=null&&f==r&&(h=ya*2,p=O(ib),map.Dom.newShape("path",Ea,"M5,0 l 35,-45 -25,0 0,-30 -20,0 0,30 -25,0 35,45","fill:#404040;stroke:white;stroke-width:"+map.Scale.normalX(.2)).fu.setPosition(f*(R+1.5)+R*.5,-l*da+(fe?-map.Scale.normalX(3):-id-map.Scale.normalX(12))));if(b.match(/TRENDLINE/)){jd=
Math.min(l*da/2,map.Scale.normalY(1.5));p=O(ib);J=p.lowColor;h=ya/5;f>0&&(Ic=(f-1)*(R+(b.match(/SPACED/)?R/5:1))+R/2,Jc=f*(R+(b.match(/SPACED/)?R/5:1))+R/2,J="white",J=Ed>l?"#CC3333":Ed<l?"#22BB22":p.lowColor,map.Dom.newShape("line",Ea,Ic,-Ed*da+jd,Jc,-l*da+jd,"stroke:#666666;stroke-width:"+map.Scale.normalX(1/n.length*1.2)+";opacity:0.8"));var he=map.Dom.newShape("circle",Ea,0,0,h,"fill:"+J+";stroke:none;opacity:0.8");he&&he.fu.setPosition(f*(R+(b.match(/SPACED/)?R/5:0))+R/2,-l*da+jd)}b.match(/SILENT/)||
(this.szFlag.match(/SEQUENCE/)?Ea.setAttributeNS(szMapNs,"tooltip",Nb+" ("+(this.szLabelA?this.szLabelA[ta]:"")+") ["+this.szFieldsA[ma]+"]"):(T=this.szFieldsA[ma],this.szLabelA&&this.szLabelA[ma]&&(T=this.szLabelA[ma]),Nb+=this.szUnit?" ["+this.szUnit+"]":"",!e||this.nGridX||this.szField100&&this.szFlag.match(/FRACTION/),Ea.setAttributeNS(szMapNs,"tooltip",Nb+" '"+T+"'")));b.match(/FADEIN/)&&(n.length==2&&f===0?Ea.style.setProperty("opacity","0.6",""):b.match(/NORMSIZE/)||(z=b.match(/FADEINP4/)?
10:3,Ea.style.setProperty("opacity",String(.1+.9*Math.pow(f+1,z)/Math.pow(n.length,z)),"")));b.match(/FADENEGATIVE/)&&cc<0&&Ea.style.setProperty("opacity","0.5","");Ea.setAttributeNS(szMapNs,"class",String(ta));Ea.fu.setPosition(0,sb);b.match(/STACKED/)?b.match(/CENTER/)||(sb-=l*da):(sb=0,za+=R,b.match(/VOLUME/)&&b.match(/SPACED/)?za+=R/(n.length==2?2:4):b.match(/SPACED/)?za+=R/5:b.match(/\bUP\b/)||(za+=1));Fd++;b.match(/STACKED/)&&!b.match(/MULTI/)&&this.nGridX&&Fd%this.nGridX===0&&(sb=0,za+=R+R/
20);Ed=l}}b.match(/HOR/)&&sd.setAttributeNS(null,"transform","rotate(90) translate("+-za+",0)");b.match(/DIAGLEFT/)&&sd.setAttributeNS(null,"transform","rotate(315) translate("+-za+",0)");b.match(/DIAGRIGHT/)&&sd.setAttributeNS(null,"transform","rotate(45) translate("+-za+",0)");B.y=0;B.x=0;b.match(/HOR/)?(B.y-=R*1/2,b.match(/3D/)&&(B.y-=R*1/3)):b.match(/STACKED/)?B.x=R/2:b.match(/Up/)||b.match(/HOR/)?B.x=0:B.x=R*Fd/2;b.match(/MENUSIZE/)&&(B.x+=R*(b.match(/HORZ/)?1:0),B.y+=R*(b.match(/HORZ/)?.3:0),
B.y+=R*(b.match(/HORZ/)&&b.match(/3D/)?1:b.match(/VOLUME/)?.3:.6));this.nRealizedCount++;var Vd=map.Dom.newGroup(C,"");Vd.appendChild(sd);b.match(/ZOOM/)&&(oa=240/ya/(n.length>1?2:1),Vd.fu.scale(oa,oa));Vd.fu.setPosition(C.fu.getPosition().x-B.x,-B.y);B.x=0;B.y=0;b.match(/HOR/)&&(B.y=R*1/2)}if(b.match(/EXTEND/)&&map.HTMLWindow.ixmaps.htmlgui_drawChartAfter)try{Da=this.objThemesA[this.szThemesA[0]],map.HTMLWindow.ixmaps.htmlgui_drawChartAfter(map.SVGDocument,{target:C,theme:this,item:a,values:n,maxSize:g,
flag:b,mark:r,dbRecord:Da.dbRecords?Da.dbRecords[this.itemA[a].dbIndex]:null})}catch(zd){}if(!b.match(/NORMSIZE/)){var lc=new point(B.x,B.y);b.match(/PLOT/)?(B.x=map.Scale.normalX(this.nOffsetX||0),B.y=map.Scale.normalY(-this.nOffsetY||0)):(B.x=map.Scale.normalX(this.nOffsetX||0)*(this.nSymbolScale||1),B.y=map.Scale.normalY(-this.nOffsetY||0)*(this.nSymbolScale||1));this.szAlign&&(b.match(/PLOT/)&&!b.match(/ZOOM/)?(this.szAlign.match(/center/)&&(B.x=map.Scale.normalX(g/2*n.length/(this.nGridX||1)),
this.szAlign.match(/top/)||(B.y=-map.Scale.normalX(g/2*n.length/(this.nGridX||1)))),this.szAlign.match(/right/)&&(B.x=map.Scale.normalX(g*n.length/(this.nGridX||1))),this.szAlign.match(/23right/)&&(B.x=map.Scale.normalX(g*.66*n.length/(this.nGridX||1))),this.szAlign.match(/10%right/)&&(B.x=map.Scale.normalX(g*.9*n.length/(this.nGridX||1))),this.szAlign.match(/10%left/)&&(B.x=map.Scale.normalX(g*.1*n.length/(this.nGridX||1))),this.szAlign.match(/23left/)&&(B.x=map.Scale.normalX(g*.33*n.length/(this.nGridX||
1)))):this.nGridX&&!b.match(/ZOOM/)?(this.szAlign.match(/center/)&&(B.x=map.Scale.normalX(g/2/this.partsA.length*n.length/(this.nGridX||1))),this.szAlign.match(/right/)&&(B.x=map.Scale.normalX(g/this.partsA.length*n.length/(this.nGridX||1))),this.szAlign.match(/23right/)&&(B.x=map.Scale.normalX(g/this.partsA.length*.66*n.length/(this.nGridX||1)))):(this.szAlign.match(/center/)&&(B.y=0),this.szAlign.match(/bottom/)&&(B.y=lc.y?lc.y:map.Scale.normalX(g/5)),this.szAlign.match(/above/)&&(B.y=lc.y?lc.y:
map.Scale.normalX(g/2)),this.szAlign.match(/2above/)&&(B.y+=map.Scale.normalX(g/2)),this.szAlign.match(/below/)&&(B.y=-(lc.y?lc.y:map.Scale.normalX(g/2))),this.szAlign.match(/2below/)&&(B.y-=map.Scale.normalX(g/2)),this.szAlign.match(/top/)&&(B.y=-(lc.y?lc.y:map.Scale.normalX(g/2))),this.szAlign.match(/left/)&&(B.x=-(lc.y?lc.y:map.Scale.normalX(g/2))),this.szAlign.match(/2left/)&&(B.x-=map.Scale.normalX(g/2)),this.szAlign.match(/right/)&&(B.x=lc.y?lc.y:map.Scale.normalX(g/2)),this.szAlign.match(/2right/)&&
(B.x+=map.Scale.normalX(g/2)),this.szAlign.match(/23right/)&&(B.x=map.Scale.normalX(g/3)),this.szAlign.match(/baseline/)&&(B.y+=map.Scale.normalY(g/5))))}if(a&&this.szLabelField&&!b.match(/NORMSIZE/)&&!b.match(/ZOOM/)&&(!this.nLabelUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nLabelUpper)&&(!this.nLabelLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nLabelLower)){T=(T=this.itemA[a].szLabel)?isNaN(ba(T))?T+(this.szLabelUnits||""):this.formatValue(ba(T),this.nValueDecimals||2)+
(this.szLabelUnits||""):this.itemA[a].szTitle?this.itemA[a].szTitle:this.szLabelField+"?";ya=map.Scale.normalX(5)*(this.nTextScale||1);Zc="opacity:0.7;font-family:arial;font-size:"+ya+"px;text-anchor:middle;fill:#000000;pointer-events:none";var te="opacity:1;fill:white;fill-opacity:0.4;stroke:#000000;stroke-width:"+map.Scale.normalX(1)+"pointer-events:none;";Gd=(T.length+2)*ya*.5;var uc=map.Dom.newGroup(C,"");uc.parentNode.append(uc);b.match(/MULTI/)?Zc+=";fill:#444444;text-anchor:start;":uc.setAttributeNS(szMapNs,
"class",String(ta));var ld=map.Dom.newShape("rect",uc,-Gd/2,-ya*.95,Gd,ya*1.2,te);ld.setAttributeNS(null,"rx",ya*.2);ld.setAttributeNS(null,"ry",ya*.2);ea=map.Dom.newText(uc,0,0,Zc,T);de=ea.fu.getBox();R=Math.max(de.width,Gd);ld.setAttributeNS(null,"x",-R/2);ld.setAttributeNS(null,"width",R);b.match(/MULTI/)?(uc.fu.setPosition(map.Scale.normalX(g*.8),ya*.77),uc.fu.scale(2,2),ld.parentNode.removeChild(ld)):uc.fu.setPosition(R/3,ya/3+lc.y);this.itemA[a].labelGroup=uc;this.szTimeField&&(Va=(new Date(this.itemA[a].szTime)).getTime()||
this.itemA[a].szTime,uc.setAttributeNS(szMapNs,"time",Va));map.fCheckLabelOverlap&&new ixMap.Label.Item(uc)}if(b.match(/MENU/)){var Jd=C.fu.getBox();C.fu.setPosition(-Jd.x-Jd.width/2,-Jd.y-Jd.height/2-map.Scale.normalY(g/2)-map.Scale.normalY(2))}else b.match(/ZOOM/)||(C.fu.setPosition(C.fu.getPosition().x-B.x,C.fu.getPosition().y-B.y),cb&&cb.fu.setPosition(cb.fu.getPosition().x-B.x,cb.fu.getPosition().y-B.y));this.nRotation&&C.fu.rotateBy(this.nRotation);B.x=0;B.y=0;a&&(this.itemA[a].fDone=!0);return B};
A.prototype.getShapes=function(){var d=map.Layer.getLayerObj(this.szThemesA[0]);if(!d||!d.szFlag.match(/tiled/))for(var a in this.itemA)this.parent.themeNodesA[a]||(this.parent.themeNodesA[a]=this.getShapeA(a))};A.prototype.getItemNodes=function(d){this.parent.themeNodesA[d]&&this.parent.themeNodesA[d].length||(this.parent.themeNodesA[d]=this.getShapeA(d));return this.parent.themeNodesA[d]||[]};A.prototype.getShapeA=function(d){d=Z(d);var a=map.SVGDocument.getElementById(d.trim());if(a)return Array(a);
if(d.match(/,/))for(var g=d.split("::"),b=g[0].split(","),r=0;r<b.length;r++)if(a=map.SVGDocument.getElementById((b[r]+"::"+g[1]).trim()))return Array(a);this.nMissingLookupCount++;this.missedA[d]=d;return[]};A.prototype.getPositions=function(){for(var d in this.itemA)this.getNodePosition(this.itemA[d].szSelectionId)};A.prototype.getNodePosition=function(d){if(typeof d=="undefined")return null;if(map.Themes.themeNodesPosA[d])return map.Themes.themeNodesPosA[d];var a=this.themeNodesPosA;if(!a[d]){if(d.match(/:clone/))return null;
if(d.match(/(-?[0-9\.]+) ?, ?(-?[0-9\.]+)/)){var g=this.getMapPosition(d);if(!g)return null;a[d]=new point(g.x,g.y);return a[d]}this.parent.themeNodesA[d]||(this.parent.themeNodesA[d]=this.getShapeA(d));g=this.parent.themeNodesA[d][0];if(this.parent.themeNodesA[d].length>1)for(var b=parseFloat(g.getAttributeNS(szMapNs,"area")),r=1;r<this.parent.themeNodesA[d].length;r++){var n=this.parent.themeNodesA[d][r],v=parseFloat(n.getAttributeNS(szMapNs,"area"));v>b&&(b=v,g=n)}g&&(this.szShapeType.match(/line/)?
((b=g.getAttributeNS(szMapNs,"center"))&&b.length>2?(b=b.split(","),new box(Number(b[0].split(":")[1]),Number(b[1].split(":")[1]),0,0)):map.Dom.getBox(g),b=map.Dom.getBox(g)):(b=g.getAttributeNS(szMapNs,"center"),!b&&g.parentNode&&(b=g.parentNode.getAttributeNS(szMapNs,"center")),b&&b.length>2?(b=b.split(","),b=new box(Number(b[0].split(":")[1]),Number(b[1].split(":")[1]),0,0)):b=map.Dom.getBox(g)),r=map.Scale.getMapOffset(g),a[d]=new point(r.x+b.x+b.width/2,r.y+b.y+b.height/2),g=getMatrix(g))&&(a[d].x+=
g[4],a[d].y+=g[5])}if(a[d]&&typeof a[d].x!="undefined"&&typeof a[d].y!="undefined")return a[d];this.missedA[d]=d;return null};A.prototype.getNodeBox=function(d){if(typeof d=="undefined")return null;if(!this.parent.themeNodesBoxA[d]){if(d.match(/:clone/))return null;this.parent.themeNodesA[d]||(this.parent.themeNodesA[d]=this.getShapeA(d));var a=this.parent.themeNodesA[d][0];if(this.parent.themeNodesA[d].length>1)for(var g=parseFloat(a.getAttributeNS(szMapNs,"area")),b=1;b<this.parent.themeNodesA[d].length;b++){var r=
this.parent.themeNodesA[d][b],n=parseFloat(r.getAttributeNS(szMapNs,"area"));n>g&&(g=n,a=r)}a&&(g=map.Dom.getBox(a),a=map.Scale.getMapOffset(a),this.parent.themeNodesBoxA[d]=new box(a.x+g.x,a.y+g.y,g.width,g.height))}return this.parent.themeNodesBoxA[d]};A.prototype.getNodeArea=function(d){return(d=this.getItemNodes(d)[0])?Number(d.getAttributeNS(szMapNs,"area"))/1E6:0};var Ja=/(-?[0-9\.]+) ?[, ] ?(-?[0-9\.]+)/;A.prototype.getMapPosition=function(d){if(d){var a=null;if(d&&(a=d.match(Ja)))return Math.abs(parseFloat(a[1]))>
180||Math.abs(parseFloat(a[2]))>180?new point(0,0):map.Scale.getMapPositionOfLatLon(parseFloat(a[1]),parseFloat(a[2]))}return new point(0,0)};A.prototype.onClick=function(d){this.fRemove||(this.widgetNode&&this.enable(),this.fToFront=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ..."),map.Themes.onclickInfo(d,this.szId))};A.prototype.showErrorInfo=function(){if(this.nMissingPositionCount!==0){var d=this.szId+":errordisplay:widget",a=map.Dictionary.getLocalText("Chart statistic");
a=new InfoContainer(map.SVGDocument,this.widgetNode,d+":movable",new point(map.Scale.normalX(0),map.Scale.normalX(0)),new point(-map.Scale.normalX(15),map.Scale.normalX(80)),"fixed",a);var g=a.workspaceNode,b=[map.Dictionary.getLocalText("total items"),map.Dictionary.getLocalText("charts drawn"),map.Dictionary.getLocalText("missing positions"),map.Dictionary.getLocalText("missing value match"),map.Dictionary.getLocalText("zero values"),String(this.nCount),String(this.nRealizedCount),String(this.nMissingPositionCount),
String(this.nMissingRangeCount),String(this.nZeroValueCount)];g=map.Dom.newGroup(g,"");g.fu.setPosition(0,map.Scale.normalY(3));createTextGrid(map.SVGDocument,g,d+":textgrid",b,2);a.reformat()}};A.prototype.getDataGrid=function(d,a){if(this.szFlag.match(/AGGREGATE/)&&this.itemA[d].nCount>3)return null;if((d=map.Themes.getDataRow(d,this))&&d.length){for(var g=0;g<d.length;g++)d[g]=d[g]||"---";a=new ScrollArea(null,a,null,10,10,10);a.reformat();g=a.workspaceNode;for(var b=[],r=map.Themes.getFieldIndexArray(this),
n=0;n<r.length;n++)b[r[n]]="font-weight:bold;fill:#087BBB",b[r[n+d.length/2]]="font-weight:bold;fill:#087BBB";r=map.Scale.tStyle.Description.nFontHeight/map.Scale.normalX(1);d=createTextGrid(map.SVGDocument,g,":textgrid",d,2,r,b);return a?(a.setWidth(Math.min(d.fu.getBox().width/map.Scale.normalX(1)+25,map.Scale.bBox.width/map.Scale.normalY(2.2))),a.setHeight(Math.min(d.fu.getBox().height/map.Scale.normalY(1)+25,map.Scale.bBox.height/map.Scale.normalY(1.5))),a.reformat(),a.hasScrollBars()&&a.setScrollPosition(new point(0,
0)),a):d.fu}};A.prototype.drawTextforOneQuadrant=function(d,a,g,b,r,n,v,c){var e=d.szStyle.match(/3D/)?g*2.4:g*1.2,f=e/2;c-=e*(a.length-2);for(var m=0;m<a.length;m++){var l=a[m].y/a[m].ly,h=Math.max(f,Math.min(a[m].y,c));f=h+e;c+=g;var p=v+map.Scale.normalX(2);h>a[m].y&&(l=Math.max(l,h/a[m].y));var B=d.mX+a[m].lx*r,C=d.mY+a[m].ly*n,N=d.mX+a[m].x*r,Y=d.mY+a[m].y*n;p=d.mX+p*r;h=d.mY+h*n;var M=map.Dom.newGroup(d.frameGroup,"");d.donutPartsA[a[m].index].textNode=M;var w=map.Dom.newGroup(M,""),J=map.Dom.newGroup(M,
"");l&&(map.Dom.newShape("line",w,B,C,N,Y,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;"),map.Dom.newShape("line",J,B,C,N,Y,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;"),B=N,C=Y);a[m].x<v-map.Scale.normalX(3)&&(map.Dom.newShape("line",w,B,C,d.mX+(v-map.Scale.normalX(3))*r,C,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;"),map.Dom.newShape("line",J,B,C,d.mX+(v-map.Scale.normalX(3))*r,C,"stroke:#888888;stroke-width:"+
map.Scale.normalX(.5)+";opacity:1;"),B=d.mX+(v-map.Scale.normalX(3))*r);map.Dom.newShape("line",w,B,C,p,h,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;");map.Dom.newShape("line",J,B,C,p,h,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;");B=p;p+=map.Scale.normalX(2)*r;map.Dom.newShape("line",w,B,h,p,h,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;");map.Dom.newShape("line",J,B,h,p,h,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+
";opacity:1;");p+=map.Scale.normalX(1.5)*r;(l=d.partsA[a[m].index]&&d.partsA[a[m].index].szText?d.partsA[a[m].index].szText:null)||(l=d.partsA[a[m].index].szInfo?d.partsA[a[m].index].szInfo:Math.round(d.partsA[a[m].index].nInfoValue*10)/10+" % ");l=this.createTextLabel(map.SVGDocument,M,"",l,g/map.Scale.normalX(1),b,this.szFlag.match(/VALUEBACKGROUND/)?d.partsA[a[m].index].color:"white",this.szChartFlag.match(/ZOOM/)?null:this.szTextColor);l.fu.setPosition(p-g,h-g*0);l.setAttributeNS(szMapNs,"tooltip",
d.partsA[a[m].index].szInfo);d.szStyle.match(/3D/)&&l.fu.scale(1,2)}};A.prototype.drawDonutText=function(d,a){for(var g=0,b=0,r=0,n=[],v=[],c=[],e=[],f=Math.min(50,this.partsA.length),m=0;m<f;m++){var l=d.getTextPosition(m);if(l){if(this.szShowPartsA){var h=!1,p;for(p in this.szShowPartsA)this.szShowPartsA[p]==m&&(h=!0);if(!h)continue}g=Math.max(g,Math.abs(l.y));b=Math.max(b,l.x);r=Math.min(r,l.x);d.szStyle.match(/STARBURST/)?(b=Math.max(b,l.x),r=Math.min(r,l.x)):(b=d.nRadOuter,r=-d.nRadOuter);l.x>
0?l.y>0?v[v.length]={index:m,x:l.x,y:l.y,lx:l.lx,ly:l.ly}:n[n.length]={index:m,x:l.x,y:-l.y,lx:l.lx,ly:-l.ly}:l.y>0?c[c.length]={index:m,x:-l.x,y:l.y,lx:-l.lx,ly:l.ly}:e[e.length]={index:m,x:-l.x,y:-l.y,lx:-l.lx,ly:-l.ly}}}n.sort(I);v.sort(I);c.sort(I);e.sort(I);a||=map.Scale.normalX(12);this.drawTextforOneQuadrant(d,n,a,"text-anchor:start;",1,-1,b,g);this.drawTextforOneQuadrant(d,v,a,"text-anchor:start;",1,1,b,g);this.drawTextforOneQuadrant(d,c,a,"text-anchor:end;",-1,1,-r,g);this.drawTextforOneQuadrant(d,
e,a,"text-anchor:end;",-1,-1,-r,g)};A.prototype.createTextLabel=function(d,a,g,b,r,n,v,c,e){var f=!0,m=!0,l=1,h=" "+this.szChartFlag+"|"+this.szFlag;if(h.match(/ZOOM/)||h.match(/MENUSIZE/)||h.match(/NORMSIZE/)||h.match(/INFOSIZE/)||h.match(/AXIS/)||h.match(/SELECTION/))f=v?f:!1,m=!1;h.match(/VALUEBACKGROUND/)&&(f=!0);h.match(/HORZ/)&&(f=!1);isNaN(r)&&(r=14);n||="";v&&f?(c=c||ColorScheme.getTextColor(v),l=h.match(/ZOOM/)?.9:.5):v="#fefeff";if(d&&a)return d=map.Dom.newGroup(a,g),a=null,m&&!this.fShadow&&
this.fOrigShadow&&(a=map.Dom.newShape("rect",d,1,1,1,1,"fill:#444444;fill-opacity:0.4;stroke:none;")),v=map.Dom.newShape("rect",d,1,1,1,1,"fill:"+v+";fill-opacity:"+l+";stroke:none;stroke-width:"+map.Scale.normalX(r*.05)),n=map.Scale.tStyle.Values.szStyle+(this.szTextFont?"font-family:"+this.szTextFont:"")+";font-size:"+map.Scale.normalY(r)+"px;fill:"+c+";fill-opacity:1;"+n,e&&e.match(/\bGLOW\b/)&&map.Dom.newText(d,map.Scale.normalX(r),map.Scale.normalY(r*.25),n+";font-size:"+map.Scale.normalY(r)+
"px;font-weight:normal;fill:none;stroke:white;stroke-width:"+map.Scale.normalY(r)/5+";stroke-opacity:0.8;pointer-events:none;stroke-linejoin:bevel;",b),map.Dom.newText(d,map.Scale.normalX(r),map.Scale.normalY(r*.25),n,b),b=map.Dom.newText(map.SVGHiddenGroup,map.Scale.normalX(r),map.Scale.normalY(r*.25),n,b),e=b.fu.getBox(),map.SVGHiddenGroup.removeChild(b),v.setAttributeNS(null,"rx",map.Scale.normalX(r*.1)),v.setAttributeNS(null,"ry",map.Scale.normalX(r*.1)),v.setAttributeNS(null,"x",e.x-map.Scale.normalX(r*
.3)),v.setAttributeNS(null,"y",e.y-map.Scale.normalY(r*0)),v.setAttributeNS(null,"width",e.width+map.Scale.normalX(r*.7)),v.setAttributeNS(null,"height",e.height+map.Scale.normalY(r)*.1),a&&(a.setAttributeNS(null,"rx",map.Scale.normalX(r*.1)),a.setAttributeNS(null,"ry",map.Scale.normalX(r*.1)),a.setAttributeNS(null,"x",e.x-map.Scale.normalX(r*.3)+map.Scale.normalX(r*.12)),a.setAttributeNS(null,"y",e.y+map.Scale.normalY(r*0)+map.Scale.normalY(r*.12)),a.setAttributeNS(null,"width",e.width+map.Scale.normalX(r*
.7)),a.setAttributeNS(null,"height",e.height+map.Scale.normalY(r)*.1)),f||(v.style.setProperty("display","none",""),a&&a.style.setProperty("display","none","")),d};A.prototype.getOverviewChart=function(d,a){d.fu=new Methods(d);var g=30;this.szChartFlag+="|MENUSIZE";if(this.szOverviewChart&&this.szOverviewChart!="NONE"&&this.nCount){g=map.Scale.normalX(100);a=map.Scale.normalY(100);var b=map.Scale.normalX(75),r=map.Scale.normalX(50);if(typeof DonutCharts!="undefined"){var n=map.Dom.newGroup(d);g=DonutCharts.newChart(map.SVGDocument,
n,g,a,b,r);this.szOverviewChart.match(/PIE/)&&(g.setStyle("flat"),g.setRadInner(0),g.setRadOuter(map.Scale.normalX(55)),g.setCenter(map.Scale.normalX(80),map.Scale.normalY(55)));if(this.szOverviewChart.match(/DONUT/)||this.szOverviewChart.match(/3D/))g.setStyle("3D"),g.setCenter(map.Scale.normalX(80),map.Scale.normalY(100));g.setLine("white");g.setLineWidth(map.Scale.normalX(.1));a=map.Scale.normalY(20);for(b=0;b<this.partsA.length;b++){r=this.partsA[b].nCount/this.nCount*100;n=100/this.nSum*this.partsA[b].nSum;
this.nRealizedCount&&this.szFlag.match(/CHART/)&&(r=this.partsA[b].nCount/this.nRealizedCount*100);this.nExactCount&&this.exactSizeA&&(r=this.partsA[b].nCount/this.nExactCount*100,n=this.exactSizeA[b]);this.szOverviewChart.match(/DONUT/)&&(a=map.Scale.normalY(this.partsA[b].nSum/this.nSum*80));var v=String(this.partsA[b].nCount),c=r?String(" = "+this.formatValue(r,1)+" %"):"",e=n?String(", "+this.szLabelA[b]+" => "+this.formatValue(n,1)+this.szUnit):"";this.szOverviewChart.match(/PERCENTOFVALUE/)?
(r=n,c="",v=this.nExactCount&&this.exactSizeA?String(this.formatValue(r,0)):String(this.formatValue(r,1)+(this.szFlag.match(/CHART/)?this.szUnit:" %"))):this.szOverviewChart.match(/DONUT/)||(e="");this.szFlag.match(/CATEGORICAL/)?(c+=" ("+this.szLabelA[b]+")",e=""):this.szLegendLabelA&&this.szLegendLabelA.length&&(c+=" ["+this.szLegendLabelA[b]+"])");g.addPart(r,a,this.partsA[b].color,0,v,String(this.partsA[b].nCount)+" member(s)"+c+e,"map.Themes.markClass(evt,'"+this.szId+"','"+b+"')","map.Themes.unmarkClass(evt,'"+
this.szId+"')")}g.realize();this.drawDonutText(g);g=map.Dom.getBox(d);if(g.width>0&&g.height>0){d.fu.getPosition();v=this.szOverviewChart.match(/PERCENTOFVALUE/)?"*  value / class":"*  members / class";a=map.Scale.normalY(10);if(this.szOverviewChart.match(/DONUT/)||this.szOverviewChart.match(/3D/))a=map.Scale.normalY(15);map.Dom.newText(d,map.Scale.normalX(80),g.y+g.height+a,map.Scale.tStyle.Note.szStyle+";text-anchor:middle;",v)}}}else{if((this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||
this.szFlag.match(/SYMBOL/))&&(!this.szFlag.match(/CATEGORICAL/)||!this.szFlag.match(/SYMBOL/))){r=this.nMinA[0];c=this.nMaxA[0];this.szSizeField&&(r=this.nMinSize,c=this.nMaxSize);b=map.Scale.normalX(g/2);n=b/Math.sqrt(c)*Math.sqrt(r);if(this.szFlag.match(/LINEAR/)||this.szFlag.match(/SIZEP1/))n=b/c*r;v=this.szFlag.match(/SUM/)?"sum":"mean";e=map.Dom.newGroup(d);if(!this.szFlag.match(/CATEGORICAL/)){var f=map.Dom.newGroup(e);this.drawChart(f,null,g*1.5,"VALUES|ZOOM|NORMSIZE");if(this.szFlag.match(/SEQUENCE/)){var m=
map.Dom.getBox(f);var l=f.fu.getPosition();f.fu.setPosition(m.width/1.5+l.x,-m.height/2+l.y);l=map.Scale.normalX(g*7)/m.height;f.fu.scale(l,l);g*=7}map.Dom.newText(e,map.Scale.normalX(0),map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",map.Dictionary.getLocalText(v));e.fu.setPosition(map.Scale.normalX(20),map.Scale.normalY(g))}this.szFlag.match(/SEQUENCE/)||(v=map.Dom.newGroup(d),e=map.Dom.getBox(e),v.fu.setPosition(e.x+e.width+map.Scale.normalX(g*.66),map.Scale.normalY(-5)),
e="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.25)+"px",f=map.Dom.newGroup(v),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",f,0,0,b,e):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",f,-b,-b,b*2,b*2,e),map.Dom.newShape("line",f,0,-b,b*1.1,-b,e),map.Dom.newText(f,b*1.1+map.Scale.normalX(2),-b,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",this.formatValue(c,1)+this.szUnit),f.fu.setPosition(map.Scale.normalX(20),
map.Scale.normalY(g/2)),n>0&&n!=b&&(c=map.Dom.newGroup(v),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",c,0,0,n,e):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",c,-n,-n,n*2,n*2,e),map.Dom.newShape("line",c,0,-n,b*1.1,-n,e),map.Dom.newText(c,b*1.1+map.Scale.normalX(2),-n,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-60%;fill:black;stroke:none;pointer-events:none",this.formatValue(r,1)+this.szUnit),c.fu.setPosition(map.Scale.normalX(20),map.Scale.normalY(0)+
b*2-n)),map.Dom.newText(v,map.Scale.normalX(20),map.Scale.normalY(0+g+15),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",map.Dictionary.getLocalText("min / max size-values")));d.fu.scale(1,1)}this.szFlag.match(/CHART/)&&this.szFlag.match(/BUFFER/)&&(b=map.Scale.normalX(g/2),r=map.Dom.getBox(d.parentNode),r=r.width>0?r.width/map.Scale.normalX(1)+10:10,f=map.Dom.newGroup(d.parentNode),map.Dom.newShape("circle",f,0,0,b,"fill:none;stroke:black;"),e="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(1)+
";",map.Dom.newShape("line",f,0,0,b,0,e),map.Dom.newShape("line",f,0,map.Scale.normalY(-2),0,map.Scale.normalY(2.5),e),map.Dom.newShape("line",f,b,0,b+map.Scale.normalX(-3),map.Scale.normalY(-3),e),map.Dom.newShape("line",f,b,0,b+map.Scale.normalX(-3),map.Scale.normalY(3),e),map.Dom.newText(f,b*1.1+map.Scale.normalX(2),map.Scale.normalX(-10),"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",ixMap.Scale.prototype.formatDistanceString(this.nBufferSize*
this.nScale)),f.fu.setPosition(map.Scale.normalX(g/2+r),map.Scale.normalY(g/2)),a=new Button(d.parentNode,a+":bufferselectbutton","BUTTON","#bufferselect_button","map.Selections.newSelection('activeLayer','activeBuffer','type:BUFFER;buffersize:200','test');","","select active layer with this buffer"),a.setPosition(map.Scale.normalX(g+r+10),map.Scale.normalY(g)),a.scale(1.4,1.4),map._activeTheme&&map.Dom.newText(d.parentNode,map.Scale.normalX(g+r+20),map.Scale.normalY(g+6),"font-family:arial;font-size:"+
map.Scale.normalX(8)+"px;text-anchor:left;baseline-shift:-10%;fill:gray;stroke:none;pointer-events:none","... "+map._activeTheme));if(!(!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/SYMBOL/))){b=map.Dom.getBox(d.parentNode);b.width<0&&(b=new box(0,0,0,0));g=30;this.szFlag.match(/BAR/)&&this.nOrigSumA.length>5&&!this.szFlag.match(/STACKED/)&&(g=15*this.nOrigSumA.length/Math.log(this.nOrigSumA.length));
this.drawChart(d,null,g,"VALUES|NORMSIZE"+(this.szFlag.match(/STACKED/)?"|EXPANDMAX":""));g=map.Dom.getBox(d);g=Math.min(2.5,Math.max(b.height/g.height,map.Scale.normalX(100)/g.height));d.fu=new Methods(d);d.fu.scale(g,g);a=map.Dom.newGroup(d,"textGroup");a.fu.scale(1/g,1/g);g=d.fu.getBox();this.szFlag.match(/BAR/)?d.fu.setPosition(b.width-g.x+map.Scale.normalX(10),-g.y+Math.max(10,b.height*.95-g.height)):d.fu.setPosition(b.width-g.x+map.Scale.normalX(10),-g.y+Math.max(10,b.height/2-g.height/2));
v=" * overall sum";this.szAggregation&&this.szAggregation.match(/mean/)&&(v=" * arithmetic mean");d="middle";if(this.szFlag.match(/RIGHT/)||this.szFlag.match(/STACKED/)||this.szFlag.match(/CENTER/)||this.szFlag.match(/POINTER/)||this.partsA.length<=2)d="start";map.Dom.newText(a,0,g.height+g.y+map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+"baseline-shift:-100%;text-anchor:"+d+";",v)}}};A.prototype.drawColorSchemeLegend=function(d,a){var g=map.Scale.nButtonSize?map.Scale.nButtonSize*.66:12,b=map.Scale.nButtonSize||
12,r=map.Scale.nButtonSize?map.Scale.nButtonSize*1.2:18,n=r,v="font-family:arial;font-size:"+map.Scale.normalY(g)+"px;fill:#666666;pointer-events:none;",c=b*1.2;this.szFlag.match(/BAR/)&&this.szFlag.match(/\bUP\b/)&&(c=b);var e=g*1.15,f=0*c,m=0;this.szFlag.match(/BAR/)&&(this.szFlag.match(/\bUP\b/)||this.szFlag.match(/STACKED/))&&(m=this.partsA.length-1);this.showInfoMore||this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/\bUP\b/)||this.szFlag.match(/SYMBOL/)||this.szLabelA&&!this.szFlag.match(/\bCLIP\b/)||
this.partsA.length<=2?this.szLegendStyle="large":this.szLegendStyle="compact";var l=new ScrollArea(null,d,null,10,10,10);l.reformat();var h=l.workspaceNode;for(var p=1,B=0;B<this.partsA.length;B++)this.partsA[B].min&&(this.partsA[B].min.toFixed(0)!=this.partsA[B].min&&(p=Math.min(p,.1)),this.partsA[B].min.toFixed(1)!=this.partsA[B].min&&(p=Math.min(p,.01)));var C=[];for(B=0;B<this.partsA.length;B++)C[B]={},C[B].i=B,C[B].value=this.partsA[B].nCount;this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/)&&
this.szFlag.match(/SORTDOWN/)&&C.sort(this.sortIndexDown);!this.szFlag.match(/POINTER/)&&!this.szFlag.match(/INVERT/)||this.szLegendStyle.match(/compact/)||C.reverse();var N=1;!this.szLabelA&&C.length>15&&(N=Math.floor(C.length/10),b*=1.5);var Y=this.showInfoMore&&this.isMarkable?18:10,M=!1;if(this.szFlag.match(/CHART/)&&this.szFieldsA.length>1&&!this.szFlag.match(/OFFSET/)&&!this.szFlag.match(/DEVIATION/)){for(var w=M=0;w<this.nOrigSumA.length;w++)this.partsA[w]&&typeof this.partsA[w].nSum!="undefined"&&
M++;M=M==this.nOrigSumA.length}for(var J=0;J<C.length;J+=N){B=C[J].i;var L=Math.min(Math.abs(m-B),this.partsA.length-N);if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/))r=this.nSkipCount===0?3*this.partsA[B].nCount/this.nCount*100:30/this.nCount*10*this.partsA[B].nCount;else if(M){r=0;if(this.szFlag.match(/MORPH/)){for(w=0;w<this.nOrigSumA.length/2;w++)r=Math.max(r,this.nOrigSumA[w]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[w+this.nOrigSumA.length/
2]*this.nActualFrame/(this.nClipFrames-1));r=(this.nOrigSumA[L]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[L+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1))/r}else{for(w=0;w<this.nOrigSumA.length;w++)r=Math.max(r,this.partsA[w].nSum);r=this.partsA[L].nSum/r}r*=60}r=isNaN(r)?n:r;if(this.szFlag.match(/BUBBLE/))w=this.szFlag.match(/CATEGORICAL/)||this.szSizeField?b/2:b/4+b/4*(B+1)/this.partsA.length,w=map.Dom.newShape("circle",h,map.Scale.normalX(Y+b/
2),map.Scale.normalY(f+b/2),map.Scale.normalY(w),"fill:"+this.colorScheme[L]+";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");else if(N>1){w=map.Dom.newGroup(h,"");for(var G=0;G<N;G++)map.Dom.newShape("rect",w,map.Scale.normalX(Y),map.Scale.normalY(f+b/N*G),map.Scale.normalX(r),map.Scale.normalY(b/N),"fill:"+this.colorScheme[L+G]+";stroke:none;")}else w=map.Dom.newShape("rect",h,map.Scale.normalX(Y),map.Scale.normalY(f),map.Scale.normalX(r),map.Scale.normalY(b),"fill:"+this.colorScheme[L]+
";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");if(w){var F=this.partsA[L].nCount;for(G=1;G<N;G++)F+=this.partsA[L+G].nCount;this.isMarkable&&this.showInfoMore&&(map.Dom.newShape("rect",h,map.Scale.normalX(-5),map.Scale.normalY(f-2),map.Scale.normalX(r),map.Scale.normalY(b+4),"fill:white;stroke:none;opacity:0;").setAttributeNS(null,"id",this.szId+":widget:background:"+L),G=new Button(h,this.szId+":class:"+L,"CHECKBOX|SELECTED","","map.Themes.showClass(evt,'"+this.szId+"','"+L+"','"+N+"')",
"map.Themes.hideClass(evt,'"+this.szId+"','"+L+"','"+N+"')","show/hide class"),G.setPosition(map.Scale.normalX(map.Scale.nButtonSize/2-1),map.Scale.normalY(f+map.Scale.nButtonSize/2-1)),G.scale(.75,.75));var V=this.partsA[L].min+(J?p:0);G=this.partsA[L+N-1].max;var la=G-V>100?0:2;V=this.formatValue(V,la);la=this.formatValue(G,la);G="";this.szFlag.match(/SHOWMEMBERS/)&&(G="  ["+F+"]");G=V!=la?V+"..."+la+(this.szLegendUnits?this.szLegendUnits:"")+this.szUnit+G:V+(this.szLegendUnits?this.szLegendUnits:
"")+this.szUnit+G;(!this.szFlag.match(/\bCLIP\b/)||this.szFlag.match(/MORPH/))&&this.szLabelA&&this.szLabelA[L]&&(G=this.szLabelA[L]);this.szLegendLabelA[L]=G;if(this.szLegendStyle.match(/compact/)){if(this.fGrayNoMember&&F===0&&this.szFlag.match(/CHOROPLETH/)&&this.szFlag.match(/DOMINANT/)&&(w.style.setProperty("fill-opacity","0.03",""),w.style.getPropertyValue("fill"),w.style.setProperty("stroke-opacity","0.2",""),w.style.setProperty("stroke","black",""),w.style.setProperty("stroke-width",map.Scale.normalX(.3),
"")),!(this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/DOMINANT/)&&G.length>15)){var U=";font-size:"+map.Scale.normalX(g*.9)+"px;";J===0?(G=G.length>0?V+this.szUnit:G,map.Dom.newText(h,map.Scale.normalX(Y+2),map.Scale.normalY(f+e*(N+1.5)),v+U,G)):J==C.length-N&&(G=G.length>0?la+this.szUnit:G,map.Dom.newText(h,map.Scale.normalX(Y+2),map.Scale.normalY(f+e*(N+1.5)),v+U,G))}}else if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/))V=r+2,la=String(this.partsA[B].nCount),this.nSkipCount===
0&&(la=String(Math.round(100/this.nCount*this.partsA[B].nCount))+"%"),U=la.length*5/7*g,this.szTextPlacement=="dynamic"&&U<r&&(V-=String(this.partsA[B].nCount).length*5/7*g),map.Dom.newText(h,map.Scale.normalX(Y+V),map.Scale.normalY(f+e+1),v,la),V+=U,this.szSymbolsA[B]&&this.szSymbolsA[B].match(/symbol/)&&(la=map.Dom.constructNode("use",h,{"xlink:href":"#"+this.szSymbolsA[B]+":antizoomandpan"}),la.setAttributeNS(null,"style","fill:"+this.colorScheme[L]),la.fu.scale(.5,.5),la.fu.setPosition(map.Scale.normalX(Y+
V+10),map.Scale.normalY(f+e-3)),V+=20),V=map.Dom.newText(h,map.Scale.normalX(Y+V),map.Scale.normalY(f+e),v,"("+G+")"),V.style.setProperty("fill","#bbbbdd","");else{V=r+4;if(M){la=this.partsA[L].nSum;this.szFlag.match(/MORPH/)&&(la=this.nOrigSumA[L]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[L+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1));if(this.szField100&&!this.szFlag.match(/SUM/)||this.szAggregation&&!this.szAggregation.match(/sum/))la/=this.partsA[L].nCount;
G=G+"  ("+this.formatValue(la,1)+this.szUnit+")"}V=map.Dom.newText(h,map.Scale.normalX(Y+V),map.Scale.normalY(f+e),v,G);this.fGrayNoMember&&F===0&&this.szFlag.match(/CHOROPLETH/)&&(V.style.setProperty("fill","#bbbbdd",""),w.style.setProperty("opacity","0.1",""))}this.szFlag.match(/BUFFER/)&&w.style.setProperty("fill-opacity",this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0,"");this.szFieldsA.length==1||!this.szFlag.match(/CHART/)||this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/)?
(this.szLegendStyle.match(/compact/)?w.setAttributeNS(szMapNs,"tooltip",G+" ("+F+" member(s))"):w.setAttributeNS(szMapNs,"tooltip",F+" member(s)"),B=w.getAttributeNS(null,"style"),w.setAttributeNS(szMapNs,"onoverstyle",B+";stroke:black;stroke-width:"+map.Scale.normalX(.5)+";"),B=Oa(this.szId),F=Oa(String(L)),G=Oa(String(N)),w.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+B+"','"+F+"','"+G+"')"),w.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+B+"')"),w.setAttributeNS(null,
"onclick","map.Themes.zoomToClass(evt,'"+B+"','"+F+"','"+G+"')"),w.setAttributeNS(null,"id",a+":widget:classrect:"+L)):this.szFlag.match(/SYMBOL/)?this.szFlag.match(/CATEGORICAL/)?w.setAttributeNS(szMapNs,"tooltip",this.partsA[B].nCount+" ("+this.formatValue(this.partsA[B].nCount/this.nCount*100,1)+" %)"):this.szFlag.match(/SEQUENCE/)&&w.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[B]+" ("+this.formatValue(this.nOrigSumA[B]/this.nSum*100,1)+" %)"):this.szFieldsA.length>1&&!this.szFlag.match(/SEQUENCE/)&&
(this.nSum100?w.setAttributeNS(szMapNs,"tooltip",this.formatValue(100/this.nSum100*this.nOrigSumA[L],1)+" %"):this.nSum&&w.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[L]+" ("+this.formatValue(100/this.nSum*this.nOrigSumA[L],1)+" %)"),B=Oa(this.szId),F=Oa(String(L)),G=Oa(String(N)),w.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+B+"','"+F+"','"+G+"')"),w.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+B+"')"))}this.szLegendStyle.match(/compact/)?Y+=r:f+=c*9/10}this.szLegendStyle.match(/compact/)?
f+=c*N*2:this.nNoData&&(f+=c*1.5/10,w=map.Dom.newShape("rect",h,0,map.Scale.normalY(f),map.Scale.normalX(r),map.Scale.normalY(b),"fill:"+(this.szNoDataColor?this.szNoDataColor:"#ffffff")+";stroke:#000000;stroke-width:"+map.Scale.normalX(.1)+";"),w.setAttributeNS(szMapNs,"tooltip",this.nNoData+" member(s)"),a=Oa(this.szId),L=Oa(String(L)),w.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+a+"','"+L+"')"),w.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+a+"')"),map.Dom.newText(h,
map.Scale.normalX(22),map.Scale.normalY(f+e),v,map.Dictionary.getLocalText("no data")),f+=c*9/10);l&&(l.setWidth(-1),l.setHeight(Math.min(f+c,map.Scale.bBox.height/map.Scale.normalY(2.2))),this.nClipColorLegend&&l.setHeight(this.nClipColorLegend),l.reformat(),l.hasScrollBars()&&(h.style.setProperty("display","none",""),map.Dom.newShape("rect",d,0,0,map.Scale.normalX(l.getWidth()),map.Scale.normalY(l.getHeight()),"fill:none;stroke:none;")));return h};A.prototype.showInfo=function(){};A.prototype.chartButton=
function(d,a,g){d=map.Dom.newGroup(d,"chartvari"+String(Math.random()));var b=this.szFlag;g=="2D"&&this.removeDefinitionFromFlag("3D");this.szFlag+="|NORMSIZE|SILENT|MENUSIZE|"+g;this.drawChart(d,null,a);this.szFlag=b;b=map.Dom.getBox(d);this.addChartTypeSign(d,g);g=Math.min(map.Scale.normalX(a)/b.width,map.Scale.normalY(a)/b.height);d.fu.scale(g,g);d.fu.setPosition(map.Scale.normalX(a+10),map.Scale.normalY(a)*g);return d};A.prototype.addDefinitionToFlag=function(d){return this.szFlag=this.szFlag+
"|"+d};A.prototype.removeDefinitionFromFlag=function(d){for(var a="",g=this.szFlag.split("|"),b=0;b<g.length;b++)g[b]!=d&&(a+=(a.length?"|":"")+g[b]);return this.szFlag=a};A.prototype.removeDefinition=function(d,a){var g="";d=d.split("|");for(var b=0;b<d.length;b++)d[b]!=a&&(g+=(g.length?"|":"")+d[b]);return g};A.prototype.addChartTypeSign=function(d,a){var g="M0,0 l"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" -"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+
" M"+map.Scale.normalX(2.5)+",0 l"+map.Scale.normalX(17.5)+",0 M"+map.Scale.normalX(22.5)+",0 l-"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" "+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5);if(a.match(/SIZE/)){var b=map.Dom.newGroup(d,"");map.Dom.newShape("path",b,g,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;stroke-linecap:square;");map.Dom.newShape("path",b,g,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+
";stroke-linejoin:miter;stroke-linecap:square;");b.fu.setPosition(-map.Scale.normalX(10),map.Scale.normalX(-5))}a.match(/HEIGHT/)&&(b=map.Dom.newGroup(d,""),map.Dom.newShape("path",b,g,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;stroke-linecap:square;"),map.Dom.newShape("path",b,g,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+";stroke-linejoin:miter;stroke-linecap:square;"),b.setAttributeNS(null,"transform","translate(0,"+-map.Scale.normalX(25)+
") rotate(90)"))};A.prototype.getChartTypeMenu=function(d,a,g){if(typeof b=="undefined")var b="CHART|BAR CHART|BAR|3D CHART|BAR|3D|SORT CHART|BAR|HORZ|LEFT|UP CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|LEFT|UP|COMPRESS CHART|BAR|HORZ|RIGHT|UP|COMPRESS CHART|BAR|HORZ|LEFT|UP|3D CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|HORZ|LEFT|UP|COMPRESS|3D CHART|BAR|HORZ|RIGHT|UP|COMPRESS|3D CHART|BAR|HORZ|CENTER|UP CHART|BAR|STACKED CHART|BAR|STACKED|3D CHART|BAR|SORT|3D|COLUMNS|STACKED CHART|BAR|SORT|3D|COLUMNS|STACKED|SIZE CHART|PIE CHART|PIE|SIZE CHART|PIE|3D CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|VOLUME CHART|PIE|DONUT CHART|PIE|DONUT|SIZE CHART|PIE|DONUT|3D CHART|PIE|DONUT|3D|SIZE CHART|PIE|DONUT|3D|HEIGHT CHART|PIE|DONUT|3D|VOLUME CHART|PIE|STARBURST CHART|PIE|STARBURST|SIZE CHART|PIE|STARBURST|3D CHART|PIE|STARBURST|3D|SIZE CHART|PIE|STARBURST|3D|HEIGHT CHART|PIE|STARBURST|3D|VOLUME CHART|PIE|DONUT|STARBURST CHART|PIE|DONUT|STARBURST|SIZE CHART|PIE|DONUT|STARBURST|3D CHART|PIE|DONUT|STARBURST|3D|SIZE CHART|PIE|DONUT|STARBURST|3D|HEIGHT CHART|PIE|DONUT|STARBURST|3D|VOLUME".split(" ");
if(typeof r=="undefined")var r="CHOROPLETH CHART|BUBBLE CHART|SQUARE CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|SIZE|HEIGHT CHART|BAR|3D|VOLUME CHART|BAR CHART|BAR|3D CHART|BAR|3D|SIZE CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|POINTER CHART|BAR|POINTER|SIZE CHART|BAR|HORZ|RIGHT|UP|POINTER CHART|LABEL".split(" ");a=this.szOrigFlag;if(this.szFieldsA.length>1||this.szFlag.match(/CATEGORICAL/)&&this.szFlag.match(/AGGREGATE/))r=b;g=g?g/60:3;for(b=0;b<r.length;b++){var n=this.szFlag;
var v=map.Dom.constructNode("a",d,{});map.Dom.newShape("rect",v,map.Scale.normalX(b%g*60),map.Scale.normalY(60*Math.floor(b/g)),map.Scale.normalX(60),map.Scale.normalY(60),"fill:#f8f8ff;stroke:lightgray;stroke-dasharray:50 50;stroke-width:"+map.Scale.normalX(1)+";");var c=map.Dom.newGroup(v,"szDisplayId:chart:"+String(Math.random()));map.Dom.setClipRect(c,new box(-map.Scale.normalX(25),-map.Scale.normalX(60),map.Scale.normalX(60),map.Scale.normalX(60)));this.szFlag=r[b]+"|NORMSIZE|SILENT|MENUSIZE";
n.match(/CATEGORICAL/)&&(this.szFlag+="|CATEGORICAL");n.match(/GROUP/)&&(this.szFlag+="|GROUP");n.match(/AGGREGATE/)&&(this.szFlag+="|AGGREGATE");n.match(/COMPATIBLE/)&&(this.szFlag+="|COMPATIBLE");n.match(/FAST/)&&(this.szFlag+="|FAST");n.match(/RELOCATE/)&&(this.szFlag+="|RELOCATE");n.match(/DIFFERENCE/)&&(this.szFlag+="|DIFFERENCE");n.match(/FRACTION/)&&(this.szFlag+="|FRACTION");n.match(/INVERT/)&&(this.szFlag+="|INVERT");n.match(/INVERTSIZE/)&&(this.szFlag+="|INVERTSIZE");n.match(/RELATIVE/)&&
(this.szFlag+="|RELATIVE");n.match(/DENSITY/)&&(this.szFlag+="|DENSITY");n.match(/DOPACITYMAX/)?this.szFlag+="|DOPACITYMAX":n.match(/DOPACITYLOGMAX/)?this.szFlag+="|DOPACITYLOGMAX":n.match(/DOPACITYPOWMAX/)?this.szFlag+="|DOPACITYPOWMAX":n.match(/DOPACITYMEAN/)?this.szFlag+="|DOPACITYMEAN":n.match(/DOPACITYLOGMEAN/)?this.szFlag+="|DOPACITYLOGMEAN":n.match(/DOPACITYPOWMEAN/)?this.szFlag+="|DOPACITYPOWMEAN":n.match(/DOPACITYLOG/)?this.szFlag+="|DOPACITYLOG":n.match(/DOPACITY/)&&(this.szFlag+="|DOPACITY");
n.match(/AUTO100/)&&(this.szFlag+="|AUTO100");n.match(/AUTOCOMPLETE/)&&(this.szFlag+="|AUTOCOMPLETE");var e=this.szAggregation,f=this.nClipParts;this.nClipParts=10;var m=this.drawChart(c,null,40);typeof f==="undefined"?delete this.nClipParts:this.nClipParts=f;this.szAggregation=e;if(m){this.szFlag=n;var l=map.Scale.normalX(10);m.x-=map.Scale.normalX(60/g);c.fu.setPosition(l-m.x+b%g*map.Scale.normalX(60),map.Scale.normalY(40)+l+m.y+Math.floor(b/g)*map.Scale.normalY(60));c.setAttributeNS(null,"clip-path",
"");l=900/Math.max(c.fu.getBox().width,c.fu.getBox().height);l<1&&c.fu.scale(l,l);l="";a.match(/UNDEFINEDISVALUE/)&&(l+="|UNDEFINEDISVALUE");a.match(/ZEROISVALUE/)&&(l+="|ZEROISVALUE");a.match(/NEGATIVEISVALUE/)&&(l+="|NEGATIVEISVALUE");a.match(/NONEGATIVE/)&&(l+="|NEGATIVEISVALUE");a.match(/GROUP/)&&(l+="|GROUP");a.match(/AGGREGATE/)&&(l+="|AGGREGATE");a.match(/COMPATIBLE/)&&(l+="|COMPATIBLE");a.match(/FAST/)&&(l+="|FAST");a.match(/\bRECT\b/)&&(l+="|RECT");a.match(/HEX/)&&(l+="|HEX");a.match(/RELOCATE/)&&
(l+="|RELOCATE");a.match(/CATEGORICAL/)&&(l+="|CATEGORICAL");a.match(/SUM/)&&(l+="|SUM");a.match(/MEAN/)&&(l+="|MEAN");a.match(/DIFFERENCE/)&&(l+="|DIFFERENCE");a.match(/RELATIVE/)&&(l+="|RELATIVE");a.match(/INVERT/)&&(l+="|INVERT");a.match(/INVERTSIZE/)&&(l+="|INVERTSIZE");a.match(/CALCMEAN/)&&(l+="|CALCMEAN");a.match(/CALC100/)&&(l+="|CALC100");a.match(/PRODUCT/)&&(l+="|PRODUCT");a.match(/AUTOCOMPLETE/)&&(l+="|AUTOCOMPLETE");a.match(/AUTO100/)&&(l+="|AUTO100");a.match(/QUANTILE/)&&(l+="|QUANTILE");
a.match(/DENSITY/)&&(l+="|DENSITY");a.match(/DOPACITY/)&&(l+="|DOPACITY");if(a.match(/VALUES/)||n.match(/VALUES/))l+="|VALUES";a.match(/VALUEBACKGROUND/)&&(l+="|VALUEBACKGROUND");r[b].match(/SIZE/)&&(n.match(/SIZELOG/)?l+="|SIZELOG":n.match(/SIZEP4/)?l+="|SIZEP4":n.match(/SIZEP3/)?l+="|SIZEP3":n.match(/SIZE/)&&(l+="|SIZE"));n.match(/SPACED/)&&(l+="|SPACED");n=Oa(this.szId);m=Oa(r[b]);e=Oa(l);v.setAttributeNS(null,"onclick","map.Themes.changeThemeStyle(evt,'"+n+"','type:"+m+e+"')");this.addChartTypeSign(c,
r[b])}}d=[];for(var h in r)d.push(r[h]+l);return d};A.prototype.formatValue=function(d,a,g){return isNaN(d)?d:this.nMin>999&&this.nMax<3E3?__formatValue(d,a,g+"|NOBREAKS"):__formatValue(d,a,g)};A.prototype.remove=function(d){this.parent.removeTheme(d,this.szId)};A.prototype.removeElements=function(d){this.szFlag.match(/FEATURE/)&&this.chartGroup&&this.parent.removeFromThemeNodesCache(this.chartGroup);this.widgetNode&&(widgetList.removeWidget(this.widgetNode),this.widgetNode.parentNode.removeChild(this.widgetNode),
this.widgetNode=null);this.clipTimeout&&clearTimeout(this.clipTimeout);this.unpaintMap();this.clearWMS();this.szFlag.match(/FEATURE/)&&this.chartGroup&&(d=map.SVGDocument.getElementById(this.chartGroup.getAttributeNS(null,"id")+":label"),this.chartGroup.parentNode.removeChild(d),this.chartGroup.parentNode.removeChild(this.chartGroup),this.parent.removeFromThemeNodesCache(this.chartGroup));if(this.onremove)try{try{if(typeof this.onremove==="function")this.onremove();else if(typeof this.onremove===
"string")if(/^[a-zA-Z_$][a-zA-Z0-9_$]*(\.[a-zA-Z_$][a-zA-Z0-9_$]*)*\([^)]*\)$/.test(this.onremove.trim())){var a=(new Function("return "+this.onremove))();typeof a==="function"&&a()}else console.warn("Unsafe onremove pattern detected, ignoring: "+this.onremove)}catch(g){console.error("Error executing onremove: "+g.message)}}catch(g){}try{map.HTMLWindow.ixmaps.htmlgui_onRemoveTheme(this.szId)}catch(g){}};A.prototype.removeMapThemeStyles=function(d){d=d.split("|");for(var a=map.SVGRootElement.getElementsByTagName("path"),
g=0;g<a.length;g++)if(a.item(g).nodeType==1){var b=a.item(g).parentNode.getAttributeNS(null,"id"),r=!1;if(b&&b.length!==0){b=map.Tiles.getMasterId(b).split(":")[0];for(var n=0;n<d.length;n++)b==d[n]&&(r=!0)}r&&a.item(g).parentNode.removeAttributeNS(null,"style")}};A.prototype.disable=function(){if(!this.szFlag.match(/CHART/)&&this.widgetNode)for(var d=this.widgetNode.getElementsByTagName("g"),a=0;a<d.length;a++)d.item(a).setAttributeNS(null,"opacity","0.9")};A.prototype.enable=function(){if(this.widgetNode){for(var d=
this.widgetNode.getElementsByTagName("g"),a=0;a<d.length;a++)d.item(a).setAttributeNS(null,"opacity","1.0");this.widgetNode.parentNode.appendChild(this.widgetNode)}map.Themes.setActive(this)};A.prototype.makeVisible=function(){for(var d=0;d<this.szThemesA.length;d++)map.Layer.isLayerOn(this.szThemesA[d])||map.Layer.isScaleDependentLayer(this.szThemesA[d])||(map.Themes.switchedLayerA[this.szThemesA[d]]=!0,map.Api.switchMapTheme(this.szThemesA[d],"on")),map.Tiles.switchScaleDependentTiles()};A.prototype.checkVisible=
function(){for(var d=0;d<this.szThemesA.length;d++)map.Themes.isThemeLayerUsed(this.szThemesA[d])&&this.isVisible||!map.Themes.switchedLayerA[this.szThemesA[d]]||(map.Api.switchMapTheme(this.szThemesA[d],"off"),map.Themes.switchedLayerA[this.szThemesA[d]]=null)};A.prototype.resize=function(d){d!=999&&(this.nScale*=d);if(this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.fRedrawInfo=this.fRedraw=!0,this.nSkipCount=1,map.Themes.execute();else{map.Layer.changeObjectScaling(null,d,this.chartGroup);
this.szFlag.match(/DECLUTTER/)&&this.declutterCharts();if(this.szFlag.match(/BUFFER/))for(var a=this.chartGroup.getElementsByTagName("circle"),g=0;g<a.length;g++){var b=a.item(g).getAttributeNS(null,"style");b&&b.length&&(b=__scaleStyleString(b,1/d),a.item(g).setAttributeNS(null,"style",b))}this.f=!0;this.showInfo()}};A.prototype.offset=function(d){var a=this.chartGroup.fu.getPosition();this.chartGroup.fu.setPosition(a.x+d.x,a.y+d.y)};A.prototype.opacity=function(d){this.fillOpacity=(this.fillOpacity?
this.fillOpacity:1)*d;this.fillOpacity=Math.min(1,this.fillOpacity);this.fillOpacity=Math.max(0,this.fillOpacity);this.nOpacity=(this.nOpacity?this.nOpacity:1)*d;this.nOpacity=Math.min(1,this.nOpacity);this.nOpacity=Math.max(0,this.nOpacity);if(this.chartGroup)for(var a=this.chartGroup.childNodes,g=0;g<a.length;g++)map.Layer.changeNodeOpacity(a.item(g),d);else if(this.szShapeType.match(/line/))for(g=0;g<this.szThemesA.length;g++)map.Layer.changeLayerOpacity(this.szThemesA[g],d);else for(a in this.itemA){g=
this.getItemNodes(a);for(var b=0;b<g.length;b++)map.Layer.changeNodeOpacity(g[b],d,"fill-opacity")}};A.prototype.blur=function(d){if(this.chartGroup)if(this.nBlur){var a="blur-3",g=map.SVGDocument.getElementById(a);g?g.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(d)):(g=map.Dom.newNode("filter",this.chartGroup.parentNode),g.setAttributeNS(null,"id",a),g=map.Dom.newNode("feGaussianBlur",g),g.setAttributeNS(null,"stdDeviation",map.Scale.normalX(d)));this.chartGroup.style.setProperty("filter",
"url(#"+a+")","")}else this.chartGroup.style.removeProperty("filter");else if(this.szThemesA[0]){var b=map.SVGDocument.getElementById("maplayer");b&&(this.nBlur?(a="blur-map",(g=map.SVGDocument.getElementById(a))?g.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(d)/map.Zoom.nZoom):(g=map.Dom.newNode("filter",b.parentNode),g.setAttributeNS(null,"id",a),g.setAttributeNS(null,"x",0),g.setAttributeNS(null,"y",0),g.setAttributeNS(null,"width","100%"),g.setAttributeNS(null,"height","100%"),
g=map.Dom.newNode("feGaussianBlur",g),g.setAttributeNS(null,"stdDeviation",map.Scale.normalX(d)/map.Zoom.nZoom)),b.style.setProperty("filter","url(#"+a+")","")):b.style.removeProperty("filter"))}};A.prototype.toggle=function(d){this.chartGroup?d===!0||typeof d=="undefined"&&this.chartGroup.style.getPropertyValue("display")=="none"?(this.chartGroup.style.setProperty("display","inline",""),this.chartGroup.display="inline",this.isChecked=!0):(this.chartGroup.style.setProperty("display","none",""),this.chartGroup.display=
"none",this.isChecked=!1):this.isChecked?(this.unpaintMap(),this.isChecked=!1,map.Themes.activateNextPaint(this)&&(this.fToggle=!1,map.Themes.execute(),this.widgetNode&&(this.widgetNode.setAttributeNS(null,"opacity","1.0"),this.widgetNode.parentNode.appendChild(this.widgetNode)))):(this.fRedraw=this.isChecked=!0,this.fToggle=!1,map.Themes.execute())};A.prototype.getHistogram=function(d,a,g){map.Themes.getHistogram(d,a,g,this)};var Ba=[]})();var mapSelection=null;
(function(){function Ga(x,y,A,I){this.nSelected=this.nCount=0;this.szThemes=x;this.szThemesA=x.split("|");this.szSelectShape=y;this.highLightList=new HighLight;this.szTitle=I?I:"["+y+"] - "+x;this.szTitle=map.Dictionary.getLocalText(this.szTitle);this.szOrigFlag=this.szFlag=A?A:"";this.nRefreshTimeout=0;this.szId="theme"+String(Math.random());this.szShapeType="polygon"}function t(x,y){var A=x.x;x=x.y;for(var I=!1,O=0,ha=y.length-1;O<y.length;ha=O++){var Z=y[O].x,W=y[O].y,Q=y[ha].x;ha=y[ha].y;W>x!=
ha>x&&A<(Q-Z)*(x-W)/(ha-W)+Z&&(I=!I)}return I}function H(x){if(x){var y=x instanceof Array?[]:{},A;for(A in x)A!="clone"&&(y[A]=x[A]&&typeof x[A]=="object"?H(x[A]):x[A]);return y}return null}ixMap.Selections=function(){};ixMap.Selections.prototype=new Map;typeof thisversion=="string"&&map.checkVersion(thisversion)?map.Selections=new ixMap.Selections:alert("ixMap.Themes incompatible !");ixMap.Selections.prototype.newSelection=function(x,y,A,I){if(y==null)return displayMessage("empty selection",1E3),
null;var O=null;A==null&&(A="type:circle");if(O=(O=A.split("style="))&&O.length>1?__getStyleObj(O[1]):__getStyleObj(A)){x=="activeLayer"&&(x=getActiveTheme(),x==null&&map.Themes.activeTheme&&(x=map.Themes.activeTheme.szThemes));if(x==null)return displayMessage("nothing to select!",1E3),null;mapSelection=new Ga(x,y,"SELECTION|"+O.type,I);O.buffersize&&(mapSelection.nBufferSize=O.buffersize)}mapSelection.parent=map.Themes;map.Themes.addTheme(mapSelection);mapSelection.fRealize=!0;executeWithMessage(()=>
map.Themes.execute(),"please wait ...");return mapSelection};Ga.prototype.initValues=function(){this.nSelectedArea=this.nSelected=this.nThemeItems=this.nTested=this.nCount=this.nNodes=0;this.activeTheme=map.Themes.getTheme(this.szThemes)||map.Themes.getTheme();this.activeTheme.szThemes!=this.szThemes&&this.activeTheme.szId!=this.szThemes||!this.activeTheme.szFlag.match(/CHART/)||this.activeTheme.szFlag.match(/MULTIPLE/)||(this.szThemes="generic");this.themeNodesA=[];if(this.szThemes=="generic"){var x=
this.activeTheme;this.nCount=this.nNodes=this.nThemeItems=(this.themeRootNodesA=x.filterNodesA&&x.filterNodesA!=this.szSelectShape?H(x.filterNodesA):H(x.indexA))?this.themeRootNodesA.length:0}else{this.themeRootNodesA=[];for(x=0;x<this.szThemesA.length;x++){var y=map.Layer.getLayerObj(this.szThemesA[x]);if(y&&y.szSelection&&y.szSelection.length!==0){this.szThemeType=y.szType;this.nThemeItems+=y.nItems;var A=[];y.szFlag.match(/tiled/)?A=map.Tiles.getTileNodes(this.szThemesA[x]):A[0]=SVGDocument.getElementById(y.szName);
if(y.nRenderer&1&&y.szRenderer&&y.szRenderer.length)for(y=0;y<A.length;y++)for(var I=A[y].childNodes,O=0;O<I.length;O++)I.item(O).nodeType==1&&I.item(O).hasChildNodes()&&(this.themeRootNodesA[this.themeRootNodesA.length]=I.item(O));else for(y=0;y<A.length;y++)this.themeRootNodesA[this.themeRootNodesA.length]=A[y]}}if(this.themeRootNodesA.length===0)return!1;for(x=0;x<this.themeRootNodesA.length;x++)this.nNodes+=this.themeRootNodesA[x].childNodes.length;this.nCount=this.nNodes}if(this.szSelectShape==
"queryresult")return!0;if(typeof this.szSelectShape=="object"){this.queryResultA=this.szSelectShape;if(this.szThemes=="generic")for(x=0;x<this.szSelectShape.length;x++)this.themeRootNodesA[x]=this.szSelectShape[x];else for(x=0;x<this.szSelectShape.length;x++)this.themeRootNodesA[x]=this.szSelectShape[x].node.parentNode;this.nNodes=this.themeRootNodesA.length=this.szSelectShape.length;this.szSelectShape="queryresult";this.szSelectQuery=this.szTitle;this.markGroup||(this.markGroup=map.Dom.newGroup(map.Layer.objectGroup,
this.szId+":markgroup"));return!0}if(this.szSelectShape=="activeBuffer"){A=map.Themes.activeBuffer;if(A!=null){y=[];x=A.chartGroup;I=x.getElementsByTagName("path");O=x.getElementsByTagName("circle");for(x=0;x<I.length;x++)y[y.length]=I.item(x);for(x=0;x<O.length;x++)y[y.length]=O.item(x);this.selectCenterA=[];for(x=0;x<y.length;x++)this.selectCenterA[this.selectCenterA.length]=map.Scale.getMapOffset(y[x]);this.selectBufferSize=A.nBufferSize/map.Scale.mapUnitsPPX;this.selectScale=A.nScale;this.markGroup||
(this.markGroup=map.Dom.newGroup(map.Layer.objectGroup,this.szId+":markgroup"));return!0}alert("error: no active theme/buffer to select with");return!1}if(this.szSelectShape=="mapbounds")x=map.Zoom.getBox(),this.selectCenterA=[],this.selectionCenter=new point(x.x+x.width/2,x.y+x.height/2),this.selectCenterA.push(this.selectionCenter),this.selectBufferSizeX=x.width/2,this.selectBufferSizeY=x.height/2,this.selectScale=1;else{this.selectCenterA=[];y=map.SVGDocument.getElementById(this.szSelectShape);
if(!y)return!1;y.fu=new Methods(y);if(this.szFlag.match(/shape/))y.fu.getPosition(),x=y.fu.getBox(),this.selectionCenter=new point(x.x+x.width/2,x.y+x.height/2),this.selectCenterA[this.selectCenterA.length]=this.selectionCenter,this.selectBufferSize=Math.max(x.width/2,x.height/2),this.selectBufferSize/=map.Scale.nZoomScale;else if(this.szFlag.match(/circle/)){x=y.fu.getPosition();x.x=Number(y.getAttributeNS(null,"cx"));x.y=Number(y.getAttributeNS(null,"cy"));this.selectionCenter=new point(x.x,x.y);
this.selectCenterA[this.selectCenterA.length]=map.Scale.getMapPosition(x.x,x.y);map.Scale.getMapPosition(x.x,x.y);this.selectBufferSize=y.getAttributeNS(null,"r");if(this.selectBufferSize===0)return!1;x=map.antiZoomAndPanList.getActualMatrix();this.selectBufferSize*=x[0]}else if(this.szFlag.match(/square/)){x=y.fu.getPosition();x.x=Number(y.getAttributeNS(null,"x"));x.y=Number(y.getAttributeNS(null,"y"));A=Number(y.getAttributeNS(null,"width"));y=Number(y.getAttributeNS(null,"height"));this.selectionCenter=
new point(x.x+A/2,x.y+y/2);this.selectCenterA[this.selectCenterA.length]=map.Scale.getMapPosition(x.x+A/2,x.y+y/2);map.Scale.getMapPosition(x.x+A/2,x.y+y/2);this.selectBufferSizeX=A/2;this.selectBufferSizeY=y/2;if(this.selectBufferSizeX===0||this.selectBufferSizeY===0)return!1;x=map.antiZoomAndPanList.getActualMatrix();this.selectBufferSizeX*=x[0];this.selectBufferSizeY*=x[0]}this.selectScale=map.Scale.nZoomScale;this.markGroup||(this.markGroup=map.Dom.newGroup(map.Layer.objectGroup,this.szId+":markgroup"))}return!0};
Ga.prototype.realize=function(){this.fShowProgressBar=!0;this.initValues()?(this.nSkipCount=this.nDoneCount=0,this.mapSleep=new ixMap.Sleep("activeSelection.selectShapes",100,map.Dictionary.getLocalText("do selection")),this.mapSleep.fShowProgressBar=!0,this.mapSleep.nCount=this.nCount,this.mapSleep.szCancel="activeSelection.cancel()",this.selectShapes()):(this.remove(),displayMessage("Selection could not be done",3E3))};Ga.prototype.realizeContinue=function(x){this.selectShapes(x)};Ga.prototype.realizeDone=
function(){this.nRefreshTimeout&&setTimeout("map.Themes.refreshTheme('"+this.szId+"')",this.nRefreshTimeout)};Ga.prototype.redraw=function(){};Ga.prototype.removeValues=function(){};Ga.prototype.disable=function(){};Ga.prototype.cancel=function(){this.fCancel=!0};Ga.prototype.nextThemeNode=function(x){return this.szThemes=="generic"||this.szSelectShape=="queryresult"?this.themeRootNodesA[x]:x===0?(this.nRootIndex=0,this.actNode=this.themeRootNodesA[this.nRootIndex].firstChild):this.actNode?(this.actNode=
this.actNode.nextSibling)?this.actNode:++this.nRootIndex>=this.themeRootNodesA.length?null:this.actNode=this.themeRootNodesA[this.nRootIndex].firstChild:null};Ga.prototype.selectShapes=function(x){if(!x||x===0)if(x=0,this.testA=[],this.itemA=[],this.chartPosA=[],this.exactCountA=[],this.exactSizeA=[],this.activeTheme||(this.activeTheme=map.Themes.activeTheme),this.activeTheme&&this.szThemesA[0]+" == "+this.activeTheme.szThemesA[0]){this.nPartsA=H(this.activeTheme.nPartsA);this.partsA=H(this.activeTheme.partsA);
this.origColorScheme=H(this.activeTheme.origColorScheme);this.colorScheme=H(this.activeTheme.colorScheme);this.szFieldsA=H(this.activeTheme.szFieldsA);this.szLabelA=H(this.activeTheme.szLabelA);this.szLegendLabelA=H(this.activeTheme.szLegendLabelA);this.szXaxisA=H(this.activeTheme.szXaxisA);this.szSymbolsA=H(this.activeTheme.szSymbolsA);this.szRanges=this.activeTheme.szRanges;this.szSizeField=this.activeTheme.szSizeField;this.nMeanA=H(this.activeTheme.nMeanA);this.nMedianA=H(this.activeTheme.nMedianA);
this.nDeviationA=H(this.activeTheme.nDeviationA);this.nFilterA=H(this.activeTheme.nFilterA);this.nOrigSumA=H(this.activeTheme.nOrigSumA);this.szUnit=this.activeTheme.szUnit;this.formatValue=this.activeTheme.formatValue;this.nMin100=this.activeTheme.nMin100;this.nMax100=this.activeTheme.nMax100;this.nClipFrames=this.activeTheme.nClipFrames;this.nActualFrame=this.activeTheme.nActualFrame;this.sortIndexDown=this.activeTheme.sortIndexDown;this.sortIndexUp=this.activeTheme.sortIndexUp;this.shuffleArray=
this.activeTheme.shuffleArray;this.removeDefinition=this.activeTheme.removeDefinition;this.szValuesTextStyle=this.activeTheme.szValuesTextStyle;this.nOrigValuesSumA=[];this.nValuesSumA=[];this.nValuesMinA=[];this.nValuesMaxA=[];this.nExactCount=this.nCount=this.nSum=this.nSum100=0;this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinSize=Number.MAX_VALUE;this.nMaxSize=-Number.MAX_VALUE;for(var y=this.nSumSize=0;y<this.activeTheme.szFieldsA.length;y++)this.nOrigValuesSumA[y]=0,this.nValuesSumA[y]=
0,this.nValuesMinA[y]=Number.MAX_VALUE,this.nValuesMaxA[y]=-Number.MAX_VALUE;for(var A=0;A<this.partsA.length;A++)this.partsA[A].nCount=0,this.partsA[A].nSum=0,this.exactSizeA[A]=0}if(this.nNodes){var I=null,O=null,ha=this.selectBufferSize*this.selectScale,Z=null;this.selectBufferSizeX&&(ha=this.selectBufferSizeX*this.selectScale,Z=this.selectBufferSizeY*this.selectScale);for(A=x;A<this.nNodes;A++){this.mapSleep.nDoneCount=this.nDoneCount;if(this.mapSleep.checkSleep(A,10))return;if(this.szThemes==
"generic"){x=this.nextThemeNode(A);this.nDoneCount++;var W=!1;if(this.szSelectShape=="queryresult")W=!0;else if(this.szFlag.match(/shape/)){W=map.SVGDocument.getElementById(this.szSelectShape);var Q=map.Api.getShapePoints(W.firstChild);W=t(this.activeTheme.getNodePosition(x),Q)}else for(Q=0;Q<this.selectCenterA.length;Q++){var xa=this.activeTheme.getNodePosition(x),Aa=this.selectCenterA[Q];xa&&Aa&&ha?(y=Aa.x-xa.x,xa=Aa.y-xa.y,y=Z?Math.abs(y)<=ha&&Math.abs(xa)<=Z:Math.sqrt(y*y+xa*xa)<=ha):y=!1;if(y){W=
!0;break}}}else{I=this.nextThemeNode(A);this.nDoneCount++;if(!I||I.nodeType!=1)continue;if(I.getAttributeNS(null,"id").match(/:paint/))continue;x=map.Tiles.getMasterId(I.getAttributeNS(null,"id"));this.testA&&!this.testA[x]&&(this.testA[x]=I,this.nTested++);W=!1;if(this.szSelectShape=="queryresult")for(this.selectionCenter||(this.selectionCenter=new point(0,0)),Q=0;Q<this.queryResultA.length;Q++){if(this.queryResultA[Q].node.parentNode==I){W=!0;(Q=I.getAttributeNS(szMapNs,"center"))&&Q.length>2&&
(O=Q.split(","),O=new point(Number(O[0].split(":")[1]),Number(O[1].split(":")[1])));O||(Q=map.Dom.getBox(I),O=new point(Q.x,Q.y));Q=map.Scale.mapCanvasCenter;map.Scale.getMapOffset(I);O.x+=Q.x;O.y+=Q.y;this.selectionCenter.x+=O.x/this.queryResultA.length;this.selectionCenter.y+=O.y/this.queryResultA.length;break}}else if(Q=map.Dom.getBox(I),W=map.Scale.getMapOffset(I),Q.x+=W.x,Q.y+=W.y,Q.x>this.selectCenterA[0].x+ha||Q.y>this.selectCenterA[0].y+Z||Q.x+Q.width<this.selectCenterA[0].x-ha||Q.y+Q.height<
this.selectCenterA[0].y-Z)W=!1;else if(Q.x<this.selectCenterA[0].x-ha&&Q.y<this.selectCenterA[0].y-Z&&Q.x+Q.width>this.selectCenterA[0].x+ha&&Q.y+Q.height>this.selectCenterA[0].y+Z){Q=I.getElementsByTagName("path");Q=map.Api.getShapePoints(Q.item(0));y=map.Scale.getMapOffset(I);for(let ca in Q)Q[ca].x+=y.x,Q[ca].y+=y.y;W=t(new point(this.selectCenterA[0].x,this.selectCenterA[0].y),Q)}else{W=!1;Q=I.getElementsByTagName("path");Q=map.Api.getShapePoints(Q.item(0));y=map.Scale.getMapOffset(I);for(let ca in Q)if(Q[ca].x+
y.x<=this.selectCenterA[0].x+ha&&Q[ca].y+y.y<=this.selectCenterA[0].y+Z&&Q[ca].x+y.x>=this.selectCenterA[0].x-ha&&Q[ca].y+y.y>=this.selectCenterA[0].y-Z){W=!0;break}}}if(W){if(this.szThemes=="generic")this.itemA[x]=this.activeTheme.itemA[x],this.nSelected++;else{this.szThemeType=="point"&&(this.markGroup?map.Dom.newShape("circle",this.markGroup,O.x,O.y,map.Scale.normalX(1)*map.Scale.nZoomScale,"fill:yellow;stroke:none;"):I&&I.style.setProperty("opacity","0.0"));W=I.getAttributeNS(szMapNs,"area");
if(this.itemA&&this.itemA[x])continue;this.itemA[x]=I;this.nSelected++;this.nSelectedArea+=Number(W)}if(this.activeTheme)for(W=[],this.activeTheme.itemA[x]?W.push(this.activeTheme.itemA[x]):this.activeTheme.posItemA[x]&&(W=this.activeTheme.posItemA[x]),x=0;x<W.length;x++)if(Q=W[x],Q.nValuesA.length!=1||!(isNaN(Q.nValuesA[0])||Q.nValuesA[0]===0&!this.activeTheme.szFlag.match(/ZEROISVALUE/))){this.nCount++;for(y=0;y<Q.nValuesA.length;y++)isNaN(Q.nValuesA[y])||(this.nOrigValuesSumA[y]+=Q.nOrigValuesA[y],
this.nValuesSumA[y]+=Q.nValuesA[y],this.nValuesMinA[y]=Math.min(this.nValuesMinA[y],Q.nValuesA[y]),this.nValuesMaxA[y]=Math.max(this.nValuesMaxA[y],Q.nValuesA[y]),this.nMin=Math.min(this.nMin,Q.nValuesA[y]),this.nMax=Math.max(this.nMax,Q.nValuesA[y]),this.nMinSize=Math.min(this.nMinSize,Q.nSize||this.nMinSize),this.nMaxSize=Math.max(this.nMaxSize,Q.nSize||this.nMaxSize),this.nSumSize+=Q.nSize);Q.nValue100&&(this.nSum100+=Q.nValue100);if(this.activeTheme.szFlag.match(/AGGREGATE/)&&this.activeTheme.szFlag.match(/CATEGORICAL/))for(y=
0;y<this.partsA.length;y++)this.partsA[y].nCount+=Q.nValuesA[y]?1:0,this.partsA[y].nSum+=Q.nValuesA[y]||0,this.nSum+=Q.nValuesA[y],this.nExactCount++,this.exactSizeA[y]+=Q.nSize||1;else if(this.activeTheme.szFlag.match(/CATEGORICAL/))for(xa=0;xa<Q.nValuesA.length;xa++)for(y=0;y<this.partsA.length;y++){if(Q.nValuesA[xa]==this.partsA[y].min){this.partsA[y].nCount++;this.partsA[y].nSum+=Q.nValuesA[xa];this.nSum+=Q.nValuesA[xa];this.nExactCount++;this.exactSizeA[y]+=Q.nSize||1;break}}else if(this.activeTheme.szFlag.match(/SEQUENCE/)||
this.activeTheme.szFlag.match(/CHART/))for(y=0;y<this.partsA.length;y++)this.partsA[y].nCount++,this.partsA[y].nSum+=Q.nValuesA[y],this.nSum+=Q.nValuesA[y];else if(this.activeTheme.szFlag.match(/CLIP/)&&this.activeTheme.nClipFrames)this.nSum=this.nClipFrames==Q.nValuesA.length?this.nSum+Number(Q.nValuesA[this.nActualFrame]):this.nSum+Number(Q.nValuesA[0]*(this.nClipFrames-this.nActualFrame)/this.nClipFrames+Q.nValuesA[Q.nValuesA.length-1]*this.nActualFrame/this.nClipFrames);else for(xa=0;xa<Q.nValuesA.length;xa++)for(y=
0;y<this.partsA.length;y++)if(Q.nValuesA[xa]<this.partsA[y].max){this.partsA[y].nCount++;this.partsA[y].nSum+=Q.nValuesA[xa];this.nSum+=Q.nValuesA[xa];break}}}if(this.fCancel){this.fShowProgressBar=!1;this.showInfo(!1);clearMessage();return}}}this.nThemeItems===0&&(this.nThemeItems=this.nTested);if(this.szThemes!="generic"&&this.szThemeType!="point")for(var Oa in this.itemA)if((A=map.Tiles.getTileNodes(Oa))&&A.length)for(var aa in A)this.highLightList.addItem(A[aa]),this.highLightList.lock();else this.highLightList.addItem(this.itemA[Oa]),
this.highLightList.lock();this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;clearMessage();if(map.HTMLWindow.ixmaps.htmlgui_onSelection(this.szId))return null;this.showInfo(!0)};Ga.prototype.showInfo=function(x){if(this.nCount===0)displayMessage("Selection: no values found !",1E3),this.remove();else if(this.nSelected===0)displayMessage("Selection is empty !",1E3),this.remove();else if(!this.widgetNode||this.fRedrawInfo){this.fRedrawInfo=!1;var y=this.szId+":display:widget",A=map.Dictionary.getLocalText("Selection");
typeof x=="undefined"||x||(A+=" ("+map.Dictionary.getLocalText("incomplete")+"!)");this.selectionCenter||(this.selectionCenter=map.Scale.mapCanvasCenter);this.widgetNode?(x=this.widgetNode,x.clear()):x=new InfoContainer(map.SVGDocument,map.SVGFixedGroup,y+":movable",this.selectionCenter,new point(-map.Scale.normalX(55),map.Scale.normalY(50)),"fixed|pointer",A);x.frameNode.style.setProperty("fill","#e8e8e8","");A=map.szTextGridStyle;map.szTextGridStyle="firstgray";this.widgetNode=x;x.fClipped=!1;var I=
x.workspaceNode;x.setOnRemove("map.Themes.removeTheme(evt,'"+this.szId+"')");var O=0;if(this.szSelectShape=="activeBuffer"){var ha=map.Themes.activeBuffer.szTitle;var Z=[map.Dictionary.getLocalText("layer"),map.Dictionary.getLocalText("selected by"),map.Dictionary.getLocalText("selected items"),this.szThemesA.length==1?String(map.Layer.listA[this.szThemesA[0]].szLegendName):"(multiple)",String(ha),String(this.nSelected)+" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*
this.nSelected,2))+"%)"],W=Array(3);W[0]="font-weight:bold;fill:#ffffff;";W[1]="font-weight:bold;fill:#ffffff;";W[2]="font-weight:bold;fill:#ffffff;";O+=50}else this.szSelectShape=="queryresult"?(ha=this.szThemes,this.szThemesA.length>1?ha="(multiple)":this.szThemes!="generic"&&(ha=String(map.Layer.listA[this.szThemesA[0]].szLegendName)),Z=[map.Dictionary.getLocalText("layer"),map.Dictionary.getLocalText("selected by"),map.Dictionary.getLocalText("selected items"),ha,this.szSelectQuery,String(this.nSelected)+
" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*this.nSelected,2))+"%)"],W=Array(3),W[0]="font-weight:bold;fill:#ffffff;",W[1]="font-weight:bold;fill:#ffffff;",W[2]="font-weight:bold;fill:#ffffff;",O+=50):(Z=this.szThemes=="generic"?[map.Dictionary.getLocalText("layer"),map.Dictionary.getLocalText("selected items"),"(generic)",String(this.nSelected)+" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*this.nSelected,2))+"%)"]:[map.Dictionary.getLocalText("layer"),
map.Dictionary.getLocalText("selected items"),this.szThemesA.length==1?String(map.Layer.listA[this.szThemesA[0]].szLegendName):"(multiple)",String(this.nSelected)+" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*this.nSelected,2))+"%)"],W=Array(2),W[0]="font-weight:bold;fill:#ffffff;",W[1]="font-weight:bold;fill:#ffffff;",O+=40);var Q=map.Dom.newGroup(I,"");Q.fu.setPosition(map.Scale.normalY(3),map.Scale.normalY(3));createTextGrid(map.SVGDocument,Q,y+":textgrid",Z,2,
11,W,"fill:#bbbbbb;");ha=[];if(this.activeTheme){O+=14;map.Dom.newText(I,map.Scale.normalX(3),map.Scale.normalY(O),"font-family:arial;font-weight:bold;font-size:"+map.Scale.normalY(11)+"px;fill:#555555;pointer-events:none",map.Dictionary.getLocalText("Theme")+": "+this.activeTheme.szTitle);O+=8;Q=map.Dom.newGroup(I,"");Q.fu.setPosition(map.Scale.normalY(3),map.Scale.normalY(O));this.drawDonutText=this.activeTheme.drawDonutText;this.drawTextforOneQuadrant=this.activeTheme.drawTextforOneQuadrant;this.createTextLabel=
this.activeTheme.createTextLabel;if(this.nValuesSumA.length==1){this.addItemValues=this.activeTheme.addItemValues;this.szFieldsA=this.activeTheme.szFieldsA;this.fField100=this.activeTheme.fField100;var xa=this.szFlag;this.szFlag=this.activeTheme.szFlag;this.itemA=[];Z=[];for(W=0;W<this.nOrigValuesSumA.length;W++)Z[W]=this.nOrigValuesSumA[W];this.addItemValues("selection",Z,this.nSum100);this.szFlag=xa;if(this.activeTheme.szFlag.match(/CATEGORICAL/))Z=[map.Dictionary.getLocalText("selected items"),
String(__formatValue(Number(this.nCount,2)))],W=Array(2),W[0]="font-weight:bold;fill:#7996D7;",W[1]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,Q,y+":textgrid",Z,2,11,W),O+=Q.fu.getBox().height/map.Scale.normalX(1)+5;else if(this.activeTheme.szAggregation&&this.activeTheme.szAggregation.match(/sum/)||this.activeTheme.szFlag.match(/SUM/)){if(Z=[map.Dictionary.getLocalText("value of selection"),map.Dictionary.getLocalText("% of total value")," ",map.Dictionary.getLocalText("min"),
map.Dictionary.getLocalText("max"),map.Dictionary.getLocalText("average"),String(__formatValue(Number(this.itemA.selection.nValuesA[0]),2))+" "+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/Number(this.activeTheme.nOrigSumA[0])*100,2))+" %"," ",String(__formatValue(Number(this.nValuesMinA[0]),2))+" "+this.szUnit,String(__formatValue(Number(this.nValuesMaxA[0]),2))+" "+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/this.nCount,2))+" "+this.szUnit],W=Array(12),W[0]="font-weight:bold;fill:#7996D7;",
W[6]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,Q,y+":textgrid",Z,2,11,W),O+=Q.fu.getBox().height/map.Scale.normalX(1)+5,y=map.Dom.newGroup(I,""),ha.push(y),Q=DonutCharts.newChart(map.SVGDocument,y,map.Scale.normalX(55),map.Scale.normalY(55),0,0),Q.setRadInner(0),Q.setRadOuter(map.Scale.normalX(55)),Q.setCenter(map.Scale.normalX(80),map.Scale.normalY(100)),Z=Number(this.nValuesSumA[0])/Number(this.activeTheme.nOrigSumA[0])*100,Q.addPart(Z,map.Scale.normalY(20),
"#ddddee",0,this.formatValue(Z,2)+"%","selection: "+this.formatValue(Z,2)+"% of total value"),Q.addPart(100-Z,map.Scale.normalY(20),"#f8f8ff",0,this.formatValue(100-Z,2)+"%",this.formatValue(100-Z,2)+"%"),Q.realize(),map.Dom.newText(y,map.Scale.normalX(80),map.Scale.normalX(82),"font-size:"+map.Scale.normalX(10)/.66+"px;text-anchor:middle;baseline-shift:-60%;fill:darkgrey;stroke:none;pointer-events:none",this.formatValue(Z,0)+" % of total"),this.activeTheme.szFlag.match(/BUBBLE/)||this.activeTheme.szFlag.match(/SQUARE/)||
this.activeTheme.szFlag.match(/SYMBOL/))this.getOverviewChart=this.activeTheme.getOverviewChart,this.szOverviewChart=this.activeTheme.szOverviewChart,this.drawChart=this.activeTheme.drawChart,this.getOverviewChart&&(Q=map.Dom.newGroup(I,""),y=map.Dom.newGroup(Q,""),ha.push(Q),Q=this.szFlag,this.szFlag=this.activeTheme.szFlag,this.nOrigSumA=this.nOrigValuesSumA,this.nMaxA=this.nValuesMaxA,this.nMinA=this.nValuesMinA,this.szAggregation=this.activeTheme.szAggregation,this.getOverviewChart(y),this.szFlag=
Q,y.fu.scale(1.3,1.3),y.fu.setPosition(map.Scale.normalX(-35),map.Scale.normalY(35)))}else this.fField100?(Z=[map.Dictionary.getLocalText("value of selection")," ",map.Dictionary.getLocalText("min value"),map.Dictionary.getLocalText("max value"),map.Dictionary.getLocalText("mean value"),String(__formatValue(Number(this.itemA.selection.nValuesA[0]),2))+this.szUnit," ",String(__formatValue(Number(this.nValuesMinA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesMaxA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/
this.nCount,2))+this.szUnit],W=Array(10),W[0]="font-weight:bold;fill:#7996D7;",W[5]="font-weight:bold;fill:#000000;font-size:240px;"):this.activeTheme.szFlag.match(/DENSITY/)?(Z=[map.Dictionary.getLocalText("value of selection")," ",map.Dictionary.getLocalText("min value"),map.Dictionary.getLocalText("max value"),map.Dictionary.getLocalText("mean value"),String(__formatValue(Number(this.itemA.selection.nValuesA[0]),2))+this.szUnit," ",String(__formatValue(Number(this.nValuesMinA[0]),2))+this.szUnit,
String(__formatValue(Number(this.nValuesMaxA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/this.nCount,2))+this.szUnit],W=Array(10),W[0]="font-weight:bold;fill:#7996D7;",W[5]="font-weight:bold;fill:#000000;font-size:240px;"):(Z=[map.Dictionary.getLocalText("mean value"),map.Dictionary.getLocalText(" "),map.Dictionary.getLocalText("min value"),map.Dictionary.getLocalText("max value"),String(__formatValue(Number(this.nValuesSumA[0])/this.nCount,2))+this.szUnit,map.Dictionary.getLocalText(" "),
String(__formatValue(Number(this.nValuesMinA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesMaxA[0]),2))+this.szUnit],W=Array(8),W[0]="font-weight:bold;fill:#7996D7;",W[4]="font-weight:bold;fill:#000000;font-size:240px;"),createTextGrid(map.SVGDocument,Q,y+":textgrid",Z,2,11,W),O+=Q.fu.getBox().height/map.Scale.normalX(1)+5;this.getOverviewChart=this.activeTheme.getOverviewChart;this.szOverviewChart=this.activeTheme.szOverviewChart;if(this.activeTheme.colorScheme.length>2||this.activeTheme.szFlag.match(/CATEGORICAL/)||
!this.activeTheme.szFlag.match(/CHART/)&&!this.activeTheme.szFlag.match(/DOMINANT/))this.szOverviewChart=this.nOrigSumA.length>5?"BAR":"PIE";this.szOverviewChart&&(y=map.Dom.newGroup(I,""),ha.push(y),this.getOverviewChart(y),this.szOverviewChart.match(/PIE/)&&this.activeTheme.szAggregation.match(/sum/)&&(this.szOverviewChart+="|PERCENTOFVALUE",y=map.Dom.newGroup(I,""),ha.push(y),this.getOverviewChart(y)));!this.activeTheme.szFlag.match(/CHART/)||this.activeTheme.szAggregation&&this.activeTheme.szAggregation.match(/sum/)||
(this.getOverviewChart=this.activeTheme.getOverviewChart,this.szOverviewChart=null,this.drawChart=this.activeTheme.drawChart,this.getOverviewChart&&(Q=map.Dom.newGroup(I,""),y=map.Dom.newGroup(Q,""),ha.push(Q),Q=this.szFlag,this.szFlag=this.activeTheme.szFlag,this.nOrigSumA=this.nOrigValuesSumA,this.nMaxA=this.nValuesMaxA,this.nMinA=this.nValuesMinA,this.nOverrideMax=this.activeTheme.nMax,this.szAggregation=this.activeTheme.szAggregation,this.getOverviewChart(y),this.szFlag=Q,this.activeTheme.szFlag.match(/BAR/)?
(y.fu.scale(2.5,2.5),y.fu.setPosition(map.Scale.normalX(55),map.Scale.normalY(65))):(y.fu.scale(1.3,1.3),y.fu.setPosition(map.Scale.normalX(-35),map.Scale.normalY(35))),Q=this.szFlag,this.szFlag=this.activeTheme.szFlag,this.szOverviewChart+="|PERCENTOFVALUE",y=map.Dom.newGroup(I,""),ha.push(y),this.getOverviewChart(y),this.szFlag=Q))}else{if(this.activeTheme.szAggregation.match(/sum/)||this.activeTheme.szFlag.match(/SUM/))xa=this.nSum100?this.nSum100:this.activeTheme.szFlag.match(/CATEGORICAL/)?this.nExactCount:
this.nSum,Z=this.activeTheme.nSum100?this.activeTheme.nSum100:this.activeTheme.szFlag.match(/CATEGORICAL/)?this.activeTheme.nExactCount:this.activeTheme.nSum,Z=[map.Dictionary.getLocalText("total of selection"),String(__formatValue(xa,2))+" ("+String(__formatValue(Number(xa)/Number(Z)*100,2))+" %)"],W=Array(2),W[0]="font-weight:bold;fill:#7996D7;",W[1]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,Q,y+":textgrid",Z,2,11,W),O+=Q.fu.getBox().height/map.Scale.normalX(1)+
5;this.nSum100&&(xa=this.nSum100,this.activeTheme.szFlag.match(/DOMINANT/)||this.activeTheme.szAggregation.match(/sum/)||(xa/=this.nSelected),Z=this.activeTheme.nSum100,Z=[map.Dictionary.getLocalText("total of selection"),String(__formatValue(xa,2))+" ("+String(__formatValue(Number(xa)/Number(Z)*100,2))+" %)"],W=Array(2),W[0]="font-weight:bold;fill:#7996D7;",W[1]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,Q,y+":textgrid",Z,2,11,W),O+=Q.fu.getBox().height/map.Scale.normalX(1)+
5);this.drawChart=this.activeTheme.drawChart;this.getOverviewChart=this.activeTheme.getOverviewChart;this.szOverviewChart=this.activeTheme.szOverviewChart;if(this.activeTheme.szFlag.match(/CATEGORICAL/)||!this.activeTheme.szFlag.match(/CHART/)&&!this.activeTheme.szFlag.match(/DOMINANT/))this.szOverviewChart="PIE";this.nOrigSumA=this.nOrigValuesSumA;this.nMaxA=this.nValuesMaxA;this.nMinA=this.nValuesMinA;xa=this.szFlag;this.szFlag=this.activeTheme.szFlag;this.szAggregation=this.activeTheme.szAggregation;
this.szOverviewChart?(y=map.Dom.newGroup(I,""),ha.push(y),this.getOverviewChart(y),this.szOverviewChart.match(/PIE/)&&this.activeTheme.szAggregation.match(/sum/)&&(this.szOverviewChart+="|PERCENTOFVALUE",y=map.Dom.newGroup(I,""),ha.push(y),this.getOverviewChart(y))):(y=map.Dom.newGroup(I,""),this.nMin=this.activeTheme.nMin,this.nMax=this.activeTheme.nMax,Q=1.8,this.szFlag.match(/DOMINANT/)&&(Q=1.8),this.drawColorSchemeLegend=this.activeTheme.drawColorSchemeLegend,this.nOrigSumA=this.activeTheme.nOrigSumA,
this.nSum=this.activeTheme.nSum,this.szField100=this.activeTheme.szField100,this.drawColorSchemeLegend(y,"test").fu.scale(.9/Q,.9/Q),I=map.Dom.getBox(y),I.width>0&&I.height>0&&(y.fu.scale(Q,Q),y.fu.setPosition(map.Scale.normalX(10)-I.x*Q,map.Scale.normalY(O)+map.Scale.normalY(5)-I.y*Q),map.Dom.newText(y,I.x,I.y+I.height+map.Scale.normalX(6),"font-family:Arial;font-style:italic;font-size:"+map.Scale.normalY(6)+"px;fill:#888888;pointer-events:none",this.activeTheme.fField100||this.activeTheme.szAggregation.match(/sum/)?
map.Dictionary.getLocalText("* summary over selected area"):map.Dictionary.getLocalText("* arithmetic mean over selected area"))))}this.szFlag=xa}__formatValue(100/this.nThemeItems*this.nSelected,2);W=map.Scale.normalX(O);var Aa=O=0;for(y=xa=I=0;y<ha.length;y++)Q=ha[y],Q.fu.scale(.8,.8),Z=Q.fu.getBox(),Aa=Math.min(Aa,Z.y),I=Math.max(I,Z.width);W=W-Aa+40;for(y=0;y<ha.length;y++)Q=ha[y],Z=Q.fu.getBox(),y===0?O=map.Scale.normalX(2)-0:y%2===0&&(W+=map.Scale.normalX(20)+xa,O=map.Scale.normalX(2)-Z.x,xa=
0),xa=Math.max(xa,Z.height),Q.fu.setPosition(O,W),O+=I-map.Scale.normalX(10);x.reformat();map.szTextGridStyle=A}};Ga.prototype.markClass=function(x){};Ga.prototype.unmarkClass=function(x){};Ga.prototype.remove=function(x){this.parent.removeTheme(x,this.szId)};Ga.prototype.removeElements=function(x){this.markGroup&&(this.markGroup.style.setProperty("display","none",""),setTimeout("map.Dom.removeElementById('"+this.markGroup.getAttributeNS(null,"id")+"')",1E4));try{this.mapTool.remove()}catch(y){}this.highLightList.unlock();
this.highLightList.removeAll()};Ga.prototype.getItemNodes=function(x){return[]};Ga.prototype.getNodeArea=function(x){return this.nSelectedArea?this.nSelectedArea/1E6:1};ixMap.Selections.prototype.selectItemByPosition=function(x,y){x=map.Themes.getTheme(x);y=map.Scale.getMapPositionOfLatLon(y.lat,y.lng);for(var A in x.itemA){x=map.SVGDocument.getElementById(A).childNodes;for(var I=0;I<x.length;I++){var O=map.Api.getShapePoints(x.item(I));if(t(y,O))return A}}return null};ixMap.Selections.prototype.selectItemByBoundingBox=
function(x,y){var A=map.Themes.getTheme(x);x=map.Scale.getMapPositionOfLatLon(y[0].lat,y[0].lng);y=map.Scale.getMapPositionOfLatLon(y[1].lat,y[1].lng);let I=[];for(var O in A.itemA){A=map.SVGDocument.getElementById(O).childNodes;for(var ha=0;ha<A.length;ha++){var Z=map.Api.getShapePoints(A.item(ha)),W;for(W in Z){Z[W].x>x.x&&Z[W].x<y.x&&Z[W].y<x.y&&Z[W].y>y.y&&I.push(O);break}}}return I}})();(function(){function Ga(aa,ca,X,ba,sa,ua){this.targetDocument=window.document;this.targetGroup=ca;this.mX=isNaN(X)?0:X;this.mY=isNaN(ba)?0:ba;this.nRadOuter=isNaN(sa)?0:sa;this.nRadInner=isNaN(ua)?0:ua;this.szStyle="flat";this.szLine=null;this.nLineWidth=1;this.partsA=[]}function t(aa,ca,X,ba){aa=ca.createElementNS("http://www.w3.org/2000/svg",aa);X.appendChild(aa);for(var sa in ba)aa.setAttribute(sa,ba[sa]);return aa}function H(aa,ca,X,ba,sa,ua,S,ja,pa,Ja,Ba,d,a,g,b,r,n){r==null&&(r=0);var v=ja<
pa?(ja+pa)/2:Math.max(360,(ja+pa+360)/2);var c=Math.sin(v/180*Math.PI);v=-Math.cos(v/180*Math.PI);X+=r*c;ba+=r*v;b==null&&(b="3D");Ja==null&&(Ja="#ffff00");Ba==null&&(Ba=ColorScheme.getDerivateColor(Ja,.7));d==null&&(d=ColorScheme.getDerivateColor(Ja,.7));a==null&&(a=ColorScheme.getBorderColor(Ja));ca=b.match(/SILENT/)?t("g",aa,ca,{}):t("g",aa,ca,{onmouseover:"DonutCharts.partOver(evt)",onmouseout:"DonutCharts.partOut(evt)",onmousedown:"DonutCharts.partDown(evt)",onmouseup:"DonutCharts.partUp(evt)"});
if(ja<0||pa<0||ja==pa)return ca;t("rect",aa,ca,{id:"extractPoint",x:c*sa/3,y:v*sa/3,width:0,height:0,style:"fill:none;stroke:none"});b.match(/3D/)&&(ja>pa?(x(aa,ca,X,ba,sa,ua,S,ja,360,Ba,"none",0),x(aa,ca,X,ba,sa,ua,S,0,pa,Ba,"none",0)):x(aa,ca,X,ba,sa,ua,S,ja,pa,Ba,a,g));b.match(/3D/)&&ja>180&&(r=""+Aa(X,ba-S,sa,ja),r+=Oa(X,ba-S,ua,ja),r+=Oa(X,ba,ua,ja),r+=Oa(X,ba,sa,ja),r+=Oa(X,ba-S,sa,ja),t("path",aa,ca,{d:r,style:"stroke:"+a+";fill:"+d+";stroke-width:"+g+";"}));b.match(/3D/)&&pa<180&&(r=""+Aa(X,
ba-S,sa,pa),r+=Oa(X,ba-S,ua,pa),r+=Oa(X,ba,ua,pa),r+=Oa(X,ba,sa,pa),r+=Oa(X,ba-S,sa,pa),t("path",aa,ca,{d:r,style:"stroke:"+a+";fill:"+d+";stroke-width:"+g+";"}));b.match(/3D/)&&(ja>pa?(y(aa,ca,X,ba,sa,ua,S,ja,360,Ba,"none",0),y(aa,ca,X,ba,sa,ua,S,0,pa,Ba,"none",0)):y(aa,ca,X,ba,sa,ua,S,ja,pa,Ba,a,g));pa-ja>=360?(r=""+Aa(X,ba-S,sa,ja),r+=Q(X,ba-S,sa,ja,pa,n),r+=Aa(X,ba-S,ua,pa),ua&&(r+=xa(X,ba-S,ua,pa,ja))):(r=""+Aa(X,ba-S,sa,ja),r+=Q(X,ba-S,sa,ja,pa,n),r+=Oa(X,ba-S,ua,pa),ua&&(r+=xa(X,ba-S,ua,pa,
ja)),r+=Oa(X,ba-S,sa,ja));t("path",aa,ca,{d:r,style:"stroke:"+a+";fill:"+Ja+";stroke-width:"+g+";"});return ca}function x(aa,ca,X,ba,sa,ua,S,ja,pa,Ja,Ba,d){ja>90&&ja<270&&pa<270||(sa=""+Aa(X,ba-S,ua,ja),sa+=Q(X,ba-S,ua,ja,pa),sa+=Oa(X,ba,ua,pa),sa+=xa(X,ba,ua,pa,ja),sa+=Oa(X,ba-S,ua,ja),t("path",aa,ca,{d:sa,style:"stroke:"+Ba+";fill:"+Ja+";stroke-width:"+d+";"}))}function y(aa,ca,X,ba,sa,ua,S,ja,pa,Ja,Ba,d){ua=Math.max(ja,90);pa=Math.min(pa,270);ua>pa||(ja=""+Aa(X,ba-S,sa,ua),ja+=Q(X,ba-S,sa,ua,pa),
ja+=Oa(X,ba,sa,pa),ja+=xa(X,ba,sa,pa,ua),ja+=Oa(X,ba-S,sa,ua),t("path",aa,ca,{d:ja,style:"stroke:"+Ba+";fill:"+Ja+";stroke-width:"+d+";"}))}function A(aa){var ca=Number(aa.currentTarget.firstChild.getAttributeNS(null,"x")),X=Number(aa.currentTarget.firstChild.getAttributeNS(null,"y"));aa.currentTarget.setAttribute("transform","translate("+ca/25+","+X/25+")");try{eval(aa.currentTarget.getAttribute("onover"))}catch(ba){}}function I(aa){aa.currentTarget.setAttribute("transform","translate(0,0)");try{eval(aa.currentTarget.getAttribute("onout"))}catch(ca){}}
function O(aa){var ca=Number(aa.currentTarget.firstChild.getAttributeNS(null,"x")),X=Number(aa.currentTarget.firstChild.getAttributeNS(null,"y"));X+=map.Scale.normalY(.1);aa.currentTarget.setAttribute("transform","translate("+ca/5+","+X/5+")")}function ha(aa){var ca=Number(aa.currentTarget.firstChild.getAttributeNS(null,"x")),X=Number(aa.currentTarget.firstChild.getAttributeNS(null,"y"));aa.currentTarget.setAttribute("transform","translate("+ca/5+","+X/5+")")}function Z(aa){if(aa.firstChild){var ca=
Number(aa.firstChild.getAttributeNS(null,"x")),X=Number(aa.firstChild.getAttributeNS(null,"y"));if(ca&&X)return aa.setAttribute("transform","translate("+ca+","+X+")"),!0}return!1}function W(aa){if(aa.firstChild){var ca=Number(aa.firstChild.getAttributeNS(null,"x")),X=Number(aa.firstChild.getAttributeNS(null,"y"));if(ca&&X)return aa.setAttribute("transform","translate(0,0)"),!0}return!1}function Q(aa,ca,X,ba,sa,ua){var S,ja=" ";ba%=360;if(ba>sa)return ja+=Q(aa,ca,X,ba,360,ua),ja+=Q(aa,ca,X,0,sa,ua);
for(S=1;S<=8;S++)if(!(ba>S*45||sa<(S-1)*45)){var pa=Math.max(ba,(S-1)*45);var Ja=Math.min(sa,S*45);if(pa!=Ja){pa>180&&(pa=360-pa);pa>90&&(pa=180-pa);pa>45&&(pa=90-pa);Ja>180&&(Ja=360-Ja);Ja>90&&(Ja=180-Ja);Ja>45&&(Ja=90-Ja);var Ba=Math.PI*pa/180;var d=Math.PI*Ja/180;var a=X*Math.sin(Ba);var g=X*Math.cos(Ba);Ja=X*Math.sin(d);pa=X*Math.cos(d);a=g+Math.tan(Ba)*a;g=pa+Math.tan(d)*Ja;d=(g-a)/(Math.tan(d)-Math.tan(Ba));Ba=-Math.tan(Ba)*d+a;d*=ua||1;Ba*=ua||1;switch(S){case 1:var b=Ja;var r=d;var n=-pa;
var v=-Ba;break;case 2:b=pa;r=Ba;n=-Ja;v=-d;break;case 3:b=pa;r=Ba;n=Ja;v=d;break;case 4:b=Ja;r=d;n=pa;v=Ba;break;case 5:b=-Ja;r=-d;n=pa;v=Ba;break;case 6:b=-pa;r=-Ba;n=Ja;v=d;break;case 7:b=-pa;r=-Ba;n=-Ja;v=-d;break;case 8:b=-Ja,r=-d,n=-pa,v=-Ba}ja+="Q"+String(aa+r)+","+String(ca+v)+" "+String(aa+b)+","+String(ca+n)}}return ja}function xa(aa,ca,X,ba,sa){var ua="";ba=(""+Q(aa,ca,X,sa,ba)).split("Q");for(var S=ba.length-1;S>0;S--)for(var ja=ba[S].split(" "),pa=1;pa>=0;pa--)if(S!=ba.length-1||pa!=
1)ua=pa===0?ua+(" Q"+ja[pa]):ua+(" "+ja[pa]);sa=Math.PI*sa/180;return ua+=" "+String(aa+X*Math.sin(sa))+","+String(ca+-(X*Math.cos(sa)))}function Aa(aa,ca,X,ba){ba=Math.PI*ba/180;return"M"+String(aa+X*Math.sin(ba))+","+String(ca+-(X*Math.cos(ba)))}function Oa(aa,ca,X,ba){ba=Math.PI*ba/180;return"L"+String(aa+X*Math.sin(ba))+","+String(ca+-(X*Math.cos(ba)))}Ga.prototype.setCenter=function(aa,ca){this.mX=aa;this.mY=ca};Ga.prototype.setRadOuter=function(aa){this.nRadOuter=isNaN(aa)?0:aa};Ga.prototype.setRadInner=
function(aa){this.nRadInner=isNaN(aa)?0:aa};Ga.prototype.setStyle=function(aa){this.szStyle=aa};Ga.prototype.addStyle=function(aa){this.szStyle+="|"+aa};Ga.prototype.setLine=function(aa){this.szLine=aa};Ga.prototype.setLineWidth=function(aa){this.nLineWidth=aa};Ga.prototype.setMaxValue=function(aa){this.nMaxValue=aa};Ga.prototype.setNormalSizeValue=function(aa){this.nNormalSizeValue=aa};Ga.prototype.addPart=function(aa,ca,X,ba,sa,ua,S,ja){this.partsA[this.partsA.length]={nPercent:aa,nInfoValue:aa,
nHeight:ca,color:X,nOffset:ba,szText:sa,szInfo:ua,szOver:S,szOut:ja};return this.partsA[this.partsA.length-1]};Ga.prototype.realize=function(){var aa,ca=360,X=this.partsA[0],ba=0,sa=this.partsA.length-1;this.donutPartsA=[];for(var ua=!1,S=0;S<this.partsA.length;S++)this.partsA[S].nPercent>0&&(this.szStyle.match(/BIGTOTOP/)&&this.partsA[S].nPercent>ba&&(X=this.partsA[S],ba=this.partsA[S].nPercent),ua=!0);if(ua||this.szStyle.match(/AUTOCOMPLETE/)){var ja=aa=0,pa=0,Ja=ua=ba=0;if(this.szStyle.match(/VOLUME/)){for(S=
0;S<this.partsA.length;S++)ja+=this.partsA[S].nPercent,aa+=Math.sqrt(this.partsA[S].nPercent);aa=Math.sqrt(this.nMaxValue*this.partsA.length);for(S=0;S<this.partsA.length;S++)this.partsA[S].nPercent=100/aa*Math.sqrt(this.partsA[S].nPercent),this.szStyle.match(/VOLUME/)&&(this.partsA[S].nHeight*=this.partsA[S].nPercent/25);pa=100/aa*Math.sqrt(this.nMaxValue||100);ba=100/aa*Math.sqrt(this.nMaxValue/4||50);ua=100/aa*Math.sqrt(this.nMaxValue/2||50);Ja=100/aa*Math.sqrt(this.nMaxValue/4*3||50)}if(this.szStyle.match(/STARBURST/)){for(S=
0;S<this.partsA.length;S++)ja+=this.partsA[S].nPercent,aa+=Math.sqrt(this.partsA[S].nPercent);pa=this.nMaxValue||100;ba=this.nMaxValue/4||50;ua=this.nMaxValue/2||50;Ja=this.nMaxValue/4*3||50}else{for(S=0;S<this.partsA.length;S++)ja+=this.partsA[S].nPercent;if(ja!=100)if(this.szStyle.match(/AUTOCOMPLETE/)&&ja<100)this.addPart(Math.floor((100-ja)*1E5)/1E5,this.partsA[0]?this.partsA[0].nHeight:0,this.szNoDataColor||"#eeeeee",0,"");else for(S=0;S<this.partsA.length;S++)this.partsA[S].nPercent=this.partsA[S].nPercent/
ja*100}if(this.szStyle.match(/SYMMETRIC/))if(this.szStyle.match(/STARBURST/))ca=360-Math.floor(360/this.partsA.length/2);else if(this.szStyle.match(/BIGTOTOP/)){ca=360;for(S=0;S<this.partsA.length&&this.partsA[S]!=X;S++)ca-=this.partsA[S].nPercent<100?Math.floor(3.6*this.partsA[S].nPercent):0;ca-=this.partsA[S].nPercent<100?Math.floor(1.8*X.nPercent):0}else this.partsA[0].nPercent<100&&(ca=360-Math.floor(1.8*this.partsA[0].nPercent));this.szStyle.match(/HALF/)&&(ca=270);this.szStyle.match(/HALFPLUS10/)&&
(ca=260);this.szStyle.match(/HALFMINUS10/)&&(ca=280);this.szStyle.match(/HALFPLUS20/)&&(ca=250);this.szStyle.match(/HALFMINUS20/)&&(ca=290);ja=this.szStyle.match(/HALF/)?180:360;ja=this.szStyle.match(/HALFPLUS10/)?200:ja;ja=this.szStyle.match(/HALFMINUS10/)?160:ja;ja=this.szStyle.match(/HALFPLUS20/)?220:ja;ja=this.szStyle.match(/HALFMINUS20/)?140:ja;var Ba=0,d=0;this.szStyle.match(/STARBURST/)&&(Ba=ja/this.partsA.length,this.nRadOuter+=this.nRadInner,this.szStyle.match(/XLRAYS/)?(Ba=Math.min(ja/4,
ja/this.partsA.length),d=Ba*.1*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/LRAYS/)?(Ba=Math.min(ja/4,ja/this.partsA.length),d=Ba*.2*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/XSRAYS/)?(Ba=Math.min(ja/12,ja/this.partsA.length),d=Ba*.4*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/SRAYS/)?(Ba=Math.min(ja/10,ja/this.partsA.length),d=Ba*.33*(this.szStyle.match(/HALF/)?
.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/RAYS/)&&(Ba=ja/this.partsA.length,d=Ba*.35*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)));for(S=this.nRadOuterMaxR=this.nRadOuterMaxL=0;S<this.partsA.length;S++)this.szStyle.match(/STARBURST/)||(Ba=this.partsA[S].nPercent/100*ja,d=0),aa=ca%360,ca=aa+Ba,ca>360&&(ca%=360),this.szStyle.match(/DIRECTION/)?this.donutPartsA[S]=this.partsA[S].nAngle?{nStartAngle:this.partsA[S].nAngle-1,nEndAngle:this.partsA[S].nAngle+
1,color:this.partsA[S].color,nHeight:this.partsA[S].nHeight,nOffset:this.partsA[S].nOffset}:{}:this.szStyle.match(/DIRECTED/)?this.donutPartsA[S]=this.partsA[S].nAngle?{nStartAngle:this.partsA[S].nAngle-10,nEndAngle:this.partsA[S].nAngle+10,color:this.partsA[S].color,nHeight:this.partsA[S].nHeight,nOffset:this.partsA[S].nOffset}:{}:this.donutPartsA[S]={nStartAngle:aa+d,nEndAngle:ca-d,color:this.partsA[S].color,nHeight:this.partsA[S].nHeight,nOffset:this.partsA[S].nOffset},this.szStyle.match(/3D/)||
(this.donutPartsA[S].nHeight=0),this.szStyle.match(/STARBURST/)&&(X=this.nMaxValue/(this.nNormalSizeValue||this.nMaxValue)*2.14,this.donutPartsA[S].nRadOuter=Math.max(1,this.nRadInner+Math.sqrt(this.partsA[S].nPercent)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*X)),aa<=180&&ca>=180&&(sa=S),aa<=180?this.nRadOuterMaxR=Math.max(this.nRadOuterMaxR,this.donutPartsA[S].nRadOuter):this.nRadOuterMaxL=Math.max(this.nRadOuterMaxL,this.donutPartsA[S].nRadOuter),this.partsA[S].nOpacity&&(this.donutPartsA[S].nOpacity=
this.partsA[S].nOpacity);this.szStyle.match(/STARBURST/)&&this.szStyle.match(/POLAR/)&&(X=this.nMaxValue/(this.nNormalSizeValue||this.nMaxValue)*2.14,ca=Math.max(1,this.nRadInner+Math.sqrt(pa)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*X),ca=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,ca,"fill:white;fill-opacity:0.25;stroke:#444444;stroke-width:1px;"),ca.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*.75)+"-"+String((this.nMaxValue||100)*1)),ca=
Math.max(1,this.nRadInner+Math.sqrt(Ja)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*X),ca=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,ca,"fill:none;stroke:#444444;stroke-width:3px;stroke-dasharray:50 50"),ca.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*.5)+"-"+String((this.nMaxValue||100)*.75)),ca=Math.max(1,this.nRadInner+Math.sqrt(ua)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*X),ca=map.Dom.newShape("circle",this.targetGroup,
this.mX,this.mY,ca,"fill:none;stroke:#444444;stroke-width:1px;"),ca.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*.25)+"-"+String((this.nMaxValue||100)*.5)),ca=Math.max(1,this.nRadInner+Math.sqrt(ba)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*X),ca=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,ca,"fill:none;stroke:#444444;stroke-width:3px;stroke-dasharray:50 50"),ca.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*0)+"-"+String((this.nMaxValue||
100)*.25)));if(this.szStyle.match(/HALF/))for(sa=this.donutPartsA.length,S=0;S<sa;S++)this.donutPartsA[S].nEndAngle>270&&(this.donutPartsA.push(this.donutPartsA.splice(S,1)[0]),this.partsA.push(this.partsA.splice(S,1)[0]),sa--,S=-1);this.frameGroup=t("g",this.targetDocument,this.targetGroup,{});for(S=0;S<sa;S++)ca=H(this.targetDocument,this.frameGroup,this.mX,this.mY,this.donutPartsA[S].nRadOuter?this.donutPartsA[S].nRadOuter:this.nRadOuter,this.nRadInner,this.donutPartsA[S].nHeight,this.donutPartsA[S].nStartAngle,
this.donutPartsA[S].nEndAngle,this.donutPartsA[S].color,null,null,this.szLine,this.nLineWidth*(this.donutPartsA[S].nRadOuter?this.donutPartsA[S].nRadOuter:this.nRadOuter)/300,this.szStyle,this.donutPartsA[S].nOffset,this.nBow),this.szStyle.match(/SILENT/)||(ca.setAttributeNS(szMapNs,"tooltip",this.partsA[S].szInfo?this.partsA[S].szText+this.partsA[S].szInfo:Math.round(this.partsA[S].nInfoValue*10)/10+" % "),this.partsA[S].szOver&&ca.setAttributeNS(szMapNs,"onover",this.partsA[S].szOver),this.partsA[S].szOut&&
ca.setAttributeNS(szMapNs,"onout",this.partsA[S].szOut)),this.donutPartsA[S].nOpacity&&(ca.style.setProperty("stroke-opacity","0.6",""),ca.style.setProperty("fill-opacity","0.1","")),this.donutPartsA[S].objNode=ca;for(S=this.donutPartsA.length-1;S>=sa;S--)ca=H(this.targetDocument,this.frameGroup,this.mX,this.mY,this.donutPartsA[S].nRadOuter?this.donutPartsA[S].nRadOuter:this.nRadOuter,this.nRadInner,this.donutPartsA[S].nHeight,this.donutPartsA[S].nStartAngle,this.donutPartsA[S].nEndAngle,this.donutPartsA[S].color,
null,null,this.szLine,this.nLineWidth*(this.donutPartsA[S].nRadOuter?this.donutPartsA[S].nRadOuter:this.nRadOuter)/300,this.szStyle,this.donutPartsA[S].nOffset,this.nBow),this.szStyle.match(/SILENT/)||(ca.setAttributeNS(szMapNs,"tooltip",this.partsA[S].szInfo?this.partsA[S].szText+this.partsA[S].szInfo:Math.round(this.partsA[S].nInfoValue*10)/10+" % "),this.partsA[S].szOver&&ca.setAttributeNS(szMapNs,"onover",this.partsA[S].szOver),this.partsA[S].szOut&&ca.setAttributeNS(szMapNs,"onout",this.partsA[S].szOut)),
this.donutPartsA[S].nOpacity&&(ca.style.setProperty("stroke-opacity","0.6",""),ca.style.setProperty("fill-opacity","0.1","")),this.donutPartsA[S].objNode=ca;this.szStyle.match(/3D/)&&this.frameGroup.setAttributeNS(null,"transform","matrix(1 0 0 0.5 0 0)")}else t("circle",this.targetDocument,this.targetGroup,{id:"emptypie",cx:this.mX,cy:this.mY,r:this.nRadOuter,style:"fill:none;stroke:gray"}),ca=this.targetDocument,sa=t("text",ca,this.targetGroup,{x:String(this.mX),y:String(this.mY),style:"fill:gray;font-size:"+
this.nRadOuter/5+";text-anchor:middle;"}),ca=ca.createTextNode("Pie error: no values !"),sa.appendChild(ca)};Ga.prototype.getTextPosition=function(aa){if(!this.donutPartsA[aa])return null;var ca=this.donutPartsA[aa].nRadOuter?this.donutPartsA[aa].nRadOuter:this.nRadOuter;var X=this.donutPartsA[aa].nStartAngle;var ba=this.donutPartsA[aa].nEndAngle;if(X==ba)return null;ba=X<ba?(X+ba)/2:Math.min(360,(X+ba+360)/2)%360;X=ba<180?this.nRadOuterMaxR?this.nRadOuterMaxR+(this.nRadOuterMaxL>this.nRadOuterMaxR?
Math.min(this.nRadOuterMaxR,(this.nRadOuterMaxL-this.nRadOuterMaxR)/2):0):this.nRadOuter:this.nRadOuterMaxL?this.nRadOuterMaxL+(this.nRadOuterMaxR>this.nRadOuterMaxL?Math.min(this.nRadOuterMaxL,(this.nRadOuterMaxR-this.nRadOuterMaxL)/2):0):this.nRadOuter;return{x:Math.sin(ba/180*Math.PI)*X*1.1,y:-Math.cos(ba/180*Math.PI)*X*1.1-this.donutPartsA[aa].nHeight,lx:Math.sin(ba/180*Math.PI)*ca,ly:-Math.cos(ba/180*Math.PI)*ca-this.donutPartsA[aa].nHeight}};window.DonutCharts=new function(){this.newChart=function(aa,
ca,X,ba,sa,ua){return new Ga(aa,ca,X,ba,sa,ua)};this.partOver=A;this.partOut=I;this.partDown=O;this.partUp=ha;this.partDrawOut=Z;this.partDrawIn=W}})();
