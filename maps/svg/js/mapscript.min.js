(function(){function Ha(h){k.HTMLWindow&&k.pushInitAction(()=>{k.HTMLWindow.ixmaps.htmlgui_onMapInit(window)});k.Event=new v.Event;k.SVGRootElement.setAttribute("onmouseover","map.Event.defaultMouseOver(evt)");k.SVGRootElement.setAttribute("onmouseout","map.Event.defaultMouseOut(evt)");k.SVGRootElement.setAttribute("onmousedown","map.Event.defaultMouseDown(evt)");k.SVGRootElement.setAttribute("ontouchstart","map.Event.defaultMouseDown(evt)");k.SVGRootElement.setAttribute("onmouseup","map.Event.defaultMouseUp(evt)");
k.SVGRootElement.setAttribute("ontouchend","map.Event.defaultMouseUp(evt);map.Event.defaultMouseClick(evt)");k.SVGRootElement.setAttribute("onmousemove","map.Event.defaultMouseMove(evt)");k.SVGRootElement.setAttribute("ontouchmove","map.Event.defaultMouseUp(evt);map.Event.defaultMouseMove(evt);map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()");k.SVGRootElement.setAttribute("onclick","map.Event.defaultMouseClick(evt)");k.SVGRootElement.setAttribute("onkeydown","map.Event.defaultKeyDown(evt)");k.SVGRootElement.setAttribute("onkeyup",
"map.Event.defaultKeyUp(evt)");typeof k.Event.doDefaultZoom=="function"&&(k.SVGRootElement.addEventListener("SVGZoom",k.Event.doDefaultZoom,!1),k.SVGRootElement.addEventListener("SVGScroll",k.Event.doDefaultPan,!1),k.SVGRootElement.addEventListener("SVGResize",k.Event.doDefaultResize,!1));k.Layer=new v.Layer(h);if(window.ixMap){k.Themes=new v.Themes;try{k.HTMLWindow&&k.HTMLWindow.ixmaps&&k.HTMLWindow.ixmaps.htmlgui_onInitThemes&&k.HTMLWindow.ixmaps.htmlgui_onInitThemes()}catch(r){}}k.antiZoomAndPanList=
new ya(h);k.antiZoomAndPanList.initAntiZoomPattern(h,null);k.antiZoomAndPanList.initAntiZoomSymbols(null,k.SVGDocument.getElementById("symbolstore"));k.antiZoomAndPanList.initAntiZoomStyles(h);k.Layer.initPatternScaling(h,null);k.Zoom=new v.Zoom(k.Scale.initScale);k.Tiles=new v.Tiles;k.Label=new v.Label;k.Viewport=new v.Viewport(h);k.Layer.switchScaleDependentLayer(h);k.Scale.refreshCSSStyles();k.pushAction(()=>{k.Layer.scaleLineDecorations(k.SVGRootElement,1)});try{k.Dom.clearGroup(contextMenu.firstChild)}catch(r){}try{k.HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(w(Math.floor(k.Scale.nTrueMapScale*
k.Scale.nZoomScale)),0,"BLANK"))}catch(r){}try{k.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(k.Zoom.getEnvelopeString(),!0)}catch(r){}try{k.HTMLWindow.ixmaps.htmlgui_queryMapFeatures()}catch(r){}k.fClipMap&&!k.fClipMapDynamic||k.Zoom.removeClipping();k.fPDFEmbed&&(k.Tiles.switchScaleDependentTiles(h),wa());setTimeout(()=>{k.Zoom.init()},1E3);setTimeout(()=>{k.fadeLogo()},1E4);k.Layer.prepareCheckOverlap(h,k.Layer.layerNode);k.fInitializing=!1;(k.Scale.szMapProjection||"").match(/orthographic/i)&&
k.pushInitAction(()=>{try{var r=5;if(k.HTMLWindow&&k.HTMLWindow.ixmaps)try{var n=k.HTMLWindow.ixmaps.getZoom();n!==void 0&&Number.isFinite(n)&&(r=n)}catch(E){}r===5&&k.Scale.nZoomScale&&k.Scale.nZoomScale>0&&(r=Math.max(1,Math.min(20,Math.log2(k.Scale.nZoomScale)+5)));k._allowOrthographicCenter=!0;k.Zoom.doCenterMapToGeoPosition(0,0);k._allowOrthographicCenter=!1;console.log("Early centering orthographic projection: center:",0,0,"zoom:",r);k.Zoom.doCenterMapToGeoBounds(-.1,-.1,.1,.1)}catch(E){console.error("Error in early orthographic projection centering:",
E)}});k.HTMLWindow&&k.pushInitAction(()=>{k.HTMLWindow.ixmaps.htmlgui_onMapReady(window)});k.pushInitAction(()=>{k.showAll()});k.pushInitAction(()=>{nothing()})}function q(){try{typeof k.HTMLWindow.ixmaps.SVGResources_includePath!="undefined"&&setTimeout("loadSVGIncludes(null,'"+k.HTMLWindow.ixmaps.SVGResources_includePath+"')")}catch(h){}}function K(h,r){r?(k.fSVGEmbeded=!0,document.embeds[r]&&(k.SVGDocument=document.embeds[r].getSVGDocument(),k.EmbedHeight=document.embeds[r].height,k.EmbedWidth=
document.embeds[r].width)):k.SVGDocument=h?h.target.ownerDocument:document.getElementById("svg_map_document");k.SVGDocument.getElementById("widgetstore")&&k.SVGDocument.getElementById("widgetstore").childNodes.length>2&&(k.fAllIncluded=!0);window.parent&&window.screen&&window.location||(k.fPDFEmbed=!0);k.fLocalHost=String(window.location).match(/localhost/);u=navigator.appName;navigator.appName.match(/Adobe/)&&navigator.appVersion.match(/6.0x/)?u="Adobe6.0":navigator.appName.match(/Adobe/)&&navigator.appVersion.match(/3.0/)?
u="Adobe3.0":navigator.appName.match(/Opera/)?u="Opera":navigator.appName.match(/Netscape/)&&(u="Netscape");navigator.userAgent&&navigator.userAgent.match(/Chrome/)?u="Chrome":navigator.userAgent&&navigator.userAgent.match(/Firefox/)&&(u="Firefox");(h=k.SVGDocument.getAttribute("xmlns:xmap"))&&h.length>3&&(e=h);k.HTMLWindow=window}function A(h){if(h){h=h.getAttribute("transform");var r=null;if(h&&(r=h.match(H)))return h=r[1].split(" "),[Number(h[0]),Number(h[1]),Number(h[2]),Number(h[3]),Number(h[4]),
parseFloat(h[5])];if(h&&(r=h.match(G)))return h=r[1].split(","),[Number(h[0]),Number(h[1]),Number(h[2]),Number(h[3]),Number(h[4]),Number(h[5])]}return[1,0,0,1,0,0]}function B(h,r,n){if(h&&r.length==6){var E=!0;r.forEach(function(L){isNaN(L)&&(E=!1)});if(E){var F=h.getAttributeNS(null,"transform");r="matrix("+r[0]+" "+r[1]+" "+r[2]+" "+r[3]+" "+r[4]+" "+r[5]+")";F=F?F.split(")"):[];for(var I=0;I<F.length;I++)F[I].length>3&&(F[I].match(/rotate/)||F[I].match(/scale/)||n&&F[I].match(/translate/))&&(r=
r+" "+F[I]+")");h.setAttributeNS(null,"transform",r)}}}function D(h){return h?(h=A(h),new T(Number(h[4]),Number(h[5]))):new T(0,0)}function J(h,r,n){var E=A(h);E[4]=r;E[5]=n;B(h,[E[0],E[1],E[2],E[3],E[4],E[5]])}function N(h){return h?(h=A(h),new T(Number(h[0]),Number(h[3]))):new T(1,1)}function ia(h,r){r||="transform";return h&&(h=h.getAttributeNS(null,r),r=null,h&&(r=h.match(P)))?Number(r[1]):0}function Y(h,r,n){n||="transform";if(h){var E=!1,F="",I=h.getAttributeNS(null,n);I=I?I.split(")"):[];for(var L=
0;L<I.length;L++)I[L].match(/rotate/)?(F=F+" rotate("+r+")",E=!0):I[L].length>3&&(F=F+" "+I[L]+")");E||(F=F+" rotate("+r+")");h.setAttributeNS(null,n,F)}}function W(h){if(h.nodeType!=1)return null;for(this.szId="";this.szId===""&&h.parentNode&&h.nodeType==1;)if(this.szId=h.getAttributeNS(null,"id"),typeof this.szId!="string"||this.szId===""||this.szId.match(/noobject/))h=h.parentNode,this.szId="";this.objNode=h;this.fu=new S(h)}function S(h){this.nodeObj=h}function ma(h,r){if(!h||!r)return null;h=
h.split(";");for(var n,E=0;E<h.length;E++)if(h[E].match(/stroke-width/))n=h[E].split(":"),n[1]=String(parseFloat(n[1])*r),h[E]=n.join(":");else if(h[E].match(/font-size/))n=h[E].split(":"),n[1]=String(parseFloat(n[1])*r)+"px",h[E]=n.join(":");else if(h[E].match(/stroke-dashoffset/))n=h[E].split(":"),n[1]=String(parseFloat(n[1])*r),h[E]=n.join(":");else if(h[E].match(/stroke-dasharray/)){n=h[E].split(":");var F=n[1].split(",");F.length>1?(h[E]=n[0]+":",n=0):(F=n[1].split(" "),h[E]=n[0]+":",n=0);for(;n<
F.length;n++)F[n]=String(parseFloat(F[n])*r),h[E]+=F[n],n<F.length-1&&(h[E]+=",")}return h.join(";")}function ya(h){this.listA=[];this.buildList(h)}function Ua(h){return h==k._activeTheme}function ca(){k._legendIdent&&(k._legendIdent.style.setProperty("display","none",""),k._legendIdent=null);k._activeTheme=null;k.highLightList.removeAll()}function ba(h){return h&&h.length?h.replace(/\\/gi,"\\\\").replace(/"/gi,'\\"'):h}function ka(){l&&clearTimeout(l);k._tooltip&&(k.SVGTltipGroup.fu.clear(),k._tooltip=
null);try{k.HTMLWindow.ixmaps.htmlgui_onTooltipDelete()&&(k.highLightList.unlock(),k.highLightList.removeAll())}catch(h){}}function ha(h,r,n){if(n!="notify"||k.fNotify)if(typeof h!="string"||h.length===0)k.SVGMessageGroup.fu.clear();else{da&&(clearTimeout(da),da=null);h=k.Dictionary.getLocalText(h);if(n!="notify"&&n!="big")if(k.isInitializing())try{k.HTMLWindow.ixmaps.htmlgui_displayInfo(h);return}catch(na){}else try{if(k.HTMLWindow.ixmaps.htmlgui_isInfoDisplay()){k.HTMLWindow.ixmaps.htmlgui_displayInfo(h);
r&&wa(r);return}}catch(na){}if(n=="big")var E=64,F="transparent",I=new T(k.Scale.bBox.width/2+k.Scale.mapPosition.x,k.Scale.normalY(38));else n=="notify"?(E=24,F="flat",I=new T(k.Scale.bBox.width/2+k.Scale.mapPosition.x,k.Scale.mapPosition.y+(k.Scale.normalY(E*2/3)+k.nToolMarginTop))):n=="top"?(E=24,F="flat",I=new T(k.Scale.bBox.width/2+k.Scale.mapPosition.x,k.Scale.mapPosition.y+(k.Scale.normalY(E*2/3)+k.nToolMarginTop))):(E=36,F="flat",I=new T(k.Scale.bBox.width/2+k.Scale.mapPosition.x,k.Scale.bBox.height/
2+k.Scale.mapPosition.y-k.Scale.normalX(E/2)));if(k.SVGDocument&&k.SVGMessageGroup&&(n=="notify"?k.SVGNotifyGroup.fu.clear():k.SVGMessageGroup.fu.clear(),h&&h.length)){var L=null;try{var R=new TextField(null,n=="notify"?k.SVGNotifyGroup:k.SVGMessageGroup,F,E);R.setText(h);L=R.textGroup;var Z=L.fu.getBox();L.fu.setPosition(I.x-Z.width/2,I.y+Z.height/2)}catch(na){L=f(k.SVGDocument,n=="notify"?k.SVGNotifyGroup:k.SVGMessageGroup,"popup_message",h,E);try{Z=L.fu.getBox(),L.fu.setPosition(I.x-Z.width/2,
I.y+Z.height/2)}catch(fa){L.fu.setPosition(I.x-k.Scale.normalX(50),I.y+k.Scale.normalX(10))}}}r&&(n=="notify"?r?(sa&&clearTimeout(sa),sa=setTimeout("clearNotify()",r)):k.SVGNotifyGroup.fu.clear():wa(r))}}function wa(h){da&&!h||za(h||0)}function za(h){if(h)da&&clearTimeout(da),da=setTimeout("do_clearMessage()",h);else{try{k.HTMLWindow.ixmaps.htmlgui_killInfo()}catch(r){}k.SVGMessageGroup.fu.clear()}}function c(h,r,n,E,F,I){k.SVGDocument&&k.SVGMessageGroup&&(n=k.Dom.newGroup(k.SVGMessageGroup,"popup_progressbar"),
n.fu.setPosition(0,0),n.fu.scale(20,20),k.Dom.newShape("rect",n,0,0,k.SVGWidth/r*h,1.5,"fill:#3787D7;stroke:none;"));E&&wa(E)}function b(h){if(typeof console!="undefined"&&typeof console.log!="undefined"){var r=new Date;r=r.getMinutes()+":"+String(r.getSeconds())+"."+String(r.getMilliseconds());console.log("_LOG: time["+r+"] "+h)}}function f(h,r,n,E,F){F||=12;if(h&&r)return h=k.Dom.newGroup(r,n),r=k.Dom.newShape("rect",h,1,1,1,1,"fill:#aaaaaa;opacity:0.5;stroke:none"),n=k.Dom.newShape("rect",h,1,
1,1,1,"fill:#fefeff;stroke:#aaaaaa;stroke-width:"+k.Scale.normalX(.2)),k.Dom.newText(h,0,k.Scale.normalY(F*1.25),"font-family:arial;font-size:"+k.Scale.normalY(F)+"px;fill:"+k.szInfoBodyColor,E),ea=h,Va=n,Sa=r,Ja=F,a(),h}function a(){var h=Ja,r=k.Dom.getBox(ea);Va.setAttributeNS(null,"rx",k.Scale.normalX(4));Va.setAttributeNS(null,"ry",k.Scale.normalX(4));Va.setAttributeNS(null,"x",-k.Scale.normalX(h*.75));Va.setAttributeNS(null,"y",-k.Scale.normalY(1));Va.setAttributeNS(null,"width",r.width+k.Scale.normalX(h*
1.5));Va.setAttributeNS(null,"height",r.height+k.Scale.normalY(h)/2);Sa.setAttributeNS(null,"rx",k.Scale.normalX(4));Sa.setAttributeNS(null,"ry",k.Scale.normalX(4));Sa.setAttributeNS(null,"x",-k.Scale.normalX(h*.75)+k.Scale.normalX(1));Sa.setAttributeNS(null,"y",k.Scale.normalY(1));Sa.setAttributeNS(null,"width",r.width+k.Scale.normalX(h*1.5)+k.Scale.normalX(1.5));Sa.setAttributeNS(null,"height",r.height+k.Scale.normalX(h)/2-k.Scale.normalX(0))}function p(h){k.isIdle();try{typeof h==="function"?h():
(console.warn("doExecuteWithMessage: Executing string via eval. This is unsafe. Please pass a function."),eval(h))}catch(r){alert("error '"+r+"' on: "+h)}}function m(h){if(typeof h=="undefined"||h==null||h.length<2)return null;try{for(var r=[],n=h.split(";"),E=0;E<n.length;E++)if(n[E].length){var F=n[E].split(":");r[F[0]]=F[1]}return r}catch(I){alert("ERROR parsing: "+h)}return null}function w(h,r,n){h=Number(h);if(!isFinite(h)||!isFinite(r)||h===0||h>1E12||h<-1E12)return String(h);k.fDecimalPointComma||
(n+="|BLANK");r||=0;r=Math.max(0,r);if(h>1E-7&&r>0)for(;h.toFixed(r)===0;)r++;h=h.toFixed(r+1);var E=Math.pow(10,r);h=n&&n.match(/CEIL/)?Math.ceil(h*E)/E:n&&n.match(/FLOOR/)?Math.floor(h*E)/E:Math.round(h*E)/E;E=String(h);for(E=E.match(/\./)?E.split(".")[1]:"";E.length<r;)E+="0";r=h<0?"-":"";var F="";h=Math.floor(Math.abs(h));if(!n||!n.match(/NOBREAKS/)){for(var I=1E3;h>I;)I*=1E3;I/=1E3;for(var L,R=" ";I>=1E3;)L=Math.floor(h/I),r+=C(L,F),h%=I,I/=1E3,L&&(F="0",R=n&&n.match(/BLANK/)?" ":"."),r+=R;r+=
C(h,F);r.length&&r!="-"||(r+="0");E.length&&(r+=(n&&n.match(/BLANK/)?".":",")+E)}return r}function C(h,r){r||="";var n="";h<100&&(n+=r);h<10&&(n+=r);return n=h===0?n+r:n+String(h)}function z(){this.szUrlA=[];this.stackA=[];this.nPending=0;this.importSVGFile=function(h,r,n,E){if(this.szUrlA[h]==n)return!1;this.doImportSVGFile(h,r,n,E)};this.push=function(h,r,n,E){this.stackA.push({szUrl:h,svgDocument:r,targetGroup:n,callback:E})};this.pop=function(){if(!this.isWaiting()){var h=this.stackA.shift();
h&&this.doImportSVGFile(h.szUrl,h.svgDocument,h.targetGroup,h.callback)}};this.doImportSVGFile=function(h,r,n,E){function F(I){this.parent=I}this.nPending++;F.prototype.operationComplete=function(I,L,R){this.parent.nPending--;this.parent.pop();L&&I==200&&(this.processImported(L.documentElement),b("SVGLoader: "+h+" (loaded)"))};F.prototype.processImported=function(I){if(h.match(/widget/))for(var L=k.Dom.getAllIds(I),R=0;R<L.length;R++){var Z=k.SVGDocument.getElementById(L[R]);Z&&Z.parentNode.removeChild(Z)}h.match(/pattern/)&&
(n=k.Dom.newGroup(n,String(Math.random())));n.appendChild(I);if(!this.initMenu(n)){this.initCSS(n);this.initScripts(n);h.match(/widget/)&&this.initToolbar(n);h.match(/logo/)&&this.initLogo(n);this.loadScripts(n);try{k.antiZoomAndPanList.initAntiZoomPattern(null,n),k.Layer.initPatternScaling(null,n)}catch(na){}h.match(/symbol/)&&k.Scale.normalizeSymbols(n);h.match(/widget/)&&k.Scale.normalizeButtons(n)}};F.prototype.initMenu=function(I){I=I.getElementsByTagName("menu");if(I.length){for(var L=0;L<I.length;L++){var R=
I.item(L).getAttributeNS(null,"id");(R=k.SVGDocument.getElementById(R))&&R!=I.item(L)&&(R.parentNode.removeChild(R),L--)}return!0}return!1};F.prototype.initToolbar=function(I){try{k.Toolbar.init(),k.Legend.init()}catch(L){}return!0};F.prototype.initLogo=function(I){var L=k.SVGDocument.getElementById("mapbackground:logo");L===null&&(L=k.Dom.newGroup(k.SVGDocument.getElementById("mapbackground"),"mapbackground:logo"));if(L){k.Dom.clearGroup(L);I=I.getElementsByTagName("svg").item(0).childNodes;for(var R=
0;R<I.length;R++)L.appendChild(I.item(R)),R--}return!0};F.prototype.loadScripts=function(I){I=I.getElementsByTagName("script");for(var L=0;L<I.length;L++){var R=I.item(L).getAttributeNS("http://www.w3.org/1999/xlink","href");R&&R.length&&(new t).loadScript(R)}return!0};F.prototype.initScripts=function(I){I=I.getElementsByTagName("script");for(var L=0;L<I.length;L++)if(I.item(L).firstChild){var R=I.item(L).firstChild.nodeValue;try{eval(R)}catch(Z){b("ERROR: could not eval loaded script!")}}return!0};
F.prototype.initCSS=function(I){return I.getElementsByTagName("style").length?(k.SVGDocument.getElementById("mapstyles"),!0):!1};h.length>0&&d(h,new F(this))};this.isWaiting=function(){return this.nPending}}function y(){this.szUrlA=[];this.stackA=[];this.nToLoad=this.nRequest=this.nPending=0;this.importSVGFile=function(h,r,n,E){if(n&&this.szUrlA[h]==n)return!1;this.nRequest++;this.nToLoad++;k.fLoadingSilent?this.doImportSVGFile(h,r,n,E):!k.fLoadMultiTiles&&this.isWaiting()?this.push(h,r,n,E):(ha(k.Dictionary.getLocalText("loading map")),
c(0,1,k.Dictionary.getLocalText("loading map")),this.push(h,r,n,E),setTimeout("__svgLoaderMap.pop()",10));return!0};this.push=function(h,r,n,E){this.isStacked(h,r,n)||this.stackA.push({szUrl:h,svgDocument:r,targetGroup:n,callback:E})};this.pop=function(){if(!this.isWaiting()){var h=this.stackA.shift();h?(c(this.nToLoad-this.nPending-this.stackA.length,this.nToLoad,k.Dictionary.getLocalText("loading map elements")),this.doImportSVGFile(h.szUrl,h.svgDocument,h.targetGroup,h.callback)):this.nToLoad=
this.nRequest=0}};this.isStacked=function(h,r,n){for(var E=0;E<this.stackA.length;E++)if(this.stackA[E].szUrl==h&&this.stackA[E].svgDocument==r&&this.stackA[E].targetGroup==n)return!0;return!1};this.isAnyStacked=function(){return this.stackA.length};this.doImportSVGFile=function(h,r,n,E){function F(I){this.parent=I}if(n&&this.szUrlA[h]==n)return!1;this.szUrlA[h]=n;this.nPending++;F.prototype.operationComplete=function(I,L,R){this.parent.szUrlA[h]=null;this.parent.nPending--;this.parent.nRequest--;
L&&I==200?this.processImported(L.documentElement):ha("error loading map");this.parent.pop()};F.prototype.processImported=function(I){var L=function(R,Z){Z&&R?(R.parentNode.insertBefore(Z,R),R.parentNode.removeChild(R)):Z?Z.parentNode.nodeName=="defs"?k.SVGRootElement.appendChild(Z.parentNode):k.SVGRootElement.appendChild(Z):R&&R.parentNode.removeChild(R)};k.hideAll();L(k.SVGDocument.getElementsByTagName("metadata")[2],I.getElementsByTagName("metadata")[0]);L(k.SVGDocument.getElementById("maplayer"),
I.getElementById("maplayer"));L(k.SVGDocument.getElementById("extension"),I.getElementById("extension"));L(k.SVGDocument.getElementById("mapclipdef"),I.getElementById("mapclipdef"));L(k.SVGDocument.getElementById("mapstyles"),I.getElementById("mapstyles"));(L=I.getElementsByTagName("pattern"))&&L[0]&&(I=I.getElementsByTagName("pattern")[0].parentNode,k.SVGRootElement.appendChild(I));k.Scale=new v.Scale(null);k.Scale.superclass=k;k.Scale.createWidgetStyles();k.Scale.normalizeSymbols(k.SVGDocument.getElementById("symbolstore"));
k.Scale.normalizeButtons(k.SVGDocument.getElementById("widgetstore"));k.Layer=new v.Layer(null);k.Layer.initPatternScaling(null,null);k.Zoom=new v.Zoom(k.Scale.initScale);k.Tiles=new v.Tiles;k.Label=new v.Label;k.Viewport=new v.Viewport;k.Query=new v.Query;k.Layer.switchScaleDependentLayer();k.Scale.refreshCSSStyles();k.HTMLWindow.ixmaps.htmlgui_onMapReady(window);setTimeout("map.showAll()",1E3)};console.log("*** load new map ***");console.log(h);console.log("********************");return h.length>
0?(d(h,new F(this)),!0):!1};this.isWaiting=function(){return this.nPending};this.isLoading=function(){return this.nPending|this.isAnyStacked()}}function O(){this.loaderA=[];this.szSuffix=".js";this.loadedUrlA=[];this.loadingUrlA=[];this.errorUrlA=[]}function t(){this.loadedScripts=[];this.reqCnt=0;this.isLoading=!1;this.finishedCallback=this.errorCallback=null;this.szMessage="... loading ...";this.pool=Ma;this.pool.add(this)}function d(h,r){if(window.getURL)window.getURL(h,r);else if(window.XMLHttpRequest){var n=
function(){E.readyState==4&&r.operationComplete(E.status,E.responseXML,E.responseText)};try{var E=null;E=new XMLHttpRequest;E.open("GET",h,!0);E.onreadystatechange=n;E.send(null)}catch(F){}}else alert("your browser/svg viewer neither supports window.getURL nor window.XMLHttpRequest!")}var e="http://www.medienobjekte.de",g=96,l=null,u="Adobe3.0";typeof printNode=="undefined"&&(window.printNode=function(h){return(new XMLSerializer).serializeToString(h)});var k=null,v=function(){this.fInitializing=!1;
this.Api=this.Viewport=this.Toolbar=this.Legend=this.Themes=this.Query=this.Zoom=this.Tiles=this.Layer=this.Scale=this.Event=null;this.mapRoot="";this.Loader=new z;this.rootGroup=this.SVGDocument=null;this.nNodesCreated=0;this.fObjectPseudoShadow=!0;this.fSVGEmbeded=this.fEmbedScale=!1;this.EmbedHeight=this.EmbedWidth=this.SVGOrigViewBoxString=this.SVGViewBox=this.SVGHeight=this.SVGWidth=this.SVGTempGroup=this.SVGHiddenGroup=this.SVGTltipGroup=this.SVGMenuGroup=this.SVGMessageGroup=this.SVGNotifyGroup=
this.SVGPopupGroup=this.SVGFixedGroup=this.SVGThemeGroup=this.SVGToolsGroup=this.SVGRootElement=this.HTMLWindow=null;this.fTransparentMap=!1;this.fClipMap=!0;this.fAllIncluded=this.fPDFEmbed=this.fZoomByViewer=this.fClipMapDynamic=!1;this.fSwitchByCSS=!0;this.fLocalHost=!1;this.fDynamicTiles=this.fDynamicLayer=this.fLoadIncludes=!0;this.fTilesLoaded=!1;this.fDiscardTiles="delayed";this.fLoadMultiTiles=!0;this.fLoadingSilent=this.fMarkTiles=!1;this.fExecuteSilent=!0;this.fNotify=!1;this.szObjectGroupId=
"mapobjects";this.szShadowFilterId="DropShadowFilterObjects:antizoomandpan";this.szShadowFilterToolsId="DropShadowFilterTools:antizoomandpan";this.szShadowFilterShapeId="DropShadowFilterShape:antizoomandpan";this.fSymbolScalingDynamic=this.fObjectScaling=this.fFeatureScaling=this.fAntiZoomAndPan=!0;this.fFeatureScalingDynamic=!1;this.fCheckLabelOverlap=this.fAdaptLabelToScaling=!0;this.fCheckLabelSpace=!1;this.nCheckLabelSpace=.8;this.fCheckLabelSize=this.fCheckLabelSqueeze=!0;this.fCheckLabelOnlyOne=
this.fKillOverlappingLabel=!1;this.fCheckOverlapAllLayer=this.fCheckOverlapImplicit=!0;this.fTileTextNoClip=this.fCheckOverlapClipOnTiles=!1;this.fFeatureScalingByLayer=!0;this.fPanByViewer=this.fPendingNewGeoBounds=this.fFroozeDynamicContent=!1;this.fPanHideTools=this.fPanToolByViewer=!0;this.fEndPan="normal";this.fRotateOnMouseMove=!1;this.fPreserveMapRatio=this.fTriggerMouseMoveForPan=!0;this.fMapBorder3D=this.fMapBorder=this.fInitLegendOff=!1;this.nMapBorderWidth=1;this.szMapBorderColor="#B6BAC0";
this.szMapPanBorderStyle="fill:#E0E5F0";this.szMapPanBorderOnoverStyle="fill:#d0d5e0";this.szMapBackgroundColor=this.szMapBackgroundStyle=null;this.fLegendToggleButtons=this.fClipMapToLegend=!1;this.fNorthArrow="rotatable";this.szNorthArrowPosition="INMAP";this.szLocalPopupAlignment=null;this.szMessagePosition="center";this.nToolMarginTop=0;this.nFixedInfoScale=1;this.fScaleBar=!0;this.fActivateInfoOnClick=this.fSetToolCursor=this.fStatus=this.fDebug=!1;this.szTextGridStyle="background:#dddddd";this.fCheckSublayerCollapse=
!1;this.fCreatTextLink=!0;this.nClipTextLink=30;this.nInfoOffsetX=25;this.nInfoOffsetY=-25;this.szInfoTitleColor="#000000";this.szInfoTitleBgColor="#ffffff";this.szInfoBodyColor="#444444";this.szInfoBodyBgColor="#FFFFDD";this.nInfoRoundRect=2;this.fDecimalPointComma=this.fActiveThemeInfo=this.fInfoShowShape=!1;this.nNormalSymbolSize=20;this.nNormalButtonSize=10;this.nNormalFontSize=12;this.nHighlightToggle=0;this.fScaleToFullscreen=this.fLoadExternalData=!1;this.fAdaptMapScaleToSize=this.fHighlightHint=
!0;this.fLimitMapToExtent=!1;this.szMapToolType="";this.szLinkTarget="_blank";this.szEmbedName="SVGMap";this.highLightList=this.zoomAndPanHistory=this.bookmarkList=this.mapTiles=this.mapTool=this.mouseObject=this.antiZoomAndPanList=this._tooltip=this._activeItem=this._activeTheme=this._legendIdent=this.newShape=null;this.initActionA=[];this.initMessageA=[];this.actionA=[];this.messageA=[]};v.prototype.setFeatures=function(h){this.szFeatures=(this.szFeatures||"")+";"+h;h=h.split(";");for(var r in h){var n=
h[r].split(":");switch(n[0]){case "featurescaling":n[1]=="dynamic"?this.fFeatureScalingDynamic=this.fFeatureScaling=!0:(this.fFeatureScaling=n[1]=="false"?!1:n[1],this.fFeatureScalingDynamic=!1);break;case "objectscaling":this.fObjectScaling=n[1]=="dynamic"?"dynamic":n[1]=="false"?!1:n[1];break;case "objectlayer":this.szObjectGroupId=n[1]=="belowlabel"?"mapobjects_below_label":n[1];break;case "dynamiclabel":(this.fAdaptLabelToScaling=n[1]=="false"?!1:n[1])?(this.fKillOverlappingLabel=this.fCheckLabelSqueeze=
this.fCheckLabelSpace=this.fCheckLabelOverlap=!0,this.fCheckLabelOnlyOne=!1,n[1].match(/CHECKSPACE/)&&(this.fCheckLabelSpace=!0),n[1].match(/NOCHECKSPACE/)&&(this.fCheckLabelSpace=!1),n[1].match(/NOREPOSITIONING/)&&(this.fKillOverlappingLabel=this.fCheckLabelOverlap=!0),n[1].match(/NOREMOVE/)&&(this.fKillOverlappingLabel=!1),n[1].match(/CHECKOVERLAP/)&&(this.fCheckLabelOverlap=!0),n[1].match(/NOCHECKOVERLAP/)&&(this.fCheckLabelOverlap=!1),n[1].match(/ONLYONE/)&&(this.fCheckLabelOnlyOne=!0),n[1].match(/SQUEEZE/)&&
(this.fCheckLabelSpace=!0),n[1].match(/NOSQUEEZE/)&&(this.fCheckLabelSqueeze=!1),n[1].match(/SIZE/)&&(this.fCheckLabelSize=!0),n[1].match(/NOSIZE/)&&(this.fCheckLabelSize=!1),n[1].match(/CLIPONTILES/)&&(this.fCheckOverlapClipOnTiles=!0),n[1].match(/NOCLIPONTILES/)&&(this.fCheckOverlapClipOnTiles=!1)):this.fCheckLabelOnlyOne=this.fKillOverlappingLabel=this.fCheckLabelSize=this.fCheckLabelSqueeze=this.fCheckLabelSpace=this.fCheckLabelOverlap=!1;break;case "dynamiclayer":this.fDynamicLayer=n[1]=="false"?
!1:n[1];break;case "dynamictiles":this.fDynamicTiles=n[1]=="false"?!1:n[1];break;case "discardtiles":this.fDiscardTiles=n[1]=="false"?!1:n[1];break;case "loadmultitiles":this.fLoadMultiTiles=n[1]=="false"?!1:n[1];break;case "loadexternaldata":this.fLoadExternalData=n[1]=="false"?!1:n[1];break;case "loadincludes":this.fLoadIncludes=n[1]=="false"?!1:n[1];break;case "loadsilent":this.fLoadingSilent=n[1]=="false"?!1:n[1];break;case "worksilent":this.fExecuteSilent=n[1]=="false"?!1:n[1];break;case "notify":this.fNotify=
n[1]=="false"?!1:n[1];break;case "fastpan":this.fPanToolByViewer=n[1]=="false"?!1:n[1];break;case "fullscreen":this.fScaleToFullscreen=n[1]=="false"?!1:n[1];break;case "realtimerotate":this.fRotateOnMouseMove=n[1]=="false"?!1:n[1];break;case "tooltipdelay":this.nTooltipTimeout=Number(n[1]);break;case "popupdelay":this.nInfoTimeout=Number(n[1]);break;case "popupgridstyle":this.szTextGridStyle=n[1];break;case "buttonsize":this.nNormalButtonSize=Number(n[1]);break;case "symbolsize":this.nNormalSymbolSize=
Number(n[1]);break;case "panborder":this.fMapBorder=!0;this.nMapBorderWidth=Number(n[1]);break;case "sidebarbuttons":this.fLegendToggleButtons=n[1]=="false"?!1:n[1];break;case "3Dborder":this.fMapBorder3D=n[1]=="false"?!1:n[1];break;case "mapbackgroundstyle":this.szMapBackgroundStyle=n[1];break;case "mapbackgroundcolor":this.szMapBackgroundColor=n[1];break;case "transparent":case "transparentbackground":this.fTransparentMap=!0;break;case "mapopacity":this.nOpacity=parseFloat(n[1]);this.setOpacity(this.nOpacity,
"absolute");break;case "clipmap":n[1]=="dynamic"?this.fClipMapDynamic=this.fClipMap=!0:(this.fClipMap=n[1]=="false"?!1:n[1],this.fClipMapDynamic=!1);break;case "checklabeloverlap":this.fCheckLabelOverlap=n[1]=="false"?!1:n[1];break;case "onlyonelabel":this.fCheckLabelOnlyOne=n[1]=="false"?!1:n[1];break;case "labelspace":this.nCheckLabelSpace=parseFloat(n[1]);break;case "decimalpoint":this.fDecimalPointComma=n[1]==","||n[1]=="komma"||n[1]=="Komma"||n[1]=="comma"?!0:!1;break;case "dynamicscale":this.fAdaptMapScaleToSize=
n[1]=="false"?!1:n[1];break;case "toolcursor":this.fSetToolCursor=n[1]=="false"?!1:n[1];break;case "scalebar":this.fScaleBar=n[1]=="false"?!1:n[1];break;case "northarrow":this.fNorthArrow=n[1]=="false"?!1:n[1];break;case "northarrowposition":this.szNorthArrowPosition=n[1];break;case "screenppi":(g=Number(n[1]))||(g=96);break;case "embedname":this.szEmbedName=n[1];break;case "debug":this.fDebug=n[1];break;case "marktiles":this.fMarkTiles=n[1];break;case "popupalignment":this.szLocalPopupAlignment=
n[1];break;case "toolmargintop":this.nToolMarginTop=Number(n[1]);break;case "messageposition":this.szMessagePosition=n[1];break;case "maxThemeCharts":this.Themes.nMaxThemeCharts=Number(n[1]);break;case "maxShadowCharts":this.Themes.nMaxShadowCharts=Number(n[1]);break;case "flushPaintShape":this.Themes.nflushPaintShape=Number(n[1]);break;case "flushChartDraw":this.Themes.nflushChartDraw=Number(n[1]);this.Themes.activeTheme&&(this.Themes.activeTheme.nflushChartDraw=Number(n[1]));break;case "flushLabelDraw":this.Label.nflushLabelDraw=
Number(n[1]);break;case "activeThemeInfo":this.fActiveThemeInfo=n[1];break;case "fixedInfoScale":this.nFixedInfoScale=Number(n[1]);break;case "normalSizeScale":this.Scale.nNormalSizeScale=Number(n[1]);break;case "dynamicScalePow":this.Scale.nDynamicScalePow=Number(n[1])}}this.fClipMap&&!this.fClipMapDynamic||k.Zoom.removeClipping()};v.prototype.getFeatures=function(){this.szFeatures+=";mapopacity:"+String(this.nOpacity||1);return this.szFeatures+=";flushChartDraw:"+String(this.Themes.nflushChartDraw||
1E5)};v.prototype.isLoading=function(){return this.Loader&&this.Loader.isWaiting()||this.mapLoader&&this.mapLoader.isWaiting()||k.Tiles&&k.Tiles.isLoading()||Ma.isLoading()?!0:!1};v.prototype.isInitializing=function(){return this.fInitializing||this.Legend&&this.Legend.fInitializing||!this.Scale?!0:!1};v.prototype.isIdle=function(){return this.isInitializing()||this.isLoading()||this.actionA.length!==0||this.initActionA.length!==0?!1:!0};v.prototype.pushAction=function(h,r){if(h.toString().match(/geobounds/i)){for(var n=
0;n<this.actionA.length;n++)this.actionA[n].toString().match(/geobounds/i)&&(this.actionA[n].slice(n,1),this.messageA[n]&&this.messageA[n].slice(n,1));this.fPendingNewGeoBounds=!0}if(h.toString().match(/toview/i)){for(n=0;n<this.actionA.length;n++)this.actionA[n].toString().match(/toview/i)&&(this.actionA[n].slice(n,1),this.messageA[n]&&this.messageA[n].slice(n,1));this.fPendingNewGeoBounds=!0}this.actionA.push(h);this.messageA.push(r);this.isInitializing()||this.actionA.length!=1||setTimeout("map.popAction()",
10)};v.prototype.pushInitAction=function(h,r){this.initActionA.push(h);this.initMessageA.push(r);this.initActionA.length==1&&setTimeout("map.popInitAction()",10)};v.prototype.popAction=function(){if(this.actionA.length!==0)if(this.isLoading()||this.isInitializing())if(this.isLoading()?this.npopActionWaitInit=0:this.npopActionWaitInit++,this.npopActionWaitInit<100)setTimeout("map.popAction()",500);else{alert("Error at initializing !\nResource missing or corrupted ?\n");this.actionA.length=0;this.initActionA.length=
0;this.fInitializing=!1;try{k.HTMLWindow&&k.HTMLWindow.ixmaps.htmlgui_onMapError(window)}catch(n){}}else{var h=this.actionA.shift(),r=this.messageA.shift();r&&ha(r,1E3);if(typeof h==="function")try{h()}catch(n){n&&typeof n!="undefined"&&n.description&&typeof n.description!="undefined"&&alert("Error: "+n.description+":\n\n"+h)}else console.error("map.pushAction: Strings are no longer supported. Please pass a function."),alert("Error: map.pushAction called with string. See console for details.");setTimeout("map.popAction()",
10)}};v.prototype.popInitAction=function(){if(this.initActionA.length===0)k.npopActionWaitInit=0,k.popAction();else{if(!this.isLoading()){var h=this.initActionA.shift(),r=this.initMessageA.shift();r&&ha(r,1E3);if(typeof h==="function")try{h()}catch(n){}else console.error("map.pushInitAction: Strings are no longer supported. Please pass a function."),alert("Error: map.pushInitAction called with string. See console for details.")}setTimeout("map.popInitAction()",10)}};v.prototype.checkVersion=function(h){return h===
null||h!=this.version?!1:!0};v.prototype.fadeLogo=function(){var h=this.SVGDocument.getElementById("mapbackground:logo");h&&h.parentNode.removeChild(h)};v.prototype.hideAll=function(){var h=this.SVGDocument.getElementById("mapcanvas");h&&h.style.setProperty("display","none","")};v.prototype.showAll=function(){var h=this.SVGDocument.getElementById("mapcanvas");h&&h.style.setProperty("display","inline","")};v.prototype.hideMap=function(){if(!this.fHidden){var h=this.SVGDocument.getElementById("maplayer");
h&&h.style.setProperty("display","none","");(h=this.SVGDocument.getElementById("mapobjects"))&&h.style.setProperty("display","none","");this.fHidden=!0}};v.prototype.showMap=function(){if(this.fHidden){var h=this.SVGDocument.getElementById("maplayer");h&&h.style.setProperty("display","inline","");(h=this.SVGDocument.getElementById("mapobjects"))&&h.style.setProperty("display","inline","");this.fHidden=!1}};v.prototype.setOpacity=function(h,r){var n=this.SVGDocument.getElementById("maplayer");if(n)if(r==
"absolute")n.style.setProperty("opacity",h,""),this.nOpacity=h;else{r=n.style.getPropertyValue("opacity");if(r===null||r.length===0)r="1";r=parseFloat(r);this.nOpacity=r=Math.min(Math.max(r+h,0),1);n.style.setProperty("opacity",r,"")}};v.prototype.toggleOpacity=function(){var h=this.SVGDocument.getElementById("maplayer");if(h){var r=h.style.getPropertyValue("opacity");if(r===null||r.length===0)r="1";r=parseFloat(r);h.style.setProperty("opacity",r<1?1:0,"")}};v.prototype.clearAll=function(){k.Dom.clearGroup(k.SVGToolsGroup);
k.Dom.clearGroup(k.SVGFixedGroup);k.removeAllHighlights();k.Themes&&k.Themes.removeAll&&k.Themes.removeAll();setMapTool("");this.Scale.nObjectScaling=1};v.prototype.loadMap=function(h){this.mapLoader||(this.mapLoader=new y);if(this.mapLoader.importSVGFile(h,this.SVGDocument)){try{k.HTMLWindow.ixmaps.loadingMap=h}catch(r){}h.match(/http/)?(h=h.split(/\//),h.splice(-1),h=h.join("/"),this.mapRoot=h+"/"):this.mapRoot="";this.clearAll();k.Dom.clearGroup(k.Layer.objectGroup)}};k=new v;k.version="0.97";
window.map=k;window.thisversion="0.97";var x=0;v.Dom=function(h){this.targetDocument=window.document;h&&(this.targetDocument=h.target.ownerDocument);this.rootElement=k.SVGDocument;this.idList=[];this.objStackA=[]};v.Dom.prototype=new v;v.Dom.prototype.setTargetDocument=function(h){h&&(this.targetDocument=h)};v.Dom.prototype.setTargetGroup=function(h){h&&(this.targetGroup=h)};v.Dom.prototype.newNode=function(h,r){h=this.targetDocument.createElementNS("http://www.w3.org/2000/svg",h);(r||this.targetGroup).appendChild(h);
return h};v.Dom.prototype.newGroup=function(h,r){if(h=this.newNode("g",h))r&&h.setAttribute("id",r),h.fu=new S(h);return h};v.Dom.prototype.newObject=function(h,r){if(h=this.newNode(h,r))h.fu=new S(h);return h};v.Dom.prototype.getObjectById=function(h){if(h=this.targetDocument.getElementById(h))h.fu=new S(h);return h};v.Dom.prototype.clearGroup=function(h){if(h&&h.hasChildNodes())for(var r=h.childNodes,n=r.length-1;n>=0;n--)h.removeChild(r.item(n))};v.Dom.prototype.removeElementById=function(h){(h=
k.SVGDocument.getElementById(h))&&h.parentNode&&h.parentNode.removeChild(h)};v.Dom.prototype.constructNode=function(h,r,n){h=this.newObject(h,r);for(var E in n)E.match(/xlink/)?h.setAttributeNS("http://www.w3.org/1999/xlink",E,n[E]):h.setAttribute(E,n[E]);return h};v.Dom.prototype.pushObj=function(h){var r="stackedObject"+String(Math.random());this.objStackA[r]=h;return r};v.Dom.prototype.popObj=function(h){return this.objStackA[h]};v.Dom.prototype.newShape=function(h,r,n,E,F,I,L,R,Z,na,fa,la,Na){R=
null;switch(h){case "rect":isNaN(F)||F<=0||isNaN(I)||I<=0||(R={x:String(n),y:String(E),width:String(F),height:String(I),style:L});break;case "circle":isFinite(F)&&F>0&&(R={cx:String(n),cy:String(E),r:String(F),style:I});break;case "line":isFinite(n)&&isFinite(E)&&isFinite(F)&&isFinite(I)&&(R={x1:String(n),y1:String(E),x2:String(F),y2:String(I),style:L});break;case "path":R={d:String(n),style:E}}return R?this.constructNode(h,r,R):null};v.Dom.prototype.newText=function(h,r,n,E,F){if(!isFinite(r)||!isFinite(n))return null;
F&&typeof F!="undefined"||(F="(undefined)");F=String(F);if(k.fCreatTextLink&&F.substr(0,7)=="http://"||k.fCreatTextLink&&F.substr(0,8)=="https://")return this.newTextLink(h,r,n,E,F);h=this.constructNode("text",h,{x:String(r),y:String(n),style:E});F=this.targetDocument.createTextNode(F);h.appendChild(F);return h};v.Dom.prototype.newTSpan=function(h,r,n){if(h.nodeName!="text")return null;n||="(undefined)";h=this.constructNode("tspan",h,{style:r});n=this.targetDocument.createTextNode(n);h.appendChild(n);
return h};v.Dom.prototype.newTextOnPath=function(h,r,n,E,F){n&&typeof n!="undefined"||(n="(undefined)");n=String(n);var I=this.constructNode("text",h,{style:E});h=this.constructNode("textPath",h,{style:E});h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+r);h.setAttributeNS(null,"startOffset",F);r=this.targetDocument.createTextNode(n);h.appendChild(r);I.appendChild(h);return I};v.Dom.prototype.newTextLink=function(h,r,n,E,F,I){h=this.constructNode("a",h);h.setAttributeNS("http://www.w3.org/1999/xlink",
"xlink:href",I?I:F);h.setAttributeNS(null,"target",szLinkTarget);F&&F.length>30&&(F=F.substr(0,29)+" ...");r=this.constructNode("text",h,{x:String(r),y:String(n),style:E});F=this.targetDocument.createTextNode(F);r.appendChild(F);r.style.setProperty("fill","blue","");r.style.setProperty("text-decoration","underline","");return h};v.Dom.prototype.wrapText=function(h,r){var n=h.firstChild.data,E=h.style.getPropertyValue("font-size");if(n){var F=h.getAttributeNS(null,"x");n=n.split(" ");h.removeChild(h.firstChild);
var I=this.newTSpan(h,"",n[0]);I.setAttributeNS(null,"x",F);for(var L=1,R=1;R<n.length;R++){var Z=I.firstChild.data.length;I.firstChild.data+=" "+n[R];I.getComputedTextLength()>r&&(I.firstChild.data=I.firstChild.data.slice(0,Z),I=this.newTSpan(h,"",n[R]),I.setAttributeNS(null,"x",F),I.setAttributeNS(null,"dy",E),L++)}return L}};v.Dom.prototype.getAllIds=function(h,r){r===null&&(this.idList.length=0);if(h&&h.hasChildNodes())for(h.hasAttributes&&(r=h.getAttributeNS(null,"id"))&&(this.idList[this.idList.length]=
r),h=h.childNodes,r=0;r<h.length;r++)this.getAllIds(h.item(r),1);return this.idList};v.Dom.prototype.extendAllIds=function(h,r){if(h&&h.nodeType==1){var n=h.getAttributeNS(null,"id");h.setAttributeNS(null,"id",n+r);h=h.childNodes;for(n=0;n<h.length;n++)this.extendAllIds(h.item(n),r)}};v.Dom.prototype.getParentByNodename=function(h,r){if(h)for(;h=h.parentNode;)if(h.nodeName==r)return h;return null};v.Dom.prototype.getAttributeByNodeOrParents=function(h,r,n){for(var E;h&&h.nodeType==1;)if(E=h.getAttributeNS(r,
n),E===null||E.length===0)h=h.parentNode;else return E;return""};v.Dom.prototype.getClipRect=function(h){var r=null;(h=h.getAttributeNS(null,"clip-path"))&&(h=h.match(M))&&h[1]&&(h=k.SVGDocument.getElementById(h[1]))&&h.hasChildNodes&&(r=h.firstChild);return r};v.Dom.prototype.setClipRect=function(h,r){var n=this.getClipRect(h);if(!n){var E=h.getAttributeNS(null,"id");n=k.Dom.newNode("clipPath",h.parentNode);n.setAttributeNS(null,"id",E+":clippath");n.setAttributeNS(null,"style","pointer-events:all");
n=k.Dom.newShape("rect",n,0,0,1,1,"fill:none;stroke:none;opacity:0");n.setAttributeNS(null,"id",E+":cliprect");h.setAttributeNS(null,"clip-path","url(#"+E+":clippath)")}n.setAttributeNS(null,"x",r.x);n.setAttributeNS(null,"y",r.y);n.setAttributeNS(null,"width",r.width);n.setAttributeNS(null,"height",r.height);return n};v.Scale=function(){k.fScaleToFullscreen&&!k.fPDFEmbed&&window.screen&&(k.SVGRootElement.currentScale=1,k.SVGRootElement.currentScale=Math.min(window.innerWidth/k.SVGWidth,window.innerHeight/
k.SVGHeight));this.viewBox=new qa(k.SVGViewBox[0],k.SVGViewBox[1],k.SVGViewBox[2],k.SVGViewBox[3]);this.szMapUnits=this.nMapScale=this.scaleNode=null;this.szMapProjection="UTM";this.mapPosition=new T(0,0);this.mapOffset=new T(0,0);this.offsetNode=k.SVGDocument.getElementById("mapoffset");this.canvasNode=k.SVGDocument.getElementById("mapcanvas");this.zoomNode=k.SVGDocument.getElementById("mapzoomandpan");this.canvasNode&&(this.mapOffset=D(this.canvasNode));this.offsetNode&&(this.mapPosition=D(this.offsetNode));
this.CSSStyleNodes=k.SVGDocument.getElementById("mapstyles");this.fCSSStyleNodeChanged=!1;this.scaledSymbolsA=[];this.rotatedSymbolsA=[];this.screenX=1024;this.screenY=768;this.nPPI=g;this.objectScaling_lastScale=this.symbolScaling_lastScale=this.featureScaling_lastScale=1;this.metadataNode=null;var h=k.SVGRootElement.getElementsByTagName("metadata");if(this.metadataNode=h[h.length-1]){this.creationNode=this.metadataNode.getElementsByTagName("xmap:creation").item(0);if(this.extentNode=this.metadataNode.getElementsByTagName("xmap:extension").item(0))this.minBoundX=
Number(this.extentNode.getAttribute("minboundx")),this.maxBoundX=Number(this.extentNode.getAttribute("maxboundx")),this.minBoundY=Number(this.extentNode.getAttribute("minboundy")),this.maxBoundY=Number(this.extentNode.getAttribute("maxboundy")),this.minX=Number(this.extentNode.getAttribute("minx")),this.minY=Number(this.extentNode.getAttribute("miny")),this.maxX=Number(this.extentNode.getAttribute("maxx")),this.maxY=Number(this.extentNode.getAttribute("maxy")),this.bBox=new qa(this.minX,this.minY,
this.maxX-this.minX,this.maxY-this.minY),this.mapUnitsPPX=(this.maxBoundX-this.minBoundX)/(this.maxX-this.minX),this.mapUnitsPPY=(this.maxBoundY-this.minBoundY)/(this.maxY-this.minY),this.origMinX=this.minX,this.origMinY=this.minY;if(this.scaleNode=this.metadataNode.getElementsByTagName("xmap:scale").item(0))this.nMapScale=Number(this.scaleNode.getAttribute("mapscale")),this.nMapPPI=Number(this.scaleNode.getAttribute("dpi")),this.nMapPPI||(this.nMapPPI=72),this.szMapUnits=this.scaleNode.getAttribute("mapunitsstr"),
this.initScale=this.scaleNode.getAttribute("mapinitscale"),this.initZoomNode=this.metadataNode.getElementsByTagName("xmap:initzoom").item(0),this.nObjectScaling=this.nLabelScaling=this.nLineScaling=this.nBorderScaling=this.nFeatureScaling=1,this.nTrueMapScale=this.getTrueMapScale(),this.nNormalSizeScale=this.nMapScale,this.nDynamicScalePow=3;if(this.coordsysNode=this.metadataNode.getElementsByTagName("xmap:coordsys").item(0))this.szMapProjection=this.coordsysNode.getAttribute("projection"),this.szDatum=
this.coordsysNode.getAttribute("datum"),this.szUTMZone=this.coordsysNode.getAttribute("UTMZone"),this.nFalseEasting=Number(this.coordsysNode.getAttribute("falseeasting")),this.nFalseNorthing=Number(this.coordsysNode.getAttribute("falsenorthing")),this.nCorrectEasting=Number(this.coordsysNode.getAttribute("correcteasting")),this.nCorrectNorthing=Number(this.coordsysNode.getAttribute("correctnorthing")),h=k.HTMLWindow.ixmaps.projectionParams||{},this.nAlbersLat1=h.lat1!==void 0?Number(h.lat1):this.coordsysNode.getAttribute("lat1")?
Number(this.coordsysNode.getAttribute("lat1")):null,this.nAlbersLat2=h.lat2!==void 0?Number(h.lat2):this.coordsysNode.getAttribute("lat2")?Number(this.coordsysNode.getAttribute("lat2")):null,this.nAlbersLat0=h.lat0!==void 0?Number(h.lat0):this.coordsysNode.getAttribute("lat0")?Number(this.coordsysNode.getAttribute("lat0")):null,this.nAlbersLon0=h.lon0!==void 0?Number(h.lon0):this.coordsysNode.getAttribute("lon0")?Number(this.coordsysNode.getAttribute("lon0")):null,this._albersConstants=null,this.nAlbersLat1!==
null&&this.nAlbersLat2!==null&&this.nAlbersLat0!==null&&this.nAlbersLon0!==null&&this._calculateAlbersConstants(),this.lastAlbersParams=null,this.szMapProjection==="LambertAzimuthalEqualArea"?(this.nLambertLat0=h.lat0!==void 0?Number(h.lat0):this.coordsysNode.getAttribute("lambertlat0")?Number(this.coordsysNode.getAttribute("lambertlat0")):null,this.nLambertLon0=h.lon0!==void 0?Number(h.lon0):this.coordsysNode.getAttribute("lambertlon0")?Number(this.coordsysNode.getAttribute("lambertlon0")):null):
this.nLambertLon0=this.nLambertLat0=null,this._lambertConstants=null,this.nLambertLat0!==null&&this.nLambertLon0!==null&&this._calculateLambertAzimuthalConstants(),this.lastLambertParams=null,this.szMapProjection==="Orthographic"?(this.nOrthographicLat0=h.lat0!==void 0?Number(h.lat0):this.coordsysNode.getAttribute("orthographiclat0")?Number(this.coordsysNode.getAttribute("orthographiclat0")):null,this.nOrthographicLon0=h.lon0!==void 0?Number(h.lon0):this.coordsysNode.getAttribute("orthographiclon0")?
Number(this.coordsysNode.getAttribute("orthographiclon0")):null):this.nOrthographicLon0=this.nOrthographicLat0=null,this.lastOrthographicParams=null;if(this.featuresNode=this.metadataNode.getElementsByTagName("xmap:features").item(0))(h=this.featuresNode.getAttributeNS(null,"mapfeatures"))&&h.length>1&&k.setFeatures(h),this.featuresNode.getAttributeNS(null,"cliptextpath")=="true"&&(k.fAdaptLabelToScaling="delayed"),this.featuresNode.getAttributeNS(null,"initlegendoff")=="true"&&(k.fInitLegendOff=
!0),this.featuresNode.getAttributeNS(null,"checklabeloverlap")=="true"&&(k.fCheckLabelOverlap=!0),this.featuresNode.getAttributeNS(null,"onlyonelabel")=="true"&&(k.fCheckLabelOnlyOne=!0),this.featuresNode.getAttributeNS(null,"tiletextnoclip")=="true"&&(k.fTileTextNoClip=!0),this.nFeatureScaling=Number(this.featuresNode.getAttribute("featurescaling")),this.nBorderScaling=Number(this.featuresNode.getAttribute("borderscaling")),this.nLineScaling=Number(this.featuresNode.getAttribute("linescaling")),
this.nLabelScaling=Number(this.featuresNode.getAttribute("labelscaling")),this.nObjectScaling=Number(this.featuresNode.getAttribute("objectscaling")),this.nFeatureScaling=this.nFeatureScaling?this.nFeatureScaling:1,this.nBorderScaling=this.nBorderScaling?this.nBorderScaling:1,this.nLineScaling=this.nLineScaling?this.nLineScaling:1,this.nLabelScaling=this.nLabelScaling?this.nLabelScaling:1,this.nObjectScaling=this.nObjectScaling?this.nObjectScaling:1}this.nButtonSize=this.nNormalButtonSize;this.nSymbolSize=
this.nNormalSymbolSize;this.nFontSize=this.nNormalFontSize;this.nScaleX=this.viewBox.width/this.getEmbedWidth()*this.getEmbedScale();this.nScaleY=this.viewBox.height/this.getEmbedHeight()*this.getEmbedScale();this.nZoomScale=1;this.mapCenter=new T(0,0);this.mapCanvasCenter=new T(this.mapPosition.x+this.bBox.width/2,this.mapPosition.y+this.bBox.height/2);this.setCanvasSize(0,0,window.innerWidth,window.innerHeight,"center")};v.Scale.prototype=new v;v.Scale.prototype._calculateAlbersConstants=function(){const h=
this.nAlbersLat1*Math.PI/180,r=this.nAlbersLat2*Math.PI/180,n=this.nAlbersLat0*Math.PI/180,E=this.nAlbersLon0*Math.PI/180,F=la=>{const Na=.0818191908426*la;return.9933056200098622*(la/(1-.0066943799901378*la*la)-6.111035746636471*Math.log((1-Na)/(1+Na)))},I=la=>{const Na=Math.sin(la);return Math.cos(la)/Math.sqrt(1-.0066943799901378*Na*Na)},L=F(Math.sin(n));var R=F(Math.sin(h)),Z=F(Math.sin(r));const na=I(h),fa=I(r);Z=(na*na-fa*fa)/(Z-R);R=na*na+Z*R;this._albersConstants={"\u03c61":h,"\u03c62":r,
"\u03c60":n,"\u03bb0":E,a:6378137,e:.0818191908426,e2:.0066943799901378,n:Z,C:R,"\u03c10":6378137/Z*Math.sqrt(R-Z*L),calcQ:F,calcM:I}};v.Scale.prototype._calculateLambertAzimuthalConstants=function(){var h=this.nLambertLat0*Math.PI/180;const r=this.nLambertLon0*Math.PI/180;var n=1/298.257222101;const E=2*n-n*n,F=Math.sqrt(E);n=na=>{na=Math.sin(na);const fa=F*na;return(1-E)*(na/(1-E*na*na)-1/(2*F)*Math.log((1-fa)/(1+fa)))};const I=(1-E)*(1/(1-E)-1/(2*F)*Math.log((1-F)/(1+F))),L=n(h),R=L/I,Z=6378137*
Math.sqrt(.5*I);this._lambertConstants={a:6378137,e:F,e2:E,"\u03bb0":r,"\u03c60":h,qp:I,q0:L,sinBeta0:R,cosBeta0:Math.sqrt(Math.max(0,1-R*R)),Rq:Z,calcQ:n,inverseQ:na=>{let fa=Math.asin(Math.max(-1,Math.min(1,na/2)));for(let Na=0;Na<12;Na++){var la=Math.sin(fa);const Ea=F*la,U=1-E*la*la;la=(na-(1-E)*(la/U-1/(2*F)*Math.log((1-Ea)/(1+Ea))))/((1-E)/U);fa+=la;if(Math.abs(la)<1E-12)break}return fa}};h=Z*Math.sqrt(2);Number.isFinite(h)&&h>0&&(this.minBoundX=-h,this.maxBoundX=h,this.minBoundY=-h,this.maxBoundY=
h,this.maxX-this.minX!==0&&this.maxY-this.minY!==0&&(this.mapUnitsPPX=(this.maxBoundX-this.minBoundX)/(this.maxX-this.minX),this.mapUnitsPPY=(this.maxBoundY-this.minBoundY)/(this.maxY-this.minY)))};v.Scale.prototype.calculateAlbersParameters=function(h,r,n){var E={lat:h,lng:r,zoom:n};h=parseFloat(h);r=parseFloat(r);n=parseFloat(n);if(!Number.isFinite(h)||!Number.isFinite(r))return console.warn("calculateAlbersParameters: invalid center coordinates",E),null;Number.isFinite(n)||(console.warn("calculateAlbersParameters: invalid zoom, defaulting to 5",
E),n=5);var F=Math.PI/180,I=Math.pow(2,n-5);Number.isFinite(I)&&I!==0||(console.warn("calculateAlbersParameters: invalid powFactor, enforcing zoom=5",{originalArgs:E,normalizedZoom:n,powFactor:I}),n=5,I=Math.pow(2,n-5));let L=15/I;Number.isFinite(L)||(console.warn("calculateAlbersParameters: invalid latitudeSpacing, enforcing zoom=5",{originalArgs:E,normalizedZoom:n,powFactor:I,latitudeSpacing:L}),n=5,I=Math.pow(2,n-5),L=15/I);Number.isFinite(L)||(L=15);console.debug("calculateAlbersParameters: normalized inputs",
{originalArgs:E,lat:h,lng:r,zoom:n,latitudeSpacing:L});E=Math.max(-89,Math.min(89,h+L));I=Math.max(-89,Math.min(89,h-L));if(I>E){var R=E;E=I;I=R}R=E*F;F*=I;var Z=Na=>{const Ea=.0818191908426*Na;return.9933056200098622*(Na/(1-.0066943799901378*Na*Na)-6.111035746636471*Math.log((1-Ea)/(1+Ea)))},na=Na=>{const Ea=Math.sin(Na);return Math.cos(Na)/Math.sqrt(1-.0066943799901378*Ea*Ea)},fa=Z(Math.sin(R));const la=Z(Math.sin(F));Z=na(R);na=na(F);fa=la-fa;if(Math.abs(fa)<1E-10)return console.warn("calculateAlbersParameters: standard parallels too close, adjusting",
{lat1:E,lat2:I}),R=(Math.sin(R)+Math.sin(F))/2,F={lat1:Math.round(E*10)/10,lat2:Math.round(I*10)/10,lat0:Math.round(h*10)/10,lon0:Math.round(r*10)/10,_n:Math.round(R*1E4)/1E4},Number.isFinite(F.lat1)&&Number.isFinite(F.lat2)&&Number.isFinite(F._n)?console.debug("calculateAlbersParameters: result",F):console.warn("calculateAlbersParameters: produced invalid result",{result:F,intermediate:{lat1:E,lat2:I,n:R},inputs:{lat:h,lng:r,normalizedZoom:n,latitudeSpacing:L}}),this.nAlbersLat1=F.lat1,this.nAlbersLat2=
F.lat2,this.nAlbersLat0=F.lat0,this.nAlbersLon0=F.lon0,typeof this._calculateAlbersConstants==="function"&&this._calculateAlbersConstants(),F;R=(Z*Z-na*na)/fa;F={lat1:Math.round(E*10)/10,lat2:Math.round(I*10)/10,lat0:Math.round(h*10)/10,lon0:Math.round(r*10)/10,_n:Math.round(R*1E4)/1E4};Number.isFinite(F.lat1)&&Number.isFinite(F.lat2)&&Number.isFinite(F._n)?console.debug("calculateAlbersParameters: result",F):console.warn("calculateAlbersParameters: produced invalid result",{result:F,intermediate:{lat1:E,
lat2:I,n:R},inputs:{lat:h,lng:r,normalizedZoom:n,latitudeSpacing:L}});this.nAlbersLat1=F.lat1;this.nAlbersLat2=F.lat2;this.nAlbersLat0=F.lat0;this.nAlbersLon0=F.lon0;typeof this._calculateAlbersConstants==="function"&&this._calculateAlbersConstants();return F};v.Scale.prototype.calculateLambertAzimuthalParameters=function(h,r){const n={lat:h,lng:r};h=parseFloat(h);r=parseFloat(r);if(!Number.isFinite(h)||!Number.isFinite(r))return console.warn("calculateLambertAzimuthalParameters: invalid center coordinates",
n),null;this.nLambertLat0=Math.max(-89.9999,Math.min(89.9999,h));this.nLambertLon0=((r+180)%360+360)%360-180;typeof this._calculateLambertAzimuthalConstants==="function"&&this._calculateLambertAzimuthalConstants();h={lat0:Math.round(this.nLambertLat0*10)/10,lon0:Math.round(this.nLambertLon0*10)/10};this._lambertConstants&&(h._sinBeta0=Math.round(this._lambertConstants.sinBeta0*1E4)/1E4,h._Rq=Math.round(this._lambertConstants.Rq));console.debug("calculateLambertAzimuthalParameters: result",h);return h};
v.Scale.prototype.calculateLambertAzimuthalParametersFromBounds=function(h,r,n,E){h=parseFloat(h);r=parseFloat(r);n=parseFloat(n);E=parseFloat(E);if(!(Number.isFinite(h)&&Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(E)))return console.warn("calculateLambertAzimuthalParametersFromBounds: invalid bounds",{latSW:h,lonSW:r,latNE:n,lonNE:E}),null;const F=Math.max(r,E),I=Math.min(r,E),L=(Math.max(h,n)+Math.min(h,n))/2;let R=(F+I)/2;Math.abs(E-r)>180&&(R=((F<0?F+360:F)+(I<0?I+360:I))/2%360,R>
180&&(R-=360));console.debug("calculateLambertAzimuthalParametersFromBounds: derived center",{latSW:h,lonSW:r,latNE:n,lonNE:E,centerLat:L,centerLng:R});return this.calculateLambertAzimuthalParameters(L,R)};v.Scale.prototype.calculateOrthographicParameters=function(h,r){const n={lat:h,lng:r};h=parseFloat(h);r=parseFloat(r);if(!Number.isFinite(h)||!Number.isFinite(r))return console.warn("calculateOrthographicParameters: invalid center coordinates",n),null;this.nOrthographicLat0=Math.max(-89.9999,Math.min(89.9999,
h));this.nOrthographicLon0=((r+180)%360+360)%360-180;h={lat0:Math.round(this.nOrthographicLat0*10)/10,lon0:Math.round(this.nOrthographicLon0*10)/10};console.debug("calculateOrthographicParameters: result",h);return h};v.Scale.prototype.xxxcalculateOrthographicParametersFromBounds=function(h,r,n,E){h=parseFloat(h);r=parseFloat(r);n=parseFloat(n);E=parseFloat(E);if(!(Number.isFinite(h)&&Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(E)))return console.warn("calculateOrthographicParametersFromBounds: invalid bounds",
{latSW:h,lonSW:r,latNE:n,lonNE:E}),null;const F=Math.max(r,E),I=Math.min(r,E),L=(Math.max(h,n)+Math.min(h,n))/2;let R=(F+I)/2;Math.abs(E-r)>180&&(R=((F<0?F+360:F)+(I<0?I+360:I))/2%360,R>180&&(R-=360));console.debug("calculateOrthographicParametersFromBounds: derived center",{latSW:h,lonSW:r,latNE:n,lonNE:E,centerLat:L,centerLng:R});return this.calculateOrthographicParameters(L,R)};v.Scale.prototype.calculateAlbersParametersFromBounds=function(h,r,n,E){h=parseFloat(h);r=parseFloat(r);n=parseFloat(n);
E=parseFloat(E);if(!(Number.isFinite(h)&&Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(E)))return console.warn("calculateAlbersParametersFromBounds: invalid bounds",{latSW:h,lonSW:r,latNE:n,lonNE:E}),null;var F=Math.max(h,n),I=Math.min(h,n),L=Math.max(r,E),R=Math.min(r,E),Z=(F+I)/2;let na=(L+R)/2;Math.abs(E-r)>180&&(na=((L<0?L+360:L)+(R<0?R+360:R))/2%360,na>180&&(na-=360));F===I&&(F=Math.min(89,F+.5),I=Math.max(-89,I-.5));R=Math.PI/180;L=F*R;R*=I;var fa=U=>{const lb=.0818191908426*U;return.9933056200098622*
(U/(1-.0066943799901378*U*U)-6.111035746636471*Math.log((1-lb)/(1+lb)))},la=U=>{const lb=Math.sin(U);return Math.cos(U)/Math.sqrt(1-.0066943799901378*lb*lb)},Na=fa(Math.sin(L));const Ea=fa(Math.sin(R));fa=la(L);la=la(R);Na=Ea-Na;if(Math.abs(Na)<1E-10)return console.warn("calculateAlbersParametersFromBounds: standard parallels too close, adjusting",{lat1:F,lat2:I}),L={lat1:Math.round(F*10)/10,lat2:Math.round(I*10)/10,lat0:Math.round(Z*10)/10,lon0:Math.round(na*10)/10,_n:Math.round((Math.sin(L)+Math.sin(R))/
2*1E4)/1E4},this.nAlbersLat1=L.lat1,this.nAlbersLat2=L.lat2,this.nAlbersLat0=L.lat0,this.nAlbersLon0=L.lon0,typeof this._calculateAlbersConstants==="function"&&this._calculateAlbersConstants(),console.debug("calculateAlbersParametersFromBounds: derived inputs",{latSW:h,lonSW:r,latNE:n,lonNE:E,centerLat:Z,centerLng:na,lat1:F,lat2:I}),L;Z={lat1:Math.round(F*10)/10,lat2:Math.round(I*10)/10,lat0:Math.round(Z*10)/10,lon0:Math.round(na*10)/10,_n:Math.round((fa*fa-la*la)/Na*1E4)/1E4};this.nAlbersLat1=Z.lat1;
this.nAlbersLat2=Z.lat2;this.nAlbersLat0=Z.lat0;this.nAlbersLon0=Z.lon0;typeof this._calculateAlbersConstants==="function"&&this._calculateAlbersConstants();console.debug("calculateAlbersParametersFromBounds: derived inputs",{latSW:h,lonSW:r,latNE:n,lonNE:E,result:Z});return Z};v.Scale.prototype.reset=function(){k.fScaleToFullscreen&&!k.fPDFEmbed&&window.screen&&(k.SVGRootElement.currentScale=1,k.SVGRootElement.currentScale=Math.min(window.innerWidth/k.SVGWidth,window.innerHeight/k.SVGHeight));this.canvasNode&&
(this.mapOffset=D(this.canvasNode));this.offsetNode&&(this.mapPosition=D(this.offsetNode));this.mapCanvasCenter=new T(this.mapPosition.x+this.bBox.width/2,this.mapPosition.y+this.bBox.height/2);this.setCanvasSize(0,0,window.innerWidth,window.innerHeight,"center")};v.Scale.prototype.setCanvasSize=function(h,r,n,E,F){if(!n||!E)return!1;this.nScaleY=this.nScaleX=20;var I=""+String(h)+" "+String(r)+" "+String(this.normalX(n))+" "+String(this.normalX(E));h=this.normalX(n)-this.mapPosition.x;r=this.normalX(E)-
this.mapPosition.y;var L=h-(this.maxX-this.minX),R=r-(this.maxY-this.minY);F=="extendmax"?(this.maxX+=L,this.maxY+=R,this.maxBoundX+=L*this.mapUnitsPPX,this.minBoundY-=R*this.mapUnitsPPY):(this.minX-=L/2,this.minY-=R/2,this.maxX+=L/2,this.maxY+=R/2,this.minBoundX-=L/2*this.mapUnitsPPX,this.maxBoundY+=R/2*this.mapUnitsPPY,this.maxBoundX+=L/2*this.mapUnitsPPX,this.minBoundY-=R/2*this.mapUnitsPPY,this.canvasNode&&(J(this.canvasNode,this.maxX,this.maxY),this.mapOffset=D(this.canvasNode)));k.SVGWidth=
n;k.SVGHeight=E;k.SVGRootElement.setAttribute("width",k.SVGWidth+"px");k.SVGRootElement.setAttribute("height",k.SVGHeight+"px");k.SVGRootElement.setAttribute("viewBox",I);k.SVGOrigViewBoxString=k.SVGRootElement.getAttribute("viewBox");k.SVGViewBox=k.SVGRootElement.getAttribute("viewBox").split(" ");k.SVGViewBox[0]=Number(k.SVGViewBox[0]);k.SVGViewBox[1]=Number(k.SVGViewBox[1]);k.SVGViewBox[2]=Number(k.SVGViewBox[2]);k.SVGViewBox[3]=Number(k.SVGViewBox[3]);this.viewBox=new qa(k.SVGViewBox[0],k.SVGViewBox[1],
k.SVGViewBox[2],k.SVGViewBox[3]);this.bBox=new qa(this.minX,this.minY,this.maxX-this.minX,this.maxY-this.minY);this.mapCanvasCenter=new T(this.mapPosition.x+this.bBox.width/2,this.mapPosition.y+this.bBox.height/2);this.nScaleX=this.viewBox.width/this.getEmbedWidth()*this.getEmbedScale();this.nScaleY=this.viewBox.height/this.getEmbedHeight()*this.getEmbedScale();if(F=k.SVGDocument.getElementById("mapcliprect"))F.setAttributeNS(null,"width",h),F.setAttributeNS(null,"height",r);k.SVGDocument.getElementById("mapcliprect2");
if(F=k.SVGDocument.getElementById("map:annotation"))F.fu=new S(F),h=F.fu.getBox(),F.fu.setPosition(this.normalX(n-2)-this.mapPosition.x,this.normalY(E)-this.mapPosition.y-h.height*2)};v.Scale.prototype.resizeCanvas=function(h,r,n,E,F){F||="center";this.setCanvasSize(h,r,n,E,F);try{k.Viewport.reformat(),k.Themes.reformat(),k.Themes.redraw(),k.Legend.reformat()}catch(I){}try{displayScale(null,"bottom")}catch(I){}};v.Scale.prototype.getDistanceInMeter=function(h,r,n,E){var F=n-h,I=E-r;this.szMapProjection==
"Mercator"&&(this.szMapUnits="degrees");switch(this.szMapUnits){case "feet":F/=3.2808399,I/=3.2808399;case "meter":case "meters":F=F*this.nZoomScale*this.mapUnitsPPX;I=I*this.nZoomScale*this.mapUnitsPPY;n=Math.sqrt(F*F+I*I);n>100&&(n=Math.round(n));n=n>10?Math.round(n*10)/10:Math.round(n*100)/100;break;default:h=k.Scale.getMapPosition(h,r);E=k.Scale.getMapPosition(n,E);n=k.Scale.getMapCoordinate(h.x,h.y);E=k.Scale.getMapCoordinate(E.x,E.y);n=k.Scale.getGeoCoordinateOfPoint(n.x,n.y);E=k.Scale.getGeoCoordinateOfPoint(E.x,
E.y);if(!n||!E)return 0;h=n.y/180*Math.PI;r=E.y/180*Math.PI;n=Math.pow(Math.sin(Math.abs(r-h)/2),2)+Math.cos(h)*Math.cos(r)*Math.pow(Math.sin(Math.abs(E.x/180*Math.PI-n.x/180*Math.PI)/2),2);n=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6378.388*1E3}return n};v.Scale.prototype.formatDistanceString=function(h){return h>1E3?String(Math.round(h/100)/10)+" km":h>100?String(Math.round(h*10)/10)+" m":String(Math.round(h*100)/100)+" m"};v.Scale.prototype.formatSurfaceString=function(h){h=h>1E6?String(Math.round(h/
1E6*1E3)/1E3)+" km2":String(Math.round(h*1E3)/1E3)+" m2";var r=h.split(".");r.length>1&&(h=r[0]+","+r[1]);return h};v.Scale.prototype.getDeltaXofDistanceInMeter=function(h){return 1E3/this.getDistanceInMeter(1E3,1E3,2E3,1E3)*h};v.Scale.prototype.getDeltaYofDistanceInMeter=function(h){return 1E3/this.getDistanceInMeter(1E3,1E3,1E3,2E3)*h};v.Scale.prototype.getMapCoordinate=function(h,r){h+=this.mapOffset.x;r=this.maxY-this.minY-(r+this.mapOffset.y);switch(this.szMapUnits){case "feet":case "meter":case "meters":h=
this.minBoundX+h*this.mapUnitsPPX;r=this.minBoundY+r*this.mapUnitsPPY;break;default:h=this.minBoundX+h*this.mapUnitsPPX,r=this.minBoundY+r*this.mapUnitsPPY}return new T(h,r)};v.Scale.prototype.getMapCoordinateUTM=function(h,r){h=this.getMapCoordinate(h,r);this.szMapProjection=="Mercator"?h=Db(h.y,h.x):this.szMapProjection=="WinkelTripel"?h=Oa(h.y,h.x):this.szMapProjection=="EqualEarth"?h=ra(h.y,h.x):this.szMapProjection=="AlbersEqualArea"?h=Qa(h.y,h.x,{lat1:this.nAlbersLat1,lat2:this.nAlbersLat2,
lat0:this.nAlbersLat0,lon0:this.nAlbersLon0}):this.szMapProjection=="LambertAzimuthalEqualArea"?h=xb(h.y,h.x,{lat0:this.nLambertLat0,lon0:this.nLambertLon0}):this.szMapProjection=="Orthographic"?h=Wa(h.y,h.x,{lat0:this.nOrthographicLat0,lon0:this.nOrthographicLon0}):this.szMapUnits!="feet"&&this.szMapUnits!="meter"&&this.szMapUnits!="meters"&&(h=oa("WGS84",h.y,h.x));return h};v.Scale.prototype.getMapPositionOfUTM=function(h,r,n,E){h=Za(n,h,r,E);h=k.Scale.getMapCoordinateOfLatLon(h.y,h.x);return{x:(h.x-
k.Scale.minBoundX)/k.Scale.mapUnitsPPX-k.Scale.mapOffset.x,y:k.Scale.bBox.height-(h.y-k.Scale.minBoundY)/k.Scale.mapUnitsPPY-k.Scale.mapOffset.y}};v.Scale.prototype.getMapPositionOfLatLon=function(h,r){return this.szMapProjection==="Orthographic"&&this.isPointOnBacksideOrthographic&&this.isPointOnBacksideOrthographic(h,r)?null:(h=k.Scale.getMapCoordinateOfLatLon(h,r))?{x:(h.x-k.Scale.minBoundX)/k.Scale.mapUnitsPPX-k.Scale.mapOffset.x,y:k.Scale.bBox.height-(h.y-k.Scale.minBoundY)/k.Scale.mapUnitsPPY-
k.Scale.mapOffset.y}:null};v.Scale.prototype.getMapCoordinateOfLatLon=function(h,r){if(this.szMapProjection=="Mercator")var n=Db(h,r);else if(this.szMapProjection=="WinkelTripel")n=Oa(h,r);else if(this.szMapProjection=="EqualEarth")n=ra(h,r);else if(this.szMapProjection=="AlbersEqualArea")n=Qa(h,r,{lat1:this.nAlbersLat1,lat2:this.nAlbersLat2,lat0:this.nAlbersLat0,lon0:this.nAlbersLon0});else if(this.szMapProjection=="LambertAzimuthalEqualArea")n=xb(h,r,{lat0:this.nLambertLat0,lon0:this.nLambertLon0});
else if(this.szMapProjection=="Orthographic")n=Wa(h,r,{lat0:this.nOrthographicLat0,lon0:this.nOrthographicLon0});else if(this.szMapUnits=="feet"||this.szMapUnits=="meter"||this.szMapUnits=="meters"){if(!this.szDatum&&!this.szUTMZone)return null;n=oa(this.szDatum,h,r,this.szUTMZone);this.nFalseEasting&&(n.x+=this.nFalseEasting-5E5);n.y+=this.nFalseNorthing+this.nCorrectNorthing;n.x+=this.nCorrectEasting;n.y+=this.nCorrectNorthing}return n};v.Scale.prototype.getGeoCoordinateOfPoint=function(h,r){if(this.szMapProjection==
"Mercator")return r=Math.atan(Eb(r*sb))*ob,new T(h,r);if(this.szMapProjection=="EqualEarth"){for(;r>6378137;)r-=6378137;for(;h>6378137;)h-=6378137;for(;r<-6378137;)r+=6378137;for(;h<-6378137;)h+=6378137;for(var n=h/=6378137,E=n*n,F=E*E*E,I,L=0;L<12&&!(I=n*(1.340264+-.081106*E+F*(8.93E-4+.003796*E))-h,E=1.340264+3*-.081106*E+F*(7*8.93E-4+.034164*E),n-=I/=E,E=n*n,F=E*E*E,Math.abs(I)<.1);++L);return new T(ob*Fa*(r/6378137)*(1.340264+3*-.081106*E+F*(7*8.93E-4+.034164*E))/Math.cos(n),ob*Math.asin(Math.sin(n)/
Fa))}if(this.szMapProjection=="AlbersEqualArea")return gb(h,r,{lat1:this.nAlbersLat1,lat2:this.nAlbersLat2,lat0:this.nAlbersLat0,lon0:this.nAlbersLon0});if(this.szMapProjection=="LambertAzimuthalEqualArea")return mb(h,r,{lat0:this.nLambertLat0,lon0:this.nLambertLon0});if(this.szMapProjection=="Orthographic"){L=L={lat0:this.nOrthographicLat0,lon0:this.nOrthographicLon0};n=(L.lat0!==void 0?L.lat0:0)*Math.PI/180;E=(L.lon0!==void 0?L.lon0:0)*Math.PI/180;F=Math.sqrt(h*h+r*r);if(F>6378137)h=null;else{I=
Math.asin(F/6378137);L=Math.cos(I);I=Math.sin(I);var R=Math.cos(n),Z=Math.sin(n);h=F<1E-10?new T(E*180/Math.PI,n*180/Math.PI):new T((E+Math.atan2(h*I,F*R*L-r*Z*I))*180/Math.PI,Math.asin(L*Z+r*I*R/F)*180/Math.PI)}return h}if(this.szMapUnits!="feet"&&this.szMapUnits!="meter"&&this.szMapUnits!="meters")return new T(h,r);if(!this.szDatum&&!this.szUTMZone)return null;h=new T(h,r);this.nFalseEasting&&(h.x-=this.nFalseEasting-5E5);h.y-=this.nFalseNorthing+this.nCorrectNorthing;h.x-=this.nCorrectEasting;
h.y-=this.nCorrectNorthing;return Za(this.szDatum,h.y,h.x,this.szUTMZone)};v.Scale.prototype.isPointOnBacksideOrthographic=function(h,r){if(this.szMapProjection!=="Orthographic"||this.nOrthographicLat0===null||this.nOrthographicLon0===null)return!1;const n=this.nOrthographicLat0*Math.PI/180;h=h*Math.PI/180;return Math.sin(n)*Math.sin(h)+Math.cos(n)*Math.cos(h)*Math.cos(r*Math.PI/180-this.nOrthographicLon0*Math.PI/180)<0};v.Scale.prototype.getMapPosition=function(h,r){var n=A(this.zoomNode),E=n[0],
F=n[3],I=k.antiZoomAndPanList.getActualMatrix();h=h*I[0]+I[4];r=r*I[3]+I[5];h=h-this.mapPosition.x-this.mapOffset.x;r=r-this.mapPosition.y-this.mapOffset.y;h=(h-n[4])/E;r=(r-n[5])/F;return new T(h,r)};v.Scale.prototype.clipWidgetPositionToMap=function(h){h.x>=this.mapPosition.x+this.bBox.width&&(h.x=this.mapPosition.x+this.bBox.width);h.x<=this.mapPosition.x&&(h.x=this.mapPosition.x);h.y>=this.mapPosition.y+this.bBox.height&&(h.y=this.mapPosition.y+this.bBox.height);h.y<=this.mapPosition.y&&(h.y=
this.mapPosition.y);return h};v.Scale.prototype.isWidgetPositionInMap=function(h){return h.x>this.mapPosition.x+this.bBox.width||h.x<this.mapPosition.x||h.y>this.mapPosition.y+this.bBox.height||h.y<this.mapPosition.y?!1:!0};v.Scale.prototype.clipWidgetObjectToMap=function(h,r,n){h=k.Dom.getBox(h);r.x+n.x+h.width>this.mapPosition.x+this.bBox.width&&(r.x-=h.width+n.x*2);r.y+n.y+h.height>this.mapPosition.y+this.bBox.height&&(r.y-=h.height+n.y*2);return new T(r.x+n.x,r.y+n.y)};v.Scale.prototype.clipWidgetObjectToSVG=
function(h,r,n,E){E||=k.Dom.getBox(h);h.getAttributeNS(null,"clip-path")&&(h=h.getAttributeNS(null,"clip-path"),h.match(/url/)&&(h=h.substr(5,h.length-6),h=k.SVGDocument.getElementById(h)))&&(h=h.firstChild,E.x=Number(h.getAttributeNS(null,"x")),E.y=Number(h.getAttributeNS(null,"y")),E.width=Number(h.getAttributeNS(null,"width")),E.height=Number(h.getAttributeNS(null,"height")));h=new T(r.x+n.x,r.y+n.y);h.x+E.width>this.viewBox.width&&(h.x=r.x-E.width-n.x);h.x<0&&(h.x=k.Scale.normalX(5),n.y<=0&&(h.y-=
n.y,n.y=k.Scale.normalY(20),h.y+=n.y));h.y+E.height>this.viewBox.height&&(h.y=r.y-E.height-n.y);h.y<0&&(h.y=k.Scale.normalX(5));return h};v.Scale.prototype.getEmbedWidth=function(){if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null)try{var h=HTMLDocument.embeds[k.szEmbedName].clientWidth,r=h/HTMLDocument.embeds[k.szEmbedName].clientHeight,n=k.SVGWidth/k.SVGHeight;return r<n?h:n/r*h}catch(E){return k.SVGWidth}return k.fSVGEmbeded&&k.fEmbedScale?k.EmbedWidth.indexOf("%")!=-1?document.embeds.svgMain.clientWidth:
k.EmbedWidth:k.fPDFEmbed?(r=window.innerWidth/window.innerHeight,n=k.SVGWidth/k.SVGHeight,r<n?window.innerWidth:n/r*window.innerWidth):k.SVGWidth};v.Scale.prototype.getEmbedHeight=function(){if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null)try{var h=HTMLDocument.embeds[k.szEmbedName].clientHeight,r=HTMLDocument.embeds[k.szEmbedName].clientWidth/h,n=k.SVGWidth/k.SVGHeight;return n<r?h:r/n*h}catch(E){return k.SVGHeight}return k.fSVGEmbeded&&k.fEmbedScale?k.EmbedHeight.indexOf("%")!=-1?document.embeds.svgMain.clientHeight:
k.EmbedHeight:k.fPDFEmbed?(r=window.innerWidth/window.innerHeight,n=k.SVGWidth/k.SVGHeight,n<r?window.innerHeight:r/n*window.innerHeight):k.SVGHeight};v.Scale.prototype.getEmbedScale=function(){if(typeof HTMLDocument!="undefined"&&HTMLDocument!=null)try{var h=HTMLDocument.embeds[k.szEmbedName].clientWidth,r=HTMLDocument.embeds[k.szEmbedName].clientHeight,n=k.SVGWidth/k.SVGHeight;return n<h/r?r/k.SVGHeight:h/k.SVGWidth}catch(E){return 1}return k.fPDFEmbed?(h=window.innerWidth/window.innerHeight,n=
k.SVGWidth/k.SVGHeight,n<h?window.innerHeight/k.SVGHeight:window.innerWidth/k.SVGWidth):1};v.Scale.prototype.getTrueMapScale=function(){return k.fAdaptMapScaleToSize?this.nMapScale/this.getEmbedScale()*this.nPPI/this.nMapPPI:this.nMapScale*this.nPPI/this.nMapPPI};v.Scale.prototype.normalX=function(h){return h*this.nScaleX};v.Scale.prototype.normalY=function(h){return h*this.nScaleY};v.Scale.prototype.embedX=function(h){return h/this.nScaleX};v.Scale.prototype.embedY=function(h){return h/this.nScaleY};
v.Scale.prototype.scaleX=function(h){return h/k.SVGRootElement.currentScale*this.viewBox.width/this.getEmbedWidth()};v.Scale.prototype.scaleY=function(h){return h/k.SVGRootElement.currentScale*this.viewBox.height/this.getEmbedHeight()};v.Scale.prototype.toSVGx=function(h){return this.scaleX(h*k.SVGRootElement.currentScale-k.SVGRootElement.currentTranslate.x)+this.viewBox.x};v.Scale.prototype.toSVGy=function(h){return this.scaleY(h*k.SVGRootElement.currentScale-k.SVGRootElement.currentTranslate.y)+
this.viewBox.y};v.Scale.prototype.toScreenX=function(h){return(h-this.scaleX(-k.SVGRootElement.currentTranslate.x)+Number(viewBox[0]))/k.SVGRootElement.currentScale/viewBoxScale};v.Scale.prototype.toScreenY=function(h){return(h-this.scaleY(-k.SVGRootElement.currentTranslate.y)+Number(viewBox[3]))/k.SVGRootElement.currentScale/viewBoxScale};v.Scale.prototype.toMapX=function(h){return(h-this.scaleX(-k.SVGRootElement.currentTranslate.x)+Number(viewBox[0]))/k.SVGRootElement.currentScale/viewBoxScale};
v.Scale.prototype.toMapY=function(h){return(h-this.scaleY(-k.SVGRootElement.currentTranslate.y)+Number(viewBox[3]))/k.SVGRootElement.currentScale/viewBoxScale};v.Scale.prototype.getSVGOffset=function(h){var r=h;r.nodeName!="svg"&&(r=k.Dom.getParentByNodename(h,"svg"));return r&&r!=k.SVGRootElement&&(h=r.getAttribute("viewBox").split(" "),h.length==4)?new T(Number(h[0]),Number(h[1])):new T(0,0)};v.Scale.prototype.getGroupOffset=function(h){var r=new T(0,0);if(h)for(;h=h.parentNode;){if(h==k.Zoom.zoomNode||
h.nodeType!=1)return r;var n=A(h);r.x=r.x*n[0]+n[4];r.y=r.y*n[3]+n[5]}return new T(0,0)};v.Scale.prototype.getGroupScale=function(h){var r=new T(1,1);for(h=h.parentNode;h&&h.nodeType==1;){var n=N(h);n&&(r.x*=n.x,r.y*=n.y);h=h.parentNode}return r};v.Scale.prototype.getMapOffset=function(h){var r=this.getSVGOffset(h);h=this.getGroupOffset(h);return new T(-r.x+h.x,-r.y+h.y)};v.Scale.prototype.getScreenPosition=function(h){var r=this.getSVGOffset(h),n=this.getGroupOffset(h),E=D(h);if(h=k.Dom.getBox(h))E.x+=
h.x+h.width/2,E.y+=h.y+h.height/2;h=k.antiZoomAndPanList.getActualMatrix();var F=A(this.zoomNode);E=k.Scale.rotatePoint(E,-1);return new T((this.mapPosition.x+this.mapOffset.x+F[4]+(E.x-r.x+n.x)*F[0]-h[4])*h[0],(this.mapPosition.y+this.mapOffset.y+F[5]+(E.y-r.y+n.y)*F[3]-h[5])*h[3])};v.Scale.prototype.getClientMousePosition=function(h,r){var n=null;if(h){n=k.SVGDocument.parentNode.parentNode.offsetLeft;const F=k.SVGDocument.parentNode.parentNode.offsetTop;var E=k.fEmbedScale;k.fEmbedScale=!0;r&&k.antiZoomAndPanList&&
k.antiZoomAndPanList.isContained(r)?(n=new T(this.normalX(h.clientX-n),this.normalY(h.clientY-F)),h=new T(this.getEmbedScale(),this.getEmbedScale()),n.x/=h.x,n.y/=h.y):n=new T(this.toSVGx(h.clientX-n),this.toSVGy(h.clientY-F));r&&(r=k.Scale.getGroupScale(r),n.x/=r.x,n.y/=r.y);k.fEmbedScale=E}return n};v.Scale.prototype.refreshCSSStyles=function(){this.fCSSStyleNodeChanged&&(this.CSSStyleNodes.parentNode.parentNode.appendChild(this.CSSStyleNodes.parentNode),this.fCSSStyleNodeChanged=!1)};v.Scale.prototype.normalizeSymbols=
function(h){this.featureScaling_lastScale==1&&this.normalizeElements(h,/symbol/,k.nNormalSymbolSize);this.nSymbolSize=this.nNormalButtonSize};v.Scale.prototype.normalizeButtons=function(h){this.normalizeElements(h,/button/,this.nNormalButtonSize);this.normalizeElements(h,/icon/,this.nNormalButtonSize);this.nButtonSize=this.nNormalButtonSize};v.Scale.prototype.normalizeElements=function(h,r,n){if(h){var E=h.getElementsByTagName("g");h=[];for(var F=0;F<E.length;F++)h[F]=E.item(F);for(F=0;F<h.length;F++){E=
h[F];var I=E.getAttributeNS(null,"id");if(I&&I.match(r)){var L=k.SVGDocument.getElementById(I);L&&L!=E&&L.parentNode.removeChild(L);E.fu=new S(E);L=k.Dom.getBox(E);L.width===0&&(L=k.Dom.constructNode("use",k.SVGTempGroup,{"xlink:href":"#"+I}),L=k.Dom.getBox(L));var R=this.normalX(n)/L.height;E.fu.setPosition((-L.x-L.width/2)*R,(-L.y-L.height/2)*R);E.fu.scale(R,R);u.match(/Firefox/i)&&(E.setAttributeNS(null,"id",""),L=k.Dom.newGroup(E.parentNode),L=E.parentNode.insertBefore(L,E),L.appendChild(E),L.setAttributeNS(null,
"id",I))}}}k.Dom.clearGroup(k.SVGTempGroup)};v.Scale.prototype.changeRotation=function(h,r){var n=ia(k.Scale.canvasNode);n=(360+Number(n)+Number(r))%360;Y(k.Scale.canvasNode,n);k.Layer.setObjectRotate(h,-n);k.Layer.setPatternRotate(h,-n);k.Layer.setLabelRotate(h,-n)};v.Scale.prototype.setRotation=function(h,r){r=Math.floor(r);Y(k.Scale.canvasNode,r);k.Layer.setSymbolRotate(h,-r);k.Layer.setObjectRotate(h,-r);k.Layer.setPatternRotate(h,-r);k.Layer.setLabelRotate(h,-r);k.Themes&&k.Themes.resortCharts();
k.Dom.clearGroup(k.SVGToolsGroup);k.Dom.clearGroup(k.SVGFixedGroup);k.removeAllHighlights()};v.Scale.prototype.rotatePoint=function(h,r){var n=ia(k.Scale.canvasNode)/180*Math.PI;if(n){r==-1&&(n=-n);r=h.x;var E=h.y;h.x=r*Math.cos(n)+E*Math.sin(n);h.y=-r*Math.sin(n)+E*Math.cos(n)}return h};v.Scale.prototype.createWidgetStyles=function(){if(typeof h!="string")var h="font-family:arial;font-size:12px;fill:#444444;pointer-events:none;";if(typeof r!="string")var r=h;if(typeof n!="string")var n="font-family:arial;font-size:10px;fill:#888888;font-weight:bold;font-style:italic;pointer-events:none;";
if(typeof E!="string")var E="font-family:arial;font-size:11px;fill:#555555;;pointer-events:none;";if(typeof F!="string")var F="font-family:arial;font-size:10px;fill:#444444;pointer-events:none;";if(typeof I!="string")var I="font-family:arial;font-size:11px;fill:darkgrey;font-style:italic;stroke:none;pointer-events:none;";if(typeof L!="string")var L="font-family:arial;font-size:10px;fill:#798697;font-style:normal;stroke:none;pointer-events:none;";this.tStyle={};this.tStyle.ContainerTitle=this.createTextObject(h);
this.tStyle.InfoContainerTitle=this.createTextObject(r);this.tStyle.Description=this.createTextObject(n);this.tStyle.Snippet=this.createTextObject(E);this.tStyle.Summary=this.createTextObject(F);this.tStyle.Note=this.createTextObject(I);this.tStyle.Values=this.createTextObject(L)};v.Scale.prototype.createTextObject=function(h){var r={};r.szStyle=ma(h,this.normalY(1));a:{if(h=r.szStyle){h=h.split(";");for(var n=0;n<h.length;n++)if(h[n].match(/font-size/)){h=h[n].split(":");h=parseFloat(h[1]);break a}}h=
-1}r.nFontHeight=h;return r};v.Scale.prototype.getScaleParam=function(){var h={};this.nFeatureScaling&&this.nFeatureScaling!=1&&(h.featureScaling=this.nFeatureScaling);this.nBorderScaling&&this.nBorderScaling!=1&&(h.borderScaling=this.nBorderScaling);this.nLineScaling&&this.nLineScaling!=1&&(h.lineScaling=this.nLineScaling);this.nObjectScaling&&this.nObjectScaling!=1&&(h.objectScaling=this.nObjectScaling);this.nLabelScaling&&this.nLabelScaling!=1&&(h.labelScaling=this.nLabelScaling);this.nNormalSizeScale&&
this.nNormalSizeScale!=1&&(h.normalSizeScale=this.nNormalSizeScale);this.nDynamicScalePow&&this.nDynamicScalePow!=3&&(h.dynamicScalePow=this.nDynamicScalePow);return h};v.Scale.prototype.setScaleParam=function(h){var r=this.featureScaling_lastScale;this.nObjectScaling=this.nLabelScaling=this.nLineScaling=this.nBorderScaling=this.nFeatureScaling=1;h.featureScaling&&h.featureScaling!=1&&(this.nFeatureScaling=h.featureScaling);h.borderScaling&&h.borderScaling!=1&&(this.nBorderScaling=h.borderScaling);
h.lineScaling&&h.lineScaling!=1&&(k.Layer.changeLineScaling(null,h.lineScaling/this.nLineScaling),this.featureScaling_lastScale=r);h.labelScaling&&h.labelScaling!=1&&(k.Layer.changeLabelScaling(null,h.labelScaling/this.nLabelScaling),this.featureScaling_lastScale=r);h.objectScaling&&h.objectScaling!=1&&(this.nObjectScaling=h.objectScaling);h.normalSizeScale&&h.normalSizeScale!=1&&(this.nNormalSizeScale=Number(h.normalSizeScale));this.nDynamicScalePow=3;h.dynamicScalePow&&h.dynamicScalePow!=3&&(this.nDynamicScalePow=
Number(h.dynamicScalePow));k.Layer.doDynamicObjectScaling(k.Scale.nZoomScale)};var H=/matrix\(([^,]*)\)/,G=/matrix\(([0-9., -e]*)\)/,P=/rotate\(([0-9]*)\)/,M=/url\(#([a-zA-Z0-9\-\._:]*)\)/,T=function(h,r){this.x=h;this.y=r},qa=function(h,r,n,E){this.x=Number(h);this.y=Number(r);this.width=Number(n);this.height=Number(E)};qa.prototype.scale=function(h){var r=this.width*h;h*=this.height;this.x-=(r-this.width)/2;this.y-=(h-this.height)/2;this.width=r;this.height=h};qa.prototype.check=function(){return isNaN(this.x)||
isNaN(this.y)||isNaN(this.width)||isNaN(this.height)?!1:!0};v.Dom.prototype.getBox=function(h){try{var r=h.getBBox();return new qa(r.x,r.y,r.width,r.height)}catch(n){return new qa(0,0,0,0)}};W.prototype.getContextMenuId=function(){var h;for(h=this.objNode;h;h=h.parentNode)if(h.nodeType==1){var r=h.getAttributeNS(e,"menu");if(r&&r.length)return r}return null};W.prototype.setContextMenuId=function(h){this.objNode.setAttributeNS(e,"menu",h)};S.prototype.setMatrix=function(h){B(this.nodeObj,h)};S.prototype.getPosition=
function(){var h=A(this.nodeObj);return new T(Number(h[4]),Number(h[5]))};S.prototype.setPosition=function(h,r){var n=A(this.nodeObj);n[4]=h;n[5]=r;B(this.nodeObj,[n[0],n[1],n[2],n[3],n[4],n[5]])};S.prototype.scale=function(h,r){var n=A(this.nodeObj);n[0]=h;n[3]=r;B(this.nodeObj,[n[0],n[1],n[2],n[3],n[4],n[5]])};S.prototype.scaleBy=function(h,r){var n=this.getBox(),E=n.width/2+n.x;n=n.height/2+n.y;var F=A(this.nodeObj);F[0]*=h;F[3]*=r;h>1?(F[4]-=E*h-E,F[5]-=n*r-n):(F[4]-=E-E/h,F[5]-=n-n/r);B(this.nodeObj,
[F[0],F[1],F[2],F[3],F[4],F[5]])};S.prototype.rotateBy=function(h){Y(this.nodeObj,h)};S.prototype.getScale=function(){var h=A(this.nodeObj);return new T(Number(h[0]),Number(h[3]))};S.prototype.getParentScale=function(){var h=A(this.nodeObj.parentNode);return new T(Number(h[0]),Number(h[3]))};S.prototype.getGroupScale=function(){return k.Scale.getGroupScale(this.nodeObj)};S.prototype.scaleTo=function(h,r){var n=this.getBox();h&&r?this.scaleBy(h/n.width,r/n.height):h?this.scaleBy(h/n.width,h/n.width):
r&&this.scaleBy(r/n.height,r/n.height)};S.prototype.getBox=function(){var h=k.Dom.getBox(this.nodeObj),r=this.getScale();h=new qa(h.x,h.y,h.width,h.height);h.x*=r.x;h.y*=r.y;h.width*=r.x;h.height*=r.y;return h};S.prototype.getTextLength=function(){return this.nodeObj.nodeName=="text"?this.nodeObj.getComputedTextLength():0};S.prototype.focus=function(h,r,n){B(this.nodeObj,[n,0,0,n,Number(h*n),Number(r*n)])};S.prototype.clear=function(){k.Dom.clearGroup(this.nodeObj)};S.prototype.isContained=function(h){for(;h=
h.parentNode;)if(h==this.nodeObj)return!0;return!1};S.prototype.extendAllIds=function(h){k.Dom.extendAllIds(this.objNode,h)};v.CSS=function(h){this.stylesA=[];h=h.firstChild.nextSibling.nodeValue.split("}");for(var r=0;r<h.length;r++){var n=h[r].split("{")[0];n=n.split(".")[1];this.stylesA[n]=m(h[r].split("{")[1])}};v.CSS.prototype.getStyleString=function(){var h="",r;for(r in this.stylesA){h+=" ."+r+"{";for(var n in this.stylesA[r])h+=n+":"+this.stylesA[r][n]+";";h+="}"}return h};v.CSS.prototype.setStyle=
function(h,r,n){try{this.stylesA[h][r]=n}catch(E){}};ya.prototype.addGroup=function(h){this.listA[this.listA.length]=h};ya.prototype.buildList=function(h){h=k.SVGRootElement.childNodes;for(var r=0;r<h.length;r++)try{h.item(r).nodeType=="1"&&h.item(r).getAttributeNS(null,"id").match(/antizoomandpan/)&&this.addGroup(h.item(r))}catch(n){}};ya.prototype.isContained=function(h){for(;h;){if(this.checkGroup(h))return!0;h=h.parentNode}return!1};ya.prototype.checkGroup=function(h){for(var r=0;r<this.listA.length;r++)if(h==
this.listA[r])return!0;return!1};ya.prototype.adjustGroups=function(h){if(k.fAntiZoomAndPan){h=k.SVGRootElement.getAttribute("viewBox").split(" ");var r=k.SVGOrigViewBoxString.split(" ");r=Number(r[2])/Number(h[2]);for(var n,E=0;E<this.listA.length;E++){var F=this.listA[E];if(n=A(F))n[0]=1/k.SVGRootElement.currentScale/r,n[3]=1/k.SVGRootElement.currentScale/r,n[4]=k.Scale.scaleX(-k.SVGRootElement.currentTranslate.x)+Number(h[0]),n[5]=k.Scale.scaleY(-k.SVGRootElement.currentTranslate.y)+Number(h[1]),
B(F,n)}}};ya.prototype.getActualMatrix=function(h){return A(this.listA[0])};ya.prototype.setDisplay=function(h,r){for(h=0;h<this.listA.length;h++)this.listA[h].style.setProperty("display",r,"")};ya.prototype.initAntiZoomPattern=function(h,r){r===null&&(r=k.SVGDocument);h&&(r=h.target.ownerDocument);h=r.getElementsByTagName("pattern");if(h!==null&&h.length!==0){r=h.length;for(var n=h.item(0).parentNode,E,F=0;F<r;F++)h.item(F).getAttributeNS(null,"id").match(/antizoomandpan/)||(E=h.item(F).cloneNode(1E3),
E.setAttributeNS(null,"id",E.getAttributeNS(null,"id")+":antizoomandpan"),n.appendChild(E));n.parentNode.appendChild(n)}};ya.prototype.initAntiZoomSymbols=function(h,r){if(r!==null&&(h=r.getElementsByTagName("g"),h!==null&&h.length!==0)){r=h.length;for(var n=h.item(0).parentNode,E,F=0;F<r;F++){var I=h.item(F).getAttributeNS(null,"id");I&&I.length&&I.match(/symbol/)&&!I.match(/antizoomandpan/)&&(E=h.item(F).cloneNode(1E3),E.setAttributeNS(null,"id",I+":antizoomandpan"),n.appendChild(E))}n.parentNode.appendChild(n)}};
ya.prototype.extendAllPatternStyles=function(h,r,n){r&&r.nodeType==1&&(h=r.style.getPropertyValue("fill"))&&h.length>1&&h.match(/url/)&&(h=h.split(")")[0]+n+")",r.style.setProperty("fill",h,""))};ya.prototype.initAntiZoomStyles=function(h){var r=k.SVGDocument.getElementById("widgets:antizoomandpan");this.extendAllPatternStyles(h,r,":antizoomandpan")};var X=null,ja=function(){this.szDictionary=[]};k.Dictionary=new ja;ja.prototype.add=function(h,r){this.szDictionary[h]||(this.szDictionary[h]=r)};ja.prototype.replace=
function(h,r){this.szDictionary[h]=r};ja.prototype.getLocalText=function(h){try{if(typeof this.szDictionary[h]!="undefined")return String(this.szDictionary[h]);for(var r="",n=h.split(" "),E=0;E<n.length;E++){var F=this.szDictionary["'"+n[E]+"'"];r+=String(F?F:n[E]);r+=E<n.length-1?" ":""}return r}catch(I){return h}};ja.prototype.applyToNode=function(h){h=h.getElementsByTagName("text");for(var r=0;r<h.length;r++)h.item(r).firstChild.nodeValue=this.getLocalText(h.item(r).firstChild.nodeValue)};var da=
null,sa=null,Aa=0,V=new Date,ea=null,Va=null,Sa=null,Ja=12,tb=0,Ma=new O;O.prototype.add=function(h){this.loaderA[this.loaderA.length]=h};O.prototype.evalScripts=function(){if(this.isLoading()===!1){for(var h=0;h<this.loaderA.length;h++)for(var r=this.loaderA[h],n=0;n<r.loadedScripts.length;n++)this.isScriptLoaded(r.szUrl)||(this.evalScript(r.loadedScripts[n]),this.setScriptLoaded(r.szUrl));this.loaderA.length=0}};O.prototype.evalScript=function(){eval(arguments[0])};O.prototype.setScriptError=function(h){this.errorUrlA[this.errorUrlA.length]=
h};O.prototype.setScriptLoaded=function(h){this.loadedUrlA[this.loadedUrlA.length]=h};O.prototype.setScriptLoading=function(h){this.loadingUrlA[this.loadingUrlA.length]=h};O.prototype.isScriptLoaded=function(h){for(var r=0;r<this.loadedUrlA.length;r++)if(this.loadedUrlA[r]==h)return!0;return!1};O.prototype.isScriptLoading=function(h){for(var r=0;r<this.loadingUrlA.length;r++)if(this.loadingUrlA[r]==h)return!0;return!1};O.prototype.isScriptError=function(h){for(var r=0;r<this.errorUrlA.length;r++)if(this.errorUrlA[r]==
h)return!0;return!1};O.prototype.resetScriptLoading=function(h){for(var r=0;r<this.loadingUrlA.length;r++)this.loadingUrlA[r]==h&&(this.loadingUrlA[r]="");for(r=0;r<this.loadedUrlA.length;r++)this.loadedUrlA[r]==h&&(this.loadedUrlA[r]="");for(r=0;r<this.errorUrlA.length;r++)this.errorUrlA[r]==h&&(this.errorUrlA[r]="")};O.prototype.isLoading=function(){var h;for(h=0;h<this.loaderA.length;h++)if(this.loaderA[h].reqCnt>0)return!0;return!1};t.prototype.loadScript=function(h,r){r&&this.pool.resetScriptLoading(h);
try{h.match(/./)||(h+=this.pool.szSuffix),this.szUrl=h,this.pool.isScriptError(this.szUrl)?typeof this.errorCallback==="function"?this.errorCallback():eval(this.errorCallback):this.pool.isScriptLoaded(this.szUrl)?typeof this.finishedCallback==="function"?this.finishedCallback():eval(this.finishedCallback):this.pool.isScriptLoading(this.szUrl)||(this.isLoading=!0,this.reqCnt++,this.pool.setScriptLoading(this.szUrl),d(h,this))}catch(n){}};t.prototype.operationComplete=function(h,r,n){h!=200||!r&&!n?
(this.pool.setScriptError(this.szUrl),this.errorCallback&&(this.finishedCallback=null,typeof this.errorCallback==="function"?this.errorCallback():eval(this.errorCallback))):this.loadedScripts.push(n);this.reqCnt--;this.reqCnt<=0&&this.evalScripts()};t.prototype.processImported=function(h){alert(h)};t.prototype.evalScripts=function(){this.pool.evalScripts();this.isLoading=!1;this.finishedCallback&&(typeof this.finishedCallback==="function"?this.finishedCallback():eval(this.finishedCallback))};t.prototype.isLoading=
function(){return this.reqCnt>0};const Eb=function(h){return(Math.exp(h)-Math.exp(-h))/2},sb=Math.PI/180,ob=180/Math.PI,eb=Math.atan(Eb(Math.PI))*ob,Ka={WGS84:{_EquatorialRadius:6378137,_eccentricitySquared:.00669438},Airy:{_EquatorialRadius:6377563,_eccentricitySquared:.00667054},"Australian National":{_EquatorialRadius:6378160,_eccentricitySquared:.006694542},"Bessel 1841":{_EquatorialRadius:6377397,_eccentricitySquared:.006674372},"Bessel 1841 (Nambia]":{_EquatorialRadius:6377484,_eccentricitySquared:.006674372},
"Clarke 1866":{_EquatorialRadius:6378206,_eccentricitySquared:.006768658},"Clarke 1880":{_EquatorialRadius:6378249,_eccentricitySquared:.006803511},Everest:{_EquatorialRadius:6377276,_eccentricitySquared:.006637847},"Fischer 1960 (Mercury]":{_EquatorialRadius:6378166,_eccentricitySquared:.006693422},"Fischer 1968":{_EquatorialRadius:6378150,_eccentricitySquared:.006693422},"GRS 1967":{_EquatorialRadius:6378160,_eccentricitySquared:.006694605},"GRS 1980":{_EquatorialRadius:6378137,_eccentricitySquared:.00669438},
"Helmert 1906":{_EquatorialRadius:6378200,_eccentricitySquared:.006693422},Hough:{_EquatorialRadius:6378270,_eccentricitySquared:.00672267},International:{_EquatorialRadius:6378388,_eccentricitySquared:.00672267},Krassovsky:{_EquatorialRadius:6378245,_eccentricitySquared:.006693422},"Modified Airy":{_EquatorialRadius:6377340,_eccentricitySquared:.00667054},"Modified Everest":{_EquatorialRadius:6377304,_eccentricitySquared:.006637847},"Modified Fischer 1960":{_EquatorialRadius:6378155,_eccentricitySquared:.006693422},
"South American 1969":{_EquatorialRadius:6378160,_eccentricitySquared:.006694542},"WGS 60":{_EquatorialRadius:6378165,_eccentricitySquared:.006693422},"WGS 66":{_EquatorialRadius:6378145,_eccentricitySquared:.006694542},"WGS-72":{_EquatorialRadius:6378135,_eccentricitySquared:.006694318},"WGS-84":{_EquatorialRadius:6378137,_eccentricitySquared:.00669438}},oa=function(h,r,n,E){Ka[h]||(h="WGS84");var F=Ka[h]._EquatorialRadius;h=Ka[h]._eccentricitySquared;var I=n+180-Math.floor((n+180)/360)*360-180;
n=r*sb;var L=I*sb,R=Math.floor((I+180)/6)+1;r>=56&&r<64&&I>=3&&I<12&&(R=32);r>=72&&r<84&&(I>=0&&I<9?R=31:I>=9&&I<21?R=33:I>=21&&I<33?R=35:I>=33&&I<42&&(R=37));E&&E.length&&(R=parseInt(E));E=h/(1-h);I=F/Math.sqrt(1-h*Math.sin(n)*Math.sin(n));var Z=Math.tan(n)*Math.tan(n),na=E*Math.cos(n)*Math.cos(n);L=Math.cos(n)*(L-((R-1)*6-180+3)*sb);F=.9996*(F*((1-h/4-3*h*h/64-5*h*h*h/256)*n-(3*h/8+3*h*h/32+45*h*h*h/1024)*Math.sin(2*n)+(15*h*h/256+45*h*h*h/1024)*Math.sin(4*n)-35*h*h*h/3072*Math.sin(6*n))+I*Math.tan(n)*
(L*L/2+(5-Z+9*na+4*na*na)*L*L*L*L/24+(61-58*Z+Z*Z+600*na-330*E)*L*L*L*L*L*L/720));r<0&&(F+=1E7);return new T(.9996*I*(L+(1-Z+na)*L*L*L/6+(5-18*Z+Z*Z+72*na-58*E)*L*L*L*L*L/120)+5E5,F)},Za=function(h,r,n,E){Ka[h]||(h="WGS84");if(!E)return null;var F=Ka[h]._EquatorialRadius;h=Ka[h]._eccentricitySquared;var I=(1-Math.sqrt(1-h))/(1+Math.sqrt(1-h));n-=5E5;var L=r;r=parseInt(E);E.substr(E.length-1,1)>="N"||(L-=1E7);E=h/(1-h);L=L/.9996/(F*(1-h/4-3*h*h/64-5*h*h*h/256));I=L+(3*I/2-27*I*I*I/32)*Math.sin(2*L)+
(21*I*I/16-55*I*I*I*I/32)*Math.sin(4*L)+151*I*I*I/96*Math.sin(6*L);var R=F/Math.sqrt(1-h*Math.sin(I)*Math.sin(I));L=Math.tan(I)*Math.tan(I);var Z=E*Math.cos(I)*Math.cos(I);n/=R*.9996;F=I-R*Math.tan(I)/(F*(1-h)/Math.pow(1-h*Math.sin(I)*Math.sin(I),1.5))*(n*n/2-(5+3*L+10*Z-4*Z*Z-9*E)*n*n*n*n/24+(61+90*L+298*Z+45*L*L-252*E-3*Z*Z)*n*n*n*n*n*n/720);F*=ob;h=(n-(1+2*L+Z)*n*n*n/6+(5-2*Z+28*L-3*Z*Z+8*E+24*L*L)*n*n*n*n*n/120)/Math.cos(I);h=(r-1)*6-180+3+h*ob;return new T(h,F)},Db=function(h,r){h=Math.max(Math.min(h,
eb),-eb);return new T(r,Math.log(Math.tan(Math.PI/4+h*sb/2))*ob)},Oa=function(h,r){var n;r-0<-180&&(r=-180);r-0>180&&(r=180);h*=sb;r=.5*sb*(r-0);var E=Math.acos(Math.cos(h)*Math.cos(r));if(E===0)var F=n=0;else n=Math.sin(h)/Math.sin(E),E*=6378137,F=2*E*Math.sqrt(1-n*n),F=F<0&&r>0?-F:F>0&&r<0?-F:F,n*=E;return new T(.5*(F+12756274*r*Math.cos(50.467)),.5*(n+6378137*h))},Fa=Math.sqrt(3)/2,ra=function(h,r){h*=sb;r*=sb;h=Math.asin(Fa*Math.sin(h));var n=h*h,E=n*n*n;return new T(6378137*r*Math.cos(h)/(Fa*
(1.340264+3*-.081106*n+E*(7*8.93E-4+.034164*n))),6378137*h*(1.340264+-.081106*n+E*(8.93E-4+.003796*n)))},Qa=function(h,r,n){let E,F,I;if(k&&k.Scale&&k.Scale._albersConstants){var L=k.Scale._albersConstants;E=L.a;F=L.e;I=L.e2;var R=L.n;var Z=L.C;var na=L.\u03c10;n=L.\u03bb0;L=L.calcQ}else{n=n||{};var fa=(n.lat1!==void 0?n.lat1:29.5)*Math.PI/180;R=(n.lat2!==void 0?n.lat2:45.5)*Math.PI/180;na=(n.lat0!==void 0?n.lat0:23)*Math.PI/180;n=(n.lon0!==void 0?n.lon0:-96)*Math.PI/180;E=6378137;F=.0818191908426;
I=F*F;L=function(Ea){const U=F*Ea;return(1-I)*(Ea/(1-I*Ea*Ea)-1/(2*F)*Math.log((1-U)/(1+U)))};const la=Ea=>{const U=Math.sin(Ea);return Math.cos(Ea)/Math.sqrt(1-I*U*U)};na=L(Math.sin(na));Z=L(Math.sin(fa));const Na=L(Math.sin(R));fa=la(fa);R=la(R);R=(fa*fa-R*R)/(Na-Z);Z=fa*fa+R*Z;na=E/R*Math.sqrt(Z-R*na)}r=r*Math.PI/180;h=L(Math.sin(h*Math.PI/180));h=E/R*Math.sqrt(Z-R*h);n=R*(r-n);return new T(h*Math.sin(n),na-h*Math.cos(n))},xb=function(h,r,n){let E,F;if(k&&k.Scale&&k.Scale._lambertConstants){var I=
k.Scale._lambertConstants;var L=I.a;E=I.e;F=I.e2;var R=I.\u03bb0;var Z=I.qp;var na=I.sinBeta0;n=I.cosBeta0;L=I.Rq;I=I.calcQ}else n=n||{},na=(n.lat0!==void 0?n.lat0:0)*Math.PI/180,R=(n.lon0!==void 0?n.lon0:0)*Math.PI/180,L=6378137,n=1/298.257222101,F=2*n-n*n,E=Math.sqrt(F),I=fa=>{fa=Math.sin(fa);const la=E*fa;return(1-F)*(fa/(1-F*fa*fa)-1/(2*E)*Math.log((1-la)/(1+la)))},Z=(1-F)*(1/(1-F)-1/(2*E)*Math.log((1-E)/(1+E))),na=I(na)/Z,n=Math.sqrt(Math.max(0,1-na*na)),L*=Math.sqrt(.5*Z);r=r*Math.PI/180-R;
h=I(h*Math.PI/180)/Z;R=Math.sqrt(Math.max(0,1-h*h));Z=Math.cos(r);I=Math.sqrt(Math.max(0,2/Math.max(1E-15,1+na*h+n*R*Z)));return new T(L*I*R*Math.sin(r),L*I*(n*h-na*R*Z))},gb=function(h,r,n){let E,F;if(k&&k.Scale&&k.Scale._albersConstants){n=k.Scale._albersConstants;var I=n.a;E=n.e;F=n.e2;var L=n.n;var R=n.C;var Z=n.\u03c10;n=n.\u03bb0}else{n=n||{};R=(n.lat1!==void 0?n.lat1:29.5)*Math.PI/180;L=(n.lat2!==void 0?n.lat2:45.5)*Math.PI/180;Z=(n.lat0!==void 0?n.lat0:23)*Math.PI/180;n=(n.lon0!==void 0?n.lon0:
-96)*Math.PI/180;I=6378137;var na=1/298.257222101;F=2*na-na*na;E=Math.sqrt(F);var fa=function(Na){const Ea=E*Na;return(1-F)*(Na/(1-F*Na*Na)-1/(2*E)*Math.log((1-Ea)/(1+Ea)))},la=Na=>{const Ea=Math.sin(Na);return Math.cos(Na)/Math.sqrt(1-F*Ea*Ea)};Z=fa(Math.sin(Z));na=fa(Math.sin(R));fa=fa(Math.sin(L));R=la(R);L=la(L);L=(R*R-L*L)/(fa-na);R=R*R+L*na;Z=I/L*Math.sqrt(R-L*Z)}na=Math.sqrt(h*h+(Z-r)*(Z-r));h=Math.atan2(h,Z-r);r=(R-na*L/I*(na*L/I))/L;I=Math.asin(r/2);for(Z=0;Z<10&&!(R=Math.sin(I),na=E*R,la=
1-F*R*R,R=(r-(1-F)*(R/la-1/(2*E)*Math.log((1-na)/(1+na))))/((1-F)/la),I+=R,Math.abs(R)<1E-10);Z++);return new T((n+h/L)*180/Math.PI,I*180/Math.PI)},mb=function(h,r,n){let E,F;let I,L;if(k&&k.Scale&&k.Scale._lambertConstants){var R=k.Scale._lambertConstants;var Z=R.a;E=R.e;F=R.e2;n=R.\u03bb0;var na=R.qp;I=R.sinBeta0;L=R.cosBeta0;var fa=R.Rq;var la=R.calcQ;Z=R.inverseQ;R=R.\u03c60}else n=n||{},R=(n.lat0!==void 0?n.lat0:0)*Math.PI/180,n=(n.lon0!==void 0?n.lon0:0)*Math.PI/180,Z=6378137,na=1/298.257222101,
F=2*na-na*na,E=Math.sqrt(F),la=Na=>{Na=Math.sin(Na);const Ea=E*Na;return(1-F)*(Na/(1-F*Na*Na)-1/(2*E)*Math.log((1-Ea)/(1+Ea)))},na=(1-F)*(1/(1-F)-1/(2*E)*Math.log((1-E)/(1+E))),I=la(R)/na,L=Math.sqrt(Math.max(0,1-I*I)),fa=Z*Math.sqrt(.5*na),Z=Na=>{let Ea=Math.asin(Math.max(-1,Math.min(1,Na/2)));for(let lb=0;lb<12;lb++){var U=Math.sin(Ea);const cb=E*U,pb=1-F*U*U;U=(Na-(1-F)*(U/pb-1/(2*E)*Math.log((1-cb)/(1+cb))))/((1-F)/pb);Ea+=U;if(Math.abs(U)<1E-12)break}return Ea};la=Math.sqrt(h*h+r*r);if(la<1E-12)return new T(n*
180/Math.PI,R*180/Math.PI);fa=2*Math.asin(Math.min(1,la/(2*fa)));R=Math.sin(fa);fa=Math.cos(fa);h=n+Math.atan2(h*R,la*L*fa-r*I*R);r=Z(na*(fa*I+r*R*L/la));return new T(h*180/Math.PI,r*180/Math.PI)},Wa=function(h,r,n){n=n||{};const E=(n.lat0!==void 0?n.lat0:0)*Math.PI/180;h=h*Math.PI/180;r=r*Math.PI/180-(n.lon0!==void 0?n.lon0:0)*Math.PI/180;n=Math.cos(h);return new T(6378137*n*Math.sin(r),6378137*(Math.cos(E)*Math.sin(h)-Math.sin(E)*n*Math.cos(r)))};window.ixMap=v;window.map=k;window.getMatrix=A;window.setMatrix=
B;window.getTranslate=D;window.setTranslate=J;window.getScale=N;window.setScale=function(h,r,n){if(h){var E=A(h);E[0]=r;E[3]=n;B(h,[E[0],E[1],E[2],E[3],E[4],E[5]],!0)}};window.getRotateAttributeValue=ia;window.setRotate=Y;window.getPatternMatrix=function(h){if(h){if((h=h.getAttribute("patternTransform"))&&(h=h.match(H)))return h=h[1].split(" "),[Number(h[0]),Number(h[1]),Number(h[2]),Number(h[3]),Number(h[4]),Number(h[5])];if(h&&=h.match(G))return h=h[1].split(","),[Number(h[0]),Number(h[1]),Number(h[2]),
Number(h[3]),Number(h[4]),Number(h[5])]}return[1,0,0,1,0,0]};window.activateTheme=function(h){if(!h.match(/:label/)&&(h=k.Tiles.getMasterId(h),k._activeTheme!=h&&h!="mapcanvas")){var r=k.SVGDocument.getElementById("legend:ident:"+h);if(r){ca();k._legendIdent=r;if((r=k._legendIdent.nextSibling.nextSibling)&&r.nodeName=="text")try{var n=k.Dom.getBox(r);k._legendIdent.setAttributeNS(null,"width",n.width+k.Scale.normalX(10))}catch(F){}k._legendIdent.style.setProperty("display","inline","");k._activeTheme=
h;if(k.fActiveThemeInfo){n=new T(k.Scale.mapPosition.x,k.Scale.mapPosition.y+k.Scale.normalX(k.nToolMarginTop));k.Viewport.szPopupAlignment.match(/TOP/)&&(n.y=k.Scale.bBox.height+k.Scale.mapPosition.y-k.Scale.normalY(38));n=new InfoContainer(k.SVGDocument,k.SVGMenuGroup,"movable",n,{x:k.Scale.normalX(5),y:k.Scale.normalY(5)},"fix");n.frameNode.style.setProperty("fill","#fafafa","");n.setTitle("info on");n.setOnRemove("clearThemes()");var E=k.Scale.tStyle.Description.szStyle;k.Dom.newText(n.workspaceNode,
k.Scale.normalX(5),k.Scale.tStyle.Description.nFontHeight,E,r.firstChild.nodeValue);n.reformat()}try{k.HTMLWindow.ixmaps.htmlgui_setActiveTheme(h)}catch(F){}try{k.Themes.redrawInfoAll(null)}catch(F){}}else{ca();_removeInfo(null);k._activeTheme=h;try{k.HTMLWindow.ixmaps.htmlgui_setActiveTheme(h)}catch(F){}try{k.Themes.redrawInfoAll(null)}catch(F){}}k.Layer.setPointerEvents(k._activeTheme);k._activeItem=null}};window.getActiveTheme=function(){return k._activeTheme};window.isActiveTheme=Ua;window.deactivateTheme=
function(h){Ua(h)&&ca()};window.clearThemes=ca;window.displayTooltip=function(h,r){if(r&&r.nodeType==1){for(var n=r.getAttributeNS(e,"tooltip")||"";(r=r.parentNode)!=null&&r.nodeName=="g";){var E=r.getAttributeNS(e,"tooltip");E&&E.length&&(n=E)}if(n&&n.length){try{n=k.User.onTooltipDisplay(null,n,r)}catch(I){}try{n=k.HTMLWindow.ixmaps.htmlgui_onTooltipDisplay(h,n)}catch(I){}l&&clearTimeout(l);if(n&&n.length){h=k.Scale.getClientMousePosition(h,k.SVGPopupGroup);ka();r=setTimeout;if(n&&n.length){E=n.split('"');
n=E[0];for(var F=1;F<E.length;F++)n+="``"+E[F]}l=r('doDisplayTooltip("'+n+'",'+h.x+","+h.y+")",500)}return!0}}return!1};window.killTooltip=ka;window.displayMessage=ha;window.clearMessage=wa;window.point=T;window.box=qa;window.initAll=function(h,r){console.log("*** iXMaps mapscript version: "+k.version);K(h,null);setTimeout("delayedInitAll(null,'"+r+"')",10)};window.delayedInitAll=function(h,r){if(window.innerWidth<=0||window.innerHeight<=0)console.log("window dimension is zero -> no map"),setTimeout("delayedInitAll(null,'"+
r+"')",1E3);else if(!k.fInitializing)if(k.fInitializing=!0,K(h,null),k.hideAll(),k.Dom=new v.Dom(h),k.SVGRootElement=k.SVGDocument,k.fSVGEmbeded&&(h=k.Dom.newNode("g",k.SVGRootElement),h.setAttribute("id","embed"),h.setAttribute("name",r)),k.rootGroup=k.Dom.newGroup(k.SVGRootElement,"objects:antizoomandpan"),k.SVGToolsGroup=k.Dom.newGroup(k.rootGroup,"ToolsGroup"),k.SVGFixedGroup=k.Dom.newGroup(k.rootGroup,"FixedGroup"),k.SVGThemeGroup=k.Dom.newGroup(k.rootGroup,"ThemeGroup"),k.SVGThemeGroup.style.setProperty("display",
"none",""),k.SVGPopupGroup=k.Dom.newGroup(k.rootGroup,"PopupGroup"),k.SVGNotifyGroup=k.Dom.newGroup(k.rootGroup,"NotifyGroup"),k.SVGMessageGroup=k.Dom.newGroup(k.rootGroup,"MessageGroup"),k.SVGMenuGroup=k.Dom.newGroup(k.rootGroup,"MenuGroup"),k.SVGTltipGroup=k.Dom.newGroup(k.rootGroup,"TltipGroup"),k.SVGHiddenGroup=k.Dom.newGroup(k.rootGroup,"HiddenGroup"),k.SVGHiddenGroup.style.setProperty("display","none",""),k.SVGTempGroup=k.Dom.newGroup(k.rootGroup,"TempGroup"),k.SVGWidth=parseInt(k.SVGRootElement.getAttribute("width")),
k.SVGHeight=parseInt(k.SVGRootElement.getAttribute("height")),k.SVGOrigViewBoxString=k.SVGRootElement.getAttribute("viewBox"),k.SVGViewBox=k.SVGRootElement.getAttribute("viewBox").split(" "),k.SVGViewBox[0]=Number(k.SVGViewBox[0]),k.SVGViewBox[1]=Number(k.SVGViewBox[1]),k.SVGViewBox[2]=Number(k.SVGViewBox[2]),k.SVGViewBox[3]=Number(k.SVGViewBox[3]),k.Scale=new v.Scale,k.Scale.scaleNode&&k.Scale.extentNode){k.Scale.superclass=k;if(k.fAllIncluded||k.fPDFEmbed)k.Scale.createWidgetStyles(),k.Scale.normalizeSymbols(k.SVGDocument.getElementById("symbolstore")),
k.Scale.normalizeButtons(k.SVGDocument.getElementById("widgetstore")),k.Event=new v.Event,k.Event.initUseNodes(k.SVGDocument.getElementById("widgetstore"));else{k.pushAction(()=>{k.Scale.createWidgetStyles()});k.pushAction(()=>{k.Scale.normalizeSymbols(k.SVGDocument.getElementById("symbolstore"))});k.pushAction(()=>{k.Scale.normalizeButtons(k.SVGDocument.getElementById("widgetstore"))});try{typeof k.HTMLWindow.ixmaps.SVGResources_includePath!="undefined"?k.Loader.importSVGFile(k.HTMLWindow.ixmaps.SVGResources_includePath+
"/maplocal.svg",k.SVGDocument,k.SVGTempGroup,null):typeof ixmaps.szResourceBase!="undefined"?k.Loader.importSVGFile(ixmaps.szResourceBase+"/maps/svg/resources/svg/maplocal.svg",k.SVGDocument,k.SVGTempGroup,null):k.Loader.importSVGFile("../../maps/svg/resources/svg/maplocal.svg",k.SVGDocument,k.SVGTempGroup,null)}catch(n){}}k.SVGDocument.getElementById(k.szShadowFilterToolsId)||(h=k.Dom.newNode("filter",k.rootGroup),h.setAttributeNS(null,"id",k.szShadowFilterToolsId),h.setAttributeNS(null,"filterUnits",
"objectBoundingBox"),h.setAttributeNS(null,"x","-50%"),h.setAttributeNS(null,"y","-50%"),h.setAttributeNS(null,"width","200%"),h.setAttributeNS(null,"height","200%"),r=k.Dom.newNode("feGaussianBlur",h),r.setAttributeNS(null,"stdDeviation","50"),r.setAttributeNS(null,"result","BlurAlpha"),r=k.Dom.newNode("feOffset",h),r.setAttributeNS(null,"in","BlurAlpha"),r.setAttributeNS(null,"dx","20"),r.setAttributeNS(null,"dy","20"),r.setAttributeNS(null,"result","OffsetBlurAlpha"),r=k.Dom.newNode("feColorMatrix",
h),r.setAttributeNS(null,"in","OffsetBlurAlpha"),r.setAttributeNS(null,"type","matrix"),r.setAttributeNS(null,"values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"),r.setAttributeNS(null,"result","matrixOut"),r=k.Dom.newNode("feMerge",h),h=k.Dom.newNode("feMergeNode",r),h.setAttributeNS(null,"in","matrixOut"),h=k.Dom.newNode("feMergeNode",r),h.setAttributeNS(null,"in","SourceGraphic"));u.match(/Firefox/i)&&(k.pushAction(()=>{k.Scale.normalizeSymbols(k.SVGDocument.getElementById("symbolstore"))}),k.pushAction(()=>
{k.Scale.normalizeButtons(k.SVGDocument.getElementById("widgetstore"))}));x++;k.fLoadIncludes&&(k.fLoadIncludes=="delayed"?k.pushInitAction(()=>{q()}):q());k.fAllIncluded||k.fPDFEmbed?Ha():k.pushInitAction(()=>{Ha(null)}," ... ")}else alert("SVG source not valid SVGGIS map !")};window.getData=d;window.AntiZoomAndPan=ya;window.createTextField=f;window.sizeTextField=a;window.executeWithMessage=function(h,r,n){typeof n=="undefined"&&(n=250);k.fExecuteSilent?typeof h==="function"?setTimeout(function(){p(h)},
n):setTimeout('doExecuteWithMessage("'+ba(h)+'")',n):(ha(r,null,k.szMessagePosition),typeof h==="function"?setTimeout(function(){p(h)},n):(console.warn("executeWithMessage: String-based execution is deprecated. Please pass a function."),setTimeout('doExecuteWithMessage("'+ba(h)+'")',n)))};window.doExecuteWithMessage=p;window.executeWithProgressBar=function(h,r,n,E,F,I){c(r,n,E,0,F,I);setTimeout(h,1)};window.__timer_getSEC=function(){return((new Date).getTime()-tb)/1E3};window.__timer_reset=function(){tb=
(new Date).getTime()};window.__formatValue=w;window.__getStyleObj=function(h){if(h===null||h.length<2)return null;try{k.styleObj={};for(var r=h.split(";"),n=0;n<r.length;n++)if(r[n].length){var E=r[n].split(":"),F=E[0].length+1,I=r[n].substr(F,r[n].length-F);try{k.styleObj[E[0].trim()]=JSON.parse(I)}catch(L){k.styleObj[E[0].trim()]=I}}return k.styleObj}catch(L){alert("ERROR parsing: "+h)}return null};window.__getStyleArray=m;window.__scaleStyleString=ma;window.__scaleLineStyleString=function(h,r){if(!h||
!r)return null;h=h.split(";");for(var n,E=0;E<h.length;E++)if(h[E].match(/stroke-width/))n=h[E].split(":"),n[1]=String(parseFloat(n[1])*r),h[E]=n.join(":");else if(h[E].match(/stroke-dashoffset/))n=h[E].split(":"),n[1]=String(parseFloat(n[1])*r),h[E]=n.join(":");else if(h[E].match(/stroke-dasharray/)){n=h[E].split(":");var F=n[1].split(",");F.length>1?(h[E]=n[0]+":",n=0):(F=n[1].split(" "),h[E]=n[0]+":",n=0);for(;n<F.length;n++)F[n]=String(parseFloat(F[n])*r),h[E]+=F[n],n<F.length-1&&(h[E]+=",")}return h.join(";")};
window.__scaleTextStyleString=function(h,r){if(!h||!r)return null;h=h.split(";");for(var n,E=0;E<h.length;E++)h[E].match(/font-size/)&&(n=h[E].split(":"),n[1]=String(parseFloat(n[1])*r)+"px",h[E]=n.join(":"));return h.join(";")};window.highlightTheme=function(h){for(;h&&h.objNode.nodeName!="g"&&h.objNode.parentNode;)if((h=new W(h.objNode.parentNode))===null)return;var r=h.szId;k.Tiles&&(r=k.Tiles.getMasterId(r));var n=h.objNode.getAttributeNS(e,"value");(!n||n.length<1)&&h.objNode.firstChild&&h.objNode.firstChild.nextSibling&&
(n=h.objNode.firstChild.nextSibling.getAttributeNS(e,"value"));n&&n.length&&(r=r.split("::")[0]+"::"+n);if(X=k.SVGDocument.getElementById("legend:ident:"+r))(h=X.nextSibling.nextSibling)&&h.nodeName=="text"&&(h=k.Dom.getBox(h),X.setAttributeNS(null,"width",h.width+k.Scale.normalX(10))),X.style.setProperty("display","inline","")};window.highlightThemeRemove=function(){X&&(X.style.setProperty("display","none",""),X=null)};window.nInfoTimeout=250;window.loadSVGIncludes=function(h,r,n){alert("ohhh");
h=h?h.target.ownerDocument:k.SVGDocument;var E=h.getElementById("mapinclude");if(E){if(r&&r.length>1){var F=r.substr(r.length-1,1);F!="\\"&&F!="/"&&(r+="/")}E=E.getElementsByTagName("g");for(F=0;F<E.length;F++){var I=E.item(F),L=I.getAttribute("xlink:href");!L||L.match(/maplocal/)||L.match(/mapmenu/)||L.match(/mapimages/)||L.match(/mappattern/)||L.match(/mapfilter/)||!(L&&L.length>1)||n&&L!=n||(L=r+L,new z,k.Loader.importSVGFile(L,h,I,null))}}};window.MapObject=W;window.Methods=S;window._TRACE=function(h){if(typeof console!=
"undefined"&&typeof console.log!="undefined"){var r=new Date,n=r-V;V=r;console.log("_TRACE: time["+n+"] "+h)}else if(!k.fPDFEmbed||k.fDebug)try{TRACE(h)}catch(E){if(k.fDebug)try{k.SVGDocument&&k.SVGMenuGroup&&(f(k.SVGDocument,k.SVGMenuGroup,"message",h).fu.setPosition(k.Scale.normalX(0),k.Scale.normalY(Aa*18)),++Aa>20&&(Aa=0,k.SVGMenuGroup.fu.clear()))}catch(F){}}};window._LOG=b;window._STATUS=function(h){if(k.fStatus){var r=k.Dom.getObjectById("legend:statusgroup");r||(r=k.Dom.getObjectById("legend:scalegroup"),
r=k.Dom.newGroup(r,"legend:statusgroup"));k.Dom.clearGroup(r);k.Dom.newText(r,k.Scale.normalX(220),k.Scale.normalY(12),"font-family:arial;font-size:"+k.Scale.normalY(12)+"px;fill:black",h)}};window._ERROR=function(h){try{k.HTMLWindow.ixmaps.htmlgui_errorLog(h)}catch(r){k.fDebug&&k.SVGDocument&&k.SVGMessageGroup&&f(k.SVGDocument,k.SVGMessageGroup,"message",h).fu.setPosition(k.Scale.normalX(0),k.Scale.normalY(0))}};window.displayProgressBar=c;window.do_clearMessage=za;window.szMapNs=e;window.szXlink=
"http://www.w3.org/1999/xlink";window.szHTTP="http://";window.szHTTPS="https://";window.nInch=2.54})();(function(){function Ha(){this.itemA=[];this.historyPointer=0;this.fSuspend=!1;this.newItem()}function q(){try{this.szEnvelope=map.Zoom.getEnvelopeString()}catch(d){}}function K(d,e){if(e!="circle"&&e!="isolate"&&e!="scale"&&(d=map.Layer.getLayerItemNodeOfNode(d),!d))return null;this.node=d;this.szMode=e;this.doHighLight()}function A(d,e,g){if(d&&!d.touches)d=map.Scale.getClientMousePosition(d,map.SVGPopupGroup);else{d=map.Scale.getScreenPosition(e);if(!map.Scale.isWidgetPositionInMap(d))return null;
g+="|pointer"}if(g.match(/delayed/))B(),C=e,z=setTimeout("doDisplayInfo("+d.x+","+d.y+",'"+g+"')",nInfoTimeout);else return C=e,y(d.x,d.y,g)}function B(){z&&clearTimeout(z);C=null}function D(d,e){if(map.fScaleBar){var g=map.Scale.nTrueMapScale*map.Scale.nZoomScale;for(d=0;g>10;d++)g/=10;for(g=g>5?10:g>2.5?5:g>=1.1?2.5:1;d>0;d--)g*=10;var l=g/(map.Scale.nMapScale*map.Scale.nZoomScale)*(map.Scale.nMapPPI/nInch);(d=map.Dom.getObjectById("legend:scalegroup"))||(d=map.Dom.newGroup(map.SVGMenuGroup,"legend:scalegroup"));
d.hasChildNodes();d.fu.clear();var u=d.getAttributeNS(szMapNs,"scaleunits"),k=d.getAttributeNS(szMapNs,"barcolor"),v=d.getAttributeNS(szMapNs,"bgcolor"),x=d.getAttributeNS(szMapNs,"bgstyle"),H=d.getAttributeNS(szMapNs,"bgopacity"),G=d.getAttributeNS(szMapNs,"maxwidth");if(x==null||x.length<1)x=v==null||v.length<1?"fill:white;":"fill:"+v+";",H&&(x+="opacity:"+H+";");G===0&&(G=map.Scale.bBox.width/3/map.Scale.normalX(1));if(k==null||k.length<1)k="red";k="fill:"+k+(k=="#ffffff"?";stroke:black;stroke-width:0.1;":
"")+";pointer-events:none";x=map.Dom.newShape("rect",d,map.Scale.normalX(0),map.Scale.normalY(0),map.Scale.normalX(0),map.Scale.normalY(0),x);v=map.Scale.nTrueMapScale*map.Scale.nZoomScale;v=v>=1?"1:"+String(__formatValue(v,0,"BLANK")):String(__formatValue(1/v,0,"BLANK"))+":1";map.Dom.newText(d,0,map.Scale.normalY(12),"font-family:arial;font-size:"+map.Scale.normalY(9)+"px;fill:"+map.szInfoBodyColor,v).fu.setPosition(map.Scale.normalX(9),-map.Scale.normalY(9.5));if(G>0){v=0;u=u.length?u:"meters";
H=100;u=="feet"?(H=33.3,g>3E4&&(u="miles",H=5280*33.3)):g>1E4&&(u="km",H=1E5);for(var P=0;P<20;P++){var M=P%2==1?k:"fill:black;pointer-events:none";map.Dom.newShape("rect",d,map.Scale.normalX(v),map.Scale.normalY(5),map.Scale.normalX(l),map.Scale.normalY(5),M);M=Math.floor(g/H*P*100)/100;var T=u;P>0&&(T=Math.floor(M)!=M?String(M):String(Math.floor(M)));map.Dom.newText(d,P===0?map.Scale.normalX(v):map.Scale.normalX(v-4),map.Scale.normalY(18),"font-family:arial;font-size:"+map.Scale.normalY(8)+"px;fill:"+
map.szInfoBodyColor+";pointer-events:none;",T);v+=l;if(G>1&&v>G||map.Scale.mapPosition.x&&map.Scale.normalX(v)>map.Scale.bBox.width*9/10||!map.Scale.mapPosition.x&&map.Scale.normalX(v)>map.Scale.bBox.width/2)break}}else map.Dom.newShape("rect",d,map.Scale.normalX(50),map.Scale.normalY(20),map.Scale.normalX(1),map.Scale.normalY(1),"fill:white;opacity:0;");g=map.Dom.getBox(d);x&&(x.setAttributeNS(null,"x",g.x-map.Scale.normalX(7)),x.setAttributeNS(null,"y",g.y-map.Scale.normalY(2)),x.setAttributeNS(null,
"width",g.width+map.Scale.normalX(14)),x.setAttributeNS(null,"height",g.height+map.Scale.normalY(4)),x.setAttributeNS(null,"rx",map.Scale.normalY(2)),x.setAttributeNS(null,"ry",map.Scale.normalY(2)));e&&(G=map.Scale.normalX(8),l=map.Scale.normalX(map.nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.bBox.height<map.Scale.viewBox.height&&(G=map.Scale.normalX(2),l=0),G=map.Scale.mapPosition.x+G,e=="bottom"?d.fu.setPosition(G+l,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-
l-g.height):d.fu.setPosition(G+l,-g.y+map.Scale.normalY(2)+map.Scale.normalY(1)+l));d.fu.setPosition(50,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-90);x&&(e=d.fu.getPosition().y>map.Scale.normalY(100)?"top":"bottom",x.setAttributeNS(null,"onclick","displayScale(evt,'"+e+"')"));map.SVGPopupGroup&&(map.SVGPopupGroup.fu.clear(),d.setAttributeNS(szMapNs,"tooltip","click to move it"))}}function J(d,e){d=new box(0,0,0,0);if(e)try{if(e.nodeName=="text")return map.Dom.getBox(e);
var g=e.childNodes;for(e=0;e<g.length;e++)if(g.item(e).nodeType==1){var l=getScale(g.item(e)),u=getTranslate(g.item(e)),k=map.Dom.getBox(g.item(e));k.x=u.x+k.x*l.x;k.y=u.y+k.y*l.y;k.width*=l.x;k.height*=l.y;if(g.item(e).getAttributeNS(null,"id").match(/overviewmap/)){var v=map.SVGDocument.getElementById("overviewmap:clippath");v&&(k=map.Dom.getBox(v),k.height=v.firstChild.getAttribute("height"),k.width=v.firstChild.getAttribute("width"),k.height=d.height+k.height*map.Scale.getGroupScale(v).y,k.width*=
map.Scale.getGroupScale(v).x)}isNaN(k.width)||isNaN(k.height)||k.width<0||k.height<0||(d.x=Math.min(d.x,k.x),d.y=Math.min(d.y,k.y),d.width=Math.max(d.width,k.x+k.width),d.height=Math.max(d.height,k.y+k.height))}if(isNaN(d.width)||isNaN(d.height)||d.width<0||d.height<0)d=new box(0,0,0,0)}catch(x){d=new box(0,0,0,0)}return d}function N(d,e){var g=map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(g)for(var l=0;l<g.length;l++)g.item(l).getAttributeNS(null,"name")==map.Tiles.getMasterId(d)&&g.item(l).setAttributeNS(null,
"state",e)}function ia(d,e){if(d!=null){var g=d.getAttributeNS(null,"id");if(!g.match(/label/)){var l,u=g.split(":");g=u[0]+":item:"+u[2];for(l=3;l<u.length;l++)g=g+":"+u[l];if(g=d.ownerDocument.getElementById(g)){var k=g.childNodes;for(l=0;l<k.length;l++)if(k.item(l).nodeType==1&&k.item(l).getAttributeNS(null,"id")&&k.item(l).getAttributeNS(null,"id").match(/collapsable/)){u=0;switch(e){case "collapse":if(k.item(l).getAttributeNS(szMapNs,"state")=="collapsed"||k.item(l).getAttributeNS(null,"id").match(/placeholder/))break;
(d=d.ownerDocument.getElementById(k.item(l).getAttributeNS(null,"id")+":end"))?u=-d.getAttributeNS(null,"y")+map.Scale.normalY(20):(d=map.Dom.getBox(k.item(l)),u=-d.height);e=map.Dom.newGroup(k.item(l).parentNode,k.item(l).getAttributeNS(null,"id")+":placeholder");e.setAttributeNS(szMapNs,"state","collapsed");e.parentNode.insertBefore(e,k.item(l));map.SVGHiddenGroup.appendChild(k.item(l+1));break;case "expand":if(k.item(l).getAttributeNS(szMapNs,"state")=="collapsed"||k.item(l).getAttributeNS(null,
"id").match(/placeholder/)){if(k.item(l).getAttributeNS(null,"id").match(/placeholder/)){e=k.item(l);k=e.getAttributeNS(null,"id").split(":");u="";for(l=0;l<k.length-1;l++)u+=l>0?":":"",u+=k[l];l=map.SVGDocument.getElementById(u);e.parentNode.replaceChild(l,e);l=map.SVGDocument.getElementById(u)}else l=k.item(l);l.setAttributeNS(szMapNs,"state","expanded");(d=d.ownerDocument.getElementById(l.getAttributeNS(null,"id")+":end"))?u=d.getAttributeNS(null,"y")-map.Scale.normalY(20):(d=map.Dom.getBox(l),
u=d.height)}}for(l=g.nextSibling;l&&u;)if(l.nodeType==1&&(d=getMatrix(l),d[5]+=u,setMatrix(l,d)),l=l.nextSibling,l==null)for(;g.parentNode&&g.parentNode.getAttributeNS(null,"id").match(/legend/);)if(g=g.parentNode,g.getAttributeNS(null,"id").match(/item/)){l=g.nextSibling;break}try{map.Legend.init(null)}catch(v){}break}}}}}ixMap.Viewport=function(d){map.Scale.metadataNode&&(this.szPopupAlignment=(this.alignmentNode=map.Scale.metadataNode.getElementsByTagNameNS(szMapNs,"alignments").item(0))?this.alignmentNode.getAttributeNS(null,
"popupwindow"):"",this.szPopupAlignment=map.szLocalPopupAlignment?map.szLocalPopupAlignment:this.szPopupAlignment);if(this.eventRect=map.SVGDocument.getElementById("mapbackground:eventrect"))map.szMapBackgroundStyle&&this.eventRect.setAttributeNS(null,"style",map.szMapBackgroundStyle+";pointer-events:all"),map.szMapBackgroundColor&&this.eventRect.setAttributeNS(null,"style","fill:"+map.szMapBackgroundColor+";opacity:1;pointer-events:all");this.clipToolsGroup();this.createPanBorder();this.createNorthArrow();
return!0};ixMap.Viewport.prototype=new Map;ixMap.Viewport.prototype.reformat=function(){this.clipToolsGroup();this.createPanBorder();this.createNorthArrow()};ixMap.Viewport.prototype.clipToolsGroup=function(){map.Dom.setClipRect(map.SVGToolsGroup,new box(map.Scale.mapPosition.x+map.Scale.normalX(map.nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(map.nMapBorderWidth),map.Scale.bBox.width-map.Scale.normalX(map.nMapBorderWidth)*2,map.Scale.bBox.height-map.Scale.normalY(map.nMapBorderWidth)*
2));this.widgetBox=new box(map.Scale.mapPosition.x+map.Scale.normalX(map.nMapBorderWidth),map.Scale.mapPosition.y+map.Scale.normalY(map.nMapBorderWidth+map.nToolMarginTop),map.Scale.bBox.width-map.Scale.normalX(map.nMapBorderWidth)*2,map.Scale.bBox.height-map.Scale.normalY(map.nMapBorderWidth)*2)};ixMap.Viewport.prototype.createPanBorder=function(){var d=map.SVGDocument;if(map.fMapBorder){var e=d.getElementById("widgets:antizoomandpan");if(e){var g=map.szMapBorderColor,l=map.Scale.normalX(map.nMapBorderWidth),
u=d.getElementById("mapBorderClipCover");u&&u.parentNode.removeChild(u);u=map.Dom.newGroup(e,"mapBorderClipCover");u.setAttributeNS(null,"style","fill:white;opacity:1.0");e.insertBefore(u,e.firstChild);map.Dom.newShape("rect",u,0,0,map.Scale.mapPosition.x,map.Scale.viewBox.height,"");map.Dom.newShape("rect",u,0,0,map.Scale.viewBox.width+1E4,map.Scale.mapPosition.y,"");map.Dom.newShape("rect",u,0,map.Scale.mapPosition.y+map.Scale.bBox.height,map.Scale.viewBox.width+1E4,map.Scale.viewBox.height-(map.Scale.mapPosition.y+
map.Scale.bBox.height)+1E4,"");map.Dom.newShape("rect",u,map.Scale.mapPosition.x+map.Scale.bBox.width,0,map.Scale.viewBox.width-(map.Scale.mapPosition.x+map.Scale.bBox.width)+1E4,map.Scale.bBox.height,"");(u=d.getElementById("mapBorder"))&&u.parentNode.removeChild(u);u=map.Dom.newGroup(e,"mapBorder");if(map.fMapBorder3D&&map.Scale.mapPosition.x)g="#ffffff",e.insertBefore(u,e.firstChild),u.fu.setPosition(0,0),l=map.Scale.normalX(250),d=map.Scale.normalX(-3),e=map.Dom.newShape("rect",u,map.Scale.mapPosition.x,
map.Scale.mapPosition.y-l+d,map.Scale.bBox.width,l,"fill:"+g+";opacity:0.5"),e.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),e=map.Dom.newShape("rect",u,0,map.Scale.mapPosition.y+map.Scale.bBox.height-d,map.Scale.mapPosition.x+map.Scale.bBox.width,l,"fill:"+g+";opacity:0.5"),e.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),e=map.Dom.newShape("rect",u,0,0,map.Scale.mapPosition.x,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+
g+";opacity:0.5"),e.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)"),e=map.Dom.newShape("rect",u,map.Scale.mapPosition.x+map.Scale.bBox.width-d,0,l,map.Scale.mapPosition.y+map.Scale.bBox.height,"fill:"+g+";opacity:0.5"),e.setAttributeNS(null,"style","filter:url(#DropShadowFilterTools:antizoomandpan)");else if(u.setAttributeNS(null,"transform","matrix(1 0 0 1 "+map.Scale.mapPosition.x+" "+map.Scale.mapPosition.y+")"),map.Dom.newShape("rect",u,0,0,map.Scale.bBox.width,
l,"fill:"+g+";opacity:1.0"),map.Dom.newShape("rect",u,0,map.Scale.bBox.height-l,map.Scale.bBox.width,l,"fill:"+g+";opacity:1.0"),map.Dom.newShape("rect",u,0,0,l,map.Scale.bBox.height,"fill:"+g+";opacity:1.0"),map.Dom.newShape("rect",u,map.Scale.bBox.width-l,0,l,map.Scale.bBox.height,"fill:"+g+";opacity:1.0"),map.nMapBorderWidth>2){g=map.szMapPanBorderStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0";d=map.szMapPanBorderOnoverStyle+";stroke-width:"+map.Scale.normalX(1)+";opacity:1.0";var k=
map.Scale.bBox,v=k.width/10,x=k.width/3/+map.Scale.normalX(1);e=map.Dom.newShape("rect",u,v,0,k.width-v*2,l,g);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+x+")");e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",d);e=map.Dom.newShape("rect",u,v,k.height-l-1,k.width-v*2,l,g);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap(0,"+-x+")");e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",d);e=map.Dom.newShape("rect",u,0,
v,l,k.height-v*2,g);e.setAttributeNS(szMapNs,"onoverstyle",d);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+x+",0)");e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",d);e=map.Dom.newShape("rect",u,k.width-l-1,v,l,k.height-v*2,g);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-x+",0)");e.setAttributeNS(szMapNs,"onoverstyle",d);e.setAttributeNS(szMapNs,"tooltip","pan");e=map.Dom.newShape("path",u,"M0,0 l "+v+",0 0,"+l+" "+-(v-l)+",0 0,"+(v-l)+" "+
-l+",0 z",g);e.setAttributeNS(szMapNs,"onoverstyle",d);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+x+","+x+")");e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",d);e=map.Dom.newShape("path",u,"M"+k.width+","+k.height+" l "+-v+",0 0,"+-l+" "+(v-l)+",0 0,"+-(v-l)+" "+l+",0 z",g);e.setAttributeNS(szMapNs,"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",d);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-x+","+-x+")");e.setAttributeNS(szMapNs,
"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",d);e=map.Dom.newShape("path",u,"M"+k.width+",0 l "+-v+",0 0,"+l+" "+(v-l)+",0 0,"+(v-l)+" "+l+",0 z",g);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+-x+","+x+")");e.setAttributeNS(szMapNs,"onoverstyle",d);e.setAttributeNS(szMapNs,"tooltip","pan");e=map.Dom.newShape("path",u,"M0,"+k.height+" l "+v+",0 0,"+-l+" "+-(v-l)+",0 0,"+-(v-l)+" "+-l+",0 z",g);e.setAttributeNS(null,"onclick","map.Viewport.doPanMap("+x+","+-x+")");e.setAttributeNS(szMapNs,
"tooltip","pan");e.setAttributeNS(szMapNs,"onoverstyle",d)}}}};ixMap.Viewport.prototype.doPanMap=function(d,e){executeWithMessage(()=>map.Viewport.panMap(d,e),"please wait ...",100)};ixMap.Viewport.prototype.panMap=function(d,e){map.Zoom.setNewPan(d,e);map.Event.doDefaultZoom(null)};ixMap.Viewport.prototype.setBackgroundColor=function(d){this.eventRect&&this.eventRect.setAttributeNS(null,"style","fill:"+d+";opacity:1;pointer-events:all")};ixMap.Viewport.prototype.togglePanBorder=function(){var d=
map.SVGDocument.getElementById("mapBorder");d?d.parentNode.removeChild(d):map.Viewport.createPanBorder()};ixMap.Viewport.prototype.createNorthArrow=function(){if(map.fNorthArrow){var d=map.SVGDocument.getElementById("widgets:antizoomandpan");if(d){var e="none";this.northGroup&&(e=this.northGroup.style.getPropertyValue("display"),this.northGroup.parentNode.removeChild(this.northGroup));this.northGroup=map.Dom.newGroup(d,"mapNorthArrow");e&&this.northGroup.style.setProperty("display",e);map.szNorthArrowPosition==
"TOP"?this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),map.Scale.normalX(45+map.nToolMarginTop)):this.northGroup.fu.setPosition(this.widgetBox.x+this.widgetBox.width-map.Scale.normalX(75),this.widgetBox.y+map.Scale.normalX((this.widgetBox.y?50:60)+map.nToolMarginTop));d=map.Scale.normalY(30);e=map.Scale.normalY(12);map.Dom.newShape("circle",this.northGroup,0,0,d,"fill:white;opacity:0.2");map.Dom.newShape("path",this.northGroup,"M0,"+-d/2+" l "+e/2+","+d*1.2+
" "+-e/2+","+-d/5+" "+-e/2+","+d/5+" z","fill:#444444;stroke:#ffffff;stroke-width:"+map.Scale.normalX(.4)+";");map.Dom.newText(this.northGroup,map.Scale.normalX(-5),map.Scale.normalY(-19),"font-family:arial;font-size:"+map.Scale.normalX(12)+"px;font-weight:bold;fill:#444444;stroke:white;stroke-width:0.2;pointer-events:none","N");map.Dom.newShape("rect",this.northGroup,-e/2,-d,e,d,"fill:green;opacity:0.0");map.fNorthArrow=="rotatable"&&(this.northGroup.setAttributeNS(null,"cursor","pointer"),this.northGroup.setAttributeNS(szMapNs,
"tooltip",map.Dictionary.getLocalText("click to move it")),this.northArrowObj=new ka(this.northGroup,100,"0,360","1",90,9),this.northArrowObj.parent=this);d=new Ua(this.northGroup,"mapNorthArrow:zoomin","BUTTON","#plus_button1","map.Zoom.doZoomMap(2)","","zoom in");d.setPosition(map.Scale.normalY(0),map.Scale.normalY(40));d.scale(1.3,1.3);d.nodeObj.style.setProperty("fill-opacity","0.5","");d=new Ua(this.northGroup,"mapNorthArrow:zoomout","BUTTON","#minus_button1","map.Zoom.doZoomMap(0.5)","","zoom out");
d.setPosition(map.Scale.normalY(0),map.Scale.normalY(40+map.nNormalButtonSize*2));d.scale(1.3,1.3);d.nodeObj.style.setProperty("fill-opacity","0.5","")}}};ixMap.Viewport.prototype.onClick=function(d){this.northArrowObj&&executeWithMessage(()=>map.Scale.setRotation(null,0),"...")};ixMap.Viewport.prototype.onMouseUp=function(d){this.northArrowObj&&!map.fRotateOnMouseMove&&executeWithMessage(()=>map.Scale.setRotation(null,this.northArrowObj.getAngle()),"...")};ixMap.Viewport.prototype.onMouseMove=function(d){this.northArrowObj&&
map.fRotateOnMouseMove&&(d=this.northArrowObj.getAngle(),d!=this.nAngle&&(map.Scale.setRotation(null,d),this.nAngle=d))};ixMap.Viewport.prototype.showNorthArrow=function(){this.northGroup&&this.northGroup.style.setProperty("display","inline","")};ixMap.Viewport.prototype.hideNorthArrow=function(){this.northGroup&&this.northGroup.style.getPropertyValue("display")!="none"&&(this.northGroup.style.setProperty("display","none",""),this.northArrowObj&&executeWithMessage(()=>map.Scale.setRotation(null,0),
"..."))};ixMap.Viewport.prototype.clipMap=function(d){var e=map.SVGDocument.getElementById("mapcliprect");e&&e.setAttributeNS(null,"width",map.Scale.normalX(d))};ixMap.Viewport.prototype.clipLayer=function(d,e){d||(d=map._activeTheme);var g=map.SVGDocument.getElementById(d);d=map.SVGDocument.getElementById(d+":values");typeof this.lastClippedLayer!="undefined"&&this.lastClippedLayer!=g&&(map.Dom.setClipRect(this.lastClippedLayer,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.bBox.width,
map.Scale.bBox.height)),this.lastClippedLayer=null);typeof this.lastClippedLayerV!="undefined"&&this.lastClippedLayerV!=d&&(map.Dom.setClipRect(this.lastClippedLayerV,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.bBox.width,map.Scale.bBox.height)),this.lastClippedLayerV=null);g&&(map.Dom.setClipRect(g,new box(-map.Scale.mapOffset.x,-map.Scale.mapOffset.y,map.Scale.normalX(e),map.Scale.bBox.height)),this.lastClippedLayer=g);d&&(map.Dom.setClipRect(d,new box(-map.Scale.mapOffset.x,
-map.Scale.mapOffset.y,map.Scale.normalX(e),map.Scale.bBox.height)),this.lastClippedLayerV=d)};ixMap.Zoom=function(d){this.canvasNode=map.SVGDocument.getElementById("mapcanvas");this.zoomNode=map.SVGDocument.getElementById("mapzoomandpan");this.nZoomY=this.nZoomX=this.nZoom=1;this.doCenter=this.doArea=this.doZoom=null;this.fAreaSet=!1;d&&d>1&&this.doExecuteZoomMap(d,1)};ixMap.Zoom.prototype=new Map;ixMap.Zoom.prototype.init=function(){if(map.Scale.initZoomNode){var d=Number(map.Scale.initZoomNode.getAttribute("MinBoundX")),
e=Number(map.Scale.initZoomNode.getAttribute("MaxBoundX")),g=Number(map.Scale.initZoomNode.getAttribute("MinBoundY")),l=Number(map.Scale.initZoomNode.getAttribute("MaxBoundY"));map.Scale.initZoomNode.getAttribute("units")=="degree"?this.doZoomMapToGeoBounds(g,d,l,e):this.Zoom.doZoomMapToEnvelope(d,e,g,l)}};ixMap.Zoom.prototype.toFullExtend=function(){setTimeout("map.Zoom.reset()",100)};ixMap.Zoom.prototype.setNewZoom=function(d){this.doZoom=d;map.Zoom.execute()};ixMap.Zoom.prototype.setNewPan=function(d,
e){this.doPanMap(d,e)};ixMap.Zoom.prototype.setNewArea=function(d){this.fAreaSet=!0;this.doSetAreaByParentMap(d)||(this.doArea=new box(d.x,d.y,d.width,d.height),map.Zoom.execute())};ixMap.Zoom.prototype.setNewCenter=function(d){this.doCenterByParentMap(d)||(this.doCenter=new box(d.x,d.y,d.width,d.height),map.Zoom.execute())};ixMap.Zoom.prototype.execute=function(){this.doZoom&&(this.doExecuteZoomMap(this.doZoom,this.nZoom),this.nZoom=this.doZoom,this.doZoom=null);this.doArea&&(this.doZoomMapToArea(this.doArea),
this.doArea=null);this.doCenter&&(this.doCenterMapToArea(this.doCenter),this.doCenter=null);map.SVGPopupGroup&&map.SVGPopupGroup.fu.clear()};ixMap.Zoom.prototype.cancel=function(){this.doCenter=this.doArea=this.doZoom=null};ixMap.Zoom.prototype.reset=function(){this.zoomNode.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)");map.SVGRootElement.currentTranslate.x=0;map.SVGRootElement.currentTranslate.y=0;this.nZoom=1;map.Event.doDefaultZoom(null);clearMessage(100)};ixMap.Zoom.prototype.getBox=
function(){var d=getMatrix(this.canvasNode),e=getMatrix(this.zoomNode),g=-d[4]/this.nZoomX;d=-d[5]/this.nZoomY;g-=(map.Scale.normalX(map.SVGRootElement.currentTranslate.x)+e[4])/this.nZoomX;d-=(map.Scale.normalY(map.SVGRootElement.currentTranslate.y)+e[5])/this.nZoomY;return new box(g,d,map.Scale.bBox.width/this.nZoomX,map.Scale.bBox.height/this.nZoomY)};ixMap.Zoom.prototype.getEnvelope=function(){var d=this.getBox(),e=map.Scale.getMapCoordinate(d.x,d.y);d=map.Scale.getMapCoordinate(d.x+d.width,d.y+
d.height);return[e,d]};ixMap.Zoom.prototype.getEnvelopeString=function(){var d=this.getEnvelope();return String("MinBoundX='"+d[0].x+"' MaxBoundX='"+d[1].x+"' MinBoundY='"+d[1].y+"' MaxBoundY='"+d[0].y+"'")};ixMap.Zoom.prototype.getFractionBox=function(){var d=getMatrix(this.zoomNode),e=map.Scale.rotatePoint(new point(d[4],d[5]),-1);d[4]=e.x;d[5]=e.y;e=(map.Scale.normalX(map.SVGRootElement.currentTranslate.x)+d[4])/this.nZoomX;d=(map.Scale.normalY(map.SVGRootElement.currentTranslate.y)+d[5])/this.nZoomY;
var g=map.Scale.bBox.width-map.Scale.bBox.width/this.nZoomX,l=map.Scale.bBox.height-map.Scale.bBox.height/this.nZoomY;return g>0&&l>0?new box(.5-e/g,.5-d/l,1/this.nZoomX,1/this.nZoomY):new box(0,0,1/this.nZoomX,1/this.nZoomY)};ixMap.Zoom.prototype.setFractionBox=function(d){var e=map.Scale.bBox.width*d.width,g=map.Scale.bBox.height*d.height;d=new box((map.Scale.bBox.width-e)*d.x+map.Scale.bBox.x,(map.Scale.bBox.height-g)*d.y+map.Scale.bBox.y,e,g);map.Zoom.setNewCenter(d)};ixMap.Zoom.prototype.clipArea=
function(d){d.width/d.height!=map.Scale.bBox.width/map.Scale.bBox.height&&(d.width>d.height?d.height=d.width/map.Scale.bBox.width*map.Scale.bBox.height:d.width=d.height/map.Scale.bBox.height*map.Scale.bBox.width);var e=d.x-map.Scale.bBox.x,g=map.Scale.bBox.x+map.Scale.bBox.width-(d.x+d.width),l=d.y-map.Scale.bBox.y,u=map.Scale.bBox.y+map.Scale.bBox.height-(d.y+d.height);if(e<0||g<0||l<0||u<0){if(e<0&&g<0)d.x=map.Scale.bBox.x,d.width=map.Scale.bBox.width;else if(e<0)d.x+=-e,d.width-=g>-e?0:-e-g;else if(g<
0)return d.x-=-g,this.clipArea(d);if(l<0&&u<0)d.y=map.Scale.bBox.y,d.height=map.Scale.bBox.heigt;else if(l<0)d.y+=-l,d.height-=u>-l?0:-l-u;else if(u<0)return d.y-=-u,this.clipArea(d)}return d};ixMap.Zoom.prototype.isVisibleBox=function(d){try{var e=this.getBox();return d.x+d.width<e.x||d.x>e.x+e.width||d.y+d.height<e.y||d.y>e.y+e.height?!1:!0}catch(g){return!1}};ixMap.Zoom.prototype.isCompletelyVisibleBox=function(d){var e=this.getBox();return d.x<e.x||d.x+d.width>e.x+e.width||d.y<e.y||d.y+d.height>
e.y+e.height?!1:!0};ixMap.Zoom.prototype.doExecuteZoomMap=function(d,e){d=this.checkZoomLimit(d);if(d!=this.nZoom){var g=getMatrix(this.zoomNode),l=(map.SVGRootElement.currentTranslate.x+map.Scale.embedX(g[4]))/e*d;g=(map.SVGRootElement.currentTranslate.y+map.Scale.embedX(g[5]))/e*d;this.nOldZoomX=this.nZoomX;this.nOldZoomY=this.nZoomY;this.nZoomX=this.nZoomX/e*d;this.nZoomY=this.nZoomY/e*d;map.fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" 0 0)"),
map.SVGRootElement.currentTranslate.x=l,map.SVGRootElement.currentTranslate.y=g):this.zoomNode.setAttributeNS(null,"transform","matrix("+this.nZoomX+" 0 0 "+this.nZoomY+" "+map.Scale.normalX(l)+" "+map.Scale.normalY(g)+")");this.nZoom=d;map.Event.doDefaultZoom(null)}};ixMap.Zoom.prototype.doZoomMapToArea=function(d){if(d.width&&d.height){this.fAreaSet=!0;var e=getMatrix(this.canvasNode);new point(e[4],e[5]);e=map.Scale.bBox.width/d.width;var g=map.Scale.bBox.height/d.height,l=Math.min(e,g);l=Math.round(l*
1E6)/1E6;e=Math.round(e*1E6)/1E6;g=Math.round(g*1E6)/1E6;var u=this.checkZoomLimit(l);u!=l&&d.scale(l/u);l=u;l!=this.nZoom&&(map.fPreserveMapRatio&&(e=g=l),map.fZoomByViewer&&map.fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),map.SVGRootElement.currentScale=l):map.fPanByViewer?(this.zoomNode.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+g+" 0 0)"),map.SVGRootElement.currentScale=1):this.zoomNode.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+g+" 0 0)"),
this.nZoom=l,this.nOldZoomX=this.nZoomX,this.nOldZoomY=this.nZoomY,this.nZoomX=e,this.nZoomY=g);this.doCenterMapToArea(d)}};ixMap.Zoom.prototype.doCenterMapToArea=function(d){this.fAreaSet=!0;this.fExternalZoom=!1;var e=getMatrix(this.canvasNode),g=new point(e[4],e[5]),l=getMatrix(this.zoomNode);e=l[0];l=l[3];d.x+=d.width/2;d.y+=d.height/2;d.x=d.x*e+g.x;d.y=d.y*l+g.y;g=-d.x+map.Scale.bBox.width/2;var u=-d.y+map.Scale.bBox.height/2;u=map.Scale.rotatePoint(new point(g,u));g=u.x;u=u.y;map.fZoomByViewer&&
map.fPanByViewer?(map.SVGRootElement.currentScale=this.nZoom,map.SVGRootElement.currentTranslate.x=map.Scale.embedX(g-d.width/2)*this.nZoomX,map.SVGRootElement.currentTranslate.y=map.Scale.embedY(u-d.height/2)*this.nZoomY):map.fPanByViewer?(map.SVGRootElement.currentTranslate.x=map.Scale.embedX(g),map.SVGRootElement.currentTranslate.y=map.Scale.embedY(u)):(d=getTranslate(this.zoomNode),this.zoomNode.setAttributeNS(null,"transform","matrix("+e+" 0 0 "+l+" "+g+" "+u+")"),this.doPanFixed(g-d.x,u-d.y));
map.fFroozeDynamicContent||(map.isIdle()?map.Event.doDefaultZoom(null):map.pushAction(()=>{map.Event.doDefaultZoom(null)}))};ixMap.Zoom.prototype.doPanFixed=function(d,e){for(var g=map.SVGFixedGroup.childNodes,l=0;l<g.length;l++){var u=g.item(l).fu.getPosition();g.item(l).fu.setPosition(u.x+d,u.y+e)}g=map.SVGToolsGroup.childNodes;for(l=0;l<g.length;l++)u=g.item(l).fu.getPosition(),g.item(l).fu.setPosition(u.x+d,u.y+e)};ixMap.Zoom.prototype.doZoomMapToWidgetRect=function(d){var e=Math.min(d.width,
d.height)<map.Scale.normalX(25)?!0:!1;new point(d.x,d.y);new point(d.x-d.width,d.y-d.height);var g=getMatrix(map.Scale.zoomNode),l=g[0],u=g[3],k=map.antiZoomAndPanList.getActualMatrix(),v=map.Scale.rotatePoint(new point(g[4],g[5]),-1);g[4]=v.x;g[5]=v.y;d.x=d.x*k[0]+k[4];d.y=d.y*k[3]+k[5];d.width*=k[0];d.height*=k[3];d.x=d.x-map.Scale.mapPosition.x-map.Scale.mapOffset.x;d.y=d.y-map.Scale.mapPosition.y-map.Scale.mapOffset.y;d.x=(d.x-g[4])/l;d.y=(d.y-g[5])/u;d.width/=l;d.height/=u;e?map.Zoom.setNewCenter(d):
map.Zoom.setNewArea(d)};ixMap.Zoom.prototype.doZoomMapToEnvelope=function(d,e,g,l){this.doCheckEnvelope(d,e,g,l)?(d=(d-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,l=map.Scale.maxY-map.Scale.minY-(l-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,map.Zoom.setNewArea(new box(d,l,(e-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x-d,map.Scale.maxY-map.Scale.minY-(g-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-l),300)):map.Zoom.doZoomMapToLayer("maplayer")};
ixMap.Zoom.prototype.doCenterMapToEnvelope=function(d,e,g,l){this.doCheckEnvelope(d,e,g,l)&&(d=(d-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x,l=map.Scale.maxY-map.Scale.minY-(l-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y,map.Zoom.doCenterMapToArea(new box(d,l,(e-map.Scale.minBoundX)/map.Scale.mapUnitsPPX-map.Scale.mapOffset.x-d,map.Scale.maxY-map.Scale.minY-(g-map.Scale.minBoundY)/map.Scale.mapUnitsPPY-map.Scale.mapOffset.y-l)))};ixMap.Zoom.prototype.doCenterMapToGeoPosition=
function(d,e){var g=map.Scale.getMapCoordinateOfLatLon(d,e);g?this.doCenterMapToEnvelope(g.x,g.x,g.y,g.y):(console.warn("getMapCoordinateOfLatLon returned null for lat="+d+", lon="+e),displayMessage("missing projection ! lat/lon could not be resolved",1E3))};ixMap.Zoom.prototype.doCenterMapToGeoBounds=function(d,e,g,l){var u=null,k=map.Scale.szMapProjection||"";k.match(/orthographic/i)?u="orthographic":k.match(/albers/i)?u="albers":k.match(/lambert/i)&&(u="lambert");if(u){k=null;if(u==="albers"){if(map.Scale&&
typeof map.Scale.calculateAlbersParametersFromBounds==="function"&&(l=map.Scale.calculateAlbersParametersFromBounds(d,e,g,l))){k=map.Scale.lastAlbersParams;g=!1;if(!k)g=!0;else if(Math.abs(l.lat1-k.lat1)>.5||Math.abs(l.lat2-k.lat2)>.5||Math.abs(l.lat0-k.lat0)>.5||Math.abs(l.lon0-k.lon0)>.5)g=!0;map.Scale.lastAlbersParams={lat1:l.lat1,lat2:l.lat2,lat0:l.lat0,lon0:l.lon0};k={params:l,changed:g}}}else g=(d+g)/2,l=(e+l)/2,e=null,map.HTMLWindow&&map.HTMLWindow.ixmaps&&(d=map.HTMLWindow.ixmaps.getZoom(),
d!==void 0&&Number.isFinite(d)&&(e=d)),e===null&&map.Scale.nZoomScale&&map.Scale.nZoomScale>0&&(e=Math.max(1,Math.min(20,Math.log2(map.Scale.nZoomScale)+5))),e===null&&(e=5),d=null,u==="orthographic"?d=map.Api.updateOrthographicParameters:u==="lambert"&&(d=map.Api.updateLambertParameters),map.Api&&d&&typeof d==="function"&&(k=d.call(map.Api,[g,l],e));if(k&&k.params){map.Themes.themeNodesPosA=[];map.Themes.themeNodesA=[];for(k=u=0;k<map.Themes.themesA.length;k++)l=map.Themes.themesA[k],l.szFlag&&(l.fRealize=
!0,l.fActualize=!0,l.fClearOnProjectionChange=!0,u++,l.themeNodesPosA&&(l.themeNodesPosA=[]),l.themeNodesA&&(l.themeNodesA=[]));map.Scale&&typeof map.Scale.getEmbedWidth==="function"&&typeof map.Scale.getEmbedHeight==="function"&&(map.Scale.nScaleX=map.Scale.viewBox.width/map.Scale.getEmbedWidth()*map.Scale.getEmbedScale(),map.Scale.nScaleY=map.Scale.viewBox.height/map.Scale.getEmbedHeight()*map.Scale.getEmbedScale());setTimeout(function(){map.Themes&&typeof map.Themes.execute==="function"?map.Themes.execute():
console.warn("map.Themes.execute() not available")},0)}else if(console.warn("No "+u+" parameter update - result is null or missing params:",k),k=!1,u==="orthographic"?k=map.Scale&&map.Scale.nOrthographicLat0!==void 0&&map.Scale.nOrthographicLon0!==void 0:u==="albers"?k=map.Scale&&map.Scale.lastAlbersParams!==void 0:u==="lambert"&&(k=map.Scale&&map.Scale.lastLambertParams!==void 0),k){for(k=u=0;k<map.Themes.themesA.length;k++)l=map.Themes.themesA[k],l.szFlag&&(l.fRealize=!0,l.fActualize=!0,l.fClearOnProjectionChange=
!0,u++);u>0&&map.Themes&&typeof map.Themes.execute==="function"&&setTimeout(function(){map.Themes.execute()},0)}}else this.fExternalZoom=!1,u=map.Scale.getMapCoordinateOfLatLon(d,e),k=map.Scale.getMapCoordinateOfLatLon(g,l),u&&k?this.doCenterMapToEnvelope(u.x,k.x,u.y,k.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};ixMap.Zoom.prototype.doZoomMapToGeoBounds=function(d,e,g,l){d=map.Scale.getMapCoordinateOfLatLon(d,e);g=map.Scale.getMapCoordinateOfLatLon(g,l);d&&g?this.doSetEnvelopeByParentMap(d.x,
g.x,d.y,g.y)||this.doZoomMapToEnvelope(d.x,g.x,d.y,g.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};ixMap.Zoom.prototype.doZoomMapToView=function(d,e){try{map.HTMLWindow.ixmaps.htmlgui_setCenterAndZoom({lat:d[0],lng:d[1]},e)}catch(g){return!1}};ixMap.Zoom.prototype.doZoomMapToLayer=function(d){if(map.fPendingNewGeoBounds)map.fPendingNewGeoBounds=!1;else{var e=map.SVGDocument.getElementById(d),g=map.Dom.getBox(e);e=map.Scale.getMapOffset(e);g.x+=e.x;g.y+=e.y;g=new box(g.x,
g.y,g.width,g.height);g.scale(.8);if(d=="maplayer"){e=d=3E4;var l=-3E4,u=-3E4,k=!1,v;for(v in map.Layer.listA)if(!v.match(/legend/)){var x=map.SVGDocument.getElementById(v+"::bbox");x&&(d=Math.min(d,Number(x.getAttributeNS(null,"minboundx"))),e=Math.min(e,Number(x.getAttributeNS(null,"minboundy"))),l=Math.max(l,Number(x.getAttributeNS(null,"maxboundx"))),u=Math.max(u,Number(x.getAttributeNS(null,"maxboundy"))),k=!0)}k&&(g=new box(d,e,Math.abs(l-d),Math.abs(u-e)))}g.width&&g.height&&g.width<map.Scale.bBox.width&&
g.height<map.Scale.bBox.height&&(map.Zoom.doSetAreaByParentMap(g)||map.Zoom.setNewArea(g))}};ixMap.Zoom.prototype.doZoomMapToItem=function(d){if(map.fPendingNewGeoBounds)map.fPendingNewGeoBounds=!1;else{var e=map.SVGDocument.getElementById(d);d=map.Dom.getBox(e);e=map.Scale.getMapOffset(e);d.x+=e.x;d.y+=e.y;d=new box(d.x,d.y,d.width,d.height);d.width&&d.height&&d.width<map.Scale.bBox.width&&d.height<map.Scale.bBox.height&&(map.Zoom.doSetAreaByParentMap(d)||map.Zoom.setNewArea(d))}};ixMap.Zoom.prototype.doSetMapToGeoBounds=
function(d,e,g,l){this.fExternalZoom=!1;d=map.Scale.getMapCoordinateOfLatLon(d,e);g=map.Scale.getMapCoordinateOfLatLon(g,l);d&&g?this.doZoomMapToEnvelope(d.x,g.x,d.y,g.y):displayMessage("missing projection ! lat/lon could not be resolved",1E3)};ixMap.Zoom.prototype.getCenterOfMapInGeoPosition=function(){var d=this.getBox();d=map.Scale.getMapCoordinate(d.x+d.width/2,d.y+d.height/2);return d=map.Scale.getGeoCoordinateOfPoint(d.x,d.y)};ixMap.Zoom.prototype.getBoundsOfMapInGeoBounds=function(){var d=
this.getBox(),e=map.Scale.getMapCoordinate(d.x,d.y+d.height);d=map.Scale.getMapCoordinate(d.x+d.width,d.y);e=map.Scale.getGeoCoordinateOfPoint(e.x,e.y);d=map.Scale.getGeoCoordinateOfPoint(d.x,d.y);if(!e||!d){var g=map.Zoom.getCenterOfMapInGeoPosition();g?(e||=new point(g.x-.1,g.y-.1),d||=new point(g.x+.1,g.y+.1)):(e=e||new point(-180,-90),d=d||new point(180,90))}return[e,d]};ixMap.Zoom.prototype.doCheckEnvelope=function(d,e,g,l){return map.fLimitMapToExtent?d<map.Scale.minBoundX&&e>map.Scale.maxBoundX&&
g<map.Scale.minBoundY&&l>map.Scale.maxBoundY&&e-d>(map.Scale.maxBoundX-map.Scale.minBoundX)*2||d>map.Scale.maxBoundX||e<map.Scale.minBoundX||g>map.Scale.maxBoundY||l<map.Scale.minBoundY?(displayMessage("position outside",500),!1):!0:!0};ixMap.Zoom.prototype.doSetAreaByParentMap=function(d){var e=map.Scale.getMapCoordinate(d.x,d.y);d=map.Scale.getMapCoordinate(d.x+d.width,d.y+d.height);return this.doSetEnvelopeByParentMap(e.x,d.x,e.y,d.y)};ixMap.Zoom.prototype.doSetEnvelopeByParentMap=function(d,e,
g,l){try{var u=map.Scale.getGeoCoordinateOfPoint(d,g),k=map.Scale.getGeoCoordinateOfPoint(e,l);this.fExternalZoom=!0;return map.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelopeByGeoBounds(u,k)}catch(v){return!1}};ixMap.Zoom.prototype.doCenterByParentMap=function(d){d=map.Scale.getMapCoordinate(d.x+d.width/2,d.y+d.height/2);return this.doSetCenterByParentMap(d.x,d.y)};ixMap.Zoom.prototype.doSetCenterByParentMap=function(d,e){try{var g=map.Scale.getGeoCoordinateOfPoint(d,e);return map.HTMLWindow.ixmaps.htmlgui_setCurrentCenterByGeoBounds(g)}catch(l){return!1}};
ixMap.Zoom.prototype.doZoomMap=function(d,e){if(this.zoomNode){displayMessage("please wait ...",500);var g=getMatrix(map.Zoom.zoomNode)[0];if(d===0)return this.toFullExtend(),Math.round(map.Scale.nMapScale);switch(e){case "absolute":g=d;break;case "byscale":g=map.Scale.nTrueMapScale/d;break;default:g*=d}this.setNewZoom(g);return Math.round(map.Scale.nMapScale/g)}};ixMap.Zoom.prototype.doPanMap=function(d,e){var g=getMatrix(this.zoomNode),l=g[0],u=g[3];d=map.SVGRootElement.currentTranslate.x+d;e=map.SVGRootElement.currentTranslate.y+
e;e=map.Scale.rotatePoint(new point(d,e));d=e.x;e=e.y;d+=map.Scale.embedX(g[4]);e+=map.Scale.embedY(g[5]);if(!map.Scale.szMapProjection||typeof map.Scale.szMapProjection!=="string"||map.Scale.szMapProjection.toLowerCase().indexOf("orthographic")===-1)if(map.fPanByViewer?(map.SVGRootElement.currentTranslate.x=d,map.SVGRootElement.currentTranslate.y=e):(d=map.Scale.normalX(d),e=map.Scale.normalY(e),g=getTranslate(this.zoomNode),this.zoomNode.setAttributeNS(null,"transform","matrix("+l+" 0 0 "+u+" "+
d+" "+e+")"),this.doPanFixed(d-g.x,e-g.y)),map.Scale.szMapProjection=="Mercator")try{var k=this.getBox(),v=map.Scale.getMapCoordinate(k.x+k.width/2,k.y+k.height/2);this.doSetCenterByParentMap(v.x,v.y)}catch(x){try{map.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(this.getEnvelopeString(),!1)}catch(H){}}};ixMap.Zoom.prototype.doPanMapByViewer=function(d,e){e=map.SVGRootElement.currentTranslate.y+e;map.SVGRootElement.currentTranslate.x+=d;map.SVGRootElement.currentTranslate.y=e};ixMap.Zoom.prototype.checkZoomLimit=
function(d){var e=1E6;map.fPDFEmbed&&(e=20,map.Tiles&&map.Tiles.nCount>1&&(e=20));return d>=e?e:d=Math.round(d*1E6)/1E6};ixMap.Zoom.prototype.removeClipping=function(d){map.fClipMapDynamic&&map.SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","")};ixMap.Zoom.prototype.activateClipping=function(d){map.fClipMapDynamic&&map.SVGDocument.getElementById("mapclip").setAttributeNS(null,"clip-path","url(#mapclippath)")};ixMap.Zoom.prototype.onMouseMove=function(d){};ixMap.Zoom.prototype.onMouseDown=
function(d){};ixMap.Zoom.prototype.onMouseUp=function(d){this.setFractionBox(new box(this.overviewThumbObj.fraction.x,this.overviewThumbObj.fraction.y,1/this.nZoomX,1/this.nZoomY))};ixMap.Layer=function(d){this.document=d?d.target.ownerDocument:map.SVGDocument;this.layerNode=map.SVGDocument.getElementById("maplayer");this.listA=[];this.depListA=[];this.generatedLabelA=[];this.changedFeatureNodesA=[];this.objectGroup=map.SVGDocument.getElementById(map.szObjectGroupId);this.fSwitchSublayer=!0;this.nDynamicObjectScale=
this.nObjectScale=this.nFeatureScale=1;var e=map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(e.length)for(this.listA.legend_body=new ixMap.Layer.Item(null),d=0;d<e.length;d++)this.listA[e.item(d).getAttributeNS(null,"name")]=new ixMap.Layer.Item(e.item(d));e=map.SVGDocument.getElementsByTagNameNS(szMapNs,"scaledependency");if(!(e.length<=0))for(d=0;d<e.length;d++){var g=e.item(d).getAttributeNS(null,"feature");this.depListA[g]=new ixMap.Layer.Dependency(e.item(d))}};ixMap.Layer.prototype=
new Map;ixMap.Layer.Item=function(d){if(d){if(this.szName=d.getAttributeNS(null,"name"),this.szLegendName=d.getAttributeNS(null,"legendname"),this.szFlag=d.getAttributeNS(null,"flag"),this.szType=d.getAttributeNS(null,"type"),this.nItems=Number(d.getAttributeNS(null,"items")),this.nRenderer=d.getAttributeNS(null,"renderer"),this.szRenderer=d.getAttributeNS(null,"rendererfield"),this.szLabel=d.getAttributeNS(null,"label"),this.szSelection=d.getAttributeNS(null,"selection"),this.szFilter=d.getAttributeNS(null,
"filter"),this.szFilterValue=d.getAttributeNS(null,"filtervalue"),this.szHighlight=d.getAttributeNS(null,"highlightstyle"),this.szDisplay=d.getAttributeNS(null,"display"),this.szDisplayLabel=d.getAttributeNS(null,"displaylabel"),this.categoryA=this.labelBoxA=null,d=d.getElementsByTagNameNS(szMapNs,"category"),d.length){this.categoryA=[];for(var e=0;e<d.length;e++){var g=this.categoryA[d.item(e).getAttributeNS(null,"name")]={};g.legendname=d.item(e).getAttributeNS(null,"legendname");g.fill=d.item(e).getAttributeNS(null,
"fill");g.stroke=d.item(e).getAttributeNS(null,"stroke");g.style=d.item(e).getAttributeNS(null,"style");g.display="inline"}}}else this.szFlag="",this.szType="dummy",this.szDisplayLabel=this.szDisplay="inline"};ixMap.Layer.Dependency=function(d){d&&(this.shapeId=d.getAttributeNS(null,"shape"),this.szFeature=d.getAttributeNS(null,"feature"),this.depClass=d.getAttributeNS(null,"classname"),this.nUpper=1E11,this.nLower=0,this.depLower=d.getAttributeNS(null,"lower"),(this.depUpper=d.getAttributeNS(null,
"upper"))&&this.depUpper.length&&(this.nUpper=Number(this.depUpper.split(":")[1])),this.depLower&&this.depLower.length&&(this.nLower=Number(this.depLower.split(":")[1])),this.szDisplayAttribute="inline")};ixMap.Layer.prototype.switchLayer=function(d,e,g,l){var u=l?"inline":"none",k=this.listA[e.split(":")[0]];if(!k)return!1;if(g&&g.match(/legendgroup/))return!0;if(e&&!e.match(/label/)&&!e.match(/::/)&&(e.match(/group/)||this.fSwitchSublayer)){var v="legend:collapsable:"+e.split(":")[0];map.SVGDocument.getElementById(v)&&
setTimeout('__doSwitchGroupThemes("'+e+'",'+l+")",250)}e&&!e.match(/label/)&&e.match(/::/)&&l===!0&&(v=this.fSwitchSublayer,this.fSwitchSublayer=!1,this.switchLayer(d,e.split("::")[0],g,!0),this.fSwitchSublayer=v,(v=map.SVGDocument.getElementById("legend:off:"+e.split("::")[0]))&&v.style.getPropertyValue("display")!="inline"&&(v=map.SVGDocument.getElementById("legend:suboff:"+e.split("::")[0]))&&v.style.setProperty("display","inline",""));e.match(/label/)&&!e.match(/:bg/)&&this.switchLayer(d,e+":bg",
g,l);e.match(/::/)&&e.split("::")[1]&&k.categoryA[e.split("::")[1]]?k.categoryA[e.split("::")[1]].display=u:(k.categoryA&&k.categoryA[null]&&(k.categoryA[null].display=u),k.display=u,k.nState=u=="none"?!1:!0);return k&&(this.switchLayerByFeature(e,l)||this.switchLayerOnTiles(e,l))?(e.match(/:label/)?k.szDisplayLabel=u:(k.nState=l,k.szDisplay=u),k.szLabel&&this.adaptLabel(d),setTimeout("map.Layer.adaptLabel()",100),!0):g&&!e.match(/:label/)?(this.switchLayerByCSS(null,e,g,l?"inline":"none"),k&&(k.szDisplay=
u),setTimeout("map.Layer.adaptLabel()",100),!0):!1};ixMap.Layer.prototype.switchLayerOnTiles=function(d,e){var g=!1;if(map.Tiles&&map.Tiles.nCount>0){d=map.Tiles.getTileNodeIds(d);for(var l=0;l<d.length;l++)g=this.switchLayerByFeature(d[l],e)?!0:g}return g};ixMap.Layer.prototype.switchLayerByFeature=function(d,e){var g,l=!1,u=this.document.getElementById(d);if(u)if(this.addChangedFeatureNode(u),u.getAttributeNS(null,"class")=="linetemplate"||u.getAttributeNS(szMapNs,"class")=="linetemplate")if(d.match(/#/))for(d=
d.split("#"),g=0;g<10;g++){if(u=this.document.getElementById(d[0]+"_"+g+"#"+d[1]))u.style.setProperty("display",e?"inline":"none",""),l=!0}else for(g=0;g<10;g++){if(u=this.document.getElementById(d+"_"+g))u.style.setProperty("display",e?"inline":"none",""),l=!0}else u.style.setProperty("display",e?"inline":"none",""),l=!0;return l};ixMap.Layer.prototype.switchLayerByCSS=function(d,e,g,l){if(g!="(null)"){if(e&&(e=e.split(":")[0],this.listA[e+"_1"])){var u=g.substr(e.length,g.length-e.length),k=parseInt(u),
v=parseInt(u.substr(u.length-1,1));u=g.substr(0,e.length);for(g=1;this.listA[e+"_"+g];)k++,this.switchLayerByCSS(d,null,u+"-"+g+k+"s"+v,l),g++;return}map.Scale.CSSStyleNodes&&(d=map.Scale.CSSStyleNodes,map.CSS=new ixMap.CSS(map.Scale.CSSStyleNodes),map.CSS.setStyle(g,"display",l),map.Scale.fCSSStyleNodeChanged=!0,d.firstChild.nextSibling.nodeValue=map.CSS.getStyleString(),displayMessage("please wait ...",500),setTimeout("map.Scale.refreshCSSStyles()",200))}};ixMap.Layer.prototype.switchScaleDependentLayer=
function(d,e){if(map.fDynamicLayer&&this.depListA!=null){var g=0;for(g in this.depListA){if(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.depListA[g].nLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.depListA[g].nUpper)var l="inline";else l="none",!this.depListA[g].shapeId.match(/:label/)&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.depListA[g].nUpper&&(map.Themes&&map.Themes.getThemeCount()!==0||displayMessage("'"+this.depListA[g].shapeId+"' not visible at actual zoom level!",
3E3,"notify"));if(this.depListA[g].szDisplayAttribute!=l){this.depListA[g].szDisplayAttribute=l;if(this.isChangedFeature(this.depListA[g].shapeId)){if(this.depListA[g].szOldDisplayAttribute==l)continue;this.depListA[g].szOldDisplayAttribute=this.depListA[g].szDisplayAttribute}var u=this.depListA[g].szFeature;map.Legend&&map.Legend.switchLegendCheckBox(d,u,l)}try{var k=this.depListA[g].shapeId;k.match(/label/)?(k.split(":"),this.listA[k.split(":")[0]].szDisplayLabel=l):this.listA[k].szDisplay=l}catch(v){alert("Syntax error: "+
k)}}if(map.Scale.CSSStyleNodes&&map.Scale.CSSStyleNodes.firstChild.nextSibling&&map.fSwitchByCSS){d=map.Scale.CSSStyleNodes;map.CSS=new ixMap.CSS(map.Scale.CSSStyleNodes);for(g in this.depListA)e=this.depListA[g],e.szDisplayAttribute!=e.szOldDisplayAttribute&&(l=e.depClass,l.length>3?(map.CSS.setStyle(l,"display",e.szDisplayAttribute),map.Scale.fCSSStyleNodeChanged=!0):(l=map.SVGDocument.getElementById(e.shapeId))&&l.style.setProperty("display",e.szDisplayAttribute,""));map.Scale.fCSSStyleNodeChanged&&
(d.firstChild.nextSibling.nodeValue=map.CSS.getStyleString())}else for(e=e?e:map.SVGRootElement,g=e.getElementsByTagName("g"),d=0;d<g.length;d++)e=g.item(d).getAttributeNS(null,"id"),e=map.Tiles.getMasterId(e),this.depListA[e]&&g.item(d).style.setProperty("display",this.depListA[e].szDisplayAttribute,"")}};ixMap.Layer.prototype.isScaleDependentLayer=function(d){return this.depListA&&this.depListA[d]?!0:!1};ixMap.Layer.prototype.isScaleDependentLayerOn=function(d){return this.depListA&&this.depListA[d]?
this.depListA[d].szDisplayAttribute.match(/none/)?!1:!0:!0};ixMap.Layer.prototype.zoomToScaleDependentLayerOn=function(d){if(typeof this.listA[d]!="undefined"){map.Event.doDefaultZoom(null);var e=map.Scale.nTrueMapScale*map.Scale.nZoomScale;d=this.depListA&&this.depListA[d]&&this.depListA[d].nUpper?this.depListA[d].nUpper:map.Tiles.depUpper?map.Tiles.depUpper.split(":")[1]:0;var g=Math.ceil(e/d);e=map.Zoom.getBox();d=e.width/g;g=e.height/g;e.x+=(e.width-d)/2;e.y+=(e.height-g)/2;e.width=d;e.height=
g;map.Zoom.setNewArea(e);setTimeout("map.Tiles.switchScaleDependentTiles()",5E3)}};ixMap.Layer.prototype.isLayerOn=function(d){return this.listA[d]?this.listA[d].szDisplay.match(/none/)?!1:!0:!1};ixMap.Layer.prototype.changeLayerOpacity=function(d,e){var g;(g=this.changeOpacity(d,e))||(g=this.changeOpacityOnTiles(d,e));return g};ixMap.Layer.prototype.changeOpacityOnTiles=function(d,e){var g=!1;if(map.Tiles&&map.Tiles.nCount>0){d=map.Tiles.getTileNodeIds(d);for(var l=0;l<d.length;l++)g=this.changeOpacity(d[l],
e)?!0:g}else g=this.changeOpacity(d,e)?!0:g;return g};ixMap.Layer.prototype.changeOpacity=function(d,e){var g,l=!1,u=this.document.getElementById(d);if(u)if(u.getAttributeNS(null,"class")=="linetemplate"||u.getAttributeNS(szMapNs,"class")=="linetemplate")if(d.match(/#/))for(d=d.split("#"),g=0;g<10;g++){if(u=this.document.getElementById(d[0]+"_"+g+"#"+d[1]))this.changeNodeOpacity(u,e),l=!0}else for(g=0;g<10;g++){if(u=this.document.getElementById(d+"_"+g))this.changeNodeOpacity(u,e),l=!0}else this.changeNodeOpacity(u,
e),l=!0;return l};ixMap.Layer.prototype.changeNodeOpacity=function(d,e,g){var l=d.style.getPropertyValue(g?g:"opacity");l&&l.length!==0||(l="1");l=Number(l);l=Math.min(1,l*e);l=Math.max(0,l);d.style.setProperty(g?g:"opacity",String(l),"")};ixMap.Layer.prototype.initPatternScaling=function(d,e){e||(e=map.SVGRootElement);d=1/map.Scale.getEmbedScale()*map.Scale.nFeatureScaling;e=e.getElementsByTagName("pattern");for(var g=0;g<e.length;g++)e.item(g).getAttributeNS(null,"id").match(/antizoomandpan/)||
(getPatternMatrix(e.item(g)),e.item(g).setAttributeNS(null,"patternTransform","matrix("+d+" 0 0 "+d+" 0 0)"))};ixMap.Layer.prototype.changeLineScaling=function(d,e){this.doFeatureScaling(e);map.Scale.nLineScaling*=e};ixMap.Layer.prototype.changeLabelScaling=function(d,e){this.doLabelScaling(e);map.Scale.nLabelScaling*=e};ixMap.Layer.prototype.changeFeatureScaling=function(d,e,g){if(!(e>=1&&map.Scale.featureScaling_lastScale>=1)||g){var l=e/map.Scale.getEmbedScale();g=e;if(map.fFeatureScalingDynamic){var u=
Math.log(1/e);u>1&&(e*=u)}map.Layer.nFeatureScale=e;map.Layer.nDynamicScale=map.Layer.nFeatureScale/map.Scale.nZoomScale;u=e/map.Scale.featureScaling_lastScale;map.Scale.featureScaling_lastScale=e;if(u!==0&&u!==1)if(map.fFeatureScaling){var k=map.SVGRootElement.getElementsByTagName("pattern");var v=getMatrix(map.Scale.zoomNode);var x=v[4]+map.Scale.scaleX(map.SVGRootElement.currentTranslate.x),H=v[5]+map.Scale.scaleY(map.SVGRootElement.currentTranslate.y);x=-x*l;H=-H*l;for(v=0;v<k.length;v++)k.item(v).getAttributeNS(null,
"id").match(/antizoomandpan/)||(getPatternMatrix(k.item(v)),k.item(v).setAttributeNS(null,"patternTransform","matrix("+l+" 0 0 "+l+" "+String(x)+" "+String(H)+")"));d=d?d.target.ownerDocument:map.SVGDocument;k=!0;map.Scale.nFeatureScaling<1&&(k=!1,u<1&&map.Scale.nFeatureScaling*map.Zoom.nZoom>=1&&(map.Scale.nFeatureScaling*map.Zoom.nZoom*u<1&&(u=1/map.Scale.nFeatureScaling/map.Zoom.nZoom),k=!0),u>1&&map.Scale.nFeatureScaling*map.Zoom.nZoom*u>=1&&(map.Scale.nFeatureScaling*map.Zoom.nZoom<1&&(u=map.Zoom.nZoom*
u/(1/map.Scale.nFeatureScaling)),k=!0));if(k){k=map.SVGRootElement.getElementsByTagName("filter");for(v=0;v<k.length;v++)if(!k.item(v).getAttributeNS(null,"id").match(/antizoomandpan/))for(l=k.item(v).childNodes,x=0;x<l.length;x++)l.item(x).nodeName=="feMorphology"&&l.item(x).setAttributeNS(null,"radius",Number(l.item(x).getAttributeNS(null,"radius"))*u),l.item(x).nodeName=="feOffset"&&(l.item(x).setAttributeNS(null,"dx",Number(l.item(x).getAttributeNS(null,"dx"))*u),l.item(x).setAttributeNS(null,
"dy",Number(l.item(x).getAttributeNS(null,"dy"))*u)),l.item(x).nodeName=="feGaussianBlur"&&l.item(x).setAttributeNS(null,"stdDeviation",Number(l.item(x).getAttributeNS(null,"stdDeviation"))*u);this.doFeatureScaling(u);this.doLabelScaling(u);l=u;if(k=map.SVGDocument.getElementById("marker_symbols"))for(k=k.childNodes,v=0;v<k.length;v++)if(k.item(v).nodeType==1&&(x=k.item(v).getAttributeNS(null,"id"))&&x.length&&!x.match(/antizoomandpan/)){var G=getMatrix(k.item(v));G&&(G[0]*=u,G[3]*=u,setMatrix(k.item(v),
G),map.Scale.scaledSymbolsA["#"+x]=!0)}if(k=map.SVGDocument.getElementById("symbolstore"))for(k=k.getElementsByTagName("g"),v=0;v<k.length;v++)(x=k.item(v).getAttributeNS(null,"id"))&&x.length&&x.match(/symbol/)&&!x.match(/antizoomandpan/)&&(G=getMatrix(k.item(v)))&&(G[0]*=u,G[3]*=u,G[4]*=u,G[5]*=u,setMatrix(k.item(v),G),map.Scale.scaledSymbolsA["#"+x]=!0);k=map.SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(v=0;v<k.length;v++)x=k.item(v).getAttributeNS(szXlink,
"href"),map.Scale.scaledSymbolsA[x]&&(G=getMatrix(k.item(v)))&&(G[0]/=u,G[3]/=u,setMatrix(k.item(v),G));k=map.SVGHiddenGroup.getElementsByTagName("use");for(v=0;v<k.length;v++)x=k.item(v).getAttributeNS(szXlink,"href"),map.Scale.scaledSymbolsA[x]&&(G=getMatrix(k.item(v)))&&(G[0]/=u,G[3]/=u,setMatrix(k.item(v),G));this.scaleTextOffsets(map.SVGRootElement,e,l,d.getElementById("mapstyles"));this.scaleLineDecorations(map.SVGRootElement,e);this.doObjectScaling(g)}}else this.doObjectScaling(g)}};ixMap.Layer.prototype.doFeatureScaling=
function(d){var e=map.SVGDocument.getElementById("mapstyles");if(e){var g=e.firstChild.nextSibling.nodeValue;var l=__scaleLineStyleString(g,d);e.firstChild.nextSibling.nodeValue=l;map.Scale.fCSSStyleNodeChanged=!0}else if(map.fFeatureScalingByLayer){e=[];g=[];var u=!1;for(l in map.Layer.listA){var k=map.Layer.listA[l];if(k.szFlag.match(/tiled/)){if(!u){u=!0;var v=map.Tiles.getTileInfo();if(v)for(var x=0;x<v.length;x++){var H=Number(v[x].tileGroup.getAttributeNS(szMapNs,"deltaTBD"));if(v[x].tileGroup.style.getPropertyValue("display")==
"inline"){k=v[x].tileGroup.getElementsByTagName("g");for(var G=0;G<k.length;G++)k.item(G).getAttributeNS(null,"id").match(/:label/)||(e[e.length]=k.item(G),g[e.length-1]=H?H:1);v[x].tileGroup.setAttributeNS(szMapNs,"deltaTBD","1")}else v[x].tileGroup.hasChildNodes()&&v[x].tileGroup.setAttributeNS(szMapNs,"deltaTBD",String(d*(H?H:1)))}}}else if(k.szName&&(k=map.SVGDocument.getElementById(k.szName)))for(e[e.length]=k,g[e.length-1]=1,k=k.getElementsByTagName("g"),G=0;G<k.length;G++)k.item(G).getAttributeNS(null,
"id").match(/:label/)||(e[e.length]=k.item(G),g[e.length-1]=1)}k=map.SVGDocument.getElementById("mapobjects");k=k.getElementsByTagName("g");for(G=0;G<k.length;G++)e[e.length]=k.item(G),g[e.length-1]=1;for(u=0;u<e.length;u++)(l=e[u].getAttributeNS(null,"style"))&&l.length&&(l=__scaleLineStyleString(l,d*g[u]),e[u].setAttributeNS(null,"style",l))}};ixMap.Layer.prototype.doDynamicObjectScaling=function(d){map.Layer.nObjectScale=d;map.fObjectScaling=="dynamic"&&(map.Layer.nObjectScale*=Math.pow(1/(map.Scale.nTrueMapScale*
map.Scale.nZoomScale/map.Scale.nNormalSizeScale),1/map.Scale.nDynamicScalePow));map.Layer.nDynamicObjectScale=map.Layer.nObjectScale/d};ixMap.Layer.prototype.doObjectScaling=function(d){if(map.fObjectScaling){this.doDynamicObjectScaling(d);var e=map.Layer.nObjectScale/map.Scale.objectScaling_lastScale;map.Scale.objectScaling_lastScale=map.Layer.nObjectScale;if(e!==0&&e!==1&&(d=!0,map.Scale.nObjectScaling<1&&(d=!1,e<1&&map.Scale.nObjectScaling*map.Zoom.nZoom>=1&&(map.Scale.nObjectScaling*map.Zoom.nZoom*
e<1&&(e=1/map.Scale.nObjectScaling/map.Zoom.nZoom),d=!0),e>1&&map.Scale.nObjectScaling*map.Zoom.nZoom*e>=1&&(map.Scale.nObjectScaling*map.Zoom.nZoom<1&&(e=map.Zoom.nZoom*e/(1/map.Scale.nObjectScaling)),d=!0)),d)){d=e;e=e/map.Zoom.nOldZoomX*map.Zoom.nOldZoomY/map.Zoom.nZoomY*map.Zoom.nZoomX;for(var g=map.Layer.objectGroup.childNodes,l=0;l<g.length;l++)if(g.item(l).getAttributeNS(null,"id").match(/featuregroup/)){var u=g.item(l).style.getPropertyValue("stroke-width")*d;g.item(l).style.setProperty("stroke-width",
String(u))}else if(map.antiZoomAndPanList.isContained(g.item(l))){u=g.item(l).childNodes;for(var k=0;k<u.length;k++)u.item(k).firstChild&&u.item(k).firstChild.style.getPropertyValue("stroke-width")&&u.item(k).firstChild.style.setProperty("stroke-width",u.item(k).firstChild.style.getPropertyValue("stroke-width")*d)}else for(u=g.item(l).childNodes,k=0;k<u.length;k++){var v=getMatrix(u.item(k));v&&(v[0]*=d,v[3]*=e,setMatrix(u.item(k),v))}}}};ixMap.Layer.prototype.doStoredFeatureScaling=function(d){if(map.fFeatureScaling){var e;
if(!(d?d.target.ownerDocument:map.SVGDocument).getElementById("mapstyles")){d=[];var g=[];if(e=map.Tiles.getTileInfo())for(var l=0;l<e.length;l++)if(e[l].tileGroup.style.getPropertyValue("display")=="inline"){var u=Number(e[l].tileGroup.getAttributeNS(szMapNs,"deltaTBD"));if(u&&u!=1){var k=e[l].tileGroup.getElementsByTagName("g");for(var v=0;v<k.length;v++)d[d.length]=k.item(v),g[d.length-1]=u?u:1,e[l].tileGroup.setAttributeNS(szMapNs,"deltaTBD","1")}}for(k=0;k<d.length;k++)d[k].getAttributeNS(null,
"id").match(/:label/)||(e=d[k].getAttributeNS(null,"style"))&&e.length&&(e=__scaleLineStyleString(e,g[k]),d[k].setAttributeNS(null,"style",e))}}};ixMap.Layer.prototype.scaleTextOffsets=function(d,e,g,l){for(var u=d.getElementsByTagName("rect"),k=0;k<u.length;k++){var v=u.item(k).getAttributeNS(null,"id");if(v&&v.match(/textbg/)&&(v=u.item(k).nextSibling.nextSibling)&&v.nodeName=="text")if(v=map.Dom.getBox(v),v.width<0||v.height<0)u.item(k).setAttributeNS(null,"width",0),u.item(k).setAttributeNS(null,
"height",0);else{l&&(v.x*=g,v.y*=g,v.width*=g,v.height*=g);var x=map.Scale.normalX(1)*e;u.item(k).setAttributeNS(null,"x",v.x-x);u.item(k).setAttributeNS(null,"y",v.y-x);u.item(k).setAttributeNS(null,"width",v.width+x*2);u.item(k).setAttributeNS(null,"height",v.height+x*2)}}u=d.getElementsByTagName("text");for(k=0;k<u.length;k++)if((v=u.item(k).parentNode.getAttributeNS(null,"id"))&&v.match(/label/)&&(v=u.item(k),d=v.getAttributeNS(null,"transform"))){d=d.split(" ");for(e=0;e<d.length;e++)d[e].match(/translate/)&&
(l=d[e].substr(10,d[e].length-11).split(","),d[e]="translate("+Number(l[0])*g+","+Number(l[1])*g+")");l="";for(e=0;e<d.length;e++)l=l+d[e]+" ";v.setAttributeNS(null,"transform",l)}};ixMap.Layer.prototype.scaleLineDecorations=function(d,e){d=d.getElementsByTagName("text");for(var g=0;g<d.length;g++)if(d.item(g)&&d.item(g).getAttributeNS(null,"id")&&d.item(g).getAttributeNS(null,"id").match(/linedecoration/)){var l=d.item(g).style.getPropertyValue("dominant-baseline"),u=parseFloat(d.item(g).style.getPropertyValue("baseline-shift")),
k=parseFloat(d.item(g).style.getPropertyValue("font-size")),v=0;l=="mathematical"&&(v+=k/3);l=="hanging"&&(v-=k);v-=u*e;d.item(g).setAttributeNS(null,"dy",v)}};ixMap.Layer.prototype.doLabelScaling=function(d){var e=map.SVGDocument.getElementById("mapstyles");if(e){var g=e.firstChild.nextSibling.nodeValue;var l=__scaleTextStyleString(g,d);e.firstChild.nextSibling.nodeValue=l;map.Scale.fCSSStyleNodeChanged=!0;map.Scale.refreshCSSStyles()}else for(e=map.Scale.canvasNode.getElementsByTagName("g"),g=0;g<
e.length;g++)if(!map.antiZoomAndPanList.isContained(e.item(g))){var u=e.item(g).getAttributeNS(null,"id");if(u&&u.length!==0&&u.match(/label/)&&(l=e.item(g).getAttributeNS(null,"style"))&&l.length)if(d===0)map.Layer.switchLayer(null,u,null,e.item(g).style.getPropertyValue("display")=="none"?!0:!1);else{l=__scaleStyleString(l,d);e.item(g).setAttributeNS(null,"style",l);u=e.item(g).childNodes;for(var k=0;k<u.length;k++)u.item(k).nodeName=="text"&&(l=u.item(k).getAttributeNS(null,"style"))&&l.length&&
(l=__scaleStyleString(l,d),u.item(k).setAttributeNS(null,"style",l))}}for(var v in map.Layer.generatedLabelA)if(map.Layer.generatedLabelA[v])for(e=map.Layer.generatedLabelA[v].getElementsByTagName("text"),g=0;g<e.length;g++)(l=e.item(g).getAttributeNS(null,"style"))&&l.length&&(l=__scaleStyleString(l,d),e.item(g).setAttributeNS(null,"style",l));this.adaptLabel(null)};ixMap.Layer.prototype.changeObjectScaling=function(d,e,g){var l,u;e===0&&(e=1/map.Scale.nObjectScaling);if(g){var k=g.childNodes;for(g=
0;g<k.length;g++){if(d=getMatrix(k.item(g)))d[0]*=e,d[3]*=e,setMatrix(k.item(g),d);(l=k.item(g).childNodes[0])&&(d=getMatrix(l))&&(d[4]/=Math.pow(e,.5),d[5]/=Math.pow(e,.5),setMatrix(l,d))}}else if(!(map.Scale.nObjectScaling*e>8||map.Scale.nObjectScaling*e<.1))for(map.Scale.nObjectScaling*=e,l=map.Layer.objectGroup.childNodes,g=0;g<l.length;g++)if(!map.antiZoomAndPanList.isContained(l.item(g)))for(k=l.item(g).childNodes,u=0;u<k.length;u++)if(d=getMatrix(k.item(u)))d[0]*=e,d[3]*=e,setMatrix(k.item(u),
d)};ixMap.Layer.prototype.setObjectRotate=function(d,e,g){var l;if(g){var u=g.childNodes;for(g=0;g<u.length;g++)setRotate(u.item(g),(360+Number(e))%360)}else for(d=map.Layer.objectGroup.childNodes,g=0;g<d.length;g++)if(!map.antiZoomAndPanList.isContained(d.item(g)))for(u=d.item(g).childNodes,l=0;l<u.length;l++)setRotate(u.item(l),(360+Number(e))%360)};ixMap.Layer.prototype.setPatternRotate=function(d,e,g){g||(g=map.SVGRootElement);d=g.getElementsByTagName("pattern");for(g=0;g<d.length;g++)d.item(g).getAttributeNS(null,
"id").match(/antizoomandpan/)||setRotate(d.item(g),(360+Number(e))%360,"patternTransform")};ixMap.Layer.prototype.setSymbolRotate=function(d,e,g){if(d=map.SVGDocument.getElementById("marker_symbols"))for(d=d.childNodes,g=0;g<d.length;g++)if(d.item(g).nodeType==1){var l=d.item(g).getAttributeNS(null,"id");l&&l.length&&!l.match(/antizoomandpan/)&&(setRotate(d.item(g),(360+Number(e))%360),map.Scale.rotatedSymbolsA["#"+l]=!0)}if(d=map.SVGDocument.getElementById("symbolstore"))for(d=d.getElementsByTagName("g"),
g=0;g<d.length;g++)(l=d.item(g).getAttributeNS(null,"id"))&&l.length&&l.match(/symbol/)&&!l.match(/antizoomandpan/)&&(setRotate(d.item(g),(360+Number(e))%360),map.Scale.rotatedSymbolsA["#"+l]=!0);d=map.SVGDocument.getElementById("widgets:antizoomandpan").getElementsByTagName("use");for(g=0;g<d.length;g++)l=d.item(g).getAttributeNS(szXlink,"href"),map.Scale.rotatedSymbolsA[l]&&setRotate(d.item(g),(360+Number(-e))%360);d=map.SVGHiddenGroup.getElementsByTagName("use");for(g=0;g<d.length;g++)l=d.item(g).getAttributeNS(szXlink,
"href"),map.Scale.rotatedSymbolsA[l]&&setRotate(d.item(g),(360+Number(-e))%360)};ixMap.Layer.prototype.changeObjectRotate=function(d,e,g){if(g){var l=g.childNodes;for(g=0;g<l.length;g++){var u=getRotateAttributeValue(l.item(g));setRotate(l.item(g),(360+Number(u)+Number(e))%360)}}else for(d=map.Layer.objectGroup.childNodes,g=0;g<d.length;g++)if(!map.antiZoomAndPanList.isContained(d.item(g)))for(l=d.item(g).childNodes,g=0;g<l.length;g++)u=getRotateAttributeValue(l.item(g)),setRotate(l.item(g),(360+
Number(u)+Number(e))%360)};ixMap.Layer.prototype.setLabelRotate=function(d,e){var g;d=map.Layer.layerNode.getElementsByTagName("text");for(g=0;g<d.length;g++)map.antiZoomAndPanList.isContained(d.item(g))||d.item(g).firstChild&&d.item(g).firstChild.nodeName=="textPath"||setRotate(d.item(g),(360+Number(e))%360);this.adaptLabel()};ixMap.Layer.prototype.changeLabelRotate=function(d,e){var g;d=map.Scale.canvasNode.getElementsByTagName("text");for(g=0;g<d.length;g++)if(!(map.antiZoomAndPanList.isContained(d.item(g))||
d.item(g).firstChild&&d.item(g).firstChild.nodeName=="textPath")){var l=getRotateAttributeValue(d.item(g));setRotate(d.item(g),(360+Number(l)+Number(e))%360)}this.adaptLabel()};ixMap.Layer.prototype.adaptLabel=function(d,e){map.fAdaptLabelToScaling&&this.adaptLabelToScaling(d,e);if(map.fCheckLabelOverlap||map.fCheckLabelSpace||map.fCheckLabelSqueeze)e&&this.prepareCheckOverlap(d,e),this.checkLabelOverlapping(d,e)};ixMap.Layer.prototype.adaptLabelToScaling=function(d,e){e||(e=map.SVGRootElement);if(map.fAdaptLabelToScaling||
map.fCheckLabelOnlyOne){d=!1;for(var g in map.Layer.listA){var l=map.Layer.listA[g];l.nRenderer&12&&l.szType=="line"&&l.szDisplayLabel=="inline"&&(d=!0)}if(d){e=e.getElementsByTagName("textPath");if(map.Scale.oldZoomScale!=map.Scale)for(g=0;g<e.length;g++)e.item(g).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||e.item(g).parentNode.style.setProperty("display","none","");map.Label.fAdaptLabelToScalingPending||(map.Label.fAdaptLabelToScalingPending=!0,map.fAdaptLabelToScaling=="delayed"?
map.pushAction(()=>{setTimeout(()=>{map.Label.adaptLabelToScaling(null)},1500)}):map.pushAction(()=>{map.Label.adaptLabelToScaling(null,null)}))}}};ixMap.Layer.prototype.checkLabelOverlapping=function(d,e){if(map.fCheckLabelOverlap||map.fCheckLabelSpace||map.fCheckLabelSqueeze)e||(e=map.Layer.layerNode),e||(e=map.Scale.canvasNode),map.Label.initCheckOverlap(e)};ixMap.Layer.prototype.prepareCheckOverlap=function(d,e){if(map.fCheckLabelOverlap||map.fCheckLabelSpace)e||(e=map.Layer.layerNode),e||(e=
map.Scale.canvasNode),map.Label.prepareCheckOverlap(e)};ixMap.Layer.prototype.addChangedFeatureNode=function(d){var e;if(this.changedFeatureNodesA){for(e=0;e<this.changedFeatureNodesA.length;e++)if(this.changedFeatureNodesA[e]==d)return;this.changedFeatureNodesA[this.changedFeatureNodesA.length]=d}};ixMap.Layer.prototype.isChangedFeature=function(d){var e;if(this.changedFeatureNodesA)for(e=0;e<this.changedFeatureNodesA.length;e++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[e].getAttributeNS(null,
"id"))==d)return!0;return!1};ixMap.Layer.prototype.removeChangedFeatures=function(d){var e,g;if(this.changedFeatureNodesA)for(e=0;e<this.changedFeatureNodesA.length;e++)if(map.Tiles.getMasterId(this.changedFeatureNodesA[e].getAttributeNS(null,"id"))==d){this.changedFeatureNodesA[e].setAttributeNS(null,"style","");for(g=e;g<this.changedFeatureNodesA.length-1;g++)this.changedFeatureNodesA[g]=this.changedFeatureNodesA[g+1];this.changedFeatureNodesA.length--;e--}};ixMap.Layer.prototype.setPointerEvents=
function(d){for(var e in map.Layer.listA){var g=map.Layer.listA[e].szName;if(g){var l=map.SVGDocument.getElementById(g);g=d==null||d==g?null:"none";l&&(g?l.style.setProperty("pointer-events",g,""):l.style.removeProperty("pointer-events"))}}};ixMap.Layer.prototype.getLayerObj=function(d){if(!d)return null;var e=d.split("#")[0].split(":")[0];e=="legend"&&(e=d.split(":")[2]);return this.listA[e]};ixMap.Layer.prototype.getLayerName=function(d){return(d=this.getLayerObj(d))?d.szName:null};ixMap.Layer.prototype.getLayerObjOfNode=
function(d){if(d)for(;d.parentNode&&d.parentNode.nodeName!="SVG";){var e=this.getLayerObj(d.getAttributeNS(null,"id"));if(e)return e;d=d.parentNode}return null};ixMap.Layer.prototype.getLayerItemNodeOfNode=function(d){for(;d.parentNode&&d.parentNode.nodeName!="SVG";){if(this.getLayerObj(d.getAttributeNS(null,"id")))return d;d=d.parentNode}return null};ixMap.Layer.prototype.getLayerItemNodes=function(d){if(d=this.getLayerItemNodeOfNode(d)){var e=d.getAttributeNS(null,"id");return this.getLayerObj(e).szType==
"point"&&map.fTileTextNoClip||map.Tiles.getMasterId(e)==e?Array(d):map.Tiles.getTileNodes(map.Tiles.getMasterId(e))}return[]};ixMap.Layer.prototype.getStyleOrClass=function(d){var e={};e.szClass=map.Dom.getAttributeByNodeOrParents(d,null,"class");e.szStyle=map.Dom.getAttributeByNodeOrParents(d,null,"style");return e};ixMap.Layer.prototype.isMapObject=function(d){for(;d;){if(d==map.Scale.canvasNode)return!0;d=d.parentNode}return!1};ixMap.Layer.prototype.isLoaded=function(d){return(d=this.getLayerObj(d))?
d.szFlag.match(/tiled/)?map.Tiles.isAnyLayerTileLoaded():!0:!1};ixMap.Label=function(d){this.document=d?d.target.ownerDocument:map.SVGDocument;this.checkItemA=[];this.checkOvlA=[];this.nodeA=[];this.boxA=[];this.rootNode=null;this.zoomScale=0;this.fCheckLabelOverlappingPending=!1;this.ALTS_rootNode=this.ALTS_nodeA=this.ALTS_textA=null;this.killProcess=this.fAdaptLabelToScalingPending=!1};ixMap.Label.prototype=new Map;ixMap.Label.Item=function(d){if(d)this.textNode=d,this.szId=d.getAttributeNS(null,
"id")||"noId",this.bgNode=map.SVGDocument.getElementById(this.szId+":bg"),this.bbNode=map.SVGDocument.getElementById(this.szId+":textbg"),this.poNode=map.SVGDocument.getElementById(this.szId.slice(0,this.szId.length-1)),this.poNode||(d=map.Tiles.getMasterId(this.szId),d=d.slice(0,d.length-1),this.poNode=map.SVGDocument.getElementById(d)),this.bBox=null;else return this.szId="mapLabelNullItem",null};ixMap.Label.Item.prototype.setDisplay=function(d){this.textNode.style.setProperty("display",d,"");this.bgNode&&
this.bgNode.style.setProperty("display",d,"");this.bbNode&&this.bbNode.style.setProperty("display",d,"");this.poNode&&this.poNode.nodeName=="use"&&this.poNode.style.setProperty("display",d,"")};ixMap.Label.Item.prototype.setScale=function(d,e){setScale(this.textNode,d,e);this.bgNode&&setScale(this.bgNode,d,e);this.bbNode&&setScale(this.bbNode,d,e)};ixMap.Label.Item.prototype.scaleBackground=function(){if(this.bbNode&&this.textNode){var d=map.Scale.normalX(2)*map.Scale.nZoomScale,e=map.Dom.getBox(this.textNode),
g=getTranslateAttributeValue(this.textNode);e.width>0&&e.height>0&&(this.bbNode.setAttributeNS(null,"x",e.x+(g.x?g.x-d:0)),this.bbNode.setAttributeNS(null,"y",e.y-d+g.y),this.bbNode.setAttributeNS(null,"width",e.width+d*2),this.bbNode.setAttributeNS(null,"height",e.height+d*2))}};ixMap.Label.prototype.stopProcessing=function(){this.killProcess=!0};ixMap.Label.prototype.prepareCheckOverlap=function(d){d=d.getElementsByTagName("text");for(var e=0;e<d.length;e++)d.item(e).firstChild&&d.item(e).firstChild.nodeName!=
"textPath"&&!d.item(e).getAttributeNS(null,"id").match(/:bg/)&&(new ixMap.Label.Item(d.item(e))).setDisplay("none")};ixMap.Label.prototype.initCheckOverlap=function(d){this.killProcess=!1;this.fCheckLabelOverlappingPending||(this.fCheckLabelOverlappingPending=!0,this.checkItemA.length=0,this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0,this.rootNode=d,map.fPDFEmbed||!map.Tiles.dataNode?setTimeout(()=>{map.Label.collectCheckOverlap()},0):map.pushAction(()=>{map.Label.collectCheckOverlap()}))};
ixMap.Label.prototype.getCheckItem=function(d){return this.checkItemA[d]};ixMap.Label.prototype.getCheckItemCount=function(){return this.checkItemA.length};ixMap.Label.prototype.addCheckItem=function(d,e){if(d){var g=map.Layer.getLayerObjOfNode(d);if(g&&(!g||d.parentNode.getAttributeNS(null,"id").match(/value/)||g.szDisplayLabel=="inline")&&(map.fCheckLabelOverlap||g.szType=="polygon")&&d.firstChild&&d.firstChild.nodeName!="textPath"&&!d.getAttributeNS(null,"id").match(/:bg/)){var l=getMatrix(d);
l=new point(Number(l[4]),Number(l[5]));var u=map.Scale.getMapOffset(d);l.x+=u.x;l.y+=u.y;l.x<this.zoomBox.x||l.x>this.zoomBox.x+this.zoomBox.width||l.y<this.zoomBox.y||l.y>this.zoomBox.y+this.zoomBox.height||(d=new ixMap.Label.Item(d),d.fRef=g&&g.szType=="polygon"?!0:!1,d.fScale=e,this.checkItemA[this.checkItemA.length]=d)}}else d=new ixMap.Label.Item(null),this.checkItemA[this.checkItemA.length]=d};ixMap.Label.prototype.addCheckItemTheme=function(d,e){if(d.firstChild){e=getMatrix(d);e=new point(Number(e[4]),
Number(e[5]));var g=map.Scale.getMapOffset(d);e.x+=g.x;e.y+=g.y;e.x<this.zoomBox.x||e.x>this.zoomBox.x+this.zoomBox.width||e.y<this.zoomBox.y||e.y>this.zoomBox.y+this.zoomBox.height||(d=new ixMap.Label.Item(d),d.fRef=!1,d.fScale=!1,this.checkItemA[this.checkItemA.length]=d)}};ixMap.Label.prototype.collectCheckOverlap=function(){var d=!1,e=[],g;for(g in map.Layer.listA)map.Layer.listA[g].szType=="polygon"&&e.push(g);map.fCheckOverlapAllLayer||e.push("resetoverlap");for(g in map.Layer.listA)map.Layer.listA[g].szType!=
"polygon"&&e.push(g);this.zoomBox=map.Zoom.getBox();for(g=e.length-1;g>=0;g--)if(e[g]=="resetoverlap")this.addCheckItem(null);else{var l=map.Layer.listA[e[g]];if(l.szFlag.match(/tiled/)){if(!d&&(d=!0,l=map.Tiles.getTileInfo())){this.addCheckItem(null);for(var u=0;u<l.length;u++)if(l[u].tileGroup.style.getPropertyValue("display")=="inline"){var k=l[u].tileGroup.getElementsByTagName("text");for(var v=k.length-1;v>=0;v--)k.item(v).parentNode.style.getPropertyValue("display")!="none"&&this.addCheckItem(k.item(v));
map.fCheckOverlapClipOnTiles&&this.addCheckItem(null)}}}else if(l.szName){if(u=map.SVGDocument.getElementById(l.szName+":label"))if((v=u.getElementsByTagName("g"))&&v.length>0)for(var x=0;x<v.length;x++){if(k=v.item(x).getElementsByTagName("text"),k.length)for(u=k.length-1;u>=0;u--)this.addCheckItem(k.item(u))}else if(k=u.getElementsByTagName("text"),k.length)for(u=k.length-1;u>=0;u--)this.addCheckItem(k.item(u));if(u=map.SVGDocument.getElementById(l.szName+":values"))if(k=u.getElementsByTagName("text"),
k.length)for(u=k.length-1;u>=0;u--)this.addCheckItem(k.item(u))}}d=map.Themes.getTextObjects();for(u=0;u<d.length;u++)this.addCheckItemTheme(d[u]);this.zoomScale=map.Scale.nZoomScale;this.checkItemA.length?setTimeout("map.Label.getBoxCheckOverlap(0)",100):this.fCheckLabelOverlappingPending=!1};ixMap.Label.prototype.getBoxCheckOverlap=function(d){var e=new ixMap.Sleep("map.Label.getBoxCheckOverlap",this.nflushLabelDraw,"");for(_STATUS("ixMap.Label: getBoxCheckOverlap ==== "+d+" ====== >>>");d>=0;d++){if(this.killProcess){this.fCheckLabelOverlappingPending=
this.killProcess=!1;break}if(e.checkSleep(d,10))break;var g=this.getCheckItem(d);if(g)if(g.szId=="mapLabelNullItem"&&map.fCheckOverlapImplicit)this.nodeA.length=0;else try{g.szOldDisplay=g.textNode.style.getPropertyValue("display");g.textNode.style.setProperty("display","inline","");g.setScale(1,1);g.textNode.setAttributeNS(null,"x",0);g.textNode.setAttributeNS(null,"y",0);g.bgNode&&(g.bgNode.style.setProperty("display","inline",""),g.bgNode.setAttributeNS(null,"x",0),g.bgNode.setAttributeNS(null,
"y",0));var l=map.Dom.getBox(g.textNode);g.fScale&&(l.x*=map.Layer.nFeatureScale,l.y*=map.Layer.nFeatureScale,l.width*=map.Layer.nFeatureScale,l.height*=map.Layer.nFeatureScale);var u=map.Scale.getMapOffset(g.textNode);l.x+=u.x;l.y+=u.y;u=getTranslate(g.textNode);l.x+=u.x;l.y+=u.y;if(map.Zoom.isVisibleBox(l)&&this.checkLabelSpace(g,l)){getRotateAttributeValue(g.textNode)>15&&getRotateAttributeValue(g.textNode)<345&&g.setScale(1,1);g.bBox=l;var k=this.nodeA.length;this.checkOvlA[k]=g;this.nodeA[k]=
g.textNode;this.boxA[k]=l;map.fCheckLabelOverlap||(g.setDisplay("inline"),g.scaleBackground());map.fCheckOverlapImplicit&&this.execCheckLabelOverlappingOne(k)}else g.setDisplay("none")}catch(v){}else{map.fCheckOverlapImplicit?this.fCheckLabelOverlappingPending=!1:setTimeout("map.Label.doCheckOverlap()",100);break}}};ixMap.Label.prototype.checkLabelSpace=function(d,e){if(!d.fRef)return!0;if(d.szId.match(/#/)){var g=d.szId.split("#");g=g[0].substr(0,g[0].length-1)+"#"+g[1]}else g=d.szId.substr(0,d.szId.length-
1);if(g=map.SVGDocument.getElementById(g))if(d.refBox=map.Dom.getBox(g),g=d.refBox,g.width*=map.nCheckLabelSpace,e.width>g.width&&map.fAdaptLabelToScaling){var l=1;map.fCheckLabelSqueeze&&(e.width<=g.width*2||!map.fCheckLabelSpace)&&(l=Math.max(.7,g.width/e.width),e.width*=l,d.setScale(l,1));if(map.fCheckLabelSize&&(e.width<=g.width*1.5||!map.fCheckLabelSpace)){var u=Math.max(.7,g.width/e.width);e.width*=u;e.height*=u;d.setScale(l*u,u)}if(!map.fCheckLabelSpace||e.width<=g.width)d.setDisplay("inline");
else return d.setDisplay("none"),!1}else d.setDisplay("inline");else d.setDisplay(d.szOldDisplay);return!0};ixMap.Label.prototype.doCheckOverlap=function(){map.fCheckLabelOverlap?this.nodeA.length>2E4?(this.checkOvlA.length=0,this.nodeA.length=0,this.boxA.length=0):(this.zoomScale=map.Scale.nZoomScale,map.fCheckLabelOverlap=="delayed"?setTimeout(()=>{map.Label.execCheckLabelOverlappingOnly(0)},2E3):map.pushAction(()=>{map.Label.execCheckLabelOverlappingOnly(0)})):this.fCheckLabelOverlappingPending=
!1};ixMap.Label.prototype.execCheckLabelOverlappingOnly=function(d){for(var e=new ixMap.Sleep("map.Label.execCheckLabelOverlappingOnly",25,"");d<this.checkOvlA.length;d++){if(this.killProcess){this.fCheckLabelOverlappingPending=this.killProcess=!1;return}if(e.checkSleep(d,10))return;this.execCheckLabelOverlappingOne(d)}this.fCheckLabelOverlappingPending=!1};ixMap.Label.prototype.execCheckLabelOverlappingOne=function(d){var e=this.checkOvlA[d];if(map.Zoom.isVisibleBox(e.bBox)){e.refBox||e.setDisplay("inline");
if(map.fCheckLabelOverlap)for(var g=e.textNode.firstChild.nodeValue,l=e.bBox,u=Number(e.textNode.getAttributeNS(szMapNs,"pos")),k=!1,v=0;v<d;v++){var x=this.checkOvlA[v].textNode.firstChild.nodeValue,H=this.checkOvlA[v].bBox;if(map.fCheckLabelOnlyOne&&g==x){x=Number(e.textNode.getAttributeNS(szMapNs,"partlen"));var G=Number(this.checkOvlA[v].textNode.getAttributeNS(szMapNs,"partlen"));if(x>G){this.checkOvlA[v].bBox=null;this.checkOvlA[v].setDisplay("none");continue}e.setDisplay("none");e.bBox=null}if(x=
l&&H&&e.textNode!=this.checkOvlA[v].textNode&&map.Tiles.getMasterId(e.szId)!=map.Tiles.getMasterId(this.checkOvlA[v].szId))x=l&&H?l.x+l.width<H.x||l.x>H.x+H.width||l.y+l.height<H.y||l.y>H.y+H.height?!1:!0:!1;if(x){if(k){H.height<l.height&&(e.refBox||!this.checkOvlA[v].refBox)?(this.checkOvlA[v].bBox=null,map.fKillOverlappingLabel&&this.checkOvlA[v].setDisplay("none")):(e.bBox=null,map.fKillOverlappingLabel&&e.setDisplay("none"));break}if(e.fRef)l.y>H.y?(e.textNode.setAttributeNS(null,"y",l.height),
e.bgNode&&e.bgNode.setAttributeNS(null,"y",l.height),l.y+=l.height):(e.textNode.setAttributeNS(null,"y",-l.height),e.bgNode&&e.bgNode.setAttributeNS(null,"y",-l.height),l.y-=l.height);else if(x=parseInt(e.textNode.style.getPropertyValue("font-size"))||14,l.y>=H.y&&(u===11||u===12||u===1||u===9||u===3||u===0))e.textNode.setAttributeNS(null,"y",x),e.bgNode&&e.bgNode.setAttributeNS(null,"y",x),l.y+=parseInt(x);else if(l.y<=H.y&&(u===7||u===6||u===5||u===9||u===3||u===0))e.textNode.setAttributeNS(null,
"y",-l.height),e.bgNode&&e.bgNode.setAttributeNS(null,"y",-l.height),l.y-=l.height;else if(l.x<=H.x&&(u==1||u==3||u==5))e.textNode.setAttributeNS(null,"x",-(l.width+50*map.Scale.nZoomScale)),e.bgNode&&e.bgNode.setAttributeNS(null,"x",-(l.width+50*map.Scale.nZoomScale)),l.x-=l.width+50*map.Scale.nZoomScale;else if(l.x>=H.x&&(u==11||u==9||u==7))e.textNode.setAttributeNS(null,"x",+(l.width+50*map.Scale.nZoomScale)),e.bgNode&&e.bgNode.setAttributeNS(null,"x",+(l.width+50*map.Scale.nZoomScale)),l.x+=l.width+
50*map.Scale.nZoomScale;else if(H.height<l.height&&(e.refBox||!this.checkOvlA[v].refBox)){this.checkOvlA[v].bBox=null;this.checkOvlA[v].setDisplay("none");continue}k=!0;v=0}}e.bbNode&&e.scaleBackground()}};ixMap.Label.prototype.adaptLabelToScaling=function(d,e){this.killProcess=!1;e||(e=map.SVGRootElement);this.fAdaptLabelToScalingPending=!1;this.ALTS_nodeA=[];this.ALTS_textA=[];this.ALTS_rootNode=e;d=this.ALTS_nodeA;e=null;var g=map.Tiles.getTileInfo();if(g)for(var l=0;l<g.length;l++)if(g[l].tileGroup.style.getPropertyValue("display")==
"inline"){e=g[l].tileGroup.getElementsByTagName("textPath");for(var u=0;u<e.length;u++)e.item(u).parentNode.getAttributeNS(null,"id").match(/:bg/)||e.item(u).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||(d[d.length]=e.item(u))}if(d==null||d.length===0)for(e=map.SVGRootElement.getElementsByTagName("textPath"),l=0;l<e.length;l++)e.item(l).parentNode.getAttributeNS(null,"id").match(/:bg/)||e.item(l).parentNode.getAttributeNS(null,"id").match(/:linedecoration/)||(d[d.length]=e.item(l));
map.pushAction(()=>{map.Label.execAdaptLabelToScaling(0)})};ixMap.Label.prototype.execAdaptLabelToScaling=function(d){for(var e=new ixMap.Sleep("map.Label.execAdaptLabelToScaling",25,""),g=this.ALTS_nodeA,l=this.ALTS_rootNode,u;d<g.length&&!e.checkSleep(d,10);d++){var k=g[d].getAttributeNS(szXlink,"href");k=k.substr(1,k.length-1);var v=l.getElementById(k);if(v){var x=v.parentNode.getAttributeNS(null,"id");u=map.Tiles.getMasterId(x);x=map.Tiles.getTileId(x);if(map.Layer.isScaleDependentLayerOn(u)===
!1)g[d].parentNode.style.setProperty("display","none","");else if(u=g[d].firstChild.nodeValue,!(this.ALTS_textA[u+x]&&map.Tiles.getTileNodes(map.Tiles.getMasterId(k)).length<=1)){var H=map.Dom.getBox(v);g[d].setAttributeNS(szXlink,"href","");g[d].parentNode.style.setProperty("display","inline","");g[d].parentNode.style.setProperty("font-stretch","normal","");var G=map.Dom.getBox(g[d].parentNode);g[d].setAttributeNS(szXlink,"href","#"+k);G=Math.sqrt(G.width*G.width+G.height*G.height);var P=Math.sqrt(H.width*
H.width+H.height*H.height),M=g[d].parentNode,T=map.SVGDocument.getElementById(M.getAttributeNS(null,"id")+":bg");T&&T.style.setProperty("display","inline","");if(G*.9<P){if(G*1.3<P?(M.style.setProperty("font-stretch","normal",""),T&&T.style.setProperty("font-stretch","normal","")):(M.style.setProperty("font-stretch","narrower",""),T&&T.style.setProperty("font-stretch","narrower","")),map.fCheckLabelOnlyOne){var qa=map.Scale.getMapOffset(v);H.x+=qa.x;H.y+=qa.y;qa=getTranslate(v);H.x+=qa.x;H.y+=qa.y;
v=new box(H.x,H.y,H.width,H.height);v.scale(G/P,G/P);map.Zoom.isCompletelyVisibleBox(v)?map.fTileTextNoClip?this.ALTS_textA[u]=k:this.ALTS_textA[u+x]=k:(M.style.setProperty("display","none",""),T&&T.style.setProperty("display","none",""))}}else M.style.setProperty("display","none",""),T&&T.style.setProperty("display","none","")}}}};ixMap.Label.prototype.getLabel=function(d){if(!map.SVGDocument.getElementById(d)){var e=map.Tiles.getTileNodes(map.Tiles.getMasterId(d));if(e.length<1)return null;for(var g=
0;g<e.length;g++){var l=this.getLabel(e[g].getAttributeNS(null,"id"));if(l)return l}}d=map.SVGDocument.getElementById(d);if(!d)return null;if(d.tagName=="g")for(e=d.childNodes,g=0;g<e.length;g++)if(e.item(g).nodeType==1){d=e.item(g);break}if(e=d.getAttributeNS(null,"id"))if(e.match(/#/)?(e=e.split("#"),e=map.SVGDocument.getElementById(e[0]+"T#"+e[1])):e=map.SVGDocument.getElementById(e+"T"),e)return e.firstChild.nodeValue;return d.getAttributeNS(szMapNs,"tooltip")};ixMap.Sleep=function(d,e,g){this.szFunction=
d;this.initCheckSleep(e,g);this.fShowProgressBar=this.fEnableProgressBar=!1;this.nCount=0;this.szCancel="__cancelSleep()"};ixMap.Sleep.prototype.initCheckSleep=function(d,e){this.checkSleepMaxCount=d;this.checkSleepCount=0;this.checkSleepMessage=e;this.runningTime=0;this.fShowProgressBar=this.fMessageDisplay=!1;typeof this.checkSleepMessage=="string"&&this.checkSleepMessage.length&&(map.fExecuteSilent||displayMessage(this.checkSleepMessage,1E3));__timer_reset()};ixMap.Sleep.prototype.checkSleep=function(d,
e){return this.checkSleepMaxCount&&this.checkSleepCount++>=this.checkSleepMaxCount?(this.checkSleepCount=0,d=this.szFunction+"('"+String(d)+"')",this.fShowProgressBar?(this.runningTime=__timer_getSEC(),executeWithProgressBar(d,this.nDoneCount,this.nCount,this.checkSleepMessage,this.szCancel,this.runningTime)):(this.fMessageDisplay||(map.fExecuteSilent||displayMessage(this.checkSleepMessage,1E3),this.fMessageDisplay=!0),setTimeout(d,e?e:1)),!0):!1};ixMap.Sleep.prototype.checkSleepMS=function(d,e){return this.checkSleepMaxCount&&
__timer_getMS()>this.checkSleepMaxCount?(__timer_reset(),setTimeout(this.szFunction+"('"+String(d)+"')",e?e:1),!0):!1};ixMap.Tiles=function(){var d=map.SVGDocument.getElementsByTagNameNS(szMapNs,"tiles");d.length&&(this.tilesNode=map.SVGDocument.getElementsByTagNameNS(szMapNs,"maptiles"),this.dataNode=d.item(0),this.nCount=this.dataNode.getAttributeNS(null,"count"),this.tileWidth=this.dataNode.getAttributeNS(null,"width"),this.tileHeight=this.dataNode.getAttributeNS(null,"height"),this.tilesRoot=
this.dataNode.getAttributeNS(null,"root").split(".")[0],this.tilesSuffix=this.dataNode.getAttributeNS(null,"root").split(".")[1],this.depUpper=this.dataNode.getAttributeNS(null,"upper"),this.depLower=this.dataNode.getAttributeNS(null,"lower"),map.fMarkTiles&&this.markTiles(),this.xLoader=null,this.fDiscardPending=!1)};ixMap.Tiles.prototype=new Map;ixMap.Tiles.prototype.getTileNodes=function(d){var e=[];d=this.getTileNodeIds(d);for(var g=0;g<d.length;g++){var l=map.SVGDocument.getElementById(d[g]);
l&&(e[e.length]=l)}return e};ixMap.Tiles.prototype.getTileNodeIds=function(d){var e=d.split(":");d=e[0];for(var g="",l=1;l<e.length;l++)g+=":"+e[l];e=[];for(l=0;l<this.nCount;l++)for(var u=0;u<this.nCount;u++)e[e.length]=d+"#"+this.buildTileExtension(u,l)+g;return e};ixMap.Tiles.prototype.getTilePositions=function(){for(var d=map.Scale.origMinX,e=map.Scale.origMinY,g=[],l=0;l<this.nCount;l++)for(var u=0;u<this.nCount;u++)if(u<this.nCount&&l<this.nCount){var k=new box(d+u*this.tileWidth,e+l*this.tileHeight,
this.tileWidth,this.tileHeight);g[g.length]=k}return g};ixMap.Tiles.prototype.getTileBox=function(d){var e=d.split("#")[1];if(e==null||e.length<=0)return null;d=Number(e.substr(0,3));e=Number(e.substr(3,3));return new box(e*this.tileWidth-map.Scale.mapOffset.x,d*this.tileHeight-map.Scale.mapOffset.x,this.tileWidth,this.tileHeight)};ixMap.Tiles.prototype.getTileInfo=function(){for(var d=map.Scale.origMinX,e=map.Scale.origMinY,g=[],l=1,u=Math.floor(this.nCount/2);u<=this.nCount&&u>=0;){for(var k=1,
v=Math.floor(this.nCount/2);v<=this.nCount&&v>=0;){if(v<this.nCount&&u<this.nCount){var x=this.tilesRoot+"_"+this.buildTileExtension(v,u)+"."+this.tilesSuffix,H="tile"+this.buildTileExtension(v,u),G=map.SVGDocument.getElementById(H),P=new box(d+v*this.tileWidth,e+u*this.tileHeight,this.tileWidth,this.tileHeight);g[g.length]={szUrl:x,szGroup:H,tileGroup:G,x:v,y:u,bBox:P};x=this.tilesRoot+"_"+this.buildTileExtension(v,u)+"_ncl."+this.tilesSuffix;H="tile"+this.buildTileExtension(v,u)+":noclip";(G=map.SVGDocument.getElementById(H))&&
(g[g.length]={szUrl:x,szGroup:H,tileGroup:G,x:v,y:u,bBox:P})}v+=k;k=Math.abs(k)+1;(k&1)===0&&(k=-k)}u+=l;l=Math.abs(l)+1;(l&1)===0&&(l=-l)}d=g.length;l=e=0;for(var M in g)g[M].tileGroup&&(g[M].tileGroup.hasChildNodes()&&e++,g[M].tileGroup.style.getPropertyValue("display")=="inline"&&l++);_STATUS("Tiling: "+d+"/"+e+"/"+l);return g};ixMap.Tiles.prototype.getMasterId=function(d){if(d==null)return null;d=d.split(":");for(var e=d[0].split("#")[0],g=1;g<d.length;g++)e+=":"+d[g];d.length=0;return e};ixMap.Tiles.prototype.getTileId=
function(d){if(d==null)return null;d=d.split(":");var e=d[0];d.length=0;return e};ixMap.Tiles.prototype.buildTileExtension=function(d,e){return __maptheme_formatpart(e,"0")+__maptheme_formatpart(d,"0")};ixMap.Tiles.prototype.setShapeStyle=function(d,e){if(d&&this.nCount&&(d=new MapObject(d),d!=null)){d=this.getMasterId(d.szId);var g=d.split(":")[0];d=d.substr(g.length,d.length-g.length);g=this.getTileNodeIds(g);for(var l=0;l<g.length;l++){var u=map.SVGDocument.getElementById(g[l]+d);u&&u.setAttributeNS(null,
"style",e)}}};ixMap.Tiles.prototype.markTiles=function(){var d=map.SVGDocument.getElementById("maptilesbg");if(d)for(var e=0;e<this.nCount;e++)for(var g=0;g<this.nCount;g++)map.Dom.newShape("rect",d,-this.tileWidth*this.nCount/2+g*this.tileWidth,-this.tileHeight*this.nCount/2+e*this.tileHeight,this.tileWidth,this.tileHeight,"fill:none;stroke:gray;stroke-width:0.01")};ixMap.Tiles.prototype.switchScaleDependentTiles=function(d){if(map.fDynamicTiles&&!this.clearTiles(d)){var e=!1;if(this.nCount>0){getMatrix(map.Zoom.canvasNode);
var g=map.Scale.origMinX,l=map.Scale.origMinY,u=map.Zoom.getBox(),k=this.getTileInfo();if(k)for(var v=0;v<k.length;v++){var x=k[v].szUrl,H=k[v].szGroup,G=k[v].x,P=k[v].y,M=k[v].bBox,T=k[v].tileGroup;T&&((G=new box(g+G*this.tileWidth,l+P*this.tileHeight,this.tileWidth,this.tileHeight),G.x==M.x&&G.y==M.y&&G.width==M.width&&G.height==M.height||alert("switchScaleDependentTiles box error !!"),G.x+G.width<u.x||G.y+G.height<u.y||G.x>u.x+u.width||G.y>u.y+u.height)?T.hasChildNodes()&&(T.getAttributeNS(szMapNs,
"type")=="external"?(T.style.setProperty("display","none",""),map.fDiscardTiles&&map.fDiscardTiles!="delayed"&&(map.Themes.removeFromThemeNodesCache(T),map.Dom.clearGroup(T))):T.style.setProperty("display","none","")):T.hasChildNodes()||T.getAttributeNS(szMapNs,"type")!="external"?T.style.getPropertyValue("display")!="inline"&&(T.style.setProperty("display","inline",""),e=!0,map.fAdaptLabelToScaling&&map.Layer.adaptLabelToScaling(d,T)):(T.style.setProperty("display","inline",""),setTimeout("map.Tiles.loadScaleDependentTiles('"+
H+"','"+x+"')",10)))}}map.fDiscardTiles=="delayed"&&this.discardTiles();e&&(map.Layer.adaptLabel(d,map.Layer.layerNode),map.Layer.doStoredFeatureScaling())}};ixMap.Tiles.prototype.loadScaleDependentTiles=function(d,e){_STATUS("Loading Tile:"+e+","+d);d=map.SVGDocument.getElementById(d);this.xLoader||(this.xLoader=new SVGLoaderTiles);this.xLoader.importSVGFile(e,map.SVGDocument,d,null)&&(map.fTilesLoaded=!0)};ixMap.Tiles.prototype.isLoading=function(){return this.xLoader?this.xLoader.isLoading():!1};
ixMap.Tiles.prototype.clearTiles=function(d){if(!map.fDynamicTiles)return!1;try{for(var e in map.Layer.listA){var g=map.Layer.listA[e];if(g.szFlag.match(/tiled/)&&map.Themes.isThemeLayerUsed(g.szName)&&map.Layer.isScaleDependentLayerOn(g.szName))return!1}}catch(u){}if(this.nCount>0){d=1E11;e=0;g=this.depUpper;var l=this.depLower;g&&g.length&&(d=Number(g.split(":")[1]));l&&l.length&&(e=Number(l.split(":")[1]));if(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=e&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=
d)return!1;if(d=this.getTileInfo())for(e=0;e<d.length;e++)(g=d[e].tileGroup)&&g.hasChildNodes()&&(g.style.setProperty("display","none",""),map.fDiscardTiles&&map.fDiscardTiles!="delayed"&&(map.Themes.removeFromThemeNodesCache(g),map.Dom.clearGroup(g)))}map.fDiscardTiles=="delayed"&&this.discardTiles();return!0};ixMap.Tiles.prototype.discardTiles=function(d){map.fTilesLoaded&&map.fDiscardTiles&&!this.fDiscardPending&&(setTimeout("map.Tiles.doDiscardTiles()",5E3),this.fDiscardPending=!0)};ixMap.Tiles.prototype.doDiscardTiles=
function(d){if(map.fDynamicTiles&&map.fTilesLoaded)if(map.mouseObject)setTimeout("map.Tiles.doDiscardTiles()",6E3);else{if(map.Tiles&&map.Tiles.nCount>0&&(d=map.Tiles.getTileInfo()))for(var e=0;e<d.length;e++){var g=d[e].tileGroup;if(g&&g.style.getPropertyValue("display")=="none"&&g.hasChildNodes()){map.Themes.removeFromThemeNodesCache(g);map.Dom.clearGroup(g);setTimeout("map.Tiles.doDiscardTiles()",2E3);return}}this.fDiscardPending=!1}else this.fDiscardPending=!1};ixMap.Tiles.prototype.isAnyTiledLayerVisible=
function(){for(var d in map.Layer.listA){var e=map.Layer.listA[d];if(e.szFlag.match(/tiled/)&&(e.nState===!0||e.szDisplay!="none"||e.szDisplayLabel!="none"))return!0}return!1};ixMap.Tiles.prototype.allTilesLoaded=function(){var d=this.getTileInfo();if(d){var e=d.length,g=0,l;for(l in d)d[l].tileGroup&&d[l].tileGroup.hasChildNodes()&&g++;return e==g}return!1};ixMap.Tiles.prototype.isAnyLayerTileLoaded=function(d){if(d=this.getTileInfo())for(var e in d)if(d[e].tileGroup&&d[e].tileGroup.hasChildNodes())return!0;
return!1};ixMap.Event=function(){this.fPanDone=!1;this.onoverShape=null;this.fMouseDown=!1;this.contextMenuObj=null;this.onoverPopup=!1;this.tooltipDone=this.popupContextObj=null};ixMap.Event.prototype=new Map;ixMap.Event.prototype.initUseNodes=function(d){if(d&&(d=d.getElementsByTagName("use"))&&d.length)for(var e=0;e<d.length;e++)d.item(e).style.setProperty("pointer-events","none","")};ixMap.Event.prototype.resolveInstance=function(d){if(!d)return null;if(typeof d.nodeType!="undefined")return d;
for(;d.parentNode&&d.correspondingUseElement=="undefined";)d=d.parentNode;return d.correspondingUseElement};ixMap.Event.prototype.stopMouseEvent=function(d){d&&(d.stopPropagation(),d.preventDefault())};ixMap.Event.prototype.defaultMouseOver=function(d){if(d&&d.target){var e=this.resolveInstance(d.target);if(e.nodeType==1){var g=new MapObject(e);if(g&&g.szId&&g.szId.match(/widget/))za.onMouseOver(d);if(!this.fMouseDown||!this.fMouseDownMoved){if(map.szMapToolType=="idle")try{if(!g){map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();
return}var l=g.szId;if(!(l.match(/legend/)||l.match(/tool/)||l.match(/button/)||l.match(/widget/)||l.match(/movable/)||l.match(/checked/)||l.match(/unchecked/))){map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle();return}}catch(v){}map.SVGPopupGroup.fu.isContained(e)||map.SVGFixedGroup.fu.isContained(e)?(this.popupContextObj&&Y(d,this.popupContextObj),this.onoverPopup=!0):this.onoverPopup=!1;if(map.szMapToolType!==""||this.onoverPopup){if(map.szMapToolType=="clickinfo")try{if(g.szId.match(/text/i)&&
(g=new MapObject(e.parentNode)),g.szId.match(/:chart:box/i)&&(l=g.szId.split(":chart:box")[0]+":chartgroup",g=new MapObject(g.objNode.ownerDocument.getElementById(l))),map.szMapToolType="",map.HTMLWindow.ixmaps.htmlgui_onItemClick(d,g.szId))return l=g,l.objNode||(l=new MapObject(l)),l.objNode&&map.highLightList&&!map.highLightList.checkItem(l.objNode)&&(map.highLightList.unlock(),map.highLightList.removeAll(),map.highLightList.addItem(l.objNode,"circle"),map.highLightList.lock()),map.SVGPopupGroup.fu.clear(),
killTooltip(),map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle(),null}catch(v){}if(this.onoverPopup||!Y(d,e)||map.szMapToolType!=="info"&&map.szMapToolType!=="clickinfo"&&map.szMapToolType!==""){if(e)try{var u=e.getAttributeNS(szMapNs,"origstyle");if(!u||u=="null"){var k=e.getAttributeNS(szMapNs,"onoverstyle");k&&(e.setAttributeNS(szMapNs,"origstyle",e.getAttributeNS(null,"style")),e.setAttributeNS(null,"style",k))}}catch(v){}try{if(map.HTMLWindow.ixmaps.htmlgui_onItemOver(d,g.szId))return null}catch(v){}this.tooltipDone=
displayTooltip(d,e);this.onoverShape=e}else{try{if(map.HTMLWindow.ixmaps.htmlgui_onItemOver(d,g.szId,e))return map.SVGPopupGroup.fu.clear(),map.highLightList.unlock(),map.highLightList.removeAll(),map.highLightList.addItem(g.objNode,"scale"),map.highLightList.lock(),map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle(),null}catch(v){}A(d,e,"delayed|pointer");this.onoverShape=e;try{highlightTheme(new MapObject(e))}catch(v){}}try{e.getAttributeNS(null,"id")=="mapbackground:eventrect"&&map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(v){}}}}}};
var Y=function(d,e){var g=new MapObject(e);if(g==null)return!1;d=!0;var l=null;g=g.szId;if(g.length===0||g.match(/legend/)||g.match(/background/)||g.match(/button/)||g.match(/widget/)||g.match(/textgrid/)||map.szMapToolType!="clickinfo"&&map.szMapToolType!="info"&&map.szMapToolType!=="")return map.highLightList&&map.highLightList.removeAll(),!1;if(map.highLightList&&!map.highLightList.checkItem(e)){g=e;g.nodeName!="g"&&(g=g.parentNode);if((g=g.getAttributeNS(null,"id"))&&!g.match(/chartgroup/)&&map._activeTheme!=
map.Tiles.getMasterId(g.split(":")[0]))if(map.fHighlightHint)l="hint",d=!1;else return!1;map.highLightList.removeAll();e=map.Layer.getLayerItemNodes(e);for(g=0;g<e.length;g++)map.highLightList.addItem(e[g],l)}return d};ixMap.Event.prototype.defaultMouseOut=function(d){if(d&&d.target){var e=this.resolveInstance(d.target),g=new MapObject(e);if(g&&g.szId&&g.szId.match(/widget/))za.onMouseOut(d);if(e)try{var l=e.getAttributeNS(szMapNs,"origstyle");l&&l.length>2&&(e.removeAttributeNS(szMapNs,"origstyle"),
e.setAttributeNS(null,"style",l))}catch(u){}this.onoverShape&&setTimeout("_removeInfo()",1E3);this.onoverShape&&!map._activeItem&&(map.highLightList.removeItem(this.onoverShape),this.onoverShape=null,highlightThemeRemove());killTooltip();B()}};ixMap.Event.prototype.defaultMouseClick=function(d){if(d&&d.target){var e=this.resolveInstance(d.target);if(e&&e.nodeType==1&&(new MapObject(e),e==this.ondownShape))if(this.fMouseDownMoved>5)this.fMouseDownMoved=0;else{var g=e.parentNode;if(g.nodeName=="a"){g=
g.getAttributeNS(szXlink,"href");try{map.HTMLWindow.ixmaps.htmlgui_popupWindow(g),this.stopMouseEvent(d)}catch(u){}}var l=new MapObject(e);if(l!=null){g=l.objNode;l=l.szId;try{if(map.User.onClick(d,l))return null}catch(u){}try{if(map.HTMLWindow.ixmaps.htmlgui_onItemClick(d,l))return null}catch(u){}if(l){if(za.onClick(d))return;try{l=="mapbackground:eventrect"&&map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()}catch(u){}}map.Legend&&map.Legend.legendMouseClick(d,g)?this.stopMouseEvent(d):!g||g.nodeType!=
1||!g.parentNode||g.parentNode.nodeType!=1||map.Legend&&map.Legend.legendMouseClick(d,g.parentNode)||!(l=g.parentNode.getAttributeNS(null,"id"))||l=="PopupGroup"||l.match(/widget/)||!map.fActivateInfoOnClick&&map.szMapToolType!="info"&&map.szMapToolType!="clickinfo"&&map.szMapToolType!==""&&map.szMapToolType!="zoomrect"||(isActiveTheme(map.Layer.getLayerName(l))?(map.SVGPopupGroup.fu.clear(),A(d,e,"add|fix|pointer")):(activateTheme(l.split(":")[0]),map.szMapToolType.match(/select/),map.Zoom.cancel(),
this.defaultMouseOver(d),killTooltip()))}}}};ixMap.Event.prototype.defaultMouseDown=function(d){if(d&&d.target&&!map.fInitializing){var e=this.resolveInstance(d.target);if(d.button==2)this.contextMenuObj=e,this.contextMenuCurrentObj=d.currentTarget,__setContextMenu(d);else if(!d.button||d.button===0){this.fMouseDown=!0;this.ondownShape=e;this.fMouseDownMoved=0;var g=new MapObject(e);if(g!=null){e=g.objNode;g=String(g.szId);try{if(map.User.onMouseDown(d,g))return null}catch(l){}this.stopMouseEvent(d);
za.onMouseDown(d);if(g.match(/movabley/))map.mouseObject=new ya(d,e,"yonly");else if(g.match(/movablex/))map.mouseObject=new ya(d,e,"xonly");else if(g.match(/movable/))map.mouseObject=new ya(d,e);else if(g.match(/maptoolnode/))c.onMouseDown(d);else if(g.match(/widget/))za.onMouseDown(d);else g.match(/legend/)?(d=g.split(":"),d.length>2&&e.ownerDocument.getElementById(d[2])&&(d[1]=="minus"&&setTimeout("__opacityMinus('"+d[2]+"')",200),d[1]=="plus"&&setTimeout("__opacityPlus('"+d[2]+"')",200))):(d.shiftKey||
d.altKey||d.crtlKey||!map.Layer.isMapObject(e)||map.szMapToolType&&map.szMapToolType!==""&&new b(d,map.szMapToolType),d.shiftKey&&!d.altKey&&!d.crtlKey&&map.Layer.isMapObject(e)&&(map.szMapToolType===""?new b(d,"pan"):new b(d,map.szMapToolType)),!map.fTriggerMouseMoveForPan||g.match(/legend/)||g.match(/tool/)||g.match(/button/)||g.match(/widget/)||g.match(/movable/)||g.match(/checked/)||g.match(/unchecked/)||map.szMapToolType!="info"&&map.szMapToolType!==""||(this.triggerMoveForPan=!0))}}}};ixMap.Event.prototype.defaultMouseUp=
function(d){if(d&&d.target&&!map.fInitializing){this.stopMouseEvent(d);try{if(map.User.onMouseUp(d))return null}catch(e){}this.fMouseDown=!1;if(map.mouseObject){try{map.mouseObject.onMouseUp(d)}catch(e){}map.mouseObject=null}za.onMouseUp(d);this.triggerMoveForPan=!1}};ixMap.Event.prototype.defaultMouseMove=function(d){if(d&&d.target&&!map.fInitializing){var e=this.resolveInstance(d.target);this.triggerMoveForPan&&this.fMouseDownMoved&&(new b(d,"pan"),this.triggerMoveForPan=!1);if(!map.mouseObject)try{var g=
(new MapObject(e)).objNode.getAttributeNS(null,"id");if(!(g.match(/legend/)||g.match(/tool/)||g.match(/button/)||g.match(/widget/)||g.match(/movable/)||g.match(/checked/)||g.match(/unchecked/)||map.szMapToolType!="idle"&&g!="mapbackground:eventrect")){setTimeout("map.HTMLWindow.ixmaps.htmlgui_onSVGPointerIdle()",1E3);return}}catch(l){}this.stopMouseEvent(d);if(map.mouseObject)try{map.mouseObject.onMouseMove(d)}catch(l){}this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null));this.fMouseDownMoved+=
this.fMouseDown?1:0;za.onMouseMove(d)}};var W=!1,S=null;ixMap.Event.prototype.defaultKeyDown=function(d){!d||W||!d.shiftKey||d.altKey||d.crtlKey||(S=map.szMapToolType,map.szMapToolType=="pan"?f("zoomrect"):map.szMapToolType=="zoomrect"?f("pan"):map.szMapToolType=="info"&&f("pan"),W=!0)};ixMap.Event.prototype.defaultKeyUp=function(d){!d||!W||d.shiftKey||d.altKey||d.crtlKey||(f(S),W=!1)};ixMap.Event.prototype._checkSignificantViewChange=function(){var d={changed:!1,zoomChanged:!1,panChanged:!1};d.zoomChanged=
map.Scale.oldZoomScale!=map.Scale.nZoomScale;if(d.zoomChanged)return d.changed=!0,d;if(!(map.Scale.szMapProjection||"").match(/albers|lambert|orthographic/i))return d;try{if(!map.Scale.oldMapCenter||!map.Scale.mapCenter)return d;var e=map.Scale.getGeoCoordinateOfPoint(map.Scale.oldMapCenter.x,map.Scale.oldMapCenter.y),g=map.Scale.getGeoCoordinateOfPoint(map.Scale.mapCenter.x,map.Scale.mapCenter.y);if(e&&g){var l=Math.abs(e.y-g.y),u=Math.abs(e.x-g.x);u>180&&(u=360-u);if(l>.5||u>.5)d.panChanged=!0,
d.changed=!0}}catch(k){map.Scale.oldMapCenter&&map.Scale.mapCenter&&(Math.abs(map.Scale.oldMapCenter.x-map.Scale.mapCenter.x)>50||Math.abs(map.Scale.oldMapCenter.y-map.Scale.mapCenter.y)>50)&&(d.panChanged=!0,d.changed=!0)}return d};ixMap.Event.prototype.doDefaultZoom=function(d){if(!map.fFroozeDynamicContent){map.SVGNotifyGroup.fu.clear();try{map.Themes.getTheme().unlabelMap()}catch(v){}map.showMap();var e=map.SVGRootElement.getAttribute("viewBox").split(" "),g=map.SVGOrigViewBoxString.split(" ");
g=1/(Number(g[2])/Number(e[2]));if(e=map.Scale.zoomNode){var l=getMatrix(e);g/=l[0]}map.Scale.oldZoomScale=map.Scale.nZoomScale;map.Scale.oldMapCenter=map.Scale.mapCenter;if(map.Scale.nZoomScale!=g){map.Dom.clearGroup(map.SVGToolsGroup);map.Dom.clearGroup(map.SVGFixedGroup);map.removeAllHighlights();map.Api.clearHighlight();map.Api.clearAllOverlays();try{map.HTMLWindow.ixmaps.htmlgui_onItemClick(d,"mapbackground:eventrect")}catch(v){}}map.Scale.nZoomScale=g;map.Scale.mapCenter=new point(l[4],l[5]);
if(map.fPanByViewer===!1){if(map.SVGRootElement.currentTranslate.x!==0||map.SVGRootElement.currentTranslate.y!==0){e=map.Scale.zoomNode;l=getMatrix(e);g=l[0];var u=l[3],k=map.Scale.rotatePoint(map.SVGRootElement.currentTranslate);map.SVGRootElement.currentTranslate.x=k.x;map.SVGRootElement.currentTranslate.y=k.y;k=l[4]+map.Scale.scaleX(map.SVGRootElement.currentTranslate.x);l=l[5]+map.Scale.scaleY(map.SVGRootElement.currentTranslate.y);e.setAttributeNS(null,"transform","matrix("+g+" 0 0 "+u+" "+k+
" "+l+")");map.Scale.mapCenter=new point(k,l);map.SVGRootElement.currentTranslate.x=0;map.SVGRootElement.currentTranslate.y=0}}else{if(l=map.SVGDocument.getElementById("mapcliprect"))l.setAttributeNS(null,"x",map.Scale.scaleX(-map.SVGRootElement.currentTranslate.x)),l.setAttributeNS(null,"y",map.Scale.scaleY(-map.SVGRootElement.currentTranslate.y)),l.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),l.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()));
if(l=map.SVGDocument.getElementById("mapbackground:eventrect"))l.setAttributeNS(null,"x",map.Scale.scaleX(-map.SVGRootElement.currentTranslate.x)),l.setAttributeNS(null,"y",map.Scale.scaleY(-map.SVGRootElement.currentTranslate.y)),l.setAttributeNS(null,"width",map.Scale.scaleX(map.Scale.getEmbedWidth())),l.setAttributeNS(null,"height",map.Scale.scaleX(map.Scale.getEmbedHeight()))}d&&map.antiZoomAndPanList.adjustGroups(d);Math.abs(map.Scale.oldZoomScale-map.Scale.nZoomScale)>map.Scale.oldZoomScale/
100?(map.fFeatureScaling=="delayed"?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(d,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&map.fDynamicLayer=="delayed"?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(d),D(d)):map.fDynamicTiles=="delayed"?setTimeout("map.Layer.doStoredFeatureScaling()",500):map.Layer.doStoredFeatureScaling(d);map.fDynamicTiles=="delayed"?setTimeout("map.Tiles.switchScaleDependentTiles(null)",
500):map.Tiles.switchScaleDependentTiles(d);if(this.fFrozenDynamicContent||map.Scale.oldZoomScale!=map.Scale.nZoomScale||Math.abs(map.Scale.oldMapCenter.x-map.Scale.mapCenter.x)>10||Math.abs(map.Scale.oldMapCenter.y-map.Scale.mapCenter.y)>10){try{map.HTMLWindow.ixmaps.htmlgui_onZoomAndPan(map.Scale.nZoomScale)}catch(v){}map.fDynamicTiles=="delayed"||map.fDynamicLayer=="delayed"?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",10);if(this.fFreezeDynamicContent)this.fFrozenDynamicContent=
!0;else try{this.fFrozenDynamicContent?(map.Themes.actualizeActiveTheme(.99),this.fFrozenDynamicContent=!1):map.Scale.oldZoomScale!=map.Scale.nZoomScale?map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/map.Scale.nZoomScale):setTimeout("map.Themes.actualizeActiveTheme("+map.Scale.oldZoomScale/map.Scale.nZoomScale+")",10)}catch(v){}try{map.HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK"))}catch(v){}}map.zoomAndPanHistory.newItem();
map.Scale.refreshCSSStyles()}};ixMap.Event.prototype.doPrintZoom=function(d){map.Scale.nZoomScale/=5;map.Scale.oldZoomScale!=map.Scale.nZoomScale?(map.fFeatureScaling=="delayed"?setTimeout("map.Layer.changeFeatureScaling(null,'"+map.Scale.nZoomScale+"')",1E3):map.Layer.changeFeatureScaling(d,map.Scale.nZoomScale),map.Scale.oldZoomScale>map.Scale.nZoomScale&&map.fDynamicLayer=="delayed"?setTimeout("map.Layer.switchScaleDependentLayer(null)",500):map.Layer.switchScaleDependentLayer(d),D(d)):map.fDynamicTiles==
"delayed"?setTimeout("map.Layer.doStoredFeatureScaling()",500):map.Layer.doStoredFeatureScaling(d);map.fDynamicTiles=="delayed"?setTimeout("map.Tiles.switchScaleDependentTiles(null)",500):map.Tiles.switchScaleDependentTiles(d);if(map.Scale.oldZoomScale!=map.Scale.nZoomScale||map.Scale.oldMapCenter.x!=map.Scale.mapCenter.x||map.Scale.oldMapCenter.y!=map.Scale.mapCenter.y){map.fDynamicTiles=="delayed"||map.fDynamicLayer=="delayed"?setTimeout("map.Layer.adaptLabel()",500):setTimeout("map.Layer.adaptLabel()",
10);try{map.Themes.actualizeActiveTheme(map.Scale.oldZoomScale/map.Scale.nZoomScale)}catch(e){}}try{map.HTMLWindow.ixmaps.htmlgui_setScaleSelect(String(__formatValue(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale)),0,"BLANK")),map.HTMLWindow.ixmaps.htmlgui_setCurrentEnvelope(map.Zoom.getEnvelopeString(),map.Scale.oldZoomScale!=map.Scale.nZoomScale)}catch(e){}map.Scale.refreshCSSStyles()};ixMap.Event.prototype.doDefaultResize=function(d){map&&map.Layer&&(map.Layer.switchScaleDependentLayer(d),
D(d))};ixMap.Event.prototype.doDefaultPan=function(d){d&&!map.mouseObject&&(map.antiZoomAndPanList.adjustGroups(d),map.Event.fPanDone=!0)};ixMap.Event.prototype.doDefaultAdjustPan=function(d){this.fPanDone&&(this.fPanDone=!1,this.doDefaultZoom(null))};ixMap.Event.prototype.moveToFrontOfGroup=function(d){d&&d.currentTarget&&d.currentTarget.parentNode&&d.currentTarget!=d.currentTarget.parentNode.lastChild&&d.currentTarget.parentNode.appendChild(d.currentTarget)};Ha.prototype.add=function(d){this.historyPointer=
this.itemA.length;this.itemA[this.itemA.length]=d};Ha.prototype.newItem=function(){this.fSuspend?this.fSuspend=!1:this.add(new q)};Ha.prototype.backwards=function(){this.historyPointer>0&&(this.fSuspend=!0,this.itemA.length=this.historyPointer,this.historyPointer--,this.itemA[this.historyPointer].exec())};Ha.prototype.forwards=function(){this.historyPointer<this.itemA.length-1&&(this.fSuspend=!0,this.historyPointer++,this.itemA[this.historyPointer].exec())};Ha.prototype.clear=function(){this.itemA.length=
0};q.prototype.exec=function(){try{var d=this.szEnvelope.split("="),e=d[1].split("'")[1],g=d[2].split("'")[1],l=d[3].split("'")[1],u=d[4].split("'")[1];map.Zoom.doZoomMapToEnvelope(e,g,l,u)}catch(k){alert("History Item not valid")}};var ma=function(d,e,g,l,u,k,v){e&&g&&g.length>2&&(this.szId=g+":movable",this.objectNode=map.Dom.newGroup(e,this.szId),this.ptPosition=l,this.ptOffsetOrig=new point(u.x,u.y),this.ptOffset=u,this.szMode=k,this.szTitle=v,this.nFontheight=14,this.onRemove="",this.fClipped=
!0,this.create())};ma.prototype.create=function(){this.ptPosition||(this.ptPosition=new point(1E3,1E3));this.ptOffset||(this.ptOffset=new point(100,100));this.szMode||(this.szMode="");this.szMode.match(/left/)&&(this.ptOffset.x=-(this.ptOffset.x*2),this.ptOffset.y*=3);this.frameNode=map.Dom.newShape("rect",this.objectNode,0,0,map.Scale.normalX(10),map.Scale.normalY(10),"fill:#ffffff;stroke:black;stroke-width:"+map.Scale.normalX(0));this.frameNode.setAttributeNS(null,"rx",map.Scale.normalX(map.nInfoRoundRect*
2));this.frameNode.setAttributeNS(null,"ry",map.Scale.normalX(map.nInfoRoundRect*2));map.SVGDocument.getElementById(map.szShadowFilterToolsId)&&this.frameNode.style.setProperty("filter","url(#"+map.szShadowFilterToolsId+")","");this.canvasNode=map.Dom.newGroup(this.objectNode,this.szId+":canvas");this.canvasNode.fu.setPosition(map.Scale.normalX(1),map.Scale.normalY(1));this.titleNode=map.Dom.newGroup(this.objectNode,this.szId+":title");this.titleTextNode=map.Dom.newGroup(this.titleNode,this.szId+
":titletext");this.szTitle&&map.Dom.newText(this.titleTextNode,map.Scale.normalX(10),map.Scale.normalY(this.nFontheight+10),"font-family:arial;font-size:"+map.Scale.normalY(this.nFontheight/4*3)+"px;fill:black;pointer-events:none",this.szTitle);this.scrollObj=new p(null,this.canvasNode,null,10,10,10),this.scrollObj.reformat(),this.workspaceNode=this.scrollObj.workspaceNode;this.workspaceNode||(this.scrollObj=null,this.workspaceNode=map.Dom.newGroup(this.canvasNode,this.szId+":workspace"),this.workspaceClipRect=
map.Dom.setClipRect(this.workspaceNode,new box(0,0,10,10)));this.objectNode.setAttributeNS(null,"onclick","map.Event.moveToFrontOfGroup(evt)");this.objectNode.setAttributeNS(null,"ontouchend","map.Event.moveToFrontOfGroup(evt)");this.szMode.match(/fix/)?(this.deleteButton=new Ua(this.titleNode,this.szId,"BUTTON","#delete_button","map.Dom.removeElementById('"+this.szId+"');","remove"),this.deleteButton.scale(1,1),this.deleteButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10))):this.szMode.match(/pin/)&&
map.SVGDocument.getElementById("pin_button")&&(this.pinButton=new Ua(this.titleNode,this.szId,"BUTTON","#pin_button","doDisplayInfo("+this.ptPosition.x+","+this.ptPosition.y+",'pointer|fix');","","fix it"),this.pinButton.scale(1,1),this.pinButton.setPosition(map.Scale.normalX(10),map.Scale.normalY(10)));this.widgetObj=new wa(this.objectNode,this)};ma.prototype.setTitle=function(d,e){e||(e=map.Scale.tStyle.ContainerTitle);map.Dom.clearGroup(this.titleTextNode);(this.szTitle=d)&&map.Dom.newText(this.titleTextNode,
map.Scale.normalX(10),e.nFontHeight*1.3,e.szStyle,this.szTitle);this.reformat()};ma.prototype.reformat=function(){this.bBox=map.Dom.getBox(this.workspaceNode);this.tBox=map.Dom.getBox(this.titleTextNode);this.bBox.height<0&&(this.bBox.height=0);this.bBox.width<0&&(this.bBox.width=0);this.tBox.height<0&&(this.tBox.height=0);if(this.bBox.width!==0&&this.bBox.height!==0||this.szTitle&&this.szTitle.length){this.bBox.height==1&&(this.bBox.height=-200);var d=map.Scale.normalX(15+map.Scale.nButtonSize);
if(this.fClipped){d=Math.min(Math.max(this.bBox.width+d,this.tBox.width+d),map.Scale.bBox.width/2);var e=Math.min(this.bBox.height+this.tBox.height,map.Scale.bBox.height/2.4)}else d=Math.max(this.bBox.width+d,this.tBox.width+d),e=this.bBox.y+this.bBox.height+this.tBox.height+map.Scale.normalY(10);e>map.Scale.bBox.height/4*5&&(d=Math.min(this.bBox.width+map.Scale.normalX(10)+map.Scale.normalY(10),map.Scale.bBox.width/2.4));d>map.Scale.bBox.width/4*5&&(e=Math.min(this.bBox.height+this.tBox.height+map.Scale.normalY(10),
map.Scale.bBox.height/2.4));this.scrollObj?(this.scrollObj.setWidth(d/map.Scale.normalX(1)-1),this.scrollObj.setHeight(e/map.Scale.normalY(1)),this.scrollObj.reformat(),this.scrollObj.hasScrollBars()?(e<this.bBox.height+map.Scale.normalX(this.scrollObj.nScrollBarWidth)&&(this.scrollObj.setHeight(e/map.Scale.normalY(1)+this.scrollObj.nScrollBarWidth+6),this.scrollObj.reformat(),e+=map.Scale.normalY(this.scrollObj.nScrollBarWidth+1)),this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(8)+
this.tBox.height),d+=map.Scale.normalX(10)+map.Scale.normalX(7),e+=map.Scale.normalY(2)+map.Scale.normalY(10)+map.Scale.normalY(5)+this.tBox.height*2):(this.canvasNode.fu.setPosition(map.Scale.normalX(5),map.Scale.normalY(10)+this.tBox.height*1.3),e+=map.Scale.normalY(10)+this.tBox.height-map.Scale.normalY(7))):(this.workspaceClipRect.setAttributeNS(null,"width",d),this.workspaceClipRect.setAttributeNS(null,"height",e));var g=map.Scale.tStyle.ContainerTitle;g=map.Scale.normalY(map.Scale.nButtonSize/
3)+g.nFontHeight/2;var l=map.Scale.normalY(map.Scale.nButtonSize/3);this.pinButton?this.pinButton.setPosition(d-l,g):this.deleteButton?this.deleteButton.setPosition(d-l,g):d-=map.Scale.normalX(map.Scale.nButtonSize);this.bBox.width=d;this.bBox.height=e;this.frameNode&&(this.frameNode.setAttributeNS(null,"width",this.bBox.width+map.Scale.normalX(5)*2),this.frameNode.setAttributeNS(null,"height",this.bBox.height+map.Scale.normalX(5)));this.shadowNode&&(this.shadowNode.setAttributeNS(null,"width",this.bBox.width+
map.Scale.normalX(5)*2+map.Scale.normalX(.5)),this.shadowNode.setAttributeNS(null,"height",this.bBox.height+map.Scale.normalX(5)+map.Scale.normalY(1)));d=map.Scale.getGroupOffset(this.objectNode);this.newPosition=map.Scale.clipWidgetObjectToSVG(this.objectNode,new point(this.ptPosition.x+d.x,this.ptPosition.y+d.y),this.ptOffsetOrig,this.bBox);this.newPosition.x-=d.x;this.newPosition.y-=d.y;this.objectNode.fu.setPosition(this.newPosition.x,this.newPosition.y);this.ptOffset.x=this.newPosition.x-this.ptPosition.x;
this.ptOffset.y=this.newPosition.y-this.ptPosition.y;this.szMode.match(/pointer/)&&this.makePointer()}else this.remove()};ma.prototype.makePointer=function(){map.Scale.normalX(15);var d=map.Scale.normalX(10);map.Scale.normalX(5);this.pointerObj?(map.Dom.clearGroup(this.pointerObj),map.Dom.clearGroup(this.pointShObj)):(this.pointerObj=map.Dom.newGroup(this.objectNode),this.pointShObj=map.Dom.newGroup(this.objectNode),this.pointShObj.parentNode.insertBefore(this.pointShObj,this.pointShObj.parentNode.firstChild));
if(!(this.ptOffset.y<0&&this.ptOffset.y>-this.bBox.height&&this.ptOffset.x<0&&this.ptOffset.x>-this.bBox.width)){var e=this.ptOffset.y+this.bBox.height/2;var g=this.ptOffset.x+this.bBox.width/2;Math.abs(e)+this.bBox.width/2-this.bBox.height/2>Math.abs(g)?(g=0,this.ptOffset.x>-d*2&&(g=this.ptOffset.x+d*2),this.ptOffset.x<-this.bBox.width+d*2&&(g=this.ptOffset.x+this.bBox.width-d*2),e>0?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(g-map.Scale.normalX(8))+
","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(20)+",0 z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(g-map.Scale.normalX(7.5))+","+(this.ptOffset.y+map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(g-map.Scale.normalX(8))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(20)+
",0 z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(g-map.Scale.normalX(7.5))+","+(this.ptOffset.y+this.bBox.height-map.Scale.normalX(1))+" "+map.Scale.normalX(15)+",0 z","fill:white"))):(e=0,this.ptOffset.y>-d*2&&(e=this.ptOffset.y+d*2),this.ptOffset.y<-this.bBox.height+d*2&&(e=this.ptOffset.y+this.bBox.height-d*2),g>0?(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+
map.Scale.normalX(1))+","+(e-map.Scale.normalX(8))+" 0,"+map.Scale.normalX(20)+" z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+map.Scale.normalX(1))+","+(e-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white")):(map.Dom.newShape("path",this.pointShObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(e-map.Scale.normalX(8))+" 0,"+map.Scale.normalX(20)+
" z","fill:black;fill-opacity:0.2"),map.Dom.newShape("path",this.pointerObj,"M"+-this.ptOffset.x+","+-this.ptOffset.y+" l "+(this.ptOffset.x+this.bBox.width+map.Scale.normalX(1))+","+(e-map.Scale.normalX(7.5))+" 0,"+map.Scale.normalX(15)+" z","fill:white")))}};ma.prototype.onMouseMove=function(){if(this.fMouseDown){var d=this.objectNode.fu.getPosition();this.ptOffset.x+=d.x-this.beforeMovePosition.x;this.ptOffset.y+=d.y-this.beforeMovePosition.y;this.beforeMovePosition=this.objectNode.fu.getPosition();
this.szMode.match(/pointer/)&&this.makePointer()}};ma.prototype.onMouseUp=function(){var d=this.objectNode.fu.getPosition();this.ptOffset.x+=d.x-this.beforeMovePosition.x;this.ptOffset.y+=d.y-this.beforeMovePosition.y;this.fMouseDown=!1;this.szMode.match(/pointer/)&&this.makePointer()};ma.prototype.onMouseDown=function(){this.beforeMovePosition=this.objectNode.fu.getPosition();this.fMouseDown=!0};ma.prototype.setOnRemove=function(d){this.deleteButton&&this.deleteButton.buttonNode&&this.deleteButton.setActionOn("map.Dom.removeElementById('"+
this.szId+"');"+d)};ma.prototype.remove=function(){this.objectNode.parentNode.removeChild(this.objectNode);this.objectNode=null};ma.prototype.clear=function(){map.Dom.clearGroup(this.workspaceNode)};var ya=function(d,e,g,l){e&&(this.objNode=e,this.objNode.fu=new Methods(this.objNode),this.objStartPosition=this.objNode.fu.getPosition(),this.szFlag=g?g:"",this.parent=l);this.mouseStartPosition=d?map.Scale.getClientMousePosition(d,this.objNode):new point(0,0)};ya.prototype.onMouseMove=function(d){var e=
map.Scale.getClientMousePosition(d,this.objNode);try{if(map.User.onMouseMove(d,this.objNode.getAttributeNS(null,"id"),e))return null}catch(l){}switch(this.szFlag){case "yonly":e.x=this.mouseStartPosition.x;break;case "xonly":e.y=this.mouseStartPosition.y}if(this.objNode&&!this.szFlag.match(/parentonly/)){var g=this.objNode.fu.getScale();this.objNode.fu.setPosition(this.objStartPosition.x+(e.x-this.mouseStartPosition.x)/g.x,this.objStartPosition.y+(e.y-this.mouseStartPosition.y)/g.y)}if(this.parent)this.parent.onMouseMove(d)};
ya.prototype.onMouseUp=function(d){if(this.parent)this.parent.onMouseUp(d)};var Ua=function(d,e,g,l,u,k,v){this.targetGroup=d;this.szId=e?e:"button:"+String(Math.random());this.szType=g?g:"SIMPLE";this.szStyle=l?l:"";this.szActionOn=u;this.szActionOff=k;this.szTooltip=v?v:"";this.draw()};Ua.prototype.draw=function(d){!this.szType.match(/SELECTED/)||this.szType.match(/CHECKBOX/)?(this.nodeObj=map.Dom.newGroup(this.targetGroup),this.nodeObj.setAttributeNS(null,"cursor","pointer"),d=map.Dom.constructNode("a",
this.nodeObj,{}),this.shapeObj=map.Dom.newGroup(d)):this.shapeObj=this.nodeObj=map.Dom.newGroup(this.targetGroup);this.nodeObj.setAttributeNS(null,"id",this.szId+":button");if(this.szType.match(/CHECKBOX/)){d=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#unchecked_button"});var e=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":"#checked_button"});d.setAttributeNS(null,"id",this.szId+":unchecked");e.setAttributeNS(null,"id",this.szId+":checked");this.szType.match(/SELECTED/)&&(this.checked=
!0);this.szType.match(/SELECTED/)||(this.checked=!1,e.style.setProperty("display","none",""));d=map.Dom.newShape("rect",this.shapeObj,map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(-map.Scale.nButtonSize/2),map.Scale.normalX(map.Scale.nButtonSize),map.Scale.normalX(map.Scale.nButtonSize),"fill:red;fill-opacity:0");d.setAttributeNS(null,"id",this.szId+":widget:eventrect");d.setAttributeNS(szMapNs,"tooltip",this.szTooltip);d.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)");
new wa(d,this)}else if(this.szType.match(/TEXTBUTTON/)){e=this.szStyle;d=map.Scale.normalY(map.Scale.nButtonSize*.6);var g="font-family:arial;font-size:"+d+"px;fill:#444444;baseline-shift:-30%;pointer-events:none",l=d/2*e.length;this.szType.match(/SELECTED/)?l=map.Dom.newShape("rect",this.shapeObj,-d/5,-d/3*2,l,d/5*6,"fill:#eeeeff;stroke:black;stroke-width:"+map.Scale.normalX(1)+";stroke-opacity:0.3"):(l=map.Dom.newShape("rect",this.shapeObj,-d/5,-d/3*2,l,d/5*6,"fill:white;stroke:none;opacity:0"),
l.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),l.setAttributeNS(null,"onmouseout","map.Event.stopMouseEvent(evt)"),l.setAttributeNS(null,"onclick",this.szActionOn),l.setAttributeNS(null,"ontouchend",this.szActionOn),l.setAttributeNS(szMapNs,"tooltip",this.szTooltip));e=map.Dom.newText(this.shapeObj,0,0,g,e);this.bBox=new box(-d/5,-d/3*2,e.getComputedTextLength()+d/5*2,d/5*6);l.setAttributeNS(null,"width",String(this.bBox.width));this.buttonNode=l}else this.szType.match(/BUTTON/)&&
(d=map.Dom.constructNode("use",this.shapeObj,{"xlink:href":this.szStyle}),d.setAttributeNS(null,"onmouseup","map.Event.stopMouseEvent(evt)"),d.setAttributeNS(null,"onmousedown","map.Event.stopMouseEvent(evt)"),d.setAttributeNS(null,"onclick",this.szActionOn),d.setAttributeNS(null,"ontouchend",this.szActionOn),d.setAttributeNS(szMapNs,"tooltip",this.szTooltip),this.buttonNode=d)};Ua.prototype.scale=function(d,e){this.nodeObj&&this.nodeObj.fu.scale(d,e)};Ua.prototype.setPosition=function(d,e){this.nodeObj&&
this.nodeObj.fu.setPosition(d,e)};Ua.prototype.getPosition=function(d,e){if(this.nodeObj)return this.nodeObj.fu.getPosition()};Ua.prototype.remove=function(){this.nodeObj&&this.nodeObj.parentNode.removeChild(this.nodeObj)};Ua.prototype.setActionOn=function(d){this.szActionOn=d;this.buttonNode&&(this.buttonNode.setAttributeNS(null,"onclick",this.szActionOn),this.buttonNode.setAttributeNS(null,"ontouchend",this.szActionOn))};Ua.prototype.onClick=function(d){this.toggleCheckBox(d);map.Event.stopMouseEvent(d)};
Ua.prototype.toggleCheckBox=function(d){d=map.SVGDocument.getElementById(this.szId+":checked");this.checked?(d.style.setProperty("display","none",""),eval(this.szActionOff)):(d.style.setProperty("display","inline",""),eval(this.szActionOn));this.checked=!this.checked};var ca=function(d,e,g,l,u,k){d&&(this.hBar=this.vBar=0,this.vScale=this.hScale=1,this.maxBox=g,this.bWidth=l,this.bHeight=u,this.hThumb=g.width,this.vThumb=g.height,this.vValue=this.hValue=this.vThumbOffset=this.hThumbOffset=0,this.contObj=
d,this.contBox=d=map.Dom.getBox(d),this.contObj.fu=new Methods(this.contObj),d.width+d.x<=g.width-g.x+1&&d.height+d.y<=g.height-g.y+1||(d.width+d.x>g.width-g.x&&(this.hBar=u),d.height+d.y>g.height-g.y-this.hBar&&(this.vBar=l),d.width+d.x>g.width-g.x-this.vBar&&(this.hBar=u),this.vBar&&(this.maxBox.width-=this.vBar+k),this.hBar&&(this.maxBox.height-=this.hBar+k),this.hMax=this.maxBox.width-this.hBar*2,this.vMax=this.maxBox.height-this.vBar*2,this.hScale=(d.width+d.x)/this.maxBox.width,this.vScale=
(d.height+d.y)/this.maxBox.height,this.hScale>1&&(this.hThumb=Math.floor(this.hMax/this.hScale),this.hThumbOffset=Math.min(this.hMax-this.hThumb,-(e.x/this.hScale)),this.hValue=-e.x/(d.width+d.x-this.maxBox.width)),this.vScale>1&&(this.vThumb=Math.floor(this.vMax/this.vScale),this.vThumbOffset=Math.min(this.vMax-this.vThumb,-(e.y/this.vScale)),this.vValue=-e.y/(d.height+d.y-this.maxBox.height)),this.hThumbStyle="fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.3)+";opacity:0.3",this.vThumbStyle=
"fill:#99aacc;stroke:#dddddd;stroke-width:"+map.Scale.normalY(.3)+";opacity:0.3"))};ca.prototype.draw=function(d){if(this.contObj){var e="fill:white;stroke:black;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0",g="fill:#e8e8f8;stroke:white;stroke-width:"+map.Scale.normalX(.5)+";opacity:1.0";map.Scale.normalX(2);var l="fill:white;stroke:#dddddd;stroke-width:"+map.Scale.normalX(.2)+";opacity:1.0";this.remove(d);if(this.hScale!=1||this.vScale!=1){d=map.Dom.newGroup(this.contObj.parentNode);d.setAttributeNS(null,
"id","scrollwidget");this.scrollWidget=d;this.vScale>1&&this.hScale>1&&map.Dom.newShape("rect",d,this.maxBox.width,this.maxBox.height,this.bWidth+map.Scale.normalX(1),this.bHeight+map.Scale.normalX(1),e);if(this.hScale>1){map.Dom.newShape("rect",d,this.bWidth,this.maxBox.height,this.hMax,this.bHeight+map.Scale.normalX(.8),l);if(e=map.Dom.newShape("rect",d,this.bWidth,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepleft"),
new wa(e,this);if(e=map.Dom.newShape("rect",d,this.bWidth+this.hMax/2,this.maxBox.height,this.hMax/2,this.bHeight,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepright"),new wa(e,this);e=map.Dom.newShape("rect",d,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.hThumb-map.Scale.normalX(2)),Math.max(2,this.bHeight-map.Scale.normalY(2)),this.hThumbStyle?this.hThumbStyle:g);e.fu.setPosition(this.bWidth,this.maxBox.height);this.hThumbObj=new ba(e,
new box(0,0,this.hMax-this.hThumb,0));this.hThumbObj.parent=this;this.hThumbObj.setValue(new point(this.hValue,0))}if(this.vScale>1){map.Dom.newShape("rect",d,this.maxBox.width+map.Scale.normalX(2),this.bHeight,this.bWidth-map.Scale.normalX(2),this.vMax,l);if(e=map.Dom.newShape("rect",d,this.maxBox.width,this.bHeight,this.bWidth,this.vMax/2,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepup"),new wa(e,this);if(e=map.Dom.newShape("rect",d,this.maxBox.width,
this.bHeight+this.vMax/2,this.bWidth,this.vMax/2,"fill:black;stroke:black;opacity:0"))e.setAttributeNS(null,"id","widget:scrollbar:bigstepdown"),new wa(e,this);e=map.Dom.newShape("rect",d,map.Scale.normalX(1.5),map.Scale.normalY(1.5),Math.max(2,this.bWidth-map.Scale.normalX(2)),Math.max(2,this.vThumb-map.Scale.normalY(2)),this.vThumbStyle?this.vThumbStyle:g);e.fu.setPosition(this.maxBox.width,this.bHeight);this.vThumbObj=new ba(e,new box(0,0,0,this.vMax-this.vThumb));this.vThumbObj.parent=this;this.vThumbObj.setValue(new point(0,
this.vValue))}}else this.contObj.fu.setPosition(0,0)}};ca.prototype.hasScrollBars=function(d){return this.vScale>1||this.hScale>1};ca.prototype.onMouseDown=function(d){};ca.prototype.onMouseMove=function(d){var e=d=0;this.hScale>1&&(d=this.hThumbObj.fraction.x);this.vScale>1&&(e=this.vThumbObj.fraction.y);this.contObj.fu.setPosition(-d*(this.contBox.x+this.contBox.width-this.maxBox.width),-e*(this.contBox.y+this.contBox.height-this.maxBox.height))};ca.prototype.onMouseUp=function(d){};ca.prototype.onClick=
function(d){d=(new MapObject(d.target)).szId;var e=d.match(/big/)?map.Scale.normalX(100):map.Scale.normalX(5);d.match(/stepdown/)?this.vThumbObj.moveThumb(0,e):d.match(/stepup/)?this.vThumbObj.moveThumb(0,-e):d.match(/stepleft/)?this.hThumbObj.moveThumb(-e,0):d.match(/stepright/)&&this.hThumbObj.moveThumb(e,0)};ca.prototype.remove=function(d){this.scrollWidget&&this.scrollWidget.parentNode.removeChild(this.scrollWidget)};var ba=function(d,e,g,l,u){this.szId=null;this.moveArea=e;this.scaleArea=g;this.value=
new point(0,0);this.fraction=new point(0,0);this.onUp=this.onMove=null;u&&(this.valuesA=u.split(","));this.objNode=d;this.objNode.setAttributeNS(null,"id","widget:slider:"+String(Math.random()));d.fu=new Methods(d);this.ptNull=d.fu.getPosition();za.add(this)};ba.prototype.setMoveArea=function(d){this.moveArea=d};ba.prototype.setId=function(d){this.szId=d};ba.prototype.onMouseOver=function(d){if(this.parent)try{this.parent.onMouseOver(d,this.szId,this)}catch(e){}};ba.prototype.onMouseOut=function(d){if(this.parent)try{this.parent.onMouseOut(d,
this.szId,this)}catch(e){}};ba.prototype.onMouseDown=function(d){map.mouseObject=this.moveArea.width===0?new ya(d,this.objNode,"yonly"):this.moveArea.height===0?new ya(d,this.objNode,"xonly"):new ya(d,this.objNode,null);map.mouseObject.parent=this;if(this.parent)try{this.parent.onMouseDown(d,this.szId,this)}catch(e){}};ba.prototype.onMouseMove=function(d){var e=this.objNode.fu.getPosition();e.x=Math.min(e.x,this.ptNull.x+this.moveArea.x+this.moveArea.width);e.x=Math.max(e.x,this.ptNull.x+this.moveArea.x);
e.y=Math.min(e.y,this.ptNull.y+this.moveArea.y+this.moveArea.height);e.y=Math.max(e.y,this.ptNull.y+this.moveArea.y);this.objNode.fu.setPosition(e.x,e.y);this.value=new point(0,0);this.moveArea.width>0&&(this.value.x=e.x-this.ptNull.x,this.fraction.x=this.value.x/this.moveArea.width);this.moveArea.height>0&&(this.value.y=e.y-this.ptNull.y,this.fraction.y=this.value.y/this.moveArea.height);if(this.parent)try{this.parent.onMouseMove(d,this.szId,this)}catch(g){}};ba.prototype.onMouseUp=function(d){if(this.parent)try{this.parent.onMouseUp(d,
this.szId,this)}catch(e){}};ba.prototype.moveThumb=function(d,e){var g=this.objNode.fu.getPosition();g.x+=d;g.y+=e;this.objNode.fu.setPosition(g.x,g.y);this.onMouseMove()};ba.prototype.setValue=function(d){this.objNode.fu.setPosition(d.x*this.moveArea.width+this.ptNull.x,d.y*this.moveArea.height+this.ptNull.y);this.onMouseMove()};ba.prototype.remove=function(){za.removeWidget(this)};var ka=function(d,e,g,l,u,k){this.circlethumb=map.Dom.newGroup(d.parentNode,"widget:rotationslider:thumb");this.circlethumb.setAttributeNS(null,
"area","-1000,-1000,1000,1000");this.circlethumb.setAttributeNS(null,"range",g);this.circlethumb.setAttributeNS(null,"scale",l);this.nStep=u;this.nSnap=k;this.pBase=d.fu.getPosition();this.circlethumb.fu.setPosition(this.pBase.x,this.pBase.y);this.circlethumbNode=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(5),"fill:#ff0000;opacity:0.0;pointer-events:none");this.circleOverNode2=map.Dom.newShape("circle",this.circlethumb,0,0,map.Scale.normalX(6),"fill:none;stroke:#ffffff;stroke-width:"+
map.Scale.normalX(11)+";opacity:0.6;pointer-events:none;display:none");this.circleOverNode=map.Dom.newShape("path",this.circlethumb,"M-"+map.Scale.normalX(5.5)+",0 a"+map.Scale.normalX(6)+","+map.Scale.normalX(6)+" 0 1,0 "+map.Scale.normalX(5)+","+-map.Scale.normalX(5),"fill:none;stroke:#888888;stroke-width:"+map.Scale.normalX(1)+";opacity:0.8;pointer-events:none;display:none");setRotate(this.circleOverNode,45);setRotate(this.circleOverNode2,45);e=map.Dom.newNode("defs",this.circlethumb);e=map.Dom.newNode("marker",
e);e.setAttributeNS(null,"id","Triangle");e.setAttributeNS(null,"refX","0");e.setAttributeNS(null,"refY","0");e.setAttributeNS(null,"orient","auto");e.setAttributeNS(null,"style","overflow:visible");e.setAttributeNS(null,"path","M 0 0 L "+map.Scale.normalX(10)+" "+map.Scale.normalX(5)+" L 0 "+map.Scale.normalX(10)+" z");this.circleOverNode.style.setProperty("marker-start","url(#Triangle)","");this.circleOverNode.style.setProperty("marker-end","url(#Triangle)","");this.objNode=d;this.objNode.setAttributeNS(null,
"id","widget:slider:"+String(Math.random()));za.add(this);this.isActive=!1};ka.prototype.setValue=function(d){setRotate(this.objNode,d)};ka.prototype.onMouseOver=function(d){this.circleOverNode.style.setProperty("display","inline","");this.circleOverNode2.style.setProperty("display","inline","");if(this.parent)try{this.parent.onMouseOver(d)}catch(e){}};ka.prototype.onMouseOut=function(d){this.isActive||(this.circleOverNode.style.setProperty("display","none",""),this.circleOverNode2.style.setProperty("display",
"none",""));if(this.parent)try{this.parent.onMouseOut(d)}catch(e){}};ka.prototype.onMouseDown=function(d){var e=map.Scale.getClientMousePosition(d,map.SVGToolsGroup);this.startPosition=new point(e.x-this.pBase.x,e.y-this.pBase.y);this.circlethumbNode.fu.setPosition(this.startPosition.x,this.startPosition.y);map.mouseObject=new ya(d,this.circlethumbNode);map.mouseObject.parent=this;this.isActive=!0;if(this.parent)try{this.parent.onMouseDown(d)}catch(g){}};ka.prototype.onMouseMove=function(d){if(this.isActive&&
(setRotate(this.objNode,this.getAngle()),this.parent))try{this.parent.onMouseMove(d)}catch(e){}};ka.prototype.onMouseUp=function(d){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display","none","");if(this.parent){try{this.parent.onMouseUp(d)}catch(e){}this.objNode.style.setProperty("opacity","1.0","")}};ka.prototype.onClick=function(d){this.isActive=!1;this.circleOverNode.style.setProperty("display","none","");this.circleOverNode2.style.setProperty("display",
"none","");setRotate(this.objNode,0);if(this.parent){try{this.parent.onClick(d)}catch(e){}this.objNode.style.setProperty("opacity","1.0","")}};ka.prototype.getAngle=function(d){var e=this.circlethumbNode.fu.getPosition();d=e.x;e=e.y;var g=Math.asin(d/Math.sqrt(d*d+e*e))/Math.PI*180;g=isNaN(g)?180:g;d>=0&&e>=0&&(g=180-g);d<0&&e>=0&&(g=180-g);d<0&&e<0&&(g=360+g);this.nStep&&this.nSnap&&(g%this.nStep<this.nSnap?(g=Math.floor(g/this.nStep)*this.nStep,this.objNode.style.setProperty("opacity","1.0","")):
this.objNode.style.setProperty("opacity","0.5",""));return g};var ha=function(){this.widgetA=[]};ha.prototype.add=function(d){this.widgetA[this.widgetA.length]=d};ha.prototype.getWidget=function(d){for(var e in this.widgetA)if(this.widgetA[e].objNode==d)return this.widgetA[e];return null};ha.prototype.onMouseOver=function(d){var e=new MapObject(d.target);e=this.getWidget(e.objNode);try{e.onMouseOver(d)}catch(g){}try{e.owner.onMouseOver(d)}catch(g){}};ha.prototype.onMouseOut=function(d){var e=new MapObject(d.target);
e=this.getWidget(e.objNode);try{e.onMouseOut(d)}catch(g){}try{e.owner.onMouseOut(d)}catch(g){}};ha.prototype.onMouseDown=function(d){var e=new MapObject(d.target);e=this.getWidget(e.objNode);try{e.onMouseDown(d)}catch(g){}try{e.owner.onMouseDown(d)}catch(g){}};ha.prototype.onMouseUp=function(d){var e=new MapObject(d.target);e=this.getWidget(e.objNode);try{e.onMouseUp(d)}catch(g){}try{e.owner.onMouseUp(d)}catch(g){}};ha.prototype.onMouseMove=function(d){var e=new MapObject(d.target);e=this.getWidget(e.objNode);
try{e.onMouseMove(d)}catch(g){}try{e.owner.onMouseMove(d)}catch(g){}};ha.prototype.onClick=function(d){var e=new MapObject(d.target);if(e=this.getWidget(e.objNode)){try{e.onClick(d)}catch(g){}try{e.owner.onClick(d)}catch(g){}return!0}return!1};ha.prototype.removeWidget=function(d){for(var e=0;e<this.widgetA.length;e++)if(this.widgetA[e].objNode==d){for(;e<this.widgetA.length-1;e++)this.widgetA[e]=this.widgetA[e+1];this.widgetA.length--}};ha.prototype.clear=function(){this.widgetA.length=0};var wa=
function(d,e){this.objNode=d;this.owner=e;za.add(this)};wa.prototype.remove=function(){za.removeWidget(this)};var za=new ha;ha=function(){this.toolsA=[]};ha.prototype.add=function(d,e){e&&e<this.toolsA.length-1?this.toolsA.splice(e,0,d):this.toolsA[this.toolsA.length]=d};ha.prototype.getMapTool=function(d){for(var e in this.toolsA)if(this.toolsA[e].objNode==d.parentNode)return this.toolsA[e];return null};ha.prototype.removeMapTool=function(d){for(var e=0;e<this.toolsA.length;e++)if(this.toolsA[e].objNode==
d.parentNode){for(this.toolsA[e].remove();e<this.toolsA.length-1;e++)this.toolsA[e]=this.toolsA[e+1];this.toolsA.length--;this.toolsA.length&&this.toolsA[0].redraw()}};ha.prototype.clear=function(){this.toolsA.length=0};ha.prototype.onMouseDown=function(d){var e=new MapObject(d.target),g=c.getMapTool(e.objNode);g&&(map.mouseObject=new ya(d,e.objNode,"parentonly",g),map.mouseObject.parent=g)};var c=new ha,b=function(d,e,g){this.nFontSize=14;this.szLineStyle="fill:none;stroke:darkblue;stroke-width:"+
map.Scale.normalX(1)+";opacity:1.0;";this.szLineStyleLite="fill:none;stroke:darkblue;stroke-width:"+map.Scale.normalX(.75)+";opacity:1.0;";this.szLineBgStyle="fill:none;stroke:white;stroke-width:"+map.Scale.normalX(5)+";opacity:0.5;";this.szFillBgStyle="fill:white;stroke:none;opacity:0.6";this.szTextStyle="font-family:arial;font-size:"+map.Scale.normalY(this.nFontSize)+"px;fill:darkblue;pointer-events:none;";this.szPolylineStyle="fill:none;stroke:blue;stroke-width:"+map.Scale.normalX(2.5)+";stroke-opacity:0.5;";
this.szPolygonStyle="fill:blue;stroke:black;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szBufferStyle="fill:blue;stroke:darkblue;stroke-width:"+map.Scale.normalX(1)+";fill-opacity:0.2;";this.szType=e;this.objNode=map.Dom.newGroup(map.SVGToolsGroup,e+String(Math.random()));var l=this.szPolygonStyle;switch(e){case "coord":map.mouseObject=new ya(d,null,"parentonly");map.mouseObject.parent=this;l=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",
l,-map.Scale.normalX(this.nFontSize*.3),0,1,1,this.szFillBgStyle);map.Dom.newText(l,0,0,this.szTextStyle,"");map.Dom.newText(l,0,0,this.szTextStyle,"");l=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");l.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",l,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",l,-map.Scale.normalX(10),0,map.Scale.normalX(10),0,this.szLineStyleLite);map.Dom.newShape("line",l,0,-map.Scale.normalY(10),
0,map.Scale.normalY(10),this.szLineStyleLite);map.Dom.newShape("circle",l,0,0,map.Scale.normalX(3.7),this.szLineStyle);l.fu.setPosition(map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y);this.redraw();break;case "polyline":l=this.szPolylineStyle;case "polygon":map.mouseObject=new ya(d,null,"parentonly");map.mouseObject.parent=this;d=map.SVGDocument.getElementById("maptools_polypath");d==null&&(d=map.Dom.newNode("path",map.SVGToolsGroup),d.setAttributeNS(null,"id","maptools_polypath"),
d.setAttributeNS(szMapNs,"menu","polygonmenu"),d.setAttributeNS(null,"style",l),d.parentNode.insertBefore(d,this.objNode),c.toolShape=d);l=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random())+":maptoolnode");l.setAttributeNS(szMapNs,"menu","maptoolmenu");map.Dom.newShape("circle",l,0,0,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",l,-map.Scale.normalX(10),0,map.Scale.normalX(10),0,this.szLineStyleLite);map.Dom.newShape("line",l,0,-map.Scale.normalY(10),0,map.Scale.normalY(10),
this.szLineStyleLite);map.Dom.newShape("circle",l,0,0,map.Scale.normalX(3.7),this.szLineStyle);l.fu.setPosition(map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y);break;case "measurement":case "measurebuffer":case "selectbuffer":map.mouseObject=new ya(d,null);map.mouseObject.parent=this;map.Dom.newShape("circle",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(1),this.szLineBgStyle);map.Dom.newShape("circle",this.objNode,
map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(1),this.szType=="measurebuffer"||this.szType=="selectbuffer"?this.szBufferStyle:this.szLineStyle);map.Dom.newShape("line",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,this.szLineBgStyle);map.Dom.newShape("line",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,
map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,this.szLineStyle);l=map.Dom.newGroup(this.objNode,"distance-text"+String(Math.random()));map.Dom.newShape("rect",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y-map.Scale.normalY(5)-map.Scale.normalY(this.nFontSize*7/7),1E3,map.Scale.normalY(this.nFontSize*1.3),this.szFillBgStyle);map.Dom.newText(l,map.mouseObject.mouseStartPosition.x+map.Scale.normalX(5),map.mouseObject.mouseStartPosition.y-map.Scale.normalY(5),
this.szTextStyle,"test");l=map.Dom.newGroup(this.objNode,"endpoint"+String(Math.random()));map.Dom.newShape("circle",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",l,map.mouseObject.mouseStartPosition.x-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x+map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",l,
map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y+map.Scale.normalX(10),this.szLineStyleLite);map.Dom.newShape("circle",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);l=map.Dom.newGroup(this.objNode,"startpoint"+String(Math.random()));map.Dom.newShape("circle",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,
map.Scale.normalX(5.5),this.szFillBgStyle);map.Dom.newShape("line",l,map.mouseObject.mouseStartPosition.x-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,map.mouseObject.mouseStartPosition.x+map.Scale.normalX(10),map.mouseObject.mouseStartPosition.y,this.szLineStyleLite);map.Dom.newShape("line",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y-map.Scale.normalX(10),map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y+map.Scale.normalX(10),
this.szLineStyleLite);map.Dom.newShape("circle",l,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,map.Scale.normalX(3.7),this.szLineStyle);break;case "zoomrect":case "selectrect":map.mouseObject=new ya(d,null);map.mouseObject.parent=this;map.Dom.newShape("rect",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,10,10,this.szLineBgStyle);map.Dom.newShape("rect",this.objNode,map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,
10,10,this.szLineStyle);break;case "pan":map.mouseObject=new ya(d,null),map.mouseObject.parent=this,this.beginPan(d)}this.mapToolList=c;c.add(this,g)};b.prototype.onMouseDown=function(d){var e=new MapObject(d.target);map.mouseObject=new ya(d,e.objNode);map.mouseObject.parent=this};b.prototype.onMouseMove=function(d){var e=map.Scale.getClientMousePosition(d,map.SVGToolsGroup),g=e.x-map.mouseObject.mouseStartPosition.x,l=e.y-map.mouseObject.mouseStartPosition.y;switch(this.szType){case "coord":d=this.objNode.childNodes;
var u=0;d.item(u++);g=d.item(u++);e=map.Scale.clipWidgetPositionToMap(e);g.fu.setPosition(e.x,e.y);this.redraw();break;case "measurement":case "measurebuffer":case "selectbuffer":d=this.objNode.childNodes;u=0;var k=d.item(u++),v=d.item(u++),x=d.item(u++),H=d.item(u++),G=d.item(u++);d=d.item(u++);k.setAttributeNS(null,"r",String(Math.sqrt(g*g+l*l)));v.setAttributeNS(null,"r",String(Math.sqrt(g*g+l*l)));x.setAttributeNS(null,"x2",String(e.x));x.setAttributeNS(null,"y2",String(e.y));H.setAttributeNS(null,
"x2",String(e.x));H.setAttributeNS(null,"y2",String(e.y));d.fu.setPosition(g,l);G.fu.setPosition(g/2,l/2);g=G.firstChild;l=g.nextSibling;e=map.Scale.getDistanceInMeter(map.mouseObject.mouseStartPosition.x,map.mouseObject.mouseStartPosition.y,e.x,e.y);l.firstChild.nodeValue=map.Scale.formatDistanceString(e);e=map.Dom.getBox(l);g.setAttributeNS(null,"width",e.width+e.height*.7);break;case "zoomrect":case "selectrect":d=this.objNode.childNodes;u=0;e=d.item(u++);d=d.item(u++);e.setAttributeNS(null,"width",
String(Math.max(1,g)));e.setAttributeNS(null,"height",String(Math.max(1,l)));d.setAttributeNS(null,"width",String(Math.max(1,g)));d.setAttributeNS(null,"height",String(Math.max(1,l)));break;case "pan":map.fPDFEmbed||!map.fPanToolByViewer?(map.Zoom.doPanMap(g/map.Scale.normalX(1),l/map.Scale.normalY(1)),map.mouseObject.mouseStartPosition.x=e.x,map.mouseObject.mouseStartPosition.y=e.y):(e=map.Scale.getClientMousePosition(d,null),g=e.x-map.mouseObject.mouseStartPosition.x,l=e.y-map.mouseObject.mouseStartPosition.y,
map.Zoom.doPanMapByViewer(g/map.Scale.normalX(1),l/map.Scale.normalY(1)));break;case "polyline":case "polygon":this.objNode.firstChild.fu.setPosition(e.x,e.y),this.redraw()}};b.prototype.onMouseUp=function(d){switch(this.szType){case "coord":this.redraw();break;case "polyline":case "polygon":this.redraw();break;case "pan":displayMessage("please wait ...",500);setTimeout("map.Event.doDefaultZoom(null)",map.fPanToolByViewer?5:200);this.endPan(d);break;case "measurement":case "measurebuffer":var e=this.objNode.childNodes;
var g=0;this.szType=="measurement"&&(d=e.item(g++),g=e.item(g++),d.parentNode.removeChild(d),g.parentNode.removeChild(g));break;case "selectbuffer":e=this.objNode.childNodes;g=0;e.item(g++);g=e.item(g++);d=g.parentNode.getAttributeNS(null,"id")+":shape";g.setAttributeNS(null,"id",d);(d=map.Selections.newSelection("activeLayer",d,"type:circle"))?d.mapTool=this:this.remove();break;case "selectrect":e=this.objNode.childNodes;g=0;e.item(g++);g=e.item(g++);d=g.parentNode.getAttributeNS(null,"id")+":shape";
g.setAttributeNS(null,"id",d);(d=map.Selections.newSelection("activeLayer",d,"type:square"))?d.mapTool=this:this.remove();break;case "zoomrect":e=this.objNode.childNodes,g=0,d=e.item(g++),d=map.Dom.getBox(d),this.objNode.parentNode.removeChild(this.objNode),map.Zoom.doZoomMapToWidgetRect(d),f("")}};b.prototype.beginPan=function(d){map.fFroozeDynamicContent=!0};b.prototype.endPan=function(d){map.fFroozeDynamicContent=!1};b.prototype.doEndPan=function(d){map.fFroozeDynamicContent=!1};b.prototype.hideTools=
function(d){this.toolsHidden&&this.toolsHidden!==!1||(map.antiZoomAndPanList.setDisplay(d,"none"),this.toolsHidden=!0)};b.prototype.showTools=function(d){this.toolsHidden===!0&&(map.antiZoomAndPanList.setDisplay(d,"inline"),this.toolsHidden=!1)};b.prototype.hideLayer=function(d){for(var e in map.Layer.listA)if(d=map.Layer.listA[e],d.szFlag.match(/invisiblepan/)){if(map.Tiles&&map.Tiles.nCount>0)for(var g=map.Tiles.getTileNodeIds(e),l=0;l<g.length;l++){var u=g[l],k=map.SVGDocument.getElementById(u);
k&&(d.szBeforeHideStyle=k.style.getPropertyValue("display"),k.style.setProperty("display","none",""));if(k=map.SVGDocument.getElementById(u+":label"))d.szBeforeHideLabelStyle=k.style.getPropertyValue("display"),k.style.setProperty("display","none","");if(k=map.SVGDocument.getElementById(u+":label:bg"))d.szBeforeHideLabelStyle=k.style.getPropertyValue("display"),k.style.setProperty("display","none","")}if(k=map.SVGDocument.getElementById(e))d.szBeforeHideStyle=k.style.getPropertyValue("display"),k.style.setProperty("display",
"none","");if(k=map.SVGDocument.getElementById(e+":label"))d.szBeforeHideLabelStyle=k.style.getPropertyValue("display"),k.style.setProperty("display","none","");if(k=map.SVGDocument.getElementById(e+":label:bg"))d.szBeforeHideLabelStyle=k.style.getPropertyValue("display"),k.style.setProperty("display","none","")}};b.prototype.showLayer=function(d){for(var e in map.Layer.listA)if(d=map.Layer.listA[e],d.szFlag.match(/invisiblepan/)){if(map.Tiles&&map.Tiles.nCount>0)for(var g=map.Tiles.getTileNodeIds(e),
l=0;l<g.length;l++){var u=g[l],k=map.SVGDocument.getElementById(u);k&&(d.szBeforeHideStyle.length?k.style.setProperty("display",d.szBeforeHideStyle,""):k.style.removeProperty("display"));(k=map.SVGDocument.getElementById(u+":label"))&&(d.szBeforeHideLabelStyle.length?k.style.setProperty("display",d.szBeforeHideLabelStyle,""):k.style.removeProperty("display"));(k=map.SVGDocument.getElementById(u+":label:bg"))&&(d.szBeforeHideLabelStyle.length?k.style.setProperty("display",d.szBeforeHideLabelStyle,
""):k.style.removeProperty("display"))}(k=map.SVGDocument.getElementById(e))&&(d.szBeforeHideStyle.length?k.style.setProperty("display",d.szBeforeHideStyle,""):k.style.removeProperty("display"));(k=map.SVGDocument.getElementById(e+":label"))&&(d.szBeforeHideLabelStyle.length?k.style.setProperty("display",d.szBeforeHideLabelStyle,""):k.style.removeProperty("display"));(k=map.SVGDocument.getElementById(e+":label:bg"))&&(d.szBeforeHideLabelStyle.length?k.style.setProperty("display",d.szBeforeHideLabelStyle,
""):k.style.removeProperty("display"))}};b.prototype.redraw=function(d){switch(this.szType){case "polygon":var e=map.SVGDocument.getElementById("maptools_polypath");if(e==null)break;var g=[],l=this.mapToolList.toolsA,u="",k=l[0].objNode.firstChild;k.fu=new Methods(k);k=k.fu.getPosition();g[g.length]=k;u+="M"+k.x+","+k.y;for(var v=1;v<l.length;v++)k=l[v].objNode.firstChild,k.fu=new Methods(k),k=k.fu.getPosition(),g[g.length]=k,u+=" "+k.x+","+k.y;e.setAttributeNS(null,"d",u+"z");(u=map.SVGDocument.getElementById("maptools_phantomPointGroup"))?
map.Dom.clearGroup(u):u=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(v=0;v<g.length;v++){l=g[v].x+(g[v<g.length-1?v+1:0].x-g[v].x)/2;k=g[v].y+(g[v<g.length-1?v+1:0].y-g[v].y)/2;var x=map.Dom.newShape("circle",u,l,k,map.Scale.normalX(10),"fill:white;stroke:none;opacity:0.1;");map.Dom.newShape("circle",u,l,k,map.Scale.normalX(2),this.szPolygonStyle+"pointer-events:none;");x.setAttributeNS(szMapNs,"tooltip","click to add point");x.setAttributeNS(null,"onmousedown","new MapTool(evt,'polygon',"+
(v+1)+")")}(u=map.Dom.getObjectById("maptools_polygon_text"))?map.Dom.clearGroup(u):u=map.Dom.newGroup(map.SVGToolsGroup,"maptools_polygon_text");v=__doGetPolygonCenter(g);e=Math.abs(__doGetPolygonSurface(g,!0));g=new a(d,u,"maptooltext_template",18);g.setText(map.Scale.formatSurfaceString(e));d=g.textGroup.fu.getBox();g.setPosition(v.x-d.width/2,v.y-d.height/2);break;case "polyline":l=map.SVGDocument.getElementById("maptools_polypath");if(l==null)break;g=[];e=this.mapToolList.toolsA;u="";k=e[0].objNode.firstChild;
k.fu=new Methods(k);k=k.fu.getPosition();g[g.length]=k;u+="M"+k.x+","+k.y;for(v=1;v<e.length;v++)k=e[v].objNode.firstChild,k.fu=new Methods(k),k=k.fu.getPosition(),u+=" "+k.x+","+k.y,g[g.length]=k;l.setAttributeNS(null,"d",u);(u=map.SVGDocument.getElementById("maptools_phantomPointGroup"))?map.Dom.clearGroup(u):u=map.Dom.newGroup(this.objNode,"maptools_phantomPointGroup");for(v=0;v<g.length-1;v++)l=g[v].x+(g[v+1].x-g[v].x)/2,k=g[v].y+(g[v+1].y-g[v].y)/2,x=map.Dom.newShape("circle",u,l,k,map.Scale.normalX(2),
this.szPolygonStyle),x.setAttributeNS(szMapNs,"tooltip","click to add point"),x.setAttributeNS(null,"onmousedown","new MapTool(evt,'polyline',"+(v+1)+")");(u=map.SVGDocument.getElementById("maptools_polyline_textgroup"))?map.Dom.clearGroup(u):u=map.Dom.newGroup(this.objNode,"maptools_polyline_textgroup");l=0;for(v=1;v<e.length;v++){g=e[v].objNode.firstChild;k=e[v-1].objNode.firstChild.fu.getPosition();var H=g.fu.getPosition();l+=x=map.Scale.getDistanceInMeter(k.x,k.y,H.x,H.y);g=new a(d,u,"maptooltext_template",
12);g.setText(map.Scale.formatDistanceString(x));g.setPosition(k.x+(H.x-k.x)/2,k.y+(H.y-k.y)/2)}H=e[e.length-1].objNode.firstChild.fu.getPosition();g=new a(d,u,"maptooltext_template",18);g.setText(map.Scale.formatDistanceString(l));g.setPosition(H.x+map.Scale.normalX(5),H.y);g.textGroup.setAttributeNS(szMapNs,"menu","polylinemenu");break;case "coord":e=this.objNode.childNodes,v=0,d=e.item(v++),v=e.item(v++).fu.getPosition(),e=d.firstChild,g=e.nextSibling,u=g.nextSibling,l=map.Scale.getMapPosition(v.x,
v.y),l=map.Scale.getMapCoordinate(l.x,l.y),l=map.Scale.getGeoCoordinateOfPoint(l.x,l.y),k="Y="+String(l.y),g.firstChild.nodeValue="X="+String(l.x),u.firstChild.nodeValue=k,l=map.Dom.getBox(g),k=map.Dom.getBox(u),g.setAttributeNS(null,"y",Number(l.height)),u.setAttributeNS(null,"y",Number(l.y)+Number(l.height)+Number(k.height)+map.Scale.normalY(3)),e.setAttributeNS(null,"width",l.width+map.Scale.normalY(8)),e.setAttributeNS(null,"height",Number(l.height)+Number(k.height)+map.Scale.normalY(12)),v=new point(v.x,
v.y),e=new point(map.Scale.normalX(5),map.Scale.normalY(5)),v=map.Scale.clipWidgetObjectToMap(d,v,e),d.fu.setPosition(v.x,v.y)}};b.prototype.remove=function(d){this.objNode.parentNode.removeChild(this.objNode)};b.prototype.printPolygon=function(d){(d=map.SVGDocument.getElementById("maptools_polygon"))&&alert(printNode(d))};var f=function(d){d=="info"&&map.szMapToolType=="info"&&deactivateTheme(map._activeTheme);d=="pan"&&deactivateTheme(map._activeTheme);killTooltip();B();map.Dom.clearGroup(map.SVGMenuGroup);
map.Dom.clearGroup(map.SVGToolsGroup);c.clear();map.szMapToolType=d;map.fPDFEmbed&&map.fSetToolCursor&&setTimeout("setMapToolCursor('"+d+"')",100);try{map.HTMLWindow.ixmaps.htmlgui_setMapTool(d)}catch(e){}},a=function(d,e,g,l){(d=map.SVGDocument.getElementById(g))?(this.textGroup=e.appendChild(d.cloneNode(1E3)),this.textGroup.fu=new Methods(this.textGroup),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.textGroup.setAttributeNS(null,"id",g+String(Math.random())),e=this.textGroup.getElementsByTagName("rect"),
g=this.textGroup.getElementsByTagName("text"),e.length>1?(this.sdNode=e.item(0),this.bgNode=e.item(1)):this.bgNode=e.item(0),this.textNode=g.item(0),l&&this.textNode.style.setProperty("font-size",String(l)+"px",""),this.textNode.parentNode==this.textGroup?(this.workspaceNode=map.Dom.newGroup(this.textGroup,"workspace:"+String(Math.random())),this.textGroup.insertBefore(this.workspaceNode,this.textNode),this.workspaceNode.appendChild(this.textNode)):this.workspaceNode=this.textNode.parentNode):g==
"flat"?(this.textGroup=map.Dom.newGroup(e,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),map.fMapBorder3D&&map.SVGDocument.getElementById(map.szShadowFilterId)&&(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect*l/6),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect*l/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:#888888;stroke-width:2;"),
this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect*l/6),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect*l/6),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+l+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.7")):g=="light"?(this.textGroup=map.Dom.newGroup(e,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),map.fMapBorder3D&&map.SVGDocument.getElementById(map.szShadowFilterId)&&
(this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect*l/6),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect*l/6)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#fdfdfd;stroke:#888888;stroke-width:0.1;opacity:1;"),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect*l/6),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect*l/6),this.textNode=map.Dom.newText(this.textGroup,
0,0,"font-family:arial;font-size:"+l+"px;fill:#888888",""),this.workspaceNode=this.textNode.parentNode,this.textGroup.setAttributeNS(null,"opacity","0.95")):g=="alert"?(this.textGroup=map.Dom.newGroup(e,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#666666;opacity:0.2;stroke:none"),this.sdNode.setAttributeNS(null,"rx",map.Scale.normalY(.1)),this.sdNode.setAttributeNS(null,"ry",
map.Scale.normalY(.1)),this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#F9EDB8;stroke:#EDC967;stroke-width:1;opacity:1"),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+l+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode):(this.textGroup=map.Dom.newGroup(e,"textfield"+String(Math.random())),this.textGroup.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),this.sdNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#444444;opacity:0.5;stroke:none"),
this.bgNode=map.Dom.newShape("rect",this.textGroup,0,0,1,1,"fill:#ffffff;stroke:blue;stroke-width:0.1"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect),this.textNode=map.Dom.newText(this.textGroup,0,0,"font-family:arial;font-size:"+l+"px;fill:black",""),this.workspaceNode=this.textNode.parentNode,g=="transparent"&&(this.textGroup.setAttributeNS(null,
"opacity","0.4"),this.sdNode.setAttributeNS(null,"rx",map.nInfoRoundRect*5),this.sdNode.setAttributeNS(null,"ry",map.nInfoRoundRect*5),this.bgNode.setAttributeNS(null,"rx",map.nInfoRoundRect*5),this.bgNode.setAttributeNS(null,"ry",map.nInfoRoundRect*5)))};a.prototype.setText=function(d){try{return this.textNode.firstChild.nodeValue=d,this.resizeField(),!0}catch(e){return!1}};a.prototype.resizeField=function(){try{var d=map.Dom.getBox(this.workspaceNode);this.bgNode&&(this.bgNode.setAttributeNS(null,
"x",d.x-12),this.bgNode.setAttributeNS(null,"y",d.y-4),this.bgNode.setAttributeNS(null,"width",d.width+24),this.bgNode.setAttributeNS(null,"height",d.height+10));this.sdNode&&(this.sdNode.setAttributeNS(null,"x",d.x-6+1),this.sdNode.setAttributeNS(null,"y",d.y-3+2),this.sdNode.setAttributeNS(null,"width",d.width+12+1),this.sdNode.setAttributeNS(null,"height",d.height+6+1))}catch(e){}};a.prototype.setPosition=function(d,e){this.textGroup.fu.setPosition(d,e)};var p=function(d,e,g,l,u,k){this.nMaxWidth=
l?l:100;this.nMaxHeight=u?u:100;this.nScrollBarWidth=k?k:10;e!=null&&(d=":"+String(Math.random()),(l=map.SVGDocument.getElementById(g))?(this.areaGroup=e.appendChild(l.cloneNode(1E3)),this.areaGroup.fu=new Methods(this.areaGroup),this.areaGroup.fu.extendAllIds(this.areaGroup,d),this.workspaceNode=map.SVGDocument.getElementById(g+":workspace"+d),this.cliprectNode=map.SVGDocument.getElementById(g+":cliprect"+d)):(g="scrollarea",this.areaGroup=map.Dom.newGroup(e,g+d),e=map.Dom.newNode("clipPath",this.areaGroup),
e.setAttribute("id",g+":clippath"+d),e.setAttribute("style","pointer-events:all"),this.cliprectNode=map.Dom.newShape("rect",e,0,0,map.Scale.normalX(this.nMaxWidth),map.Scale.normalY(this.nMaxHeight),"fill:none;stroke:none"),this.cliprectNode.setAttribute("id",g+":cliprect"+d),this.areaGroup.setAttributeNS(null,"clip-path","url(#"+g+":clippath"+d+")"),this.workspaceNode=map.Dom.newGroup(this.areaGroup,g+":workspace"+d)),this.szId=g)};p.prototype.setWidth=function(d){this.cliprectNode&&(this.nMaxWidth=
Number(d),this.cliprectNode.setAttributeNS(null,"width",map.Scale.normalX(Math.max(this.nMaxWidth,0))))};p.prototype.setHeight=function(d){this.cliprectNode&&(this.nMaxHeight=Number(d),this.cliprectNode.setAttributeNS(null,"height",map.Scale.normalX(Math.max(this.nMaxHeight,0))))};p.prototype.setPosition=function(d,e){this.areaGroup&&this.areaGroup.fu.setPosition(d,e)};p.prototype.reformat=function(d){this.scrollObj&&(this.scrollObj.remove(d),this.scrollObj=null);var e=new box(0,0,map.Scale.normalX(this.nMaxWidth),
map.Scale.normalY(this.nMaxHeight)),g=getTranslate(this.workspaceNode);if(this.nMaxWidth<0||this.nMaxHeight<0){var l=map.Dom.getBox(this.workspaceNode);e.width=this.nMaxWidth>=0?e.width:l.width+map.Scale.normalX(this.nScrollBarWidth+5);e.height=this.nMaxHeight>=0?e.height:l.height+map.Scale.normalY(this.nScrollBarWidth+5);this.cliprectNode.setAttributeNS(null,"width",e.width);this.cliprectNode.setAttributeNS(null,"height",e.height)}this.scrollObj=new ca(this.workspaceNode,new point(g.x,g.y),e,map.Scale.normalX(this.nScrollBarWidth),
map.Scale.normalY(this.nScrollBarWidth),map.Scale.normalX(1)),this.scrollObj.draw(d)};p.prototype.remove=function(d){this.scrollObj&&(this.scrollObj.remove(d),this.scrollObj=null);this.areaGroup&&(this.areaGroup.parentNode.removeChild(this.areaGroup),this.areaGroup=null)};p.prototype.hasScrollBars=function(d){return this.scrollObj?this.scrollObj.hasScrollBars():!1};p.prototype.getWidth=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"width"))/map.Scale.normalX(1):
0};p.prototype.getHeight=function(){return this.cliprectNode?Number(this.cliprectNode.getAttributeNS(null,"height"))/map.Scale.normalY(1):0};p.prototype.setScrollPosition=function(d){this.scrollObj&&this.scrollObj.vThumbObj&&this.scrollObj.vThumbObj.setValue(d);this.scrollObj&&this.scrollObj.hThumbObj&&this.scrollObj.hThumbObj.setValue(d)};var m=[];map.removeAllHighlights=function(){for(var d=0;d<m.length;d++)m[d]&&(m[d].unlock(),m[d].removeAll());m.length=0};var w=function(){this.itemA=[];m[m.length]=
this};w.prototype.addItem=function(d,e){for(var g=0;g<this.itemA.length;g++)if(this.itemA[g].node==d)return null;d=new K(d,e);this.itemA[this.itemA.length]=d;return d.node};w.prototype.checkItem=function(d){for(var e=0;e<this.itemA.length;e++)if(this.itemA[e].node==d)return!0;return!1};w.prototype.removeItem=function(d){d=map.Layer.getLayerItemNodeOfNode(d);for(var e=0;e<this.itemA.length;e++)if(this.itemA[e].node==d){for(this.itemA[e].removeHighLight();e<this.itemA.length-1;e++)this.itemA[e]=this.itemA[e+
1];--this.itemA.length}};w.prototype.offAll=function(){for(var d=0;d<this.itemA.length;d++)this.itemA[d].removeHighLight()};w.prototype.onAll=function(){for(var d=0;d<this.itemA.length;d++)this.itemA[d].doHighLight()};w.prototype.startToggle=function(){map.nHighlightToggle>0&&(this.toggleCount=map.nHighlightToggle*2,setTimeout("__highlightObject.toggleAll()",1E3))};w.prototype.toggleAll=function(){for(var d=0;d<this.itemA.length;d++)this.itemA[d].highlighted?this.itemA[d].removeHighLight():this.itemA[d].doHighLight();
--this.toggleCount>0&&setTimeout("__highlightObject.toggleAll()",500)};w.prototype.removeAll=function(){if(!this.fLock){for(var d=0;d<this.itemA.length;d++)this.itemA[d].removeHighLight();this.itemA.length=0}};w.prototype.lock=function(){this.fLock=!0};w.prototype.unlock=function(){this.fLock=!1};K.prototype.doHighLight=function(){var d=this.node;if(d){if(this.szMode&&this.szMode=="circle"&&this.node.parentNode.fu&&this.node.parentNode.fu.getPosition){this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup,
":highlightgroup");this.itemNode=map.Dom.newGroup(this.highlightGroup);d=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;var e=map.Scale.normalX(2)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,g=map.Scale.normalX(1)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale;map.Dom.newShape("circle",this.itemNode,0,0,d,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+g+" "+g+";stroke-width:"+e*1.1+"px;pointer-events:none");map.Dom.newShape("circle",this.itemNode,
0,0,d,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+g+" "+g+";stroke-width:"+e+"px;pointer-events:none");map.Dom.getBox(this.node);d=this.node.parentNode.fu.getScale();var l=this.node.fu.getPosition().x*d.x;d=this.node.fu.getPosition().y*d.y;l=this.node.parentNode.fu.getPosition().x+l;d=this.node.parentNode.fu.getPosition().y+d;this.itemNode.fu.setPosition(l,d);this.itemNode.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX);return!0}if(this.szMode&&this.szMode=="isolate"&&this.node.parentNode.fu&&
this.node.parentNode.fu.getPosition)return d=d.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,":highlightgroup"),this.itemNode=this.highlightGroup.appendChild(d),this.itemNode.setAttributeNS(null,"id",""),this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),map.Dom.getBox(this.node),d=this.node.parentNode.fu.getScale(),l=this.node.fu.getPosition().x*d.x,d=this.node.fu.getPosition().y*d.y,l=this.node.parentNode.fu.getPosition().x+
l,d=this.node.parentNode.fu.getPosition().y+d,this.itemNode.fu=new Methods(this.itemNode),this.itemNode.fu.setPosition(l,d),l=this.node.fu.getScale(),d=this.node.parentNode.fu.getScale(),this.itemNode.fu.scale(l.x*d.x,l.y*d.y),this.objectGroupOpacity=map.Layer.objectGroup.style.getPropertyValue("opacity")||1,map.Layer.objectGroup.style.setProperty("opacity","0.3"),l=map.Dom.newGroup(this.itemNode),d=map.Scale.normalX(50)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,e=map.Scale.normalX(10)*
map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,g=map.Scale.normalX(5)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,map.Dom.newShape("circle",l,0,0,d,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+g+" "+g+";stroke-width:"+e*1.1+"px;pointer-events:none"),map.Dom.newShape("circle",l,0,0,d,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+g+" "+g+";stroke-width:"+e+"px;pointer-events:none"),map.Dom.getBox(this.node),d=this.node.parentNode.fu.getScale(),this.node.fu.getPosition(),
this.node.fu.getPosition(),this.node.parentNode.fu.getPosition(),this.node.parentNode.fu.getPosition(),l.fu.scale(1/d.x,1/d.y),l.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX),!0;if(this.szMode&&this.szMode=="scale"&&this.node.parentNode.fu&&this.node.parentNode.fu.getPosition)return d.nodeName=="g"&&(d=d.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,":highlightgroup"),this.highlightGroup.style.setProperty("pointer-events","none"),this.itemNode=
this.highlightGroup.appendChild(d),this.itemNode.setAttributeNS(null,"id",""),this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),map.Dom.getBox(this.node),d=this.node.parentNode.fu.getScale(),l=this.node.fu.getPosition().x*d.x,d=this.node.fu.getPosition().y*d.y,l=this.node.parentNode.fu.getPosition().x+l,d=this.node.parentNode.fu.getPosition().y+d,this.itemNode.fu=new Methods(this.itemNode),this.itemNode.fu.setPosition(l,d),l=this.node.fu.getScale(),d=this.node.parentNode.fu.getScale(),
this.itemNode.fu.scale(l.x*d.x,l.y*d.y),l=map.Dom.newGroup(this.itemNode),d=map.Scale.normalX(10)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,e=map.Scale.normalX(2)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,g=map.Scale.normalX(1)*map.Layer.nObjectScale/map.Layer.nDynamicObjectScale,map.Dom.newShape("circle",l,0,0,d,"fill:none;fill-opacity:0.1;stroke:black;stroke-dasharray:"+g+" "+g+";stroke-width:"+e*1.1+"px;pointer-events:none"),map.Dom.newShape("circle",l,0,0,d,"fill:none;fill-opacity:0.1;stroke:white;stroke-dasharray:"+
g+" "+g+";stroke-width:"+e+"px;pointer-events:none"),map.Dom.getBox(this.node),d=this.node.parentNode.fu.getScale(),this.node.fu.getPosition(),this.node.fu.getPosition(),this.node.parentNode.fu.getPosition(),this.node.parentNode.fu.getPosition(),l.fu.scale(1/d.x,1/d.y),l.fu.scaleBy(1,1/map.Zoom.nZoomY*map.Zoom.nZoomX)),!0;if(this.szMode&&this.szMode=="scalex")return this.node.parentNode.fu&&this.node.parentNode.fu.getPosition&&(d=d.cloneNode(1E3),this.highlightGroup=this.highlightGroup||map.Dom.newGroup(map.Layer.objectGroup.parentNode,
":highlightgroup"),this.itemNode=this.highlightGroup.appendChild(d),this.itemNode.setAttributeNS(null,"id",""),this.itemNode.fu=new Methods(this.itemNode),this.itemNode.fu.scaleBy(0,0)),!0;l=new MapObject(d);e=map.Layer.getLayerObj(l.szId);l=e.szHighlight;if(!l)switch(e.szType){case "point":l="filter:url(#Glow);scale:1.5";break;case "line":l="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":l="fill:yellow"}if(this.szMode&&this.szMode=="hint")switch(e.szType){case "point":l=
"filter:url(#Glow);scale:1.5";break;case "line":l="fill:none;stroke:yellow;stroke-width:5;stroke-opacity:0.3";break;case "polygon":l="fill:#eeeeff;fill-opacity:0.2;stroke-opacity:0.5;stroke:#eeeeff;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;"}if(l=__scaleStyleString(l,map.Scale.normalX(1/map.Zoom.nZoom))){g=d.parentNode;var u=g.nextSibling;u&&u.nodeType==1&&u.getAttributeNS(null,"id").match(/highlightgroup/)?this.highlightGroup=u:(this.highlightGroup=map.Dom.newGroup(g.parentNode,e.szName+
":highlightgroup"),this.highlightGroup=g.parentNode.insertBefore(this.highlightGroup,u),this.highlightGroup.setAttributeNS(null,"class",g.getAttributeNS(null,"class")));this.highlightGroup.setAttributeNS(null,"style",l+";display:inline;pointer-events:none");d=d.cloneNode(1E3);this.itemNode=this.highlightGroup.appendChild(d);this.itemNode.setAttributeNS(null,"id","");if(l.match(/fill:/)&&(this.itemNode.style.removeProperty("fill"),this.itemNode.style.removeProperty("fill-opacity"),this.itemNode.hasChildNodes))for(d=
this.itemNode.childNodes,e=0;e<d.length;e++)d.item(e).nodeType==1&&d.item(e).style.setProperty("fill","inherit","");if(l.match(/stroke:/)&&(this.itemNode.style.removeProperty("stroke"),this.itemNode.hasChildNodes))for(d=this.itemNode.childNodes,e=0;e<d.length;e++)d.item(e).nodeType==1&&(d.item(e).style.setProperty("stroke","none",""),d.item(e).style.removeProperty("stroke"));if(l.match(/scale:/)){this.itemNode.fu=new Methods(this.itemNode);l=parseFloat(l.split("scale:")[1]);if(isNaN(l)||l===0)l=1.5;
this.itemNode.fu.scaleBy(l,l)}return this.highlighted=!0}return!1}};K.prototype.removeHighLight=function(){this.highlightGroup&&this.highlightGroup.parentNode&&this.highlightGroup.parentNode.removeChild(this.highlightGroup);this.highlighted=!1;this.objectGroupOpacity&&(map.Layer.objectGroup.style.setProperty("opacity",this.objectGroupOpacity),this.objectGroupOpacity=null)};var C=null,z=null;ixMap.prototype.displayInfo=function(d,e,g){A(d,e,g)};var y=function(d,e,g){var l=null;g&&g.match(/add/)||map.SVGPopupGroup.fu.clear();
var u=C?map.Event.popupContextObj=C:map.Event.popupContextObj;if(u==null)return null;var k=u.getAttributeNS(szMapNs,"info");k!=null&&k.length!==0||!u.parentNode||(u=u.parentNode,k=u.getAttributeNS(szMapNs,"info"));var v=map.Dom.getAttributeByNodeOrParents(u.parentNode,szMapNs,"info"),x=map.Dom.getAttributeByNodeOrParents(u.parentNode,szMapNs,"show"),H=map.Dom.getAttributeByNodeOrParents(u.parentNode,szMapNs,"label");var G=map.Dom.getAttributeByNodeOrParents(u.parentNode,szMapNs,"units");var P=map.Dom.getAttributeByNodeOrParents(u,
null,"id"),M=P+":info";map.Themes&&map.Themes.activeTheme&&(M+=":"+map.Themes.activeTheme.szId);if(map.SVGDocument.getElementById(M))return null;var T=null;if(P&&P.length){P=map.Tiles.getMasterId(P);var qa=P.split(":::")[0];T=map.SVGDocument.getElementById(qa+":image")}try{if(map.User.onInfoDisplay(null,P))return null}catch(eb){}d=new point(d,e);qa=new point(map.Scale.normalX(map.nInfoOffsetX),map.Scale.normalY(map.nInfoOffsetY));e="info:"+String(Math.random());qa=new ma(map.SVGDocument,map.SVGPopupGroup,
e+(g.match(/pointer/)?"":":movable"),d,qa,g);var X=qa.workspaceNode;X=map.Dom.newGroup(X,M);var ja=new box(0,0,0,0);M=(new MapObject(u)).szId;if(M.match(/chartgroup/)){var da=M.split(":")[1],sa=M.split(":")[3];M=da+"::"+sa}else{var Aa=map.Layer.getLayerItemNodeOfNode(u);Aa&&(M=Aa.getAttributeNS(null,"id"))}sa=(map.Label.getLabel(M)||" ").replace(/<br>/g," ");map.Themes.activeTheme&&(sa=map.Themes.getTitle(M,map.Themes.activeTheme));try{var V=map.Themes.getDataRow(M,map.Themes.activeTheme);sa=map.HTMLWindow.ixmaps.htmlgui_onInfoTitle(sa,
V)}catch(eb){}if(sa){if(!isNaN(sa)){var ea=map.Layer.getLayerObj(da);sa=(ea?ea.szLabel+" ":"")+sa}qa.setTitle(sa,map.Scale.tStyle.InfoContainerTitle)}if(g.match(/short/))return qa.reformat(),qa?qa.objectNode:null;if(map.Themes&&map.Themes.activeTheme){if((ea=map.Layer.getLayerItemNodes(u))&&ea.length>0)for(var Va="",Sa=0;Sa<map.Themes.themesA.length;Sa++){var Ja=map.Themes.themesA[Sa];if(Ja.szFields!=Va&&(da=map.Dom.newGroup(X,"info:chart"),Aa=map.Tiles.getMasterId(ea[0].getAttributeNS(null,"id")),
map.Themes.getChart(Aa,da,"VALUES|ZOOM|AXIS",Ja),da.hasChildNodes()||(Aa=map.Tiles.getMasterId(ea[0].parentNode.getAttributeNS(null,"id")))&&map.Themes.getChart(Aa,da,"VALUES|ZOOM|AXIS",Ja),da.hasChildNodes()||(Aa=u.getAttributeNS(null,"id")||"",(Aa=Aa.split(":")[1])&&map.Themes.getChart(Aa,da,"VALUES|ZOOM|AXIS",Ja)),da.hasChildNodes())){Va=Ja.szFields;k="";killTooltip();qa.fClipped=!1;V=map.Dom.getBox(da);if(V.width>0&&V.height>0){sa=map.Scale.tStyle.Description.nFontHeight*.9;var tb=__scaleStyleString(map.Scale.tStyle.Description.szStyle,
1),Ma=(Ja.szTitle||" ").replace(/<br>/g," ");map.Dom.newText(X,map.Scale.normalX(6),ja.height+sa,tb,Ma);sa=Ja.szFlag.match(/CHART/)?sa+map.Scale.normalY(6/1.3):sa+map.Scale.normalY(6*1.3);Ma=map.Scale.normalX(Ja.szFlag.match(/PLOT/)?200:100)/V.width;da.fu.scale(Ma,Ma);V=map.Dom.getBox(da);da.fu.setPosition(map.Scale.normalX(6)-V.x*Ma,ja.height+sa-V.y*Ma);V=map.Dom.getBox(da);sa=V.y+V.height+map.Scale.normalY(6);if(ja=map.Themes.getLabel(Aa,Ja))ja=ja.length<25?ja:ja.substr(0,25)+"...",sa+=map.Scale.normalY(6*
1.3),tb=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1),map.Dom.newText(da,V.x,sa,tb,ja),sa+=map.Scale.tStyle.Description.nFontHeight;var Eb=map.Themes.getSummary(Aa,Ja);Eb&&(tb=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1/Ma),map.Dom.newText(da,V.x,sa,tb,Eb));ja=map.Dom.getBox(X);ja.height+=map.Scale.normalY(12)}Ja.fShowData&&(l=Ja.getDataGrid(Aa,X))&&(l.setPosition(map.Scale.normalX(5),ja.height),l.hasScrollBars&&l.hasScrollBars()&&l.workspaceNode.style.setProperty("display","none",
""))}}else{da=map.Dom.newGroup(X,"info:chart");Aa=(new MapObject(u)).szId;Ja=Aa.split(":")[1];Sa=Aa.split(":")[3];sa=(ea=map.Layer.getLayerObj(Ja))?ea.szSelection+" ":"";(ea=map.Themes.getTheme(Aa.split(":")[0]))&&ea.szInfoTitle&&(sa=ea.szInfoTitle);sa=(Aa=map.Label.getLabel(Ja+"::"+Sa))?Aa:sa+Sa;Aa=Ja+"::"+Sa;if(ea.szFlag.match(/PLOT/))for(Sa=0;Sa<map.Themes.themesA.length;Sa++)Ja=map.Themes.themesA[Sa],Ja.szFlag.match(/PLOT/)&&map.Themes.getChart(Aa,da,"VALUES|XAXIS|ZOOM|BOX|GRID",Ja);else ea.szFlag.match(/POINTER/)&&
ea.nOrigSumA.length>1&&ea.partsA.length>1?map.Themes.getChart(Aa,da,"VALUES|ZOOM|AXIS|HORZ",ea):(map.Themes.getChart(Aa,da,"VALUES|ZOOM|AXIS",ea),ea.szFlag.match(/COUNTS/)&&ea.partsA.length>1&&(Ja=map.Dom.newGroup(da,"info:chart:x"),Sa=ea.nNormalSizeValue,ea.nNormalSizeValue=map.Themes.getMaxValue(Aa,ea)*10,map.Themes.getChart(Aa,Ja,"CHART|BAR|HORZ|ZOOM|VALUES|AXIS|NOZERO|SORT",ea),ea.nNormalSizeValue=Sa,Ja.fu.setPosition(0,Ja.fu.getBox().height+da.fu.getBox().height/2+map.Scale.normalX(5))));ea&&
ea.itemA[Aa]&&ea.itemA[Aa].szSelectionId&&(sa=ea.itemA[Aa].szSelectionId.split(":").pop());ea&&ea.itemA[Aa]&&ea.itemA[Aa].szTitle&&(sa=ea.itemA[Aa].szTitle);ea&&ea.itemA[Aa]&&ea.itemA[Aa].szSelectionId2&&ea.itemA[Aa].szSelectionId2!="undefined"&&(sa+=" ==> "+ea.itemA[Aa].szSelectionId2);try{V=map.Themes.getDataRow(M,map.Themes.activeTheme),sa=map.HTMLWindow.ixmaps.htmlgui_onInfoTitle(sa,V)}catch(eb){}if(da.hasChildNodes()){killTooltip();qa.fClipped=!1;qa.setTitle(sa,map.Scale.tStyle.InfoContainerTitle);
V=map.Dom.getBox(da);if(V.width>0&&V.height>0){Ja=ea.szFlag.match(/PLOT/)?Math.min(map.Scale.normalX(300)/V.height,map.Scale.normalX(400)/V.width):Math.min(map.Scale.normalX(150)/V.height,map.Scale.normalX(200)/V.width);da.fu.scale(Ja,Ja);da.fu.setPosition(map.Scale.normalX(6)-V.x*Ja,ja.height+map.Scale.normalY(6)-V.y*Ja);sa=V.y+V.height+map.Scale.normalY(6)/Ja;ja=1.5/Ja;Ma=(ea.szTitle||" ").replace(/<br>/," \n ");tb=__scaleStyleString(map.Scale.tStyle.Description.szStyle,ja);sa+=map.Scale.tStyle.Description.nFontHeight*
ja+map.Scale.normalY(2*ja);Ja=map.Dom.newText(da,V.x,sa,tb,Ma);sa+=map.Scale.tStyle.Description.nFontHeight*ja+map.Scale.normalY(ja);map.Dom.wrapText(Ja,V.width);if(Eb=map.Themes.getValueComment(Aa,map.Themes.activeTheme))tb=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.5),map.Dom.newText(da,V.x,sa,tb,Eb),map.Scale.normalY(.5);map.Themes.getSummary(Aa,map.Themes.activeTheme);ja=map.Dom.getBox(X);ja.height+=map.Scale.normalY(12)}else if(Eb=map.Themes.getSummary(Aa,ea))Eb=Eb.split("Total:")[1],
tb=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,2.5),map.Dom.newText(X,100,500,tb,Eb+ea.szUnits),ja=map.Dom.getBox(X);ea.fShowData&&(l=ea.getDataGrid(Aa,X))&&(l.setPosition(map.Scale.normalX(5),ja.height),l.hasScrollBars&&l.hasScrollBars()&&l.workspaceNode.style.setProperty("display","none",""))}}ja=map.Dom.getBox(X)}T&&(T=T.cloneNode(1E3),T=X.appendChild(T),T.fu=new Methods(T),T.fu.setPosition(map.Scale.normalX(5),ja.height+map.Scale.normalY(5)),T.fu.scale(map.Scale.normalX(1),map.Scale.normalY(1)),
ja=map.Dom.getBox(X),ja.height+=map.Scale.normalX(7));if(k&&k.length&&v.length&&!l){if(x&&x.length){if(V=[],v=v.split("|"),k=k.split("|"),x=x.split("|"),da=H.split("|"),H=G.split("|"),x&&x.length){for(G=0;G<x.length;G++)for(T=0;T<v.length;T++)x[G]==v[T]&&(V[V.length]=da&&da[G]?map.Dictionary.getLocalText(da[G]):map.Dictionary.getLocalText(v[T]));for(G=0;G<x.length;G++)for(T=0;T<v.length;T++)x[G]==v[T]&&(da=map.Dictionary.getLocalText(k[T]),V[V.length]=O(da),V[V.length-1]+=H[G]?" "+H[G]:"")}}else{V=
[];v=v.split("|");H=G.split("|");for(G=0;G<v.length;G++)V[V.length]=map.Dictionary.getLocalText(v[G]);k=k.split("|");for(G=0;G<k.length;G++)isNaN(k[G])?(da=map.Dictionary.getLocalText(v[G]+":"+k[G]),V[V.length]=da!=v[G]+":"+k[G]?da:map.Dictionary.getLocalText(k[G])):(da=map.Dictionary.getLocalText(v[G]+":"+k[G]),V[V.length]=O(da!=v[G]+":"+k[G]?da:k[G])),V[V.length-1]+=H[G]?" "+H[G]:""}if(V.length){var sb=t(map.SVGDocument,X,e+":textgrid",V,2,14);sb.fu.setPosition(map.Scale.normalX(5),ja.height)}try{var ob;
if(ob=map.User.onInfoDisplayExtend(null,P,sb.parentNode,d))ob=sb.appendChild(ob),ob.fu.setPosition(map.Scale.normalX(5),ja.height)}catch(eb){}}try{if(ob=map.HTMLWindow.ixmaps.htmlgui_onInfoDisplayExtend(map.SVGDocument,M))ob=X.appendChild(ob),ob.fu=new Methods(ob),ob.fu.setPosition(map.Scale.normalX(10),ja.height+map.Scale.normalX(10))}catch(eb){}X.hasChildNodes()||map.Dom.newShape("rect",X,0,0,1,1,"fill:none;stroke:none;");qa.reformat();l&&l.workspaceNode.style.setProperty("display","inline","");
g.match(/fix/)&&(qa.objectNode.fu.scale(map.nFixedInfoScale,map.nFixedInfoScale),map.SVGFixedGroup.appendChild(qa.objectNode),qa.highLightList=new w,qa.highLightList.addItem(u),qa.highLightList.lock(),qa.setOnRemove("_doRemoveFixedInfo(map.Dom.popObj('"+map.Dom.pushObj(qa)+"'))"));return qa?qa.objectNode:null};ixMap.prototype.removeInfo=function(){map.SVGFixedGroup.fu.clear()};var O=function(d){if(d.match(/E+/)){var e=d.split("E+"),g=parseFloat(e[0]);e=parseInt(e[1]);if(!isNaN(g)&&!isNaN(e))return g*=
Math.pow(10,e),String(Math.round(g*100)/100)}g=Number(d);return isNaN(g)?d:String(g)},t=function(d,e,g,l,u,k,v,x){d=Math.ceil(l.length/u);k=k?k:12;for(var H=0;H<l.length&&l[H];H++);e=map.Dom.newGroup(e,g);var G=map.SVGDocument.getElementById("TextLinesBgPattern");x||map.szTextGridStyle.match(/background/);g=[];var P=[],M=Array(d);for(H=0;H<d;H++)M[H]=Array(u);var T=map.Dom.newNode("g",e),qa=map.Scale.normalX(5);x=map.Scale.normalX(3);var X=Math.min(map.Scale.normalX(250),map.Scale.bBox.width/7);for(ea=
0;ea<u;ea++){var ja=map.Scale.normalY(k);for(H=0;H<d;H++){u>1&&ea===0&&!G&&map.szTextGridStyle.match(/background/)&&map.szTextGridStyle.match(/alternate/);var da=map.Dom.newText(T,0,ja,"font-family:arial;font-size:"+map.Scale.normalY(k)+"px;fill:"+map.szInfoBodyColor,l[H+ea*d]);map.Dom.wrapText(da,X);M[H][ea]=da;P[H]=da;u>1&&ea===0&&!G&&(map.szTextGridStyle.match(/firstsmall/)&&da.style.setProperty("font-size",String(map.Scale.normalY(k*.9))+"px",""),map.szTextGridStyle.match(/firstitalic/)&&da.style.setProperty("font-style",
"italic",""),map.szTextGridStyle.match(/firstgray/)&&da.style.setProperty("fill","#888888",""));if(v&&v[H+ea*d])try{var sa=__getStyleArray(v[H+ea*d]),Aa;for(Aa in sa)da.style.setProperty(Aa,sa[Aa],"")}catch(Va){}da.setAttribute("transform","matrix(1 0 0 1 "+qa+" "+x+")");da.nodeName!="a"&&da.style.setProperty("pointer-events","none","")}ja=map.Dom.getBox(T).width;if(map.szTextGridStyle.match(/firstright/)&&ea===0)for(H=0;H<d;H++)P[H].setAttribute("transform","matrix(1 0 0 1 "+(qa+ja)+" "+x+")"),P[H].style.setProperty("text-anchor",
"end","");qa=ja+map.Scale.normalX(k)+map.Scale.normalX(5);if(ea===0)var V=qa}l=map.Scale.normalY(k);for(H=0;H<d;H++){v=map.Scale.normalY(k);for(var ea=0;ea<u;ea++)v=Math.max(v,map.Dom.getBox(M[H][ea]).height);for(ea=0;ea<u;ea++)sa=getMatrix(M[H][ea]),sa[5]+=l,setMatrix(M[H][ea],sa);l+=v+map.Scale.normalY(2)}u=map.Dom.getBox(T);for(H=0;H<d;H++)g[H]&&(map.szTextGridStyle.match(/full/)?g[H].setAttributeNS(null,"width",u.width+map.Scale.normalX(k/2)):g[H].setAttributeNS(null,"width",V-map.Scale.normalX(5)));
(V=map.SVGDocument.getElementById("TextLinesBgPattern:antizoomandpan"))&&V.setAttributeNS(null,"patternTransform","matrix(1 0 0 1 0 "+String(x-map.Scale.normalY(k-1))+")");return e};ixMap.Toolbar=function(d){this.init(d)};ixMap.Toolbar.prototype=new Map;ixMap.Toolbar.prototype.init=function(d){d=map.SVGDocument.getElementById("legend:toolbar");var e=map.SVGDocument.getElementById("toolbar");d&&e&&(e.setAttributeNS(null,"id","toolbar:movable"),map.Dom.clearGroup(d),d.appendChild(e),d.setAttributeNS(null,
"cursor","pointer"),this.refresh())};ixMap.Toolbar.prototype.refresh=function(d){if((d=map.SVGDocument.getElementById("legend:toolbar"))&&!(map.Legend&&map.Legend.objNode&&map.Legend.objNode.fu.isContained(d))){var e=map.Scale.normalX(map.nMapBorderWidth);d.fu=new Methods(d);var g=d.fu.getPosition(),l=d.getAttributeNS(szMapNs,"position");l.match(/NONE/)&&d.style.setProperty("display","none","");l.match(/INMAP/)&&(l.match(/RIGHT/)?(l=d.fu.getBox(),d.fu.setPosition(map.Scale.mapPosition.x+map.Scale.bBox.width-
e-map.Scale.normalX(10)-l.width,g.y+e)):d.fu.setPosition(map.Scale.mapPosition.x+map.Scale.normalX(6)+e,g.y+e))}};ixMap.Legend=function(d){d=d?d.target.ownerDocument:map.SVGDocument;var e=d.getElementById("legend:group");if(!e||typeof e=="undefined")return null;this.fInitializing=!0;this.lastItemObjectA=[];this.objNode=e;this.objNode.fu=new Methods(this.objNode);d=d.getElementById("legend_body");try{map.Dictionary.applyToNode(d)}catch(g){}this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity",
"0","");map.fAllIncluded||map.fPDFEmbed?this.init():setTimeout("map.Legend.init()",500)};ixMap.Legend.prototype=new Map;ixMap.Legend.prototype.init=function(d){if(this.blockRecursion!==!0){var e=map.Scale.mapPosition.x?map.Scale.normalY(10):map.Scale.normalY(60),g=d?d.target.ownerDocument:map.SVGDocument,l=g.getElementById("legend:group");if(!l)return this.fInitializing=!1;this.objNode=l;this.objNode.fu=new Methods(this.objNode);var u=g.getElementById("legend_title");g.getElementById("legend_onoff_bg:sizeable");
var k=g.getElementById("legend_body"),v=g.getElementById("legend:toolbar"),x=g.getElementById("legend_bg"),H=g.getElementById("legend_body_bg"),G=g.getElementById("legend_body_header"),P=g.getElementById("legend_body_footer"),M=g.getElementById("legend_body:frame"),T=g.getElementById("legend:off:legend_body"),qa=g.getElementById("legend_body:workspace:movabley");try{var X=map.Dom.getBox(qa?qa:k)}catch(V){this.fHidden||(this.show(),setTimeout("map.Legend.init()",10));this.fInitializing=!1;return}var ja=
1E5,da=1E5,sa=map.SVGDocument.getElementById("legend:param");sa&&(ja=Number(sa.getAttributeNS(szMapNs,"maxwidth")),da=Number(sa.getAttributeNS(szMapNs,"maxheight")),ja=ja?map.Scale.normalX(ja):1E6,da=da?map.Scale.normalY(da):1E6);(sa=map.SVGDocument.getElementById("test:markerrect"))&&sa.parentNode.removeChild(sa);this.fInitializing&&(this.blockRecursion=!0,this.checkGroupCollapse(null),this.blockRecursion=!1);try{X=map.Dom.getBox(qa?qa:k)}catch(V){X=new box(0,0,map.Scale.normalX(150),map.Scale.normalX(300))}var Aa=
J(d,u);sa=J(d,G);qa=J(d,P);v&&v.parentNode==k&&(v.fu=new Methods(v),v=v.fu.getBox(),v.y<=0&&v.width>0&&v.width<1E5&&(sa.y+=v.y+v.height,sa.width=Math.max(sa.width,v.width),G&&(G.fu=new Methods(G),G.fu.setPosition(sa.x,sa.y))));if(sa.y||sa.height)M.fu=new Methods(M),M.fu.setPosition(M.fu.getPosition().x,sa.y+sa.height);X.height+=map.Scale.normalY(0);(v=map.SVGDocument.getElementById("legend:show:button"))&&v.style.setProperty("display","none","");k&&H&&(map.Scale.legendWidth=Math.max(Aa.x+Aa.width+
map.Scale.normalX(10),Math.max(X.x+X.width,Math.max(sa.x+sa.width,qa.x+qa.width)))+map.Scale.normalX(20),map.Scale.legendWidth=Math.min(map.Scale.legendWidth,ja),ja=this.objNode.fu.getPosition(),ja.x<map.Scale.mapPosition.x&&map.Scale.viewBox.width-map.Scale.bBox.width>0?(map.Scale.legendWidth=map.Scale.mapPosition.x-map.Scale.normalX(2),da=1E5,this.fInMap=!1,map.fLegendToggleButtons&&(ja=Number(H.getAttributeNS(null,"y")),H.setAttributeNS(null,"y",ja+map.Scale.normalX(-100)),map.SVGDocument.getElementById("legend:hide:button")||
(ja=new Ua(l,"legend:hide","BUTTON","#expand_left_button","map.Api.extendMap()","","expand map"),ja.nodeObj.style.setProperty("opacity","0.9",""),ja.scale(1.8,1.8),ja.setPosition(map.Scale.legendWidth-map.Scale.normalX(6),map.Scale.mapPosition.y+map.Scale.normalY(8))),map.SVGDocument.getElementById("legend:show:button")||(ja=new Ua(l.parentNode,"legend:show","BUTTON","#expand_right_button","map.Api.normalMap()","","show legend"),l.parentNode.insertBefore(ja.nodeObj,l.parentNode.firstChild),ja.scale(1.8,
1.8),ja.nodeObj.style.setProperty("opacity","0.8",""),ja.nodeObj.style.setProperty("display","none",""),map.fMapBorder3D&&map.SVGDocument.getElementById(map.szShadowFilterId)&&ja.nodeObj.style.setProperty("filter","url(#"+map.szShadowFilterId+")",""),ja.setPosition(map.Scale.normalX(9),map.Scale.mapOffset.y+map.Scale.normalY(14))))):ja.x>=map.Scale.mapPosition.x+map.Scale.bBox.width?(map.Scale.legendWidth=map.Scale.viewBox.width-map.Scale.mapPosition.x-map.Scale.bBox.width-map.Scale.normalX(8),da=
1E5,this.fInMap=!1):(this.objNode.fu.setPosition(map.Scale.normalX(8+map.nMapBorderWidth),map.Scale.normalY(map.nMapBorderWidth)),da+=qa.height,G&&G.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),T&&T.setAttributeNS(null,"onmousedown","map.Legend.move(evt)"),this.fInMap=!0),map.Scale.legendHeight=Math.min(X.y+X.height+sa.y+sa.height+qa.height+map.Scale.normalY(6),Math.min(da,map.Scale.normalY(map.Scale.getEmbedHeight()/map.Scale.getEmbedScale())-e)),H.setAttributeNS(null,"width",map.Scale.legendWidth),
H.setAttributeNS(null,"height",map.Scale.legendHeight-Number(H.getAttributeNS(null,"y"))+map.Scale.normalY(5)),H.setAttributeNS(null,"rx",map.Scale.normalX(2)),H.setAttributeNS(null,"ry",map.Scale.normalX(2)),this.fInMap&&(map.fObjectPseudoShadow&&!this.shadowNode&&(l=(e=H.style.getPropertyValue("opacity"))&&e.length?Number(e):1,e=H.style.getPropertyValue("fill-opacity"),e=l*(e&&e.length?Number(e):1),e=e==1?e*.5:e*.2,this.shadowNode=map.Dom.newShape("rect",k,map.Scale.normalX(3),map.Scale.normalY(-19),
map.Scale.normalX(10),map.Scale.normalY(10),"fill:#444444;stroke:#888888;opacity:"+e+";"),this.shadowNode=k.insertBefore(this.shadowNode,H)),this.shadowNode.setAttributeNS(null,"width",map.Scale.legendWidth),this.shadowNode.setAttributeNS(null,"height",map.Scale.legendHeight-Number(H.getAttributeNS(null,"y"))+map.Scale.normalY(5)),this.shadowNode.setAttributeNS(null,"rx",map.Scale.normalX(5)),this.shadowNode.setAttributeNS(null,"ry",map.Scale.normalX(5))),H.setAttributeNS(szMapNs,"menu","legendmenu"));
k&&x&&x.setAttributeNS(null,"width",X.x+X.width-map.Scale.normalY(15));k&&T&&map.fInitLegendOff&&(k.style.setProperty("display","none",""),T.style.setProperty("display","none",""));if(M)if(k=map.Dom.setClipRect(M,new box(0,0,1,1)),x=map.Scale.legendHeight-sa.height-qa.height,X.height<=x?(k.setAttributeNS(null,"width",map.Scale.legendWidth),k.setAttributeNS(null,"height",X.y+X.height+map.Scale.normalY(10))):(k.setAttributeNS(null,"width",map.Scale.legendWidth),k.setAttributeNS(null,"height",x)),P&&
(P.fu=new Methods(P),P.fu.setPosition(0,map.Scale.legendHeight-qa.height-map.Scale.normalY(2)),map.Dom.setClipRect(P,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),map.Scale.viewBox.height))),G&&map.Dom.setClipRect(G,new box(0,0,map.Scale.legendWidth-map.Scale.normalX(1),x)),u&&map.Dom.setClipRect(u,new box(map.Scale.normalX(-20),map.Scale.normalY(-20),map.Scale.legendWidth-map.Scale.normalX(0),x)),this.scrollObj)u=new box(k.getAttributeNS(null,"x"),k.getAttributeNS(null,"y"),k.getAttributeNS(null,
"width"),k.getAttributeNS(null,"height")),this.scrollObj.setWidth(u.width/map.Scale.normalX(1)),this.scrollObj.setHeight(u.height/map.Scale.normalY(1)),this.scrollObj.reformat(d);else if(G=g.getElementById("legend_body:workspace:movabley"))u=new box(k.getAttributeNS(null,"x"),k.getAttributeNS(null,"y"),k.getAttributeNS(null,"width"),k.getAttributeNS(null,"height")),this.scrollObj=new p(d,null,null,u.width/map.Scale.normalX(1),u.height/map.Scale.normalY(1),10),this.scrollObj.workspaceNode=G,this.scrollObj.cliprectNode=
k,this.scrollObj&&this.scrollObj.reformat(d);map.fClipMapToLegend&&(d=g.getElementById("mapcliprect"))&&(g=map.Dom.getBox(d),g=g.x+g.width,u=map.Scale.normalX(5),d.setAttributeNS(null,"x",map.Scale.legendWidth+u),d.setAttributeNS(null,"width",g-map.Scale.legendWidth-u));this.fInitializing=!1;this.objNode.parentNode.appendChild(this.objNode);this.fHidden||this.show();return!0}};ixMap.Legend.prototype.move=function(d){map.mouseObject=new ya(d,this.objNode)};ixMap.Legend.prototype.reformat=function(d){this.scrollObj&&
this.scrollObj.reformat(d)};ixMap.Legend.prototype.hide=function(d){this.objNode.style.setProperty("display","none","");this.fHidden=!0;(d=map.SVGDocument.getElementById("legend:show:button"))&&d.style.setProperty("display","inline","")};ixMap.Legend.prototype.show=function(d){this.objNode.style.setProperty("display","inline","");this.objNode.style.setProperty("opacity","1","");this.fHidden=!1;(d=map.SVGDocument.getElementById("legend:show:button"))&&d.style.setProperty("display","none","")};ixMap.Legend.prototype.getPosition=
function(d){return(d=(d?d.target.ownerDocument:map.SVGDocument).getElementById("legend:group"))?(d=getMatrix(d),new point(d[4],d[5])):new point(0,0)};ixMap.Legend.prototype.checkGroupCollapse=function(d,e){var g=d?d.target.ownerDocument:map.SVGDocument;e==null&&(e=g.getElementById("legend_body:workspace:movabley"));if(e&&e.nodeType==1){e=e.childNodes;for(var l=0;l<e.length;l++)if(e.item(l).nodeType==1){var u=e.item(l).getAttributeNS(szMapNs,"mode");u&&u.match(/HIDDEN/)&&(u=e.item(l).getAttributeNS(null,
"id").split(":"),u[0]=="legend"&&u[1]=="item"&&(u=g.getElementById("legend:collapse:"+u[2]),this.legendMouseClick(d,u)));this.checkGroupCollapse(d,e.item(l))}}};ixMap.Legend.prototype.legendMouseClick=function(d,e){if(e==null||e.nodeType!=1)return!1;var g=e.getAttributeNS(null,"id");if(g&&!g.match(/legend/))return!1;if(g&&g.match(/this:item/))return this.execLegendMouseClickOnItem(d,e,g),!0;g=g.split(":");for(var l=3;l<g.length;l++)g[2]+=":"+g[l];this.execLegendMouseClick(d,e,g[2],g[1])||this.execLegendMouseClickOnTiles(d,
e,g[2],g[1])||(clearThemes(),f(""));g[2]&&!g[2].match(/:label/)&&map.Layer.isScaleDependentLayerOn(g[2]+":label")&&this.execLegendMouseClick(d,e,g[2]+":label",g[1]);return!0};ixMap.Legend.prototype.execLegendMouseClick=function(d,e,g,l,u){if(g==null||l==null)return!1;if(l=="mapzoom"&&!g.match(/label/))return map.Zoom.doZoomMap(g,"byfactor"),!0;if(l=="textscale"&&!g.match(/label/))return map.Layer.changeLabelScaling(null,g,"byfactor"),!0;if(l=="backwards"&&!g.match(/label/))return map.zoomAndPanHistory.backwards(),
!0;if(l=="activatetool"&&!g.match(/label/))return f(g),!0;var k=map.Dom.getAttributeByNodeOrParents(e,szMapNs,"classname");k.match(/legendgroup/)&&(k=null);switch(l){case "suboff":l="off";case "off":u&&u.length?map.Layer.switchLayerByCSS(d,g,k,"none"):g.match(/'/)?map.Layer.switchLayer(d,g,k,!1):executeWithMessage(()=>map.Layer.switchLayer(null,g,k,!1),"...");e.style.setProperty("display","none","");!g.match(/label/)&&map.fCheckSublayerCollapse&&ia(e,"collapse");break;case "on":u&&u.length?map.Layer.switchLayerByCSS(d,
g,k,"inline"):g.match(/'/)?map.Layer.switchLayer(d,g,k,!0):executeWithMessage(()=>map.Layer.switchLayer(null,g,k,!0),"...");(u=map.SVGDocument.getElementById("legend:off:"+g))&&u.style.setProperty("display","inline","");!g.match(/label/)&&map.fCheckSublayerCollapse&&ia(e,"expand");map.Event.doDefaultZoom(d);break;case "collapse":e.style.setProperty("display","none","");ia(e,"collapse");break;case "expand":(u=map.SVGDocument.getElementById("legend:collapse:"+g))&&u.style.setProperty("display","inline",
"");ia(e,"expand");break;case "setactive":activateTheme(g);break;case "item":try{this.lastItemObjectA[g].redraw()}catch(v){}}N(g,l);return!0};ixMap.Legend.prototype.execLegendMouseClickOnItem=function(d,e,g){if((d=map.Dom.getAttributeByNodeOrParents(e,szMapNs,"onactivate"))&&d.length){var l=g.split(":"),u=l[l.length-1];switch(l[1]){case "off":e.style.setProperty("display","none","");try{this.lastItemObjectA[u]&&this.lastItemObjectA[u].remove()}catch(k){}this.lastItemObjectA[u]=null;break;case "on":if(!this.lastItemObjectA[u]){g=
"legend:off:"+g.substr(10,g.length-10);(e=map.SVGDocument.getElementById(g))&&e.style.setProperty("display","inline","");try{this.lastItemObjectA[u]=eval(d),this.lastItemObjectA[u]&&(this.lastItemObjectA[u].onremove="map.Legend.setLegendCheckBox(null,'"+g+"','unchecked');map.Legend.lastItemObjectA['"+u+"']=null;deactivateTheme('"+u+"')",this.lastItemObjectA[u].szItem=u)}catch(k){alert("ERROR: "+k.description+" \nIN: "+d)}}}}return!0};ixMap.Legend.prototype.execLegendMouseClickOnTiles=function(d,e,
g,l){var u=!1;if(g&&map.Tiles&&map.Tiles.nCount>0)for(var k=map.Tiles.getTileNodeIds(g),v=0;v<k.length;v++)this.execLegendMouseClick(d,e,k[v],l)&&(u=!0);u||(k=map.Dom.getAttributeByNodeOrParents(e,szMapNs,"classname"))&&k.length&&(u=this.execLegendMouseClick(d,e,g,l,k));return u};ixMap.Legend.prototype.setLegendCheckBox=function(d,e,g){if(e.match(/legend/)){d=e.split(":");e="legend:off";for(var l=2;l<d.length;l++)e+=":"+d[l]}(e=map.SVGDocument.getElementById(e))&&e.style.setProperty("display",g==
"checked"?"inline":"none","")};ixMap.Legend.prototype.switchLegendCheckBox=function(d,e,g){d="legend:off:"+e;var l=map.SVGDocument.getElementById(d);l||=map.SVGDocument.getElementById(d+":byclassname");l&&l.style.setProperty("display",g,"");(l=map.SVGDocument.getElementById("legend:setactive:"+e))&&l.style.setProperty("opacity",g=="none"?"0.4":"1","")};map.zoomAndPanHistory=new Ha;map.highLightList=new w;window.InfoContainer=ma;window.MapTool=b;window.TextField=a;window.ScrollArea=p;window.HighLight=
w;window.doDisplayInfo=y;window._removeInfo=function(d){map.Event.onoverShape!=null||map.Event.onoverPopup?setTimeout("_removeInfo()",250):map.SVGPopupGroup.fu.clear()};window._doRemoveFixedInfo=function(d){d.highLightList.unlock();d.highLightList.removeAll()};window.setMapTool=f;window.createTextGrid=t})();(function(){ixMap.Api=function(q){this.executeWithPush=!1;this.map=q};ixMap.Api.prototype=new Map;typeof thisversion=="string"&&map.checkVersion(thisversion)?map.Api=new ixMap.Api(map):alert("ixMap.Api incompatible !");ixMap.Api.prototype.setMapFeatures=function(q){this.map.setFeatures(q)};ixMap.Api.prototype.getMapFeatures=function(){return this.map.getFeatures()};ixMap.Api.prototype.setMapLocal=function(q,K){K=K.split("|");for(var A=0;A<K.length;A++)loadSVGIncludes(null,q,K[A])};ixMap.Api.prototype.setLocalString=
function(q,K){this.map.Dictionary.replace(q,K)};ixMap.Api.prototype.getLocalString=function(q){this.map.Dictionary.getLocalText(q)};ixMap.Api.prototype.setMapLayer=function(q){if(map.fInitializing||map.isLoading())this.map.pushAction(()=>{map.Api.setMapLayer(q)});else{var K=JSON.parse(q),A;for(A in K){K[A].display&&K[A].display=="none"&&this.switchLayer(String(A),!1);if(K[A].off)for(var B in K[A].off)this.switchLayer(A+"::"+K[A].off[B],!1);if(K[A].on){var D=this.getLayer()[A].categoryA;if(D){for(var J in D)this.switchLayer(A+
"::"+J,!1);for(B in K[A].on)K[A].on[B].length&&this.switchLayer(A+"::"+K[A].on[B],!0)}}}}};ixMap.Api.prototype.loadMap=function(q){map.fInitializing||map.isLoading()?this.map.pushAction(()=>{map.Api.loadMap(q)}):this.map.loadMap(q)};ixMap.Api.prototype.setBookmark=function(){try{var q=this.map.Zoom.getBox(),K=this.map.Scale.getMapCoordinate(q.x,q.y),A=this.map.Scale.getMapCoordinate(q.x+q.width,q.y+q.height);this.map.bookmarkList.createBookmark(null,"MinBoundX='"+K.x+"' MaxBoundX='"+A.x+"' MinBoundY='"+
A.y+"' MaxBoundY='"+K.y)}catch(B){alert("Bookmark could not be set !")}};ixMap.Api.prototype.gotoBookmark=function(q){try{this.map.bookmarkList.exec(q)}catch(K){alert("Bookmarks could not be found !")}};ixMap.Api.prototype.clearBookmarks=function(){try{this.map.bookmarkList.clear()}catch(q){alert("Bookmarks could not be deleted !")}};ixMap.Api.prototype.getMapBox=function(){return new box(this.map.Scale.mapPosition.x/this.map.Scale.normalX(1),this.map.Scale.mapPosition.y/this.map.Scale.normalX(1),
this.map.Scale.bBox.width/this.map.Scale.normalX(1),this.map.Scale.bBox.height/this.map.Scale.normalX(1))};ixMap.Api.prototype.resizeCanvas=function(q,K,A,B,D){return this.map.Scale.resizeCanvas(q,K,A,B,D)};ixMap.Api.prototype.doZoomMapToFullExtend=function(){this.map.Zoom.doZoomMapToLayer("maplayer")};ixMap.Api.prototype.doZoomMap=function(q,K){return this.map.Zoom.doZoomMap(q,K)};ixMap.Api.prototype.doPanMap=function(q,K){this.map.Zoom.setNewPan(q,K)};ixMap.Api.prototype.doZoomMapToWidgetRect=function(q){this.map.Zoom.doZoomMapToWidgetRect(q)};
ixMap.Api.prototype.doCenterMapToGeoPosition=function(q,K){this.map.Zoom.doCenterMapToGeoPosition(q,K)};ixMap.Api.prototype.doCenterMapToGeoBounds=function(q,K,A,B){this.map.Zoom.doCenterMapToGeoBounds(q,K,A,B)};ixMap.Api.prototype.doZoomMapToGeoBounds=function(q,K,A,B){this.map.Zoom.doZoomMapToGeoBounds(q,K,A,B)};ixMap.Api.prototype.doSetMapToGeoBounds=function(q,K,A,B){B-K<180&&(this.map.fPreserveMapRatio=!1);this.map.Zoom.doSetMapToGeoBounds(q,K,A,B);setTimeout("this.map.fPreserveMapRatio = true;",
5E3)};ixMap.Api.prototype.doZoomMapToView=function(q,K){this.map.Zoom.doZoomMapToView(q,K)};ixMap.Api.prototype.getCenterOfMapInGeoPosition=function(){return this.map.Zoom.getCenterOfMapInGeoPosition()};ixMap.Api.prototype.getBoundsOfMapInGeoBounds=function(){return this.map.Zoom.getBoundsOfMapInGeoBounds()};ixMap.Api.prototype.getMapScale=function(){return String(Math.floor(map.Scale.nTrueMapScale*map.Scale.nZoomScale))};ixMap.Api.prototype.pendingNewGeoBounds=function(){return this.map.fPendingNewGeoBounds};
ixMap.Api.prototype.setVisibility=function(q){var K=new MapTool(null,"nothing");q=="invisible"?K.hideLayer(null):K.showLayer(null)};ixMap.Api.prototype.hideOverviewMap=function(){};ixMap.Api.prototype.showOverviewMap=function(){};ixMap.Api.prototype.hideNorthArrow=function(){this.map.Viewport.hideNorthArrow()};ixMap.Api.prototype.showNorthArrow=function(){this.map.Viewport.showNorthArrow()};ixMap.Api.prototype.backwards=function(){this.map.zoomAndPanHistory.backwards()};ixMap.Api.prototype.forwards=
function(){this.map.zoomAndPanHistory.forwards()};ixMap.Api.prototype.toggleThemeValues=function(q){try{this.map.Themes.toggleThemeValues(null,q)}catch(K){}};ixMap.Api.prototype.toggleThemeLegends=function(q){try{this.map.Themes.toggleThemeLegends(null,q)}catch(K){}};ixMap.Api.prototype.minimizeThemeLegends=function(){try{this.map.Themes.minimizeThemeLegends(null)}catch(q){}};ixMap.Api.prototype.changeObjectScaling=function(q){this.map.Layer.changeObjectScaling(null,q)};ixMap.Api.prototype.changeLabelScaling=
function(q){this.map.Layer.changeLabelScaling(null,q)};ixMap.Api.prototype.changeLineScaling=function(q){this.map.Layer.changeLineScaling(null,q)};ixMap.Api.prototype.getScaleParam=function(){return this.map.Scale.getScaleParam()};ixMap.Api.prototype.setScaleParam=function(q){this.map.Scale.setScaleParam(q)};ixMap.Api.prototype.changeRotation=function(q){this.map.Scale.changeRotation(null,q)};ixMap.Api.prototype.setRotation=function(q){this.map.Scale.setRotation(null,q)};ixMap.Api.prototype.setMapBackgroundColor=
function(q){this.map.Viewport.setBackgroundColor(q)};ixMap.Api.prototype.togglePanBorder=function(){this.map.Viewport.togglePanBorder()};ixMap.Api.prototype.setPrintScaling=function(){this.map.Event.doPrintZoom()};ixMap.Api.prototype.froozeMap=function(q){this.map.fFroozeDynamicContent=q};ixMap.Api.prototype.freezeMap=function(q){this.map.Event.fFreezeDynamicContent=q};ixMap.Api.prototype.setMapClip=function(q){this.map.Viewport.clipMap(q)};ixMap.Api.prototype.setLayerClip=function(q,K){this.map.Viewport.clipLayer(q,
K)};ixMap.Api.prototype.switchLayer=function(q,K){this.map.Layer.switchLayer(null,q,null,K)};ixMap.Api.prototype.getLayer=function(){return this.map.Layer.listA};ixMap.Api.prototype.getLayerDependency=function(){return this.map.Layer.depListA};ixMap.Api.prototype.getTileInfo=function(){return this.map.Tiles};ixMap.Api.prototype.setMapTool=function(q){setMapTool(q)};ixMap.Api.prototype.getMapTool=function(){return this.map.szMapToolType};ixMap.Api.prototype.isMapTool=function(q){return this.map.szMapToolType==
q?"yes":"no"};ixMap.Api.prototype.isNotMapTool=function(q){return this.isMapTool(q)=="no"?"yes":"no"};ixMap.Api.prototype.switchMapTheme=function(q,K){if(q)if(K=K||(this.map.Layer.isLayerOn(q)?"off":"on"),map.Legend){var A=this.map.this.map.SVGDocument.getElementById("legend:"+K+":this:item:"+q);A?this.map.Legend.execLegendMouseClickOnItem(null,A,"legend:"+K+":this:item:"+q):K=="on"?(this.map.Layer.switchLayer(null,q,null,!0),map.Legend.switchLegendCheckBox(null,q,"inline")):(this.map.Layer.switchLayer(null,
q,null,!1),map.Legend.switchLegendCheckBox(null,q,"none"))}else K=="on"?this.map.Layer.switchLayer(null,q,null,!0):this.map.Layer.switchLayer(null,q,null,!1)};ixMap.Api.prototype.getMapTheme=function(q){var K=q.split("#")[0].split(":")[0];K=="legend"&&(K=q.split(":")[2]);return this.map.Layer.listA[K]};ixMap.Api.prototype.getMapThemeRendererField=function(q){return(q=this.getMapTheme(q))?q.szRenderer:null};ixMap.Api.prototype.getMapThemeDataRow=function(q,K){return(q=map.Themes.getTheme(q))?map.Themes.getDataRow(K,
q):null};ixMap.Api.prototype.getMapThemeItemPosition=function(q,K){return(q=map.Themes.getTheme(q))?(K=q.getItemNodes(K),map.Scale.getScreenPosition(K[0])):null};ixMap.Api.prototype.zoomMapToItem=function(q){this.map.Zoom.doZoomMapToItem(q)};ixMap.Api.prototype.getMapThemeChart=function(q,K,A,B){return(q=map.Themes.getTheme(q))?map.Themes.getChart(K,A,B,q):null};ixMap.Api.prototype.getMapThemeHistogram=function(q,K,A,B){return(K=map.Themes.getTheme(q))?map.Themes.getHistogram(q,A,B,K):null};ixMap.Api.prototype.executeJavascriptWithMessage=
function(q,K,A){q&&typeof(q!="undefined")&&this.map.pushAction(()=>{map.Api.executeWithPush=!0;executeWithMessage(q.replace(/\\/gi,"\\\\").replace(/"/gi,'\\"'),K,A);map.Api.executeWithPush=!1})};ixMap.Api.prototype.displayMessage=function(q,K,A){displayMessage(q,K,A)};ixMap.Api.prototype.flipLegend=function(){var q=getMatrix(this.map.Scale.offsetNode);q[4]=q[4]===0?this.map.Scale.viewBox.width-this.map.Scale.bBox.width:this.map.Scale.viewBox.width-(this.map.Scale.mapPosition.x+this.map.Scale.bBox.width);
setMatrix(this.map.Scale.offsetNode,q);this.map.Scale=new ixMap.Scale;this.map.Viewport=new ixMap.Viewport;var K=this.map.SVGDocument.getElementById("legend:group");K&&(q=getMatrix(K),q[4]===0?(this.map.Dom.getBox(K),q[4]=this.map.Scale.mapPosition.x+this.map.Scale.bBox.width):q[4]=0,setMatrix(K,q),displayScale(null,"bottom"),this.map.Toolbar.refresh())};var Ha=0;ixMap.Api.prototype.extendMap=function(){var q=getMatrix(this.map.Scale.offsetNode);if(Ha=q[4]){q[4]=0;setMatrix(this.map.Scale.offsetNode,
q);this.map.Zoom.doPanMap(Ha/this.map.Scale.normalX(1)/2,0);this.map.Scale.reset();this.map.Viewport.reformat();try{this.map.Legend.hide()}catch(K){}try{this.map.HTMLWindow.ixmaps.htmlgui_onMapResize(window)}catch(K){this.map.Viewport.reformat()}}else this.map.fInitLegendOff=!0};ixMap.Api.prototype.normalMap=function(){if(!(Ha<=0)){var q=getMatrix(this.map.Scale.offsetNode);q[4]=Ha;setMatrix(this.map.Scale.offsetNode,q);this.map.Zoom.doPanMap(-Ha/this.map.Scale.normalX(1)/2,0);this.map.Scale.reset();
this.map.Viewport.reformat();try{this.map.Legend.show()}catch(K){}try{this.map.HTMLWindow.ixmaps.htmlgui_onMapResize(window)}catch(K){this.map.Viewport.reformat()}}};ixMap.Api.prototype.hideLegend=function(){var q=this.map.SVGDocument.getElementById("legend:group");q&&q.style.setProperty("display","none","")};ixMap.Api.prototype.showLegend=function(){var q=this.map.SVGDocument.getElementById("legend:group");q&&q.style.setProperty("display","inline","")};ixMap.Api.prototype.clearAll=function(){this.map.clearAll()};
ixMap.Api.prototype.clearAllCharts=function(){this.map.Themes&&this.map.Themes.removeAllCharts()};ixMap.Api.prototype.clearAllChoropleth=function(){this.map.Themes&&this.map.Themes.removeAllChoropleth()};ixMap.Api.prototype.clearAllOverlays=function(){this.map.SVGPopupGroup&&this.map.SVGToolsGroup.fu.clear();this.map.SVGPopupGroup&&this.map.SVGFixedGroup.fu.clear();this.map.SVGPopupGroup&&this.map.SVGPopupGroup.fu.clear();this.map.SVGPopupGroup&&this.map.SVGMessageGroup.fu.clear();this.map.Themes&&
this.map.Themes.removeAllSelections()};ixMap.Api.prototype.getActualEnvelopeString=function(){return this.map.Zoom.getEnvelopeString()};ixMap.Api.prototype.getActualEnvelopeCoordinates=function(){return this.map.Zoom.getEnvelope()};ixMap.Api.prototype.printActualEnvelope=function(){var q=this.map.Zoom.getBox(),K=this.map.Scale.getMapCoordinate(q.x,q.y);q=this.map.Scale.getMapCoordinate(q.x+q.width,q.y+q.height);var A='<ENVELOPE minx="'+K.x+'"\n';A+='          maxx="'+q.x+'"\n';A+='          miny="'+
q.y+'"\n';A+='          maxy="'+K.y+'" name="Initial_Extent" />';try{htmlgui_prettyPrintXML("Actual zoom Envelope (for SVGGIS XML)",A+"\n")}catch(B){alert(A)}};ixMap.Api.prototype.createTextLink=function(q,K,A){q=this.map.Dom.newGroup(q);if(A.match(/javascript/)){var B=this.map.Dom.constructNode("a",q,{"xlink:href":""});K=this.map.Dom.newText(B,0,this.map.Scale.normalY(this.map.nNormalFontSize*.75),"font-family:arial;font-size:"+this.map.Scale.normalY(this.map.nNormalFontSize*.75)+"px;fill:blue;",
K);B=this.map.Dom.newShape("rect",B,0,0,this.map.Scale.normalX(this.map.nNormalFontSize*10),this.map.Scale.normalY(this.map.nNormalFontSize+3),"fill:#fffff0;stroke:#000000;opacity:0");K&&(B.setAttributeNS(null,"onclick",A),B.setAttributeNS(null,"onmousedown","this.map.Event.stopMouseEvent(evt)"),B.setAttributeNS(null,"onmouseup","this.map.Event.stopMouseEvent(evt)"))}else B=this.map.Dom.constructNode("a",q,{"xlink:href":A}),this.map.Dom.newText(B,0,this.map.Scale.normalY(this.map.nNormalFontSize*
.75),"font-family:arial;font-size:"+this.map.Scale.normalY(this.map.nNormalFontSize*.75)+"px;fill:blue;",K);return q};ixMap.Api.prototype.createInfoBubble=function(q,K,A){if(q&&K){A||=1;var B="bubble:"+String(Math.random()+":movable");K=createTextGrid(this.map.SVGDocument,this.map.SVGFixedGroup,B,K,A);A=new point(this.map.Scale.normalX(-10),this.map.Scale.normalY(15));var D=this.map.Scale.getScreenPosition(q),J=this.map.Scale.clipWidgetObjectToSVG(K,D,A);K.fu.setPosition(J.x,J.y);q=this.map.Dom.getBox(K);
(new Button(K,"xx","BUTTON","#delete_button","this.map.Dom.removeElementById('"+B+"')","","remove")).setPosition(q.width,this.map.Scale.normalY(9));q.width+=this.map.Scale.normalY(9);B=J.y==D.y+A.y?"top":"bottom";B=J.x==D.x+A.x?B+"left":B+"right";this.map.Scale.normalX(15);D=this.map.Scale.normalX(5);J=this.map.Scale.normalX(5);var N=this.map.Scale.normalX(5),ia=A.y,Y=this.map.Scale.normalX(15);A=-A.x-D-J;var W="M"+q.x+","+q.y+" ";W+="m"+J+",0 ";B=="topleft"?(W=W+("l"+D+",0 l")+(A+","+-ia+" l")+(-A+
Y+","+ +ia+" "),W+="l"+(q.width-J*2-D-Y)+",0 "):B=="topright"?(W+="l"+(q.width-J*2-D-Y)+",0 ",W+="l"+(-A+Y)+","+-ia+" ",W+="l"+A+","+ +ia+" ",W+="l"+D+",0 "):W+="l"+(q.width-J*2)+",0 ";W+="q"+J+",0 "+J+","+N+" ";W+="l0,"+(q.height-N*2)+" ";W+="q0,"+N+" "+-J+","+N+" ";B=="bottomright"?(W=W+("l"+-D+",0 l")+(-A+","+ia+" l")+(+A-Y+","+-ia+" "),W+="l"+(-q.width+J*2+D+Y)+",0 "):B=="bottomleft"?(W+="l"+(-q.width+J*2+D+Y)+",0 ",W+="l"+(A-Y)+","+ia+" ",W+="l"+-A+","+-ia+" ",W+="l"+-D+",0 "):W+="l"+(-q.width+
J*2)+",0 ";W+="q"+-J+",0 "+-J+","+-N+" ";W+="l0,"+(-q.height+N*2)+" ";W+="q0,"+-N+" "+J+","+-N+" ";W+="z";q=this.map.Dom.newShape("path",K,W,"fill:white;stroke:grey");K.style.setProperty("filter","url(#DropShadowFilterTools)","");q.parentNode.insertBefore(q,q.parentNode.firstChild)}};ixMap.Api.prototype.createInfoContainer=function(q,K,A,B,D,J){if(q&&K)return J||="fix",A=new point(B,D),B=new point(0,0),J=new InfoContainer(this.map.SVGDocument,this.map.SVGPopupGroup,q+":more"+(J.match(/pointer/)?"":
":movable"),A,B,J),q=createTextGrid(this.map.SVGDocument,J.workspaceNode,q+":more:textgrid",K,2),this.map.Dictionary.applyToNode(q),J.reformat(),this.map.Event.stopMouseEvent(),J};ixMap.Api.prototype.getContextMenuTarget=function(){return this.map.Event.contextMenuObj};ixMap.Api.prototype.getMapToolShape=function(){return mapToolList.toolShape};ixMap.Api.prototype.getShapePoints=function(q){if(q.nodeName=="path"){var K=[],A=null,B=new point(0,0);q=q.getAttributeNS(null,"d");q=q.substr(1,q.length-
2);q.replace("M","M ");q=q.split(" ");for(var D=0;D<q.length;D++)if(q[D]=="l"||q[D]=="L")A=q[D];else if(q[D]&&q[D].length){var J=q[D].split(",");K[K.length]=A=="l"?new point(B.x+Number(J[0]),B.y+Number(J[1])):new point(Number(J[0]),Number(J[1]));B=K[K.length-1]}return K}return null};ixMap.Api.prototype.getShapeCoordinates=function(q){if(q.nodeName=="path"&&(q=this.getShapePoints(q))){var K=[],A;for(A in q){var B=this.map.Scale.getMapPosition(q[A].x,q[A].y);B=this.map.Scale.getMapCoordinate(B.x,B.y);
K[K.length]=new point(B.x,B.y)}return K}return null};ixMap.Api.prototype.getShape=function(q,K,A){A=[];A.push(q);for(var B in A)if(q=this.map.SVGDocument.getElementById(A[B])){for(B=q;!(A=B.getAttribute("style"))&&B.parentNode;)B=B.parentNode;B=q.cloneNode(1E3);B.setAttribute("style",A);B.fu=new Methods(B);q.fu=new Methods(q);q=q.fu.getBox();A=Math.min(4E3/q.width,4E3/q.height);B.fu.setPosition(-q.x*A,-q.y*A-3E3);B.fu.scale(A,A);B.style.setProperty("stroke-width",20/A+"px");K.appendChild(B);break}};
ixMap.Api.prototype.getSurface=function(q){if(q){if(q.parentNode.nodeName=="g"){var K=q.parentNode.getAttributeNS(szMapNs,"area");if(K&&K.length)return Number(K)}if(q=this.getShapePoints(q))return __doGetPolygonSurface(q)}return null};ixMap.Api.prototype.printSurface=function(q){if(q){var K=this.getSurface(q);if(K)return K=this.map.Scale.formatSurfaceString(K)+"  ",this.createInfoBubble(q,Array(K),1)}};ixMap.Api.prototype.displayContextMenuTargetInfo=function(){var q=this.map.Event.contextMenuObj;
q&&displayInfoDelayed(null,q,10)};ixMap.Api.prototype.removeContextMenuTarget=function(){this.map.Event.contextMenuObj&&(this.map.Dom.clearGroup(map.SVGToolsGroup),mapToolList.clear())};ixMap.Api.prototype.removeContextMapTool=function(){var q=this.map.Event.contextMenuObj;if(q)for(;q;q=q.parentNode)if(q.getAttributeNS(null,"id").match(/maptoolnode/)){mapToolList.removeMapTool(q);break}};ixMap.Api.prototype.createContextMenuTargetBuffer=function(){var q=this.map.Event.contextMenuObj;if(q){q=new MapObject(q);
if(q.szId.match(/legend:setactive/)){var K=q.szId.split("legend:setactive:")[1],A=K.split("::")[0];K=K.split("::")[1];var B=this.map.Layer.getLayerObjOfNode(q.objNode)}this.map.Themes.newTheme(A,B.szRenderer,"","type:CHART|BUFFER;align:center;colorscheme:#aa4400;ranges:"+K+";buffersize:1000;opacity:0.3;label:Ripetitore","Buffer (1 km)","Ripetitore")}};ixMap.Api.prototype.createTheme=function(q,K,A,B,D,J,N){return this.map.Themes.newTheme(q,K,A,B,D,J,N)};ixMap.Api.prototype.newMapTheme=function(q,
K,A,B,D,J){if(this.map.Zoom.fExternalZoom)this.map.pushAction(()=>{map.Api.newMapTheme(q,K,A,szStyl,D,J)});else if(this.executeWithPush)this.map.pushAction(()=>{map.Themes.newTheme(q,K,A,B,D,J)});else return this.map.Themes.newTheme(q,K,A,B,D,J)};ixMap.Api.prototype.newMapThemeByObj=function(q,K){return this.map.Themes.newThemeByObj(q,K)};ixMap.Api.prototype.refreshTheme=function(q){this.map.Themes.refreshTheme(q)};ixMap.Api.prototype.redrawTheme=function(q){this.map.Themes.redrawTheme(q)};ixMap.Api.prototype.resetTheme=
function(q){this.map.Themes.resetTheme(q)};ixMap.Api.prototype.changeContextThemeStyle=function(q,K){q=new MapObject(q);this.map.Themes.changeThemeStyle(null,q.szId,K)};ixMap.Api.prototype.changeThemeStyle=function(q,K,A){this.map.Themes.changeThemeStyle(null,q,K,A)};ixMap.Api.prototype.showThemeClass=function(q,K,A){this.map.Themes.showClass(null,q,K,A)};ixMap.Api.prototype.hideThemeClass=function(q,K,A){this.map.Themes.hideClass(null,q,K,A)};ixMap.Api.prototype.markThemeClass=function(q,K,A){this.map.Themes.markClass(null,
q,K,A)};ixMap.Api.prototype.unmarkThemeClass=function(q,K,A){this.map.Themes.unmarkClass(null,q,K,A)};ixMap.Api.prototype.setThemeTimeFrame=function(q,K,A){this.map.Themes.setTimeFrame(null,q,K,A)};ixMap.Api.prototype.filterThemeItems=function(q,K,A){this.map.Themes.filterItems(null,q,K,A)};ixMap.Api.prototype.selectFilterItems=function(q){this.map.Themes.selectFilterItems(null,q)};ixMap.Api.prototype.popupThemeStyleMenu=function(q){this.map.Themes.chartTypeMenu(null,q)};ixMap.Api.prototype.highlightThemeItems=
function(q,K,A){this.map.Themes.doHighlightItems(q,K,A)};ixMap.Api.prototype.clearHighlightThemeItems=function(q){this.map.Themes.clearHighlightItems(null,q)};ixMap.Api.prototype.zoomToTheme=function(q){this.map.Themes.zoomTo(null,q)};ixMap.Api.prototype.nextClipFrame=function(q){this.map.Themes.nextClipFrame(q)};ixMap.Api.prototype.setClipFrame=function(q,K){this.map.Themes.setClipFrame(q,K)};ixMap.Api.prototype.pauseClip=function(q){this.map.Themes.pauseClip(q)};ixMap.Api.prototype.startClip=function(q,
K){this.map.Themes.startClip(q,K)};ixMap.Api.prototype.getTheme=function(q){return this.map.Themes.getTheme(q)};ixMap.Api.prototype.getAllThemes=function(){return this.map.Themes.getAllThemes()};ixMap.Api.prototype.getMapThemeDefinitionStrings=function(){return this.map.Themes.getAllThemeDefinitionStrings()};ixMap.Api.prototype.getMapThemeStyleString=function(q){return this.map.Themes.getMapThemeStyleString(q)};ixMap.Api.prototype.getMapThemeDefinitionObj=function(q){return this.map.Themes.getMapThemeDefinitionObj(q)};
ixMap.Api.prototype.updateAlbersParameters=function(q,K){if(!q||K===void 0)return null;var A=parseFloat(q[0]);const B=parseFloat(q[1]);if(!Number.isFinite(A)||!Number.isFinite(B))return console.warn("updateAlbersParameters: invalid center coordinates",{center:q,zoom:K}),null;if(this.map&&this.map.Scale&&typeof this.map.Scale.calculateAlbersParameters==="function"){q=this.map.Scale.calculateAlbersParameters(A,B,K);if(!q)return null;K=this.map.Scale.lastAlbersParams;A=!1;if(!K)A=!0;else if(Math.abs(q.lat1-
K.lat1)>.5||Math.abs(q.lat2-K.lat2)>.5||Math.abs(q.lat0-K.lat0)>.5||Math.abs(q.lon0-K.lon0)>.5)A=!0;this.map.Scale.lastAlbersParams={lat1:q.lat1,lat2:q.lat2,lat0:q.lat0,lon0:q.lon0};return{params:q,changed:A}}return null};ixMap.Api.prototype.updateLambertParameters=function(q,K){if(!q)return null;let A;if(Array.isArray(q)&&q.length>=2){var B=q[0];A=q[1]}else typeof q==="object"&&q!==null&&(B=q.lat??q.latitude??q[0],A=q.lng??q.lon??q.longitude??q[1]);B=parseFloat(B);A=parseFloat(A);if(!Number.isFinite(B)||
!Number.isFinite(A))return console.warn("updateLambertParameters: invalid center coordinates",{center:q,zoom:K}),null;if(this.map&&this.map.Scale&&typeof this.map.Scale.calculateLambertAzimuthalParameters==="function"){q=this.map.Scale.calculateLambertAzimuthalParameters(B,A);if(!q)return null;K=this.map.Scale.lastLambertParams;B=!1;if(!K)B=!0;else if(Math.abs(q.lat0-K.lat0)>.5||Math.abs(q.lon0-K.lon0)>.5)B=!0;this.map.Scale.lastLambertParams={lat0:q.lat0,lon0:q.lon0};return{params:q,changed:B}}return null};
ixMap.Api.prototype.updateLambertParametersFromBounds=function(q){if(!q||!this.map||!this.map.Scale||typeof this.map.Scale.calculateLambertAzimuthalParametersFromBounds!=="function")return null;let K,A,B,D;if(Array.isArray(q)&&q.length>=4)[K,A,B,D]=q;else if(typeof q==="object"){const J=q.sw||q.southWest||q.SW;q=q.ne||q.northEast||q.NE;J&&q&&(K=J.lat??J.latitude??J[0],A=J.lng??J.lon??J.longitude??J[1],B=q.lat??q.latitude??q[0],D=q.lng??q.lon??q.longitude??q[1])}return this.map.Scale.calculateLambertAzimuthalParametersFromBounds(K,
A,B,D)};ixMap.Api.prototype.updateOrthographicParameters=function(q,K){if(!q)return null;let A;if(Array.isArray(q)&&q.length>=2){var B=q[0];A=q[1]}else typeof q==="object"&&q!==null&&(B=q.lat??q.latitude??q[0],A=q.lng??q.lon??q.longitude??q[1]);B=parseFloat(B);A=parseFloat(A);if(!Number.isFinite(B)||!Number.isFinite(A))return console.warn("updateOrthographicParameters: invalid center coordinates",{center:q,zoom:K}),null;if(K!==void 0&&K<2&&Math.abs(B)<.1&&Math.abs(A)<.1)return console.warn("updateOrthographicParameters: rejecting [0, 0] center at low zoom",
{center:q,zoom:K}),null;if(this.map&&this.map.Scale&&typeof this.map.Scale.calculateOrthographicParameters==="function"){q=this.map.Scale.calculateOrthographicParameters(B,A);if(!q)return null;if(Math.abs(q.lat0)<.1&&Math.abs(q.lon0)<.1&&(B=this.map.Scale.lastOrthographicParams)&&(Math.abs(B.lat0)>.1||Math.abs(B.lon0)>.1))return console.warn("updateOrthographicParameters: rejecting [0, 0] parameters when valid ones exist",{newParams:q,lastParams:B,zoom:K}),null;this.map.Scale.lastOrthographicParams=
{lat0:q.lat0,lon0:q.lon0};return{params:q,changed:!0}}return null};ixMap.Api.prototype.updateOrthographicParametersFromBounds=function(q){if(!q||!this.map||!this.map.Scale||typeof this.map.Scale.calculateOrthographicParametersFromBounds!=="function")return null;let K,A,B,D;if(Array.isArray(q)&&q.length>=4)[K,A,B,D]=q;else if(typeof q==="object"){const J=q.sw||q.southWest||q.SW;q=q.ne||q.northEast||q.NE;J&&q&&(K=J.lat??J.latitude??J[0],A=J.lng??J.lon??J.longitude??J[1],B=q.lat??q.latitude??q[0],D=
q.lng??q.lon??q.longitude??q[1])}return this.map.Scale.calculateOrthographicParametersFromBounds(K,A,B,D)};ixMap.Api.prototype.showTheme=function(q){this.map.Themes.showTheme(null,q)};ixMap.Api.prototype.hideTheme=function(q){this.map.Themes.hideTheme(null,q)};ixMap.Api.prototype.toggleTheme=function(q){this.map.Themes.toggleTheme(null,q)};ixMap.Api.prototype.removeTheme=function(q){this.map.Themes.removeTheme(null,q)};ixMap.Api.prototype.removeAllThemes=function(){this.map.Themes.removeAll()};ixMap.Api.prototype.getThemeId=
function(q){return q?q.szId:null};ixMap.Api.prototype.setThemeExternalData=function(q,K,A){this.map.Themes.setExternalData(q,K,A)};ixMap.Api.prototype.removeElementById=function(q){(q=this.map.SVGDocument.getElementById(q))&&q.parentNode&&q.parentNode.removeChild(q)};ixMap.Api.prototype.getShapeId=function(q){return q=new MapObject(q),q.szId};ixMap.Api.prototype.getShapeLayerObj=function(q){return(q=this.map.Layer.getLayerObjOfNode(q))?q:null};ixMap.Api.prototype.getShapeLayerName=function(q){return(q=
this.map.Layer.getLayerObjOfNode(q))?q.szName:null};ixMap.Api.prototype.getShapeMetadataArray=function(q){var K=this.map.Dom.getAttributeByNodeOrParents(q,szMapNs,"info");q=new MapObject(q);if((q=this.map.Dom.getAttributeByNodeOrParents(q.objNode.parentNode,szMapNs,"info"))&&K&&(q=q.split("|"),K=K.split("|"),q.length&&K.length)){for(var A=[],B=0;B<q.length;B++)A[q[B]]=K[B];return A}return null};ixMap.Api.prototype.highlightItem=function(q){var K=this.map.SVGDocument.getElementById(q);if(q.match(/:chart/))this.map.highLightList.unlock(),
this.map.highLightList.removeAll(),this.map.highLightList.addItem(K,"circle");else{this.map.highLightList.unlock();this.map.highLightList.removeAll();for(q=0;q<A.length;q++)this.map.highLightList.removeItem(A[q]),this.map.highLightList.addItem(A[q],"circle");this.map.highLightList.lock();var A=map.Layer.getLayerItemNodes(K);this.map.highLightList.unlock();this.map.highLightList.removeAll();for(q=0;q<A.length;q++)this.map.highLightList.removeItem(A[q]),this.map.highLightList.addItem(A[q])}this.map.highLightList.lock()};
ixMap.Api.prototype.clearHighlight=function(){this.map.highLightList.unlock();this.map.highLightList.removeAll()};ixMap.Api.prototype.getLayerLegendSVG=function(q){alert(q)};ixMap.Api.prototype.newMapSelection=function(q,K,A,B){map.Selections.newSelection(q,K,A,B)};ixMap.Api.prototype.selectItemByPosition=function(q,K){return map.Selections.selectItemByPosition(q,K)};ixMap.Api.prototype.selectItemByBoundingBox=function(q,K){return map.Selections.selectItemByBoundingBox(q,K)}})();(function(){ixMap.Query=function(A){this.themesA=[];this.infoThemesA=[];this.foundNodesA=[];this.searchRecursion=0;this.map=A};ixMap.Query.prototype=new Map;typeof thisversion=="string"&&map.checkVersion(thisversion)?map.Query=new ixMap.Query(map):alert("ixMap.Query incompatible !");ixMap.Query.prototype.xgetThemes=function(){if(this.themesA.length===0&&this.map.SVGDocument){var A=this.map.SVGDocument.getElementById("mapzoomandpan");if(A){A=A.childNodes;for(var B=0;B<A.length;B++)A.item(B).nodeName==
"g"&&(A.item(B).getAttributeNS(null,"id").match(/label/)||(this.themesA[this.themesA.length]=A.item(B).getAttributeNS(null,"id")))}}return this.themesA};ixMap.Query.prototype.getThemes=function(){if(this.themesA.length===0&&this.map.SVGDocument){var A=this.map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(A)for(var B=0;B<A.length;B++)this.themesA[this.themesA.length]=A.item(B).getAttributeNS(null,"name")}return this.themesA};ixMap.Query.prototype.getThemesWithInfo=function(){if(this.infoThemesA.length===
0&&this.map.SVGDocument){var A=this.map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(A)for(var B=0;B<A.length;B++)A.item(B).getAttributeNS(null,"flag").match(/info/)&&(this.infoThemesA[this.infoThemesA.length]=A.item(B).getAttributeNS(null,"name"))}return this.infoThemesA};ixMap.Query.prototype.getThemesWithSelection=function(){if(this.infoThemesA.length===0&&this.map.SVGDocument){var A=this.map.SVGDocument.getElementsByTagNameNS(szMapNs,"theme");if(A)for(var B=0;B<A.length;B++)A.item(B).getAttributeNS(null,
"selection").length&&(this.infoThemesA[this.infoThemesA.length]=A.item(B).getAttributeNS(null,"name"))}return this.infoThemesA};ixMap.Query.prototype.getActiveTheme=function(){return this.map._activeTheme};ixMap.Query.prototype.getFieldsOfTheme=function(A){var B=[];if(this.map.SVGDocument){var D=this.map.SVGDocument.getElementById(A);if(D==null&&map.Tiles&&map.Tiles.nCount>0)for(var J=0;J<map.Tiles.nCount&&D==null;J++)for(var N=0;N<map.Tiles.nCount&&D==null;N++)D=this.map.SVGDocument.getElementById(A+
"#00"+String(J)+"00"+String(N));D&&(B=D.getAttributeNS(szMapNs,"info").split("|"))}return B};ixMap.Query.prototype.getValuesOfFieldAndTheme=function(A,B,D){var J=[];if(A==null||B==null)return J;D||=1E5;if(this.map.SVGDocument){var N=this.map.SVGDocument.getElementById(A);if(N==null){N=map.Tiles.getTileNodes(A);for(A=0;A<N.length;A++){for(var ia=this.getValuesOfFieldAndTheme(N[A].getAttributeNS(null,"id"),B,D),Y=0;Y<ia.length;Y++)J[J.length]=ia[Y];if((D-=ia.length)<0)break}return J}if(N){Y=N.getAttributeNS(szMapNs,
"info").split("|");ia=-1;for(A=0;A<Y.length;A++)Y[A]==B&&(ia=A);if(ia>=0){Y=N.getElementsByTagName("g");for(A=0;A<Y.length;A++)if(Y.item(A).nodeType==1&&(B=(Y.item(A).getAttributeNS(szMapNs,"info")||"").split("|"),B.length>ia&&B[ia].length&&(J[J.length]=B[ia],J.length>D)))return J;Y=N.getElementsByTagName("path");for(A=0;A<Y.length;A++)if(Y.item(A).nodeType==1&&(B=(Y.item(A).getAttributeNS(szMapNs,"info")||"").split("|"),B.length>ia&&B[ia].length&&(J[J.length]=B[ia],J.length>D)))return J;Y=N.getElementsByTagName("use");
for(A=0;A<Y.length&&!(Y.item(A).nodeType==1&&(B=(Y.item(A).getAttributeNS(szMapNs,"info")||"").split("|"),B.length>ia&&B[ia].length&&(J[J.length]=B[ia],J.length>D)));A++);}}}return J};ixMap.Query.prototype.getSelectionValuesOfTheme=function(A,B){var D=[];if(A==null)return D;B||=1E5;if(this.map.SVGDocument){var J=this.map.SVGDocument.getElementById(A);A=J==null?map.Tiles.getTileNodes(A):Array(J);for(J=0;J<A.length;J++)for(var N=A[J].getElementsByTagName("g"),ia=0;ia<N.length;ia++){var Y=map.Tiles.getMasterId(N.item(ia).getAttributeNS(null,
"id")).split(":");D.push(Y.pop());if(D.length>B)return D}}return D};ixMap.Query.prototype.getValueOfFieldAndItem=function(A,B){if(this.map.SVGDocument){var D=this.map.SVGDocument.getElementById(A);D==null&&(D=map.Tiles.getTileNodes(A)[0]);if(D){var J=D.getAttributeNS(szMapNs,"info");if(!J||J.length===0){var N=D.childNodes;for(A=0;A<N.length;A++)N.item(A).nodeType==1&&(J=N.item(A).getAttributeNS(szMapNs,"info"))}J=J.split("|");if((D=D.parentNode.getAttributeNS(szMapNs,"info"))&&D.length)for(D=D.split("|"),
A=0;A<D.length;A++)if(D[A]==B)return J[A]}}return"?"};ixMap.Query.prototype.getClassnameOfItem=function(A){var B=null;if(this.map.SVGDocument){var D=this.map.SVGDocument.getElementById(A);D==null&&(D=map.Tiles.getTileNodes(A)[0]);if(D){B=D.getAttributeNS(null,"class");if(!B||!B.length){A=D.childNodes();for(var J=0;J<A.length;J++){var N=A.item(J);if(N.nodeType==1&&(B=N.getAttributeNS(null,"class"))&&B.length)break}}if(!B||!B.length)for(A=D.childNodes(),J=0;J<A.length&&(N=A.item(J),N.nodeType!=1||!(B=
N.getAttributeNS(szMapNs,"value"))||!B.length);J++);}}return B};ixMap.Query.prototype.addFoundNode=function(A,B,D,J){var N=map.Tiles.getMasterId(A.parentNode.getAttributeNS(null,"id")),ia=N.split(":")[0];if(ia&&ia.length&&N&&N.length){for(var Y=0;Y<this.foundNodesA.length;Y++)if(this.foundNodesA[Y].id==N&&this.foundNodesA[Y].feature==B&&this.foundNodesA[Y].item==D)return;this.foundNodesA[this.foundNodesA.length]={node:A,id:N,theme:ia,feature:B,item:D,itemA:J}}};ixMap.Query.prototype.searchItem=function(A,
B,D){this.foundNodesA.length=0;if(A.length===0)return this.foundNodesA;this.szQuery=A;var J=A.toLowerCase(),N=A.toUpperCase(),ia=A.substr(0,1).toUpperCase()+A.substr(1,A.length-1).toLowerCase();J=ia!=A?[A,ia,J,N]:[A,J];this.szThemesA=D.split("|");N=[];ia=map.Scale.canvasNode.getElementsByTagName("path");for(D=0;D<ia.length;D++)N[N.length]=ia.item(D);ia=map.Scale.canvasNode.getElementsByTagName("use");for(D=0;D<ia.length;D++)N[N.length]=ia.item(D);for(D=0;D<N.length;D++)if(N[D].nodeType==1){var Y=
!1;if(this.szThemesA[0]=="all")Y=!0;else if((ia=map.Tiles.getMasterId(N[D].parentNode.getAttributeNS(null,"id")))&&ia.length!==0){ia=ia.split(":")[0];for(var W=0;W<this.szThemesA.length;W++)ia==this.szThemesA[W]&&(Y=!0)}if(Y){ia=N[D].getAttributeNS(szMapNs,"info")||N[D].getAttributeNS(szMapNs,"tooltip");if(ia==null||ia.length===0)ia=N[D].parentNode.getAttributeNS(szMapNs,"info")||N[D].parentNode.getAttributeNS(szMapNs,"tooltip");Y=ia.split("|");if(A=="*")this.addFoundNode(N[D],"*","*",Y);else for(W=
0;W<Y.length;W++)if(Y[W].length&&this.isEqualA(J,B,Y[W])){var S=map.Dom.getAttributeByNodeOrParents(N[D].parentNode,szMapNs,"info");S=S.split("|");ia=map.Tiles.getMasterId(N[D].parentNode.getAttributeNS(null,"id"));ia.split(":");this.addFoundNode(N[D],S[W],Y[W],Y)}}}return this.foundNodesA};ixMap.Query.prototype.isEqualA=function(A,B,D){for(var J=0;J<A.length;J++)if(this.isEqual(A[J],B,D))return!0;return!1};ixMap.Query.prototype.isEqual=function(A,B,D){switch(B){case "any":return D.indexOf(A)>=0;
case "begin":return D.indexOf(A)===0;case "whole":return D==A}return!1};ixMap.Query.prototype.searchItemAdvanced=function(A,B){var D;this.searchRecursion===0&&(this.foundNodesA.length=0,this.szThemesA=Array(B));if(A.length===0)return this.foundNodesA;this.szQuery=A;var J=[],N=A.split(" ");J[J.length]="";for(D=0;D<N.length;D++)N[D].length&&("< == > <= <> >= and or like".indexOf(N[D])!=-1?(J[J.length]=N[D],J[J.length]=""):(J[J.length-1].length&&(J[J.length-1]+=" "),J[J.length-1]+=N[D]));if(J.length<
3)return this.foundNodesA;for(D=1;D<J.length;D+=2)if("< == > <= <> >= and or like".indexOf(J[D])==-1)return alert(J[D]+" is not an operator"),this.foundNodesA;N=new Ha;N.newPart();for(D=0;D<J.length;D+=4)switch(N.actPart.addCondition(J[D],J[D+1],J[D+2]),J[D+3]){case "and":break;case "or":N.newPart();break;default:D=1E4}if(this.map.SVGDocument){var ia=this.map.SVGDocument.getElementById(B);if(ia==null){D=map.Tiles.getTileNodes(B);this.searchRecursion++;for(N=0;N<D.length;N++)this.searchItemAdvanced(A,
D[N].getAttributeNS(null,"id"));this.searchRecursion=0;return this.foundNodesA}if(ia){A=ia.getAttributeNS(szMapNs,"info").split("|");for(D=0;D<A.length;D++)A[A[D]]=D;J=null;(B=ia.getElementsByTagName("path"))&&B.length&&(J=B.item(0).getAttributeNS(szMapNs,"info"));if(J==null||J.length===0)B=ia.getElementsByTagName("use");B&&B.length&&(J=B.item(0).getAttributeNS(szMapNs,"info"));if(J==null||J.length===0)B=ia.getElementsByTagName("g");for(D=0;D<B.length;D++)if(B.item(D).nodeType==1){J=B.item(D).getAttributeNS(szMapNs,
"info").split("|");ia=N.partA.length;for(var Y=0;Y<ia;Y++){for(var W=!0,S=N.partA[Y].conditionA.length,ma=0;ma<S;ma++){var ya=A[N.partA[Y].conditionA[ma].szTopic];switch(N.partA[Y].conditionA[ma].szOperator){case "<":W=Number(J[ya])<N.partA[Y].conditionA[ma].szValue;break;case "==":W=J[ya]==N.partA[Y].conditionA[ma].szValue;break;case ">":W=Number(J[ya])>N.partA[Y].conditionA[ma].szValue;break;case "<=":W=Number(J[ya])<=N.partA[Y].conditionA[ma].szValue;break;case "<>":W=Number(J[ya])!=N.partA[Y].conditionA[ma].szValue;
break;case ">=":W=Number(J[ya])>=N.partA[Y].conditionA[ma].szValue}if(W===!1)break}W&&(ya=N.partA[0].conditionA[0].szTopic,this.addFoundNode(B.item(D),ya,null,J))}}}}return this.foundNodesA};ixMap.Query.prototype.searchItemByAttribute=function(A,B){this.foundNodesA.length=0;for(var D=[],J=map.SVGRootElement.getElementsByTagName("path"),N=0;N<J.length;N++)D[D.length]=J.item(N);J=map.SVGRootElement.getElementsByTagName("use");for(N=0;N<J.length;N++)D[D.length]=J.item(N);J=map.SVGRootElement.getElementsByTagName("g");
for(N=0;N<J.length;N++)D[D.length]=J.item(N);for(N=0;N<D.length;N++){if(D[N].getAttributeNS(null,A)==B){J=D[N].getAttributeNS(szMapNs,"info");if(J==null||J.length===0)J=D[N].parentNode.getAttributeNS(szMapNs,"info");J=J.split("|");this.addFoundNode(D[N],null,null,J)}if(D[N].getAttributeNS(szMapNs,A)==B){J=D[N].getAttributeNS(szMapNs,"info");if(J==null||J.length===0)J=D[N].parentNode.getAttributeNS(szMapNs,"info");J=J.split("|");this.addFoundNode(D[N],null,null,J)}}return this.foundNodesA};ixMap.Query.prototype.gotoFoundItem=
function(A,B,D){map.Query&&(B=="0"?map.Query.execGotoFoundItem(A,B,D):(displayMessage("please wait ...",500),setTimeout("map.Query.execGotoFoundItem("+A+",'"+B+"',"+D+")",100)))};ixMap.Query.prototype.execGotoFoundItem=function(A,B,D){map.SVGPopupGroup&&map.SVGPopupGroup.fu.clear();if(B==null||B=="undefined")B="3";if(A<0)if(B=="select")map.Selections.newSelection(this.szThemesA[0],this.foundNodesA,"type:queryresult",this.szQuery);else if(B=="zoomto"){if(this.map.SVGDocument.getElementById("mapzoomandpan")){B=
new point(1E5,1E5);var J=new point(-1E5,-1E5);for(A=0;A<this.foundNodesA.length;A++){D=map.Dom.getBox(this.foundNodesA[A].node);if(D.width===0||D.height===0){var N=getMatrix(this.foundNodesA[A].node);D.x+=N[4];D.y+=N[5];D.width=map.Scale.viewBox.width/20;D.height=map.Scale.viewBox.height/20;D.x-=D.width/2;D.y-=D.height/2}N=map.Scale.getMapOffset(this.foundNodesA[A].node);D.x+=N.x;D.y+=N.y;B.x=Math.min(B.x,D.x);B.y=Math.min(B.y,D.y);J.x=Math.max(J.x,D.x+D.width);J.y=Math.max(J.y,D.y+D.height)}B=new box(B.x,
B.y,J.x-B.x,J.y-B.y);B.scale(1.2);B=map.Zoom.clipArea(B);map.Zoom.setNewArea(B);this.foundNodesA.length==1&&displayInfoDelayed(null,this.foundNodesA[0].node,1E3)}}else for(clearThemes(),map.highLightList.removeAll(),A=0;A<this.foundNodesA.length;A++){if(!B.match(/info/)||!map.Themes.isNodePartOfAnyTheme(this.foundNodesA[A].node)){D=map.Layer.getLayerItemNodes(this.foundNodesA[A].node);for(N=0;N<D.length;N++)map.highLightList.addItem(D[N]);map.highLightList.startToggle()}B.match(/info/)&&displayInfo(null,
this.foundNodesA[A].node,"add|fix")}else if(A<this.foundNodesA.length){A=this.foundNodesA[A].node;this.map._activeItem=A;this.map._activeTheme=null;clearThemes();map.highLightList.removeAll();if(!map.Themes.isNodePartOfAnyTheme(A)){D=map.Layer.getLayerItemNodes(A);for(N=0;N<D.length;N++)map.highLightList.addItem(D[N]);map.highLightList.startToggle()}if(B=="0"&&map.Scale.nZoomScale==1)displayInfo(null,A);else{D=map.Dom.getBox(A);D=new box(D.x,D.y,D.width,D.height);if(D.width===0||D.height===0)J=map.Zoom.getBox(),
N=getMatrix(A),D.x+=N[4],D.y+=N[5],D.width=Math.min(J.width,map.Scale.bBox.width/10),D.height=Math.min(J.height,map.Scale.bBox.height/10),D.x-=D.width/2,D.y-=D.height/2;N=map.Scale.getMapOffset(A);D.x+=N.x;D.y+=N.y;if(B=="0"){if(map.Zoom.isVisibleBox(D)){displayInfo(null,A);return}J=map.Zoom.getBox();D.scale(Math.min(J.width/D.width,J.height/D.height))}else D.scale(2);D=map.Zoom.clipArea(D);B=="0"?map.Zoom.setNewCenter(D):map.Zoom.setNewArea(D);displayInfoDelayed(null,A,1E3)}}};var Ha=function(){this.partA=
[]};Ha.prototype.newPart=function(){this.partA[this.partA.length]=this.actPart=new q};var q=function(){this.conditionA=[]};q.prototype.addCondition=function(A,B,D){this.conditionA[this.conditionA.length]=new K(A,B,D)};var K=function(A,B,D){this.szTopic=A;this.szOperator=B;this.szValue=D}})();(function(){function Ha(c){c=map.Themes.getMapThemeDefinitionObj(c.szId);for(var b="",f=0;f<W.length;f++){a:{var a=c.style[W[f].style];var p=W[f].style;var m=W[f].type,w=W[f].delimiter;w=w?w:",";if(typeof a!="undefined"&&a!=null)if(m&&typeof m!="undefined")if(m=="array"&&a&&a.length&&typeof a=="object"){a=a.join(w);p=p+":"+a+";";break a}else{if(m=="object"&&a){p=p+":"+JSON.stringify(a)+";";break a}}else{p=p+":"+String(a)+";";break a}p=""}b+=p}return b.replace(/"/gi,'\\"')}function q(c){return typeof c!==
"undefined"&&c!=null}function K(c,b,f){c=Number(c)||0;b=Number(b)||0;return f&&f.match(/pow/)?Math.pow(c,b):f&&f.match(/factor/)?c*b:f&&(f.match(/add/)||f.match(/delta/))?c+b:b}function A(c,b,f){c=c||0;b=b||0;return f&&f.match(/factor/)?b:f&&f.match(/add/)?(c+b)/c:b/c}function B(c,b,f,a,p){this.szName=c;this.coTable=f;this.szSelectionField=a;this.szItemField=p;this.nIndex=b;this.nFieldIndexA=[];this.nField100IndexA=[];this.nFieldSelectionIndex=-1;this.nFieldSelectionIndexA=[];this.nLabelFieldIndex=
this.nValueFieldIndex=this.nFieldItemIndex=-1;this.leadOffset=!1}function D(c,b,f,a,p,m,w){var C;this.fDone=!1;this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nNoData=this.nCount=this.nSum=0;this.szThemes=c||"";this.szThemesA=this.szThemes.split("|");this.checkTheme();this.objThemesA=[];this.szFields=b||"$item$";this.szFieldsA=this.szFields.split("|");this.szField100=f||"";this.szField100A=f?f.split("|"):null;this.nFieldsA=[];this.nFields100A=[];this.nFieldsSelectionA=[];this.nMinA=[];
this.nMaxA=[];this.nSumA=[];this.nMeanA=[];this.nMedianA=[];this.nDeviationA=[];this.nOrigMinA=[];this.nOrigMaxA=[];this.nOrigSumA=[];for(C=0;C<this.szFieldsA.length;C++)this.nMinA[C]=Number.MAX_VALUE,this.nMaxA[C]=-Number.MAX_VALUE,this.nSumA[C]=0,this.nOrigMinA[C]=Number.MAX_VALUE,this.nOrigMaxA[C]=-Number.MAX_VALUE,this.nOrigSumA[C]=0,this.nMedianA[C]=0,this.nMeanA[C]=0;this.nMin100=Number.MAX_VALUE;this.nMax100=-Number.MAX_VALUE;this.nSum100=0;this.nMinSize=Number.MAX_VALUE;this.nMaxSize=-Number.MAX_VALUE;
this.nSumSize=0;this.nMinAlpha=Number.MAX_VALUE;this.nMaxAlpha=-Number.MAX_VALUE;this.nSumAlpha=0;this.nMinX=Number.MAX_VALUE;this.nMaxX=-Number.MAX_VALUE;this.nSumX=0;this.nMinY=Number.MAX_VALUE;this.nMaxY=-Number.MAX_VALUE;this.nSumY=0;this.nDominantDFilter=this.szDominantFilter=null;this.nFilterA=[];this.dbTableA=[];this.dbFieldsA=[];this.dbRecordsA=[];if(p)for(C in this.origColorScheme=[],p)this.origColorScheme[C]=p[C];else this.origColorScheme=null;this.defaultColorScheme=["#008888","#00aaaa",
"#00cccc","#00eeee","#00ffff"];this.szTitle=m?m:c+" ["+b+"]";this.szTitle=map.Dictionary.getLocalText(this.szTitle);this.szTitle=this.szTitle.length>60?this.szTitle.slice(0,50)+" ...":this.szTitle;this.szUnits="";this.szXaxisA=this.szAlphaValueUnits=this.szSizeValueUnits=null;this.szOrigLabelA=this.szLabelA=w;this.szLegendLabelA=[];this.szLegendStyle="";this.evidenceMode="isolate";this.szAggregation="sum";this.nValuesA=[];this.szExactA=this.szRangesA=this.szValuesA=null;this.itemA=[];this.fDataCache=
this.fVisible=!0;this.fEditor=!1;this.fUndefinedValuePossible=this.fNegativeValuePossible=this.fNullIsValue=!0;this.fCheckRecordLength=!1;this.nStringToValue=1;this.nStringToValueA=[];this.szOrigFlag=this.szFlag=a?a:"CHOROPLETH";this.nValueScale=this.nScale=1;this.nRefreshTimeout=0;this.szId="theme"+String(Math.random());this.szShapeType="polygon";if(c=map.Layer.getLayerObj(this.szThemesA[0]))this.szShapeType=c.szType,this.szShapeType=="line"&&this.szOrigFlag.match(/BUFFER/)&&(this.szShapeType+="+buffer");
this.hiddenLayerA=[];this.szFlag.match(/CHART/)||(this.szFlag.match(/PIE/)?this.szOverviewChart="PIE":this.szFlag.match(/DONUT/)&&(this.szOverviewChart="DONUT"));this.szFlag.match(/ZEROISNOTVALUE/)&&(this.fNullIsValue=!1);this.szFlag.match(/ZEROISVALUE/)&&(this.fNullIsValue=!0);this.szFlag.match(/NEGATIVEISNOTVALUE/)&&(this.fNegativeValuePossible=!1);this.szFlag.match(/NEGATIVEISVALUE/)&&(this.fNegativeValuePossible=!0);this.szFlag.match(/UNDEFINEDISVALUE/)&&(this.fUndefinedValuePossible=!0);this.szFlag.match(/UNDEFINEDISNOTVALUE/)&&
(this.fUndefinedValuePossible=!1);this.szFlag.match(/CHECKRECORDLENGTH/)&&(this.fCheckRecordLength=!0);this.szFlag.match(/SUM/)&&(this.szAggregation="sum");this.szFlag.match(/MEAN/)&&(this.szAggregation="mean");this.szFlag.match(/MAX/)&&(this.szAggregation="max");if(this.szFlag.match(/CHART/)){if(this.szFlag.match(/CATEGORICAL/)||this.szFieldsA.length>1)this.fNullIsValue=!0;this.szFlag.match(/BUFFER/)||(this.fShadow=this.fOrigShadow=!0)}this.szFlag.match(/CATEGORICAL/)&&!this.szFlag.match(/AGGREGATE/)&&
(this.fNegativeValuePossible=!1);this.szFlag.match(/CATEGORICAL/)&&!this.szLabelA&&(this.szLabelA=[]);this.fGrayNoMember=this.fSortBeforeDraw=this.fClipCharts=!0;this.nClipTimeout=1E3;this.paintedShapeNodesA=[];this.szChoroplethInfoStyle=map.Themes.szChoroplethInfoStyle;this.nMaxThemeCharts=map.Themes.nMaxThemeCharts;this.nMaxShadowCharts=map.Themes.nMaxShadowCharts;this.nflushPaintShape=map.Themes.nflushPaintShape;this.nflushChartDraw=map.Themes.nflushChartDraw;this.themeNodesPosA=this.szFlag.match(/AGGREGATE|GROUP/)?
[]:map.Themes.themeNodesPosA;this.style={theme:this};this.setProperties=function(z){this.szFields=z.field||z.fields||this.szFields;this.szField100=z.field100||this.szField100;this.szFieldsA=b.split("|");this.szField100A=f?f.split("|"):null;this.style.setProperties(z)};this.style.setProperties=function(z){map.Themes.parseStyle(this.theme,z)}}function J(c,b){return c.y>b.y?1:-1}function N(c){za[c]||(za[c]=new ia(c));return za[c]}function ia(c){typeof c!="string"&&(c="#ffffff");this.mainColor=c;this.lowColor=
ColorScheme.getDerivateColor(c,.7);this.highColor=ColorScheme.getDerivateColor(c,1.3);this.borderColor=ColorScheme.getBorderColor(c);this.textColor=ColorScheme.getTextColor(c)}function Y(c){if(typeof c=="string"&&c.match(/&#x/)){c=c.split("&#x");var b=c[0];for(var f=1;f<c.length;f++){var a=String,p=a.fromCharCode;var m=c[f].substr(0,2);m=parseInt(m,16);b+=p.call(a,m);b+=c[f].substr(3,c[f].length-3)}return b}return c}var W=[{style:"opacity",obj:"nOpacity"},{style:"fillopacity",obj:"fillOpacity"},{style:"autoopacity",
obj:"autoOpacity"},{style:"shadow",obj:"fOrigShadow"},{style:"blur",obj:"nBlur"},{style:"filter",obj:"szFilter"},{style:"dfilter",obj:"nDeltaFilter"},{style:"filterfield",obj:"szFilterField"},{style:"visible",obj:"fVisible"},{style:"dbtable",obj:"coTable"},{style:"dbtableUrl",obj:"coTableUrl"},{style:"dbtableType",obj:"coTableType"},{style:"dbtableExt",obj:"coTableExt"},{style:"dbtableProcess",obj:"coTableProcess"},{style:"dbtableQuery",obj:"coTableQuery"},{style:"datacache",obj:"fDataCache"},{style:"itemfield",
obj:"szItemField"},{style:"lookupfield",obj:"szSelectionField"},{style:"lookuptoupper",obj:"fSelectionFieldToUpper"},{style:"lookupsuffix",obj:"szSelectionFieldSuffix"},{style:"lookupdigits",obj:"nSelectionFieldDigits"},{style:"lookuptonumber",obj:"fSelectionFieldToNumber"},{style:"lookupfield2",obj:"szSelectionField2"},{style:"showdata",obj:"fShowData"},{style:"datafields",obj:"szDataFieldsA",type:"array"},{style:"userdraw",obj:"userDraw"},{style:"child",obj:"fChild"},{style:"crsdatum",obj:"szCRSDatum"},
{style:"crsutmzone",obj:"szCRSUTMZone"},{style:"server",obj:"szServer"},{style:"ranges",obj:"szRangesA",type:"array"},{style:"rangecentervalue",obj:"nRangeCenterValue"},{style:"symbols",obj:"szSymbolsA",type:"array"},{style:"values",obj:"szValuesA",type:"array",delimiter:"|"},{style:"colorvalues",obj:"szColorValuesA",type:"array",delimiter:"|"},{style:"symbolvalues",obj:"szSymbolValuesA",type:"array",delimiter:"|"},{style:"label",obj:"szOrigLabelA",type:"array",delimiter:"|"},{style:"valuemap",obj:"valueMap",
type:"object"},{style:"xaxis",obj:"szXaxisA",type:"array"},{style:"units",obj:"szUnits"},{style:"labelunits",obj:"szLabelUnits"},{style:"titleunits",obj:"szTitleUnits"},{style:"units100",obj:"szUnits100"},{style:"sizevalueunits",obj:"szSizeValueUnits"},{style:"alphavalueunits",obj:"szAlphaValueUnits"},{style:"legendunits",obj:"szLegendUnits"},{style:"weights",obj:"szWeights"},{style:"align",obj:"szAlign"},{style:"offsetx",obj:"nOffsetX"},{style:"offsety",obj:"nOffsetY"},{style:"rotation",obj:"nRotation"},
{style:"refreshtimeout",obj:"nRefreshTimeout"},{style:"normalsizevalue",obj:"nNormalSizeValue"},{style:"normalsizescale",obj:"szNormalSizeScale"},{style:"scale",obj:"nScale"},{style:"rangescale",obj:"nRangeScale"},{style:"sizepow",obj:"nSizePow"},{style:"outlierscale",obj:"nOutlierScale"},{style:"colorfield",obj:"szColorField"},{style:"symbolfield",obj:"szSymbolField"},{style:"valuefield",obj:"szValueField"},{style:"labelfield",obj:"szLabelField"},{style:"sizefield",obj:"szSizeField"},{style:"timefield",
obj:"szTimeField"},{style:"alphafield",obj:"szAlphaField"},{style:"alphafield100",obj:"szAlphaField100"},{style:"xfield",obj:"szXField"},{style:"yfield",obj:"szYField"},{style:"dopacitypow",obj:"nDopacityPow"},{style:"dopacityramp",obj:"szDopacityRamp"},{style:"dopacityscale",obj:"nDopacityScale"},{style:"brightness",obj:"nBrightness"},{style:"buffersize",obj:"nBufferSize"},{style:"bufferstep",obj:"nBufferSizeStep"},{style:"field100min",obj:"nField100Min"},{style:"fractionscale",obj:"nFractionScale"},
{style:"minvalue",obj:"nMinValue"},{style:"maxvalue",obj:"nMaxValue"},{style:"lowvalue",obj:"nLowValue"},{style:"highvalue",obj:"nHighValue"},{style:"textfont",obj:"szTextFont"},{style:"textcolor",obj:"szTextColor"},{style:"textscale",obj:"nTextScale"},{style:"linecolor",obj:"szLineColor"},{style:"linecolor",obj:"szLineColorA",type:"array"},{style:"linewidth",obj:"nLineWidth"},{style:"markersize",obj:"nMarkerSize"},{style:"gapsize",obj:"nGapSize"},{style:"bordercolor",obj:"szBorderColor"},{style:"borderstyle",
obj:"szBorderStyle"},{style:"borderwidth",obj:"szBorderWidth"},{style:"borderradius",obj:"nBorderRadius"},{style:"boxcolor",obj:"szBoxColor"},{style:"boxopacity",obj:"nBoxOpacity"},{style:"boxmargin",obj:"nBoxMargin"},{style:"textplacement",obj:"szTextPlacement"},{style:"infotitle",obj:"szInfoTitle"},{style:"titlefield",obj:"szTitleField"},{style:"snippetfield",obj:"szSnippetField"},{style:"exclude",obj:"szExcludeA",type:"array"},{style:"nodatacolor",obj:"szNoDataColor"},{style:"titleupper",obj:"szTitleUpper"},
{style:"titlelower",obj:"szTitleLower"},{style:"labelupper",obj:"szLabelUpper"},{style:"labellower",obj:"szLabelLower"},{style:"valueupper",obj:"szValueUpper"},{style:"valuelower",obj:"szValueLower"},{style:"glowupper",obj:"szGlowUpper"},{style:"glowlower",obj:"szGlowLower"},{style:"chartupper",obj:"szChartUpper"},{style:"chartlower",obj:"szChartLower"},{style:"layerupper",obj:"szLayerUpper"},{style:"layerlower",obj:"szLayerLower"},{style:"featureupper",obj:"szFeatureUpper"},{style:"featurelower",
obj:"szFeatureLower"},{style:"boxupper",obj:"szBoxUpper"},{style:"boxlower",obj:"szBoxLower"},{style:"shadowupper",obj:"szShadowUpper"},{style:"shadowlower",obj:"szShadowLower"},{style:"declutterupper",obj:"szDeclutterUpper"},{style:"valuescale",obj:"nValueScale"},{style:"valuecolor",obj:"szValueColor"},{style:"minvaluesize",obj:"nValueSizeMin"},{style:"minvaluevalue",obj:"nValueValueMin"},{style:"valuedecimals",obj:"nValueDecimals"},{style:"fadevaluepow",obj:"szFadeValuePow"},{style:"fadenegative",
obj:"nFadeNegative"},{style:"centerpart",obj:"szCenterPart"},{style:"clipframes",obj:"nClipFrames"},{style:"clipframerate",obj:"nClipFrameRate"},{style:"cliplegend",obj:"nClipColorLegend"},{style:"clipparts",obj:"nClipParts"},{style:"minchartsize",obj:"nChartSizeMin"},{style:"maxcharts",obj:"nMaxCharts"},{style:"showparts",obj:"szShowParts"},{style:"gridx",obj:"nGridX"},{style:"gridwidth",obj:"nGridWidth"},{style:"gridmatrix",obj:"nGridMatrix"},{style:"gridwidthpx",obj:"nGridWidthPx"},{style:"gridoffsetx",
obj:"nGridOffsetX"},{style:"gridoffsety",obj:"nGridOffsetY"},{style:"aggregationfield",obj:"szAggregationField"},{style:"aggregationscale",obj:"szAggregationFieldA",type:"array"},{style:"aggregation",obj:"szAggregation"},{style:"minaggregation",obj:"szMinAggregation"},{style:"aggregationupper",obj:"szAggregationUpper"},{style:"aggregationlower",obj:"szAggregationLower"},{style:"clipupper",obj:"szClipUpper"},{style:"cliplower",obj:"szClipLower"},{style:"dominantfilter",obj:"szDominantFilter"},{style:"dominantdfilter",
obj:"nDominantDFilter"},{style:"overviewchart",obj:"szOverviewChart"},{style:"evidence",obj:"evidenceMode"},{style:"markclass",obj:"markedClass"},{style:"markclasses",obj:"markedClassesA",type:"array"},{style:"name",obj:"szName"},{style:"title",obj:"szTitle"},{style:"snippet",obj:"szSnippet"},{style:"splash",obj:"szSplash"},{style:"description",obj:"szDescription"},{style:"tooltip",obj:"szTooltip"}];ixMap.Themes=function(){this.themesA=[];this.themeNodesA=[];this.themeNodesPosA=[];this.themeNodesBoxA=
[];this.themeNodes=0;this.activeBuffer=this.activeTheme=null;this.switchedLayerA=[];this.enableMultiChoropleth=this.enableChartOffset=!1;this.enableSubThemes=!0;this.szChoroplethInfoStyle="histogram|";this.nMaxThemeCharts=1E6;this.nMaxShadowCharts=1E3;this.nflushPaintShape=5E3;this.nflushChartDraw=1E3;this.nColorSchemeMaxHeight=120;this.autoHideInfoTools=this.allwaysShowValues=!1;this.themeDataCacheA=[]};ixMap.Themes.prototype=new Map;if(typeof thisversion=="string"&&map.checkVersion(thisversion)){map.Themes=
new ixMap.Themes;try{map.HTMLWindow&&map.HTMLWindow.ixmaps&&map.HTMLWindow.ixmaps.htmlgui_onInitThemes&&map.HTMLWindow.ixmaps.htmlgui_onInitThemes()}catch(c){}}else alert("ixMap.Themes incompatible !");ixMap.Themes.prototype.addTheme=function(c){this.themesA[this.themesA.length]=c;if(!c.szFlag.match(/selection/i))try{map.HTMLWindow.ixmaps.htmlgui_onNewTheme(c.szId)}catch(b){}};ixMap.Themes.prototype.getThemeCount=function(){return this.themesA.length};ixMap.Themes.prototype.getAllThemes=function(){return this.themesA};
ixMap.Themes.prototype.getThemes=function(){return this.themesA};ixMap.Themes.prototype.isTheme=function(c){for(var b=0;b<this.themesA.length;b++)if(this.themesA[b].szIdStr&&this.themesA[b].szIdStr==c)return this.themesA[b];return!1};ixMap.Themes.prototype.isIdle=function(){for(var c=0;c<this.themesA.length;c++)if(!this.themesA[c].fRealizeDone)return!1;return!0};ixMap.Themes.prototype.isArray=function(c){return Object.prototype.toString.call(c)==="[object Array]"};ixMap.Themes.prototype.isObject=
function(c){return Object.prototype.toString.call(c)==="[object Object]"};ixMap.Themes.prototype.toArray=function(c){if(this.isObject(c)){var b=[],f;for(f in c)b.push(f),b.push(c[f]);return b}return this.isArray(c)?c:String(c).match(/\|/)||String(c).match(/RGB/)?String(c).split("|"):String(c).split(",")};ixMap.Themes.prototype.toString=function(c){return this.isArray(c)?c.join("|"):c};ixMap.Themes.prototype.newTheme=function(c,b,f,a,p,m){var w=a.split("style=");a=w&&w.length>1?__getStyleObj(w[1]):
__getStyleObj(a);a.label=m&&m!="undefined"?m.split("|"):a.label||null;a.szTitle=p;return this.newThemeByObj({layer:c,field:b,field100:f,style:a})};ixMap.Themes.prototype.newThemeByObj=function(c,b){if(map.isIdle()){if(this.newThemeObjA&&this.newThemeObjA.length&&(c&&this.newThemeObjA.push(c),c=this.newThemeObjA.shift()),c){var f=JSON.stringify(c);if(this.isTheme(f)&&c.style.type.match(/TOGGLE/))return this.removeTheme(null,this.isTheme(f).szId),null;var a=null,p=c.style;if(!p)return null;if(this.isArray(p.label)){a=
p.label;var m=p.label.join("|")}else a=(m=p.label)&&m!="undefined"?m.split("|"):null;m=[5,"white","blue"];p.colorscheme&&(m=this.toArray(p.colorscheme));c.layer=this.toString(c.layer);c.field=this.toString(c.field);p.type.match(/\bEXACT\b/)&&!p.type.match(/\bCATEGORICAL\b/)&&(p.type+="|CATEGORICAL");a=new D(c.layer,c.field,c.field100,p.type,m,p.title,a);a.nOrder=this.getThemeCount();a.szIdStr=f;a.origDef=c;this.parseStyle(a,p);this.allwaysShowValues&&(a.szFlag+="|VALUES");a.parent=this;this.addTheme(a);
a.fRealize=!0;a.szFlag.match(/CHOROPLETH||BUFFER/)||a.createChartGroup(map.Layer.objectGroup);map.Event.doDefaultZoom();b&&b.match(/fast|silent|direct/)?map.Themes.execute():executeWithMessage(()=>map.Themes.execute(),"... processing ...");return a}}else c&&(this.newThemeObjA=this.newThemeObjA||[],this.newThemeObjA.push(c)),setTimeout(function(){map.Themes.newThemeByObj()},100)};ixMap.Themes.prototype.parseStyle=function(c,b){if(c&&b){if(q(b.classes)){if(isNaN(Number(c.origColorScheme[0]))){var f=
c.origColorScheme[c.origColorScheme.length-1];c.origColorScheme[1]=c.origColorScheme[0];c.origColorScheme[2]=f}c.origColorScheme[0]=Number(b.classes)}q(b.colorstyle)&&c.origColorScheme[1]=="spectrum"&&(c.origColorScheme[2]=b.colorstyle);q(b.dominantdfilter)&&(c.nDominantDFilter=Number(b.dominantdfilter));q(b.dominantfilter)&&(c.szDominantFilter=String(b.dominantfilter));q(b.filter)&&(c.szFilter=String(b.filter));q(b.filterfield)&&(c.szFilterField=String(b.filterfield));q(b.filtervalue)&&(c.szFilterValue=
String(b.filtervalue));q(b.overviewchart)&&(c.szOverviewChart=b.overviewchart);q(b.evidence)&&(c.evidenceMode=b.evidence);q(b.markclass)&&(c.markedClass=b.markclass,c.markedClasses||(c.markedClasses=[],c.markedClasses[c.markedClass]=!0,c.markedClassesA=[c.markedClass]));q(b.markclasses)&&(c.markedClassesA=this.toArray(b.markclasses),c.markedClasses=[],c.markedClassesA.forEach(function(a,p){a.length&&(c.markedClasses[a]=!0,c.markedClass=a)}));q(b.fillopacity)&&(b.fillopacity=="auto"?(c.autoOpacity=
!0,c.fillOpacity=0):c.fillOpacity=Number(b.fillopacity));q(b.opacity)&&(b.opacity=="auto"?(c.autoOpacity=!0,c.fillOpacity=0):c.nOpacity=Number(b.opacity));q(b.autoopacity)&&(c.autoOpacity=!0,c.fillOpacity=0);q(b.shadow)?c.fShadow=c.fOrigShadow=JSON.parse(b.shadow):c.fShadow=c.fOrigShadow=!1;q(b.maxshadow)&&(c.nMaxShadowCharts=Number(b.maxshadow));q(b.blur)&&(c.nBlur=Number(b.blur));q(b.dbtable)&&(f=b.dbtable.split(" "),c.coTable=f[0],f.length==2&&(c.coTableType="jsonDB",c.coTableUrl=f[1].split("(")[1].split(")")[0]),
f.length==3&&(c.coTableType=f[1],c.coTableUrl=f[2].split("(")[1].split(")")[0]),f.length==4&&(c.coTableType=f[1],c.coTableUrl=f[2].split("(")[1].split(")")[0],c.coTableExt=f[3].split("(")[1].split(")")[0]));q(b.dbtableType)&&(c.coTableType=b.dbtableType);q(b.dbtableUrl)&&(c.coTableUrl=b.dbtableUrl);q(b.dbtableExt)&&(c.coTableExt=b.dbtableExt);q(b.dbtableProcess)&&(c.coTableProcess=b.dbtableProcess);q(b.dbtableQuery)&&(c.coTableQuery=b.dbtableQuery);q(b.lookupfield)&&(c.szSelectionField=c.szItemField=
b.lookupfield);q(b.lookupfield2)&&(c.szSelectionField2=b.lookupfield2);q(b.lookuptoupper)&&(c.fSelectionFieldToUpper=JSON.parse(b.lookuptoupper));q(b.lookupsuffix)&&(c.szSelectionFieldSuffix=b.lookupsuffix);q(b.lookupprefix)&&(c.szSelectionFieldPrefix=b.lookupprefix);q(b.lookupdigits)&&(c.nSelectionFieldDigits=Number(b.lookupdigits));q(b.lookuptonumber)&&(c.fSelectionFieldToNumber=JSON.parse(b.lookuptonumber));q(b.crsutmzone)&&(c.szCRSUTMZone=b.crsutmzone);q(b.crsdatum)&&(c.szCRSDatum=b.crsdatum);
q(b.server)&&(c.szServer=b.server);q(b.itemfield)&&(c.szItemField=b.itemfield);q(b.ranges)&&(c.szRangesA=this.toArray(b.ranges),c.szRanges=this.toString(b.ranges));q(b.symbols)&&(c.szSymbolsA=this.toArray(b.symbols));if(q(b.values)&&(c.szValuesA=this.toArray(b.values),b.type.match(/CATEGORICAL/)&&c.szValuesA.length))for(f=0;f<c.szValuesA.length;f++)c.getStringValueIndex(c.szValuesA[f],"set");q(b.means)&&(c.szMeansA=this.toArray(b.means));q(b.colorvalues)&&(c.szColorValuesA=this.toArray(b.colorvalues));
q(b.symbolvalues)&&(c.szSymbolValuesA=this.toArray(b.symbolvalues));q(b.align)&&(c.szAlign=b.align);q(b.offsetx)&&(c.nOffsetX=Number(b.offsetx)||0);q(b.offsety)&&(c.nOffsetY=Number(b.offsety)||0);q(b.rotation)&&(c.nRotation=Number(b.rotation)||0);q(b.units)&&(c.szUnits=b.units);q(b.units100)&&(c.szUnits100=b.units100);q(b.sizevalueunits)&&(c.szSizeValueUnits=" "+b.sizevalueunits);q(b.alphavalueunits)&&(c.szAlphaValueUnits=" "+b.alphavalueunits);q(b.legendunits)&&(c.szLegendUnits=" "+b.legendunits);
q(b.labelunits)&&(c.szLabelUnits=" "+b.labelunits);q(b.titleunits)&&(c.szTitleUnits=" "+b.titleunits);q(b.xaxis)&&(c.szXaxisA=this.toArray(b.xaxis));q(b.id)&&(c.szId=unescape(b.id));q(b.name)&&(c.szId=c.szName=unescape(b.name));q(b.title)&&(c.szTitle=unescape(b.title));q(b.snippet)&&(c.szSnippet=unescape(b.snippet));q(b.splash)&&(c.szSplash=unescape(b.splash));q(b.description)&&(c.szDescription=unescape(b.description));q(b.tooltip)&&(c.szTooltip=unescape(b.tooltip));q(b.label)&&(c.szLabelA=c.szOrigLabelA=
this.toArray(b.label));q(b.weights)&&(c.szWeightsA=this.toArray(b.weights),c.szWeights=this.toString(b.weights));q(b.weight)&&(c.szWeightsA=[b.weights],c.szWeights=b.weight);q(b.scale)&&(c.nScale=Number(b.scale));q(b.colorfield)&&(c.szColorField=b.colorfield);q(b.symbolfield)&&(c.szSymbolField=b.symbolfield);q(b.valuefield)&&(c.szValueField=b.valuefield);q(b.labelfield)&&(c.szLabelField=b.labelfield);q(b.titlefield)&&(c.szTitleField=b.titlefield);q(b.snippetfield)&&(c.szSnippetField=b.snippetfield);
q(b.sizefield)&&(c.szSizeField=b.sizefield);q(b.timefield)&&(c.szTimeField=b.timefield);q(b.alphafield)&&(c.szAlphaField=b.alphafield);q(b.alphafield100)&&(c.szAlphaField100=b.alphafield100);q(b.xfield)&&(c.szXField=b.xfield);q(b.yfield)&&(c.szYField=b.yfield);q(b.refresh)&&(c.nRefreshTimeout=Number(b.refresh)*1E3);q(b.refreshtimeout)&&(c.nRefreshTimeout=Number(b.refreshtimeout));q(b.buffersize)&&(c.nBufferSize=b.buffersize);q(b.bufferstep)&&(c.nBufferSizeStep=b.bufferstep);q(b.field100min)&&(c.nField100Min=
b.field100min);q(b.fractionscale)&&(c.nFractionScale=b.fractionscale);q(b.minvalue)&&(c.nMinValue=b.minvalue);q(b.maxvalue)&&(c.nMaxValue=b.maxvalue);q(b.lowvalue)&&(c.nLowValue=b.lowvalue);q(b.highvalue)&&(c.nHighValue=b.highvalue);q(b.showdata)&&(c.fShowData=JSON.parse(b.showdata));q(b.datacache)&&(c.fDataCache=JSON.parse(b.datacache));q(b.editor)&&(c.fEditor=JSON.parse(b.editor));q(b.datafields)&&(c.szDataFieldsA=this.toArray(b.datafields));q(b.textcolor)&&(c.szTextColor=b.textcolor);q(b.textfont)&&
(c.szTextFont=b.textfont);q(b.textscale)&&(c.nTextScale=Number(b.textscale));q(b.linecolor)&&(c.szLineColorA=this.toArray(b.linecolor),c.szLineColor=c.szLineColorA[c.szLineColorA.length-1]);q(b.linewidth)&&(c.nLineWidth=b.linewidth);q(b.markersize)&&(c.nMarkerSize=b.markersize);q(b.gapsize)&&(c.nGapSize=b.gapsize);q(b.bordercolor)&&(c.szBorderColor=b.bordercolor);q(b.borderstyle)&&(c.szBorderStyle=b.borderstyle);q(b.borderwidth)&&(c.szBorderWidth=b.borderwidth);q(b.borderradius)&&(c.nBorderRadius=
Number(b.borderradius));q(b.boxcolor)&&(c.szBoxColor=b.boxcolor);q(b.boxopacity)&&(c.nBoxOpacity=b.boxopacity);q(b.boxmargin)&&(c.nBoxMargin=b.boxmargin);q(b.textplacement)&&(c.szTextPlacement=b.textplacement);q(b.infotitle)&&(c.szInfoTitle=b.infotitle);q(b.exclude)&&(c.szExcludeA=this.toArray(b.exclude));q(b.aggregation)&&(c.szAggregation=b.aggregation);q(b.rangecentervalue)&&(c.nRangeCenterValue=Number(b.rangecentervalue));q(b.rangescale)&&(c.nRangeScale=b.rangescale);q(b.normalsizevalue)&&(c.nNormalSizeValue=
b.normalsizevalue);q(b.normalsizescale)&&(c.szNormalSizeScale=b.normalsizescale,c.nNormalSizeScale=ma(c.szNormalSizeScale));q(b.nodatacolor)&&(c.szNoDataColor=S(b.nodatacolor));q(b.boxupper)&&(c.szBoxUpper=b.boxupper,c.nBoxUpper=ma(c.szBoxUpper));q(b.boxlower)&&(c.szBoxLower=b.boxlower,c.nBoxLower=ma(c.szBoxLower));q(b.titleupper)&&(c.szTitleUpper=b.titleupper,c.nTitleUpper=ma(c.szTitleUpper));q(b.titlelower)&&(c.szTitleLower=b.titlelower,c.nTitleLower=ma(c.szTitleLower));q(b.labelupper)&&(c.szLabelUpper=
b.labelupper,c.nLabelUpper=ma(c.szLabelUpper));q(b.labellower)&&(c.szLabelLower=b.labelupper,c.nLabelLower=ma(c.szLabelLower));q(b.valueupper)&&(c.szValueUpper=b.valueupper,c.nValueUpper=ma(c.szValueUpper));q(b.valuesupper)&&(c.szValueUpper=b.valuesupper,c.nValueUpper=ma(c.szValueUpper));q(b.valuelower)&&(c.szValueLower=b.valuelower,c.nValueLower=ma(c.szValueLower));q(b.valueslower)&&(c.szValueLower=b.valueslower,c.nValueLower=ma(c.szValueLower));q(b.glowupper)&&(c.szGlowUpper=b.glowupper,c.nGlowUpper=
ma(c.szGlowUpper));q(b.glowlower)&&(c.szGlowLower=b.glowlower,c.nGlowLower=ma(c.szGlowLower));q(b.chartupper)&&(c.szChartUpper=b.chartupper,c.nChartUpper=ma(c.szChartUpper));q(b.chartlower)&&(c.szChartLower=b.chartlower,c.nChartLower=ma(c.szChartLower));q(b.layerupper)&&(c.szLayerUpper=b.layerupper,c.nLayerUpper=ma(c.szLayerUpper));q(b.layerlower)&&(c.szLayerLower=b.layerlower,c.nLayerLower=ma(c.szLayerLower));q(b.featureupper)&&(c.szFeatureUpper=b.featureupper,c.nFeatureUpper=ma(c.szFeatureUpper));
q(b.featurelower)&&(c.szFeatureLower=b.featurelower,c.nFeatureLower=ma(c.szFeatureLower));q(b.shadowupper)&&(c.szShadowUpper=b.shadowupper,c.nShadowUpper=ma(c.szShadowUpper));q(b.shadowlower)&&(c.szShadowLower=b.shadowlower,c.nShadowLower=ma(c.szShadowLower));q(b.declutterupper)&&(c.szDeclutterUpper=b.declutterupper,c.nDeclutterUpper=ma(c.szDeclutterUpper));q(b.valuecolor)&&(c.szValueColor=b.valuecolor);q(b.valuescale)&&(c.nValueScale=Number(b.valuescale));q(b.clipframes)&&(c.nClipFrames=b.clipframes);
q(b.clipframerate)&&(c.nClipFrameRate=b.clipframerate,c.nClipTimeout=1/Number(b.clipframerate)*1E3);q(b.cliplegend)&&(c.nClipColorLegend=Number(b.cliplegend));q(b.clipvaluesize)&&(c.nValueSizeMin=Number(b.clipvaluesize));q(b.minvaluesize)&&(c.nValueSizeMin=Number(b.minvaluesize));q(b.minvaluevalue)&&(c.nValueValueMin=Number(b.minvaluevalue));q(b.valuedecimals)&&(c.nValueDecimals=b.valuedecimals);q(b.fadevaluepow)&&(c.szFadeValuePow=b.fadevaluepow);q(b.dopacityscale)&&(c.nDopacityScale=b.dopacityscale);
q(b.dopacityramp)&&(c.szDopacityRamp=b.dopacityramp);q(b.dopacitypow)&&(c.nDopacityPow=b.dopacitypow);q(b.fadenegative)&&(c.nFadeNegative=Number(b.fadenegative)||.5);q(b.brightness)&&(c.nBrightness=b.brightness);q(b.clipparts)&&(c.nClipParts=Number(b.clipparts)||0);q(b.minsize)&&(c.nChartSizeMin=Number(b.minsize)||0);q(b.minchartsize)&&(c.nChartSizeMin=Number(b.minchartsize)||0);q(b.maxcharts)&&(c.nMaxCharts=Math.round(Number(b.maxcharts))||0);q(b.clipsize)&&(c.nChartSizeMin=Number(b.clipsize)||0);
q(b.sizepow)&&(c.nSizePow=b.sizepow);q(b.outlierscale)&&(c.nOutlierScale=b.outlierscale);q(b.showparts)&&(c.szShowParts=this.toString(b.showparts),c.szShowPartsA=this.toArray(b.showparts));q(b.gridx)&&(c.nGridX=Number(b.gridx)||1);q(b.gridwidth)&&(String(b.gridwidth).match(/px/)&&(c.nGridWidthPx=parseFloat(b.gridwidth)||50,map.Themes.doChangeThemeStyle(c.szId,"AUTOGRID","add")),c.nGridWidth=Number(b.gridwidth)||0);q(b.gridmatrix)&&(c.nGridMatrix=Number(b.gridmatrix)||20,map.Themes.doChangeThemeStyle(c.szId,
"AUTOGRID","add"));q(b.gridwidthpx)&&(c.nGridWidthPx=Number(b.gridwidthpx)||50,map.Themes.doChangeThemeStyle(c.szId,"AUTOGRID","add"));q(b.gridoffsetx)&&(c.nGridOffsetX=Number(b.gridoffsetx)||0);q(b.gridoffsety)&&(c.nGridOffsetY=Number(b.gridoffsety)||0);q(b.aggregationfield)&&(c.szAggregationField=b.aggregationfield);q(b.aggregationscale)&&(c.szAggregationFieldA=this.toArray(b.aggregationscale));q(b.aggregation)&&(c.szAggregationFieldA=this.toArray(b.aggregation));q(b.minaggregation)&&(c.szMinAggregation=
b.minaggregation,c.nMinAggregation=Number(b.minaggregation)||0);q(b.aggregationupper)&&(c.szAggregationUpper=b.aggregationupper,c.nAggregationUpper=ma(c.szAggregationUpper));q(b.aggregationlower)&&(c.szAggregationLower=b.aggregationlower,c.nAggregationLower=ma(c.szAggregationLower));q(b.clipupper)&&(c.szClipUpper=b.clipupper,c.nClipUpper=ma(c.szClipUpper));q(b.cliplower)&&(c.szClipLower=b.cliplower,c.nClipLower=ma(c.szClipLower));q(b.userdraw)&&(c.userDraw=b.userdraw);q(b.centerpart)&&(c.szCenterPart=
this.toString(b.centerpart));q(b.child)&&(c.fChild=!0);q(b.valuemap)&&(c.valueMap=b.valuemap);q(b.visible)&&(c.fVisible=JSON.parse(b.visible))}};ixMap.Themes.prototype.getAllThemeDefinitionStrings=function(){for(var c=[],b=0;b<this.themesA.length;b++)c.push(this.getThemeDefinitionString(this.themesA[b]));return c};var S=function(c){try{if(c.charAt(0)=="#"){var b="0123456789abcdef";var f=parseInt(c.substr(1,2),16);var a=parseInt(c.substr(3,2),16);b=parseInt(c.substr(5,2),16);return"RGB("+f+","+a+","+
b+")"}}catch(p){}return c},ma=function(c){return String(c).match(/:/)?Number(c.split(":")[1]):Number(c)};ixMap.Themes.prototype.cleanUpThemeObj=function(c,b){c.field=b.field;c.style.values=b.style.values;c.style.label=b.style.label;c.style.xaxis=b.style.xaxis;b=c.style;if(b.colorscheme){var f=b.colorscheme[0];for(var a in b.colorscheme)if(b.colorscheme[a]!=f){f=null;break}f&&(b.colorscheme.length=1)}if(b.symbols){f=b.symbols[0];for(a in b.symbols)if(b.symbols[a]!=f){f=null;break}f&&(b.symbols.length=
1)}b.aggregationscale?(b.aggregationfield=null,b.gridwidth=null,b.gridwidthpx=null):b.aggregationfield?(b.gridwidth=null,b.gridwidthpx=null):b.gridwidthpx&&(b.gridwidth=null);b.evidence&&b.evidence=="isolate"&&(b.evidence=null);b.aggregation&&(b.aggregation=null);b.type.match(/DOMINANT/)||b.type.match(/PERCENTOFMEAN/)||b.type.match(/OFFSETMEAN/)||b.type.match(/PERCENTOFMEAN/)||b.type.match(/DEVIATION/)||(b.dominantfilter=null,b.dominantdfilter=null);b.itemfield&&b.lookupfield&&b.itemfield==b.lookupfield&&
(b.itemfield=null);return c};ixMap.Themes.prototype.getThemeDefinitionString=function(c){var b='map.Api.newMapTheme("'+c.szThemes+'","'+(c.szFields||"")+'","'+(c.szField100||"")+'","type:'+c.szFlag+";colorscheme:";var f=c.origColorScheme;for(var a=0;a<f.length;a++)f[a]=S(f[a]);f=f.join("|");return b+f+";"+Ha(c)+';child:true;");'};ixMap.Themes.prototype.getMapThemeStyleString=function(c){return(c=this.getTheme(c)||this.activeTheme)&&c.colorScheme?"type:"+c.szFlag+";colorscheme:"+c.colorScheme+";"+
Ha(c):null};ixMap.Themes.prototype.getMapThemeDefinitionObj=function(c){c=this.getTheme(c)||this.activeTheme;var b={};b.layer=c.szThemes;b.field=c.szFields||"";b.field100=c.szField100||"";if(c.szFlag.match(/\bWMS|IMAGE\b/)){var f={type:c.szFlag,server:c.szServer,opacity:c.nOpacity,title:c.szTitle,name:c.szName};b.style=f;return b}c.szFlag.match(/\bCATEGORICAL\b/)&&c.colorScheme&&c.colorScheme.length>3&&(!c.szValuesA||!c.szValuesA.length)&&c.szLabelA&&c.szLabelA.length&&c.szLabelA.length<=100&&(c.szValuesA=
c.szLabelA.slice(0));f={type:c.szFlag,colorscheme:c.origColorScheme};for(var a={},p=0;p<W.length;p++)c[W[p].obj]!=null&&c[W[p].obj]!="undefined"&&(a[W[p].style]=c[W[p].obj]);for(var m in a)f[m]=a[m];b.style=f;return this.cleanUpThemeObj(b,c.origDef)};ixMap.Themes.prototype.getTheme=function(c){if(!c||typeof c!="string")return this.activeTheme;c=c.split(":")[0];for(var b=0;b<this.themesA.length;b++)if(this.themesA[b].szId==c||this.themesA[b].szName==c)return this.themesA[b];return!isNaN(Number(c))&&
Number(c)<this.themesA.length?this.themesA[Number(c)]:this.activeTheme};ixMap.Themes.prototype.getThemeIndex=function(c){for(var b=0;b<this.themesA.length;b++)if(this.themesA[b].szId==c)return b};ixMap.Themes.prototype.refreshTheme=function(c){if(c=this.getTheme(c))c.initValues(),c.szValuesA=null,c.szFlag.match(/RANGES/)||(c.szRangesA=null),c.szExactA=null,c.fRealize=!0,c.fRedraw=!0,!map.fAllIncluded&&c.coTable?this.loadExternalData(c.coTable,!0,c):(c.animateTimeout&&clearTimeout(c.animateTimeout),
executeWithMessage(()=>map.Themes.execute(),"... processing ..."))};ixMap.Themes.prototype.resetTheme=function(c){var b=map.Themes.getTheme(c);if(b){var f=b.chartGroup;b=map.Themes.getMapThemeDefinitionObj(c);map.Themes.themesA.splice(map.Themes.getThemeIndex[c],1);b.style.datacache=!1;b=map.Themes.newThemeByObj(b);b.chartGroup=f}};ixMap.Themes.prototype.nextClipFrame=function(c){(c=this.getTheme(c))&&c.realizeNextClipFrame()};ixMap.Themes.prototype.setClipFrame=function(c,b){(c=c?this.getTheme(c):
this.activeTheme)&&c.setClipFrame(b)};ixMap.Themes.prototype.pauseClip=function(c){(c=this.getTheme(c))&&c.pauseClip()};ixMap.Themes.prototype.startClip=function(c){(c=this.getTheme(c))&&c.startClip()};ixMap.Themes.prototype.loadExternalData=function(c,b,f){this.coTableExt||(this.coTableExt=[]);if(c){var a=map.Dictionary.getLocalText("... creating theme ...");b&&(eval("typeof("+c+")")!="undefined"&&eval(c+".table = null"),a=map.Dictionary.getLocalText("... refreshing theme ..."));this.__test=null;
try{eval("this.__test = "+c+".table")}catch(p){try{eval("this.__test = "+c+"_table")}catch(m){}}b=f.fEditor||!(f.coTableUrl&&f.coTableExt)||!1;this.themeDataCacheA[c]&&((this.themeDataCacheA[c].coTableUrl||f.coTableUrl)&&this.themeDataCacheA[c].coTableUrl!=f.coTableUrl||(this.themeDataCacheA[c].coTableExt||f.coTableExt)&&this.themeDataCacheA[c].coTableExt!=f.coTableExt||(b=!0));if(this.__test&&b&&f.fDataCache===!0)this.fWaitforData=!1,f.fWaitingforData=!1,executeWithMessage(()=>map.Themes.execute(),
a),f&&f.coTableExt&&(f.coTableExt=this.coTableExt[f.coTable]);else if(f&&(f.coTableUrl||f.coTableExt||f.coTableType=="ext"))try{this.themeDataCacheA[c]={coTableUrl:f.coTableUrl,coTableExt:f.coTableExt},this.fWaitforData=!0,f.fWaitingforData=!0,map.HTMLWindow.ixmaps.htmlgui_loadExternalData(f.coTableUrl,{theme:f,type:f.coTableType,name:f.coTable,ext:f.coTableExt}),this.coTableExt[f.coTable]=f.coTableExt}catch(p){}}};ixMap.Themes.prototype.loadExternalDataZipped=function(c,b,f){this.fWaitforData=!0;
displayMessage(map.Dictionary.getLocalText("... loading data ..."));var a=new JSLoader;a.finishedCallback="map.Themes.loadExternalDataFinish('"+f+"')";a.errorCallback="map.Themes.loadExternalDataDefault('"+c+"',"+b+",'"+f+"')";a.szMessage=map.Dictionary.getLocalText("... loading data ...");a.loadScript(map.mapRoot+c+".js.gz",b)};ixMap.Themes.prototype.loadExternalDataDefault=function(c,b,f){this.fWaitforData=!0;displayMessage(map.Dictionary.getLocalText("... loading data ..."));var a=new JSLoader;
a.finishedCallback="map.Themes.loadExternalDataFinish('"+f+"')";a.errorCallback="map.Themes.loadExternalDataFinish('"+f+"')";a.szMessage=map.Dictionary.getLocalText("... loading data ...");a.loadScript(map.mapRoot+c+".js",b)};ixMap.Themes.prototype.loadExternalDataFinish=function(c){this.fWaitforData=!1;executeWithMessage(()=>map.Themes.execute(),c)};ixMap.Themes.prototype.setExternalData=function(c,b,f){b&&(this._dataObj=b,eval("window."+f+" = this._dataObj"));this.fWaitforData=!1;c=this.getAllThemes();
for(var a in c)c[a].coTable==f&&(c[a].fWaitingforData=!1);this.execute()};ixMap.Themes.prototype.activateTheme=function(c,b){if(b=this.getTheme(b))b.fRedraw=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ...");c.stopPropagation();c.preventDefault()};ixMap.Themes.prototype.showTheme=function(c,b){if(b=this.getTheme(b))b.fShow=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ...");c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.hideTheme=function(c,
b){if(b=this.getTheme(b))b.fHide=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ...");c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.toggleTheme=function(c,b){if(b=this.getTheme(b))b.fToggle=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ...");c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.removeTheme=function(c,b){for(var f=0;f<this.themesA.length;f++)if(this.themesA[f].szId===b||this.themesA[f].szName===b){var a=this.themesA[f];
a.szFlag.match(/LOCKED/)||(a.szFlag.match(/CHART/)&&(a.fToggle=!0),a.fRemove=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ..."))}c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.removeAll=function(c){for(var b=0;b<this.themesA.length;b++)this.themesA[b].szFlag.match(/LOCKED/)||(this.themesA[b].fRemove=!this.themesA[b].fRealize||this.themesA[b].fOutOfScale);setTimeout(function(){map.Themes.execute()},100);c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.removeAllCharts=
function(c){for(var b=0;b<this.themesA.length;b++)this.themesA[b].szFlag.match(/CHART/)&&!this.themesA[b].szFlag.match(/LOCKED/)&&(this.themesA[b].fRemove=!0);this.fWaitforData=!0;map.Themes.execute();c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.removeAllChoropleth=function(c){for(var b=0;b<this.themesA.length;b++)this.themesA[b].szFlag.match(/CHOROPLETH/)&&!this.themesA[b].szFlag.match(/LOCKED/)&&(this.themesA[b].fRemove=!this.themesA[b].fRealize);this.fWaitforData=!0;executeWithMessage(()=>
map.Themes.execute(),"... processing ...");c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.removeAllSelections=function(c){for(var b=0;b<this.themesA.length;b++)this.themesA[b].szFlag.match(/SELECTION/)&&(this.themesA[b].fRemove=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ..."));c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.redrawInfoAll=function(c){for(var b=0;b<this.themesA.length;b++)this.themesA[b].fRedrawInfo=!0;map.Themes.execute();
c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.reformat=function(c){for(var b=this.minY=this.minX=0;b<this.themesA.length;b++)this.themesA[b].fRepositionInfo=!0,this.themesA[b].fRedrawInfo=!0;map.Themes.execute();c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.execute=function(){var c=null,b=null,f=0;if(!map.isIdle())setTimeout(function(){map.Themes.execute()},100);else if(!this.fWaitforData)if(map.Tiles.isLoading())setTimeout(function(){map.Themes.execute()},
250),this.fExecuteDelayed=!0;else if(this.fExecuteDelayed)this.fExecuteDelayed=!1,executeWithMessage(()=>map.Themes.execute()," ... ");else{for(f=0;f<this.themesA.length;f++)(this.themesA[f].fRealize||this.themesA[f].fRedraw||this.themesA[f].fToFront)&&this.themesA[f].szFlag.match(/CHOROPLETH/)&&!this.themesA[f].szFlag.match(/SUBTHEME/)&&(c=this.themesA[f].szShapeType,b=this.themesA[f].szThemes);if(c&&this.enableMultiChoropleth)for(f=0;f<this.themesA.length;f++)this.themesA[f].szFlag&&this.themesA[f].szFlag.match(/CHOROPLETH/)&&
this.themesA[f].szShapeType==c&&(this.themesA[f].disable(),this.themesA[f].isVisible=!1,this.themesA[f].fRedrawInfo=!1);if(c&&!this.enableMultiChoropleth)for(f=0;f<this.themesA.length;f++)!this.themesA[f].szFlag||!this.themesA[f].szFlag.match(/CHOROPLETH/)||this.themesA[f].szShapeType!=c||this.themesA[f].szThemes!=b||this.themesA[f].fRealize||this.themesA[f].fRedraw||this.themesA[f].fToFront||(this.themesA[f].fRemove=!0);for(f=0;f<this.themesA.length;f++){if(this.themesA[f].fWaitingforData)return;
if(this.themesA[f].fShow&&this.themesA[f].fDone){this.themesA[f].toggle(!0);this.themesA[f].fShow=!1;break}if(this.themesA[f].fHide&&this.themesA[f].fDone){this.themesA[f].toggle(!1);this.themesA[f].fHide=!1;break}if(this.themesA[f].fToggle&&this.themesA[f].fDone){this.themesA[f].toggle();this.themesA[f].fToggle=!1;this.execute();break}if(this.themesA[f].fRemove){this.themesA.length>1&&!this.themesA[f].szFlag.match(/SELECTION/)&&!this.themesA[f].szFlag.match(/CHART/)&&this.activateNextPaint(this.themesA[f]);
this.themesA[f].removeElements();this.remove(this.themesA[f]);this.reformat();this.execute();break}if(this.themesA[f].fRealize)this.themesA[f].nChartUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.themesA[f].nChartUpper||this.themesA[f].nChartLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.themesA[f].nChartLower?(this.themesA[f].chartGroup&&this.themesA[f].chartGroup.style.setProperty("display","none",""),this.themesA[f].fOutOfScale=!0):(this.themesA[f].fOutOfScale=!1,this.themesA[f].fEnableProgressBar=
!0,this.themesA[f].fRealize=!1,this.themesA[f].realize());else if(this.themesA[f].fRedraw)this.themesA[f].fRedraw=!1,this.themesA[f].fActualize=!1,this.themesA[f].checkHiddenLayerState&&this.themesA[f].checkHiddenLayerState()?(this.themesA[f].fRealize=!0,this.themesA[f].fRedraw=!1,this.themesA[f].fReload=!1,this.themesA[f].unpaintMap(),map.Themes.execute()):(this.themesA[f].fEnableProgressBar=!0,this.themesA[f].szFlag.match(/FEATURE/)||this.themesA[f].unpaintMap(),this.themesA[f].redraw(!1));else if(this.themesA[f].fActualize)this.themesA[f].fActualize=
!1,this.themesA[f].checkHiddenLayerState&&this.themesA[f].checkHiddenLayerState()?(this.themesA[f].fRealize=!0,this.themesA[f].fRedraw=!1,this.themesA[f].fReload=!1,this.themesA[f].unpaintMap(),map.Themes.execute()):(this.themesA[f].fEnableProgressBar=!0,this.themesA[f].redraw(!1));else if(this.themesA[f].fToFront)this.themesA[f].fEnableProgressBar=!1,this.themesA[f].toFront(),this.themesA[f].fToFront=!1;else if(this.themesA[f].fResize)this.themesA[f].resize(this.themesA[f].fResize),this.themesA[f].fResize=
!1;else if(this.themesA[f].fOpacity)this.themesA[f].opacity(this.themesA[f].fOpacity),this.themesA[f].fOpacity=!1;else if(this.themesA[f].fBlur)this.themesA[f].blur(this.themesA[f].nBlur),this.themesA[f].fBlur=!1;else if(this.themesA[f].fOffset)this.themesA[f].offset(this.themesA[f].fOffset),this.themesA[f].fOffset=!1;else if(this.themesA[f].fRedrawInfo)this.themesA[f].widgetNode&&this.themesA[f].showInfo(),this.themesA[f].fRedrawInfo=!1;else if(this.themesA[f].fResort){try{this.themesA[f].sortChartObjects()}catch(a){}this.themesA[f].fResort=
!1}else if(this.themesA[f].fDeclutter){try{this.themesA[f].declutterCharts()}catch(a){}this.themesA[f].fDeclutter=!1}}this.executeCallback&&(eval(this.executeCallback),this.executeCallback=null);clearMessage();clearMessage(1E3)}};ixMap.Themes.prototype.executeContinue=function(){for(var c=0;c<this.themesA.length;c++)this.themesA[c].fAnalyze?(this.themesA[c].fAnalyze=!1,this.themesA[c].realize_analyze()):this.themesA[c].fDraw?(this.themesA[c].fDraw=!1,this.themesA[c].realize_draw()):this.themesA[c].fContinue?
(this.themesA[c].fContinue=!1,this.themesA[c].realizeContinue(this.themesA[c].continueIndex)):this.themesA[c].fContinueLoadAndAggregate&&(this.themesA[c].fContinueLoadAndAggregate=!1,this.themesA[c].loadAndAggregateValuesOfTheme(this.themesA[c].szThemeLayer,this.themesA[c].continueIndex))};ixMap.Themes.prototype.realizeDone=function(c){for(var b=0;b<this.themesA.length;b++)this.themesA[b].szFlag.match(/SELECTION/)&&(this.themesA[b].fRealize=!0);c.fRealizeDone=!0;c.szFlag.match(/BUFFER/)?this.activeBuffer=
c:this.activeTheme=c;try{map.HTMLWindow.ixmaps.htmlgui_setActualTheme(c.szId)}catch(f){}try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(c.szId)}catch(f){}(c.szFlag.match(/TEXTONLY/)||c.szLabelField)&&setTimeout(function(){map.Layer.adaptLabel()},10);c.szFlag.match(/ANIMATEPOSITION/)&&(c.animateTimeout&&clearTimeout(c.animateTimeout),c.animateTimeout=setTimeout(function(){map.Themes.animateChartPosition(null,c.szId)},100));c.userChartDrawError&&c.userChartDrawError==c.nDoneCount&&displayMessage("User draw function error! ",
5E3);this.isIdle()&&clearMessage();setTimeout("map.Themes.execute()",100)};ixMap.Themes.prototype.showProgressBar=function(){for(var c=0;c<this.themesA.length;c++)(this.themesA[c].fRealize||this.themesA[c].fContinue||this.themesA[c].fAnalyze||this.themesA[c].fDraw)&&this.themesA[c].nCount/this.themesA[c].nDoneCount>2&&this.themesA[c].mapSleep?this.themesA[c].mapSleep.fShowProgressBar=!0:(this.themesA[c].fRealize||this.themesA[c].fContinue||this.themesA[c].fAnalyze||this.themesA[c].fDraw)&&setTimeout(function(){map.Themes.showProgressBar()},
1E3)};ixMap.Themes.prototype.remove=function(c){c==this.activeTheme&&(this.activeTheme=null);c==this.activeBuffer&&(this.activeBuffer=null);for(var b=0;b<this.themesA.length;b++)if(this.themesA[b]==c){for(;b<this.themesA.length-1;b++)this.themesA[b]=this.themesA[b+1];this.themesA.length--}c.removeValues()};ixMap.Themes.prototype.cancelExecute=function(){this.activeTheme.fCancel=!0};ixMap.Themes.prototype.sequence=function(){this.sequenceNr=0;this.sequenceNext()};ixMap.Themes.prototype.sequenceNext=
function(){this.sequenceNr<this.themesA.length&&(this.themesA[this.sequenceNr].fRedraw=!0,map.Themes.executeCallback="setTimeout('map.Themes.sequenceNext()',500)",map.Themes.execute(),this.sequenceNr++)};ixMap.Themes.prototype.activateNextPaint=function(c){c=this.getThemeIndex(c.szId);for(var b=c-1;b!=c;b--){b<0&&(b=this.themesA.length-1);if(b==c)break;if(this.themesA[b].isChecked&&!this.themesA[b].szFlag.match(/CHART/))return this.themesA[b].fRedraw=!0,this.themesA[b].fRedrawInfo=!1,!0}return!1};
ixMap.Themes.prototype.toggleThemeValues=function(c,b){this.toggleValueDisplay(c,this.activeTheme.szId,!this.activeTheme.szFlag.match(/VALUES/))};ixMap.Themes.prototype.toggleThemeLegends=function(c,b){map.SVGThemeGroup.style.setProperty("display",b?"inline":"none","")};ixMap.Themes.prototype.minimizeThemeLegends=function(c){this.fMinimizedLegends=!0;for(var b=0;b<this.themesA.length;b++)this.minimizeInfo(c,this.themesA[b].szId)};ixMap.Themes.prototype.changeAllChartScaling=function(c,b){for(b=0;b<
this.themesA.length;b++)this.themesA[b].fResize=999,executeWithMessage(()=>map.Themes.execute(),"... processing ...");c.stopPropagation();c.preventDefault()};ixMap.Themes.prototype.changeChartScaling=function(c,b,f){if(b=this.getTheme(b))b.fResize=f,executeWithMessage(()=>map.Themes.execute(),"... processing ...");c.stopPropagation();c.preventDefault()};ixMap.Themes.prototype.changeChartOpacity=function(c,b,f){if(b=this.getTheme(b))b.fOpacity=f,executeWithMessage(()=>map.Themes.execute(),"... processing ...");
c.stopPropagation();c.preventDefault()};ixMap.Themes.prototype.changeChartOffset=function(c,b,f){if((c=this.getTheme(b))&&c.leadOffset&&(f=map.SVGDocument.getElementById(f))){f.fu=new Methods(f);b=f.fu.getPosition();var a=f.fu.getGroupScale();c.fOffset=new point(b.x-c.leadOffset.x,b.y-c.leadOffset.y);f.fu.setPosition(c.leadOffset.x,c.leadOffset.y);c.fOffset.x/=map.Zoom.nZoom/a.x;c.fOffset.y/=map.Zoom.nZoom/a.y;c.offset(c.fOffset);c.fOffset=!1;c.leadOffset=!1}};ixMap.Themes.prototype.tellChartOffset=
function(c,b,f){(c=this.getTheme(b))&&!c.leadOffset&&this.enableChartOffset&&(f=map.SVGDocument.getElementById(f))&&(f.fu=new Methods(f),c.leadOffset=f.fu.getPosition())};ixMap.Themes.prototype.initChartOffset=function(c,b,f){if(this.getTheme(b)){var a=map.SVGDocument.getElementById(f);a&&(a.origPosition||(a.origPosition=a.fu.getPosition()),a.onMouseMove=function(p){a.actualPosition=a.fu.getPosition();map.Themes.makeChartOffsetPointer(a)},a.widgetObj=new Widget(a,a))}};ixMap.Themes.prototype.endChartOffset=
function(c,b,f){this.getTheme(b)&&(c=map.SVGDocument.getElementById(f))&&c.widgetObj.remove()};ixMap.Themes.prototype.makeChartOffsetPointer=function(c,b){b=b||1;c.pointerObj?(map.Dom.clearGroup(c.pointerObj),map.Dom.clearGroup(c.pointShObj)):(c.pointerObj=map.Dom.newGroup(c),c.pointShObj=map.Dom.newGroup(c),c.pointerObj.parentNode.insertBefore(c.pointerObj,c.pointerObj.parentNode.firstChild),c.pointShObj.parentNode.insertBefore(c.pointShObj,c.pointShObj.parentNode.firstChild));if(c.origPosition||
c.actualPosition){var f=new box(0,0,100,75),a=new point(c.actualPosition.x-c.origPosition.x,c.actualPosition.y-c.origPosition.y);map.Scale.normalX(15);map.Scale.normalX(5);var p=map.Scale.normalX(10);map.Scale.normalX(5);var m=a.y+f.height/2;var w=a.x+f.width/2;Math.abs(m)+f.width/2-f.height/2>Math.abs(w)?(f.width/3>p&&(a.x>-f.width/3&&(w-=f.width/3),a.x<-f.width/3*2&&(w+=f.width/3)),m>0?(map.Dom.newShape("path",c.pointShObj,"M"+-a.x+","+-a.y+" l "+(w-map.Scale.normalX(5/b))+","+(a.y+map.Scale.normalX(1/
b))+" "+map.Scale.normalX(4/b)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",c.pointerObj,"M"+-a.x+","+-a.y+" l "+(w-map.Scale.normalX(5/b))+","+(a.y+map.Scale.normalX(1/b))+" "+map.Scale.normalX(3/b)+",0 z","fill:white")):(map.Dom.newShape("path",c.pointShObj,"M"+-a.x+","+-a.y+" l "+(w-map.Scale.normalX(4/b))+","+(a.y+f.height)+" "+map.Scale.normalX(4/b)+",0 z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",c.pointerObj,"M"+-a.x+","+-a.y+" l "+(w-map.Scale.normalX(4/b))+","+
(a.y+f.height)+" "+map.Scale.normalX(3/b)+",0 z","fill:white"))):(f.height/5>p&&(a.y>-f.height/3&&(m-=f.height/3),a.y<-f.height/3*2&&(m+=f.height/3)),w>0?(map.Dom.newShape("path",c.pointShObj,"M"+-a.x+","+-a.y+" l "+(a.x-f.width)+","+(m-map.Scale.normalX(4/b))+" 0,"+map.Scale.normalX(4/b)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",c.pointerObj,"M"+-a.x+","+-a.y+" l "+(a.x-f.width)+","+(m-map.Scale.normalX(4/b))+" 0,"+map.Scale.normalX(3/b)+" z","fill:white")):(map.Dom.newShape("path",
c.pointShObj,"M"+-a.x+","+-a.y+" l "+(a.x+f.width)+","+(m-map.Scale.normalX(4/b))+" 0,"+map.Scale.normalX(4/b)+" z","fill:black;fill-opacity:0.5"),map.Dom.newShape("path",c.pointerObj,"M"+-a.x+","+-a.y+" l "+(a.x+f.width)+","+(m-map.Scale.normalX(4/b))+" 0,"+map.Scale.normalX(3/b)+" z","fill:white")))}};ixMap.Themes.prototype.animateChartPosition=function(c,b){var f=this.getTheme(b);if(f){c=f.chartGroup.childNodes;for(let m=0;m<c.length;m++){b=c[m].fu.getPosition();var a=new point(c[m].getAttributeNS(szMapNs,
"xEnd"),c[m].getAttributeNS(szMapNs,"yEnd")),p=c[m].getAttributeNS(szMapNs,"dur");c[m].fu.setPosition(b.x+(a.x-b.x)/p,b.y+(a.y-b.y)/p);c[m].setAttributeNS(szMapNs,"dur",--p)}f.animateTimeout&&clearTimeout(f.animateTimeout);f.animateTimeout=setTimeout(function(){map.Themes.animateChartPosition(null,f.szId)},100)}};D.prototype.declutterCharts=function(){if(!(this.szDeclutterUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nDeclutterUpper)){var c=this.chartGroup.childNodes;for(a=0;a<c.length;a++)c[a].actualPosition&&
(c[a].fu.setPosition(c[a].origPosition.x,c[a].origPosition.y),c[a].origPosition=null,c[a].actualPosition=null,c[a].pointerObj&&(map.Dom.clearGroup(c[a].pointerObj),map.Dom.clearGroup(c[a].pointShObj)),c[a].pointerObj=null,c[a].pointShObj=null);if(!c[0].actualPosition){var b=c[0].fu.getBox();map.Zoom.getBox();for(var f=[],a=0;a<c.length;a++){var p=!1,m=c[a].fu.getPosition(),w=c[a].fu.getBox();w.x+=m.x;w.y+=m.y;for(var C in f)for(var z in f[C])if(!(w.y+w.height<f[C][z].box.y-f[C][z].box.height*.3||
w.y>f[C][z].box.y+f[C][z].box.height*1.3||w.x+w.width<f[C][z].box.x-f[C][z].box.width||w.x>f[C][z].box.x+f[C][z].box.width*2)){f[C].push({node:c[a],y:c[a].fu.getPosition().x,box:w});p=!0;break}p||f.push([{node:c[a],y:c[a].fu.getPosition().x,box:w}])}for(C=0;C<f.length;C++)if(c=f[C],c.sort(this.sortUpChartObjectsCompare),c.length>1&&c.length<5){p=c[0].node.fu.getPosition();for(a=0;a<c.length;a++)m=c[a].node.fu.getPosition(),m.y<p.y&&(p.x=m.x,p.y=m.y);p.y-=map.Scale.normalX(50)*map.Scale.nZoomScale;
m=c[0].node.fu.getPosition();for(a=0;a<c.length;a++)c[a].node.origPosition=c[a].node.fu.getPosition(),c[a].node.fu.setPosition(m.x+b.width*1.2*a,p.y),c[a].node.actualPosition=new point(m.x+b.width*1.2*a,p.y),w=c[a].node.fu.getScale().x,c[a].node.actualPosition.x=c[a].node.origPosition.x-(c[a].node.origPosition.x-c[a].node.actualPosition.x)/w,c[a].node.actualPosition.y=c[a].node.origPosition.y-(c[a].node.origPosition.y-c[a].node.actualPosition.y)/w,map.Themes.makeChartOffsetPointer(c[a].node,this.nScale)}}}};
D.prototype.animateCharts=function(c){var b=this.chartGroup.childNodes;if(c=="scale")for(i=0;i<b.length;i++){var f=b[i].firstChild;f.setAttributeNS(null,"transform","scale(1 1)");map.Dom.constructNode("animateTransform",f,{attributeName:"transform",type:"scale",from:"0 0",to:"1 1",begin:String(Math.random()*.2)+"s",dur:"2s",repeatCount:"1"})}if(c=="fire")for(i=0;i<b.length;i++)f=b[i].firstChild,f.setAttributeNS(null,"transform","scale(1 1)"),map.Dom.constructNode("animateTransform",f,{attributeName:"transform",
type:"scale",from:"0 0",to:"1 1",begin:String(Math.random()*1)+"s",dur:"0.5s",repeatCount:"3"})};ixMap.Themes.prototype.toggleValueDisplay=function(c,b,f){var a=this.getTheme(b);if(a){var p="";b=a.szFlag.split("|");for(var m=0;m<b.length;m++)b[m]!="VALUES"&&(p+=(p.length?"|":"")+b[m]);f&&(p+="|VALUES");executeWithMessage(()=>map.Themes.doChangeThemeStyle(a.szId,"type:"+p),"... processing ...")}c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.toggleDopacity=function(c,b,f){var a=
this.getTheme(b);if(a){var p="";b=a.szFlag.split("|");for(var m=0;m<b.length;m++)b[m].match(/DOPACITY/)||(p+=(p.length?"|":"")+b[m]);f&&(p+="|DOPACITYMAX");executeWithMessage(()=>map.Themes.doChangeThemeStyle(a.szId,"type:"+p),"... processing ...")}c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.changeDopacityAlphaRamp=function(c,b,f){var a=this.getTheme(b);if(a){var p=a.szFlag;a.nDopacityScale=a.nDopacityScale||1;a.nDopacityScale*=f;executeWithMessage(()=>map.Themes.doChangeThemeStyle(a.szId,
"type:"+p),"... processing ...")}c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.toggleChartDisplay=function(c,b,f){if(b=this.getTheme(b))b.fToggle=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ...");c.stopPropagation();c.preventDefault()};ixMap.Themes.prototype.zoomTo=function(c,b){(c=this.getTheme(b)||this.activeTheme)&&c.zoomTo()};ixMap.Themes.prototype.zoomToClass=function(c,b,f,a){setTimeout(function(){map.Themes.doZoomToClass(b,f,a)},100)};ixMap.Themes.prototype.markClass=
function(c,b,f,a){var p=this.getTheme(b);p&&p.isVisible&&!p.showInfoMore&&(typeof p.markedClass!="undefined"&&p.markedClass==f||typeof p.markedClasses!="undefined"&&p.markedClasses[f]?this.unmarkClass(c,b,f):(p.fMarkEnable=!0,p.fUnmarkEnable=!1,this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),displayMessage("...",500,!0),this.markTimeout=setTimeout(function(){map.Themes.doMarkClass(b,f,a)},50)))};ixMap.Themes.prototype.unmarkClass=function(c,b,
f){(c=this.getTheme(b))&&c.isVisible&&!c.showInfoMore&&(displayMessage("...",500,!0),this.unmarkTimeout=setTimeout(function(){map.Themes.doUnmarkClass(b,f)},50),c.fUnmarkEnable=!0,c.fMarkEnable=!1)};ixMap.Themes.prototype.doZoomToClass=function(c,b,f){(c=this.getTheme(c))&&c.zoomToClass(Number(b),Number(f))};ixMap.Themes.prototype.doMarkClass=function(c,b,f){if(c=this.getTheme(c)){c.markedClass=b;c.markedClasses=c.markedClasses||[];c.markedClasses[b]=!0;c.markedClassesA=[];for(var a in c.markedClasses)c.markedClasses[a]===
!0&&c.markedClassesA.push(a);c.markClass(Number(b),Number(f));try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(c.szId)}catch(p){}}};ixMap.Themes.prototype.doUnmarkClass=function(c,b){if(c=this.getTheme(c)){c.markedClass=null;if(c.markedClasses){c.markedClasses[b]=!1;c.markedClassesA=[];for(var f in c.markedClasses)c.markedClasses[f]===!0&&c.markedClassesA.push(f);if(c.markedClassesA.length){displayMessage("...",500,!0);c.fMarkEnable=!0;c.markClass(c.markedClassesA[0],1);c.fMarkEnable=!1;try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(c.szId)}catch(a){}return}delete c.markedClassesA;
delete c.markedClasses}c.unmarkClass();try{map.HTMLWindow.ixmaps.htmlgui_onDrawTheme(c.szId)}catch(a){}}};ixMap.Themes.prototype.hideClass=function(c,b,f,a){(c=this.getTheme(b))&&c.isVisible&&c.showClass(Number(f),Number(a),!1)};ixMap.Themes.prototype.showClass=function(c,b,f,a){(c=this.getTheme(b))&&c.isVisible&&c.showClass(Number(f),Number(a),!0)};ixMap.Themes.prototype.classesToRanges=function(c,b){(c=this.getTheme(b))&&c.isVisible&&c.classesToRanges()};ixMap.Themes.prototype.filterItems=function(c,
b,f,a){(c=b?this.getTheme(b):this.activeTheme)&&c.isVisible&&!c.showInfoMore&&(c.fMarkEnable=!0,c.fUnmarkEnable=!1,this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),this.opt=a,this.markTimeout=setTimeout(function(){map.Themes.doFilterItems(b,f)},500))};ixMap.Themes.prototype.doFilterItems=function(c,b){executeWithMessage(()=>map.Themes.doFilterItemsGo(c,b),"applying filter ...")};ixMap.Themes.prototype.doFilterItemsGo=function(c,b){clearMessage();
if(c=this.getTheme(c?c:null))c.filterItems(b,this.opt),this.activeTheme=c};ixMap.Themes.prototype.selectFilterItems=function(c,b){(c=this.getTheme(b))&&c.selectFilterItems()};ixMap.Themes.prototype.highlightItems=function(c,b,f,a){(c=b?this.getTheme(b):this.activeTheme)&&c.isVisible&&(this.highlightTimeout&&clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout(function(){map.Themes.doHighlightItems(b,f,a)},500))};ixMap.Themes.prototype.doHighlightItems=function(c,b,f){(c=c?this.getTheme(c):
this.activeTheme)&&c.highlightItems(b,f)};ixMap.Themes.prototype.clearHighlightItems=function(c,b){(c=b?this.getTheme(b):this.activeTheme)&&c.isVisible&&(this.highlightTimeout&&clearTimeout(this.highlightTimeout),c.clearHighlightItems())};ixMap.Themes.prototype.setTimeFrame=function(c,b,f,a){(c=this.getTheme(b))&&c.isVisible&&!c.showInfoMore&&(this.markTimeout&&clearTimeout(this.markTimeout),this.unmarkTimeout&&clearTimeout(this.unmarkTimeout),this.markTimeout=setTimeout(function(){map.Themes.doSetTimeFrame(b,
f,a)},1))};ixMap.Themes.prototype.doSetTimeFrame=function(c,b,f){if(c==null){c=this.getThemes();for(var a in c)c[a].setTimeFrame(b,f)}else(a=this.getTheme(c))&&a.setTimeFrame(b,f)};ixMap.Themes.prototype.changeThemeStyle=function(c,b,f,a){if(b==null){themesA=this.getThemes();for(var p in themesA)themesA[p].szFlag.match(/FEATURE/)||this.changeThemeStyle(c,themesA[p].szId,f,a)}else a&&a.match(/fast|silent|direct/)?map.Themes.doChangeThemeStyle(b,f.replace(/'/g,"\\'"),a):executeWithMessage(()=>map.Themes.doChangeThemeStyle(b,
f.replace(/'/g,"\\'"),a),"... processing ..."),c&&(c.stopPropagation(),c.preventDefault())};ixMap.Themes.prototype.doChangeThemeStyle=function(c,b,f){console.log("doChangeThemeStyle",c,b,f);var a=this.getTheme(c);if(a){if(b=__getStyleObj(b)){if(b.type){b.origType=b.type;if(f&&f.match(/add/)){var p=b.type.split("|");this.szTempStyle=a.szFlag;for(var m=0;m<p.length;m++)eval("this.szTempStyle.match(/"+p[m]+"/)")||(this.szTempStyle+="|"+p[m]);b.type=this.szTempStyle}else if(f&&f.match(/remove/)){p=a.szFlag.split("|");
var w="";for(m=0;m<p.length;m++)p[m]!=b.type&&(w+=(w.length?"|":"")+p[m]);b.type=w}else if(f&&f.match(/toggle/)){p=a.szFlag.split("|");w="";var C=!1;for(m=0;m<p.length;m++)p[m]!=b.type?w+=(w.length?"|":"")+p[m]:C=!0;b.type=w+(C?"":"|"+b.type)}else a.szFlag.match(/FRACTION/)&&(b.type+="|FRACTION"),a.szFlag.match(/PERMILLE/)&&(b.type+="|PERMILLE"),a.szFlag.match(/CALCVAL/)&&(b.type+="|CALCVAL"),a.szFlag.match(/CALC100/)&&(b.type+="|CALC100"),a.szFlag.match(/PRODUCT/)&&(b.type+="|PRODUCT"),a.szFlag.match(/RELATIVE/)&&
(b.type+="|RELATIVE"),a.szFlag.match(/INVERT/)&&(b.type+="|INVERT"),a.szFlag.match(/INVERTSIZE/)&&(b.type+="|INVERTSIZE"),a.szFlag.match(/DENSITY/)&&(b.type+="|DENSITY"),a.szFlag.match(/SUM/)&&(b.type+="|SUM"),a.szFlag.match(/CALCMEAN/)&&(b.type+="|CALCMEAN"),a.szFlag.match(/AUTO100/)&&(b.type+="|AUTO100");b.type.match(/LOCKED/)&&(a.fRedrawInfo=!0,map.Themes.execute());if(b.type.match(/CHART/)&&!a.szFlag.match(/CHART/)||b.type.match(/CHOROPLETH/)&&!a.szFlag.match(/CHOROPLETH/))a.unpaintMap(),this.activateNextPaint(a);
!b.type.match(/CATEGORICAL/)&&(b.type.match(/EQUIDISTANT/)||b.type.match(/POW2/)||b.type.match(/POW3/)||b.type.match(/LOG/)||b.type.match(/QUANTILE/))&&(a.szOldRanges=a.szRanges?a.szRanges:a.szOldRanges,a.szRanges=null,a.szOldLabelA=a.szLabelA?a.szLabelA:a.szOldLabelA,a.szLabelA=null,a.fRealize=!0);b.type.match(/RANGES/)&&b.ranges&&(a.szRanges=a.szOldRanges?a.szOldRanges:a.szRanges,a.szRangesA=b.ranges.split(b.ranges.match(/\|/)?"|":","),a.szLabelA=a.szOldLabelA?a.szOldLabelA:a.szLabelA,Number(a.origColorScheme[0])&&
a.szRanges&&(a.origColorScheme[0]=a.szRangesA.length-1),a.fRealize=!0);if(b.type.match(/RANGES/)&&!b.ranges){a.szRangesA=[a.partsA[0].min];for(var z in a.partsA)a.szRangesA.push(a.partsA[z].max)}z=a.szFlag;a.szFlag=b.type;!a.szFlag.match(/CHART/)||a.szFlag.match(/BUFFER/)||z.match(/CHART/)||(a.fShadow=a.fOrigShadow=!0);b.origType.match(/AGGREGATE/)||b.origType.match(/GROUP/)||b.origType.match(/\bRECT\b/)||b.origType.match(/RELOCATE/)?(a.fRealize=!0,a.fRedraw=!1,a.unpaintMap(),a.themeNodesPosA=[]):
(a.fRedraw=!0,a.fRedrawInfo=!0);b.type.match(/VALUES/)!=z.match(/VALUES/)&&(a.fRedraw=!0);b.type.match(/DTEXT/)!=z.match(/DTEXT/)&&a.unlabelMap();b.type.match(/AUTO100/)!=z.match(/AUTO100/)&&(a.fRealize=!0,a.fRedraw=!1,a.unpaintMap());b.type.match(/DIFFERENCE/)!=z.match(/DIFFERENCE/)&&(a.fRealize=!0,a.fRedraw=!1,a.unpaintMap());b.type.match(/NOOUTLIER/)!=z.match(/NOOUTLIER/)&&(a.fRealize=!0,a.fRedraw=!1,a.unpaintMap());b.type.match(/OUTLIER/)!=z.match(/OUTLIER/)&&(a.fRealize=!0,a.fRedraw=!1,a.unpaintMap());
b.type.match(/NEGATIVEISNOTVALUE/)!=z.match(/NEGATIVEISNOTVALUE/)&&(a.fNegativeValuePossible=!b.type.match(/NEGATIVEISNOTVALUE/),a.fRealize=!0,a.fRedraw=!0,a.unpaintMap())}else if(f&&f.match(/remove/)){for(p in b)for(w in W)W[w].style==p&&(a[W[w].obj]=null);a.fReload=!0;a.fRealize=!0;a.unpaintMap();executeWithMessage(()=>map.Themes.execute(),"... processing ...");return}q(b.field)&&(a.szFields=b.field,a.szFieldsA=a.szFields.split("|"),a.fRealize=!0);q(b.classes)&&(isNaN(Number(a.origColorScheme[0]))&&
(a.origColorScheme[3]=a.origColorScheme[a.origColorScheme.length/2],a.origColorScheme[4]="2colors",z=a.origColorScheme[a.origColorScheme.length-1],a.origColorScheme[1]=a.origColorScheme[0],a.origColorScheme[2]=z),a.origColorScheme[0]=Number(b.classes),a.szFlag.match(/CHART/)&&a.unpaintMap(),a.szOldRanges=a.szRanges,a.szRanges=null,a.fRealize=!0);q(b.ranges)&&(a.szRanges=b.ranges,a.szRangesA=b.ranges.split(b.ranges.match(/\|/)?"|":","),a.fRealize=!0);q(b.colorstyle)&&a.origColorScheme[1]=="spectrum"&&
(a.origColorScheme[2]=b.colorstyle,a.szFlag.match(/CHART/)&&a.unpaintMap(),a.fRealize=!0);q(b.colordef)&&(a.origColorScheme=b.colordef.match(/\|/)?b.colordef.split("|"):b.colordef.split(","),a.colorScheme=a.origColorScheme,a.fRedraw=!0,a.szFlag.match(/CHART/)||(a.fRealize=!0),a.fRedrawInfo=!0,a.showInfo());if(q(b.colorscheme)&&(typeof b.colorscheme==="object"&&(b.colorscheme=b.colorscheme.join("|"),alert(b.colorscheme)),(z=b.colorscheme.match(/\|/)?b.colorscheme.split("|"):b.colorscheme.split(","))&&
z.length)){isNaN(Number(a.origColorScheme[0]))&&(a.origColorScheme[0]=a.origColorScheme.length);a.origColorScheme.length=1;for(m=0;m<5;m++)a.origColorScheme[m+1]=m<z.length?z[m]:null;try{a.colorScheme=ColorScheme.createColorScheme(a.origColorScheme[1],a.origColorScheme[2],a.origColorScheme[0],a.origColorScheme[3],a.origColorScheme[4])}catch(y){a.colorScheme=a.defaultColorScheme}a.fRealize=!0;a.szFlag.match(/CHART/);a.unpaintMap();a.fRedrawInfo=!0;a.showInfo()}if(q(b.colorschemegeneration)&&!isNaN(Number(a.origColorScheme[0]))){switch(b.colorschemegeneration){case "warm":a.origColorScheme[4]=
"#FFFDD8";break;case "cold":a.origColorScheme[4]="#FFFFFF";break;default:a.origColorScheme[4]=b.colorschemegeneration}a.szFlag.match(/CHART/)&&a.unpaintMap();try{a.colorScheme=ColorScheme.createColorScheme(a.origColorScheme[1],a.origColorScheme[2],a.origColorScheme[0],a.origColorScheme[3],a.origColorScheme[4])}catch(y){a.colorScheme=a.defaultColorScheme}a.fRedraw=!0;a.fRedrawInfo=!0}q(b.symbols)&&(a.szSymbolsA=b.symbols.split(b.symbols.match(/\|/)?"|":","),a.fRealize=!0);if(q(b.values)){z=this.toArray(b.values);
if(z.length)for(m=0;m<z.length;m++)a.getStringValueIndex(z[m],"set");a.szValuesA=[];a.szLabelA=[];for(m in a.nStringToValueA)a.szValuesA.push(m),a.szLabelA.push(m);a.fRealize=!0}q(b.dominantdfilter)&&(a.nDominantDFilter=Number(b.dominantdfilter),a.fRealize=!0);q(b.dominantfilter)&&(a.szDominantFilter=String(b.dominantfilter),a.fRealize=!0);q(b.filter)&&(f&&f.match(/remove/)?a.szFilter="":a.szFilter=String(b.filter),a.fRealize=!0,a.unpaintMap(),a.szFlag.match(/FEATURE/)&&map.Dom.clearGroup(a.chartGroup));
q(b.filterfield)&&(a.szFilterField=String(b.filterfield),a.fRealize=!0);q(b.markclasses)&&(a.markedClassesA=this.toArray(b.markclasses),a.markedClasses=[],a.unmarkClass(),a.markedClassesA.forEach(function(y,O){y>=0&&(a.markedClasses[y]=!0)}),a.markClass());q(b.field100min)&&(a.nField100Min=b.field100min,a.fRealize=!0);q(b.overviewchart)&&!a.szFlag.match(/CHART/)&&(a.szOverviewChart=b.overviewchart,a.fRedrawInfo=!0);q(b.evidence)&&(a.evidenceMode=b.evidence);q(b.aggregation)&&(a.szAggregation=b.aggregation);
q(b.opacity)&&(a.fOpacity=K(a.fOpacity,Number(b.opacity),f),a.autoOpacity=!1,a.fRedraw=!0);q(b.fillopacity)&&(a.fillOpacity=K(a.fillOpacity||(Number(b.fillopacity)<1?1:0),Number(b.fillopacity),f),a.autoOpacity=!1,a.fillOpacity=Math.min(Math.max(a.fillOpacity,.001),1),a.unpaintMap(),a.fRedraw=!0);q(b.shadow)&&(a.fShadow=b.shadow=="toggle"?a.fOrigShadow=!a.fOrigShadow:a.fOrigShadow=b.shadow,a.fRedraw=!0);q(b.showdata)&&(a.fShowData=b.showdata=="toggle"?!a.fShowData:JSON.parse(b.showdata),a.fRedraw=
!0);q(b.blur)&&(b.blur=="toggle"?a.nBlur?(a.nOldBlur=a.nBlur,a.nBlur=0):a.nBlur=a.nOldBlur||1:a.nBlur=K(a.nBlur,Number(b.blur),f),a.fBlur=!0);q(b.scale)&&(a.fResize=A(a.nScale,Number(b.scale),f));q(b.dopacityscale)&&(a.nDopacityScale=K(a.nDopacityScale,Number(b.dopacityscale),f),a.fRedraw=!0);q(b.d_dopacityscale)&&(a.nDopacityScale*=Number(b.d_dopacityscale),a.fRedraw=!0);q(b.alphafield)&&(a.szAlphaField=String(b.alphafield),a.fRealize=!0);q(b.alphafield100)&&(a.szAlphaField100=String(b.alphafield100),
a.fRealize=!0);q(b.dopacityramp)&&(a.szDopacityRamp=b.dopacityramp,a.fRealize=!0);q(b.dopacitypow)&&(a.nDopacityPow=K(a.nDopacityPow,Number(b.dopacitypow),f),a.fRealize=!0);q(b.brightness)&&(a.nBrightness=K(a.nBrightness||1,Number(b.brightness),f),a.fRealize=!0);q(b.rangescale)&&(a.nRangeScale=K(a.nRangeScale||1,Number(b.rangescale),f),a.fRedraw=!0);q(b.sizefield)&&(a.szSizeField=String(b.sizefield),a.fRealize=!0);q(b.timefield)&&(a.szTimeField=String(b.timefield),a.fRealize=!0);q(b.xfield)&&(a.szXField=
String(b.xfield),a.fRealize=!0);q(b.yfield)&&(a.szYField=String(b.yfield),a.fRealize=!0);q(b.labelfield)&&(a.szLabelField=String(b.labelfield),a.fRealize=!0);q(b.colorfield)&&(a.szColorField=String(b.colorfield),a.fRealize=!0);q(b.symbolfield)&&(a.szSymbolField=String(b.symbolfield),a.fRealize=!0);q(b.valuefield)&&(a.szValueField=String(b.valuefield),a.fRealize=!0);q(b.normalsizevalue)&&(a.nNormalSizeValue||(a.nNormalSizeValue=a.szSizeField?a.nMaxSize:a.nMax),a.nNormalSizeValue=K(a.nNormalSizeValue,
Number(b.normalsizevalue),f),a.fRedraw=!0);q(b.minvalue)&&(a.nMinValue=K(a.nMinValue||1,Number(b.minvalue),f),a.fRedraw=!0);q(b.maxvalue)&&(a.nMaxValue=K(a.nMaxValue||1,Number(b.maxvalue),f),a.fRedraw=!0);q(b.valuedecimals)&&(a.nValueDecimals=b.valuedecimals,a.fRedraw=!0);q(b.valuescale)&&(a.nValueScale=K(a.nValueScale,Number(b.valuescale),f),a.fRedraw=!0);q(b.linewidth)&&(a.nLineWidth=K(a.nLineWidth,Number(b.linewidth),f),a.fRealize=!0);q(b.markersize)&&(a.nMarkerSize=K(a.nMarkerSize,Number(b.markersize),
f),a.fRedraw=!0);q(b.gapsize)&&(a.nGapSize=K(a.nGapSize,Number(b.gapsize),f),a.fRedraw=!0);q(b.offsetx)&&(a.nOffsetX=K(a.nOffsetX,Number(b.offsetx),f),a.fRedraw=!0);q(b.offsety)&&(a.nOffsetY=K(a.nOffsetY,Number(b.offsety),f),a.fRedraw=!0);q(b.rotation)&&(a.nRotation=K(a.nRotation,Number(b.rotation),f),a.fRedraw=!0);q(b.align)&&(a.szAlign=String(b.align),a.fRedraw=!0);q(b.linecolor)&&(a.szLineColorA=this.toArray(String(b.linecolor)),a.szLineColor=a.szLineColorA[a.szLineColorA.length-1],a.fRealize=
!0);q(b.valueupper)&&(a.szValueUpper=b.valueupper,a.nValueUpper=ma(a.szValueUpper),a.fRedraw=!0);q(b.valuelower)&&(a.szValueLower=b.valuelower,a.nValueLower=ma(a.szValueLower),a.fRedraw=!0);q(b.titleupper)&&(a.szTitleUpper=b.titleupper,a.nTitleUpper=ma(a.szTitleUpper),a.fRedraw=!0);q(b.titlelower)&&(a.szTitleLower=b.titlelower,a.nTitleLower=ma(a.szTitleLower),a.fRedraw=!0);q(b.boxupper)&&(a.szBoxUpper=b.boxupper,a.nBoxUpper=ma(a.szBoxUpper),a.fRedraw=!0);q(b.boxlower)&&(a.szBoxLower=b.boxlower,a.nBoxLower=
ma(a.szBoxLower),a.fRedraw=!0);q(b.shadowupper)&&(a.szShadowUpper=b.shadowupper,a.nShadowUpper=ma(a.szShadowUpper),a.fRedraw=!0);q(b.shadowlower)&&(a.szShadowLower=b.shadowlower,a.nShadowLower=ma(a.szShadowLower),a.fRedraw=!0);q(b.declutterupper)&&(a.szDeclutterUpper=b.declutterupper,a.nDeclutterUpper=ma(a.szdeclutterUpper),a.fRedraw=!0);q(b.aggregationupper)&&(a.szAggregationUpper=b.aggregationupper,a.nAggregationUpper=ma(a.szAggregationUpper),a.fRedraw=!0);q(b.aggregationlower)&&(a.szAggregationLower=
b.aggregationlower,a.nAggregationLower=ma(a.szAggregationLower),a.fRedraw=!0);q(b.clipupper)&&(a.szClipUpper=b.clipupper,a.nClipUpper=ma(a.szClipUpper),a.fRedraw=!0);q(b.cliplower)&&(a.szClipLower=b.cliplower,a.nClipLower=ma(a.szClipLower),a.fRedraw=!0);q(b.minvaluesize)&&(a.nValueSizeMin=K(a.nValueSizeMin,Number(b.minvaluesize),f),a.fRedraw=!0);q(b.minvaluevalue)&&(a.nValueValueMin=K(a.nValuevalueMin,Number(b.minvaluevalue),f),a.fRedraw=!0);q(b.clipvaluesize)&&(a.nValueSizeMin=K(a.nValueSizeMin,
Number(b.clipvaluesize),f),a.fRedraw=!0);q(b.minsize)&&(a.nChartSizeMin=K(a.nChartSizeMin,Number(b.minsize),f),a.fRedraw=!0);q(b.minchartsize)&&(a.nChartSizeMin=K(a.nChartSizeMin,Number(b.minchartsize),f),a.fRedraw=!0);q(b.maxcharts)&&(a.nMaxCharts=K(a.nMaxCharts,Number(b.maxcharts),f),a.nMaxCharts=Math.max(1,Math.round(a.nMaxCharts)),a.unpaintMap(),a.fRedraw=!0);q(b.sizepow)&&(a.nSizePow=K(a.nSizePow,Number(b.sizepow),f),a.fRedraw=!0);q(b.outlierscale)&&(a.nOutlierScale=K(a.nOutlierScale,Number(b.outlierscale),
f),a.fRedraw=!0);q(b.clipsize)&&(a.nChartSizeMin=K(a.nChartSizeMin,Number(b.clipsize),f),a.fRedraw=!0);q(b.clipparts)&&(a.nClipParts=Number(b.clipparts),a.fRedraw=!0);q(b.showparts)&&(a.szShowParts=b.showparts,a.szShowPartsA=b.showparts.split(b.showparts.match(/\|/)?"|":","),map.Themes.unmarkClass(null,c),a.fRedraw=!0);q(b.clipframerate)&&(a.nClipFrameRate=K(a.nClipFrameRate||1,Number(b.clipframerate),f),a.nClipTimeout=1/a.nClipFrameRate*1E3,a.fRedraw=!0);q(b.refresh)&&(a.nRefreshTimeout=Number(b.refresh)*
1E3,a.fRealize=!0);q(b.refreshtimeout)&&(a.nRefreshTimeout=Number(b.refreshtimeout),a.fRealize=!0);q(b.gridx)&&(a.nGridX=Number(b.gridx)||7,a.fRedraw=!0);q(b.gridwidth)&&(a.szAggregationField=null,b.gridwidth=="auto"?a.nGridWidthPx=a.nGridWidthPx||50:String(b.gridwidth).match(/px/)?a.nGridWidthPx=K(a.nGridWidthPx||1,Number(b.gridwidth),f):f=="factor"?q(a.nGridWidthPx)?a.nGridWidthPx=K(a.nGridWidthPx||1,Number(b.gridwidth),f):a.nGridWidth=K(a.nGridWidth||1E3,Number(b.gridwidth),f):(a.nGridWidthPx=
null,a.nGridWidth=K(a.nGridWidth||1,Number(b.gridwidth),f)),a.fRealize=!0,a.fRedraw=!0,a.fSuppressAggregationScale=!0,a.themeNodesPosA=[],a.unpaintMap());q(b.gridmatrix)&&(a.szAggregationField=null,a.nGridMatrix=K(a.nGridMatrix||1,Number(b.gridmatrix),f),a.fRealize=!0,a.fRedraw=!0,a.fSuppressAggregationScale=!0,a.unpaintMap(),a.themeNodesPosA=[]);q(b.gridwidthpx)&&(a.szAggregationField=null,a.nGridWidthPx=K(a.nGridWidthPx||50,Number(b.gridwidthpx),f),a.fRealize=!0,a.fRedraw=!0,a.fSuppressAggregationScale=
!0,a.unpaintMap(),a.themeNodesPosA=[]);q(b.gridoffsetx)&&(a.nGridOffsetX=K(a.nGridOffsetX||0,Number(b.gridoffsetx),f),a.fRealize=!0,a.fRedraw=!0,a.fSuppressAggregationScale=!0,a.unpaintMap(),a.themeNodesPosA=[]);q(b.gridoffsety)&&(a.nGridOffsetY=K(a.nGridOffsetY||0,Number(b.gridoffsety),f),a.fRealize=!0,a.fRedraw=!0,a.fSuppressAggregationScale=!0,a.unpaintMap(),a.themeNodesPosA=[]);q(b.aggregationfield)&&(a.szAggregationField=b.aggregationfield,a.fRealize=!0,a.fRedraw=!0,a.fSuppressAggregationScale=
!0,a.unpaintMap(),a.themeNodesPosA=[]);q(b.snippet)&&(a.szSnippet=unescape(b.snippet),a.fRealize=!0);q(b.title)&&(a.szTitle=unescape(b.title),a.fRealize=!0);q(b.units)&&(a.szUnits=unescape(b.units),a.fRealize=!0);q(b.child)&&(a.fChild=!0)}a.fRedrawInfo=!0;map.Themes.execute()}};ixMap.Themes.prototype.getThemeLayerList=function(){for(var c=[],b,f=0;f<this.themesA.length;f++)if(this.themesA[f].objThemesA&&!this.themesA[f].fRemove)for(b in this.themesA[f].objThemesA)c[c.length]=b;return c};ixMap.Themes.prototype.isThemeLayerUsed=
function(c){for(var b=this.getThemeLayerList(),f=0;f<b.length;f++)if(c==b[f])return!0;return!1};ixMap.Themes.prototype.isNodePartOfAnyTheme=function(c){if(c=map.Layer.getLayerObjOfNode(c))for(var b=map.Themes.getThemeLayerList(),f=0;f<b.length;f++)if(c.szName==b[f])return!0;return!1};ixMap.Themes.prototype.resetThemeNodesCache=function(){this.themeNodesA=[];this.themeNodes=0};ixMap.Themes.prototype.addToThemeNodesCache=function(c){var b=0;c=c.getElementsByTagName("g");for(var f=0;f<c.length;f++){var a=
String(map.Tiles.getMasterId(c.item(f).getAttributeNS(null,"id")));a&&(map.Themes.themeNodesA[a]||(map.Themes.themeNodesA[a]=[]),map.Themes.themeNodesA[a].push(c.item(f)),map.Themes.themeNodes++,b++)}};ixMap.Themes.prototype.removeFromThemeNodesCache=function(c){var b=0;c=c.getElementsByTagName("g");for(var f=0;f<c.length;f++){var a=String(map.Tiles.getMasterId(c.item(f).getAttributeNS(null,"id")));if(a&&map.Themes.themeNodesA[a]){var p=map.Themes.themeNodesA[a].indexOf(c.item(f));p>-1&&(map.Themes.themeNodesA[a].splice(p,
1),b++)}}};ixMap.Themes.prototype.setActive=function(c){this.activeTheme=c};ixMap.Themes.prototype.minimizeInfo=function(c,b){if(c=this.getTheme(b)){var f=c.widgetNode.firstChild;if(f){b=Number(f.getAttributeNS(szMapNs,"titleheight"));b<=0&&(b=420);f=f.childNodes;for(var a=0;a<f.length;a++){var p=f.item(a),m=p.getAttributeNS(null,"id");m.match(/body/)&&p.style.setProperty("display","none","");m.match(/footer/)&&p.style.setProperty("display","none","");m.match(/backgroundrect/)&&(p.setAttributeNS(szMapNs,
"maxheight",p.getAttributeNS(null,"height")),p.setAttributeNS(null,"height",b));m.match(/shadowrect/)&&(p.setAttributeNS(szMapNs,"maxheight",p.getAttributeNS(null,"height")),p.setAttributeNS(null,"height",String(b-100)));m.match(/minimizebutton/)&&p.style.setProperty("display","none","")}c.minimizebutton.nodeObj.style.setProperty("display","none","");c.morebutton.nodeObj.style.setProperty("display","none","");c.addDefinitionToFlag("MINIMIZED")}}};ixMap.Themes.prototype.maximizeInfo=function(c,b){if(c=
this.getTheme(b))if(b=c.widgetNode.firstChild){b=b.childNodes;for(var f=0;f<b.length;f++){var a=b.item(f),p=a.getAttributeNS(null,"id");p.match(/body/)&&a.style.setProperty("display","inline","");p.match(/footer/)&&a.style.setProperty("display","inline","");p.match(/backgroundrect/)&&a.setAttributeNS(null,"height",a.getAttributeNS(szMapNs,"maxheight"));p.match(/shadowrect/)&&a.setAttributeNS(null,"height",a.getAttributeNS(szMapNs,"maxheight"));p.match(/minimizebutton/)&&a.style.setProperty("display",
"inline","")}c.minimizebutton.nodeObj.style.setProperty("display","inline","");c.morebutton.nodeObj.style.setProperty("display","inline","");c.removeDefinitionFromFlag("MINIMIZED")}};ixMap.Themes.prototype.getChartAll=function(c,b,f){for(var a=b.getAttributeNS(null,"id"),p=0,m=0;m<this.themesA.length;m++){var w=map.Dom.newGroup(b,a+":C1");this.getChart(c,w,f,this.themesA[m]);var C=map.Dom.getBox(w);C.width<0&&(C=new box(0,0,0,0));w.fu.setPosition(0,p);p+=C.height+map.Scale.normalY(10);this.themesA[m].szFlag.match(/AGGREGATE/)&&
(C=c.split("::")[0]+"::"+this.themesA[m].getNodePosition(c).x+","+this.themesA[m].getNodePosition(c).y,this.getChart(C,w,f,this.themesA[m]),C=map.Dom.getBox(w),C.width<0&&(C=new box(0,0,0,0)),w.fu.setPosition(0,p),p+=C.height+map.Scale.normalY(10))}};ixMap.Themes.prototype.getChart=function(c,b,f,a){a||(a=this.activeTheme);if(!a)return null;c&&c.substr(c.length-6,6)==":paint"&&(c=c.substr(0,c.length-6));if(a.szFlag.match(/CHOROPLETH/)&&a.szFlag.match(/DOMINANT|COMPOSE/)){var p=30;a.nOrigSumA.length>
2&&(p=15*a.nOrigSumA.length/Math.log(a.nOrigSumA.length));f=map.Dom.newGroup(b,b.getAttributeNS(null,"id")+":1");if(a.szFlag.match(/PERCENTOFMEAN/)||a.szFlag.match(/PERCENTOFMEDIAN/)||a.szFlag.match(/DEVIATION/)){a.drawChart(f,c,p,"CHART|BAR|VALUES|ZOOM",c&&a.itemA[c]?a.itemA[c].nDominant:null);var m=map.Dom.getBox(f);m.width<0&&(m=new box(0,0,0,0));f=map.Dom.newGroup(b,b.getAttributeNS(null,"id")+":2");b=a.szUnit;a.szUnit="";a.drawChart(f,c,p,"VALUES|ZOOM|XAXIS");a.szUnit=b;c=map.Dom.getBox(f);b=
a.nOrigSumA.length>1?m.width/c.width*1.015:c.width/c.height;f.fu.setPosition(c.x-m.x,m.height+m.y+Math.min(map.Scale.normalY(200),Math.max(map.Scale.normalY(10),-c.y+map.Scale.normalY(6))));f.fu.scale(b,1);a=a.szFlag.match(/PERCENTOFMEDIAN/)?"median":"mean";c=c.width;map.Dom.newText(f,c,map.Scale.normalY(.9),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText(a));map.Dom.newText(f,c,map.Scale.normalY(5.5),"font-family:arial;font-size:"+map.Scale.normalY(4)+
"px;fill:#808080",map.Dictionary.getLocalText("-"));map.Dom.newText(f,c,map.Scale.normalY(-3.7),"font-family:arial;font-size:"+map.Scale.normalY(4)+"px;fill:#808080",map.Dictionary.getLocalText("+"))}else b="CHART|BAR|SPACED|VALUES|ZOOM",a.szFlag.match(/3D/)&&(b+="|3D"),a.szFlag.match(/\bSORT\b/)&&(b+="|SORT"),a.szFlag.match(/HORZ/)&&(b+="|HORZ|AXIS"),a.drawChart(f,c,p,b,null);return new point(0,map.Scale.normalY(30))}if(a.szFlag.match(/BUFFER/)&&a.szFlag.match(/CHART/))return null;if(a.szFlag.match(/CHOROPLETH/)&&
a.itemA[c])return p=a.itemA[c].nValuesA[a.nActualFrame||0],f=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,1),a.szFlag.match(/CATEGORICAL/)&&a.szLabelA&&a.szLabelA.length?p=a.szLabelA[p-1]:(m=a.nMax-a.nMin<10?2:0,p=a.formatValue(p,a.nValueDecimals||m)+a.szUnit),a.szFlag.match(/\bCLIP\b/)&&a.szXaxisA&&map.Dom.newText(b,-40,-280,__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.8)+";font-weight:normal;fill:#888888",a.szXaxisA[a.nActualFrame]),map.Dom.newText(b,-40,0,f+";font-weight:normal;stroke:#ffffff;stroke-width:20;stroke-opacity:0.3",
p),map.Dom.newText(b,-40,0,f+";font-weight:normal;fill:#444444",p),__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.8),!a.szFlag.match(/CATEGORICAL/)&&(a.szChoroplethInfoStyle.match(/HISTOGRAM/)||a.szChoroplethInfoStyle.match(/histogram/)||a.szChoroplethInfoStyle.match(/CLASSES/)||a.szChoroplethInfoStyle.match(/classes/))&&(p=a.szChoroplethInfoStyle.match(/HISTOGRAM/)||a.szChoroplethInfoStyle.match(/histogram/),f=map.Dom.newGroup(b,b.getAttributeNS(null,"id")+":histogram"),this.getHistogram(c,
f,p?"DISTRIBUTION":"CLASSES",a),f.fu.setPosition(0,map.Scale.normalY(4))),new point(0,0);if(a.szFlag.match(/INFOSIZE/))return a.drawChart(b,c,30,f);p=30;a.szFlag.match(/SEQUENCE/)&&(p=25);a.szFlag.match(/BAR/)&&(a.szFlag.match(/STACKED/)?p=300:a.nOrigSumA.length<=2?p=30:(a.szFlag.match(/\bUP\b/)||a.szFlag.match(/CENTER/)||a.szFlag.match(/SEQUENCE/),p=15*a.nOrigSumA.length/Math.log(a.nOrigSumA.length)));return a.drawChart(b,c,p,f)};ixMap.Themes.prototype.getSummary=function(c,b){b||(b=this.activeTheme);
if(!b||!c)return null;if(!b.itemA[c]){var f=c.split("::");f.length>1&&(c=f[0]+"::"+String(f[1]).toUpperCase())}if(!b.itemA[c])return null;f=b.itemA[c].nOrigValuesA;for(var a=0,p=0;p<f.length;p++)isNaN(f[p])&&(f[p]=0),a+=f[p];b.szFlag.match(/DIFFERENCE/)&&(a=f[f.length-1]);if(b.itemA[c].nValue100A[0]){b.szUnits100=b.szUnits100||"";if(b.szFlag.match(/RELATIVE/)||b.szFlag.match(/DIFFERENCE/))return map.Dictionary.getLocalText("Relative to")+": "+String(b.formatValue(b.itemA[c].nValue100A[0],b.nValueDecimals||
0))+" "+(b.szUnits100||"");if(b.itemA[c].nSize){if(b.szAggregation.match(/sum/))return map.Dictionary.getLocalText("Counted")+": "+String(b.formatValue(b.itemA[c].nSize,b.nValueDecimals||0))+" "+(b.szUnits100||"")}else if(a!=b.itemA[c].nValue100A[0])return String(__formatValue(a,2))+" / "+String(b.formatValue(b.itemA[c].nValue100A[0],b.nValueDecimals||0))+" "+(b.szUnits100||"")}else if(b.itemA[c].nSize){if(b.szFlag.match(/CATEGORICAL/)&&b.itemA[c].nValuesA.length==1&&b.szValueField)return b.szLabelA[b.itemA[c].nValuesA[0]-
1]}else{if(b.itemA[c].nAlpha)return map.Dictionary.getLocalText("Alpha value")+": "+String(b.formatValue(b.itemA[c].nAlpha,b.nValueDecimals||0))+" "+(b.szAlphaValueUnits||"");!b.szFlag.match(/SUM/)||b.szFlag.match(/SEQUENCE/)||b.szFlag.match(/\bCLIP\b/)}return null};ixMap.Themes.prototype.getValueComment=function(c,b){b||(b=this.activeTheme);if(!b||!c)return null;if(!b.itemA[c]){var f=c.split("::");f.length>1&&(c=f[0]+"::"+String(f[1]).toUpperCase())}if(!b.itemA[c])return null;f=b.itemA[c].nOrigValuesA;
for(var a=0;a<f.length;a++)isNaN(f[a])&&(f[a]=0);b.szFlag.match(/DIFFERENCE/);return b.szFlag.match(/OFFSETMEAN/)?map.Dictionary.getLocalText("value")+": "+String(__formatValue(b.itemA[c].nValuesA[0],2))+" "+map.Dictionary.getLocalText("mean")+": "+String(__formatValue(b.nMeanA[0],2)):null};ixMap.Themes.prototype.getTitle=function(c,b){b||(b=this.activeTheme);if(!b||!c)return null;c=String(map.Tiles.getMasterId(c));if(!b.itemA[c]){var f=c.split("::");f.length>1&&(c=f[0]+"::"+String(f[1]).toUpperCase())}return b.itemA[c]?
b.itemA[c].szTitle||null:null};ixMap.Themes.prototype.getLabel=function(c,b){b||(b=this.activeTheme);if(!b||!c)return null;if(!b.itemA[c]){var f=c.split("::");f.length>1&&(c=f[0]+"::"+String(f[1]).toUpperCase())}return b.itemA[c]?b.itemA[c].szLabel||null:null};ixMap.Themes.prototype.getTextObjects=function(){for(var c=[],b=0;b<this.themesA.length;b++)if((this.themesA[b].szLabelField||this.themesA[b].szFlag.match(/TEXTONLY/))&&this.themesA[b].chartGroup)if(typeof this.themesA[b].markedClass!="undefined"&&
this.themesA[b].markedClass!=null)for(var f=this.themesA[b].markedClass,a=this.themesA[b].chartGroup.getElementsByTagName("text"),p=0;p<a.length;p++)a.item(p).firstChild.nodeValue.length>0&&Number(a.item(p).getAttributeNS(szMapNs,"class"))==f&&c.push(a.item(p));else for(a=this.themesA[b].chartGroup.getElementsByTagName("text"),p=0;p<a.length;p++)a.item(p).firstChild.nodeValue.length>0&&c.push(a.item(p));return c};ixMap.Themes.prototype.getMaxValue=function(c,b){b||(b=this.activeTheme);if(!b||!c)return null;
var f=0;c=b.itemA[c].nValuesA;for(b=0;b<c.length;b++)isNaN(c[b])&&(c[b]=0),f=Math.max(f,c[b]);return f};ixMap.Themes.prototype.getDataRow=function(c,b){b||(b=this.activeTheme);if(!b||!c)return null;if(!b.itemA[c]){var f=c.split("::");f&&f.length>1&&(c=f[0]+"::"+String(f[1]).toUpperCase())}if(!b.itemA[c])return null;f=b.objThemesA[b.szThemesA[0]];var a=[];if(b.szDataFieldsA)for(var p=0;p<b.szDataFieldsA.length;p++)for(var m=0;m<f.dbFields.length;m++)b.szDataFieldsA[p]==f.dbFields[m].id&&a.push(m);
else for(m=0;m<f.dbFields.length;m++)a.push(m);var w=[];if(f.dbRecords){if(typeof b.itemA[c].dbIndexA!="undefined"&&b.itemA[c].dbIndexA.length){for(var C in b.itemA[c].dbIndexA)for(C>0&&w.push("--------------------"),m=0;m<a.length;m++)w.push(f.dbFields[a[m]].id);for(C in b.itemA[c].dbIndexA)for(C>0&&w.push("--------------------"),p=b.itemA[c].dbIndexA[C],m=0;m<a.length;m++)w.push(f.dbRecords[p][a[m]]);return w}if(typeof b.itemA[c].dbIndex!="undefined"){p=b.itemA[c].dbIndex;for(m=0;m<a.length;m++)w.push(f.dbFields[a[m]].id);
for(m=0;m<a.length;m++)w.push(f.dbRecords[p][a[m]]);return w}c=c.split("::")[1];for(p=0;p<f.dbRecords.length;p++)if(f.dbRecords[p]&&f.dbRecords[p][f.nFieldSelectionIndex]&&String(f.dbRecords[p][f.nFieldSelectionIndex]).toUpperCase()==String(c).toUpperCase()){for(m=0;m<f.dbFields.length;m++)w.push(f.dbFields[m].id);for(m=0;m<f.dbFields.length;m++)w.push(f.dbRecords[p][m]);break}}return w};ixMap.Themes.prototype.getFieldIndexArray=function(c){c||(c=this.activeTheme);if(!c||c.szDataFieldsA)return[];
c.fieldIndexArray=[];for(var b=0;b<c.objThemesA[c.szThemesA[0]].nFieldIndexA.length;b++)c.fieldIndexArray.push(c.objThemesA[c.szThemesA[0]].nFieldIndexA[b]);for(b=0;b<c.objThemesA[c.szThemesA[0]].nField100IndexA.length;b++)c.fieldIndexArray.push(c.objThemesA[c.szThemesA[0]].nField100IndexA[b]);return c.fieldIndexArray};ixMap.Themes.prototype.getScatterArray=function(c,b,f){c||(c=this.activeTheme);var a=c.nMin,p=c.nMax,m=0,w;f.match(/LOG/)?(m=1-a,a=Math.log(a+m),p=Math.log(p+m)):f.match(/POW2/)&&(m=
1-a,a=Math.pow(a+m,.5),p=Math.pow(p+m,.5));f.match(/POW3/)&&(m=1-a,a=Math.pow(a+m,1/3),p=Math.pow(p+m,1/3));p=(p-a)/b;for(var C=[],z=0;z<b+1;z++)C[z]=0;for(w in c.itemA)z=c.itemA[w].nValuesA[0],typeof z=="number"&&(f.match(/LOG/)?z=Math.log(z+m):f.match(/POW2/)?z=Math.pow(z+m,.5):f.match(/POW3/)&&(z=Math.pow(z+m,1/3)),C[Math.max(0,Math.min(b-1,Math.floor((z-a)/p)))]++);return C};ixMap.Themes.prototype.getResolutionQualityOfArray=function(c){for(var b=c.length,f=-1E6,a=0;a<b;a++)f=Math.max(f,c[a]);
var p=0;for(a=0;a<b;a++)c[a]>f/10&&p++;return p/b*100};ixMap.Themes.prototype.getDeviationOfArray=function(c){for(var b=c.length,f=0,a=0,p=0;p<b;p++)f+=c[p];f/=b;for(p=0;p<b;p++)a+=(c[p]-f)*(c[p]-f);return Math.sqrt(a/b)};ixMap.Themes.prototype.getHistogram=function(c,b,f,a){if(!b)return null;a||(a=this.activeTheme);if(!a||a.nMin==a.nMax)return null;if(c){if(!a.itemA[c]){var p=c.split("::");p.length>1&&(c=p[0]+"::"+String(p[1]).toUpperCase())}if(!a.itemA[c])return null}this.histGroup=map.Dom.newGroup(b,
b.getAttributeNS(null,"id")+":group");this.histFlag=f;this.histTheme=a;b=map.Scale.normalX(70);f=map.Scale.normalY(20);map.Dom.newShape("rect",this.histGroup,0,0,b-map.Scale.normalX(.5),f,"fill:none;stroke:none;");c?(map.Themes.makeHistogram(c),setTimeout(function(){map.Themes.makeHistogram(c)},100)):setTimeout(function(){map.Themes.makeHistogram()},100)};ixMap.Themes.prototype.makeHistogram=function(c){var b=this.histGroup,f=this.histFlag,a=this.histTheme;if(f.match("CLASSES")){for(var p=map.Scale.normalX(50),
m=map.Scale.normalY(5),w,C=0,z=0,y=c?a.itemA[c].nValuesA[0]:0,O=0,t=0;t<a.partsA.length;t++){w=p/a.nCount*a.partsA[t].nCount;var d=map.Dom.newShape("rect",b,C,z,w,m,"fill:"+a.colorScheme[t]+";stroke:black;stroke-width:1;");d&&d.setAttributeNS(szMapNs,"tooltip",a.szLegendLabelA[t]+" ("+a.formatValue(a.partsA[t].nCount)+" "+map.Dictionary.getLocalText("members")+")");C+=w;y>a.partsA[t].max?O+=w:y>a.partsA[t].min&&(O+=w/(a.partsA[t].max-a.partsA[t].min)*(y-a.partsA[t].min))}map.Dom.newShape("circle",
b,O,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#444444;stroke:none;")}else if(f.match("DISTRIBUTION")){if(!isFinite(a.nMin)||!isFinite(a.nMax))return b;O=Math.min(500,Math.max(20,a.nCount/5));p=map.Scale.normalX(70);m=map.Scale.normalY(12);f.match("INTERACTIVE")&&(m=map.Scale.normalY(20));var e=p/O;y=c?a.itemA[c].nValuesA[0]:0;var g=0,l=a.nMin,u=a.nMax,k=0,v=this.getScatterArray(a,O,"");t=this.getDeviationOfArray(v);C=this.getScatterArray(a,O,"LOG");z=this.getDeviationOfArray(C);var x=!1,H=
(u-l)/O;z&&z<t&&(v=C,k=1-l,l=Math.log(l+k),u=Math.log(u+k),y=Math.log(y+k),H=(u-l)/O,x=!0);for(t=0;t<O;t++)g=Math.max(g,v[t]);C=-20;z=0;a.histogram=new ixMap.Histogram(a);a.histogram.fDoLog=x;a.histogram.dValue=k;a.histogram.nWidth=p;a.histogram.nMin=l;a.histogram.nMax=u;var G=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4),P=0;for(t=0;t<a.partsA.length;t++){w=(x?p/(u-l)*(Math.min(u,Math.log(a.partsA[t].max+k))-l):p/(u-l)*(Math.min(u,a.partsA[t].max)-l))-C;d=1;if(a.szFlag.match(/DOPACITY/)){d=
a.partsA[t].min+(a.partsA[t].max-a.partsA[t].min)/2;var M=1/(a.nDopacityPow||1);d=a.szFlag.match(/DOPACITYMINMAX/)?d>=a.nMedianA[0]?Math.pow(Math.abs(d-a.nMedianA[0]),M)/Math.pow(a.nMax-a.nMedianA[0],M)*(a.fillOpacity||1)*(a.nDopacityScale||1):Math.pow(Math.abs(d-a.nMedianA[0]),M)/Math.pow(a.nMedianA[0]-a.nMin,M)*(a.fillOpacity||1)*(a.nDopacityScale||1):a.szFlag.match(/DOPACITYMIN/)?Math.pow(a.nMax-d,M)/Math.pow(a.nMax-a.nMin,M)*(a.fillOpacity||1)*(a.nDopacityScale||1):a.szFlag.match(/DOPACITYMAX/)?
Math.pow(d-a.nMin,M)/Math.pow(a.nMax-a.nMin,M)*(a.fillOpacity||1)*(a.nDopacityScale||1):a.szFlag.match(/DOPACITYLOG/)?Math.log(d-a.nMin)/Math.log(a.nMedianA[0]-a.nMin)*.5*(a.fillOpacity||1)*(a.nDopacityScale||1):a.szFlag.match(/DOPACITY/)?(d-a.nMin)/(a.nMedianA[0]-a.nMin)*.5*(a.fillOpacity||1)*(a.nDopacityScale||1):(t+O/10)/O}if(d=map.Dom.newShape("rect",b,C,z,w,m,"fill:"+a.colorScheme[t]+";fill-opacity:"+d+";stroke:black;stroke-width:"+map.Scale.normalX(.2)+";stroke-opacity:0.1"))d.setAttributeNS(szMapNs,
"tooltip",a.szLegendLabelA[t]+" ("+a.formatValue(a.partsA[t].nCount)+" "+map.Dictionary.getLocalText("members")+")"),d.setAttributeNS(szMapNs,"onoverstyle","fill:"+a.colorScheme[t]+";stroke:black;stroke-width:"+map.Scale.normalX(.5)+";"),d.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+a.szId+"','"+t+"','1')"),d.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+a.szId+"')");a.histogram.classRectA[t]=d;a.histogram.classRectXA[t]=C;a.histogram.classRectWidthA[t]=w;a.histogram.classRectMaxA[t]=
a.partsA[t].max;if(f.match("INTERACTIVE")){d=map.Dom.newGroup(b,"");M=null;if(t>0){map.Dom.newShape("line",d,C,z-map.Scale.normalY(2),C,z+m,"stroke:black;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.5");if(M=map.Dom.newShape("rect",d,C-map.Scale.normalY(1.5),z-map.Scale.normalY(6),map.Scale.normalX(3),map.Scale.normalY(5),"fill:"+a.colorScheme[t]+";stroke:black;styroke-width(1);"))M.setAttributeNS(null,"rx",map.Scale.normalX(2)),M.setAttributeNS(null,"ry",map.Scale.normalY(1.5));M=map.Dom.newText(d,
C,z-map.Scale.normalY(7),G+"display:none;font-weight:normal;text-anchor:middle",a.formatValue(a.partsA[t-1].max,1))}d=new Slider(d,new box(-P,0,P+w,0));d.setId(String(t));d.parent=a.histogram;d.textObj=M;P=w}C+=w}C=e/3;z=0;w=.9;t=this.getResolutionQualityOfArray(v);t<10&&(w=10-t);for(t=0;t<O;t++){u=v[t]/g*m*w;d=x?Math.exp(l+t*H)-k:l+t*H;P=x?Math.exp(l+(t+1)*H)-k:l+(t+1)*H;G="black";u=u&&!isNaN(u)?Math.min(m,Math.max(map.Scale.normalY(.5),u)):0;if(G=map.Dom.newShape("line",b,C,z+m,C,z+m-u,"stroke:"+
G+";stroke-width:"+e+";"))G.setAttributeNS(szMapNs,"tooltip",a.formatValue(d,2)+" ... "+a.formatValue(P,2)+a.szUnit+" ("+v[t]+" members)"),G.setAttributeNS(szMapNs,"onoverstyle","stroke:yellow;stroke-width:"+Math.max(map.Scale.normalX(1),e)+";");C+=e}map.Dom.newShape("line",b,-map.Scale.normalX(.5),m+1,p-map.Scale.normalX(.5),m+1,"stroke:black;stroke-width:"+map.Scale.normalX(.1)+";");O=-map.Scale.normalX(.5);p-=map.Scale.normalX(.5);C=map.Scale.normalX(2);map.Dom.newShape("line",b,O,m,O,m+C,"stroke:black;stroke-width:"+
map.Scale.normalX(.2)+";");map.Dom.newShape("line",b,p,m,p,m+C,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");w=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4);z=map.Scale.tStyle.Summary.nFontHeight*.4;v=m+C+z*.8;t=a.formatValue(a.nMin,0);g=a.formatValue(a.nMax,0);map.Dom.newText(b,O-10,v,w+";font-weight:normal;text-anchor:start",t);a.nMin<0&&a.nMax>0&&(O=(0-l)/H*e,map.Dom.newShape("line",b,O,m,O,m+C,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";"),map.Dom.newText(b,O,v,w+
";font-weight:normal;text-anchor:start","0"));u=0;for(t=10;t<a.nMax;t*=10)for(G=1;G<9&&!(t*G>a.nMax||t*G<a.nMin);G++)O=((x?Math.log(t*G+k):t*G)-l)/H*e,d=a.formatValue(t*G,0),O>u+d.length*z*3/8?(map.Dom.newShape("line",b,O,m,O,m+C,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";"),map.Dom.newText(b,O,v,w+";font-weight:normal;text-anchor:middle",d),u=O+d.length*z*3/8):map.Dom.newShape("line",b,O,m,O,m+C/2,"stroke:black;stroke-width:"+map.Scale.normalX(.2)+";");p>u+g.length*z*3/8&&map.Dom.newText(b,
p,v,w+";font-weight:normal;text-anchor:middle;",g);c&&!f.match("INTERACTIVE")&&(O=(y-l)/H*e,map.Dom.newShape("circle",b,O,-map.Scale.normalX(.1),map.Scale.normalX(1),"fill:#dd0000;stroke:none;"),map.Dom.newShape("line",b,-10,-5,O-10,-5,"stroke:#000000;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3"))}else{p=map.Scale.normalX(70);m=map.Scale.normalY(12);w=p/700;z=C=0;u=a.nMax;c=m/u;e=Math.max(1,Math.ceil(a.nCount/700));f=[];l=0;k=[];for(y in a.itemA)k.push(a.itemA[y].nValuesA[0]);k.sort(a.sortUp);
for(y in k)l%e?f[f.length-1]+=k[y]/e:f[f.length]=k[y]/e,l++;f.sort(a.sortUp);for(t=0;t<f.length;t++){d=f[t];u=f[t]*c*.9;G="black";for(y=0;y<a.partsA.length;y++)if(f[t]<a.partsA[y].max){G=a.colorScheme[y];break}G=map.Dom.newShape("line",b,C,z,C,m,"stroke:"+G+";stroke-width:"+w+";");G.setAttributeNS(szMapNs,"tooltip",a.formatValue(d,2)+a.szUnit);isNaN(u)&&(u=0);G=map.Dom.newShape("line",b,C,z+m,C,z+m-u,"stroke:#000000;stroke-width:"+w+";");G.setAttributeNS(szMapNs,"tooltip",a.formatValue(d,2)+a.szUnit);
C+=w}t=a.formatValue(a.nMin,0);g=a.formatValue(a.nMax,0);w=__scaleStyleString(map.Scale.tStyle.Summary.szStyle,.4);map.Dom.newText(b,C+map.Scale.normalX(1),z+m,w+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",t);map.Dom.newText(b,C+map.Scale.normalX(1),z+map.Scale.normalY(3.5),w+";font-weight:normal;text-anchor:start;stroke-opacity:0.8;",g);b&&b.fu.scale(p/C,1)}return b};ixMap.Histogram=function(c){this.mapTheme=c;this.fDoLog=!1;this.dValue=0;this.classRectA=[];this.classRectXA=[];this.classRectWidthA=
[];this.classRectMaxA=[]};ixMap.Histogram.prototype=new Map;ixMap.Histogram.prototype.onMouseOver=function(c,b,f){f.textObj&&f.textObj.style.setProperty("display","inline","")};ixMap.Histogram.prototype.onMouseOut=function(c,b,f){f.textObj&&f.textObj.style.setProperty("display","none","")};ixMap.Histogram.prototype.onMouseMove=function(c,b,f){if(c=this.classRectA[Number(b)])c.setAttributeNS(null,"x",this.classRectXA[Number(b)]+f.value.x),c.setAttributeNS(null,"width",this.classRectWidthA[Number(b)]-
f.value.x);if(c=this.classRectA[Number(b)-1]){c.setAttributeNS(null,"width",this.classRectWidthA[Number(b)-1]+f.value.x);var a=this.nMin+(this.nMax-this.nMin)/this.nWidth*(this.classRectXA[Number(b)]+f.value.x);a=this.fDoLog?Math.exp(a)-this.dValue:a;this.classRectMaxA[Number(b)-1]=a}f.textObj&&(f.textObj.firstChild.nodeValue=__formatValue(a,1))};ixMap.Histogram.prototype.onMouseUp=function(c,b,f){(f=this.classRectA[Number(b)-1])&&(this.classRectWidthA[Number(b)-1]=f.getAttributeNS(null,"width"));
b="ranges:"+String(this.nMin);for(f=0;f<this.classRectMaxA.length;f++)b+=","+String(this.classRectMaxA[f]);map.Themes.changeThemeStyle(c,this.mapTheme.szId,b)};ixMap.Themes.prototype.showErrorInfo=function(c,b){(c=this.getTheme(b))&&c.showErrorInfo()};ixMap.Themes.prototype.redraw=function(c){return this.actualize(c)};ixMap.Themes.prototype.actualizeActiveTheme=function(c){return this.actualize(c)};ixMap.Themes.prototype.actualize=function(c){for(var b=0;b<this.themesA.length;b++)if(c&&c!=1&&this.themesA[b].szFlag.match(/FEATURE/)&&
(this.themesA[b].nFeatureUpper||this.themesA[b].nFeatureLower)&&(this.themesA[b].fDone||(this.themesA[b].fRealize=!this.themesA[b].fDone),setTimeout("map.Themes.execute()",100)),this.themesA[b].fDone)if(this.themesA[b].szFlag.match(/WMS/))this.themesA[b].fRealize=!0,executeWithMessage(()=>map.Themes.execute(),"...",100);else if(this.themesA[b].szFlag.match(/FEATURE/)&&this.themesA[b].szFlag.match(/CLIPTOGEOBOUNDS|CLIPTOVIEW/))this.themesA[b].fRealize=!0,executeWithMessage(()=>map.Themes.execute(),
"...",100);else{if(this.themesA[b].szFlag.match(/CHART/)&&(this.themesA[b].__fClipToGeoBounds&&(this.themesA[b].fRealize=!0),c&&c!=1&&this.themesA[b].szFlag.match(/DYNAMICSCALE/)&&(this.themesA[b].nScale*=Math.sqrt(c),this.themesA[b].fRealize=!0),c&&c!=1&&this.themesA[b].szFlag.match(/BEZIER/)&&(this.themesA[b].fRedraw=!0),this.themesA[b].szFlag.match(/DECLUTTER/)&&(this.themesA[b].fDeclutter=!0,map.Themes.execute()),c&&c!=1)){if(this.themesA[b].fRealizeDone){if(this.themesA[b].szAggregationFieldA){for(var f=
this.themesA[b].nGridWidth,a=this.themesA[b].szAggregationField,p=0;p<this.themesA[b].szAggregationFieldA.length;p++){var m=Number(this.themesA[b].szAggregationFieldA[p].split(":")[1]);m&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>m&&(isNaN(parseFloat(this.themesA[b].szAggregationFieldA[p+1]))?this.themesA[b].szAggregationField=this.themesA[b].szAggregationFieldA[p+1]:(this.themesA[b].szAggregationFieldA[p+1].match(/px/)?this.themesA[b].nGridWidthPx=parseFloat(this.themesA[b].szAggregationFieldA[p+
1]):(this.themesA[b].nGridWidth=parseFloat(this.themesA[b].szAggregationFieldA[p+1]),this.themesA[b].nGridWidthPx=0),this.themesA[b].szAggregationField=null));p++}this.themesA[b].szAggregationField!=a||this.themesA[b].nGridWidth!=f?(this.themesA[b].fRealize=!0,this.themesA[b].themeNodesPosA=[]):this.themesA[b].fRedraw=!0}this.themesA[b].nGridWidthPx?(f=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.themesA[b].nGridWidthPx),1E3),this.themesA[b].nGridWidth=f/map.Scale.nZoomScale,this.themesA[b].fRealize=
!0,this.themesA[b].themeNodesPosA=[]):this.themesA[b].nGridMatrix&&(f=map.Zoom.getBox(),f=map.Scale.getDistanceInMeter(1E3,1E3,1E3+f.width,1E3),this.themesA[b].nGridWidth=f/(this.themesA[b].nGridMatrix||20)/map.Scale.nZoomScale,this.themesA[b].fRealize=!0,this.themesA[b].themeNodesPosA=[]);if(this.themesA[b].szAggregationUpper||this.themesA[b].szAggregationLower)this.themesA[b].fRealize=this.themesA[b].szAggregationUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.themesA[b].nAggregationUpper||
this.themesA[b].szAggregationLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.themesA[b].nAggregationLower?this.themesA[b].__fAggregate!=0:this.themesA[b].__fAggregate==0}this.themesA[b].autoOpacity&&(this.themesA[b].fRedraw=!0);if(this.themesA[b].nValueUpper||this.themesA[b].nValueLower||this.themesA[b].nChartUpper||this.themesA[b].nChartLower||this.themesA[b].nBoxUpper||this.themesA[b].nBoxLower||this.themesA[b].nTitleUpper||this.themesA[b].nTitleLower||this.themesA[b].nLabelUpper||this.themesA[b].nLabelLower||
this.themesA[b].nMaxCharts)this.themesA[b].fRedraw=!0}this.themesA[b].fRealize?(this.themesA[b].fRedraw=!1,this.themesA[b].fActualize=!1):this.themesA[b].fActualize=this.themesA[b].fRedraw?!1:!0}executeWithMessage(()=>map.Themes.execute(),"working ...",100);return null};ixMap.Themes.prototype.resortCharts=function(c){var b=!1;if(this.themesA.length){for(var f=0;f<this.themesA.length;f++)this.themesA[f].fDone&&(b=this.themesA[f].fResort=!0);b&&map.Themes.execute()}c&&(c.stopPropagation(),c.preventDefault())};
ixMap.Themes.prototype.clear=function(){this.themesA.length=0};B.prototype.getFields=function(){this.szFields=this.theme.szFields;this.szFieldsA=this.theme.szFields.split("|");for(var c in this.szFieldsA)this.szFieldsA[c]=this.szFieldsA[c].trim();this.theme.szFieldsA=this.szFieldsA;this.szField100A=this.theme.szField100A;this.szColorField=this.theme.szColorField;this.szSymbolField=this.theme.szSymbolField;this.szValueField=this.theme.szValueField;this.szLabelField=this.theme.szLabelField;this.szTitleField=
this.theme.szTitleField;this.szSnippetField=this.theme.szSnippetField;this.szSizeField=this.theme.szSizeField;this.szAlphaField=this.theme.szAlphaField;this.szAlphaField100=this.theme.szAlphaField100;this.szXField=this.theme.szXField;this.szYField=this.theme.szYField;this.szTimeField=this.theme.szTimeField;this.szFilterField=this.theme.szFilterField;this.szAggregationField=this.theme.szAggregationField;this.szSelectionFieldsA=(this.theme.szSelectionField||"").split("|");this.nFieldIndexA[0]=-1;this.nFieldSelectionIndexA[0]=
-1;this.theme.szSelectionField2&&(this.szSelectionField2=this.theme.szSelectionField2||null,this.szSelectionFields2A=(this.theme.szSelectionField2||"").split("|"),this.nFieldSelection2IndexA=[-1]);var b=this.coTable?this.coTable:this.szName;if(!this.szFields||this.szFields==="")return!0;try{eval("this.dbTable = "+b+".table")}catch(a){try{eval("this.dbTable = "+b+"_table")}catch(p){}}if(this.coTable&&!this.dbTable)return displayMessage("Data not loaded!",1E3,!0),!1;if(this.dbTable){try{eval("this.dbFields = "+
b+".fields")}catch(a){try{eval("this.dbFields = "+b+"_fields")}catch(p){}}this.dbTable.fields=this.dbFields.length;if(this.dbTable.fields==0||this.dbTable.records==0)return!1;try{this.szSelectionField||(this.szSelectionField=map.Layer.getLayerObj(this.szName).szSelection)}catch(a){return alert("no selection field found !!"),!1}for(c=0;c<this.dbTable.fields;c++)if(!this.dbFields||this.dbFields.length===0||!this.dbFields[c])return alert("ERROR: theme '"+this.szName+"' - table '"+b+"' - object 'fields' incorrect !"),
!1;if(this.szFields=="$table$"){this.szFieldsA=[];for(c=0;c<this.dbFields.length;c++)this.dbFields[c].id!=this.szSelectionField&&this.dbFields[c].id!="Total"&&this.szFieldsA.push(this.dbFields[c].id);this.theme.szFields=this.szFieldsA.join("|");this.theme.szFieldsA=this.szFieldsA;this.theme.szLabelA=this.szFieldsA}for(c=0;c<this.dbFields.length;c++){typeof this.szItemField!="undefined"&&String(this.dbFields[c].id).toLowerCase()==String(this.szItemField).toLowerCase()&&(this.nFieldItemIndex=c);typeof this.szSelectionField!=
"undefined"&&String(this.dbFields[c].id).toLowerCase()==String(this.szSelectionField).toLowerCase()&&(this.nFieldSelectionIndex=c);if(typeof this.szSelectionField2!="undefined")for(String(this.dbFields[c].id).toLowerCase()==String(this.szSelectionField2).toLowerCase()&&(this.nFieldSelection2Index=c),b=0;b<this.szSelectionFields2A.length;b++)this.dbFields[c].id==this.szSelectionFields2A[b]&&(this.nFieldSelection2IndexA[b]=c);for(b=0;b<this.szSelectionFieldsA.length;b++)this.dbFields[c].id==this.szSelectionFieldsA[b]&&
(this.nFieldSelectionIndexA[b]=c);for(b=0;b<this.szFieldsA.length;b++)this.szFieldsA[b].substr(0,1)=="!"?this.dbFields[c].id==this.szFieldsA[b].substr(1,this.szFieldsA[b].length-1)&&(this.nFieldIndexA[b]=c):this.dbFields[c].id==this.szFieldsA[b]&&(this.nFieldIndexA[b]=c);if(this.szField100A)for(b=0;b<this.szField100A.length;b++)this.dbFields[c].id==this.szField100A[b]&&(this.nField100IndexA[b]=c);this.szColorField&&this.dbFields[c].id==this.szColorField&&(this.nColorFieldIndex=c);this.szSymbolField&&
this.dbFields[c].id==this.szSymbolField&&(this.nSymbolFieldIndex=c);this.szValueField&&this.dbFields[c].id==this.szValueField&&(this.nValueFieldIndex=c);this.szLabelField&&this.dbFields[c].id==this.szLabelField&&(this.nLabelFieldIndex=c);this.szTitleField&&this.dbFields[c].id==this.szTitleField&&(this.nTitleFieldIndex=c);this.szSnippetField&&this.dbFields[c].id==this.szSnippetField&&(this.nSnippetFieldIndex=c);this.szSizeField&&this.dbFields[c].id==this.szSizeField&&(this.nSizeFieldIndex=c);this.szTimeField&&
this.dbFields[c].id==this.szTimeField&&(this.nTimeFieldIndex=c);this.szXField&&this.dbFields[c].id==this.szXField&&(this.nXFieldIndex=c);this.szYField&&this.dbFields[c].id==this.szYField&&(this.nYFieldIndex=c);this.szAlphaField&&this.dbFields[c].id==this.szAlphaField&&(this.nAlphaFieldIndex=c);this.szAlphaField100&&this.dbFields[c].id==this.szAlphaField100&&(this.nAlphaField100Index=c);this.szFilterField&&this.dbFields[c].id==this.szFilterField&&(this.nFilterFieldIndex=c);this.szAggregationField&&
this.dbFields[c].id==this.szAggregationField&&(this.nAggregationFieldIndex=c)}this.nFieldSelectionIndex==-1&&this.nFieldSelectionIndexA[0]==-1&&(this.szSelectionField&&this.szSelectionField.length?_ERROR("ERROR on load theme data: selection field '"+this.szSelectionField+"' not found !"):_ERROR("ERROR on load theme data: selection not defined !"));for(b=0;b<this.szFieldsA.length;b++)if(typeof this.nFieldIndexA[b]=="undefined")return _ERROR("ERROR on load theme data: value field '"+this.szFieldsA[b]+
"' not found !"),!1;if(this.szField100A)for(b=0;b<this.szField100A.length;b++)if(typeof this.nField100IndexA[b]=="undefined")return _ERROR("ERROR on load theme data: value 100 field '"+this.szFieldsA[b]+"' not found !"),!1;this.szColorField&&!this.szColorField.match(/\$/)&&typeof this.nColorFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: colorfield: '"+this.szColorField+"' not found !");this.szSymbolField&&!this.szSymbolField.match(/\$/)&&typeof this.nSymbolFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: symbolfield: '"+
this.szSymbolField+"' not found !");this.szValueField&&!this.szValueField.match(/\$/)&&typeof this.nValueFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: valuefield: '"+this.szValueField+"' not found !");this.szLabelField&&!this.szLabelField.match(/\$/)&&typeof this.nLabelFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: labelfield '"+this.szLabelField+"' not found !");this.szTitleField&&!this.szTitleField.match(/\$/)&&typeof this.nTitleFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: titlefield '"+
this.szTitleField+"' not found !");this.szSnippetField&&!this.szSnippetField.match(/\$/)&&typeof this.nSnippetFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: snippetfield '"+this.szSnippetField+"' not found !");this.szSizeField&&!this.szSizeField.match(/\$/)&&typeof this.nSizeFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: sizefield '"+this.szSizeField+"' not found !");this.szTimeField&&!this.szTimeField.match(/\$/)&&typeof this.nTimeFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: timefield '"+
this.szTimeField+"' not found !");this.szXField&&!this.szXField.match(/\$/)&&typeof this.nXFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: xfield '"+this.szXField+"' not found !");this.szYField&&!this.szYField.match(/\$/)&&typeof this.nYFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: yfield '"+this.szYField+"' not found !");this.szAlphaField&&!this.szAlphaField.match(/\$/)&&typeof this.nAlphaFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: alphafield '"+this.szAlphaField+
"' not found !");this.szAlphaField100&&!this.szAlphaField100.match(/\$/)&&typeof this.nAlphaField100Index=="undefined"&&_ERROR("ERROR on load theme data: alpha100field '"+this.szAlphaField100+"' not found !");this.szFilterField&&!this.szFilterField.match(/\$/)&&typeof this.nFilterFieldIndex=="undefined"&&_ERROR("ERROR on load theme data: filterfield '"+this.szFilterField+"' not found !");this.szAggregationField&&!this.szAggregationField.match(/\$/)&&typeof this.nAggregationFieldIndex=="undefined"&&
_ERROR("ERROR on load theme data: aggregationfield '"+this.szAggregationField+"' not found !");!this.szItemField||this.szItemField==this.szSelectionField||this.szItemField.match(/\$/)||typeof this.nFieldItemIndex!="undefined"&&this.nFieldItemIndex!=-1||alert("ERROR on load theme data: itemfield '"+this.szItemField+"' not found !")}else{c=map.SVGDocument.getElementById(this.szName);c==null&&(b=map.Tiles.getTileNodes(this.szName))&&(c=b[0]);if(!c)return this.szName="",!1;c=c.getAttributeNS(szMapNs,
"info");if(c==null||c==="")return this.szName="",!1;var f=c.split("|");for(c=0;c<f.length;c++){for(b=0;b<this.szFieldsA.length;b++)this.szFieldsA[b].substr(0,1)=="!"?f[c]==this.szFieldsA[b].substr(1,this.szFieldsA[b].length-1)&&(this.nFieldIndexA[b]=c):f[c]==this.szFieldsA[b]&&(this.nFieldIndexA[b]=c);for(b=0;b<this.szField100A.length;b++)f[c]==this.szField100A[b]&&(this.nField100IndexA[b]=c);this.szColorField&&f[c]==this.szColorField&&(this.nColorFieldIndex=c);this.szSymbolField&&f[c]==this.szSymbolField&&
(this.nSymbolFieldIndex=c);this.szValueField&&f[c]==this.szValueField&&(this.nValueFieldIndex=c);this.szLabelField&&f[c]==this.szLabelField&&(this.nLabelFieldIndex=c);this.szTimeField&&f[c]==this.szTimeField&&(this.nTimeFieldIndex=c);this.szSizeField&&f[c]==this.szSizeField&&(this.nSizeFieldIndex=c);this.szXField&&f[c]==this.szXField&&(this.nXFieldIndex=c);this.szYField&&f[c]==this.szXField&&(this.nYFieldIndex=c);this.szAlphaField&&f[c]==this.szAlphaField&&(this.nAlphaFieldIndex=c);this.szAlphaField100&&
f[c]==this.szAlphaField100&&(this.nAlphaField100Index=c)}}for(b=0;b<this.szFieldsA.length;b++)this.nFieldIndexA[b]<0&&(this.szFieldsA[b]!="$item$"&&this.szFieldsA[b]!="$index$"&&_ERROR("ERROR on load theme data: '"+this.szFieldsA[b]+"' not found !"),this.szName="");return!0};D.prototype.checkTheme=function(){if(!this.szThemesA)return!1;for(var c=0;c<this.szThemesA.length;c++)if(this.szThemesA[c]=="generic"||map.Layer.isLoaded(this.szThemesA[c]))return!0;this.ErrorMessage="theme layer not loaded ! zoom in ?";
return!1};D.prototype.def=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};D.prototype.getDefinitionObject=function(){return map.Themes.getMapThemeDefinitionObj(this.szId)};D.prototype.set=function(c){map.Themes.parseStyle(this,c)};D.prototype.setDefinitionObject=function(c){map.Themes.parseStyle(this,c)};D.prototype.initValues=function(){this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;for(var c=this.nNoData=this.nCount=this.nSum=0;c<this.szFieldsA.length;c++)this.nMinA[c]=
Number.MAX_VALUE,this.nMaxA[c]=-Number.MAX_VALUE,this.nSumA[c]=0,this.nOrigMinA[c]=Number.MAX_VALUE,this.nOrigMaxA[c]=-Number.MAX_VALUE,this.nOrigSumA[c]=0,this.nMedianA[c]=0,this.nMeanA[c]=0,this.nDeviationA[c]=0;this.nMin100=Number.MAX_VALUE;this.nMax100=-Number.MAX_VALUE;this.nSum100=0;this.itemA=[];this.posItemA=[];this.chartPosA=[];this.exactCountA=[];this.exactSizeA=[];this.quantileA=[];this.szAggregation||(this.szAggregation=this.szField100?"mean":"sum");if(this.szAggregationFieldA&&!this.fSuppressAggregationScale)for(c=
0;c<this.szAggregationFieldA.length;c++){var b=Number(this.szAggregationFieldA[c].split(":")[1]);b&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>b&&(isNaN(parseFloat(this.szAggregationFieldA[c+1]))?this.szAggregationField=this.szAggregationFieldA[c+1]:(this.szAggregationFieldA[c+1].match(/px/)?this.nGridWidthPx=parseFloat(this.szAggregationFieldA[c+1]):(this.nGridWidth=parseFloat(this.szAggregationFieldA[c+1]),this.nGridWidthPx=0),this.szAggregationField=null));c++}this.fSuppressAggregationScale=
!1;this.nWrongRecordLengthCount=0;this.missedA=[];this.coTable&&this.coTable!="genericTable"||!this.loadTableFromMap()||(this.coTable="genericTable")};D.prototype.removeValues=function(){this.missedA=this.quantileA=this.exactSizeA=this.exactCountA=this.chartPosA=this.posItemA=this.itemA=null};D.prototype.getMeanMedianQuantile=function(){if(!this.quantileA||!this.quantileA.length)for(var c=0;c<this.nMaxA.length;c++){var b=[],f=0,a;for(a in this.itemA)b.push(this.itemA[a].nValuesA[c]),f+=this.itemA[a].nValuesA[c];
this.szFieldsA[c]&&this.szFieldsA[c]!="$item$"&&b.sort(this.sortUp);this.nMedianA[c]=b[Math.round(b.length/2)];this.nMeanA[c]=f/b.length;this.quantileA[c]=b}};D.prototype.getHeadTail=function(){var c=[],b;for(b in this.itemA)c.push(this.itemA[b].nValuesA[0]);return{mean:function(f){var a=f.length;return f.reduce(function(p,m){return p+m},0)/a},headTail:function(f){var a=Math.min.apply(null,f),p=this.mean(f);a=[a];for(a.push(p);f.length>1;)f=f.filter(function(m){return m>p}),p=this.mean(f),a.push(p);
return a}}.headTail(c)};D.prototype.realize=function(){_LOG("theme realize start - "+this.szId+this.szFlag);if(this.szFlag.match(/WMS/)){this.chartGroup||(this.chartGroup=map.Dom.newGroup(map.Layer.layerNode,this.szThemesA[0]),map.Layer.listA[this.szThemesA[0]]=new ixMap.Layer.Item(null),map.Layer.listA[this.szThemesA[0]].szName=this.szThemesA[0],this.isChecked=this.fDone=!0);var c=map.Zoom.getBoundsOfMapInGeoBounds(),b=map.Scale.viewBox.width/map.Zoom.nZoomX,f=map.Scale.viewBox.height/map.Zoom.nZoomY,
a=map.Scale.bBox.width/20,p=map.Scale.bBox.height/20;this.nLayerLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nLayerLower?this.clearWMS():this.nLayerUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nLayerUpper?this.clearWMS():(map.Dom.constructNode("image",this.chartGroup,{"xlink:href":this.szServer+"?f=image&transparent=true&bbox="+c[0].x+","+c[0].y+","+c[1].x+","+c[1].y+"&bboxSR=4326&size="+a+","+p,x:-map.Scale.mapCenter.x/map.Zoom.nZoomX-b/2,y:-map.Scale.mapCenter.y/map.Zoom.nZoomY-
f/2,style:"width:"+b+";height:"+f+";opacity:"+(this.nOpacity||.8)+";pointer-events:none;",onload:'map.Themes.getTheme("'+this.szId+'").cleanWMS();'}),this.fDone=!0)}else if(!this.szFlag.match(/FEATURE/)||!(this.nFeatureLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nFeatureLower||this.nFeatureUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nFeatureUpper)){if(this.szFlag.match(/CHART|CHOROPLETH/)&&(!this.nChartLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nChartLower)&&
(!this.nChartUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nChartUpper))for(c in b=map.Themes.getAllThemes(),b)if(b[c]!=this&&b[c].szFlag.match(/FEATURE/)&&b[c].szThemesA[0]==this.szThemesA[0]&&!b[c].fDone){this.fRealize=!0;setTimeout("map.Themes.execute()",500);return}if(this.coTable){this.__test=null;try{eval("this.__test = "+this.coTable+".table")}catch(w){try{eval("this.__test = "+this.coTable+"_table")}catch(C){}}if(!this.__test){map.Themes.loadExternalData(this.coTable,this.nRefreshTimeout,
this);this.fRealize=!0;return}}b=new Date;this.fShowProgressBar=!0;this.initValues();if(this.getFields()&&this.loadValues())if(this.szFlag.match(/\bPOSITION\b/)){_LOG("start");b=this.szThemesA[0];f=this.objThemesA[b];a=f.nFieldItemIndex;p=f.nFieldSelectionIndexA[0];var m=f.nFieldSelectionIndexA[1];for(c in f.dbRecords)map.Themes.themeNodesPosA[b+"::"+f.dbRecords[c][a]]=map.Scale.getMapPositionOfLatLon(Number(f.dbRecords[c][p].replace(",",".")),Number(f.dbRecords[c][m].replace(",",".")));_LOG("stop");
this.fDraw=this.fAnalyze=!1;this.fDone=!0}else this.fDone=!1,this.timeLoading=new Date-b,(this.timeLoading>1E3||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage(()=>map.Themes.executeContinue(),this.szFlag.match(/AGGREGATE/)?"aggregating":"parsing data"):map.Themes.executeContinue()}};D.prototype.cleanWMS=function(){this.chartGroup.childNodes.length>1&&this.chartGroup.removeChild(this.chartGroup.firstChild)};D.prototype.clearWMS=function(){map.Dom.clearGroup(this.chartGroup)};
D.prototype.realize_analyze=function(){var c=new Date;(this.fDraw=this.distributeValues())||this.realizeDone();this.timeAggregating=new Date-c;(this.timeLoading>1E3||this.szFlag.match(/VERBOSE/))&&!this.szFlag.match(/SILENT/)?executeWithMessage(()=>map.Themes.executeContinue(),"drawing"):map.Themes.executeContinue()};D.prototype.realize_draw=function(){var c=map.Layer.getLayerObj(this.szThemesA[0]);c&&(this.szShapeType=c.szType,this.szShapeType=="line"&&this.szOrigFlag.match(/BUFFER/)&&(this.szShapeType+=
"+buffer"));this.szOrigFlag.match(/FEATURE/)&&this.szOrigFlag.match(/LINES/)&&(this.szShapeType="line");_LOG("theme draw start - "+this.szId);this.timeStart=new Date;this.nActualFrame=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nSkipCount=this.nDoneCount=0;c=this.szFlag.match(/VERBOSE/)?"drawing":"";this.mapSleep=new ixMap.Sleep("map.Themes.executeContinue",this.nflushPaintShape,map.Dictionary.getLocalText(c));this.mapSleep.nCount=this.nCount;this.mapSleep.szCancel="map.Themes.cancelExecute()";
this.szFlag.match(/\bCLIP\b/)&&(this.mapSleep=null,this.nClipIncr=1);this.szFlag.match(/FEATURE/)?(this.mapSleep=null,this.unpaintMap(),this.chartGroup&&this.fClearOnProjectionChange&&(this.chartGroup.style.setProperty("display","inline",""),map.Dom.clearGroup(this.chartGroup),this.fClearOnProjectionChange=!1),this.chartMap()):this.szFlag.match(/CHART/)?(this.mapSleep&&(this.mapSleep.initCheckSleep(this.nflushChartDraw,c),this.mapSleep.fShowProgressBar=!0),this.chartMap()):(this.unlabelMap(),this.paintMap(),
this.makeVisible());this.isChecked=!0;!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/SYMBOL/)||this.szFlag.match(/BAR/)&&this.colorScheme&&this.nOrigSumA&&this.nOrigSumA.length!=this.colorScheme.length?this.isMarkable=!0:this.isMarkable=!1};D.prototype.realizeContinue=function(c){this.fMakeLabel?this.labelMap(c):this.szFlag.match(/CHART/)?this.chartMap(c):this.paintMap(c)};D.prototype.realizeNextClipFrame=function(){if(this.szFlag.match(/\bCLIP\b/)&&
!this.fClipPause){var c=this.szId;this.nActualFrame+=this.nClipIncr;this.nActualFrame>=this.nClipFrames?this.szFlag.match(/BACK/)?(this.nClipIncr=-this.nClipIncr,this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(c)},1E3)):this.szFlag.match(/LOOP/)?(this.nActualFrame=-1,this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(c)},1E3)):(this.nActualFrame=this.nClipFrames-1,this.pauseClip()):this.nActualFrame<0?this.szFlag.match(/BACK/)?(this.nClipIncr=-this.nClipIncr,this.clipTimeout=
setTimeout(function(){map.Themes.nextClipFrame(c)},10)):(this.nActualFrame=0,this.pauseClip()):(this.mapSleep=null,this.szFlag.match(/CHART/)?(this.chartPosA=[],this.posItemA=[],this.fDone=!1,this.fRedraw=!0,this.chartMap()):this.paintMap(),this.fRedrawInfo=!0)}};D.prototype.setClipFrame=function(c){this.fClipPause=!0;this.nActualFrame=Math.min(c,this.nClipFrames);this.mapSleep=null;this.szFlag.match(/CHART/)?(this.chartPosA=[],this.posItemA=[],this.fDone=!1,this.chartMap()):this.paintMap();this.fRedrawInfo=
!0};D.prototype.startClip=function(c){var b=map.SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");b&&b.style.setProperty("display","inline","");(b=map.SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&b.style.setProperty("display","none","");this.fClipPause=!1;this.nActualFrame=c||this.nActualFrame;this.realizeNextClipFrame()};D.prototype.pauseClip=function(){var c=map.SVGDocument.getElementById(this.szId+":display:widget:clippausebutton:button");
c&&c.style.setProperty("display","none","");(c=map.SVGDocument.getElementById(this.szId+":display:widget:clipstartbutton:button"))&&c.style.setProperty("display","inline","");this.clipTimeout&&clearTimeout(this.clipTimeout);this.fClipPause=!0};D.prototype.realizeDone=function(){var c=this.szId;this.nRefreshTimeout&&(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(function(){map.Themes.refreshTheme(c)},this.nRefreshTimeout));if(this.szFlag.match(/\bCLIP\b/)){this.szFlag.match(/\bPAUSE\b/)&&
(this.removeDefinitionFromFlag("PAUSE"),this.fClipPause=!0);if(this.szFlag.match(/\bLAST\b/)){this.removeDefinitionFromFlag("LAST");var b=this.nClipFrames-1;setTimeout(function(){map.Themes.setClipFrame(c,b)},10)}this.clipTimeout&&clearTimeout(this.clipTimeout);this.clipTimeout=setTimeout(function(){map.Themes.nextClipFrame(c)},this.nActualFrame?this.nClipTimeout:1E3)}this.nWrongRecordLengthCount&&map.fDebug&&displayMessage("Data Error:  "+this.nWrongRecordLengthCount+" items have wrong record length",
1E4,"notify");this.fRealize=this.fRedraw=!1;this.fDone=!0;this.timeRealizing=new Date-this.timeStart;_LOG("theme done - "+this.szId);this.szFlag.match(/SHOW/)&&(this.removeDefinitionFromFlag("SHOW"),this.zoomTo());this.szFlag.match(/ZOOMTO/)&&(this.removeDefinitionFromFlag("ZOOMTO"),this.zoomTo());map.Themes.realizeDone(this)};D.prototype.beginDraw=function(){};D.prototype.endDraw=function(){};D.prototype.redraw=function(c){if(!this.szFlag.match(/FEATURE/)){this.clipTimeout&&clearTimeout(this.clipTimeout);
this.fDataIncomplete&&this.__themeNodes!=map.Themes.themeNodes&&(this.fDataIncomplete=!1,this.initValues(),this.loadValues(),this.distributeValues());if(this.szFlag.match(/CHART/)){if(this.fClipCharts||this.fRedraw)this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nDoneCount=this.nSkipCount=0,this.chartMap()}else if(this.isChecked){if(this.partsA)for(var b=0;b<this.partsA.length;b++)this.partsA[b].nCount=0,this.partsA[b].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,
"painting map");this.makeVisible();this.paintMap()}c&&this.enable()}};D.prototype.toFront=function(){if(this.szFlag.match(/CHART/)){this.chartGroup.parentNode.appendChild(this.chartGroup);var c=getMatrix(this.chartGroup);c&&setMatrix(this.chartGroup,c);this.enable()}else if(this.isChecked){for(c=0;c<this.partsA.length;c++)this.partsA[c].nCount=0,this.partsA[c].nSum=0;this.mapSleep&&this.mapSleep.initCheckSleep(this.nflushPaintShape,"painting map");this.paintMap()}else this.enable()};D.prototype.getFields=
function(){for(var c=0;c<this.szThemesA.length;c++){var b=this.szThemesA[c];this.objThemesA[b]=new B(b,c,this.coTable,this.szSelectionField,this.szItemField);this.objThemesA[b].theme=this;if(!this.objThemesA[b].getFields()){try{map.HTMLWindow.ixmaps.htmlgui_onErrorTheme(b)}catch(f){}return!1}}return!0};D.prototype.addItemValues=function(c,b,f,a,p){if(!this.szFlag.match(/RAW/)||f|a|p){var m;if(this.szExcludeA)for(m=0;m<this.szExcludeA.length;m++)if(c.split("::")[1]==this.szExcludeA[m])return;if(!(this.nField100Min&&
f&&f[0]&&f[0]<this.nField100Min)){if(this.nMinValue&&b&&!f){var w=!1;for(m=b.length-1;m>=0;m--)b[m]>=this.nMinValue&&(w=!0);if(!w)return}w=1;if(this.__fDensity||this.__fDensityAlpha)if(w=this.getNodeArea(c),!w&&this.__fTiledLayer){this.fDataIncomplete=!0;return}if(this.szWeights)for(m=0;m<b.length;m++)b[m]*=this.szWeightsA[m]||this.szWeightsA[0];if(this.__fAuto100){var C=0;for(m=0;m<b.length;m++)C+=b[m]||0;for(m=0;m<b.length;m++)f[m]=C;this.fField100=!0}this.itemA[c]={nOrigValuesA:[],nValuesA:b,nValue100A:f,
nValueSum:0};for(m=0;m<b.length;m++)this.itemA[c].nOrigValuesA[m]=isNaN(b[m])?0:b[m],this.itemA[c].nValueSum+=b[m]||0,this.fField100&&(f?(C=b[m],C!==0||this.szFlag.match(/ZEROISVALUE/)?this.szFieldsA[m].substr(0,1)=="!"?(C=f[m]-C,this.itemA[c].nOrigValuesA[m]=C):this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?(C=f[m]?Math.round(C*f[m]/100):C,this.itemA[c].nOrigValuesA[m]=C):this.szFlag.match(/PRODUCT/)?C=f[m]?C*f[m]:C:this.szFlag.match(/DIFFERENCE/)&&b.length==1&&!this.szFlag.match(/RELATIVE/)?
(f[m]=m>0?b[m-1]:this.itemA[c].nValue100A[m],C-=f[m]):(C=f[m]?C/f[m]:1,this.szFlag.match(/FRACTION/)?C*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?C*=1E3:(C*=100,C>0&&this.szFlag.match(/RELATIVE/)?C-=100:C>0&&this.szFlag.match(/INVERT/)&&(C=100-C))):C=0,b[m]=C):b[m]=0),this.__fDensity&&(b[m]=w?b[m]/w:null);if(this.__fDifference&&b.length>1){for(m=0;m<b.length;m++)m<b.length-1?(C=b[m],b[m]=b[m+1]-b[m],this.szFlag.match(/RELATIVE/)&&(b[m]=C?100/C*b[m]:b[m]?100:0)):this.szFlag.match(/STACKED/)||
(b[m]=0);b.pop()}for(m=0;m<b.length;m++){if(!this.nSumA)return;!isNaN(b[m])&&isFinite(b[m])&&(this.nMin=Math.min(this.nMin,b[m]),this.nMax=Math.max(this.nMax,b[m]),this.nSum+=b[m],this.nMinA[m]=Math.min(this.nMinA[m],b[m]),this.nMaxA[m]=Math.max(this.nMaxA[m],b[m]),this.nSumA[m]+=b[m],this.nOrigMinA[m]=Math.min(this.nOrigMinA[m],this.itemA[c].nOrigValuesA[m]),this.nOrigMaxA[m]=Math.max(this.nOrigMaxA[m],this.itemA[c].nOrigValuesA[m]),this.nOrigSumA[m]+=this.itemA[c].nOrigValuesA[m]);b[m]<0&&(this.fNegativeValues=
!0)}!isNaN(f[0])&&isFinite(f[0])&&(this.nMin100=Math.min(this.nMin100,f[0]),this.nMax100=Math.max(this.nMax100,f[0]),this.nSum100+=f[0]);this.szSizeField&&(!isNaN(a)&&isFinite(a)?(this.itemA[c].nSize=a,this.nMinSize=Math.min(this.nMinSize,a),this.nMaxSize=Math.max(this.nMaxSize,a),this.nSumSize+=a):this.itemA[c].nSize=0);this.szAlphaField&&p!=null&&!isNaN(p)&&isFinite(p)&&(this.__fDensityAlpha&&(p=w?p/w:0),this.itemA[c].nAlpha=p,this.nMinAlpha=Math.min(this.nMinAlpha,p),this.nMaxAlpha=Math.max(this.nMaxAlpha,
p),this.nSumAlpha+=p);if(this.__fExact&&this.exactCountA)for(m=0;m<b.length;m++)b[m]&&(this.exactCountA[b[m]-1]?(this.exactCountA[b[m]-1]++,this.exactSizeA[b[m]-1]+=this.itemA[c].nSize||1):(this.exactCountA[b[m]-1]=1,this.exactSizeA[b[m]-1]=this.itemA[c].nSize||1));this.nCount++}}else{this.itemA[c]={nOrigValuesA:[],nValuesA:b,nValue100A:f,nValueSum:0};for(m=0;m<b.length;m++){if(!this.nSumA)return;isNaN(b[m])||(this.nMin=Math.min(this.nMin,b[m]),this.nMax=Math.max(this.nMax,b[m]),this.nSum+=b[m]);
b[m]<0&&(this.fNegativeValues=!0);this.__fExact&&this.exactCountA&&b[m]&&(this.exactCountA[b[m]-1]?(this.exactCountA[b[m]-1]++,this.exactSizeA[b[m]-1]+=this.itemA[c].nSize||1):(this.exactCountA[b[m]-1]=1,this.exactSizeA[b[m]-1]=this.itemA[c].nSize||1))}this.nCount++}};D.prototype.getStringValueIndex=function(c,b){if(c.length===0||c==" ")if(this.szFlag.match(/UNDEFINEDISVALUE/))c="undefined";else return-1;this.szFlag.match(/IGNORECASE/)&&(c=c.toUpperCase());c=c.trim();typeof this.nStringToValueA[c]!=
"undefined"||this.szValuesA&&this.szValuesA.length&&b!="set"||(this.szLabelA=this.szLabelA||[],this.szExactA=this.szExactA||[],this.nStringToValueA[c]=this.nStringToValue,this.szLabelA[this.nStringToValue-1]=this.szLabelA[this.nStringToValue-1]||c,this.szExactA.push(this.nStringToValue),this.nStringToValue++);return this.nStringToValueA[c]};D.prototype.checkHiddenLayerState=function(){for(var c=0;c<this.szThemesA.length;c++)if(map.Layer.isScaleDependentLayer(this.szThemesA[c])&&(this.hiddenLayerA[this.szThemesA[c]]&&
map.Layer.isScaleDependentLayerOn(this.szThemesA[c])||!this.hiddenLayerA[this.szThemesA[c]]&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[c])))return!0;return!1};var ya=function(c){return String(c).match(/,/)?parseFloat(String(c).replace(/\./gi,"").replace(/,/gi,".")):parseFloat(String(c).replace(/ /gi,""))};D.prototype.loadValues=function(){this.nMissingLookupCount=0;this.__fExact=this.szFlag.match(/CATEGORICAL/);this.__fMax=this.szFlag.match(/\bMAX\b/);this.__fMin=this.szFlag.match(/\bMin\b/);
this.__fFirst=this.szFlag.match(/\bFIRST\b/);this.__fLast=this.szFlag.match(/\bLAST\b/);this.__fDifference=this.szFlag.match(/DIFFERENCE/);this.__fFilter=this.szFilter&&this.szFilter.length;this.__fDensity=this.szFlag.match(/DENSITY/);this.__fDensityAlpha=!this.szFlag.match(/CHART/)&&this.szAlphaField100&&this.szAlphaField100.match(/\$density\$/i);this.__fAggregate=this.szFlag.match(/AGGREGATE/);this.__fAuto100=this.szFlag.match(/AUTO100/)&&!this.szFlag.match(/AGGREGATE/);this.__fTiledLayer=map.Layer.getLayerObj(this.szThemesA[0])?
map.Layer.getLayerObj(this.szThemesA[0]).szFlag.match(/tiled/):!1;this.__themeNodes=map.Themes.themeNodes;for(var c=0;c<this.szThemesA.length;c++)if(map.Layer.isScaleDependentLayer(this.szThemesA[c])&&!map.Layer.isScaleDependentLayerOn(this.szThemesA[c]))this.fRealize=this.hiddenLayerA[this.szThemesA[c]]=!0;else if(this.hiddenLayerA[this.szThemesA[c]]=!1,!this.loadValuesOfTheme(this.szThemesA[c]))return!1;return!0};D.prototype.filterValues=function(c){if(this.szFilter.match(/WHERE/)){if(!this.objTheme.filterQueryA){for(var b=
this.szFilter.split("WHERE ")[1].split(" "),f=0;f<b.length;f++)if(b[f].length){if(b[f][0]=='"'&&b[f][b[f].length-1]!='"'){do b[f]=b[f]+" "+b[f+1],b.splice(f+1,1);while(b[f][b[f].length-1]!='"')}if(b[f][0]=="("&&b[f][b[f].length-1]!=")"){do b[f]=b[f]+" "+b[f+1],b.splice(f+1,1);while(b[f][b[f].length-1]!=")")}}else b.splice(f,1),f--;this.objTheme.filterQueryA=[];var a={};do{var p=0;b.length>=3&&(a={},a.szFilterField=b[0].replace(/("|)/g,""),a.szFilterOp=b[1],a.szFilterValue=b[2].replace(/("|)/g,""),
p=3);a.szFilterOp=="BETWEEN"&&b.length>=5&&b[3]=="AND"&&(a.szFilterValue2=b[4].replace(/("|)/g,""),p=5);if(p){if(a.szFilterField=="*")a.nFilterFieldIndex=-1;else for(f=0;f<this.objTheme.dbFields.length;f++)this.objTheme.dbFields[f].id==a.szFilterField&&(a.nFilterFieldIndex=f),"$"+this.objTheme.dbFields[f].id+"$"==a.szFilterValue&&(a.nFilterValueIndex=f);this.objTheme.filterQueryA.push(a);b.splice(0,p)}else{alert("ixmaps - filter error - incomplete query!\nquery: "+this.szFilter);break}if(b.length&&
b[0]=="AND")b.splice(0,1);else break}while(b.length)}for(var m in this.objTheme.filterQueryA)if(this.__szValue=this.objTheme.filterQueryA[m].nFilterFieldIndex==-1?this.objTheme.dbRecords[c].join("|"):String(this.objTheme.dbRecords[c][this.objTheme.filterQueryA[m].nFilterFieldIndex]),this.__szFilterOp=this.objTheme.filterQueryA[m].szFilterOp.toUpperCase(),this.__szFilterValue=this.objTheme.filterQueryA[m].szFilterValue,this.__szFilterValue2=this.objTheme.filterQueryA[m].szFilterValue2,this.objTheme.filterQueryA[m].nFilterValueIndex!=
null&&(this.__szFilterValue=String(this.objTheme.dbRecords[c][this.objTheme.filterQueryA[m].nFilterValueIndex])),b=ya(this.__szValue),!(this.__szFilterOp=="="?this.__szValue==this.__szFilterValue||b==Number(this.__szFilterValue):this.__szFilterOp=="!="?this.__szValue!=this.__szFilterValue&&b!=Number(this.__szFilterValue):this.__szFilterOp=="<>"?this.__szValue!=this.__szFilterValue&&b!=Number(this.__szFilterValue):this.__szFilterOp==">"?b>Number(this.__szFilterValue):this.__szFilterOp=="<"?b<Number(this.__szFilterValue):
this.__szFilterOp==">="?b>=Number(this.__szFilterValue):this.__szFilterOp=="<="?b<=Number(this.__szFilterValue):this.__szFilterOp=="LIKE"?this.__szFilterValue=="*"?this.__szValue.length:eval("this.__szValue.match(/"+this.__szFilterValue.replace(/\//gi,"\\/")+"/i)"):this.__szFilterOp=="NOT"?eval("!this.__szValue.match(/"+this.__szFilterValue.replace(/\//gi,"\\/")+"/i)"):this.__szFilterOp=="IN"?eval("this.__szFilterValue.match(/\\("+this.__szValue.replace(/\//gi,"\\/")+"\\)/)")||eval("this.__szFilterValue.match(/\\("+
this.__szValue.replace(/\//gi,"\\/")+"\\,/)")||eval("this.__szFilterValue.match(/\\,"+this.__szValue.replace(/\//gi,"\\/")+"\\,/)")||eval("this.__szFilterValue.match(/\\,"+this.__szValue.replace(/\//gi,"\\/")+"\\)/)"):this.__szFilterOp=="BETWEEN"?b>=Number(this.__szFilterValue)&&b<=Number(this.__szFilterValue2):eval("this.__szValue.match(/"+this.__szFilterValue.replace(/\//gi,"\\/")+"/i)")))return!1}else if(this.__szValue=this.objTheme.dbRecords[c].join(" "),!eval("this.__szValue.match(/"+this.szFilter+
"/i)"))return!1;return!0};D.prototype.getSelectionId=function(c,b){if(!this.fSelection){this.fSelection="lookup";if(this.objTheme.nFieldSelectionIndexA&&this.objTheme.nFieldSelectionIndexA.length>1)this.fSelection=this.szCRSDatum?"UTM":"LatLon",this.nSelection_0=this.objTheme.nFieldSelectionIndexA[0],this.nSelection_1=this.objTheme.nFieldSelectionIndexA[1];else if(this.objTheme.nFieldSelectionIndex>=0){var f=Y(String(this.objTheme.dbRecords[b][this.objTheme.nFieldSelectionIndex]));f.match(/MultiPoint/)?
this.fSelection="MultiPoint":f.match(/Point/i)?this.fSelection="MultiPoint":f.match(/LineString/)?this.fSelection="LineString":f.match(/MultiLineString/)?this.fSelection="MultiLineString":f.match(/Polygon/)?this.fSelection="MultiPolygon":f.match(/MultiPolygon/)&&(this.fSelection="MultiPolygon")}this.objTheme.nFieldSelection2IndexA&&this.objTheme.nFieldSelection2IndexA.length>1?(this.fSelection2=this.szCRSDatum?"UTM":"LatLon",this.nSelection2_0=this.objTheme.nFieldSelection2IndexA[0],this.nSelection2_1=
this.objTheme.nFieldSelection2IndexA[1]):typeof this.objTheme.nFieldSelection2Index!="undefined"&&(f=Y(String(this.objTheme.dbRecords[b][this.objTheme.nFieldSelection2Index])),f.match(/MultiPoint/)?this.fSelection2="MultiPoint":f.match(/Point/)?this.fSelection2="MultiPoint":this.fSelection2="mapshape")}if(this.fSelection=="LatLon"||this.fSelection=="UTM")return c+"::"+(String(this.objTheme.dbRecords[b][this.nSelection_0]).replace(/,/g,".")+","+String(this.objTheme.dbRecords[b][this.nSelection_1]).replace(/,/g,
"."))+(this.szSelectionFieldSuffix||"").replace(/,/g,".");if(this.fSelection=="Point"||this.fSelection=="MultiPoint"){f=this.objTheme.dbRecords[b][this.objTheme.nFieldSelectionIndex];var a;return(a=f.match(wa))?c+"::"+(a[2]+","+a[1])+(this.szSelectionFieldSuffix||""):null}return this.fSelection=="LineString"||this.fSelection=="MultiLineString"||this.fSelection=="Polygon"||this.fSelection=="MultiPolygon"?c+"::"+String(b)+(this.szSelectionFieldSuffix||""):this.objTheme.nFieldSelectionIndex>=0?(f=Y(String(this.objTheme.dbRecords[b][this.objTheme.nFieldSelectionIndex])),
this.nSelectionFieldDigits&&(f=("000000000000000"+f).slice(-this.nSelectionFieldDigits)),this.fSelectionFieldToNumber&&(f=String(Number(f))),this.fSelectionFieldToUpper&&(f=String(f).toUpperCase()),c+"::"+f+(this.szSelectionFieldSuffix||"")):null};D.prototype.loadValuesOfTheme=function(c){if(this.szFlag.match(/FAST/)||this.szFlag.match(/VECTOR/)||this.szFlag.match(/BEZIER/)||typeof this.szSelectionField2!="undefined"||this.szFlag.match(/AGGREGATE/)&&!this.szFlag.match(/COMPATIBLE|PERCENTOFMEAN/))return this.__fAggregateOnLoad=
!0,_LOG("loadAndAggregateValuesOfTheme ===>"),this.loadAndAggregateValuesOfTheme(c);var b,f;this.fNegativeValues=this.fField100=!1;this.szUnit=(this.szUnits?this.szUnits.substr(0,1)=="."?"":" ":"")+(this.szUnits||"");var a=!0;this.objTheme=this.objThemesA[c];this.objTheme.nField100IndexA[0]&&this.objTheme.nField100IndexA[0]>0&&(this.fField100=!0);if(this.objTheme.dbTable&&c&&c.length){if(this.coTable){try{eval("this.objTheme.dbRecords = "+this.coTable+".records")}catch(y){eval("this.objTheme.dbRecords = "+
this.coTable+"_records")}if(!this.objTheme.dbRecords)return displayMessage("Data "+this.coTable+" could not be loaded!",2E3,!0),!1}else try{eval("this.objTheme.dbRecords = "+c+".records")}catch(y){eval("this.objTheme.dbRecords = "+c+"_records")}this.objTheme.nFieldSelectionIndexA.length||delete this.objTheme.nFieldSelectionIndexA;if(this.szFieldsA[0]!="$item$"&&!this.szFlag.match(/CATEGORICAL/)){var p=Math.min(40,this.objTheme.dbRecords.length);for(b=0;b<p;b++)if(this.objTheme.dbRecords[b])for(f=
0;f<this.szFieldsA.length;f++){var m=this.objTheme.dbRecords[b][this.objTheme.nFieldIndexA[f]];if(ya(m)!=parseFloat(m)){this.__fScanValue=!0;b=p;break}}}for(b=0;b<this.objTheme.dbRecords.length;b++)if(!this.objTheme.dbRecords[b]||this.fCheckRecordLength&&this.objTheme.dbRecords[b].length<this.objTheme.dbFields.length)this.nWrongRecordLengthCount++;else if(!this.__fFilter||this.filterValues(b)){p=[];if(this.szFieldsA[0]=="$item$")p[0]=1;else if(this.szFieldsA[0]=="$index$")p[0]=b+1;else for(f=0;f<
this.szFieldsA.length;f++){m=this.objTheme.dbRecords[b][this.objTheme.nFieldIndexA[f]];this.__fExact?(m=this.valueMap?this.valueMap[String(m)]:m,m=this.getStringValueIndex(String(m))):m=this.__fScanValue?ya(m):parseFloat(m);if(isNaN(m))if(this.fUndefinedValuePossible)m=0;else continue;if(m!==0||this.fNullIsValue)m<0&&!this.fNegativeValuePossible||(p[f]=m)}p.length=this.szFieldsA.length;var w=[];if(this.szField100A&&this.szField100A.length){if(this.szField100A[0]=="$item$")w[0]=1;else for(f=0;f<this.szField100A.length;f++)if(m=
ya(this.objTheme.dbRecords[b][this.objTheme.nField100IndexA[f]]),m!==0||this.fNullIsValue)m<0&&!this.fNegativeValuePossible||(w[f]=m);if(w.length>0)for(f=w[w.length-1];w.length<this.szFieldsA.length;)w.push(f)}if(this.szSizeField&&this.szSizeField!="$item$"){var C=this.objTheme.dbRecords[b][this.objTheme.nSizeFieldIndex];C=this.valueMap?this.valueMap[String(C)]||ya(C):ya(C);C=isFinite(C)&&!isNaN(C)?C:0;if(C===0)continue;if(C<0)continue}else C=1;var z=null;this.szAlphaField&&(z=ya(this.objTheme.dbRecords[b][this.objTheme.nAlphaFieldIndex]),
isNaN(z)&&(z=0));this.szAlphaField100&&this.objTheme.nAlphaField100Index&&(z*=100/ya(this.objTheme.dbRecords[b][this.objTheme.nAlphaField100Index]),isNaN(z)&&(z=0));if(m=f=this.getSelectionId(c,b)){this.objTheme.nFieldItemIndex>=0&&this.objTheme.nFieldItemIndex!=this.objTheme.nFieldSelectionIndex&&(f=Y(String(this.objTheme.dbRecords[b][this.objTheme.nFieldItemIndex])),this.fSelectionFieldToUpper&&(f=String(f).toUpperCase()),f=c+"::"+f);if(this.itemA[f]){if(this.szFlag.match(/\bDOT\b/))continue;f+=
"*"+Math.random();if(this.itemA[f])continue}this.addItemValues(f,p,w,C,z);this.itemA[f]&&(this.szColorField&&(this.itemA[f].szColor=this.szColorField=="$index$"?b+1:Y(this.objTheme.dbRecords[b][this.objTheme.nColorFieldIndex])),this.szSymbolField&&(this.itemA[f].szSymbol=this.szSymbolField=="$index$"?b+1:Y(this.objTheme.dbRecords[b][this.objTheme.nSymbolFieldIndex])),this.szValueField&&(this.itemA[f].szValue=this.szValueField=="$index$"?b+1:Y(this.objTheme.dbRecords[b][this.objTheme.nValueFieldIndex])),
this.szTimeField&&(this.itemA[f].szTime=this.szTimeField=="$index$"?b+1:Y(this.objTheme.dbRecords[b][this.objTheme.nTimeFieldIndex]),isNaN(this.itemA[f].szTime)&&(this.itemA[f].szTime=this.itemA[f].szTime.replace(/ - /g,""))),this.szLabelField&&(this.itemA[f].szLabel=this.szLabelField=="$index$"?b+1:Y(this.objTheme.dbRecords[b][this.objTheme.nLabelFieldIndex])),this.szTitleField&&(this.itemA[f].szTitle=Y(this.objTheme.dbRecords[b][this.objTheme.nTitleFieldIndex])),this.szSnippetField&&(this.itemA[f].szSnippet=
Y(this.objTheme.dbRecords[b][this.objTheme.nSnippetFieldIndex])),this.itemA[f].szSelectionId=m?m:f,this.szAggregationField&&(this.itemA[f].szAggregation=Y(this.objTheme.dbRecords[b][this.objTheme.nAggregationFieldIndex])),this.szXField&&(this.itemA[f].nX=ya(this.objTheme.dbRecords[b][this.objTheme.nXFieldIndex]),isNaN(this.itemA[f].nX)||(this.nMinX=Math.min(this.nMinX,this.itemA[f].nX),this.nMaxX=Math.max(this.nMaxX,this.itemA[f].nX),this.nSumX+=this.itemA[f].nXField)),this.szYField&&(this.itemA[f].nY=
ya(this.objTheme.dbRecords[b][this.objTheme.nYFieldIndex]),isNaN(this.itemA[f].nY)||(this.nMinY=Math.min(this.nMinY,this.itemA[f].nY),this.nMaxY=Math.max(this.nMaxY,this.itemA[f].nY),this.nSumY+=this.itemA[f].nYField)),this.itemA[f].dbIndex=b)}else this.nMissingLookupCount++}}else a=!1;if(a)return this.fAnalyze=!0};D.prototype.loadAndAggregateValuesOfTheme=function(c,b){var f,a,p,m;if(!b){console.log("*** F A S T ***");this.fNegativeValues=this.fField100=!1;this.__fMultiParts=this.szFlag.match(/CATEGORICAL/)&&
!(this.szFlag.match(/PIE/)||this.szFlag.match(/BAR/)||this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/PLOT/)||this.szFlag.match(/DOMINANT/)||this.szFlag.match(/COMPOSECOLOR/)||this.szFlag.match(/\bUSER\b/)||this.szFlag.match(/WAFFLE/));this.__fClipToGeoBounds=!1;this.szFlag.match(/CLIPTOGEOBOUNDS/)&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<(this.nClipUpper||1E9)&&(this.__fClipToGeoBounds=!0);this.szUnit=(this.szUnits?this.szUnits.substr(0,1)=="."?"":" ":"")+(this.szUnits||"");this.objTheme=
this.objThemesA[c];this.objTheme.nField100IndexA[0]&&this.objTheme.nField100IndexA[0]>0&&(this.fField100=!0);if(!(this.objTheme.dbTable&&c&&c.length))return!1;if(this.coTable){try{eval("this.objTheme.dbRecords = "+this.coTable+".records")}catch(X){eval("this.objTheme.dbRecords = "+this.coTable+"_records")}if(!this.objTheme.dbRecords)return displayMessage("Data "+this.coTable+" could not be loaded!",2E3,!0),!1}else try{eval("this.objTheme.dbRecords = "+c+".records")}catch(X){eval("this.objTheme.dbRecords = "+
c+"_records")}this.objTheme.nFieldSelectionIndexA.length||delete this.objTheme.nFieldSelectionIndexA;if(this.szFlag.match(/ZOOMTO/)||this.szFlag.match(/SHOW/)){this.getSelectionId(c,0);for(p=0;p<this.objTheme.dbRecords.length;p++){if(this.fSelection=="UTM")d=map.Scale.getMapPositionOfUTM(parseFloat(String(this.objTheme.dbRecords[p][this.nSelection_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[p][this.nSelection_1]).replace(/,/g,".")),this.szCRSDatum,this.szCRSUTMZone);else if(this.fSelection==
"LatLon")d=map.Scale.getMapPositionOfLatLon(parseFloat(String(this.objTheme.dbRecords[p][this.nSelection_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[p][this.nSelection_1]).replace(/,/g,".")));else if(this.fSelection=="Point"||this.fSelection=="MultiPoint"||this.fSelection=="LineString"||this.fSelection=="MultiLineString"){var w=this.objTheme.dbRecords[p][this.objTheme.nFieldSelectionIndex];(a=w.match(wa))&&(d=map.Scale.getMapPositionOfLatLon(parseFloat(a[2]),parseFloat(a[1])))}else w=
this.objTheme.dbRecords[p][this.objTheme.nFieldSelectionIndex],this.fSelectionFieldToUpper&&(w=String(w).toUpperCase()),d=this.getNodePosition(c+"::"+w);d&&d.x!==void 0&&d.y!==void 0&&(this.itemA[c+"::"+String(d.x)+","+String(d.y)]={ptPos:d})}this.zoomTo();this.itemA=[];this.removeDefinitionFromFlag("ZOOMTO");this.removeDefinitionFromFlag("SHOW")}this.createChartGroup(map.Layer.objectGroup);if(this.szFieldsA[0]!="$item$"&&!this.szFlag.match(/CATEGORICAL/)){var C=Math.min(40,this.objTheme.dbRecords.length);
for(p=0;p<C;p++)if(this.objTheme.dbRecords[p])for(m=0;m<this.szFieldsA.length;m++){var z=this.objTheme.dbRecords[p][this.objTheme.nFieldIndexA[m]];if(ya(z)!=parseFloat(z)){this.__fScanValue=!0;p=C;break}}}this.szSizeField=="$item$"&&(this.oldSizefield=this.szSizeField,this.szSizeField=null);this.nGridWidthPx&&(this.nGridWidth=p=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.nGridWidthPx),1E3));this.nGridMatrix&&(p=map.Zoom.getBox(),p=map.Scale.getDistanceInMeter(1E3,1E3,1E3+p.width,
1E3),this.nGridWidth=p/(this.nGridMatrix||20)/map.Scale.nZoomScale);this.nGridWidthMap=this.nGridWidth?Math.round(map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/20)*map.Scale.nZoomScale*20:0;this.nGridWidth&&!this.nGridWidthMap&&(this.nGridWidthMap=this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)*map.Scale.nZoomScale:0);this.nGridWidthPx||(this.nGridWidthMap=this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)*map.Scale.nZoomScale:0,p=Math.pow(10,Math.floor(Math.log10(1/
map.Scale.nZoomScale))),this.nGridWidthMap=Math.round(this.nGridWidthMap*p)/p);this.dY=this.dX=0;this.szFlag.match(/FIXGRID/)&&(this.dX=map.Scale.mapCenter.x*map.Scale.nZoomScale,this.dY=map.Scale.mapCenter.y*map.Scale.nZoomScale);this.nGridOffsetX&&(this.dX-=this.nGridWidthMap/100*this.nGridOffsetX);this.nGridOffsetY&&(this.dY+=this.nGridWidthMap/100*this.nGridOffsetY);this.nHexaWidth=this.nGridWidthMap*1.15;this.nHexaHalf=this.nGridWidthMap*1.15/2;this.nHexa4th=this.nGridWidthMap/4;this.getSelectionId(c,
0);this.aggregationCount=0;this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinSize=Number.MAX_VALUE;this.nMaxSize=-Number.MAX_VALUE;this.nSumSize=0;this.nMinAlpha=Number.MAX_VALUE;this.nMaxAlpha=-Number.MAX_VALUE;this.nSumAlpha=0;if(this.__fExact)this.nMinA=[],this.nMaxA=[],this.nSumA=[],this.nOrigMinA=[],this.nOrigMaxA=[],this.nOrigSumA=[],this.nMedianA=[],this.nMeanA=[],this.nCountA=[];else for(a=0;a<this.szFieldsA.length;a++)this.nMinA[a]=Number.MAX_VALUE,this.nMaxA[a]=-Number.MAX_VALUE,
this.nSumA[a]=0,this.nOrigMinA[a]=Number.MAX_VALUE,this.nOrigMaxA[a]=-Number.MAX_VALUE,this.nOrigSumA[a]=0,this.nMedianA[a]=0,this.nMeanA[a]=0;this.nEmptyValuesA=[];for(var y in this.szValuesA)this.nEmptyValuesA.push(0);this.szFlag.match(/DUMP/)&&(this.nChartGroupScale=map.fObjectScaling?(this.nAutoScale||this.nScale)*map.Layer.nObjectScale*map.Scale.nObjectScaling:(this.nAutoScale||this.nScale)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling,this.chartGroup=map.Dom.newGroup(map.Layer.objectGroup,
this.szId+":chartgroup"));if(!this.szWeightsA)for(this.szWeightsA=[],a=0;a<this.szFieldsA.length;a++)this.szWeightsA.push(1);else if(this.szWeightsA.length&&this.szWeightsA.length!=this.szFieldsA.length)for(p=this.szWeightsA[this.szWeightsA.length-1],a=this.szWeightsA.length;a<this.szFieldsA.length;a++)this.szWeightsA.push(p)}if(this.szAggregationUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nAggregationUpper||this.szAggregationLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nAggregationLower)this.__fAggregate=
!1;y=map.Zoom.getBoundsOfMapInGeoBounds();C=map.Zoom.getBox();var O=this.objTheme.dbRecords.length>2E5;for(p=b||0;p<this.objTheme.dbRecords.length;p++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);return}if(O&&p>(b||0)&&p%5E4===0)return this.fContinueLoadAndAggregate=!0,this.continueIndex=p,this.szThemeLayer=c,displayMessage(__formatValue(p/this.objTheme.dbRecords.length*100,0)+"% "+map.Dictionary.getLocalText("aggregated")),displayProgressBar(p,this.objTheme.dbRecords.length,""),setTimeout(function(){map.Themes.executeContinue()},
10),!0;if(!this.objTheme.dbRecords[p]||this.fCheckRecordLength&&this.objTheme.dbRecords[p].length<this.objTheme.dbFields.length){this.nWrongRecordLengthCount++;continue}if(this.__fFilter&&!this.filterValues(p))continue;if(this.__fClipToGeoBounds&&this.fSelection=="LatLon"){var t=parseFloat(String(this.objTheme.dbRecords[p][this.nSelection_0]).replace(/,/g,"."));w=parseFloat(String(this.objTheme.dbRecords[p][this.nSelection_1]).replace(/,/g,"."));if(w<y[0].x||w>y[1].x||t<y[0].y||t>y[1].y)continue}var d=
null,e=null;this.fSelection=="UTM"?w=(d=map.Scale.getMapPositionOfUTM(parseFloat(String(this.objTheme.dbRecords[p][this.nSelection_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[p][this.nSelection_1]).replace(/,/g,".")),this.szCRSDatum,this.szCRSUTMZone))?String(d.x)+","+String(d.y):"":this.fSelection=="LatLon"?(w=String(this.objTheme.dbRecords[p][this.nSelection_0]).replace(/,/g,".")+","+String(this.objTheme.dbRecords[p][this.nSelection_1]).replace(/,/g,"."),d=this.getNodePosition(c+
"::"+w)):this.fSelection=="Point"||this.fSelection=="MultiPoint"||this.fSelection=="LineString"||this.fSelection=="MultiLineString"?(w=this.objTheme.dbRecords[p][this.objTheme.nFieldSelectionIndex],(a=String(w).match(wa))&&(d=map.Scale.getMapPositionOfLatLon(parseFloat(a[2]),parseFloat(a[1])))):(w=this.objTheme.dbRecords[p][this.objTheme.nFieldSelectionIndex],this.fSelectionFieldToUpper&&(w=String(w).toUpperCase()),this.nSelectionFieldDigits&&(w=("000000000000000"+w).slice(-this.nSelectionFieldDigits)),
this.fSelectionFieldToNumber&&(w=String(Number(w))),d=this.getNodePosition(c+"::"+w));if(this.szFlag.match(/DUMP/)){if(!d||d.x===void 0||d.y===void 0)continue;t=map.Dom.newGroup(this.chartGroup,this.szId+":"+w+":chart");t.fu.setMatrix([this.nChartGroupScale,0,0,this.nChartGroupScale,d.x,d.y]);map.Dom.newShape("circle",t,0,0,map.Scale.normalX(3),"fill:blue;fill-opacity:0.2;stroke:none;")}if(!d||isNaN(d.x)||isNaN(d.y)){this.fDataIncomplete=!0;continue}t=d;var g=null;var l=null;if(this.fSelection2){if(this.fSelection2==
"UTM")l=(g=map.Scale.getMapPositionOfUTM(parseFloat(String(this.objTheme.dbRecords[p][this.nSelection2_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[p][this.nSelection2_1]).replace(/,/g,".")),this.szCRSDatum,this.szCRSUTMZone))?String(g.x)+","+String(g.y):"";else if(this.fSelection2=="LatLon")g=map.Scale.getMapPositionOfLatLon(parseFloat(String(this.objTheme.dbRecords[p][this.nSelection2_0]).replace(/,/g,".")),parseFloat(String(this.objTheme.dbRecords[p][this.nSelection2_1]).replace(/,/g,
"."))),l=d&&d.x!==void 0&&d.y!==void 0?String(d.x)+","+String(d.y):"";else if(this.fSelection=="Point"||this.fSelection=="MultiPoint"||this.fSelection=="LineString"||this.fSelection=="MultiLineString")l=this.objTheme.dbRecords[p][this.objTheme.nFieldSelection2Index],(a=w.match(wa))&&(g=map.Scale.getMapPositionOfLatLon(parseFloat(a[2]),parseFloat(a[1])));else for(l=this.objTheme.dbRecords[p][this.objTheme.nFieldSelection2Index],this.nSelectionFieldDigits&&(l=("000000000000000"+w).slice(-this.nSelectionFieldDigits)),
this.fSelectionFieldToUpper&&(l=String(l).toUpperCase()),a=0;a<this.szThemesA.length;a++)g=g||this.getNodePosition(this.szThemesA[a]+"::"+l);l=Y(String(this.objTheme.dbRecords[p][this.objTheme.nFieldSelection2Index]));this.fSelectionFieldToUpper&&(l=String(l).toUpperCase());var u=l;l=c+"::"+l;this.themeNodesPosA[l]=g}if(this.__fClipToGeoBounds&&(d.x<C.x||d.x>C.x+C.width||d.y<C.y||d.y>C.y+C.height))continue;var k=(Aa,V,ea,Va)=>isNaN(Aa)?V?0:!1:Aa===0&&!Va||Aa<0&&!ea?!1:!0,v=!1;a=Array(this.szFieldsA.length).fill(null);
if(this.szFieldsA[0]==="$item$")a[0]=1;else if(this.szFieldsA[0]==="$index$")a[0]=p+1;else for(m=0;m<this.szFieldsA.length;m++){z=this.objTheme.dbRecords[p][this.objTheme.nFieldIndexA[m]];z=this.valueMap?this.valueMap[String(z)]||z:z;this.__fExact?(z=this.getStringValueIndex(String(z)),this.exactCountA[z-1]=(this.exactCountA[z-1]||0)+1):z=this.__fScanValue?ya(z)*(this.szWeightsA[m]||1):parseFloat(z)*(this.szWeightsA[m]||1);if(isNaN(z))if(this.fUndefinedValuePossible)z=0;else{v=!0;continue}z!==0||
this.fNullIsValue?z<0&&!this.fNegativeValuePossible?v=!0:a[m]=z:v=!0}m=this.szField100A?Array(this.szField100A.length).fill(null):[];if(this.szField100A&&this.szField100A.length)if(this.szField100A[0]==="$item$")m[0]=1;else if(this.szField100A[0]==="$index$")m[0]=p+1;else{for(var x=0;x<this.szField100A.length;x++){var H=ya(this.objTheme.dbRecords[p][this.objTheme.nField100IndexA[x]]);if(!k(H,!1,!1,!1)){v=!0;break}m[x]=H}if(m.length>0)for(x=m[m.length-1];m.length<this.szFieldsA.length;)m.push(x)}x=
this.szSizeField&&this.szSizeField!=="$item$"?ya(this.objTheme.dbRecords[p][this.objTheme.nSizeFieldIndex]):1;k(x,!1,this.fNegativeValuePossible,this.fNullIsValue)||(v=!0);k=this.szAlphaField?ya(this.objTheme.dbRecords[p][this.objTheme.nAlphaFieldIndex]):null;H=this.szTitleField?this.objTheme.dbRecords[p][this.objTheme.nTitleFieldIndex]:null;const X=this.szColorField?this.szColorField==="$index$"?p+1:Y(this.objTheme.dbRecords[p][this.objTheme.nColorFieldIndex]):null,ja=this.szTimeField?this.szTimeField===
"$index$"?p+1:Y(this.objTheme.dbRecords[p][this.objTheme.nTimeFieldIndex]).replace(/ - /g," "):null;var G=this.szXField?ya(this.objTheme.dbRecords[p][this.objTheme.nXFieldIndex]):null;const da=this.szYField?ya(this.objTheme.dbRecords[p][this.objTheme.nYFieldIndex]):null,sa=this.szValueField?this.objTheme.dbRecords[p][this.objTheme.nValueFieldIndex]:null;if(this.__fAggregate&&this.nGridWidthMap){e=this.szFlag.match(/\bRECT\b/);var P=this.dX||this.dY;if(e)d=new point(Math.round((d.x+(P?this.dX:0))/
this.nGridWidthMap)*this.nGridWidthMap-(P?this.dX:0),Math.round((d.y+(P?this.dY:0))/this.nGridWidthMap)*this.nGridWidthMap-(P?this.dY:0));else{if(this.szFlag.match(/PLOTY/))e=Math.round(d.y/this.nGridWidthMap),P=e%2?this.nHexaHalf:0,e=new point(Math.round((d.x+P)/this.nHexaWidth)*this.nHexaWidth-P,e*this.nGridWidthMap);else{e=Math.round(d.x/this.nGridWidthMap);var M=e%2?this.nHexaHalf:0;e=new point(e*this.nGridWidthMap,Math.round((d.y+M)/this.nHexaWidth)*this.nHexaWidth-M)}if(Math.abs(e.x-d.x)>this.nHexa4th){P=
[];var T=[];M=M===0?this.nHexaHalf:0;e.x>d.x?(P[0]=new point(e.x-this.nGridWidthMap,e.y-this.nHexaHalf),P[1]=new point(e.x-this.nGridWidthMap,e.y+this.nHexaHalf)):(P[0]=new point(e.x+this.nGridWidthMap,e.y-this.nHexaHalf),P[1]=new point(e.x+this.nGridWidthMap,e.y+this.nHexaHalf));T[0]=Math.sqrt(Math.pow(P[0].x-d.x,2)+Math.pow(P[0].y-d.y,2));T[1]=Math.sqrt(Math.pow(P[1].x-d.x,2)+Math.pow(P[1].y-d.y,2));T[3]=Math.sqrt(Math.pow(e.x-d.x,2)+Math.pow(e.y-d.y,2));T[0]<T[3]?e=new point(Math.round(P[0].x/
this.nGridWidthMap)*this.nGridWidthMap,Math.round((P[0].y+M)/this.nHexaWidth)*this.nHexaWidth-M):T[1]<T[3]&&(e=new point(Math.round(P[1].x/this.nGridWidthMap)*this.nGridWidthMap,Math.round((P[1].y+M)/this.nHexaWidth)*this.nHexaWidth-M))}d=e}}this.__fAggregate&&this.nGridWidthMap&&g&&!this.szFlag.match(/\bORIGIN\b/)&&(this.szFlag.match(/\bRECT\b/)?g=this.dX||this.dY?new point(Math.round((g.x+this.dX)/this.nGridWidthMap)*this.nGridWidthMap-this.dX,Math.round((g.y+this.dY)/this.nGridWidthMap)*this.nGridWidthMap-
this.dY):new point(Math.round(g.x/this.nGridWidthMap)*this.nGridWidthMap,Math.round(g.y/this.nGridWidthMap)*this.nGridWidthMap):(this.szFlag.match(/PLOTY/)?(e=Math.round(g.y/this.nGridWidthMap),P=e%2?this.nHexaHalf:0,e=new point(Math.round((g.x+P)/this.nHexaWidth)*this.nHexaWidth-P,e*this.nGridWidthMap)):(e=Math.round(g.x/this.nGridWidthMap),M=e%2?this.nHexaHalf:0,e=new point(e*this.nGridWidthMap,Math.round((g.y+M)/this.nHexaWidth)*this.nHexaWidth-M)),Math.abs(e.x-g.x)>this.nHexa4th&&(P=[],T=[],M=
M===0?this.nHexaHalf:0,e.x>g.x?(P[0]=new point(e.x-this.nGridWidthMap,e.y-this.nHexaHalf),P[1]=new point(e.x-this.nGridWidthMap,e.y+this.nHexaHalf)):(P[0]=new point(e.x+this.nGridWidthMap,e.y-this.nHexaHalf),P[1]=new point(e.x+this.nGridWidthMap,e.y+this.nHexaHalf)),T[0]=Math.sqrt(Math.pow(P[0].x-g.x,2)+Math.pow(P[0].y-g.y,2)),T[1]=Math.sqrt(Math.pow(P[1].x-g.x,2)+Math.pow(P[1].y-g.y,2)),T[3]=Math.sqrt(Math.pow(e.x-g.x,2)+Math.pow(e.y-g.y,2)),T[0]<T[3]?e=new point(Math.round(P[0].x/this.nGridWidthMap)*
this.nGridWidthMap,Math.round((P[0].y+M)/this.nHexaWidth)*this.nHexaWidth-M):T[1]<T[3]&&(e=new point(Math.round(P[1].x/this.nGridWidthMap)*this.nGridWidthMap,Math.round((P[1].y+M)/this.nHexaWidth)*this.nHexaWidth-M))),g=e),this.themeNodesPosA[l]=g);l=w;this.szAggregationField?(e=Y(this.objTheme.dbRecords[p][this.objTheme.nAggregationFieldIndex]),w=c+"::"+e,this.szTitleField=="$aggregation$"&&(H=e)):(w=c+"::"+String(d.x)+","+String(d.y)+(this.__fMultiParts?","+String(z):""),this.themeNodesPosA[w]=
d);g&&this.szFlag.match(/VECTOR/)&&(w+="&"+String(g.x)+","+String(g.y),this.themeNodesPosA[w]=g);if(this.__fAggregate)if(G=this.itemA[w],!G||this.__fLast){if(!v){this.aggregationCount++;v=0;if(this.__fMultiParts)v=x;else if(this.__fExact)if(G=a[0]-1,isNaN(G))continue;else{a=this.nEmptyValuesA.slice(0);v=a[G]=x;var qa=this.nEmptyValuesA.slice(0);qa[G]=1}else for(G=0;G<this.szFieldsA.length;G++)v=Math.max(v,a[G]||0);this.itemA[w]={nOrigValuesA:[],nValuesA:a,nValue100A:m,nValueSum:0,nCount:1,nCountA:qa,
szTitle:H,szSelectionId:String(l),szSelectionId2:String(u),nSize:Math.abs(x||(this.objTheme.nSizeFieldIndex?0:v)),nAlpha:k||1,szColor:X,szTime:ja,szValue:sa,dbIndexA:[p],ptPos:d,ptPos2:g,ptPosA:[t]};this.nCount++}}else{if(!v&&!this.__fFirst){w=0;if(this.__fMultiParts)w=x;else if(this.__fExact)if(w=a[0]-1,isNaN(w))continue;else G.nValuesA[w]=this.__fMax?Math.max(G.nValuesA[w]||0,x):(G.nValuesA[w]||0)+x,G.nCountA[w]=(G.nCountA[w]||0)+1,w=x;else for(d=this.szFieldsA.length,g=0;g<d;g++)v=a[g]||0,G.nValuesA[g]=
this.__fMax?Math.max(G.nValuesA[g],v):G.nValuesA[g]+v,G.nValue100A[g]=this.__fMax?Math.max(G.nValue100A[g],m[g]):G.nValue100A[g]+m[g],w=Math.max(w,v);this.__fMax?(G.nSize=Math.max(G.nSize,x||(this.objTheme.nSizeFieldIndex?0:w)),G.nAlpha=Math.max(G.nAlpha,k||1),G.ptPosA=[t],G.szTitle=H,G.dbIndexA.push(p)):(G.nSize+=Math.abs(x||(this.objTheme.nSizeFieldIndex?0:w)),G.nAlpha+=k||1,G.ptPosA.push(t),G.nCount++,G.dbIndexA.push(p),H&&H===G.szTitle||(G.szTitle=this.szAggregation+" of "+G.nCount+" items"))}}else this.itemA[w]&&
(w+="*"+Math.random()),this.aggregationCount++,this.itemA[w]={nOrigValuesA:[],nValuesA:a,nValue100A:m,nValueSum:0},this.itemA[w].szSelectionId=String(c+"::"+l),this.itemA[w].szSelectionId2=String(c+"::"+u),this.itemA[w].nSize=x||0,this.itemA[w].ptPos=d,this.itemA[w].ptPos2=g,this.itemA[w].dbIndexA=[p],this.itemA[w].nX=G,this.itemA[w].nY=da,this.itemA[w].szColor=X,this.itemA[w].szTime=ja,this.itemA[w].szValue=sa,this.itemA[w].szTitle=H,this.nCount++}if(this.objTheme.nField100IndexA.length>0)if(this.fField100=
!0,this.szFlag.match(/DIFFERENCE/)&&this.itemA[f]&&this.itemA[f].nValuesA&&this.itemA[f].nValuesA.length==1&&!this.szFlag.match(/RELATIVE/))for(f in this.itemA)for(m=0;m<this.itemA[f].nValuesA.length;m++)this.itemA[f].nValuesA[m]-=this.itemA[f].nValue100A[m];else if(this.szFlag.match(/FRACTION/))for(f in this.itemA)for(m=0;m<this.itemA[f].nValuesA.length;m++)this.itemA[f].nValuesA[m]=this.itemA[f].nValuesA[m]/this.itemA[f].nValue100A[m]*(this.nFractionScale||1);else if(this.szFlag.match(/PRODUCT/))for(f in this.itemA)for(m=
0;m<this.itemA[f].nValuesA.length;m++)this.itemA[f].nValuesA[m]*=this.itemA[f].nValue100A[m];else if(this.szFlag.match(/CALCVAL/))for(f in this.itemA)for(m=0;m<this.itemA[f].nValuesA.length;m++)this.itemA[f].nValuesA[m]=Math.round(this.itemA[f].nValuesA[m]*this.itemA[f].nValue100A[m]/100);else if(this.szFlag.match(/PERMILLE/))for(f in this.itemA)for(m=0;m<this.itemA[f].nValuesA.length;m++)this.itemA[f].nValuesA[m]*=1E3/this.itemA[f].nValue100A[m];else for(f in this.itemA)for(m=0;m<this.itemA[f].nValuesA.length;m++)this.itemA[f].nValue100A[m]>
(this.nField100Min||0)?(this.itemA[f].nValuesA[m]*=100/this.itemA[f].nValue100A[m],this.itemA[f].nValuesA[m]>0&&this.szFlag.match(/RELATIVE/)?this.itemA[f].nValuesA[m]-=100:this.itemA[f].nValuesA[m]>0&&this.szFlag.match(/INVERT/)&&(this.itemA[f].nValuesA[m]=100-this.itemA[f].nValuesA[m])):this.itemA[f].nValuesA[m]=0;else if(this.__fAggregate&&this.szFlag.match(/MEAN/))if(this.__fMultiParts)for(f in this.itemA)this.itemA[f].nSize/=this.itemA[f].nCount;else for(f in this.itemA){if(this.itemA[f].nCountA)for(m=
0;m<this.itemA[f].nValuesA.length;m++)this.itemA[f].nValuesA[m]/=this.itemA[f].nCountA[m]||1;else for(m=0;m<this.itemA[f].nValuesA.length;m++)this.itemA[f].nValuesA[m]/=this.itemA[f].nCount;this.szFlag.match(/SIZESUM/)||(this.itemA[f].nSize/=this.itemA[f].nCount)}if(this.szFlag.match(/DIFFERENCE/))for(f in this.itemA){for(a=0;a<this.itemA[f].nValuesA.length;a++)a<this.itemA[f].nValuesA.length-1?(c=this.itemA[f].nValuesA[a],this.itemA[f].nValuesA[a]=this.itemA[f].nValuesA[a+1]-this.itemA[f].nValuesA[a],
this.szFlag.match(/RELATIVE/)&&(this.itemA[f].nValuesA[a]=c>(this.nField100Min||0)?100/c*this.itemA[f].nValuesA[a]:0)):this.szFlag.match(/STACKED/)||(this.itemA[f].nValuesA[a]=0);this.itemA[f].nValuesA.pop()}if(this.szFlag.match(/AUTO100/))if(this.nGridX)for(f in this.itemA){a=0;do{for(b=c=0;b<this.nGridX;b++)c+=this.itemA[f].nValuesA[a+b]||0;for(b=0;b<this.nGridX;b++)this.itemA[f].nValuesA[a+b]/=c/100;a+=this.nGridX}while(a<this.itemA[f].nValuesA.length)}else for(f in this.itemA){for(a=c=0;a<this.itemA[f].nValuesA.length;a++)c+=
this.itemA[f].nValuesA[a]||0;for(a=0;a<this.itemA[f].nValuesA.length;a++)this.itemA[f].nValue100A[a]=c;this.fField100=!0;for(a=0;a<this.itemA[f].nValuesA.length;a++)this.itemA[f].nValuesA[a]/=this.itemA[f].nValue100A[a]/100}if(this.szFlag.match(/RELOCATE/)||this.szAggregationField)for(f in this.itemA)if(this.itemA[f].ptPosA){for(c=t=w=0;c<this.itemA[f].ptPosA.length;c++)w+=this.itemA[f].ptPosA[c].x,t+=this.itemA[f].ptPosA[c].y;this.itemA[f].ptPos={x:w/this.itemA[f].nCount,y:t/this.itemA[f].nCount}}if(this.szMinAggregation){b=
c=0;for(f in this.itemA)b+=this.itemA[f].nCount,c++;b/=c;for(f in this.itemA)this.itemA[f].nCount&&this.itemA[f].nCount<(this.nMinAggregation||Math.sqrt(b)-1)&&delete this.itemA[f]}this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinA=[];this.nMaxA=[];if(this.__fExact||this.szSizeField)for(f in this.itemA)isFinite(this.itemA[f].nSize)&&!isNaN(this.itemA[f].nSize)&&(this.nMin=this.nMinSize=Math.min(this.nMinSize,this.itemA[f].nSize),this.nMax=this.nMaxSize=Math.max(this.nMaxSize,this.itemA[f].nSize),
this.nSumSize+=this.itemA[f].nSize);else for(f in this.itemA)for(y=0;y<this.itemA[f].nValuesA.length;y++)isFinite(this.itemA[f].nValuesA[y])&&!isNaN(this.itemA[f].nValuesA[y])&&(this.nMin=Math.min(this.itemA[f].nValuesA[y],this.nMin),this.nMax=Math.max(this.itemA[f].nValuesA[y],this.nMax));for(f in this.itemA)for(y=0;y<this.itemA[f].nValuesA.length;y++)isFinite(this.itemA[f].nValuesA[y])&&!isNaN(this.itemA[f].nValuesA[y])?(this.nMinA[y]=Math.min(this.itemA[f].nValuesA[y],this.nMinA[y]||Number.MAX_VALUE),
this.nMaxA[y]=Math.max(this.itemA[f].nValuesA[y],this.nMaxA[y]||-Number.MAX_VALUE),this.nSumA[y]+=this.itemA[f].nValuesA[y]):(this.nMinA[y]=this.nMinA[y]||Number.MAX_VALUE,this.nMaxA[y]=this.nMaxA[y]||-Number.MAX_VALUE);if(this.szAlphaField)for(f in this.itemA)isFinite(this.itemA[f].nAlpha)&&!isNaN(this.itemA[f].nAlpha)&&(this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[f].nAlpha),this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[f].nAlpha),this.nSumAlpha+=this.itemA[f].nAlpha);if(this.szSizeField)for(f in this.itemA)isFinite(this.itemA[f].nSize)&&
!isNaN(this.itemA[f].nSize)&&(this.nMinSize=Math.min(this.nMinSize,this.itemA[f].nSize),this.nMaxSize=Math.max(this.nMaxSize,this.itemA[f].nSize),this.nSumSize+=this.itemA[f].nSize);if(this.szXField)for(f in this.itemA)isNaN(this.itemA[f].nX)||(this.nMinX=Math.min(this.nMinX,this.itemA[f].nX),this.nMaxX=Math.max(this.nMaxX,this.itemA[f].nX),this.nSumX+=this.itemA[f].nX);if(this.szYField)for(f in this.itemA)isNaN(this.itemA[f].nY)||(this.nMinY=Math.min(this.nMinY,this.itemA[f].nY),this.nMaxY=Math.max(this.nMaxY,
this.itemA[f].nY),this.nSumY+=this.itemA[f].nY);if(this.szValueField&&this.szSizeField==this.szValueField)for(f in this.itemA)this.itemA[f].szValue=String(this.itemA[f].nSize);this.oldSizefield&&(this.szSizeField=this.oldSizefield,this.oldSizeField=null);_LOG("loadAndAggregateValuesOfTheme === E N D");return this.fAnalyze=!0};D.prototype.loadTableFromMap=function(){var c,b,f={table:{fields:0,records:0},fields:[],records:[]},a=map.SVGDocument.getElementById(this.szThemesA[0]);if(a==null){var p=map.Tiles.getTileNodes(this.szThemesA[0]);
p&&(a=p[0])}if(!a)return this.szThemes="",null;a=a.getAttributeNS(szMapNs,"info");if(a==null||a==="")return this.szThemes="",null;a=a.split("|");a.push("FeatureId");for(c in a)f.fields.push({id:a[c]}),f.table.fields++;a=[];var m=[];for(c=0;c<this.szThemesA.length;c++){this.objTheme=this.objThemesA[this.szThemesA[c]];p=map.Layer.getLayerObj(this.szThemesA[c]);if(p==null)return alert("MapTheme error: no layer like '"+this.szThemesA[c]+"'"),!1;if(p.szFlag.match(/tiled/)){m[0]=map.Scale.canvasNode;m.length=
1;this.fDataIncomplete=!map.Tiles.allTilesLoaded();break}else m[m.length]=map.SVGDocument.getElementById(p.szName)}p=!0;for(b=0;b<m.length;b++){var w=m[b].getElementsByTagName("path");var C=m[b].getElementsByTagName("use"),z=m[b].getElementsByTagName("circle");for(c=0;c<w.length;c++)a[a.length]=w.item(c);for(c=0;c<C.length;c++)a[a.length]=C.item(c);for(c=0;c<z.length;c++)a[a.length]=z.item(c)}if(a.length===0)for(p=!1,b=0;b<m.length;b++)for(w=m[b].getElementsByTagName("g"),c=0;c<w.length;c++)a[a.length]=
w.item(c);for(c=0;c<a.length;c++)if(a[c].nodeType==1&&a[c].hasAttributeNS(szMapNs,"info")){w=p?a[c].parentNode.getAttributeNS(null,"id"):a[c].getAttributeNS(null,"id");m=-1;if(w&&w.length!==0)for(C=map.Tiles.getMasterId(w).split(":")[0],b=0;b<this.szThemesA.length;b++)C==this.szThemesA[b]&&(m=b);b=map.Tiles.getMasterId(w);!this.itemA[b]&&m>=0&&(m=a[c].getAttributeNS(szMapNs,"info").split("|"),m.push(b.split("::")[1]),f.records.push(m),f.table.records++,this.itemA[b]=1)}this.itemA=[];return f};D.prototype.aggregateValues=
function(){if(!(this.__fAggregateOnLoad||!this.szFlag.match(/AGGREGATE/)&&!this.szFlag.match(/GROUP/)||this.szAggregationUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nAggregationUpper||this.szAggregationLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nAggregationLower)){var c=[],b=[],f=[],a=[],p=[],m=null,w=0;this.nTopicsSkipedByZeroExclusion=0;this.nGridWidthPx&&(this.nGridWidth=m=map.Scale.getDistanceInMeter(1E3,1E3,1E3+map.Scale.normalX(this.nGridWidthPx),1E3));this.nGridMatrix&&
(m=map.Zoom.getBox(),m=map.Scale.getDistanceInMeter(1E3,1E3,1E3+m.width,1E3),this.nGridWidth=m/(this.nGridMatrix||20)/map.Scale.nZoomScale);var C=this.nGridWidth?Math.round(map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/20)*map.Scale.nZoomScale*20:0;m=function(T){for(var qa in T)return qa}(this.itemA);var z="undefined",y=this.itemA[m].szSelectionId.split("::")[0],O=null,t=C*1.15,d=C*1.15/2,e=C/4;if(this.szAggregationField)for(var g in this.itemA){z="undefined";m=m||g;z=this.itemA[g].szAggregation;
c[z]||(c[z]=[],a[z]=new point(0,0),b[z]=0,f[z]=0,w++);c[z][g]=this.itemA[g];c[z][g].nSize=this.itemA[g].nSize||1;c[z][g].szTitle=this.itemA[g].szTitle||z;f[z]+=c[z][g].nSize;var l=this.getNodePosition(this.itemA[g].szSelectionId);l&&(a[z].x+=l.x,a[z].y+=l.y,b[z]++)}else if(this.nGridWidth)for(g in this.itemA)if(l=this.getNodePosition(this.itemA[g].szSelectionId)){if(this.szFlag.match(/\bRECT\b/))this.szFlag.match(/FIXGRID/)?(O=map.Scale.mapCenter.x*map.Scale.nZoomScale,z=map.Scale.mapCenter.y*map.Scale.nZoomScale,
O=new point(Math.round((l.x+O)/C)*C-O,Math.round((l.y+z)/C)*C-z)):O=new point(Math.round(l.x/C)*C,Math.round(l.y/C)*C);else{if(this.szFlag.match(/PLOTY/))O=Math.round(l.y/C),z=O%2?d:0,O=new point(Math.round((l.x+z)/t)*t-z,O*C);else{O=Math.round(l.x/C);var u=O%2?d:0;O=new point(O*C,Math.round((l.y+u)/t)*t-u)}if(Math.abs(P-l.x)>e){z=[];var k=[];u=u===0?d:0;P>l.x?(z[0]=new point(O.x-C,O.y-d),z[1]=new point(O.x-C,O.y+d)):(z[0]=new point(O.x+C,O.y-d),z[1]=new point(O.x+C,O.y+d));k[0]=Math.sqrt(Math.pow(z[0].x-
l.x,2)+Math.pow(z[0].y-l.y,2));k[1]=Math.sqrt(Math.pow(z[1].x-l.x,2)+Math.pow(z[1].y-l.y,2));k[3]=Math.sqrt(Math.pow(O.x-l.x,2)+Math.pow(O.y-l.y,2));k[0]<k[3]?O=new point(Math.round(z[0].x/C)*C,Math.round((z[0].y+u)/t)*t-u):k[1]<k[3]&&(O=new point(Math.round(z[1].x/C)*C,Math.round((z[1].y+u)/t)*t-u))}}z=y+"::"+String(O.x)+","+String(O.y);this.themeNodesPosA[g]=O;this.themeNodesPosA[z]=O;c[z]||(c[z]=[],a[z]=new point(0,0),b[z]=0,w++);c[z][g]=this.itemA[g];c[z][g].nSize=this.itemA[g].nSize||1;a[z].x+=
l.x;a[z].y+=l.y;b[z]++}else c[z]||(c[z]=[],a[z]=new point(0,0),b[z]=0,this.fDataIncomplete=map.fTilesLoaded,w++),c[z][g]=this.itemA[g],c[z][g].nSize=this.itemA[g].nSize||1,b[z]++,this.fDataIncomplete=!0;else for(g in this.itemA)(l=this.getNodePosition(this.itemA[g].szSelectionId))?(z=this.itemA[g].szSelectionId,c[z]||(c[z]=[],a[z]=new point(0,0),b[z]=0,w++),c[z][g]=this.itemA[g],c[z][g].nSize=this.itemA[g].nSize||1,a[z].x+=l.x,a[z].y+=l.y,b[z]++):(c[z]||(c[z]=[],a[z]=new point(0,0),b[z]=0,this.fDataIncomplete=
map.fTilesLoaded,w++),c[z][g]=this.itemA[g],c[z][g].nSize=this.itemA[g].nSize||1,b[z]++,this.fDataIncomplete=!0);if(this.szFlag.match(/GROUP/)){this.itemA=[];for(var v in c){w=c[v];this.indexA=[];for(g in w)this.indexA.push(g);b=[];for(var x=0;x<this.indexA.length;x++)b.push({a:this.indexA[x],y:w[this.indexA[x]].nValuesA[0]});this.szFlag.match(/\bUP\b/)?b.sort(this.sortDownChartObjectsCompare):b.sort(this.sortUpChartObjectsCompare);for(x in b)w[b[x].a].szSelectionId=v,this.itemA[v+"*"+Math.random()]=
w[b[x].a]}}else{if(this.szFlag.match(/CATEGORICAL/))for(v in this.szSizeField||(this.szSizeField="$aggregation$"),c){w=c[v];p[v]=0;u=[];for(g in w)p[v]++,u[w[g].nValuesA[0]]||(u[w[g].nValuesA[0]]={itemA:[]}),u[w[g].nValuesA[0]].itemA[g]=w[g];c[v]=[];for(x in u)for(g in y=u[x].itemA,t=null,y)if(t==null)t=c[v][g]=y[g],t.nCount=1,t.dbIndexA=t.dbIndexA||[],t.nSize=t.nSize||1,t.nAlpha=t.nAlpha||1;else{t.nCount+=1;for(x=0;x<w[g].nValue100A.length;x++)t.nValue100A[x]+=w[g].nValue100A[x]||0;t.nSize+=y[g].nSize||
1;t.nAlpha+=y[g].nAlpha||1;t.szValue=String(t.nSize);C&&!this.szAggregationField&&(!t.szTitle||t.nCount>3)&&(t.szTitle="("+t.nCount+")");t.dbIndexA.push(y[g].dbIndex)}}else for(v in c){w=c[v];if(!this.szFlag.match(/SUM/)&&!this.szFlag.match(/ZEROISVALUE/)){C=[];u=0;for(g in w)if(u++,w[g])for(x=0;x<w[g].nValuesA.length;x++)if(w[g].nOrigValuesA[x]===0){C[g]=g;break}if(u>1)for(g in C)delete w[g],this.nTopicsSkipedByZeroExclusion++}c[v]=[];t=null;for(g in w)if(t==null)t=c[v][g]=w[g],t.nCount=1,t.dbIndexA=
t.dbIndexA||[],t.nSize=t.nSize||1,t.nAlpha=t.nAlpha||1;else{for(x=0;x<w[g].nValuesA.length;x++)t.nValuesA[x]+=w[g].nValuesA[x]||0,t.nOrigValuesA[x]+=w[g].nOrigValuesA[x]||0;t.nCount+=1;for(x=0;x<w[g].nValue100A.length;x++)t.nValue100A[x]+=w[g].nValue100A[x]||0;t.nSize+=w[g].nSize||1;t.nAlpha+=w[g].nAlpha||1;t.szValue=String(t.nSize);t.szTitle="("+this.formatValue(t.nCount,0)+")";t.dbIndexA.push(w[g].dbIndex)}}if(this.szAggregationField||this.szFlag.match(/RELOCATE/)){var H=new point(0,0),G=0;x=1E6;
C=0;for(v in c)x=Math.min(x,a[v].x/b[v]),G=Math.max(G,a[v].y/b[v]),H.x+=a[v].x*(f[v]||1),H.y+=a[v].y*(f[v]||1),C+=b[v]*(f[v]||1);H.x/=C;H.y/=C;new point(x,H.y);G=new point(H.x,G)}this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinSize=Number.MAX_VALUE;this.nSumSize=this.nMaxSize=0;this.nMinAlpha=Number.MAX_VALUE;this.nSumAlpha=this.nMaxAlpha=0;this.szFlag.match(/CATEGORICAL/)&&(this.nMinA=[],this.nMaxA=[],this.nSumA=[],this.nOrigMinA=[],this.nOrigMaxA=[],this.nOrigSumA=[],this.nMedianA=
[],this.nMeanA=[],this.nCountA=[]);f="[";C=this.nStringToValue-1;for(x=0;x<C;x++)f+="0,";f+="]";this.itemA=[];C=0;u=Math.max(this.szRangesA?this.szRangesA.length:0,this.szExactA?this.szExactA.length:0)-(this.szFlag.match(/CATEGORICAL/)?0:1);y=this.szFlag.match(/CATEGORICAL/)&&(this.szFlag.match(/PIE/)||this.szFlag.match(/BAR/)||this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/PLOT/)||this.szFlag.match(/DOMINANT/)||this.szFlag.match(/\bUSER\b/)||this.szFlag.match(/WAFFLE/));for(v in c)if(C++,v!="undefined")if(w=
c[v],y){for(g in w){var P=g;break}this.itemA[P]={};x=[];eval("nValuesA = "+f+";");this.itemA[P].szSelectionId=P;this.itemA[P].szTitle=w[P].szTitle;if(this.szAggregationField||this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?(this.itemA[P].szSelectionId=m,this.szFlag.match(/\bUP\b/)?this.themeNodesPosA[P]=new point(G.x,G.y):this.themeNodesPosA[P]=new point(H.x,H.y)):this.themeNodesPosA[P]=new point(a[v].x/b[v],a[v].y/b[v]);this.itemA[P].dbIndexA=[];d=t=0;for(g in w){x[w[g].nValuesA[0]-1]=w[g].nSize/
(this.szFlag.match(/SUM/)?1:w[g].nCount);t+=w[g].nSize;d+=w[g].nCount;this.itemA[P].dbIndexA.push(w[g].dbIndex);for(var M in w[g].dbIndexA)this.itemA[P].dbIndexA.push(w[g].dbIndexA[M]);delete this.itemA[P].dbIndex}this.itemA[P].nValuesA=this.itemA[P].nOrigValuesA=x;this.itemA[P].nMinA=[];this.itemA[P].nMaxA=[];this.itemA[P].nSize=t/(this.szFlag.match(/SUM/)?1:d);this.itemA[P].nCount=d;this.itemA[P].nAlpha=w[g].nAlpha;this.itemA[P].szTitle=this.nGridWidth&&!this.szAggregationField&&p[v]>1?__formatValue(p[v],
0)+" item(s) aggregated":this.itemA[P].szTitle||v;this.itemA[P].szValue=this.itemA[P].szTitle;this.itemA[P].szLabel=this.itemA[P].szTitle;this.nMin=this.nMinSize=Math.min(this.nMinSize,this.itemA[P].nSize);this.nMax=this.nMaxSize=Math.max(this.nMaxSize,this.itemA[P].nSize);this.nSumSize+=t/(this.szFlag.match(/SUM/)?1:d);this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[P].nAlpha);this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[P].nAlpha);this.nSumAlpha+=this.itemA[P].nAlpha;if(this.szFlag.match(/AUTO100/)){for(x=
d=0;x<this.itemA[P].nValuesA.length;x++)d+=this.itemA[P].nValuesA[x]||0;for(x=0;x<this.itemA[P].nValuesA.length;x++)this.itemA[x].nValue100A[0]=d;this.fField100=!0;for(x=0;x<this.itemA[P].nValuesA.length;x++)this.itemA[P].nValuesA[x]=this.itemA[P].nOrigValuesA[x]/this.itemA[P].nValue100[x]*100}if(this.szFlag.match(/CATEGORICAL/)&&(this.szFlag.match(/CATEGORICAL/)||!this.nNormalSizeValue)){if(!this.nMinA.length)for(x=0;x<this.itemA[P].nValuesA.length;x++)this.nMinA[x]=null,this.nMaxA[x]=null,this.nSumA[x]=
0,this.nOrigMinA[x]=null,this.nOrigMaxA[x]=null,this.nOrigSumA[x]=0,this.nMedianA[x]=0,this.nMeanA[x]=0,this.nCountA[x]=0;for(x=0;x<this.itemA[P].nValuesA.length;x++)this.nMinA[x]=Math.min(this.nMinA[x]||this.itemA[P].nValuesA[x],this.itemA[P].nValuesA[x]),this.nMaxA[x]=Math.max(this.nMaxA[x]||this.itemA[P].nValuesA[x],this.itemA[P].nValuesA[x]),this.nSumA[x]+=this.itemA[P].nValuesA[x],this.nOrigMinA[x]=Math.min(this.nOrigMinA[x]||this.itemA[P].nOrigValuesA[x],this.itemA[P].nOrigValuesA[x]),this.nOrigMaxA[x]=
Math.max(this.nOrigMaxA[x]||this.itemA[P].nOrigValuesA[x],this.itemA[P].nOrigValuesA[x]),this.nOrigSumA[x]+=this.itemA[P].nOrigValuesA[x],this.itemA[P].nValuesA[x]&&this.nCountA[x]++}this.nCount=C*u}else for(g in w)if(w[g]){t=g;this.szAggregationField||(t=v,this.itemA[t]&&(t=t.split("*")[0]+"*"+Math.random()));this.itemA[t]=w[g];w[g].szValue=w[g].szValue||1;this.nMinSize=Math.min(this.nMinSize,this.itemA[t].nSize);this.nMaxSize=Math.max(this.nMaxSize,this.itemA[t].nSize);this.nSumSize+=this.itemA[t].nSize;
this.nMinAlpha=Math.min(this.nMinAlpha,this.itemA[t].nAlpha);this.nMaxAlpha=Math.max(this.nMaxAlpha,this.itemA[t].nAlpha);this.nSumAlpha+=this.itemA[t].nAlpha;this.szFlag.match(/SUM/)||(d=this.szFlag.match(/SUM/)?1:w[g].nCount,this.itemA[t].nSize/=d,this.itemA[t].szValue/=d,this.itemA[t].nValue100A[0]/=d);if(this.nGridWidth||this.szAggregationField)for(d=this.szFlag.match(/SUM/)||this.szFlag.match(/CATEGORICAL/)?1:w[g].nCount,this.itemA[t].szSelectionId=g,x=0;x<this.itemA[t].nValuesA.length;x++)this.itemA[t].nValuesA[x]/=
d,this.itemA[t].nOrigValuesA[x]/=d,this.itemA[t].nValue100A[x]&&(this.itemA[t].nValuesA[x]=this.itemA[t].nOrigValuesA[x]/this.itemA[t].nValue100A[x],this.szFlag.match(/FRACTION/)||(this.itemA[t].nValuesA[x]*=this.szFlag.match(/PERMILLE/)?1E3:100),this.szFlag.match(/INVERT/)&&(this.itemA[t].nValuesA[x]=100-this.itemA[t].nValuesA[x])),this.nMin=Math.min(this.itemA[t].nValuesA[x]||Number.MAX_VALUE,this.nMin||Number.MAX_VALUE),this.nMax=Math.max(this.itemA[t].nValuesA[x]||-Number.MAX_VALUE,this.nMax||
-Number.MAX_VALUE);else this.nMin=Math.min(this.itemA[t].nSize,this.nMin||Number.MAX_VALUE),this.nMax=Math.max(this.itemA[t].nSize,this.nMax||-Number.MAX_VALUE);if(this.szFlag.match(/AUTO100/)){for(x=d=0;x<this.itemA[t].nValuesA.length;x++)d+=this.itemA[t].nValuesA[x]||0;for(x=0;x<this.itemA[t].nValuesA.length;x++)this.itemA[t].nValue100A[x]=d;this.fField100=!0;for(x=0;x<this.itemA[t].nValuesA.length;x++)this.itemA[t].nValuesA[x]=this.itemA[t].nOrigValuesA[x]/this.itemA[t].nValue100A[x]*100}if(this.szAggregationField||
this.szFlag.match(/RELOCATE/))this.szFlag.match(/ALIGN/)?this.szFlag.match(/\bUP\b/)?this.themeNodesPosA[t]=new point(G.x,G.y):this.themeNodesPosA[t]=new point(H.x,H.y):(this.themeNodesPosA[g]=new point(a[v].x/b[v],a[v].y/b[v]),this.themeNodesPosA[t]=new point(a[v].x/b[v],a[v].y/b[v]))}if(this.szMinAggregation){c=d=0;for(g in this.itemA)c+=this.itemA[g].nCount,d++;c/=d;for(g in this.itemA)this.itemA[g].nCount&&this.itemA[g].nCount<(this.nMinAggregation||c/2)&&delete this.itemA[g];this.nMin=Number.MAX_VALUE;
this.nMax=-Number.MAX_VALUE;for(g in this.itemA)for(x=0;x<this.itemA[g].nValuesA.length;x++)this.nMin=Math.min(this.itemA[g].nValuesA[x],this.nMin),this.nMax=Math.max(this.itemA[g].nValuesA[x],this.nMax)}this.fSorted=!0}}};D.prototype.distributeValues=function(){if(this.nCount===0)return this.szFlag.match(/CATEGORICAL/)&&displayMessage("theme: no matching values !",3E3),!1;if(this.szFlag.match(/OUTLIER/)){var c=this.szFieldsA.length;this.getMeanMedianQuantile();if(this.szFlag.match(/PLOT/)){for(var b in this.itemA){for(var f=
[],a=0;a<c;a++)this.itemA[b].nValuesA[a]&&f.push(this.itemA[b].nValuesA[a]);this.nDeviationA[b]=this.parent.getDeviationOfArray(f)}for(b in this.itemA)for(a=0;a<c;a++)Math.abs(this.itemA[b].nValuesA[a]-this.itemA[b].nValuesA[a-1])>this.nDeviationA[b]*(this.nOutlierScale||2)&&this.szFlag.match(/NOOUTLIER/)&&(this.itemA[b].nValuesA[a]=this.itemA[b].nValuesA[a-1])}else{for(a=0;a<c;a++){f=[];for(b in this.itemA)this.itemA[b].nValuesA[a]&&f.push(this.itemA[b].nValuesA[a]);this.nDeviationA[a]=this.parent.getDeviationOfArray(f)}for(a=
0;a<c;a++)for(b in this.itemA)Math.abs(this.itemA[b].nValuesA[a]-this.nMeanA[a])>this.nDeviationA[a]*(this.nOutlierScale||3)?this.szFlag.match(/NOOUTLIER/)&&delete this.itemA[b]:this.szFlag.match(/NOOUTLIER/)||delete this.itemA[b]}this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;for(b in this.itemA)for(var p=0;p<this.itemA[b].nValuesA.length;p++)isNaN(this.itemA[b].nValuesA[p])||(this.nMin=Math.min(this.itemA[b].nValuesA[p],this.nMin),this.nMax=Math.max(this.itemA[b].nValuesA[p],this.nMax))}(this.szFlag.match(/AGGREGATE/)||
this.szFlag.match(/GROUP/))&&this.aggregateValues();this.szSizeField=="$aggregation$"&&(this.szSizeField=null);if(this.szFlag.match(/CATEGORICAL/)&&(!this.szExactA||!this.szExactA.length)&&(this.szExactA=this.szExactA||[],this.nStringToValueA))for(b in this.nStringToValueA)this.szExactA.push(this.nStringToValueA[b]);!this.szFlag.match(/CATEGORICAL/)||this.szLabelA&&this.szLabelA.length||!this.szValuesA||(this.szLabelA=this.szValuesA);if(this.szColorField)if(this.colorFieldA=[],this.colorClassA=[],
this.colorClassUsedA=[],this.szColorValuesA)for(a in this.szColorValuesA)this.colorFieldA[this.szColorValuesA[a]]=!0;else if(this.szValuesA)for(a in this.szValuesA)this.colorFieldA[this.szValuesA[a]]=!0;else for(b in this.itemA)this.colorFieldA[this.itemA[b].szColor]=!0;if(this.szSymbolField)if(this.symbolFieldA=[],this.szSymbolValuesA)for(a in this.szSymbolValuesA)this.symbolFieldA[this.szSymbolValuesA[a]]=this.szSymbolsA[a];else for(b in this.itemA)this.symbolFieldA[this.itemA[b].szSymbol]=this.szSymbolsA[a];
this.origColorScheme||(this.origColorScheme=this.colorScheme=this.defaultColorScheme);if(isNaN(Number(this.origColorScheme[0])))this.colorScheme=this.origColorScheme.slice(0);else{this.szFlag.match(/SEQUENCE/)&&this.szFieldsA.length>this.origColorScheme[0]&&(this.origColorScheme[0]=this.szFieldsA.length);this.szFlag.match(/CATEGORICAL/)&&(this.origColorScheme[0]=this.szExactA.length||1);if(this.szColorField){a=0;for(b in this.colorFieldA)a++;this.origColorScheme[0]=a}try{this.colorScheme=ColorScheme.createColorScheme(this.origColorScheme[1],
this.origColorScheme[2],this.origColorScheme[0],this.origColorScheme[3],this.origColorScheme[4])}catch(C){this.colorScheme=this.defaultColorScheme}if(this.szFlag.match(/CATEGORICAL/)&&this.szFlag.match(/ORDER/)){c=this.colorScheme.slice();f=this.szValuesA?this.szValuesA.slice():this.szLabelA.slice();if(this.szColorField)for(b in f=[],this.colorFieldA)f.push(b),this.getStringValueIndex(b,"set");if(f.length&&c.length&&f.length==c.length)for(f.sort(),this.colorScheme=[],a=0;a<f.length;a++)this.colorScheme[this.nStringToValueA[f[a]]-
1]=c[a]}}if(this.szColorField){a=0;for(b in this.colorFieldA)this.colorClassA[b]=a,this.colorFieldA[b]=this.colorScheme[a++];for(b in this.itemA)this.itemA[b].nClass=this.colorClassA[this.itemA[b].szColor],this.itemA[b].szColor=this.colorFieldA[this.itemA[b].szColor]}if(this.szSymbolField)for(b in this.itemA)this.itemA[b].szSymbol=this.symbolFieldA[this.itemA[b].szSymbol];try{eval("window.__defineColorScheme = map.HTMLWindow."+this.colorScheme[0]),window.__defineColorScheme(this),eval("window.__defineColorScheme = null")}catch(C){}if(this.colorScheme[0].match(/function||=>/))try{eval("var __defineColorScheme = "+
this.colorScheme),__defineColorScheme(this)}catch(C){}try{map.HTMLWindow.ixmaps.htmlgui_colorScheme(this)}catch(C){}if(this.szFlag.match(/DOMINANT/))for(;this.colorScheme.length<this.szFieldsA.length;)this.colorScheme[this.colorScheme.length]="#dddddd";if(this.szFieldsA)if(this.colorScheme.length<this.szFieldsA.length&&this.nGridX)for(;this.colorScheme.length<this.nGridX;)this.colorScheme[this.colorScheme.length]=this.colorScheme[this.colorScheme.length-1]||"#dddddd";else if(!this.szFlag.match(/\bCLIP\b|\bDIFFERENCE\b/))for(;this.colorScheme.length<
this.szFieldsA.length;)this.colorScheme[this.colorScheme.length]=this.colorScheme[this.colorScheme.length-1]||"#dddddd";if(this.szFlag.match(/NORMALIZE/)&&this.nMax){var m=this.nMax-this.nMin;for(b in this.itemA)this.itemA[b].nValuesA[0]=(this.itemA[b].nValuesA[0]-this.nMin)/m;this.nMin=0;this.nMax=1}if(this.szFlag.match(/HARMONIZE/)&&this.nMax){if(this.nMaxA){this.nRangeA=[];for(p in this.nMaxA)this.nRangeA.push(this.nMaxA[p]-this.nMinA[p]);for(b in this.itemA)for(p in this.itemA[b].nValuesA)this.itemA[b].nValuesA[p]=
(this.itemA[b].nValuesA[p]-this.nMinA[p])/this.nRangeA[p];for(p in this.nMaxA)this.nMinA[p]=0,this.nMaxA[p]=1}else{for(b in this.itemA)this.itemA[b].nValuesA[0]/=this.nMax;this.nMin/=this.nMax;this.nMax/=this.nMax}this.nMin=0;this.nMax=1}if(this.szFlag.match(/INVERTSIZE/)&&this.szSizeField){for(b in this.itemA)this.itemA[b].nSize=this.nMaxSize-this.itemA[b].nSize;this.nNormalSizeValue=this.nNormalSizeValue||this.nMaxSize}this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/SEQUENCE/)||this.getMeanMedianQuantile();
c=this.colorScheme.length;m=this.nMax-this.nMin;f=this.nMin;p=this.nMax;this.nRangeCenterValue==null||isNaN(this.nRangeCenterValue)||(a=Math.max(Math.abs(this.nRangeCenterValue-f),Math.abs(p-this.nRangeCenterValue)),f=this.nRangeCenterValue-a,p=this.nRangeCenterValue+a,m=p-f);if(this.szFlag.match(/INTEGER/))c>m?c=m:c>m/2?c=Math.floor(m/2):m+=c-m%c;else{var w=1;for(this.szField100&&(w=.01);m>w*1E3;)w*=10;w>1?(f=Math.floor(f/w)*w,p=Math.ceil(p/w)*w):p+=p/1E5;m=p-f}if(this.szFlag.match(/CHART|CHOROPLETH/)&&
(isNaN(m)||!isFinite(m)))return _ERROR("ERROR on distributeValues: infinite range !"),displayMessage("ERROR: infinite value range !",3E3),!1;if(this.szColorField)for(b in this.nRangesA=[],a=0,this.colorFieldA)this.nRangesA.push(a++);else this.nRangesA=this.szRangesA||this.szExactA;if(this.nRangesA&&this.nRangesA.length){w=this.szFlag.match(/CATEGORICAL/)?0:1;this.szFlag.match(/BAR/)&&this.szFlag.match(/SEQUENCE/)&&(w=1);c=this.nRangesA.length-w;if(this.szSymbolsA&&this.szSymbolsA.length)for(;this.szSymbolsA.length<
c;)this.szSymbolsA[this.szSymbolsA.length]=this.szSymbolsA[this.szSymbolsA.length-1];if(this.colorScheme&&this.colorScheme.length)for(;this.colorScheme.length<c;)this.colorScheme[this.colorScheme.length]=this.colorScheme[this.colorScheme.length-1]||"#dddddd";this.partsA=[];for(a=0;a<c;a++)f=Number(this.nRangesA[a]),p=Number(this.nRangesA[a+w])+1E-9,this.partsA[this.partsA.length]={min:f,max:p,color:this.colorScheme[a],nCount:0,nSum:0};if(this.szFlag.match(/CATEGORICAL/)&&this.exactCountA)for(a=0;a<
c;a++)this.partsA[a].nCount=this.exactCountA[a];if(this.szFlag.match(/PLOTVAR/)||this.szFlag.match(/DOMINANT/))for(this.getMeanMedianQuantile(),a=0;a<c;a++){f=[];for(b in this.itemA)this.itemA[b].nValuesA[a]&&f.push(this.itemA[b].nValuesA[a]);this.nDeviationA[a]=this.parent.getDeviationOfArray(f);this.szDominantFilter=this.szDominantFilter||"min";this.nDominantDFilter=this.nDominantDFilter||0;this.szDominantFilter.match(/min/)?this.nFilterA[a]=this.nMinA[a]+(this.nMaxA[a]-this.nMinA[a])/100*this.nDominantDFilter:
this.szDominantFilter.match(/max/)?this.nFilterA[a]=this.nMinA[a]+(this.nMaxA[a]-this.nMinA[a])/100*this.nDominantDFilter:this.szDominantFilter.match(/mean/)?this.nFilterA[a]=this.nMeanA[a]+(this.nMaxA[a]-this.nMeanA[a])/100*this.nDominantDFilter:this.szDominantFilter.match(/median/)&&(this.nFilterA[a]=this.nMedianA[a]+(this.nMaxA[a]-this.nMedianA[a])/100*this.nDominantDFilter)}}else{m/=c;m>w&&(m=Math.floor(m/w)*w);this.nMin==this.nMax&&(c=1);this.partsA=[];for(a=0;a<c;a++)this.partsA[this.partsA.length]=
{min:f+a*m,max:f+(a+1)*m,color:this.colorScheme[a],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=p;if(this.szFlag.match(/HEADTAIL/)){w=this.getHeadTail();for(a=0;a<this.partsA.length;a++)this.partsA[a].min=w[a],this.partsA[a].max=w[a+1]-1E-6;this.partsA[this.partsA.length-1].max=p}if(this.szFlag.match(/QUANTILE/)){this.getMeanMedianQuantile();w=Math.round(this.quantileA[0].length/c);for(a=0;a<this.partsA.length;a++)this.partsA[a].min=this.quantileA[0][a*w],this.partsA[a].max=this.quantileA[0][(a+
1)*w];this.partsA[this.partsA.length-1].max=p}if(this.szFlag.match(/LOG/)){f=Math.log(this.nMin?this.nMin:Math.min(.1,this.nMax/10));m=Math.log(this.nMax?this.nMax:.1)-f;m/=c;this.partsA=[];for(a=0;a<c;a++)this.partsA[this.partsA.length]={min:Math.exp(f+a*m),max:Math.exp(f+(a+1)*m),color:this.colorScheme[a],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}else if(this.szFlag.match(/POW2/)){f=Math.pow(this.nMin?this.nMin:1,.5);m=Math.pow(this.nMax?this.nMax:1,.5)-Math.pow(this.nMin?
this.nMin:1,.5);m/=c;this.partsA=[];for(a=0;a<c;a++)this.partsA[this.partsA.length]={min:Math.pow(f+a*m,2),max:Math.pow(f+(a+1)*m,2),color:this.colorScheme[a],nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}else if(this.szFlag.match(/POW3/)){f=Math.pow(this.nMin?this.nMin:1,1/3);m=Math.pow(this.nMax?this.nMax:1,1/3)-Math.pow(this.nMin?this.nMin:1,1/3);m/=c;this.partsA=[];for(a=0;a<c;a++)this.partsA[this.partsA.length]={min:Math.pow(f+a*m,3),max:Math.pow(f+(a+1)*m,3),color:this.colorScheme[a],
nCount:0,nSum:0};this.partsA[this.partsA.length-1].max=this.nMax}if(this.szFlag.match(/DOMINANT/)||this.szFlag.match(/OFFSETMEAN/)||this.szFlag.match(/OFFSETMEDIAN/)||this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/)){this.getMeanMedianQuantile();for(a=0;a<this.szFieldsA.length;a++){c=[];for(b in this.itemA)this.itemA[b].nValuesA[a]&&c.push(this.itemA[b].nValuesA[a]);this.szFieldsA[a]!="$item$"&&c.sort(this.sortUp);this.nMedianA[a]=c[Math.round(c.length/2)];this.szMeansA?this.nMeanA[a]=
Number(this.szMeansA[a]):this.nSum100?this.szFlag.match(/DIFFERENCE/)?this.nMeanA[a]=this.nSumA[a]/this.nCount:(this.nMeanA[a]=this.nOrigSumA[a]/this.nSum100,this.szFlag.match(/FRACTION/)?this.nMeanA[a]*=this.nFractionScale||1:this.szFlag.match(/PERMILLE/)?this.nMeanA[a]*=1E3:(this.nMeanA[a]*=100,this.szFlag.match(/RELATIVE/)?this.nMeanA[a]-=100:this.szFlag.match(/INVERT/)&&(this.nMeanA[a]=100-this.nMeanA[a]))):this.nMeanA[a]=this.nSumA[a]/this.nCount}for(a=0;a<this.partsA.length;a++)this.szDominantFilter=
this.szDominantFilter||"min",this.nDominantDFilter=this.nDominantDFilter||0,this.szDominantFilter.match(/min/)?this.nFilterA[a]=this.nMinA[a]+(this.nMaxA[a]-this.nMinA[a])/100*this.nDominantDFilter:this.szDominantFilter.match(/max/)?this.nFilterA[a]=this.nMinA[a]+(this.nMaxA[a]-this.nMinA[a])/100*this.nDominantDFilter:this.szDominantFilter.match(/mean/)?this.nFilterA[a]=this.nMeanA[a]+(this.nMaxA[a]-this.nMeanA[a])/100*this.nDominantDFilter:this.szDominantFilter.match(/median/)&&(this.nFilterA[a]=
this.nMedianA[a]+(this.nMaxA[a]-this.nMedianA[a])/100*this.nDominantDFilter);if(this.szFlag.match(/DEVIATION/)||this.szFlag.match(/PLOTVAR/))for(a=0;a<this.szFieldsA.length;a++){f=[];for(b in this.itemA)this.itemA[b].nValuesA[a]&&f.push(this.itemA[b].nValuesA[a]);this.nDeviationA[a]=this.parent.getDeviationOfArray(f)}}}this.partsA[this.partsA.length-1]&&(this.partsA[this.partsA.length-1].max+=.001);this.szColorField&&(this.nRangesA=this.szRangesA||this.szExactA);this.szFlag.match(/COMPOSECOLOR/)&&
ba(this.colorScheme.slice(0));this.nAllMaxValue=-Number.MAX_VALUE;this.nAllMinValue=Number.MAX_VALUE;for(a in this.nMaxA)this.nAllMaxValue=Math.max(this.nAllMaxValue,this.nMaxA[a]),this.nAllMinValue=Math.min(this.nAllMinValue,this.nMinA[a]);return!0};D.prototype.sortUp=function(c,b){return c-b};D.prototype.sortIndexUp=function(c,b){return c.value-b.value};D.prototype.sortIndexDown=function(c,b){return b.value-c.value};D.prototype.sortPartsUp=function(c,b){return c.nCount-b.nCount};D.prototype.sortMeanUp=
function(c,b){return c.mean-b.mean};D.prototype.shuffleArray=function(c,b){for(var f=c.length-1;f>0;f--){var a=Math.floor((b&&b[f]?b[f]:Math.random())*f+1),p=c[f];c[f]=c[a];c[a]=p}};D.prototype.getRandomNumberArray=function(c){for(var b=[],f=0;f<c;f++)b.push(Math.random());return b};var Ua=0,ca=0,ba=function(c){for(var b=ca=Ua=0;b<c.length;b++){var f=ColorScheme.getHexaColor(c[b]);ca+=Math.max(Math.max(parseInt(f.substr(1,2),16),parseInt(f.substr(3,2),16)),parseInt(f.substr(5,2),16));Ua+=parseInt(f.substr(1,
2),16)+parseInt(f.substr(3,2),16)+parseInt(f.substr(5,2),16)}Ua/=c.length;ca/=c.length},ka=function(c,b,f,a){for(var p=0,m=0,w=0,C=0;C<c.length;C++){var z=ColorScheme.getHexaColor(b[C]);p+=parseInt(z.substr(1,2),16)*((c[C]||0)/(f||1));m+=parseInt(z.substr(3,2),16)*((c[C]||0)/(f||1));w+=parseInt(z.substr(5,2),16)*((c[C]||0)/(f||1))}c=Math.max(Math.max(p,m),w);p=Math.floor(p/c*(a||ca));m=Math.floor(m/c*(a||ca));w=Math.floor(w/c*(a||ca));return ColorScheme.getHexaColor("rgb("+p+","+m+","+w+")")},ha=
function(c,b,f,a){a=a||Math.min(Math.floor(Ua),300)||255;for(var p=0,m=0,w=0,C=0;C<c.length;C++){var z=ColorScheme.getHexaColor(b[C]);p+=(255-parseInt(z.substr(1,2),16))*((c[C]||0)/(f||1));m+=(255-parseInt(z.substr(3,2),16))*((c[C]||0)/(f||1));w+=(255-parseInt(z.substr(5,2),16))*((c[C]||0)/(f||1))}c=Math.max(Math.max(p,m),w);p=Math.min(255,a-Math.floor(p/c*ca));m=Math.min(255,a-Math.floor(m/c*ca));w=Math.min(255,a-Math.floor(w/c*ca));return ColorScheme.getHexaColor("rgb("+p+","+m+","+w+")")};D.prototype.paintMap=
function(c){if(this.nChartUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nChartUpper)this.unpaintMap(),this.fVisible=!1,this.realizeDone();else if(this.nChartLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nChartLower)this.unpaintMap(),this.fVisible=!1,this.realizeDone();else{this.beginDraw();this.mapSleep&&(this.mapSleep.checkSleepMessage="painting map");var b=0,f=0,a=0,p=0,m=0,w=0,C="",z="";map.Dictionary.getLocalText("of mean");map.Dictionary.getLocalText("of median");var y=
!1,O=0,t=a=C=0;p=null;this.fillOpacity=this.fillOpacity?this.fillOpacity:this.nOpacity;this.szStyle="fill-opacity:"+String(this.fillOpacity?this.fillOpacity:map.fTransparentMap?.6:1);this.autoOpacity&&(O=map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale,this.szStyle="fill-opacity:"+String(Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom/O))))));this.szShapeType.match(/line/)&&(this.szStyle=this.fillOpacity?"stroke-opacity:"+this.fillOpacity+";":"stroke-opacity:1");
if(!c||c===0){c=0;this.indexA=[];for(t in this.itemA)this.indexA[this.indexA.length]=t,this.itemA[t].todo=!0;for(C=0;C<this.partsA.length;C++)this.partsA[C].nCount=0,this.partsA[C].nSum=0;this.nDoneCount=0;this.szFlag.match(/COMPOSECOLOR/)&&ba(this.colorScheme.slice(0));if(this.parentTheme)for(a=0;a<this.parentTheme.paintedShapeNodesA.length;a++)this.parentTheme.unPaintShape(this.parentTheme.paintedShapeNodesA[a])}for(;c<this.indexA.length;c++){if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,
this.mapSleep.checkSleep(c,10))){this.fContinue=!0;this.continueIndex=c;this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);return}t=this.indexA[c];this.nDoneCount++;y=!1;O=0;if(this.szFlag.match(/COMPOSECOLOR/)){b=this.szFlag.match(/SUBTRACTIVE/)?ha(this.itemA[t].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):ka(this.itemA[t].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255));p=this.getItemNodes(t);for(a=0;a<
p.length;a++)if(m=this.paintShape(p[a],b,-1,-1),this.szFlag.match(/DOPACITY/)){if(this.szAlphaField)w=0,typeof this.itemA[t].nAlpha!="undefined"&&(w=1/(this.nDopacityPow||1),w=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,w)*Math.pow(this.itemA[t].nAlpha,w));else{w=1/(this.nDopacityPow||1);O=(isNaN(this.itemA[t].nValueSum)?0:this.itemA[t].nValueSum)/(this.itemA[t].nValue100A[0]/100||1);var d=isNaN(this.nMax)?0:this.nMax;w=(this.nDopacityScale||1)*Math.pow(O,w)/Math.pow(d,w)}m.style.setProperty(this.szShapeType.match(/line/)?
"stroke-opacity":"fill-opacity",String(w),"")}y=!0}else if(this.szFlag.match(/DOMINANT/)){y=!0;var e=-1;for(C=0;C<this.itemA[t].nValuesA.length;C++)b=this.itemA[t].nValuesA[C],f=100/this.nMeanA[C]*b,a=100/this.nMedianA[C]*b,p=(b-this.nMeanA[C])/this.nDeviationA[C],m=b,this.szFlag.match(/PERCENTOFMEAN/)&&(m=f),this.szFlag.match(/PERCENTOFMEDIAN/)&&(m=a),this.szFlag.match(/DEVIATION/)&&(m=p),b>this.nFilterA[C]&&m>O&&(this.itemA[t].nClass=C,O=m,e=C);if(e>=0){this.itemA[t].nDominant=e;b=this.itemA[t].nValuesA[e];
C=" "+this.szFieldsA[e]+" ";this.szLabelA&&this.szLabelA[e]&&(C=" "+this.szLabelA[e]+" ");if(this.szFlag.match(/PERCENTOFMEAN/)||this.szFlag.match(/DEVIATION/))z=map.Dictionary.getLocalText(" ( mean: ")+this.formatValue(this.nMeanA[e],1)+this.szUnit+")";this.szFlag.match(/PERCENTOFMEDIAN/)&&(z=map.Dictionary.getLocalText(" ( median: ")+this.formatValue(this.nMedianA[e],1)+this.szUnit+")");this.itemA[t].nValue=this.itemA[t].nValuesA[e];this.itemA[t].szLabel=C;this.itemA[t].szColor=this.colorScheme[e];
this.itemA[t].nClass=e;p=this.getItemNodes(t);for(a=0;a<p.length;a++)m=this.paintShape(p[a],this.colorScheme[e],this.itemA[t].nValue,e),m.setAttributeNS(szMapNs,"tooltip",this.formatValue(b,2)+this.szUnit+C+z),this.szFlag.match(/DOPACITY/)&&(w=d=O=0,O=isNaN(this.itemA[t].nValuesA[e])?0:this.itemA[t].nValuesA[e],d=isNaN(this.nMaxA[e])?0:this.nMaxA[e],this.szAlphaField?(w=0,typeof this.itemA[t].nAlpha!="undefined"&&(w=1/(this.nDopacityPow||1),w=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,w)*Math.pow(this.itemA[t].nAlpha,
w))):this.szFlag.match(/DOPACITYLOGMEAN/)?w=Math.log((this.nDopacityScale||1)*(f-100))/Math.log(100):this.szFlag.match(/DOPACITYPOWMEAN/)?(w=1/(this.nDopacityPow||1),w=Math.pow((this.nDopacityScale||1)*(f-100),w)/Math.pow(100,w)):this.szFlag.match(/DOPACITYMEAN/)?(w=1/(this.nDopacityPow||1),w=Math.pow((this.nDopacityScale||1)*(f-100),w)/Math.pow(100,w)):this.szFlag.match(/DOPACITYLOGMAX/)?w=Math.log(O)/Math.log(d):this.szFlag.match(/DOPACITYPOWMAX/)?(w=1/(this.nDopacityPow||1),w=(this.nDopacityScale||
1)*Math.pow(O,w)/Math.pow(d,w)):this.szFlag.match(/DOPACITYMAX/)?(w=1/(this.nDopacityPow||1),w=(this.nDopacityScale||1)*Math.pow(O,w)/Math.pow(d,w)):w=Math.log((this.nDopacityScale||1)*O)/Math.log(d),w=w<1E-4?0:w,w=Math.min(this.nOpacity||.9,w),this.autoOpacity&&(O=map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale,w*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom/O))))),m.style.setProperty(this.szShapeType.match(/line/)?"stroke-opacity":"fill-opacity",String(w),
""));this.partsA[e].nCount++}else for(p=this.getItemNodes(t),a=0;a<p.length;a++)this.unPaintShape(p[a]),p[a].removeAttributeNS(szMapNs,"tooltip")}else for(b=this.szFlag.match(/\bCLIP\b/)&&this.nClipFrames?this.nClipFrames==this.itemA[t].nValuesA.length?Number(this.itemA[t].nValuesA[this.nActualFrame]):this.itemA[t].nValuesA[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.itemA[t].nValuesA[1]*this.nActualFrame/(this.nClipFrames-1):this.itemA[t].nValuesA[0],C=0;C<this.partsA.length;C++)if(b<
this.partsA[C].max){this.itemA[t].nValue=b;this.itemA[t].szColor=this.partsA[C].color;this.itemA[t].nClass=C;if(this.itemA[t].todo){p=this.getItemNodes(t);for(a=0;a<p.length;a++)m=this.paintShape(p[a],this.partsA[C].color,b,C),this.szLabelA&&this.szLabelA[C]&&this.szFlag.match(/CATEGORICAL/)?m.setAttributeNS(szMapNs,"tooltip",this.szLabelA[C]):this.itemA[t].nValue100A[0]?m.setAttributeNS(szMapNs,"tooltip",this.formatValue(b,2)+this.szUnit):(m.setAttributeNS(szMapNs,"tooltip",this.formatValue(b,2)+
this.szUnit),m.setAttributeNS(szMapNs,"tooltip",(this.itemA[t].szTitle?this.itemA[t].szTitle:"")+" "+this.formatValue(b,2)+this.szUnit)),this.szFlag.match(/DOPACITY/)&&(this.szAlphaField?(w=0,typeof this.itemA[t].nAlpha!="undefined"&&(w=1/(this.nDopacityPow||1),w=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,w)*Math.pow(this.itemA[t].nAlpha,w))):this.nMin<0&&this.nMax>0?(w=0,this.szFlag.match(/DOPACITYMAX/)?(w=1/(this.nDopacityPow||1),w=Math.pow(Math.abs(b),w)/Math.pow(this.nMedianA[0]-this.nMin,
w)*(this.fillOpacity||1)*(this.nDopacityScale||1)):w=this.szFlag.match(/DOPACITYLOG/)?Math.log(Math.abs(b))/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.abs(b)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/BIPOLAR/)||this.szFlag.match(/DOPACITYMINMAX/)?(w=0,this.szFlag.match(/DOPACITYMAX/)?(w=1/(this.nDopacityPow||1),w=b>=this.nMeanA[0]?Math.pow(Math.abs(b-this.nMeanA[0]),w)/Math.pow(Math.abs(this.nMax-
this.nMeanA[0]),w)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(this.nMeanA[0]-b),w)/Math.pow(Math.abs(this.nMeanA[0]-this.nMin),w)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?w=b>=this.nMedianA[0]?Math.log(Math.abs(b-this.nMedianA[0]))/Math.log(this.nMax-this.nMedianA[0])*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.log(Math.abs(b-this.nMedianA[0]))/Math.log(this.nMedianA[0]-this.nMin)*(this.fillOpacity||1)*(this.nDopacityScale||1):
(w=1/(this.nDopacityPow||1),w=b>=this.nMedianA[0]?Math.pow(Math.abs(b-this.nMedianA[0]),w)/Math.pow(this.nMax-this.nMedianA[0],w)*(this.fillOpacity||1)*(this.nDopacityScale||1):Math.pow(Math.abs(b-this.nMedianA[0]),w)/Math.pow(this.nMedianA[0]-this.nMin,w)*(this.fillOpacity||1)*(this.nDopacityScale||1))):this.szFlag.match(/DOPACITYMIN/)?(w=1/(this.nDopacityPow||1),w=Math.pow(this.nMax-b,w)/Math.pow(this.nMax-this.nMin,w)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYMAX/)?
(w=1/(this.nDopacityPow||1),w=Math.pow(b-this.nMin,w)/Math.pow(this.nMax-this.nMin,w)*(this.fillOpacity||1)*(this.nDopacityScale||1)):this.szFlag.match(/DOPACITYLOG/)?w=Math.log(b-this.nMin)/Math.log(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1):this.szFlag.match(/DOPACITY/)&&(w=(b-this.nMin)/(this.nMedianA[0]-this.nMin)*.5*(this.fillOpacity||1)*(this.nDopacityScale||1)),w=w<1E-4?0:w,w=Math.min(this.nOpacity||.9,w),this.autoOpacity&&(O=map.Scale.nTrueMapScale*map.Scale.nZoomScale/
map.Scale.nNormalSizeScale,w*=Math.max(.3,Math.min(1,.3+.7/Math.max(1,Math.log(map.Zoom.nZoom/O))))),m.style.setProperty("fill-opacity",String(w),""));this.itemA[t].todo=!1}this.partsA[C].nCount++;this.partsA[C].nSum+=b;y=!0;break}if(!y)for(this.itemA[t].szColor=this.szNoDataColor?this.szNoDataColor:"white",p=this.getItemNodes(t),a=0;a<p.length;a++)m=this.paintShape(p[a],this.szNoDataColor?this.szNoDataColor:"white",-1,-1),m.setAttributeNS(szMapNs,"tooltip","no value"),this.szFlag.match(/DOPACITY/),
this.nNoData++}this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;this.showInfo();this.endDraw();this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);this.szFlag.match(/\bCLIP\b/)?this.nClipFrames==this.itemA[t].nValuesA.length?this.szXaxisA&&this.szXaxisA[this.nActualFrame]?displayMessage(this.szXaxisA[this.nActualFrame],3E3,"big"):this.szLabelA&&this.szLabelA[this.nActualFrame]&&displayMessage(this.szLabelA[this.nActualFrame],3E3,"big"):
(f=this.szXaxisA||this.szLabelA)&&(this.nActualFrame===0?displayMessage(f[0],3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(f[1],3E3,"big"):displayMessage(" ... ",3E3,"big")):this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();this.szFlag.match(/VALUES/)&&(!this.szValueUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nValueUpper)&&(!this.szValueLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nValueLower)?(this.mapSleep&&
this.mapSleep.initCheckSleep(25),this.fContinue=this.fMakeLabel=!0,this.nActualFrame=this.nMissingPositionCount=this.nMissingRangeCount=this.nZeroValueCount=this.nRealizedCount=this.nSkipCount=this.nDoneCount=this.continueIndex=0,setTimeout(function(){map.Themes.executeContinue()},1E3)):this.unlabelMap()}};D.prototype.unpaintMap=function(){if(!this.szFlag.match(/FEATURE/))if(this.szFlag.match(/CHART/)){if(this.chartGroup){if(this.chartGroup.childNodes.length===0&&this.itemA){var c=null,b;for(b in this.itemA)(c=
map.SVGDocument.getElementById(this.szId+":"+b+":chartgroup"))&&c.parentNode.removeChild(c)}this.fAutoScaleLeader&&(map.Themes.autoScale=null);map.Dom.clearGroup(this.chartGroup)}}else if(!this.szFlag.match(/LOCKED/)){this.beginDraw();for(c=0;c<this.paintedShapeNodesA.length;c++)this.unPaintShape(this.paintedShapeNodesA[c]),this.paintedShapeNodesA[c].removeAttributeNS(szMapNs,"tooltip");this.paintedShapeNodesA.length=0;this.unlabelMap();this.endDraw();this.isVisible=!1;this.checkVisible();setTimeout(function(){map.Layer.adaptLabel(null)},
10)}};D.prototype.paintShape=function(c,b,f,a){this.paintedShapeNodesA.push(c);switch(this.szShapeType){case "line":c.getAttributeNS(szMapNs,"save-style")||((f=c.getAttributeNS(null,"style"))&&f.match(/stroke:\s*[^;n]/)&&!f.match(/stroke:\s*none/)?c.setAttributeNS(szMapNs,"save-style","none"):f?c.setAttributeNS(szMapNs,"save-style",f):c.setAttributeNS(szMapNs,"save-style","none"));c.setAttributeNS(null,"style","fill:none;stroke:"+b+";"+this.szStyle);break;case "line+buffer":var p=c.getAttributeNS(null,
"id");if(!p.match(":paint")){var m=map.SVGDocument.getElementById(p+":paint");m||(m=c.cloneNode(1E3),c.parentNode.insertBefore(m,c),m.setAttributeNS(null,"id",p+":paint"));c=m}p=4;if(this.nBufferSize)if(this.nBufferSize.match(/\$value\$/)){f=this.nBufferSize.split("$value$");p="";for(m=0;m<f.length;m++)p+=f[m],m<f.length-1&&(p+="nValue");p=eval(p)}else p=this.nBufferSize.match(/value/)?100/(this.nMin+1E-9)*(this.nMax-this.nMin)>1E3?6+Math.log(f/this.nMax):10*f/(this.nMax-this.nMin):this.nBufferSize;
p*=Math.log(1+1/__featureScaling_lastScale);c.setAttributeNS(null,"style","stroke:"+b+";stroke-width:"+map.Scale.normalX(p)*map.Scale.nZoomScale+";"+this.szStyle+";stroke-linecap:butt;");break;default:c.setAttributeNS(null,"style","fill:"+b+";"+this.szStyle)}c.setAttributeNS(szMapNs,"class",a);return c};D.prototype.unPaintShape=function(c){if(this.szShapeType=="line+buffer"){var b=c.getAttributeNS(null,"id");(b=map.SVGDocument.getElementById(b+":paint"))&&b.parentNode.removeChild(b)}(b=c.getAttributeNS(szMapNs,
"save-style"))?b=="none"||b.match(/stroke:\s*none/i)?this.szShapeType=="line"?c.setAttributeNS(null,"style","stroke:none;"):c.removeAttributeNS(null,"style"):c.setAttributeNS(null,"style",b):(b=c.getAttributeNS(null,"style"))&&b.match(/stroke:\s*[^;n]/)&&!b.match(/stroke:\s*none/i)?this.szShapeType=="line"?c.setAttributeNS(null,"style","stroke:none;"):c.removeAttributeNS(null,"style"):c.removeAttributeNS(null,"style");c.removeAttributeNS(szMapNs,"class")};D.prototype.zoomToClass=function(c,b){var f=
0;if(this.szFlag.match(/DOMINANT/))for(var a in this.itemA)this.itemA[a].nClass==c&&f++;else f=this.partsA[c].nCount;if(f===0)displayMessage("No members !");else{var p;if(this.szFlag.match(/CHART/))for(a=this.chartGroup.childNodes,p=0;p<a.length;p++)if(f=a.item(p),f.getAttributeNS(szMapNs,"class")==null||f.getAttributeNS(szMapNs,"class")===""){f=f.firstChild.childNodes;for(var m=0;m<f.length;m++)f.item(m).getAttributeNS(szMapNs,"class")}else f.getAttributeNS(szMapNs,"class");else if(this.szFlag.match(/DOMINANT/))for(a in this.itemA)if(this.itemA[a].nClass==
c&&this.evidenceMode=="highlight")for(b=this.getItemNodes(a),p=0;p<b.length;p++);else{if(this.itemA[a].nClass!=c&&this.evidenceMode!="highlight")for(b=this.getItemNodes(a),p=0;p<b.length;p++);}else{f=new point(1E5,1E5);m=new point(-1E5,-1E5);var w=this.partsA[c].min,C=this.partsA[c].max;for(p=1;p<b;p++)w=Math.min(w,this.partsA[c+p].min),C=Math.max(C,this.partsA[c+p].max);this.szFlag.match(/CATEGORICAL/)&&(w++,C++);for(a in this.itemA)if(this.itemA[a].nValuesA[0]>w&&this.itemA[a].nValuesA[0]<C)for(b=
this.getItemNodes(a),p=0;p<b.length;p++){c=map.Dom.getBox(b[p]);if(c.width===0||c.height===0){var z=getMatrix(b[p]);c.x+=z[4];c.y+=z[5];c.width=map.Scale.viewBox.width/20;c.height=map.Scale.viewBox.height/20;c.x-=c.width/2;c.y-=c.height/2}z=map.Scale.getMapOffset(b[p]);c.x+=z.x;c.y+=z.y;f.x=Math.min(f.x,c.x);f.y=Math.min(f.y,c.y);m.x=Math.max(m.x,c.x+c.width);m.y=Math.max(m.y,c.y+c.height)}a=new box(f.x,f.y,m.x-f.x,m.y-f.y);a.scale(1.2);a=map.Zoom.clipArea(a);map.Zoom.setNewArea(a)}}};D.prototype.markClass=
function(c,b){if(this.fMarkEnable!==!1)if(map.Themes.enableSubThemes&&this.szFlag.match(/DOMINANT|COMPOSE/)&&!this.szFlag.match(/CHART/))this.szFlag.match(/SUBTHEME/)||this.createSubTheme(c);else if(isNaN(c))displayMessage("no class!");else{var f=this.szItemFilter&&this.szItemFilter.length;if(!this.szFlag.match(/CHART/)||f)this.fUnmarkEnable=!0,this.unmarkClass(),this.fUnmarkEnable=!1;if(this.fMarkEnable!==!1){var a=0;if(this.szFlag.match(/DOMINANT/)&&!this.szFlag.match(/CHART/))for(var p in this.itemA)this.itemA[p].nClass==
c&&a++;else a=this.partsA.length==1&&this.szFlag.match(/DOPACITY/)?99:this.partsA[c]?this.partsA[c].nCount:0;if(a>500&&this.evidenceMode=="highlight")displayMessage("Sorry ! to many members");else if(a===0)displayMessage("class has no members !",3E3);else if(clearMessage(),map.highLightList.removeAll(),a=null,a=(this.fShadow?5:10)/this.nScale,this.szFlag.match(/CHART/)){p=this.chartGroup.childNodes;b=[];for(c=0;c<p.length;c++){var m=p.item(c);if(m.getAttributeNS(szMapNs,"class")==null||m.getAttributeNS(szMapNs,
"class")==="")for(var w=m.getElementsByTagName("g"),C=0;C<w.length;C++)for(var z=w.item(C).childNodes,y=0;y<z.length;y++){var O=z.item(y);if(O.getAttributeNS&&O.getAttributeNS(szMapNs,"class")){if(this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/PLOT/)&&this.evidenceMode!="isolate_gray"){var t=O.getAttributeNS(null,"transform");t&&t.length&&(O.setAttributeNS(szMapNs,"orig-transform",t),O.setAttributeNS(null,"transform",""))}t=Number(O.getAttributeNS(szMapNs,"class"));if(this.szFlag.match(/BAR/)&&
this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(this.szFieldsA.length>1||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/CATEGORICAL/)))this.markedClasses[t]===!0?(O.setAttributeNS(null,"transform","matrix(1 0 0 1 -10 6.6)"),O.style.setProperty("fill-opacity","1","")):(O.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),O.style.setProperty("fill-opacity","0.85",""));else if(this.markedClasses[t]===!0){if(!f){O.style.setProperty("display","inline","");O.getAttributeNS(szMapNs,"save-style")&&
O.setAttributeNS(null,"style",O.getAttributeNS(szMapNs,"save-style"));if(this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/PLOT/)&&this.evidenceMode!="isolate_gray"&&(t=O.getAttributeNS(szMapNs,"orig-transform"))&&t.length){var d=O.nodeName&&O.nodeName.toLowerCase()||O.tagName&&O.tagName.toLowerCase()||"",e=null;O.getAttributeNS&&(e=O.getAttributeNS("http://www.w3.org/1999/xlink","href"));if(d==="use"||e&&e.length&&e.length>0)O.setAttributeNS(null,"transform",t);else if(d=/matrix\(([0-9., -e]*)\)/,
t=t.match(/matrix\(([^,]*)\)/)||t.match(d))t=t[1].split(/[\s,]+/),t.length>=4&&O.setAttributeNS(null,"transform","matrix("+(Number(t[0])||1)+" 0 0 "+(Number(t[3])||1)+" 0 0)")}b.push(m)}}else this.evidenceMode=="isolate_gray"?(O.getAttributeNS(szMapNs,"save-style")||O.setAttributeNS(szMapNs,"save-style",O.getAttributeNS(null,"style")),O.style.setProperty("fill","#bbbbbb",""),O.style.getPropertyValue("stroke")!="none"&&O.style.setProperty("stroke","#888888",""),t=O.style.getPropertyValue("fill-opacity"),
this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/WAFFLE/)?(O.style.setProperty("fill-opacity","0",""),O.style.setProperty("stroke-opacity",String(t*.9),""),O.style.setProperty("stroke-width",String(a),"")):O.style.setProperty("fill-opacity","0","")):O.style.setProperty("display","none","")}}else t=Number(m.getAttributeNS(szMapNs,"class")),this.markedClasses[t]===!0?f||(this.szFlag.match(/VECTOR/)?(m.firstChild.style.setProperty("stroke","",""),m.firstChild.style.setProperty("stroke-opacity","",""),
m.firstChild.style.setProperty("marker-end","",""),m.style.setProperty("display","inline","")):(m.style.setProperty("display","inline",""),(t=m.getAttributeNS(szMapNs,"fill"))&&m.style.setProperty("fill",t,"")),b.push(m)):this.evidenceMode=="isolate_gray"?this.szFlag.match(/VECTOR/)?(m.firstChild.style.setProperty("stroke","#888888",""),m.firstChild.style.setProperty("stroke-opacity","0.5",""),m.firstChild.style.setProperty("marker-end","none","")):(m.setAttributeNS(szMapNs,"fill",m.style.getPropertyValue("fill")),
m.style.setProperty("fill","#bbbbbb",""),m.setAttributeNS(szMapNs,"stroke",m.style.getPropertyValue("fill")),m.style.setProperty("stroke","#888888",""),m.setAttributeNS(szMapNs,"fill-opacity",m.style.getPropertyValue("fill-opacity")),m.style.setProperty("fill-opacity","0.05","")):m.style.setProperty("display","none","")}b.forEach(function(g){g.parentNode.appendChild(g)})}else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(p in this.itemA)if(this.itemA[p].nClass==c&&this.evidenceMode=="highlight")for(a=
this.getItemNodes(p),f=0;f<a.length;f++)map.highLightList.addItem(a[f]);else{if(this.itemA[p].nClass!=c&&this.evidenceMode!="highlight")for(a=this.getItemNodes(p),f=0;f<a.length;f++)a[f].setAttributeNS(szMapNs,"themestyle",a[f].getAttributeNS(null,"style")),a[f].style.setProperty("display","none","")}else{for(c=1;c<b;c++);for(p in this.itemA)if(f=!1,this.markedClasses&&this.markedClasses[this.itemA[p].nClass]&&(f=!0),f){if(this.evidenceMode=="highlight")for(a=this.getItemNodes(p),f=0;f<a.length;f++)map.highLightList.addItem(a[f])}else if(this.evidenceMode!=
"highlight")for(a=this.getItemNodes(p),f=0;f<a.length;f++)if(this.szFlag.match(/BUFFER/))(c=map.SVGDocument.getElementById(a[f].getAttributeNS(null,"id")+":paint"))&&c.style.setProperty("display","none","");else{a[f].setAttributeNS(szMapNs,"themestyle",a[f].getAttributeNS(null,"style"));a[f].setAttributeNS(null,"style",a[f].getAttributeNS(szMapNs,"origthemestyle"));b=a[f].getAttribute("id");a[f].firstChild&&a[f].firstChild.nextSibling&&(b=a[f].firstChild.nextSibling.getAttribute("id")||b);if(c=map.SVGDocument.getElementById(b+
"L"))c.setAttributeNS(szMapNs,"display",c.style.getPropertyValue("display")),c.style.setProperty("display","none","");if(c=map.SVGDocument.getElementById(b+"L:bg"))c.setAttributeNS(szMapNs,"display",c.style.getPropertyValue("display")),c.style.setProperty("display","none","");if(c=map.SVGDocument.getElementById(b+":::value"))c.setAttributeNS(szMapNs,"display",c.style.getPropertyValue("display")),c.style.setProperty("display","none","");if(c=map.SVGDocument.getElementById(b+":::value:bg"))c.setAttributeNS(szMapNs,
"display",c.style.getPropertyValue("display")),c.style.setProperty("display","none","")}}this.endDraw();this.fMarkClass=!0}}}};D.prototype.unmarkClass=function(c){if(this.fUnmarkEnable!==!1)if(this.subTheme)this.removeSubTheme();else if(this.szItemFilter&&this.szItemFilter.length)this.fMarkEnable=!0,this.filterItems(this.szItemFilter,this.itemFilterOpt);else if(clearMessage(),this.szFlag.match(/CHART/)){var b=this.chartGroup.childNodes;for(c=0;c<b.length;c++){var f=b.item(c);if(f.getAttributeNS(szMapNs,
"class")==null||f.getAttributeNS(szMapNs,"class")===""){f=f.getElementsByTagName("g");for(var a=0;a<f.length;a++)for(var p=f.item(a).childNodes,m=0;m<p.length;m++){var w=p.item(m);if(w.getAttributeNS&&w.getAttributeNS(szMapNs,"class")){if(this.szFlag.match(/SEQUENCE/)){var C=w.getAttributeNS(szMapNs,"orig-transform");C&&C.length&&(w.removeAttributeNS(szMapNs,"orig-transform"),w.setAttributeNS(null,"transform",C))}this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(w.setAttributeNS(null,
"transform","matrix(1 0 0 1 0 0)"),w.style.setProperty("fill-opacity","1",""));w.style&&(w.style.setProperty("display","inline",""),w.getAttributeNS(szMapNs,"save-style")&&w.setAttributeNS(null,"style",w.getAttributeNS(szMapNs,"save-style")))}}}else this.szFlag.match(/VECTOR/)&&(f.firstChild.style.setProperty("stroke","",""),f.firstChild.style.setProperty("stroke-opacity","",""),f.firstChild.style.setProperty("marker-end","","")),f.style.setProperty("display","inline","")}this.szFlag.match(/TEXTONLY/)&&
setTimeout(function(){map.Layer.adaptLabel()},10)}else{this.beginDraw();if(this.evidenceMode!="highlight")for(b in this.itemA)for(c=this.getItemNodes(b),f=0;f<c.length;f++)this.szFlag.match(/BUFFER/)?(a=map.SVGDocument.getElementById(c[f].getAttributeNS(null,"id")+":paint"))&&a.style.setProperty("display","inline",""):(a=c[f].getAttributeNS(szMapNs,"themestyle"))&&a.length&&a!="null"&&(c[f].setAttributeNS(null,"style",a),c[f].removeAttributeNS(szMapNs,"themestyle"),p=c[f].getAttribute("id"),c[f].firstChild&&
c[f].firstChild.nextSibling&&(p=c[f].firstChild.nextSibling.getAttribute("id")||p),(a=map.SVGDocument.getElementById(p+"L"))&&a.style.setProperty("display",a.getAttributeNS(szMapNs,"display"),""),(a=map.SVGDocument.getElementById(p+"L:bg"))&&a.style.setProperty("display",a.getAttributeNS(szMapNs,"display"),""),(a=map.SVGDocument.getElementById(p+":::value"))&&a.style.setProperty("display",a.getAttributeNS(szMapNs,"display"),""),(a=map.SVGDocument.getElementById(p+":::value:bg"))&&a.style.setProperty("display",
a.getAttributeNS(szMapNs,"display"),""));else map.highLightList.removeAll();this.endDraw();this.fMarkClass=!1}};D.prototype.showClass=function(c,b,f){var a=0;if(this.szFlag.match(/DOMINANT/))for(var p in this.itemA)this.itemA[p].nClass==c&&a++;clearMessage();var m;a=f?"inline":"none";if(this.szFlag.match(/CHART/))for(f=this.chartGroup.childNodes,m=0;m<f.length;m++){var w=f.item(m);if(w.getAttributeNS(szMapNs,"class")==null||w.getAttributeNS(szMapNs,"class")===""){w=w.firstChild.childNodes;for(var C=
0;C<w.length;C++)b=w.item(C),p=Number(b.getAttributeNS(szMapNs,"class")),p==c&&b.style.setProperty("display",a,"")}else p=Number(w.getAttributeNS(szMapNs,"class")),p==c&&w.style.setProperty("display",a,"")}else{this.beginDraw();if(this.szFlag.match(/DOMINANT/))for(p in this.itemA){if(this.itemA[p].nClass==c)for(b=this.getItemNodes(p),m=0;m<b.length;m++)b[m].setAttributeNS(szMapNs,"themestyle",b[m].getAttributeNS(null,"style")),b[m].style.setProperty("display",a,"")}else{w=this.partsA[c].min;C=this.partsA[c].max;
for(m=1;m<b;m++)w=Math.min(w,this.partsA[c+m].min),C=Math.max(C,this.partsA[c+m].max);this.szFlag.match(/CATEGORICAL/)&&(w++,C++);for(p in this.itemA)if(this.szFlag.match(/CATEGORICAL/)&&this.itemA[p].nValuesA[0]==w||this.itemA[p].nValuesA[0]>w&&this.itemA[p].nValuesA[0]<C)for(b=this.getItemNodes(p),m=0;m<b.length;m++)this.szFlag.match(/BUFFER/)?(c=map.SVGDocument.getElementById(b[m].getAttributeNS(null,"id")+":paint"))&&c.style.setProperty("display",a,""):f?(c=b[m].getAttributeNS(szMapNs,"themestyle"))&&
c.length&&c!="null"&&(b[m].setAttributeNS(null,"style",c),b[m].removeAttributeNS(szMapNs,"themestyle")):(b[m].setAttributeNS(szMapNs,"themestyle",b[m].getAttributeNS(null,"style")),b[m].setAttributeNS(null,"style",b[m].getAttributeNS(szMapNs,"origthemestyle")))}this.endDraw()}};D.prototype.setTimeFrame=function(c,b){clearMessage();map.highLightList.removeAll();var f=this.szItemFilter&&this.szItemFilter.length,a=(this.fShadow?5:10)/this.nScale,p=this.chartGroup.childNodes;this.szFlag.match(/CHART/)&&
(p=this.chartGroup.parentNode.childNodes);for(var m=[],w=0;w<p.length;w++){var C=p.item(w);if(C.getAttributeNS(szMapNs,"time")==null||C.getAttributeNS(szMapNs,"time")==="")for(var z=C.getElementsByTagName("g"),y=0;y<z.length;y++)for(var O=z.item(y).childNodes,t=0;t<O.length;t++){var d=O.item(t);if(d.getAttributeNS&&d.getAttributeNS(szMapNs,"time")){var e=Number(d.getAttributeNS(szMapNs,"time"));this.szFlag.match(/BAR/)&&this.szFlag.match(/3D/)&&!this.szFlag.match(/STACKED/)&&(this.szFieldsA.length>
1||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/CATEGORICAL/))?e>=c&&e<=b?(d.setAttributeNS(null,"transform","matrix(1 0 0 1 -10 6.6)"),d.style.setProperty("fill-opacity","1","")):(d.setAttributeNS(null,"transform","matrix(1 0 0 1 0 0)"),d.style.setProperty("fill-opacity","0.85","")):e>=c&&e<=b?f||(d.style.setProperty("display","inline",""),d.getAttributeNS(szMapNs,"save-style")&&d.setAttributeNS(null,"style",d.getAttributeNS(szMapNs,"save-style")),m.push(C)):this.evidenceMode=="isolate_gray"?
(d.getAttributeNS(szMapNs,"save-style")||d.setAttributeNS(szMapNs,"save-style",d.getAttributeNS(null,"style")),d.style.setProperty("fill","#bbbbbb",""),d.style.getPropertyValue("stroke")!="none"&&d.style.setProperty("stroke","#888888",""),e=d.style.getPropertyValue("fill-opacity"),this.szFlag.match(/SEQUENCE/)||this.szFlag.match(/WAFFLE/)?(d.style.setProperty("fill-opacity","0",""),d.style.setProperty("stroke-opacity",String(e*.9),""),d.style.setProperty("stroke-width",String(a),"")):d.style.setProperty("fill-opacity",
"0","")):d.style.setProperty("display","none","")}}else if(e=Number(C.getAttributeNS(szMapNs,"time")),e>=c&&e<=b){if(!f){if(this.szFlag.match(/VECTOR/))C.firstChild.style.setProperty("stroke","",""),C.firstChild.style.setProperty("stroke-opacity","",""),C.firstChild.style.setProperty("marker-end","",""),C.style.setProperty("display","inline","");else{C.style.setProperty("display","inline","");var g;(g=C.getAttributeNS(szMapNs,"fill"))&&C.style.setProperty("fill",g,"")}m.push(C)}}else this.evidenceMode==
"isolate_gray"?this.szFlag.match(/VECTOR/)?(C.firstChild.style.setProperty("stroke","#888888",""),C.firstChild.style.setProperty("stroke-opacity","0.5",""),C.firstChild.style.setProperty("marker-end","none","")):(C.setAttributeNS(szMapNs,"fill",C.style.getPropertyValue("fill")),C.style.setProperty("fill","#bbbbbb",""),C.setAttributeNS(szMapNs,"stroke",C.style.getPropertyValue("fill")),C.style.setProperty("stroke","#888888",""),C.setAttributeNS(szMapNs,"fill-opacity",C.style.getPropertyValue("fill-opacity")),
C.style.setProperty("fill-opacity","0.05","")):C.style.setProperty("display","none","")}m.forEach(function(l){l.parentNode.appendChild(l)})};D.prototype.createSubTheme=function(c){this.subTheme&&this.removeSubTheme();if(c!=null||this.markedClasses&&this.markedClasses.length){var b="";this.coTable&&typeof this.coTable!="undefined"&&(b+="dbtable:"+this.coTable+";");this.szSelectionField&&typeof this.szSelectionField!="undefined"&&(b+="lookupfield:"+this.szSelectionField+";");this.szAlphaField&&typeof this.szAlphaField!=
"undefined"&&(b+="alphafield:"+this.szAlphaField+";");this.szAlphaField100&&typeof this.szAlphaField100!="undefined"&&(b+="alphafield100:"+this.szAlphaField100+";");this.szTitleField&&typeof this.szTitleField!="undefined"&&(b+="titlefield:"+this.szTitleField+";");this.nDopacityScale&&typeof this.nDopacityScale!="undefined"&&(b+="dopacityscale:"+this.nDopacityScale+";");this.nDopacityPow&&typeof this.nDopacityPow!="undefined"&&(b+="dopacitypow:"+this.nDopacityPow+";");var f="lookuptoupper:"+(this.fSelectionFieldToUpper||
null)+";";f+="lookupsuffix:"+(this.szSelectionFieldSuffix||null)+";";f+="lookupprefix:"+(this.szSelectionFieldPrefix||null)+";";f+="lookupdigits:"+(Number(this.nSelectionFieldDigits)||null)+";";f+="lookuptonumber:"+(this.fSelectionFieldToNumber||null)+";";f+="lookuptoupper:"+(this.fSelectionFieldToUpper||null)+";";b+=f;this.szAggregationField&&typeof this.szAggregationField!="undefined"&&(b+="aggregationfield:"+this.szAggregationField+";");this.szUnits&&typeof this.szUnits!="undefined"&&(b+="units:"+
this.szUnits+";");var a="";this.szFlag.match(/DOPACITY/)&&(a+="DOPACITYMAX|");this.szFlag.match(/AGGREGATE/)&&(a+="AGGREGATE|");this.szFlag.match(/GROUP/)&&(a+="GROUP|");this.szFlag.match(/SUM/)&&(a+="SUM|");this.szFlag.match(/ZEROISVALUE/)&&(a+="ZEROISVALUE|");this.szFlag.match(/VALUES/)&&(a+="VALUES|");map.Themes.enableMultiChoropleth=!0;if(this.szFlag.match(/CATEGORICAL/)&&this.szFlag.match(/AGGREGATE/)&&this.szLabelA){var p=[],m=[];for(f=0;f<this.markedClassesA.length;f++)p.push(this.szLabelA[this.markedClassesA[f]]),
m.push(this.colorScheme[this.markedClassesA[f]]);this.markedClassesA&&this.markedClassesA.length>1?(b=this.getDefinitionObject(),b.style.type+="|NOINFO",b.style.values=p,b.style.colorscheme=m,this.subTheme=map.Themes.newThemeByObj(b)):(b+='filter:WHERE "'+this.szFields+'" IN "('+p.join(",")+')";',this.subTheme=map.Themes.newTheme(this.szThemes,this.szFields,this.szField100,"type:CHOROPLETH|CATEGORICAL|NOINFO|NOLEGEND|SUBTHEME|"+a+";colorscheme:7|white|"+this.colorScheme[c]+";"+b,this.szLabelA[c],
""),this.subTheme.parentTheme=this)}else if(this.markedClassesA&&this.markedClassesA.length>1){c=this.szFields.split("|");a=m=p="";for(f=0;f<this.markedClassesA.length;f++)p+=(p.length?"|":"")+c[this.markedClassesA[f]],m+=(m.length?"|":"")+this.colorScheme[this.markedClassesA[f]],a+=(a.length?"|":"")+this.szLabelA[this.markedClassesA[f]];this.subTheme=map.Themes.newTheme(this.szThemes,p,this.szField100,"type:"+this.szFlag+"|SUBTHEME|NOINFO;colorscheme:"+m+";label:"+a+";"+b)}else c=this.markedClassesA[0]||
c,this.subTheme=map.Themes.newTheme(this.szThemes,this.szFields.split("|")[c],this.szField100,"type:CHOROPLETH|LOG|DOPACITY|NOINFO|NOLEGEND|SUBTHEME|"+a+";colorscheme:7|white|"+this.colorScheme[c]+";"+b+";alphafield:null;alphafield100:null;dopacitypow:1;dopacityscale:2;",this.szLabelA?this.szLabelA[c]:"","");this.subTheme.szTitle=map.Dictionary.getLocalText("actual selection");map.Themes.subTheme=this}};D.prototype.removeSubTheme=function(){map.Themes.enableMultiChoropleth=!1;this.subTheme&&(map.Themes.subTheme=
!1,map.Themes.removeTheme(null,this.subTheme.szId),this.subTheme=null,map.Themes.realizeDone(this))};D.prototype.isItemInFilter=function(c,b,f,a){if(f.length===0&&(typeof a=="undefined"||!a.field))return!0;if(typeof b.dbIndex!="undefined"||typeof b.dbIndexA!="undefined")if(b=b.dbIndex||b.dbIndexA[0],f.length){if(this.__szValue=c.dbRecords[b].join(" "),eval("this.__szValue.match(/"+f.replace(/\//gi,"\\/")+"/i)"))return!0}else if(a&&a.field){for(f=0;f<c.dbFields.length;f++)if(c.dbFields[f].id==a.field&&
(a.min&&c.dbRecords[b][f]<a.min||a.max&&c.dbRecords[b][f]>a.max||a.txt&&c.dbRecords[b][f]!=a.txt))return!1;return!0}return!1};D.prototype.filterItems=function(c,b){if(this.fMarkEnable!==!1){this.szItemFilter=c;this.itemFilterOpt=b;this.filterNodesA=c.length||b&&b.field?[]:null;for(var f=null,a=0;a<this.szThemesA.length&&(!(f=this.objThemesA[this.szThemesA[a]])||!f.dbRecords);a++);if(f&&f.dbRecords){if(this.szFlag.match(/CHART/)){var p=this.chartGroup.childNodes;for(a=0;a<p.length;a++){var m=[],w=
p.item(a);m.push(w);for(var C=0;C<m.length;C++){var z=m[C].getAttributeNS(null,"id");z=z.split(":")[1]+"::"+z.split(":")[3];this.itemA[z]?this.isItemInFilter(f,this.itemA[z],c,b)?(w.style.setProperty("display","inline",""),this.filterNodesA&&this.filterNodesA.push(z)):w.style.setProperty("display","none",""):w.style.setProperty("display","inline","")}}}else{this.beginDraw();for(p in this.itemA)if(this.itemA[p]&&typeof this.itemA[p].dbIndex!="undefined")if(this.isItemInFilter(f,this.itemA[p],c,b))for(this.filterNodesA&&
this.filterNodesA.push(p),a=this.getItemNodes(p),m=0;m<a.length;m++)this.szFlag.match(/BUFFER/)?(w=map.SVGDocument.getElementById(a[m].getAttributeNS(null,"id")+":paint"))&&w.style.setProperty("display","inline",""):(w=a[m].getAttributeNS(szMapNs,"themestyle"))&&w.length&&w!="null"&&(a[m].setAttributeNS(null,"style",w),a[m].removeAttributeNS(szMapNs,"themestyle"),(w=map.SVGDocument.getElementById(a[m].firstChild.nextSibling.getAttribute("id")+"L"))&&w.style.setProperty("display",w.getAttributeNS(szMapNs,
"display"),""),(w=map.SVGDocument.getElementById(a[m].firstChild.nextSibling.getAttribute("id")+"L:bg"))&&w.style.setProperty("display",w.getAttributeNS(szMapNs,"display"),""));else for(a=this.getItemNodes(p),m=0;m<a.length;m++)if(this.szFlag.match(/BUFFER/))(w=map.SVGDocument.getElementById(a[m].getAttributeNS(null,"id")+":paint"))&&w.style.setProperty("display","none","");else{a[m].getAttributeNS(szMapNs,"themestyle")||a[m].setAttributeNS(szMapNs,"themestyle",a[m].getAttributeNS(null,"style"));
a[m].setAttributeNS(null,"style",a[m].getAttributeNS(szMapNs,"origthemestyle"));if(w=map.SVGDocument.getElementById(a[m].firstChild.nextSibling.getAttribute("id")+"L"))w.setAttributeNS(szMapNs,"display",w.style.getPropertyValue("display")),w.style.setProperty("display","none","");if(w=map.SVGDocument.getElementById(a[m].firstChild.nextSibling.getAttribute("id")+"L:bg"))w.setAttributeNS(szMapNs,"display",w.style.getPropertyValue("display")),w.style.setProperty("display","none","")}this.endDraw()}this.fMarkClass=
!0}}};D.prototype.selectFilterItems=function(){map.Selections.newSelection("generic",this.filterNodesA,"type:queryresult",this.szItemFilter)};D.prototype.highlightItems=function(c,b){if(c==="")this.clearHighlightItems();else{map.highLightList.removeAll();var f=this;c.split(b||",").forEach(function(a){if(f.szFlag.match(/CHART/)){var p=map.SVGDocument.getElementById(f.szId+":"+a+":chartgroup");p||(a=f.szThemesA[0]+"::"+a,p=map.SVGDocument.getElementById(f.szId+":"+a+":chartgroup"));map.highLightList.addItem(p.parentNode,
"isolate");map.displayInfo(null,p.firstChild,"add|fix")}else{a=f.getItemNodes(a);for(p=0;p<a.length;p++)map.highLightList.addItem(a[p]);map.displayInfo(null,a[0].firstChild.nextSibling,"add|fix")}})}};D.prototype.clearHighlightItems=function(){map.highLightList.removeAll();map.removeInfo()};D.prototype.labelMap=function(c){var b=map.Zoom.getBox(),f=null;this.szValuesTextStyle="font-family:verdana;font-size:"+map.Scale.normalX(11)+"px;pointer-events:none";if(!c||c===0){var a=0;c=0;this.indexA=[];var p=
0,m=0;if(this.fClipCharts)for(a in this.itemA){if(m++,this.itemA[a].nValuesA&&this.itemA[a].nValuesA.length>0&&(f=this.getNodePosition(this.itemA[a].szSelectionId)))if(f.x<b.x||f.x>b.x+b.width||f.y<b.y||f.y>b.y+b.height){if(this.nSkipCount++,f=map.SVGDocument.getElementById(this.szId+":"+a+":chart"))f.parentNode.removeChild(f),this.chartPosA[this.itemA[a].szSelectionId]=null,this.posItemA[this.itemA[a].szSelectionId]=null}else this.indexA[this.indexA.length]=a,p++}else for(a in this.itemA)this.indexA[this.indexA.length]=
a,m++,p++;p>this.nMaxThemeCharts&&(this.indexA.length=0,this.nSkipCount=p);this.mapSleep&&(this.mapSleep.nCount=p);this.fEnableProgressBar=!1}for(;c<this.indexA.length;c++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);this.fCancel=!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(c,10))){this.fContinue=!0;this.continueIndex=c;return}a=this.indexA[c];this.nDoneCount++;if(this.itemA[a].nValuesA&&this.itemA[a].nValuesA.length>0)if(f=this.getNodePosition(this.itemA[a].szSelectionId))if(this.fClipCharts&&
!this.szFlag.match(/BUFFER/)&&(f.x<b.x||f.x>b.x+b.width||f.y<b.y||f.y>b.y+b.height))this.nSkipCount++;else for(f=this.getItemNodes(a),p=0;p<f.length;p++)m=this.itemA[a].nValue,!this.szValueField&&this.itemA[a].szLabel&&(m=this.itemA[a].szLabel),this.labelShape(f[p],this.itemA[a].szColor,m);else this.nMissingPositionCount++}this.fMakeLabel=!1;setTimeout(function(){map.Layer.adaptLabel(null)},10)};D.prototype.unlabelMap=function(){for(var c in map.Layer.generatedLabelA)map.Dom.removeElementById(c),
map.Layer.generatedLabelA[c]=null};D.prototype.labelShape=function(c,b,f){if(this.szFlag.match(/VALUES/)&&f!="undefined"&&typeof f!="undefined"&&(!this.szFlag.match(/NOZERO/)||f!==0)){var a=c.parentNode.getAttributeNS(null,"id"),p=map.SVGDocument.getElementById(a+":label");if(p){var m=map.SVGDocument.getElementById(a+":values:bg");m||(m=map.Dom.newGroup(p.parentNode,a+":values:bg"),map.Layer.generatedLabelA[a+":values:bg"]=m);var w=map.SVGDocument.getElementById(a+":values");w||(w=map.Dom.newGroup(p.parentNode,
a+":values"),map.Layer.generatedLabelA[a+":values"]=w);try{var C=c.firstChild.nextSibling.getAttributeNS(null,"id").split("#"),z=C[0]+"L"+(C[1]?"#"+C[1]:"")}catch(O){z=c.getAttributeNS(null,"id")+":::value"}if(!map.SVGDocument.getElementById(z)){p=N(b);b=typeof f=="string"?f:this.formatValue(f,this.nValueDecimals||0)+(this.szUnit.match(/%/)?"%":"");a=this.szTextColor||p.highColor;C=p.lowColor;var y=1;p=Math.max(.3,c.style.getPropertyValue("fill-opacity")||"1");this.szFlag.match(/DTEXT/)&&(y=Math.max(.7,
Math.min(1.5,2/Math.sqrt(this.nMax)*Math.sqrt(f))));f=map.Scale.normalX(11)*map.Scale.nZoomScale*y*map.Scale.nLabelScaling*(this.nLabelScale||1);m=map.Dom.newText(m,0,0,"font-family:verdana;font-weight:normal;font-size:"+f+"px;text-anchor:middle;fill:none;stroke:"+C+";stroke-width:"+map.Scale.normalX(4)*map.Scale.nZoomScale+";stroke-opacity:0.5;pointer-events:none;display:none;stroke-linejoin:bevel;",b);w=map.Dom.newText(w,0,0,"font-family:verdana;font-weight:normal;font-size:"+f+"px;text-anchor:middle;fill:"+
a+";stroke:none;pointer-events:none;display:none;",b);w.setAttributeNS(null,"id",z);m.setAttributeNS(null,"id",z+":bg");this.szFlag.match(/DOPACITY/)&&(w.style.setProperty("fill-opacity",p,""),m.style.setProperty("stroke-opacity",p*.3,""));(z=c.getAttributeNS(szMapNs,"center"))?(c=z.split(","),c=new point(Number(c[0].split(":")[1]),Number(c[1].split(":")[1]))):c=this.getNodePosition(c.getAttributeNS(null,"id"));c&&(w.fu.setPosition(c.x,c.y),m.fu.setPosition(c.x,c.y))}}}};D.prototype.zoomTo=function(){var c=
new point(1E5,1E5),b=new point(-1E5,-1E5);if(this.szFlag.match(/FEATURE/)){c=map.SVGDocument.getElementById(this.szThemesA[0]);var f=map.Dom.getBox(c);map.Zoom.setNewArea(f)}else{if(this.szFlag.match(/CHART/))for(var a in this.itemA)(f=this.itemA[a].ptPos||this.getNodePosition(this.itemA[a].szSelectionId))&&f.x&&f.y&&(c.x=Math.min(c.x,f.x),c.y=Math.min(c.y,f.y),b.x=Math.max(b.x,f.x),b.y=Math.max(b.y,f.y));else for(a in this.itemA)for(var p=this.getItemNodes(a),m=0;m<p.length;m++){f=map.Dom.getBox(p[m]);
if(f.width===0||f.height===0){var w=getMatrix(p[m]);f.x+=w[4];f.y+=w[5];f.width=map.Scale.viewBox.width/20;f.height=map.Scale.viewBox.height/20;f.x-=f.width/2;f.y-=f.height/2}w=map.Scale.getMapOffset(p[m]);f.x+=w.x;f.y+=w.y;c.x=Math.min(c.x,f.x);c.y=Math.min(c.y,f.y);b.x=Math.max(b.x,f.x+f.width);b.y=Math.max(b.y,f.y+f.height)}c=new box(c.x,c.y,b.x-c.x,b.y-c.y);c.scale(1);c=map.Zoom.clipArea(c);c.width>=0&&c.height>=0&&map.Zoom.setNewArea(c)}};D.prototype.createChartGroup=function(c){if(!this.chartGroup){if(this.szFlag.match(/FEATURE/)){if(this.chartGroup=
map.Dom.newGroup(map.Layer.layerNode,this.szThemesA[0]),map.Dom.newGroup(map.Layer.layerNode,this.szThemesA[0]+":label"),map.Layer.listA[this.szThemesA[0]]=new ixMap.Layer.Item(null),map.Layer.listA[this.szThemesA[0]].szName=this.szThemesA[0],map.Layer.listA[this.szThemesA[0]].szHighlight="fill:url(#DiagUp200000000);stroke:black;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;",map.Layer.listA[this.szThemesA[0]].szSelection=this.szItemField,this.nFeatureLower||this.nFeatureUpper)map.Layer.depListA[this.szThemesA[0]]=
{},map.Layer.depListA[this.szThemesA[0]].nLower=this.nFeatureLower||0,map.Layer.depListA[this.szThemesA[0]].nUpper=this.nFeatureUpper||1E9,map.Layer.depListA[this.szThemesA[0]].shapeId=this.szThemesA[0],map.Layer.depListA[this.szThemesA[0]].szDisplayAttribute="none",map.Layer.depListA[this.szThemesA[0]].szFeature=this.szThemesA[0],setTimeout("map.Layer.switchScaleDependentLayer(null)",10)}else this.chartGroup=map.Dom.newGroup(c,this.szId+":chartgroup");this.chartGroup.style.setProperty("opacity",
String(this.nOpacity?this.nOpacity:1),"");this.fVisible==0&&this.chartGroup.style.setProperty("display","none","");this.szFlag.match(/SILENT/)&&this.chartGroup.style.setProperty("pointer-events","none","");this.szFlag.match(/VECTOR/)&&map.antiZoomAndPanList.addGroup(this.chartGroup);this.szFlag.match(/NOSCALE/)&&map.antiZoomAndPanList.addGroup(this.chartGroup);this.szFlag.match(/AGGREGATE/)&&(this.szFlag.match(/AUTOSIZE/)||this.szFlag.match(/GRIDSIZE/))&&map.antiZoomAndPanList.addGroup(this.chartGroup);
this.szFlag.match(/GRIDSIZE/)&&!this.szFlag.match(/AGGREGATE/)&&map.antiZoomAndPanList.addGroup(this.chartGroup);if(this.szFlag.match(/BUFFER/)){this.szFlag.match(/OVERLAY/)&&!this.szShapeType.match(/line/)&&this.chartGroup.style.setProperty("opacity","1","");map.Layer.getLayerObj(this.szThemesA[0]);this.chartGroup.style.setProperty("pointer-events","none","");map.antiZoomAndPanList.addGroup(this.chartGroup);c=this.colorScheme[0];var b=this.colorScheme[1]?this.colorScheme[1]:"red";typeof this.szBorderColor!=
"undefined"&&(b=this.szBorderColor);var f="stroke-width:0;";if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":f="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":f="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:300,300;";break;case "solid":f="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":f="stroke-width:0;"}if(typeof this.szBorderWidth!="undefined")switch(this.szBorderWidth){case "thin":f+=
"stroke-width:"+map.Scale.normalX(.5)+";";break;case "thick":f+="stroke-width:"+map.Scale.normalX(1.5)+";";break;default:f+="stroke-width:"+map.Scale.normalX(this.szBorderWidth)+";"}this.chartGroup.setAttributeNS(null,"style","fill:"+c+";fill-opacity:"+(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0)+";stroke:"+b+";"+f+";")}}};D.prototype.chartMap=function(c){this.chartGroup&&this.szFlag&&this.szFlag.match(/CHART/)&&this.fClearOnProjectionChange&&(!c||c===0)&&(this.chartGroup.style.setProperty("display",
"inline",""),map.Dom.clearGroup(this.chartGroup),this.fClearOnProjectionChange=!1);if(this.nChartUpper||this.nChartLower){if(this.nChartUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nChartUpper||this.nChartLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nChartLower){this.chartGroup||this.createChartGroup(map.Layer.objectGroup);this.chartGroup.style.setProperty("display","none","");this.fVisible=!1;this.realizeDone();return}this.chartGroup||this.createChartGroup(map.Layer.objectGroup);
this.chartGroup.style.setProperty("display","inline","");this.fVisible=!0}this.chartGroup&&!c&&(this.chartPosA=[]);var b=this.nChartSize?this.nChartSize:30,f=map.Zoom.getBox(),a=this.szFlag.match(/AGGREGATE/)&&this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth||0)*map.Scale.nZoomScale:map.Scale.normalX(30)*map.Scale.nZoomScale;f.x-=a/2;f.y-=a/2;f.width+=a;f.height+=a;var p=map.Zoom.getBoundsOfMapInGeoBounds();p&&p[0]&&p[1]&&p[0].x!==void 0&&p[0].y!==void 0&&p[1].x!==void 0&&p[1].y!==
void 0||(p=[new point(-180,-90),new point(180,90)]);var m=Math.floor(Math.round(1/((p[1].x-p[0].x)/2)*100)/100);p[0].x=Math.floor(p[0].x*m)/m;p[0].y=Math.floor(p[0].y*m)/m;p[1].x=Math.ceil(p[1].x*m)/m;p[1].y=Math.ceil(p[1].y*m)/m;if(this.mapGeoBounds&&this.szFlag.match(/FEATURE/)&&this.szFlag.match(/CLIPTOGEOBOUNDS|CLIPTOVIEW/)&&p[0].x==this.mapGeoBounds[0].x&&p[0].y==this.mapGeoBounds[0].y&&p[1].x==this.mapGeoBounds[1].x&&p[1].y==this.mapGeoBounds[1].y)this.realizeDone();else{this.mapGeoBounds=[new point(p[0].x,
p[0].y),new point(p[1].x,p[1].y)];var w=null,C=8;if(!c||c===0){if(!this.partsA){this.realizeDone();return}var z=0;c=0;this.indexA=[];this.szValuesLineStyle="stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.5;";this.szValuesLineBgStyle="stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;";this.szValuesTextStyle="font-family:"+(this.szTextFont||"arial")+";font-size:"+map.Scale.normalX(C)+"px;fill:#777777;pointer-events:none";this.szValuesTextBgStyle="font-family:"+(this.szTextFont||
"arial")+";font-size:"+map.Scale.normalX(C)+"px;fill:none;stroke:white;stroke-width:"+map.Scale.normalY(C)/5+";stroke-opacity:0.8;pointer-events:none;stroke-linejoin:bevel;pointer-events:none";var y=map.Layer.objectGroup;this.chartGroup||this.createChartGroup(y);this.blur(this.nBlur);if(this.autoOpacity){var O=map.Scale.nTrueMapScale*map.Scale.nZoomScale/map.Scale.nNormalSizeScale;this.fillOpacity=1*Math.max(.1,Math.min(1,20/Math.max(1,Math.pow(map.Zoom.nZoom/O,.5))))}this.mapSleep&&(this.mapSleep.checkSleepMessage=
"creating charts");this.szFlag.match(/LINEAR/)||this.szFlag.match(/SIZEP1/)?this.nSizePow=1:this.szFlag.match(/SIZEP1H/)?this.nSizePow=1.5:this.szFlag.match(/SIZELOG/)?this.nSizePow=10:this.szFlag.match(/SIZEP10/)?this.nSizePow=10:this.szFlag.match(/SIZEP4/)?this.nSizePow=4:this.szFlag.match(/SIZEP3/)||this.szFlag.match(/SIZEVOLUME/)?this.nSizePow=3:this.nSizePow=this.nSizePow||2;this.nCharSizeNormal=b;var t=getRotateAttributeValue(map.Scale.canvasNode);if(this.szFlag.match(/\bSORT\b/)&&!this.szFlag.match(/SEQUENCE/)&&
!this.szFlag.match(/3D/)){this.indexA=[];for(z in this.itemA)this.indexA[this.indexA.length]=z;for(var d=[],e=0;e<this.indexA.length;e++){var g=this.itemA[this.indexA[e]].nValuesA[this.nActualFrame||0];this.itemA[this.indexA[e]].nSize?g=this.itemA[this.indexA[e]].nSize:this.szFlag.match(/SIZE/)&&this.itemA[this.indexA[e]].nValueSum&&(g=this.itemA[this.indexA[e]].nValueSum);isNaN(g)||d.push({a:this.indexA[e],y:g})}this.szFlag.match(/\bUP\b/)?d.sort(this.sortDownChartObjectsCompare):d.sort(this.sortUpChartObjectsCompare);
if(this.szValueField&&this.szValueField=="$index$")for(e=0;e<d.length;e++)this.itemA[d[e].a].szValue=String(d.length-e);this.indexA=[]}if(this.szFlag.match(/CHART/)&&!this.szFlag.match(/CATEGORICAL/)){for(var l=0;l<this.partsA.length;l++)this.partsA[l].nCount=0,this.partsA[l].nSum=0;this.fRedrawInfo=!0;this.szFlag.match(/SEQUENCE/)&&(this.nFadeNegative=this.nFadeNegative||1)}var u=0,k=0,v=0;if(!this.fClipCharts||this.szFlag.match(/BUFFER/)||this.szFlag.match(/\bPOSITION\b/)||this.szFlag.match(/FEATURE/))for(z in this.itemA)this.indexA[this.indexA.length]=
z,k++,u++;else{for(e=0;e<this.partsA.length;e++)this.partsA[e].nCount=0,this.partsA[e].nSum=0;for(z in this.itemA)if(k++,this.itemA[z].nValuesA&&this.itemA[z].nValuesA.length>0)if(w=this.itemA[z].ptPos||this.getNodePosition(this.itemA[z].szSelectionId)){if(!this.szFlag.match(/NOCLIPTOVIEW/)&&(w.x<f.x||w.x>f.x+f.width||w.y<f.y||w.y>f.y+f.height))if(this.szFlag.match(/\b(VECTOR|BEZIER)\b/)){w=this.itemA[z].ptPos2||(this.szLabelA?this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[this.itemA[z].nValuesA[0]-
1]):null);if(!w)continue;if(w.x<f.x||w.x>f.x+f.width||w.y<f.y||w.y>f.y+f.height){this.nSkipCount++;(x=this.itemA[z].chartNode)&&x.parentNode&&(x.parentNode&&x.parentNode.removeChild(x),this.itemA[z].chartNode=null,this.chartPosA[this.itemA[z].szSelectionId]=null,this.posItemA[this.itemA[z].szSelectionId]=null);continue}}else{this.nSkipCount++;var x;(x=this.itemA[z].chartNode)&&x.parentNode&&(x.parentNode&&x.parentNode.removeChild(x),this.itemA[z].chartNode=null,this.chartPosA[this.itemA[z].szSelectionId]=
null,this.posItemA[this.itemA[z].szSelectionId]=null);continue}this.indexA[this.indexA.length]=z;if(this.szFlag.match(/CHART/))if(this.szFlag.match(/CATEGORICAL/))if(this.nMaxA.length>1)for(e=0;e<this.partsA.length;e++)this.partsA[e].nCount+=this.itemA[z].nCountA&&this.itemA[z].nCountA[e]&&!isNaN(this.itemA[z].nCountA[e])?this.itemA[z].nCountA[e]:0,this.partsA[e].nSum+=this.itemA[z].nValuesA&&this.itemA[z].nValuesA[e]&&!isNaN(this.itemA[z].nValuesA[e])?this.itemA[z].nValuesA[e]:0;else this.szAlphaField?
this.szColorField&&this.partsA[this.itemA[z].nClass]?(this.partsA[this.itemA[z].nClass].nCount++,this.partsA[this.itemA[z].nClass].nSum+=isNaN(this.itemA[z].nAlpha)?isNaN(this.itemA[z].nSize)?1:this.itemA[z].nSize:this.itemA[z].nAlpha):this.partsA[this.itemA[z].nValuesA[0]-1]&&(this.partsA[this.itemA[z].nValuesA[0]-1].nCount++,this.partsA[this.itemA[z].nValuesA[0]-1].nSum+=isNaN(this.itemA[z].nAlpha)?isNaN(this.itemA[z].nSize)?1:this.itemA[z].nSize:this.itemA[z].nAlpha):this.szColorField&&this.partsA[this.itemA[z].nClass]?
(this.partsA[this.itemA[z].nClass].nCount++,this.partsA[this.itemA[z].nClass].nSum+=isNaN(this.itemA[z].nSize)?1:this.itemA[z].nSize):this.partsA[this.itemA[z].nValuesA[0]-1]&&(this.partsA[this.itemA[z].nValuesA[0]-1].nCount++,this.partsA[this.itemA[z].nValuesA[0]-1].nSum+=isNaN(this.itemA[z].nSize)?1:this.itemA[z].nSize);else if(this.nMaxA.length>1)for(e=0;e<this.partsA.length;e++){if(!this.szFlag.match(/MEAN/)||this.itemA[z].nValuesA[e])this.partsA[e].nCount++,this.partsA[e].nSum+=isNaN(this.itemA[z].nValuesA[e])?
0:this.itemA[z].nValuesA[e]}else for(e=0;e<this.partsA.length;e++)this.itemA[z].nValuesA[0]>=this.partsA[e].min&&this.itemA[z].nValuesA[0]<this.partsA[e].max&&(this.partsA[e].nCount++,this.partsA[e].nSum+=isNaN(this.itemA[z].nValuesA[0])?0:this.itemA[z].nValuesA[0]);u++}else this.missedA[z]=z,v++;if(k==v&&!map.Tiles.allTilesLoaded()){this.fRedraw=this.fDataIncomplete=!0;map.Tiles.switchScaleDependentTiles();setTimeout(function(){map.Themes.execute()},1);return}}if(u>this.nMaxThemeCharts)for(z in this.ErrorMessage=
"max charts ("+this.nMaxThemeCharts+") exceeded; please zoom in",this.indexA.length=0,this.nSkipCount=u,this.itemA)(x=map.SVGDocument.getElementById(this.szId+":"+z+":chart"))&&x.parentNode.removeChild(x);this.fRedrawAllCharts=!1;u>this.nMaxShadowCharts?(this.fShadow&&(this.fRedrawAllCharts=!0),this.fShadow=!1):(this.fOrigShadow&&!this.fShadow&&(this.fRedrawAllCharts=!0),this.fShadow=this.fOrigShadow);this.szShadowUpper&&(map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nShadowUpper?(this.xOrigShadow=
this.xOrigShadow||this.fOrigShadow,this.fShadow=this.fOrigShadow=!1):this.fOrigShadow=this.xOrigShadow||this.fOrigShadow);this.szShadowLower&&(map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nShadowLower?(this.xOrigShadow=this.xOrigShadow||this.fOrigShadow,this.fShadow=this.fOrigShadow=!1):this.fOrigShadow=this.xOrigShadow||this.fOrigShadow);this.mapSleep&&(this.mapSleep.nCount=u);this.fSorted=!1;if(this.fSortBeforeDraw&&(this.nMin!=this.nMax||this.szSizeField)&&!this.szFlag.match(/NOSRT/)&&!this.szFlag.match(/\bDOT\b/)&&
(!this.szFlag.match(/NOSIZE/)||this.szFlag.match(/3D/)||this.szFlag.match(/\bSORT\b/))&&(!this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/AGGREGATE/)||this.szSizeField||this.szFlag.match(/\bSORT\b/))){var H=[];if((this.szFlag.match(/3D/)||this.szFlag.match(/PLOT/)||this.szFlag.match(/xxxBOXxxx/)||this.szFlag.match(/POINTER/)&&this.szFlag.match(/BAR/))&&(!this.szFlag.match(/MULTIPLE/)&&!this.szFlag.match(/MULTIGRID/)||this.szFlag.match(/AGGREGATE/)))for(e=0;e<this.indexA.length;e++)(w=this.itemA[this.indexA[e]].ptPos||
this.getNodePosition(this.itemA[this.indexA[e]].szSelectionId))?H[e]=t?{a:this.indexA[e],y:w.x*Math.sin(t)+w.y*Math.cos(t)}:{a:this.indexA[e],y:w.y}:H[e]={a:this.indexA[e],y:0};else if(this.szSizeField||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/SUM/))for(e=0;e<this.indexA.length;e++)g=this.itemA[this.indexA[e]].nSize,isNaN(g)||H.push({a:this.indexA[e],y:g});else if(this.szSizeField||this.szFlag.match(/AGGREGATE/)&&this.szFlag.match(/MEAN/))for(e=0;e<this.indexA.length;e++)g=this.itemA[this.indexA[e]].nValuesA[this.nActualFrame||
0],isNaN(g)||H.push({a:this.indexA[e],y:g});else if(this.szFlag.match(/SIZE/))for(e=0;e<this.indexA.length;e++)g=this.itemA[this.indexA[e]].nValueSum,isNaN(g)||H.push({a:this.indexA[e],y:g});else for(e=0;e<this.indexA.length;e++)g=this.itemA[this.indexA[e]].nValuesA[this.nActualFrame||0],isNaN(g)||H.push({a:this.indexA[e],y:g});this.szFlag.match(/\bSORT\b/)&&this.szFlag.match(/\bUP\b/)&&!this.szFlag.match(/SEQUENCE/)&&!this.szFlag.match(/3D/)?H.sort(this.sortDownChartObjectsCompare):H.sort(this.sortUpChartObjectsCompare);
for(e=0;e<H.length;e++)this.indexA[e]=H[e].a;this.fSorted=!0}if(this.nMaxCharts&&u>this.nMaxCharts){this.fContinue=!0;this.continueIndex=u-this.nMaxCharts;this.indexA.slice(u-this.nMaxCharts-1,this.nMaxCharts);map.Themes.executeContinue();return}this.fDone||this.unpaintMap()}this.chart={szColor:this.colorScheme[0],szLineColor:this.colorScheme[1]?this.colorScheme[1]:"none",szTextColor:this.colorScheme[1]?this.colorScheme[1]:"none"};if(this.colorScheme.length>2||this.szFlag.match(/CATEGORICAL/))this.chart.szColor=
this.colorScheme[this.colorScheme.length-1],this.chart.szLineColor=this.colorScheme[0];if(this.szFlag.match(/NOLINES/))this.chart.szLineColor="none";else if(this.chart.szLineColor=="none"){var G=N("#777777");this.chart.szLineColor=G.textColor}this.nXLen=this.nMaxA.length/(this.nGridX||1);if(this.szFlag.match(/PLOT/)&&(this.szFlag.match(/GRIDSIZE/)||this.szFlag.match(/AUTOSIZE/))){var P=0,M=map.Layer.nDynamicObjectScale,T=this.szFlag.match(/GAP/)?1.2:1;P=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/
T*this.nScale/M:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/T*this.nScale/M:map.Scale.normalX(b/3);this.nAutoScale=P/map.Scale.normalX((this.itemA[z]?this.itemA[z].nValuesA.length:1)/(this.nGridX||1)*b);this.nGridSize=P}else this.szFlag.match(/GRIDSIZE/)&&(M=map.Layer.nDynamicObjectScale,T=this.szFlag.match(/\bRECT\b/)||!this.szFlag.match(/AGGREGATE/)?this.szFlag.match(/GAP/)?1.15:1:this.szFlag.match(/GAP/)?.8:.75,this.nGridSize=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/
T/M:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/T/M:map.Scale.normalX(b/3));this.szFlag.match(/PLOTXY/)&&(M=map.Layer.nDynamicObjectScale,T=1.15,this.nChartWidth=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/T/this.nScale/M:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/T/this.nScale/M:map.Scale.normalX(b/3),this.nChartWidth-=map.Scale.normalX(this.nBoxMargin||0)*2,this.nChartHeight=this.nChartWidth-map.Scale.normalY(this.szFlag.match(/TITLE/)?
10:0),this.nGridSize=this.nChartWidth,this.nAutoScale=1,this.nRangeX=this.nMaxX-this.nMinX,this.nRangeY=this.nMaxY-this.nMinY);this.nChartGroupScaleX=this.nChartGroupScale=map.fObjectScaling?(this.nAutoScale||this.nScale)*map.Layer.nObjectScale*map.Scale.nObjectScaling:(this.nAutoScale||this.nScale)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling;this.nChartGroupScaleY=this.nChartGroupScale/map.Zoom.nZoomY*map.Zoom.nZoomX;this.fGlowInScale=!1;(!this.szGlowUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=
this.nGlowUpper)&&(!this.szGlowLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower)&&(this.fGlowInScale=!0);this.fDoRedraw=!1;if(this.indexA.length<1E3||this.fRedraw||this.fRedrawAllCharts||this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.fDoRedraw=!this.fDone;this.fHideValues=this.szValueUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nValueUpper||this.szValueLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nValueLower;if(this.szFlag.match(/\bUSER\b/))try{var qa=
{target:this.chartGroup,theme:this};this.userDraw?(this.opt=qa,eval("map.HTMLWindow.ixmaps."+this.userDraw+"_init(map.SVGDocument,this.opt);"),delete this.opt):map.HTMLWindow.ixmaps.htmlgui_initChart(map.SVGDocument,qa)}catch(Hc){displayMessage("'"+(this.userDraw||"USER chart")+"' undefined!",5E3)}if(this.szFlag.match(/FEATURE/)){this.chartGroup.style.setProperty("fill",this.chart.szColor||"white");this.chartGroup.style.setProperty("fill-opacity",this.fillOpacity||.7);this.chartGroup.style.setProperty("stroke",
this.szLineColor||"red");this.chartGroup.style.setProperty("stroke-width",map.Scale.normalX(this.nLineWidth||1)*this.nChartGroupScaleY/(map.fFeatureScalingDynamic?1:map.Layer.nDynamicObjectScale));if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":this.chartGroup.style.setProperty("stroke-dasharray","0.1 0.2");break;case "dashed":this.chartGroup.style.setProperty("stroke-dasharray","0.5 0.2")}this.szFlag.match(/DASH/)&&this.chartGroup.style.setProperty("stroke-dasharray",
"0.1 0.2");this.chartGroup.style.setProperty("stroke-opacity","1");this.chartGroup.style.setProperty("stroke-linecap","butt");this.chartGroup.style.setProperty("stroke-linejoin","round");if(this.szFlag.match(/SILENT/))this.chartGroup.style.setProperty("pointer-events","none","");else{var X="";for(e=0;e<this.objTheme.dbFields.length-1;e++)X+=(e?"|":"")+this.objTheme.dbFields[e].id;this.chartGroup.setAttributeNS(szMapNs,"info",X)}if(this.fShadow===!0&&map.SVGDocument.getElementById(map.szShadowFilterShapeId))this.chartGroup.style.setProperty("filter",
"url(#"+map.szShadowFilterShapeId+")","");else if(this.fShadow===!0){var ja=map.Dom.newNode("filter",this.chartGroup.parentNode);ja.setAttributeNS(null,"id",map.szShadowFilterShapeId);ja.setAttributeNS(null,"x","-1");ja.setAttributeNS(null,"y","-1");ja.setAttributeNS(null,"width","2000%");ja.setAttributeNS(null,"height","2000%");var da=map.Dom.newNode("feGaussianBlur",ja);da.setAttributeNS(null,"stdDeviation","0.3");da.setAttributeNS(null,"result","BlurAlpha");da=map.Dom.newNode("feOffset",ja);da.setAttributeNS(null,
"in","BlurAlpha");da.setAttributeNS(null,"dx","0.2");da.setAttributeNS(null,"dy","0.5");da.setAttributeNS(null,"result","OffsetBlurAlpha");da=map.Dom.newNode("feColorMatrix",ja);da.setAttributeNS(null,"in","OffsetBlurAlpha");da.setAttributeNS(null,"type","matrix");da.setAttributeNS(null,"values","0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0 0 0 1 0");da.setAttributeNS(null,"result","matrixOut");da=map.Dom.newNode("feMerge",ja);var sa=map.Dom.newNode("feMergeNode",da);sa.setAttributeNS(null,"in",
"matrixOut");sa=map.Dom.newNode("feMergeNode",da);sa.setAttributeNS(null,"in","SourceGraphic");this.chartGroup.style.setProperty("filter","url(#"+map.szShadowFilterShapeId+")","")}}P=0;this.nGridWidth?P=map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/2*20:(P=map.Scale.normalX(b/3),P=P*map.Scale.nZoomScale*20);for(var Aa=c;Aa<this.indexA.length;Aa++){if(this.fCancel){displayMessage("Canceled by user",1E3,!0);this.fCancel=!1;return}if(this.mapSleep&&(this.mapSleep.nDoneCount=this.nDoneCount,this.mapSleep.checkSleep(Aa,
10))){this.fContinue=!0;this.continueIndex=Aa;this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);this.markedClass!=null&&this.markClass(this.markedClass,1);return}var V=null;z=this.indexA[Aa];this.nDoneCount++;if(this.itemA[z]&&this.itemA[z].nValuesA&&this.itemA[z].nValuesA.length!==0){var ea=this.itemA[z].szSelectionId;if(!this.szFlag.match(/FEATURE/)){(w=this.itemA[z].ptPos||this.getNodePosition(ea))&&w.x!==void 0&&w.y!==void 0&&(w.x=isNaN(w.x)?0:
w.x,w.y=isNaN(w.y)?0:w.y);if(!w||w.x===void 0||w.y===void 0||isNaN(w.x)||isNaN(w.y)){this.nMissingPositionCount++;continue}this.fRedraw&&(this.itemA[z].chartNode=this.itemA[z].chartNode||map.SVGDocument.getElementById(this.szId+":"+z+":chart"));if(this.itemA[z].chartNode&&this.itemA[z].chartNode.parentNode)if(this.fDoRedraw)this.itemA[z].chartNode.parentNode.removeChild(this.itemA[z].chartNode),this.itemA[z].chartNode=null;else{this.nRealizedCount++;continue}}var Va=new point(0,0);if(this.szFlag.match(/FEATURE/))if(z.match(/\*/)&&
(V=map.SVGDocument.getElementById(z.split("*")[0])),V||=map.Dom.newGroup(this.chartGroup,z),this.objTheme.dbRecords[this.itemA[z].dbIndex][this.objTheme.nFieldSelectionIndex]){function Hc(Vb,hb,Mc,Wb,vc){if(Mc!==void 0&&Wb!==void 0){for(var wc=0,ec=1,Yc=0;Yc<12;Yc++){var aa=(wc+ec)/2,Ga=map.Scale.getMapPositionOfLatLon(Mc+(Vb-Mc)*aa,Wb+(hb-Wb)*aa);Ga&&Ga.x!==void 0&&Ga.y!==void 0?wc=aa:ec=aa}if(wc>0&&(Vb=Mc+(Vb-Mc)*wc,hb=Wb+(hb-Wb)*wc,(Wb=map.Scale.getMapPositionOfLatLon(Vb,hb))&&Wb.x!==void 0&&Wb.y!==
void 0))return{pt:Wb,lat:Vb,lon:hb}}return vc&&vc.lat!==void 0&&(hb=map.Scale.getMapPositionOfLatLon(vc.lat,vc.lon))&&hb.x!==void 0&&hb.y!==void 0?{pt:hb,lat:vc.lat,lon:vc.lon}:null}if(this.objTheme.dbRecords[this.itemA[z].dbIndex][this.objTheme.nFieldSelectionIndex].match(/coordinates/i)){var Sa=JSON.parse(this.objTheme.dbRecords[this.itemA[z].dbIndex][this.objTheme.nFieldSelectionIndex]);if(Sa){if(this.szFlag.match(/CLIPTOGEOBOUNDS|CLIPTOVIEW/)&&Sa.type=="Polygon"){var Ja=Sa.coordinates,tb=!0;for(e in Ja){var Ma=
Ja[e];for(let Vb in Ma)if(Ma[Vb][0]>p[0].x&&Ma[Vb][0]<p[1].x&&Ma[Vb][1]>p[0].y&&Ma[Vb][1]<p[1].y){tb=!1;break}}if(tb){V.parentNode.removeChild(V);for(e in map.Themes.themeNodesA[z])map.Themes.themeNodesA[z][e].parentNode&&map.Themes.themeNodesA[z][e].parentNode.removeChild(map.Themes.themeNodesA[z][e]);map.Themes.themeNodesA[z]=[];continue}else if(map.Themes.themeNodesA[z]&&map.Themes.themeNodesA[z].length)continue}if(this.szFlag.match(/SILENT/))V.style.setProperty("pointer-events","none","");else{X=
"";var Eb=this.objTheme.dbRecords[this.itemA[z].dbIndex];for(e=0;e<Eb.length-1;e++)X+=(e?"|":"")+Eb[e];V.setAttributeNS(szMapNs,"info",X);V.setAttributeNS(szMapNs,"tooltip",z)}if(this.szTimeField){var sb=(new Date(this.itemA[z].szTime)).getTime()||this.itemA[z].szTime;V.setAttributeNS(szMapNs,"time",sb)}if(this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.itemA[z].nValuesA[0]-1];else if(this.partsA.length>1)for(this.chart.szColor=this.szNoDataColor?this.szNoDataColor:"white",
e=0;e<this.partsA.length;e++)this.itemA[z].nValuesA[0]>=this.partsA[e].min&&this.itemA[z].nValuesA[0]<this.partsA[e].max&&(this.chart.szColor=this.colorScheme[e],this.itemA[z].nClass=e,this.partsA[e].nCount++);V.setAttributeNS(null,"style","stroke:"+this.chart.szColor);V.setAttributeNS(szMapNs,"class",typeof this.itemA[z].nClass!="undefined"?this.itemA[z].nClass:String(this.itemA[z].nValuesA[0]-1));var ob=map.Scale.getMapPositionOfLatLon(80,180),eb=map.Scale.getMapPositionOfLatLon(80,-180),Ka=ob&&
eb&&ob.x!==void 0&&eb.x!==void 0?ob.x-eb.x:1E7;if(Sa.type=="Point"){map.Layer.listA[this.szThemesA[0]].szType="point";Ma=Sa.coordinates;var oa=map.Scale.getMapPositionOfLatLon(Ma[1],Ma[0]);if(!oa||oa.x===void 0||oa.y===void 0)continue;V.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,oa.x,oa.y]);var Za=map.Dom.newShape("circle",V,0,0,map.Scale.normalX(1),"fill:#dd0000;fill-opacity:0.3;stroke:#dd0000;stroke-opacity:1;stroke-width:1")}if(Sa.type=="LineString"){this.chartGroup.style.setProperty("fill",
"none");map.Layer.listA[this.szThemesA[0]].szType="line";Ma=Sa.coordinates;for(var Db=[],Oa=null,Fa=!1,ra=0;ra<Ma.length;ra++){var Qa=Ma[ra][1],xb=Ma[ra][0];if((oa=map.Scale.getMapPositionOfLatLon(Qa,xb))&&oa.x!==void 0&&oa.y!==void 0){if(Oa&&Math.abs(oa.x-Oa.x)>Ka*.99){var gb=map.Scale.getMapPositionOfLatLon(Qa,xb+(oa.x<0?360:-360));if(gb&&gb.x!==void 0&&gb.y!==void 0)oa=gb;else{Oa=null;continue}}Oa?(Db.push(" l "+(oa.x-Oa.x)+","+(oa.y-Oa.y)),Fa=!0):Db.push((Db.length?" M ":"M ")+oa.x+","+oa.y);
Oa=new point(oa.x,oa.y)}else Oa=null}if(!Fa)continue;var mb=Db.join("");Za=map.Dom.newShape("path",V,mb,"")}if(Sa.type=="MultiLineString")for(e in this.chartGroup.style.setProperty("fill","none"),map.Layer.listA[this.szThemesA[0]].szType="line",Ja=Sa.coordinates,Ja){Ma=Ja[e];Db=[];Oa=null;Fa=!1;for(ra=0;ra<Ma.length;ra++)if(Qa=Ma[ra][1],xb=Ma[ra][0],(oa=map.Scale.getMapPositionOfLatLon(Qa,xb))&&oa.x!==void 0&&oa.y!==void 0){if(Oa&&Math.abs(oa.x-Oa.x)>Ka*.99)if((gb=map.Scale.getMapPositionOfLatLon(Qa,
xb+(oa.x<0?360:-360)))&&gb.x!==void 0&&gb.y!==void 0)oa=gb;else{Oa=null;continue}Oa?(Db.push(" l "+(oa.x-Oa.x)+","+(oa.y-Oa.y)),Fa=!0):Db.push((Db.length?" M ":"M ")+oa.x+","+oa.y);Oa=new point(oa.x,oa.y)}else Oa=null;Fa&&(mb=Db.join(""),Za=map.Dom.newShape("path",V,mb,""))}if(Sa.type=="Polygon"){map.Layer.listA[this.szThemesA[0]].szType="polygon";Ja=Sa.coordinates;mb="";var Wa=0,h=0,r=0;for(e in Ja){Ma=Ja[e];var n=Oa=null,E=null,F=null,I=(oa=map.Scale.getMapPositionOfLatLon(Ma[0][1],Ma[0][0]))&&
oa.x!==void 0&&oa.y!==void 0;if(I){mb+="M "+oa.x+","+oa.y;Oa=new point(oa.x,oa.y);Wa+=oa.x;h+=oa.y;r++;n=Ma[0][1];E=Ma[0][0];for(var L=1;L<Ma.length;L++){Qa=Ma[L][1];xb=Ma[L][0];var R=(oa=map.Scale.getMapPositionOfLatLon(Qa,xb))&&oa.x!==void 0&&oa.y!==void 0;if(R){if(Math.abs(oa.x-Oa.x)>Ka*.99&&(oa=map.Scale.getMapPositionOfLatLon(Qa,xb+(oa.x<0?360:-360)),!oa||oa.x===void 0||oa.y===void 0))continue;Wa+=oa.x;h+=oa.y;r++;mb+=" l "+(oa.x-Oa.x)+","+(oa.y-Oa.y);Oa=new point(oa.x,oa.y)}else if(map.Scale.szMapProjection===
"Orthographic"){var Z=Hc(Qa,xb,n,E,F);if(Z&&Z.pt){O=Math.abs(Z.pt.x-Oa.x);var na=Math.abs(Z.pt.y-Oa.y),fa=Math.sqrt(O*O+na*na),la=Ka*.5;fa<la&&(F||={lat:Z.lat,lon:Z.lon},mb+=" l "+(Z.pt.x-Oa.x)+","+(Z.pt.y-Oa.y),Oa=new point(Z.pt.x,Z.pt.y))}}n=Qa;E=xb}mb+=" z"}}mb.length>0&&r>0&&(Za=map.Dom.newShape("path",V,mb,""),V.setAttributeNS(szMapNs,"center","x:"+Wa/r+",y:"+h/r),V.setAttributeNS(szMapNs,"area",this.itemA[z].nSize),V.setAttributeNS(null,"style","fill:"+this.chart.szColor+";"))}if(Sa.type=="MultiPolygon"){Wa=
[];h=[];r=[];map.Layer.listA[this.szThemesA[0]].szType="polygon";var Na=Sa.coordinates;for(Xa in Na){Ja=Na[Xa];mb="";Wa[Xa]=0;h[Xa]=0;r[Xa]=0;for(e in Ja)if(Ma=Ja[e],F=E=n=Oa=null,I=(oa=map.Scale.getMapPositionOfLatLon(Ma[0][1],Ma[0][0]))&&oa.x!==void 0&&oa.y!==void 0){mb+="M "+oa.x+","+oa.y;Oa=new point(oa.x,oa.y);Wa[Xa]+=oa.x;h[Xa]+=oa.y;r[Xa]++;n=Ma[0][1];E=Ma[0][0];for(L=1;L<Ma.length;L++){Qa=Ma[L][1];xb=Ma[L][0];if(R=(oa=map.Scale.getMapPositionOfLatLon(Qa,xb))&&oa.x!==void 0&&oa.y!==void 0){if(Math.abs(oa.x-
Oa.x)>Ka*.99&&(oa=map.Scale.getMapPositionOfLatLon(Qa,xb+(oa.x<0?360:-360)),!oa||oa.x===void 0||oa.y===void 0))continue;Wa[Xa]+=oa.x;h[Xa]+=oa.y;r[Xa]++;mb+=" l "+(oa.x-Oa.x)+","+(oa.y-Oa.y);Oa=new point(oa.x,oa.y)}else map.Scale.szMapProjection==="Orthographic"&&(Z=Hc(Qa,xb,n,E,F))&&Z.pt&&(O=Math.abs(Z.pt.x-Oa.x),na=Math.abs(Z.pt.y-Oa.y),fa=Math.sqrt(O*O+na*na),la=Ka*.5,fa<la&&(F||={lat:Z.lat,lon:Z.lon},mb+=" l "+(Z.pt.x-Oa.x)+","+(Z.pt.y-Oa.y),Oa=new point(Z.pt.x,Z.pt.y)));n=Qa;E=xb}mb+=" z"}mb.length>
0&&r[Xa]>0&&(Za=map.Dom.newShape("path",V,mb,""))}var Ea=0;for(Xa in r)r[Xa]>Ea&&(V.setAttributeNS(szMapNs,"center","x:"+Wa[Xa]/r[Xa]+",y:"+h[Xa]/r[Xa]),V.setAttributeNS(szMapNs,"area",this.itemA[z].nSize),Ea=r[Xa]);Ea>0&&V.setAttributeNS(null,"style","fill:"+this.chart.szColor+";")}}}else(w=this.itemA[z].ptPos||this.getNodePosition(ea))&&w.x!==void 0&&w.y!==void 0&&V.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,w.x,w.y])}else(w=this.itemA[z].ptPos||this.getNodePosition(ea))&&w.x!==
void 0&&w.y!==void 0&&V.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,w.x,w.y]);else if(this.szFlag.match(/\bDOT\b/)){if((w=this.itemA[z].ptPos||this.getNodePosition(ea))&&w.x!==void 0&&w.y!==void 0){V=map.Dom.newGroup(this.chartGroup,this.szId+":"+ea+":chartgroup");V.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,w.x,w.y]);if(this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.itemA[z].nValuesA[0]-1];else if(this.partsA.length>1)for(e=0;e<
this.partsA.length;e++)this.itemA[z].nValuesA[0]>=this.partsA[e].min&&this.itemA[z].nValuesA[0]<this.partsA[e].max&&(this.chart.szColor=this.colorScheme[e]);this.itemA[z].chartNode=map.Dom.newShape("circle",V,0,0,map.Scale.normalX(3),"fill:"+this.chart.szColor+";fill-opacity:"+(this.fillOpacity||1)+";stroke:none;")}}else if(this.szFlag.match(/\bQUAD\b/)){if(w&&w.x!==void 0&&w.y!==void 0){V=map.Dom.newGroup(this.chartGroup,this.szId+":"+ea+":chart");V.fu.setMatrix([this.nChartGroupScaleX,0,0,this.nChartGroupScaleY,
w.x,w.y]);if(this.szFlag.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[this.itemA[z].nValuesA[0]-1];else if(this.partsA.length>1)for(e=0;e<this.partsA.length;e++)this.itemA[z].nValuesA[0]>=this.partsA[e].min&&this.itemA[z].nValuesA[0]<this.partsA[e].max&&(this.chart.szColor=this.colorScheme[e]);this.itemA[z].chartNode=map.Dom.newShape("rect",V,-P,-P,P*2,P*2,"fill:"+this.chart.szColor+";stroke:none;")}}else if(this.szFlag.match(/\bBEZIER\b/)){if(!(this.nMinValue&&this.itemA[z].nSize<this.nMinValue)){var U=
this.itemA[z].ptPos,lb=this.itemA[z].ptPos2||(this.szLabelA?this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[this.itemA[z].nValuesA[0]-1]):null);if(U&&lb&&U!=lb){V=this.itemA[z].chartNode=map.Dom.newGroup(this.chartGroup,this.szId+":"+z+(z?":chartgroup":":ochrtgroup"));this.chart.szColor=this.szLineColor||this.itemA[z].szColor||this.colorScheme[this.itemA[z].nValuesA[0]-1]||this.szNoDataColor;var cb=1/(this.nSizePow||1),pb=this.nLineWidth||10/Math.pow(this.nNormalSizeValue||this.nMaxSize,
cb)*Math.pow(Math.abs(this.itemA[z].nSize),cb),xc=Number(this.nGapSize||20),qb=pb+(this.szFlag.match(/\bGAP\b/)?xc:3);pb=map.Scale.normalX(pb)*this.nChartGroupScaleY*this.nScale;if(!(pb<=0)){if(this.szFlag.match(/\bREVERSE\b/)||this.itemA[z].nSize<0){var ac=U;U=lb;lb=ac}var Lb=Math.sqrt((lb.y-U.y)*(lb.y-U.y)+(lb.x-U.x)*(lb.x-U.x));Wa=lb.x-U.x;h=lb.y-U.y;Lb=Math.sqrt(Wa*Wa+h*h);this.szFlag.match(/\bDYNAMICWIDTH\b/)&&(pb*=Math.max(1,Math.log10(Lb)));if(!(Lb<=0)){var fc=this.nRangeScale;this.szFlag.match(/\bRANDOM\b/)&&
(fc-=this.nRangeScale*.66*Math.random());this.szFlag.match(/\bSHORT\b/)?(O=h/Lb*(fc||5)*100*this.nChartGroupScaleY,na=Wa/Lb*(fc||5)*100*this.nChartGroupScaleY):this.szFlag.match(/\bLONG\b/)?(O=h/5E4*Math.max(Lb,500)*(fc||5),na=Wa/5E4*Math.max(Lb,500)*(fc||5)):(O=h/50*(fc||5),na=Wa/50*(fc||5));this.szFlag.match(/\bPOINTER|ARROW\b/)&&(Wa-=Wa/Lb*map.Scale.normalX(qb)*this.nChartGroupScaleY*this.nScale*(this.nMarkerSize||1),h-=h/Lb*map.Scale.normalX(qb)*this.nChartGroupScaleY*this.nScale*(this.nMarkerSize||
1));var Ob=0,ed=0;this.szFlag.match(/\bGAP\b/)&&(Wa+=O/500*qb,h-=na/500*qb,Ob=Wa/Lb*xc*20*this.nChartGroupScaleY,ed=h/Lb*xc*20*this.nChartGroupScaleY);mb="M"+Ob+","+ed+" C"+(Wa/4+O)+","+(h/4-na)+" "+(Wa/2+O)+","+(h/2-na)+" "+Wa+","+h;Za=map.Dom.newShape("path",V,mb,"stroke-linecap:butt;fill:none;stroke:"+this.chart.szColor+";stroke-width:"+pb+";stroke-opacity:"+(this.fillOpacity||.3)+";");if(this.szFlag.match(/DOPACITYMIN/)){cb=1/(this.nDopacityPow||1);var Ab=Math.pow(this.nMax-this.itemA[z].nSize,
cb)/Math.pow(this.nMax-this.nMin,cb)*(this.fillOpacity||1)*(this.nDopacityScale||1);Za.style.setProperty("stroke-opacity",String(Ab),"")}else this.szFlag.match(/DOPACITY/)&&(cb=1/(this.nDopacityPow||1),Ab=Math.pow(this.itemA[z].nSize-this.nMin,cb)/Math.pow(this.nMax-this.nMin,cb)*(this.fillOpacity||1)*(this.nDopacityScale||1),Za.style.setProperty("stroke-opacity",String(Ab),""));if(this.szFlag.match(/\bDASH\b/)){var xa=1E3*this.nChartGroupScaleY,fb=100*this.nChartGroupScaleY+pb;Za.style.setProperty("stroke-dasharray",
String(xa)+" "+String(fb));Za.style.setProperty("stroke-dashoffset","0");Za.style.setProperty("stroke-linecap","round");var yb=Math.random()*xa,Xb=yb+xa+fb,Ta=yb;map.Dom.constructNode("animate",Za,{attributeType:"XML",attributeName:"stroke-dashoffset",from:String(Xb),to:String(Ta),dur:"2s",repeatCount:"indefinite"})}if(this.szFlag.match(/\bGRADIENT\b|\bFADEIN\b/)){var hc=this.szLineColorA?this.szLineColorA[0]:this.chart.szColor,oc=this.szFlag.match(/\bFADEIN\b/)?.2:2,Yb="Gradient"+Math.random();if(Math.abs(h)>
Math.abs(Wa)){var ic=map.Dom.constructNode("linearGradient",V,{id:Yb,x1:"0%",y1:"0%",x2:"0%",y2:"100%"});map.Dom.constructNode("stop",ic,{offset:"0","stop-color":h<0?this.chart.szColor:hc,"stop-opacity":h<0?"2":oc});map.Dom.constructNode("stop",ic,{offset:"1","stop-color":h<0?hc:this.chart.szColor,"stop-opacity":h<0?oc:"2"})}else ic=map.Dom.constructNode("linearGradient",V,{id:Yb}),map.Dom.constructNode("stop",ic,{offset:"0","stop-color":Wa<0?this.chart.szColor:hc,"stop-opacity":Wa<0?"2":oc}),map.Dom.constructNode("stop",
ic,{offset:"1","stop-color":Wa<0?hc:this.chart.szColor,"stop-opacity":Wa<0?oc:"2"});Za.style.setProperty("stroke","");Za.style.setProperty("fill","none");Za.setAttributeNS(null,"stroke","url(#"+Yb+")")}if(this.szFlag.match(/\bPOINTER|ARROW\b/)){var pc="ArrowMarker"+Math.random(),Pb=map.Dom.newNode("defs",V),jc=Math.min(5,2.5+100/(pb/this.nChartGroupScale))*(this.nMarkerSize||1),Nc=map.Dom.constructNode("marker",Pb,{id:pc,markerWidth:jc,markerHeight:jc,refX:jc/1.7,refY:jc/2,orient:"auto",markerUnits:"strokeWidth"}),
yc=map.Dom.constructNode("path",Nc,{d:"M0,"+jc+" L"+jc+","+jc/2+" L0,0 Z",style:"fill:"+this.chart.szColor+";opacity:"+(this.fillOpacity||.3)*2+";stroke:none;stroke-width:0.03"});Za.setAttributeNS(null,"marker-end","url(#"+pc+")");this.szFlag.match(/DOPACITYMIN/)?(cb=1/(this.nDopacityPow||1),Ab=Math.pow(this.nMax-this.itemA[z].nSize,cb)/Math.pow(this.nMax-this.nMin,cb)*(this.fillOpacity||1)*(this.nDopacityScale||1),yc.style.setProperty("opacity",String(Ab),"")):this.szFlag.match(/DOPACITY/)&&(cb=
1/(this.nDopacityPow||1),Ab=Math.pow(this.itemA[z].nSize-this.nMin,cb)/Math.pow(this.nMax-this.nMin,cb)*(this.fillOpacity||1)*(this.nDopacityScale||1),yc.style.setProperty("opacity",String(Ab),""))}if(this.szFlag.match(/\bVALUES\b/)&&!this.fHideValues){var Oc="VectorPath"+Math.random();Wa<0?(mb="M"+Wa+","+h+" C"+(Wa/2+O)+","+(h/2-na)+" "+(Wa/4+O)+","+(h/4-na)+" "+Ob+","+ed,map.Dom.newShape("path",V,mb,"fill:none;stroke:none").setAttributeNS(null,"id",Oc)):Za.setAttributeNS(null,"id",Oc);C=Math.min(Lb,
Math.sqrt(this.itemA[z].nSize)/Math.sqrt(this.nNormalSizeValue||this.nMaxSize)*this.nValueScale);C=24*map.Scale.normalX(C)*this.nChartGroupScaleY*this.nScale;var pd=this.formatValue(this.itemA[z].nSize,this.nValueDecimals||(this.itemA[z].nSize<1?2:0),"ROUND")+this.szUnit;map.Dom.newTextOnPath(V,Oc,pd,"font-family:arial;font-size:"+C+"px;fill:"+this.chart.szColor+";stroke:#ffffff;stroke-width:"+pb/10+"px;baseline-shift:-35%","40%")}V.setAttributeNS(szMapNs,"class",typeof this.itemA[z].nClass!="undefined"?
this.itemA[z].nClass:String(this.itemA[z].nValuesA[0]-1));V.setAttributeNS(szMapNs,"tooltip",this.formatValue(this.itemA[z].nSize,this.nValueDecimals||(this.itemA[z].nSize<1?2:0),"ROUND")+this.szUnit);this.szTimeField&&(sb=(new Date(this.itemA[z].szTime)).getTime()||this.itemA[z].szTime,V.setAttributeNS(szMapNs,"time",sb));V.fu.setMatrix([1,0,0,1,U.x,U.y])}}}}}else if(this.szFlag.match(/\bVECTOR\b/))this.nMinValue&&this.itemA[z].nSize<this.nMinValue||(U=this.itemA[z].ptPos,lb=this.itemA[z].ptPos2||
(this.szLabelA?this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[this.itemA[z].nValuesA[0]-1]):null),U&&lb&&(V=this.itemA[z].chartNode=map.Dom.newGroup(this.chartGroup,this.szId+":"+z+(z?":chartgroup":":ochrtgroup")),this.chart.szColor=this.szLineColor||this.colorScheme[this.itemA[z].nValuesA[0]-1],pb=this.nLineWidth||2/(this.nNormalSizeValue||1)/this.nMaxSize*this.itemA[z].nSize,Za=map.Dom.newShape("line",V,0,0,lb.x-U.x,lb.y-U.y,"stroke:"+this.chart.szColor+";stroke-width:"+map.Scale.normalX((pb||
.1)*this.nChartGroupScaleY)+";stroke-opacity:"+(this.fillOpacity||.3)+";"),this.szFlag.match(/\bDASH\b/)&&(xa=1E3*this.nChartGroupScaleY,fb=300*this.nChartGroupScaleY,Za.style.setProperty("stroke-dasharray",String(xa)+" "+String(fb)),Za.style.setProperty("stroke-dashoffset","0"),yb=Math.random()*xa,Xb=yb+xa+fb,Ta=yb,map.Dom.constructNode("animate",Za,{attributeType:"XML",attributeName:"stroke-dashoffset",from:String(Xb),to:String(Ta),dur:"1s",repeatCount:"indefinite"})),this.szFlag.match(/\bPOINTER|ARROW\b/)&&
(Pb=map.Dom.newNode("defs",V),Nc=map.Dom.constructNode("marker",Pb,{id:this.szId+":"+ea+":chartgroup:ArrowMarker",markerWidth:"4",markerHeight:"4",refX:"4",refY:"2",orient:"auto",markerUnits:"strokeWidth"}),yc=map.Dom.constructNode("path",Nc,{d:"M0,4 L4,2 L0,0 Z",style:"fill:"+this.chart.szColor+";opacity:"+(this.fillOpacity||.3)*2+";stroke:white;stroke-width:0.1"}),Za.setAttributeNS(null,"marker-end","url(#"+this.szId+":"+ea+":chartgroup:ArrowMarker)")),V.setAttributeNS(szMapNs,"class",typeof this.itemA[z].nClass!=
"undefined"?this.itemA[z].nClass:String(this.itemA[z].nValuesA[0]-1)),V.setAttributeNS(szMapNs,"tooltip",this.formatValue(this.itemA[z].nSize,this.nValueDecimals||(this.itemA[z].nSize<1?2:0),"ROUND")+this.szUnit),V.fu.setMatrix([1,0,0,1,U.x,U.y])));else{V=null;if(ea)if(V=map.SVGDocument.getElementById(this.szId+":"+ea+":chart"))V.fu=new Methods(V);else if(V=map.Dom.newGroup(this.chartGroup,this.szId+":"+ea+":chart"),this.szFlag.match(/BOX/)){var fd="#bbbbbb";typeof this.szBorderColor!="undefined"&&
(fd=this.szBorderColor);var bc="stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.3;";if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":bc="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":bc="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":bc="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":bc="stroke-width:0;"}if(typeof this.szBorderWidth!=
"undefined")switch(this.szBorderWidth){case "thin":bc+="stroke-width:"+map.Scale.normalX(.3)+";";break;case "thick":bc+="stroke-width:"+map.Scale.normalX(1.5)+";"}var gd=map.Dom.newShape("rect",V,0,0,1,1,"fill:"+(this.szBoxColor||"white")+";fill-opacity:"+(this.nBoxOpacity||1)+";stroke:"+fd+";"+bc);gd.setAttributeNS(null,"id",this.szId+":"+ea+":chart:box");gd.style.setProperty("pointer-events","none","");switch(this.szSymbolBoxStyle){case "frame":this.boxShape.setAttributeNS(null,"fill-opacity",0);
break;case "field":this.boxShape.setAttributeNS(null,"fill-opacity",1)}}this.itemA[z].chartNode=V;V.setAttributeNS(szMapNs,"value",String(this.itemA[z].nValuesA[0]));Va=this.drawChart(V,z,b,this.szFlag);var qd=this.nScale;this.nScale=this.nAutoScale||this.nScale;var qc=1;this.nMaxValue=="auto"&&(qc=1/Math.pow(this.nMax,1/3)*Math.pow(this.nMaxValuePlot,1/3),map.Themes.autoScale||(this.fAutoScaleLeader=!0,map.Themes.autoScale=[]),qc=map.Themes.autoScale[z]=map.Themes.autoScale[z]||qc);Va&&w&&w.x!==
void 0&&w.y!==void 0&&V&&(this.szFlag.match(/PLOT/)&&this.nGridSize&&this.nAutoScale&&(Va.x+=this.nGridSize/2/this.nAutoScale*qc,Va.y-=this.nGridSize/2/this.nAutoScale*qc),this.szFlag.match(/NOSCALE/)?V.fu.setMatrix([this.nScale,0,0,this.nScale,w.x-Va.x*this.nScale,w.y-Va.y*this.nScale]):V.fu.setMatrix([this.nChartGroupScaleX*qc,0,0,this.nChartGroupScaleY*qc,w.x-Va.x*map.Layer.nObjectScale*this.nScale,w.y-Va.y*map.Layer.nObjectScale*this.nScale]),this.itemA[z].ptPos&&this.itemA[z].ptPos2&&(V.setAttributeNS(szMapNs,
"xEnd",this.itemA[z].ptPos2.x),V.setAttributeNS(szMapNs,"yEnd",this.itemA[z].ptPos2.y),V.setAttributeNS(szMapNs,"dur",10)));this.nScale=qd;if(Va){ea=ea.split("*")[0];if((this.szFlag.match(/MULTIPLE/)||this.szFlag.match(/ALIGN/))&&V.lastChild.firstChild){var ua=map.Dom.getBox(V.lastChild),Qb=this.szFlag.match(/\bUP\b/)?ua.height:ua.width;if(this.chartPosA[ea]){this.chartPosA[ea]+=this.szFlag.match(/TEXTONLY/)?5:Qb*.5;var ub=V.lastChild.fu.getPosition(),jb=Qb*(this.nGridX||10);this.szFlag.match(/\bUP\b/)?
V.lastChild.fu.setPosition(ub.x+ua.width*Math.floor(this.chartPosA[ea]/jb),ub.y-ua.y-ua.height/2-this.chartPosA[ea]%jb):V.lastChild.fu.setPosition(ub.x+this.chartPosA[ea]%jb,ub.y-ua.height*Math.floor(this.chartPosA[ea]/jb));this.chartPosA[ea]+=this.szFlag.match(/TEXTONLY/)?Qb:Qb*.5}else this.chartPosA[ea]=this.szFlag.match(/TEXTONLY/)?Qb:-ua.y;this.posItemA&&(this.posItemA[ea]||(this.posItemA[ea]=[]),this.posItemA[ea].push(this.itemA[z]))}else if((this.szFlag.match(/MULTIFIX/)||this.szFlag.match(/MULTIGRID/))&&
V.lastChild){Qb=1;var cc=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1)),Fb=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1));if(w=this.getNodePosition(ea)){ea=String(w.x)+String(w.y);if(this.chartPosA[ea]){ub=V.lastChild.fu.getPosition();var Gb=this.chartPosA[ea];jb=this.nGridX||7;this.szFlag.match(/\bUP\b/)?V.lastChild.fu.setPosition(ub.x+cc*Math.floor(Gb/jb),ub.y-Gb%jb*Fb):V.lastChild.fu.setPosition(ub.x+Gb%jb*cc,ub.y-Fb*Math.floor(Gb/jb));this.chartPosA[ea]+=Qb}else this.chartPosA[ea]=
Qb;this.posItemA&&(this.posItemA[ea]||(this.posItemA[ea]=[]),this.posItemA[ea].push(this.itemA[z]));this.itemA[z].labelGroup&&Gb%jb!=jb-1&&this.itemA[z].labelGroup.style.setProperty("display","none","")}}else if((this.szFlag.match(/MULTISQUARE/)||this.szFlag.match(/MULTIQUAD/))&&V.lastChild&&(Qb=1,cc=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1)),Fb=map.Scale.normalX(this.nCharSizeNormal*(this.nRangeScale||1)),w=this.getNodePosition(ea))){ea=String(w.x)+String(w.y);if(this.chartPosA[ea]){ub=
V.lastChild.fu.getPosition();Gb=this.chartPosA[ea];var wb=Math.floor(Math.sqrt(Gb));wb<(this.nGridX||1E7)?(jb=Gb-wb*wb,Wa=jb<=wb?jb:wb,h=jb<=wb?wb:wb-(jb-wb),V.lastChild.fu.setPosition(ub.x+Wa*cc,ub.y-h*Fb)):(ub=V.lastChild.fu.getPosition(),Gb=this.chartPosA[ea],jb=this.nGridX||7,this.szFlag.match(/\bUP\b/)?V.lastChild.fu.setPosition(ub.x+cc*Math.floor(Gb/jb),ub.y-Gb%jb*Fb):V.lastChild.fu.setPosition(ub.x+Gb%jb*cc,ub.y-Fb*Math.floor(Gb/jb)));this.chartPosA[ea]+=Qb}else this.chartPosA[ea]=Qb;this.posItemA&&
(this.posItemA[ea]||(this.posItemA[ea]=[]),this.posItemA[ea].push(this.itemA[z]));this.itemA[z].labelGroup&&Gb%jb!=jb-1&&this.itemA[z].labelGroup.style.setProperty("display","none","")}if(this.szFlag.match(/TEXTONLY/)&&map.fCheckLabelOverlap){var Bb=map.SVGDocument.getElementById(this.szId+":"+z+":text");Bb&&new ixMap.Label.Item(Bb)}t&&setRotate(V,-Number(t));this.fShadow===!0&&map.SVGDocument.getElementById(map.szShadowFilterId)?V.style.setProperty("filter","url(#"+map.szShadowFilterId+")",""):this.fShadow===
!0&&(ja=map.Dom.newNode("filter",this.chartGroup.parentNode),ja.setAttributeNS(null,"id",map.szShadowFilterId),ja.setAttributeNS(null,"filterUnits","objectBoundingBox"),ja.setAttributeNS(null,"x","-50%"),ja.setAttributeNS(null,"y","-50%"),ja.setAttributeNS(null,"width","200%"),ja.setAttributeNS(null,"height","200%"),da=map.Dom.newNode("feGaussianBlur",ja),da.setAttributeNS(null,"stdDeviation","10"),da.setAttributeNS(null,"result","BlurAlpha"),da=map.Dom.newNode("feOffset",ja),da.setAttributeNS(null,
"in","BlurAlpha"),da.setAttributeNS(null,"dx","10"),da.setAttributeNS(null,"dy","10"),da.setAttributeNS(null,"result","OffsetBlurAlpha"),da=map.Dom.newNode("feColorMatrix",ja),da.setAttributeNS(null,"in","OffsetBlurAlpha"),da.setAttributeNS(null,"type","matrix"),da.setAttributeNS(null,"values","0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0.1 0.1 0.1 0 0 0 0 0 1 0"),da.setAttributeNS(null,"result","matrixOut"),da=map.Dom.newNode("feMerge",ja),sa=map.Dom.newNode("feMergeNode",da),sa.setAttributeNS(null,"in","matrixOut"),
sa=map.Dom.newNode("feMergeNode",da),sa.setAttributeNS(null,"in","SourceGraphic"),ua=map.Dom.getBox(V.lastChild),ua.width&&ua.height&&V.style.setProperty("filter","url(#"+map.szShadowFilterId+")",""))}}}}if(this.szFlag.match(/BOX/))if(this.nBoxUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nBoxUpper||this.nBoxLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nBoxLower){var bb=map.SVGDocument.getElementById(this.szId+":"+Xa+":chart:box");bb&&bb.parentNode.removeChild(bb)}else for(Aa=
0;Aa<this.indexA.length;Aa++)if(z=this.indexA[Aa],this.itemA[z].fDone){var Xa=this.itemA[z].szSelectionId;V=map.SVGDocument.getElementById(this.szId+":"+Xa+":chart");x=map.SVGDocument.getElementById(this.szId+":"+Xa+":chartgroup");bb=map.SVGDocument.getElementById(this.szId+":"+Xa+":chart:box");if(V&&bb&&!bb.getAttributeNS(szMapNs,"boxed")){this.szFlag.match(/\bPLOT\b/)&&x&&x.style.setProperty("display","none");ua=map.Dom.getBox(V);var Mb=map.Scale.normalX(this.nBoxMargin||2);Mb=Math.min(Mb*2,Mb*
(ua.width/map.Scale.normalX(b)));var Pc=new point(ua.x+ua.width/2,ua.y+ua.height/2);if(this.szFlag.match(/CIRCULAR/)){var Rb=Math.max(ua.width,ua.height)/2*1.1+Mb,Sb=map.Dom.newShape("circle",bb.parentNode,Pc.x,Pc.y,Rb,"fill:"+(this.szBoxColor||"#eeeeee")+";stroke:"+(this.szBorderColor||"#dddddd")+";fill-opacity:"+(this.nBoxOpacity||1));bb.parentNode.insertBefore(Sb,bb.parentNode.firstChild);bb.parentNode.removeChild(bb);ua.x-=(Rb*2-ua.width)/2;ua.y-=(Rb*2-ua.height)/2;ua.height=ua.width=Rb*2}if(this.szFlag.match(/TITLE/)&&
this.szTitleField&&(!this.szTitleUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nTitleUpper)&&(!this.szTitleLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nTitleLower)){C=map.Scale.normalX(5);this.szFlag.match(/DTEXT/)&&(C=Math.max(map.Scale.normalX(.9),Math.min(ua.width/5,map.Scale.normalX(14/this.nScale))));this.szFlag.match(/GRIDSIZE/)&&(C=Math.max(ua.width/10,map.Scale.normalX(6)));C*=this.nTextScale||this.nValueScale||1;var Zb=this.itemA[z].szTitle;try{Zb=map.HTMLWindow.ixmaps.htmlgui_onInfoTitle(this.itemA[z].szTitle,
this.itemA[z])}catch(Hc){}Zb+=this.szTitleUnits||"";var zc=this.szTextColor||"#888888",Pa=this.szFlag.match(/BOTTOMTITLE/)?ua.y+ua.height+C*1:ua.y-C*.7;this.szFlag.match(/BAR/)&&!this.szFlag.match(/BOTTOMTITLE/)&&(Pa=this.nMaxValue?-this.nMaxValue*b/this.nScale:Pa);var Tb=null,Ac=null;this.szFlag.match(/CIRCULAR/)?(Ac=map.Dom.newText(V,Pc.x+10,Pa,"font-family:arial;font-size:"+C+"px;text-anchor:middle;fill:none;stroke:white;stroke-width:"+C/7+"px;opacity:0.5;pointer-events:none;",String(Zb||" ")),
Tb=map.Dom.newText(V,Pc.x+10,Pa,"font-family:arial;font-size:"+C+"px;text-anchor:middle;fill:"+zc+";stroke:none;pointer-events:none;",String(Zb||" "))):this.szAlign&&this.szAlign.match(/right/)?(Ac=map.Dom.newText(V,ua.x+ua.width,Pa,"font-family:arial;font-size:"+C+"px;text-anchor:end;fill:none;stroke:white;stroke-width:"+C/7+"px;opacity:0.5;pointer-events:none;",String(Zb||" ")),Tb=map.Dom.newText(V,ua.x+ua.width,Pa,"font-family:arial;font-size:"+C+"px;text-anchor:end;fill:"+zc+";stroke:none;pointer-events:none;",
String(Zb||" "))):(Ac=map.Dom.newText(V,ua.x,Pa,"font-family:arial;font-size:"+C+"px;text-anchor:start;fill:none;stroke:white;stroke-width:"+C/7+"px;opacity:0.5;pointer-events:none;",String(Zb||" ")),Tb=map.Dom.newText(V,ua.x,Pa,"font-family:arial;font-size:"+C+"px;text-anchor:start;fill:"+zc+";stroke:none;pointer-events:none;",String(Zb||" ")));map.Dom.wrapText(Ac,ua.width);var pa=map.Dom.wrapText(Tb,ua.width);this.szFlag.match(/BOTTOMTITLE/)||(Ac.fu.setPosition(Tb.fu.getPosition().x,Tb.fu.getPosition().y-
C*1*(pa-1)),Tb.fu.setPosition(Tb.fu.getPosition().x,Tb.fu.getPosition().y-C*1*(pa-1)));if(this.szFlag.match(/CLIPPEDTITLE/)){var rb=ua.height;ua.height+=C*1.8;ua.y-=ua.height-rb;map.Dom.setClipRect(Tb,new box(ua.x,ua.y-C*10,ua.width-C/3,C*20))}else ua=map.Dom.getBox(V),ua.y+=C*.1,ua.height-=C*.1;this.szTimeField&&(sb=(new Date(this.itemA[z].szTime)).getTime()||this.itemA[z].szTime,Tb.setAttributeNS(szMapNs,"time",sb))}if(this.szFlag.match(/\bPLOTX\b/))rb=ua.height,ua.height=map.Scale.normalX(b),ua.y=
-map.Scale.normalX(b/2),ua.width=this.nMax*map.Scale.normalX(b*1.1)/this.nMax*5*(this.nRangeScale||1);else if(this.szFlag.match(/\bPLOTY\b/)){rb=ua.height;var Qc=ua.width;ua.width=map.Scale.normalX(b);ua.height=this.nMax*map.Scale.normalX(b*1.1)/this.nMax*5*(this.nRangeScale||1);ua.x-=(ua.width-Qc)/2;ua.y-=(ua.height-rb)/2}var Hb=ua.height+Mb*2;ua.width+Mb*2>=0&&Hb>=0&&(bb.setAttributeNS(null,"x",ua.x-Mb),bb.setAttributeNS(null,"y",ua.y-Mb),bb.setAttributeNS(null,"width",ua.width+Mb*2),bb.setAttributeNS(null,
"height",ua.height+Mb*2));(this.szFlag.match(/AUTOSIZE/)||this.szFlag.match(/GRIDSIZE/))&&ua.width>ua.height&&(bb.setAttributeNS(null,"y",ua.y-Mb-(ua.width-ua.height)),bb.setAttributeNS(null,"height",ua.width+Mb*2));if(typeof this.nBorderRadius!="undefined"&&!isNaN(this.nBorderRadius)){var hd=Math.min(map.Scale.normalX(this.nBorderRadius),map.Scale.normalX(this.nBorderRadius*(ua.width/map.Scale.normalX(b))));bb.setAttributeNS(null,"rx",hd);bb.setAttributeNS(null,"ry",hd)}var Ca=map.Scale.normalX((this.szBorderWidth||
1)*.2*(ua.width/map.Scale.normalX(b)));bb.style.setProperty("stroke-width",Ca);bb.setAttributeNS(szMapNs,"boxed","1");this.szFlag.match(/\bPLOT\b/)&&x&&x.style.setProperty("display","inline");this.szTimeField&&(sb=(new Date(this.itemA[z].szTime)).getTime()||this.itemA[z].szTime,bb.setAttributeNS(szMapNs,"time",sb))}}if(this.szFlag.match(/FEATURE/)){map.Themes.addToThemeNodesCache(this.chartGroup);var rc=map.Themes.getAllThemes();for(e in rc)rc[e]!=this&&!rc[e].szFlag.match(/FEATURE/)&&rc[e].szThemesA[0]==
this.szThemesA[0]&&rc[e].fDone&&(rc[e].fRealize=!0,setTimeout("map.Themes.execute()",500))}this.szItemFilter&&this.szItemFilter.length&&this.filterItems(this.szItemFilter,this.itemFilterOpt);this.markedClass!=null&&this.markClass(this.markedClass,1);this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;displayProgressBar(1,1,"",1,"",1);this.showInfo();this.szFlag.match(/SHOWSTATISTIC/)&&this.showErrorInfo();if(this.szFlag.match(/\bCLIP\b/))if(this.nClipFrames==this.itemA[z].nValuesA.length)this.szXaxisA&&
this.szXaxisA[this.nActualFrame]?displayMessage(this.szXaxisA[this.nActualFrame],3E3,"big"):this.szLabelA&&this.szLabelA[this.nActualFrame]&&displayMessage(this.szLabelA[this.nActualFrame],3E3,"big");else{var Rc=this.szXaxisA||this.szLabelA;Rc&&(this.nActualFrame===0?displayMessage(Rc[0],3E3,"big"):this.nActualFrame==this.nClipFrames-1?displayMessage(Rc[1],3E3,"big"):displayMessage(" ... ",3E3,"big"))}else this.ErrorMessage?(displayMessage(this.ErrorMessage,1E4,"notify"),this.ErrorMessage=null):clearMessage();
this.fSorted||(this.fResort=!0,map.Themes.execute());this.szFlag.match(/DECLUTTER/)&&this.declutterCharts();this.szFlag.match(/\bANIMATESCALE\b/)&&this.animateCharts("scale");this.szFlag.match(/\bANIMATESCALEXX\b/)&&this.animateCharts("fire");if(this.szFlag.match(/\bUSER\b/))try{qa={target:this.chartGroup,theme:this},this.userDraw&&(this.opt=qa,eval("map.HTMLWindow.ixmaps."+this.userDraw+"_finish(map.SVGDocument,this.opt);"),delete this.opt)}catch(Hc){}}};D.prototype.sortChartObjects=function(){if(!(!this.chartGroup||
this.szFlag.match(/NOSRT/)||this.szFlag.match(/NOSIZE/)&&!this.szFlag.match(/3D/)||this.szFlag.match(/CATEGORICAL/)&&!this.szFlag.match(/AGGREGATE/)&&!this.szSizeField)){var c=[],b=this.chartGroup.childNodes;if(this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/TEXTONLY/))for(var f=0;f<b.length;f++){var a=b.item(f);c[f]={node:a,y:Math.abs(Number(a.getAttributeNS(szMapNs,"value")))}}else{var p=getRotateAttributeValue(map.Scale.canvasNode)/180*
Math.PI;for(f=0;f<b.length;f++)a=b.item(f),c[f]=p?{node:a,y:getTranslate(a).x*Math.sin(p)+getTranslate(a).y*Math.cos(p)}:{node:a,y:getTranslate(a).y}}this.szFlag.match(/\bSORT\b/)&&this.szFlag.match(/\bUP\b/)&&!this.szFlag.match(/SEQUENCE/)?c.sort(this.sortDownChartObjectsCompare):c.sort(this.sortUpChartObjectsCompare);for(f=0;f<c.length;f++)c[f].node.parentNode.appendChild(c[f].node);var m;(m=getMatrix(this.chartGroup))&&setMatrix(this.chartGroup,m)}};D.prototype.sortUpChartObjectsCompare=function(c,
b){return c.y-b.y};D.prototype.sortDownChartObjectsCompare=function(c,b){return b.y-c.y};D.prototype.getChartSize=function(c,b,f,a){if(f.match(/NOSIZE/))return Math.max(5,b/4);a=Math.abs(a);var p=Math.max(5,b/2),m=this.nMax-this.nMin;this.nNormalSizeValue&&(m=this.nMaxSize=this.nNormalSizeValue);var w=this.itemA[c].nValue100A[0];f.match(/SIZE/)&&!f.match(/NORMSIZE/)&&this.szSizeField&&c&&this.itemA[c]?p=f.match(/SIZELOG/)?Math.max(1,p/Math.log(this.nMaxSize)*Math.log(this.itemA[c].nSize)):p/Math.pow(this.nMaxSize,
1/this.nSizePow)*Math.pow(this.itemA[c].nSize,1/this.nSizePow):f.match(/SIZE/)&&!f.match(/NORMSIZE/)&&(p=f.match(/SIZELOG/)?Math.max(1,p/Math.log(m)*Math.log(a)):p/Math.pow(m,1/this.nSizePow)*Math.pow(a,1/this.nSizePow));map.Scale.normalX(10);!f.match(/HEIGHT/)||f.match(/NORMSIZE/)||f.match(/SIZE/)||w&&this.nMax100&&this.nMin100&&f.match(/FRACTION/);f.match(/ZOOM/)&&(this.origSize=p*=map.Scale.nObjectScaling,p=b/10+p*1/(Math.log(Math.abs(m))*Math.log(Math.abs(a))||1),p=Math.min(p,b),p=Math.max(p,
b/5));return Math.abs(p)};D.prototype.checkChartSize=function(c,b,f,a){return this.nChartSizeMin&&!f.match(/ZOOM/)&&this.getChartSize(c,b,f,a)/map.Layer.nObjectScale<this.nChartSizeMin?!1:!0};D.prototype.getChart=function(c,b,f,a,p){this.fRealizeDone||this.realize();return this.drawChart(c,b,f,a,p)};D.prototype.drawChart=function(c,b,f,a,p){var m=null,w=0,C=0;this.szChartFlag=a;if(b){if(!this.itemA[b])return null;this.itemA[b].fDone=!1;m=this.itemA[b].nValuesA;w=this.itemA[b].nValue100A[0];C=Math.max(this.nMax,
Math.abs(this.nMin));var z=0;if(!this.szFlag.match(/BUFFER/))for(var y=0;y<m.length;y++)isNaN(m[y])&&(m[y]=0),z+=m[y];if(this.szFlag.match(/MORPH/)&&this.szFlag.match(/\bCLIP\b/)&&this.nClipFrames){m=[];var O=this.itemA[b].nValuesA;for(y=0;y<O.length/2;y++){var t=O[y]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+O[y+O.length/2]*this.nActualFrame/(this.nClipFrames-1);m[y]=t}for(y=z=0;y<m.length;y++)isNaN(m[y])&&(m[y]=0),z+=m[y]}if(a.match(/NOPE/))return new point(0,0);if(a.match(/\bDOT\b/)){var d=
1;t=m[0];if(a.match(/CATEGORICAL/))this.chart.szColor=this.colorScheme[t];else if(this.colorScheme.length>2||this.szRanges&&this.szRanges.length)for(Ab=!1,y=0;y<this.partsA.length;y++)if(t<this.partsA[y].max){this.chart.szColor=this.colorScheme[y];var e=N(H);a.match(/NOLINES/)?this.chart.szLineColor="none":this.chart.szLineColor=e.textColor;a.match(/RANGE/)&&!a.match(/RANGES/)&&(d=map.Scale.normalX(2+5*(y+1)/this.partsA.length));xa=y;Ab=!0;break}M=map.Dom.newShape("circle",c,0,0,map.Scale.normalX(3),
"fill:"+this.chart.szColor+";stroke:none;");return new point(0,0)}}else{m=[];z=0;a=a||this.szFlag+"|XAXIS";if(this.szOrigFlag.match(/CATEGORICAL/))if(this.szOrigFlag.match(/SUM/))for(y=0;y<this.colorScheme.length;y++)this.partsA[y]&&(m[y]=this.partsA[y].nSum,C=Math.max(C,this.partsA[y].nSum),z+=m[y]);else if(this.szOrigFlag.match(/COUNT/))for(y=0;y<this.colorScheme.length;y++)m[y]=this.partsA[y].nSum*100,C=Math.max(C,this.partsA[y].nSum*100),z+=m[y];else for(y=0;y<this.colorScheme.length;y++)m[y]=
this.nOrigSumA[y]||this.exactCountA[y]||1,C=Math.max(C,this.nOrigSumA[y]||this.exactCountA[y]||1);else if(this.szOrigFlag.match(/COUNT/))for(y=0;y<this.colorScheme.length;y++)m[y]=this.partsA[y].nCount,C=Math.max(C,this.partsA[y].nCount),z+=m[y];else for(y=0;y<this.colorScheme.length;y++)m[y]=this.partsA[y].nSum,C=Math.max(C,this.partsA[y].nSum),z+=m[y];if(w=this.nSum100){C=0;z=w;for(y=m.length-1;y>=0;y--)this.szFlag.match(/DIFFERENCE/)?w=y>0?m[y-1]:this.nSum100:this.szFlag.match(/CALCVAL/)||this.szFlag.match(/CALC100/)?
m[y]=m[y]:this.szFlag.match(/PRODUCT/)?m[y]=m[y]:(m[y]/=w,C=Math.max(C,m[y]),this.szFlag.match(/PERMILLE/)?m[y]*=1E3:this.szFlag.match(/FRACTION/)||(m[y]*=100),this.szFlag.match(/RELATIVE/)&&(m[y]-=100),this.szFlag.match(/INVERT/)&&(m[y]=100-m[y]));if(this.szFlag.match(/STACKED/)){if(C=100,this.szFlag.match(/NORMSIZE/)||a.match(/NORMSIZE/))for(y=C=0;y<m.length;y++)C+=m[y]}else C*=100,C+=C/10,C=this.nMax}else{if(this.szFlag.match(/DIFFERENCE/))for(y=m.length-1;y>=0;y--)y>0?m[y]-=m[y-1]:this.szFlag.match(/STACKED/)||
(m[y]=0);if(b&&this.szAggregation&&this.szAggregation.match(/mean/)){for(y=0;y<m.length;y++)m[y]/=this.nCount;C=this.szFlag.match(/MENUSIZE/)?C/this.nCount:this.nMax}if(this.szFlag.match(/MEAN/))for(y=0;y<m.length;y++)m[y]/=this.partsA[y].nCount;if(this.szFlag.match(/STACKED/)&&(this.szFlag.match(/NORMSIZE/)||a.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||a.match(/MENUSIZE/)))for(y=C=0;y<m.length;y++)C+=m[y]}}if(this.nChartSizeMin&&!a.match(/ZOOM/)){if(d=b?this.getChartSize(b,f,a,z):1,d/map.Layer.nObjectScale<
this.nChartSizeMin)return null}else if(!this.szFlag.match(/MULTIFIX|MULTIGRID|MULTIQUAD/)&&(d=b?this.getChartSize(b,f,a,z):1,isNaN(d)||d===0))return null;var g=new point(0,0);if(!a)a=this.szFlag;else if(!a.match(/CHART/)&&a.match(/VALUES/)||a.match(/NORMSIZE/)||a.match(/MENUSIZE/))a=this.szFlag+"|"+a;a.match(/DOMINANT|COMPOSE/)&&!a.match(/CHART/)&&(a=a.match(/PERCENTOFMEAN/)?"BAR|OFFSETMEAN|POINTER|XAXIS|VALUES|ZOOM":a.match(/PERCENTOFMEDIAN/)?"BAR|OFFSETMEDIAN|POINTER|XAXIS|VALUES|ZOOM":a.match(/DEVIATION/)?
"BAR|DEVIATION|POINTER|VALUES|ZOOM":"BAR|XAXIS|HORZ|SORT|VALUES|ZOOM");a.match(/ZOOM/)&&a.match(/BAR/)&&a.match(/POINTER/)&&m.length>1&&(a=this.removeDefinition(a,"SIZE")+"|COMPRESSMAX");if(m.length==1&&m[0]===0&&!a.match(/ZEROISVALUE|AUTOCOMPLETE|CATEGORICAL/))return this.nZeroValueCount++,null;a.match(/VALUES/)&&(this.fHideValues=!1,a.match(/ZOOM/)||(this.fHideValues=this.szValueUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nValueUpper||this.szValueLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<
this.nValueLower),a.match(/ZOOM/)&&a.match(/PIE/)&&m.length>25&&(a=this.removeDefinition(a,"VALUES")));var l=map.Dom.newGroup(c,this.szId+":"+b+(b?":chartgroup":":ochrtgroup")),u=null,k=null;a.match(/MOVABLE/)&&(l.setAttributeNS(null,"id",l.getAttributeNS(null,"id")+":movable"),l.setAttributeNS(null,"onmousedown",'map.Themes.initChartOffset(evt,"'+this.szId+'","'+this.szId+":"+b+':chartgroup:movable")'),l.setAttributeNS(null,"onmouseup",'map.Themes.endChartOffset(evt,"'+this.szId+'","'+this.szId+
":"+b+':chartgroup:movable")'));if(a.match(/CHOROPLETH/)){var v=map.Scale.normalX(f/2),x=v*2/3,H=this.colorScheme[0],G=this.colorScheme[1]?this.colorScheme[1]:"none",P=map.Scale.normalX(.1)*map.Scale.nFeatureScaling*map.Scale.nObjectScaling,M=map.Dom.constructNode("use",l,{"xlink:href":"#choropleth_icon"});M.fu.scale(2,2);f=x*2/map.Scale.normalX(1);g.x=0;g.y=x+map.Scale.normalY(5)}if(a.match(/BLANK/))return null;if(a.match(/\bUSER\b/))try{v=map.Scale.normalX(f/2);if(a.match(/AUTOSIZE/)){var T=map.Layer.nDynamicObjectScale,
qa=a.match(/\bRECT\b/)?a.match(/GAP/)?2.3:2:a.match(/GAP/)?1.7:1.6;X=Math.max(this.nAllMaxValue,this.nMax);v=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/qa/T:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/qa/T:v}var X=Math.max(this.nMax,this.nMaxA[0]);this.nNormalSizeValue&&(this.nMaxSize=X=this.nNormalSizeValue);t=this.itemA[b].nValuesA[0];H=this.colorScheme[0];G=this.colorScheme[1]?this.colorScheme[1]:"none";var ja=this.colorScheme[1]?this.colorScheme[1]:"white";
if(this.colorScheme.length>2||a.match(/CATEGORICAL/))H=this.colorScheme[this.colorScheme.length-1],G=this.colorScheme[0];a.match(/NOLINES/)?G="none":G=="none"&&(e=N(H),G=e.lowColor);if(a.match(/CATEGORICAL/))xa=t-1,H=this.colorScheme[xa]||this.colorScheme[0],e=N(H),ja=e.textColor,G=a.match(/NOLINES/)?"none":e.lowColor,a.match(/RANGE/)&&!a.match(/RANGES/)&&(x=map.Scale.normalX(2+5*(y+1)/this.partsA.length)),Ab=!0;else if(this.szFlag.match(/COMPOSECOLOR/))this.szFlag.match(/SUBTRACTIVE/)?this.itemA[b].szColor=
ha(this.itemA[b].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):this.itemA[b].szColor=ka(this.itemA[b].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255));else if(this.colorScheme.length>2||this.partsA.length>1||this.szRanges&&this.szRanges.length)if(Ab=!1,this.szFlag.match(/DOMINANT/)){var da=0,sa=0;pa=-1;for(y=0;y<this.itemA[b].nValuesA.length;y++){t=this.itemA[b].nValuesA[y];var Aa=100/this.nMeanA[y]*t,V=100/this.nMedianA[y]*t,ea=(t-this.nMeanA[y])/this.nDeviationA[y];
da=t;this.szFlag.match(/PERCENTOFMEAN/)&&(da=Aa);this.szFlag.match(/PERCENTOFMEDIAN/)&&(da=V);this.szFlag.match(/DEVIATION/)&&(da=ea);t>this.nFilterA[y]&&da>sa&&(this.itemA[b].nClass=y,sa=da,pa=y)}pa>=0&&(this.itemA[b].nDominant=pa,t=this.itemA[b].nValuesA[pa],h=" "+this.szFieldsA[pa]+" ",this.szLabelA&&this.szLabelA[pa]&&(h=" "+this.szLabelA[pa]+" "),this.itemA[b].nValue=this.itemA[b].nValuesA[pa],this.itemA[b].szLabel=h,H=this.colorScheme[pa],e=N(H),ja=e.textColor,G=a.match(/NOLINES/)?"none":e.lowColor,
xa=pa,Ab=!0,t=m[xa||0])}else for(y=0;y<this.partsA.length;y++)if(t>=this.partsA[y].min&&t<this.partsA[y].max){H=this.colorScheme[y];e=N(H);ja=e.textColor;G=a.match(/NOLINES/)?"none":e.lowColor;a.match(/RANGE/)&&!a.match(/RANGES/)&&(x=map.Scale.normalX(2+5*(y+1)/this.partsA.length));xa=y;Ab=!0;break}if(this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(this.nClipFrames==m.length?(t=Number(m[this.nActualFrame]),X=this.nNormalSizeValue||this.nMaxA[this.nActualFrame]):t=m[0]*
(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+m[m.length-1]*this.nActualFrame/(this.nClipFrames-1),t===0&&!a.match(/ZEROISVALUE/))||a.match(/INVERTSIZE/)&&X-m[0]===0&&!a.match(/ZEROISVALUE/))return null;var Va=b&&this.itemA[b]&&this.szSizeField?this.itemA[b].nSize||0:t,Sa=b&&this.itemA[b]&&this.szSizeField?this.nMaxSize:X;if(Va===0&&!a.match(/NOSIZE/)||this.nMinValue&&Va<this.nMinValue)return null;x=a.match(/GRIDSIZE/)?this.nGridSize:a.match(/MENUSIZE/)?map.Scale.normalX(f/2.5):a.match(/CATEGORICAL/)&&
!this.szSizeField?v/3/(this.nNormalSizeValue||1):a.match(/NOSIZE/)?v/2:a.match(/FIXSIZE/)?v/2/(this.nNormalSizeValue||1):a.match(/NORMSIZE/)?v*2/3/(a.match(/CATEGORICAL/)?1:Math.log(Sa)*Math.log(Math.abs(Va))):a.match(/SUM/)&&!b?v*2/3:v/Math.pow(Sa,1/this.nSizePow)*Math.pow(Math.abs(Va),1/this.nSizePow);l.parentNode.setAttributeNS(szMapNs,"value",String(t));l.parentNode.setAttributeNS(szMapNs,"class",String(xa));var Ja=N(H).lowColor,tb=this.objThemesA[this.szThemesA[0]],Ma={target:l,theme:this,item:this.itemA[b],
value:t,values:m,size:x,maxSize:v,color:H,textcolor:Ja,ccolor:N(H),class:xa,flag:a,mark:p,dbRecord:tb.dbRecords?tb.dbRecords[this.itemA[b].dbIndex]:null};this.ptNullUser=null;this.userDraw?(this.opt=Ma,eval("this.ptNullUser = map.HTMLWindow.ixmaps."+this.userDraw+"(map.SVGDocument,this.opt);"),delete this.opt):this.ptNullUser=map.HTMLWindow.ixmaps.htmlgui_drawChart(map.SVGDocument,Ma);this.ptNullUser?(l.fu.setPosition(l.fu.getPosition().x-this.ptNullUser.x,l.fu.getPosition().y-this.ptNullUser.y),
this.ptNullUser.x=0,this.ptNullUser.y=0):this.userChartDrawError=(this.userChartDrawError||0)+1}catch(Nd){}if(a.match(/PIE/)){if(z===0&&!a.match(/AUTOCOMPLETE/))return null;if(a.match(/\bSORT\b/)){this.sortedIndex=[];for(y=0;y<m.length;y++)this.sortedIndex[y]={index:y,value:m[y]};this.sortedIndex.sort(this.sortIndexDown)}else this.sortedIndex=null;if(a.match(/\bREVERSE\b/))for(this.sortedIndex=[],y=0;y<m.length;y++)this.sortedIndex[y]={index:m.length-y,value:m[y]};this.nCenterValue=0;if(a.match(/CENTER/)){for(var Eb=
this.nCenter=0,sb=-Number.MAX_VALUE,ob=Number.MAX_VALUE,eb=0;eb<(this.nClipParts||m.length);eb++){var Ka=this.sortedIndex?this.sortedIndex[eb].index:eb;Eb+=m[Ka]||0;m[Ka]<ob&&(ob=m[Ka],this.nCenterMin=Ka);m[Ka]>sb&&(sb=m[Ka],this.nCenterMax=Ka)}this.szCenterPart=this.szCenterPart||"max",this.szCenterPart=="first"?this.nCenter=0:this.szCenterPart=="last"?this.nCenter=m.length-1:this.szCenterPart=="min"?this.nCenter=this.nCenterMin:this.szCenterPart=="max"?this.nCenter=this.nCenterMax:Number(this.szCenterPart)&&
(this.nCenter=Number(this.szCenterPart));this.nCenterValue=m[this.nCenter];this.nCenterSize=this.nCenterValue/Eb*200}var oa=0;d=Math.max(5,f/2);var Za=this.nMax-this.nMin,Db=this.nMax100-this.nMin100;this.nNormalSizeValue&&(Za=Db=this.nNormalSizeValue);a.match(/GRIDSIZE/)&&!a.match(/NORMSIZE/)?d=this.nGridSize/f*(a.match(/\bRECT\b/)?.72:.6):a.match(/SIZE/)&&!a.match(/NORMSIZE/)&&this.szSizeField&&b&&this.itemA[b]?d=a.match(/SIZELOG/)?Math.max(1,d/Math.log(this.nMaxSize)*Math.log(this.itemA[b].nSize)):
d/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[b].nSize,1/this.nSizePow):a.match(/SIZE/)&&!a.match(/NORMSIZE/)&&(d=a.match(/SIZELOG/)?Math.max(1,d/Math.log(Za)*Math.log(z)):d/Math.pow(Za,1/this.nSizePow)*Math.pow(z,1/this.nSizePow));oa=map.Scale.normalX(10);a.match(/HEIGHT/)&&!a.match(/NORMSIZE/)&&(oa=a.match(/SIZE/)?this.szSizeField&&b&&this.itemA[b]?oa*Math.pow(10/Za*this.itemA[b].nSize,1/3)*3:oa*Math.pow(10/Za*z,1/3)*3:w&&this.nMax100&&this.nMin100&&!a.match(/FRACTION/)?oa*10/Db*
w:oa*10/Za*z);a.match(/ZOOM/)&&(this.origSize=d*=map.Scale.nObjectScaling,d=f/10+d*3/Math.log(Za)*Math.log(z)*map.Layer.nDynamicObjectScale,d=Math.min(d,f*1.2),d=Math.max(d,f/2));for(var Oa=[],Fa=0;Fa<(this.nGridX||1);Fa++){var ra=DonutCharts.newChart(map.SVGDocument,l,0,0,map.Scale.normalX(d),0);ra.ident=Fa;g.x=0;g.y=map.Scale.normalY(d)+map.Scale.normalY(5);ra.setStyle("flat");ra.setLine("#555566");ra.setLineWidth(map.Scale.normalX(this.nLineWidth||.1));a.match(/NOLINES/)&&ra.setLine("none");a.match(/WHITELINES/)&&
ra.setLine("white");this.szLineColor&&ra.setLine(this.szLineColor);if(a.match(/3D/)){ra.setStyle("3D");var Qa=.5;a.match(/P3/)?Qa=1/3:a.match(/P4/)&&(Qa=.25);a.match(/SIZE/)&&!a.match(/NORMSIZE/)&&this.szSizeField&&b&&this.itemA[b]?oa=oa/Math.pow(this.nMaxSize,Qa)*Math.pow(this.itemA[b].nSize,Qa):a.match(/SIZE/)&&!a.match(/NORMSIZE/)&&(oa=oa/Math.pow(Za,Qa)*Math.pow(z,Qa));a.match(/ZOOM/)&&(oa*=map.Scale.nObjectScaling,oa=oa/this.origSize*d);g.y*=.7}a.match(/VOLUME/)&&ra.addStyle("VOLUME");if(a.match(/DONUT/))a.match(/3D/)?
ra.setRadInner(map.Scale.normalX(d*.5)):a.match(/XTHIN/)?ra.setRadInner(map.Scale.normalX(d*.95)):a.match(/THIN/)?ra.setRadInner(map.Scale.normalX(d*.66)):a.match(/THICK/)?ra.setRadInner(map.Scale.normalX(d*.25)):ra.setRadInner(map.Scale.normalX(d*.42));else if(a.match(/CENTER/)){var xb=Math.sqrt(Math.pow(map.Scale.normalX(d),2)/100*this.nCenterSize);ra.setRadInner(xb)}a.match(/STARBURST/)&&(ra.addStyle("STARBURST"),g.y*=.8);if(a.match(/XLFLOWER/)||a.match(/XLRAYS/))ra.addStyle("XLRAYS"),g.y*=.8;
else if(a.match(/LFLOWER/)||a.match(/LRAYS/))ra.addStyle("LRAYS"),g.y*=.8;else if(a.match(/XSFLOWER/)||a.match(/XSRAYS/))ra.addStyle("XSRAYS"),g.y*=.8;else if(a.match(/SFLOWER/)||a.match(/SRAYS/))ra.addStyle("SRAYS"),g.y*=.8;else if(a.match(/FLOWER/)||a.match(/RAYS/))ra.addStyle("RAYS"),g.y*=.8;a.match(/SILENT/)&&ra.addStyle("SILENT");a.match(/AUTOCOMPLETE/)&&(ra.addStyle("AUTOCOMPLETE"),ra.szNoDataColor=this.szNoDataColor||"#eeeeee");a.match(/BIGTOTOP/)&&ra.addStyle("BIGTOTOP");a.match(/NOROTATE/)&&
ra.addStyle("NOROTATE");a.match(/ROTATE/)&&ra.addStyle("ROTATE");a.match(/SYMMETRIC/)&&ra.addStyle("SYMMETRIC");a.match(/HALFPLUS20/)&&(ra.addStyle("HALFPLUS20"),ra.addStyle("NOROTATE"));a.match(/HALFMINUS20/)&&(ra.addStyle("HALFMINUS20"),ra.addStyle("NOROTATE"));a.match(/HALFPLUS10/)&&(ra.addStyle("HALFPLUS10"),ra.addStyle("NOROTATE"));a.match(/HALFMINUS10/)&&(ra.addStyle("HALFMINUS10"),ra.addStyle("NOROTATE"));a.match(/HALF/)&&(ra.addStyle("HALF"),ra.addStyle("NOROTATE"));a.match(/DIRECTION/)&&
ra.addStyle("DIRECTION");a.match(/DIRECTED/)&&ra.addStyle("DIRECTED");a.match(/POLAR/)&&Fa==(this.nGridX||1)-1&&ra.addStyle("POLAR");var gb=0,mb=0;X=0;if(a.match(/DONUT/))for(y=0;y<m.length;y++)m[y]>m[gb]&&(gb=y),m[y]<m[mb]&&(mb=y);if(a.match(/STARBURST/)){for(y=0;y<m.length;y++)m[y]=Math.max(m[y],0),X=Math.max(X,this.nMaxA[y]);a.match(/\bSIZE\b/)||ra.setNormalSizeValue(this.nNormalSizeValue||this.nMaxValue||X);ra.setMaxValue(this.nMaxValue||X)}a.match(/BOW/)&&(ra.nBow=1.3);a.match(/SBOW/)&&(ra.nBow=
1.2);a.match(/XSBOW/)&&(ra.nBow=1.1);a.match(/LBOW/)&&(ra.nBow=1.5);a.match(/XLBOW/)&&(ra.nBow=1.8);Oa.push(ra)}for(y=0;y<(this.nClipParts?Math.min(this.nClipParts,m.length):m.length);y++){var Wa=y%(this.nGridX||1);ra=Oa[Wa];var h="";Ka=y;this.sortedIndex&&(Ka=this.sortedIndex[Ka].index);var r=Ka;if(!a.match(/CENTER/)||a.match(/DONUT/)||Ka!=this.nCenter){h=this.szLabelA&&this.szLabelA[Ka]?" '"+this.szLabelA[Ka]+"'":" '"+this.szFieldsA[Ka]+"'";H=b?this.itemA[b].szColor||this.colorScheme[Ka]:this.colorScheme[Ka];
H=b?this.itemA[b].szColor||this.colorScheme[Ka%(this.nGridX||1E5)]:this.colorScheme[Ka%(this.nGridX||1E6)];if(a.match(/CLASSES/)||m.length==1)for(qb=0;qb<this.partsA.length;qb++)if(a.match(/CATEGORICAL/)&&m[Ka]==this.partsA[qb].min||!a.match(/CATEGORICAL/)&&m[Ka]<this.partsA[qb].max){H=this.colorScheme[qb];r=qb;break}var n=(a.match(/AUTOCOMPLETE/)&&!this.szUnit.match(/%/)?" % ":"")+this.szUnit;if(this.szShowParts){var E=H;H="none";for(eb in this.szShowPartsA)this.szShowPartsA[eb]==Ka&&(H=E)}if(m[Ka]>
0||m[Ka]===0&&!a.match(/ZEROISNOTVALUE/)){if(a.match(/COUNT/)&&this.itemA[b].nCountA)var F=ra.addPart(m[Ka],oa,H,0,this.formatValue(this.itemA[b].nCountA[Ka],this.nValueDecimals||(this.itemA[b].nCountA[Ka]<1?2:0),"ROUND")+n,h);else Wa==0&&(zc=0),F=ra.addPart(m[Ka]+(a.match(/STACKED/)?zc:0),oa,H,0,(this.szAggregation&&this.szAggregation.match(/sum/),this.formatValue(m[Ka],this.nValueDecimals||(m[Ka]<1?2:0),"ROUND")+n),h),zc+=m[Ka];F.nClass=r;if(a.match(/DIRECTION|DIRECTED/)){var I=this.itemA[b].ptPos,
L=this.getNodePosition(this.szThemesA[0]+"::"+this.szLabelA[Ka]);I&&L&&(F.nAngle=(450-180/Math.PI*Math.atan2(I.y-L.y,L.x-I.x))%360)}}this.colorScheme[y]=="none"&&ra.setLine(this.szLineColor||"black")}}ra.partsA.length<2&&b&&this.itemA[b].nCount==1&&(ra.nRadInner=0);for(Fa=(this.nGridX||1)-1;Fa>=0;Fa--)Oa[Fa].realize();if(a.match(/CENTER/)&&!a.match(/DONUT/)){x=Math.sqrt(Math.pow(map.Scale.normalX(d),2)/100*this.nCenterSize);H=this.colorScheme[this.nCenter];var R=map.Dom.newShape("circle",l,0,0,x*
.9,"fill:"+H+";");R&&(R.setAttributeNS(szMapNs,"class",String(this.nCenter)),R.setAttributeNS(szMapNs,"tooltip",this.szLabelA?this.szLabelA[this.nCenter]+": "+m[this.nCenter]+this.szUnit:m[this.nCenter]+this.szUnit));if(a.match(/GLOW/)&&!a.match(/ZOOM/)&&(!this.szGlowUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)&&(!this.szGlowLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower)){var Z=map.Dom.newShape("circle",l,0,0,x*6,"fill:"+H+";stroke:none;fill-opacity:0.05;pointer-events:none;");
Z&&Z.setAttributeNS(szMapNs,"class",String(Ya));var na=map.Dom.newShape("circle",l,0,0,x*2,"fill:"+H+";stroke:none;fill-opacity:0.1;pointer-events:none;");na&&na.setAttributeNS(szMapNs,"class",String(Ya))}if(a.match(/CENTERVALUE/)||a.match(/ZOOM/)||a.match(/VALUES/)&&!this.fHideValues){var fa=this.formatValue(this.nCenterValue,this.nValueDecimals||0,"ROUND")+(this.szUnit.length<=5?this.szUnit:"");e=N(H);ja=e.textColor;var la=String(Math.min(x*.8,3.3/fa.length*x)*this.nValueScale),Na=map.Dom.newText(l,
0,la*.33,"font-family:arial;font-size:"+la+"px;font-weight:bold;text-anchor:middle;fill:"+ja+";opacity:"+String(this.nOpacity?this.nOpacity:1)+";stroke:none;pointer-events:none",fa);Na&&Na.setAttributeNS(szMapNs,"class",String(this.nCenter))}}else if(a.match(/CENTERVALUE/)){fa=String(this.itemA[b].nCount||this.itemA[b].nSize);ja=this.szValueColor||this.szTextColor||"#888888";x=map.Scale.normalX(d);la=String(Math.min(x*.5,2/fa.length*x));var Ea=this.nValueSizeMin?la/map.Scale.normalX(5):1;map.Dom.newText(l,
0,la*.35,"font-family:arial;font-size:"+la+"px;text-anchor:middle;fill:none;stroke:black;stroke-width:"+la/40+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",fa);var U=map.Dom.newText(l,0,la*.35,"font-family:arial;font-size:"+la+"px;text-anchor:middle;fill:"+ja+";opacity:"+Ea+";stroke:none;pointer-events:none",fa)}!a.match(/VALUES/)||a.match(/STACKED/)||!a.match(/ZOOM/)&&this.fHideValues||(la=Math.min(d*.8,3.4/(ra.partsA[0]?ra.partsA[0].szText.length:1)*d),m.length>1||a.match(/NOINLINETEXT/)||
a.match(/ZOOM/)&&la<6?(la=a.match(/ZOOM/)||a.match(/NORMSIZE/)?map.Scale.normalX(8):map.Scale.normalX(5*(this.nValueScale||1)),this.drawDonutText(ra,la)):(fa=ra.partsA[0]?ra.partsA[0].szText:"",e=N(H),ja=this.szValueColor||this.szTextColor||e.textColor,x=map.Scale.normalX(d),la=String(Math.min(x*.8,3.4/fa.length*x)),Ea=this.nValueSizeMin?la/map.Scale.normalX(5):1,a.match(/VOLUME/)&&(oa=ra.donutPartsA[0].nHeight),a.match(/3D/)||(oa=x*.6),U=map.Dom.newText(l,0,-oa+x/2+la*.45,"font-family:arial;font-size:"+
la+"px;text-anchor:middle;fill:"+ja+";opacity:"+Ea+";stroke:none;pointer-events:none",fa),a.match(/3D/)&&(U.fu.setPosition(0,-x/2+la*(a.match(/VOLUME/)?.5:.25)),U.fu.scale(1,.5))));this.fillOpacity&&l.setAttributeNS(null,"fill-opacity",String(this.fillOpacity));this.nOpacity&&(l.setAttributeNS(null,"fill-opacity",String(this.nOpacity)),l.setAttributeNS(null,"stroke-opacity",String(this.nOpacity)));if(a.match(/FADEDEVIATION/)){var lb=(m[0]-this.nMeanA[0])/this.nDeviationA[0];lb>10&&(Ea=3.1622776601683795/
Math.pow(lb,.5),l.setAttributeNS(null,"opacity",String(Ea)))}else a.match(/LIMITDEVIATION/)&&(lb=(m[0]-this.nMeanA[0])/this.nDeviationA[0],lb>10&&l.setAttributeNS(null,"opacity","0"));a.match(/ZOOM/)&&a.match(/STARBURST/);if(m.length==1&&a.match(/CATEGORICAL/))ra.donutPartsA[0]&&(ra.donutPartsA[0].objNode.setAttributeNS(szMapNs,"class",c.getAttributeNS(szMapNs,"class")),ra.donutPartsA[0].objNode.setAttributeNS(szMapNs,"part",String(y)),ra.donutPartsA[0].textNode&&(ra.donutPartsA[0].textNode.setAttributeNS(szMapNs,
"class",c.getAttributeNS(szMapNs,"class")),ra.donutPartsA[0].textNode.setAttributeNS(szMapNs,"part",String(y))));else for(y=0;y<ra.donutPartsA.length;y++)ra.donutPartsA[y]&&(ra.donutPartsA[y].objNode.setAttributeNS(szMapNs,"class",String(ra.partsA[y].nClass)),ra.donutPartsA[y].objNode.setAttributeNS(szMapNs,"part",String(y)),ra.donutPartsA[y].textNode&&(ra.donutPartsA[y].textNode.setAttributeNS(szMapNs,"class",String(ra.partsA[y].nClass)),ra.donutPartsA[y].textNode.setAttributeNS(szMapNs,"part",String(y))));
this.nRealizedCount++}else if(a.match(/WAFFLE/)){var cb=map.Scale.normalX(f);a.match(/GRIDSIZE/)?cb=this.nGridSize*1.05:a.match(/AUTOSIZE/)&&(T=map.Layer.nDynamicObjectScale,qa=a.match(/\bRECT\b/)?a.match(/GAP/)?2.3:2:a.match(/GAP/)?1.7:1.6,X=Math.max(this.nAllMaxValue,this.nMax),cb=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/qa/T:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/qa/T:v,cb=cb/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[b].nSize));cb*=.97;M=map.Dom.newShape("rect",
l,-(cb/2)+10,-(cb/2)+10,cb-20,cb-20,"fill:"+(this.szBoxColor||"back")+";stroke:"+(this.szBorderColor||"none")+";stroke-width:"+(this.szBorderWidth||2)+";fill-opacity:"+(this.nBoxOpacity||.05)+";opacity:1;");cb*=.9;if(a.match(/\bSORT\b/)){this.sortedIndex=[];for(y=0;y<m.length;y++)this.sortedIndex[y]={index:y,value:m[y]};this.sortedIndex.sort(this.sortIndexDown)}else this.sortedIndex=null;C=Math.max(this.nMax,Math.abs(this.nMin));var pb=this.nGridX||(a.match(/WAFFLE100/)?10:Math.max(5,Math.round(Math.sqrt(C))));
a.match(/AUTO100/)&&(pb=10);var xc=cb/(pb*1.1),qb=-cb/2,ac=cb/2,Lb=0,fc=1E5;a.match(/WAFFLE100/)&&(fc=100);for(y=0;y<m.length;y++){var Ob=this.sortedIndex?this.sortedIndex[y].index:y;m[Ob]=Math.round(m[Ob]);if(m[Ob]){var ed=Math.min(m[Ob],fc);fc-=m[Ob];for(Pa=0;Pa<ed;Pa++)M=map.Dom.newShape("rect",l,qb,ac-xc,xc,xc,"fill:"+this.colorScheme[Ob]+";stroke:null;fill-opacity:"+(this.fillOpacity||1)+";opacity:"+(this.nOpacity||1)+";"),M.setAttributeNS(szMapNs,"class",String(Ob)),M.setAttributeNS(szMapNs,
"tooltip",this.szLabelA?this.szLabelA[Ob]+": "+m[Ob]+this.szUnit:m[Ob]+this.szUnit),qb+=xc*1.1,++Lb>=pb&&(qb=-cb/2,ac-=xc*1.1,Lb=0)}}this.nRealizedCount++}else if(a.match(/BUBBLE/)||a.match(/SQUARE/)||a.match(/LABEL/)){v=map.Scale.normalX(f/2);a.match(/AUTOSIZE/)&&(T=map.Layer.nDynamicObjectScale,qa=a.match(/\bRECT\b/)?a.match(/GAP/)?2.3:2:a.match(/GAP/)?1.7:1.6,X=Math.max(this.nAllMaxValue,this.nMax),v=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/qa/T:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/
qa/T:v);X=Math.max(this.nMax,this.nMaxA[0]);this.nNormalSizeValue&&(this.nMaxSize=X=this.nNormalSizeValue);t=m[0];if(this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(this.nClipFrames==m.length?(t=Number(m[this.nActualFrame]),X=this.nNormalSizeValue||this.nMaxA[this.nActualFrame]):t=m[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+m[m.length-1]*this.nActualFrame/(this.nClipFrames-1),t===0&&!a.match(/ZEROISVALUE/))||a.match(/INVERTSIZE/)&&X-m[0]===0&&!a.match(/ZEROISVALUE/))return null;
Va=b&&this.itemA[b]&&this.szSizeField?this.itemA[b].nSize||0:t;Sa=b&&this.itemA[b]&&this.szSizeField?this.nMaxSize:X;if(Va===0&&!a.match(/NOSIZE/)||this.nMinValue&&Va<this.nMinValue)return null;x=a.match(/MENUSIZE/)?map.Scale.normalX(f/2.5):a.match(/CATEGORICAL/)&&!this.szSizeField?v/3/(this.nNormalSizeValue||1):a.match(/NOSIZE/)?v/2:a.match(/FIXSIZE/)?v/2/(this.nNormalSizeValue||1):a.match(/NORMSIZE/)?v*2/3/(a.match(/CATEGORICAL/)?1:Math.log(Sa)*Math.log(Math.abs(Va))):a.match(/SUM/)&&!b?v*2/3:v/
Math.pow(Sa,1/this.nSizePow)*Math.pow(Math.abs(Va),1/this.nSizePow);var Ab=!0,xa=null,fb=M=null,yb=U=na=Z=null,Xb=null;H=this.colorScheme[0];G=this.colorScheme[1]?this.colorScheme[1]:"none";ja=this.colorScheme[1]?this.colorScheme[1]:"white";if(this.colorScheme.length>2||a.match(/CATEGORICAL/))H=this.colorScheme[this.colorScheme.length-1],G=this.colorScheme[0];a.match(/NOLINES/)?G="none":G=="none"&&(e=N(H),G=e.lowColor);if(a.match(/CATEGORICAL/))xa=t-1,H=this.colorScheme[xa]||this.colorScheme[0],e=
N(H),ja=e.textColor,G=a.match(/NOLINES/)?"none":e.lowColor,a.match(/RANGE/)&&!a.match(/RANGES/)&&(x=map.Scale.normalX(2+5*(y+1)/this.partsA.length)),Ab=!0;else if(this.szFlag.match(/COMPOSECOLOR/))this.szFlag.match(/SUBTRACTIVE/)?this.itemA[b].szColor=ha(this.itemA[b].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):this.itemA[b].szColor=ka(this.itemA[b].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255));else if(this.colorScheme.length>2||this.partsA.length>
1||this.szRanges&&this.szRanges.length)if(Ab=!1,this.szFlag.match(/DOMINANT/)){sa=da=0;pa=-1;for(y=0;y<this.itemA[b].nValuesA.length;y++)t=this.itemA[b].nValuesA[y],Aa=100/this.nMeanA[y]*t,V=100/this.nMedianA[y]*t,ea=(t-this.nMeanA[y])/this.nDeviationA[y],da=t,this.szFlag.match(/PERCENTOFMEAN/)&&(da=Aa),this.szFlag.match(/PERCENTOFMEDIAN/)&&(da=V),this.szFlag.match(/DEVIATION/)&&(da=ea),t>this.nFilterA[y]&&da>sa&&(this.itemA[b].nClass=y,sa=da,pa=y);pa>=0&&(this.itemA[b].nDominant=pa,t=this.itemA[b].nValuesA[pa],
h=" "+this.szFieldsA[pa]+" ",this.szLabelA&&this.szLabelA[pa]&&(h=" "+this.szLabelA[pa]+" "),this.itemA[b].nValue=this.itemA[b].nValuesA[pa],this.itemA[b].szLabel=h,H=this.colorScheme[pa],e=N(H),ja=e.textColor,G=a.match(/NOLINES/)?"none":e.lowColor,xa=pa,Ab=!0)}else for(y=0;y<this.partsA.length;y++)if(t>=this.partsA[y].min&&t<this.partsA[y].max){H=this.colorScheme[y];e=N(H);ja=e.textColor;G=a.match(/NOLINES/)?"none":e.lowColor;a.match(/RANGE/)&&!a.match(/RANGES/)&&(x=map.Scale.normalX(2+5*(y+1)/this.partsA.length));
xa=y;Ab=!0;break}this.itemA[b]&&(this.itemA[b].szColor=H);ja=this.szValueColor||this.szTextColor||ja;G=this.szLineColor||G;if(Ab){P=this.nLineWidth||.1;P=a.match(/OUTLINE/)?map.Scale.normalX(Math.min(1,1/v*x)):map.Scale.normalX(P/Math.sqrt(v)*Math.sqrt(x));if(a.match(/BUBBLE/)){var Ta=null;this.szTimeField=="$item$"?Ta=(new Date(this.szFieldsA[pa].split(" ")[0])).getTime():b&&(Ta=(new Date(this.itemA[b].szTime)).getTime());if(a.match(/GLOW/)&&!a.match(/ZOOM/)&&this.fGlowInScale){if(M=map.Dom.newShape("circle",
l,0,0,x*6,"fill:"+H+";stroke:none;fill-opacity:0.05;pointer-events:none;"))M.setAttributeNS(szMapNs,"class",String(xa)),M.setAttributeNS(szMapNs,"time",Ta);if(M=map.Dom.newShape("circle",l,0,0,x*2,"fill:"+H+";stroke:none;fill-opacity:0.1;pointer-events:none;"))M.setAttributeNS(szMapNs,"class",String(xa)),M.setAttributeNS(szMapNs,"time",Ta)}else a.match(/AURA/)&&!a.match(/ZOOM/)&&this.fGlowInScale&&(M=map.Dom.newShape("circle",l,0,0,x*1.3,"fill:"+(this.szLineColor||H)+";stroke:none;fill-opacity:0.3;"))&&
(M.setAttributeNS(szMapNs,"class",String(xa)),M.setAttributeNS(szMapNs,"time",Ta));M=map.Dom.newShape("circle",l,0,0,x,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";")}else if(a.match(/SQUARE/))M=map.Dom.newShape("rect",l,-x,-x,x*2,x*2,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";");else if(a.match(/TEXTONLY/))M=map.Dom.newShape("rect",l,-x,-8,x*2.05,8,"fill:none;stroke:none;");else if(a.match(/LABEL/)){fa=this.formatValue(t,this.nValueDecimals||(t<1||X<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:
"");t===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/SIGN/))?fa="+-"+fa:t>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/SIGN/))&&(fa="+"+fa);var hc=Math.min(x*.8,3.4/fa.length*x);if(!this.fShadow&&this.fOrigShadow&&x>map.Scale.normalX(5)){if(M=map.Dom.newShape("rect",l,-x+x*.02,-hc*.83+x*.02,x*2.05,hc*1.6,"fill:#000000;stroke:none;opacity:"+.4*(this.fillOpacity?this.fillOpacity:1)))M.setAttributeNS(null,"rx",map.Scale.normalX(2*
x/v)),M.setAttributeNS(null,"ry",map.Scale.normalX(2*x/v));if(M=map.Dom.newShape("rect",l,-x+x*.03,-hc*.83+x*.03,x*2.05,hc*1.6,"fill:"+H+";stroke:none;opacity:"+.2*(this.fillOpacity?this.fillOpacity:1)))M.setAttributeNS(null,"rx",map.Scale.normalX(2*x/v)),M.setAttributeNS(null,"ry",map.Scale.normalX(2*x/v))}if(M=map.Dom.newShape("rect",l,-x,-hc*.83,x*2.05,hc*1.6,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";"))M.setAttributeNS(null,"rx",map.Scale.normalX(2*x/v)),M.setAttributeNS(null,"ry",map.Scale.normalX(2*
x/v))}if(M){a.match(/SILENT/)||(a.match(/CATEGORICAL/)&&this.szLabelA&&this.szLabelA[t-1]?M.setAttributeNS(szMapNs,"tooltip",this.szLabelA[t-1]+" "+this.szTitle):M.setAttributeNS(szMapNs,"tooltip",this.formatValue(t,2)+this.szUnit+" "+this.szTitle));U=null;if(a.match(/VALUES/)&&!this.fHideValues)if(fa=null,this.szValueField&&this.szValueField=="$title$"?fa=this.itemA[b].szTitle:this.szValueField&&this.itemA[b].szValue?(fa=this.itemA[b].szValue,isNaN(fa)||(fa=this.formatValue(ya(this.itemA[b].szValue),
this.nValueDecimals||(this.itemA[b].szValue<1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),t===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))?fa="+/-"+fa:t>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))&&(fa="+"+fa))):this.szValueField&&this.szValueField==this.szSizeField&&Va?(fa=this.formatValue(ya(Va),this.nValueDecimals||(Va<1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),Va===
0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))?fa="+/-"+fa:Va>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))&&(fa="+"+fa)):a.match(/CATEGORICAL/)&&this.szLabelA?fa=this.szLabelA[t-1]||"?":(fa=this.formatValue(t,this.nValueDecimals||(t<1||X<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),t===0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))?
fa="+/-"+fa:t>0&&(this.szFlag.match(/DIFFERENCE/)||this.szFlag.match(/RELATIVE/)||this.szFlag.match(/\bSIGN\b/))&&(fa="+"+fa)),la=String(Math.min(x*.8,3.3/fa.length*x)*this.nValueScale),a.match(/TEXTONLY/)){e=N(H);ja=e.textColor;la=x*.8*this.nValueScale;if(this.nValueSizeMin&&!a.match(/ZOOM/)&&la*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin)||this.nValueValueMin&&!a.match(/ZOOM/)&&t<this.nValueValueMin)return null;var oc=this.szTextFont||"arial";yb=map.Dom.newText(l,0,la*.33,
"font-family:"+oc+";font-size:"+la+"px;font-weight:normal;text-anchor:middle;fill:none;stroke:"+H+";stroke-width:"+la/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",fa);yb.setAttributeNS(null,"id",this.szId+":"+b+":text:bg");U=map.Dom.newText(l,0,la*.33,"font-family:"+oc+";font-size:"+la+"px;font-weight:normal;text-anchor:middle;fill:"+(this.szValueColor||this.szTextColor||"#000000")+";opacity:"+Ea+";stroke:none;",fa);U.setAttributeNS(null,"id",this.szId+":"+b+":text");M.parentNode.removeChild(M)}else if(a.match(/LABEL/)||
la>map.Scale.normalX(1))Ea=this.nValueSizeMin?la/map.Scale.normalX(5):1,U=map.Dom.newText(l,0,la*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+la+"px;font-weight:bold;text-anchor:middle;fill:"+ja+";opacity:"+Ea+";stroke:none;pointer-events:none",fa);if(a.match(/DTEXT/)&&b&&!a.match(/ZOOM/)){var Yb=Math.pow(Math.abs(x),1/3)/Math.pow(v,1/3);M.style.setProperty("fill-opacity",String(Yb),"");M.style.setProperty("stroke-opacity",String(Yb),"");U&&U.style.setProperty("fill-opacity",String(Yb),
"")}else M.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:1),""),a.match(/OUTLINE/)||this.szLineColor?M.style.setProperty("stroke-opacity","1",""):M.style.setProperty("stroke-opacity",String(this.fillOpacity&&this.fillOpacity<.5?1:.3),"")}xa!=null&&(M&&(M.setAttributeNS(szMapNs,"value",String(t)),M.setAttributeNS(szMapNs,"class",String(xa))),U&&(U.setAttributeNS(szMapNs,"value",String(t)),U.setAttributeNS(szMapNs,"class",String(xa))),yb&&(yb.setAttributeNS(szMapNs,"value",
String(t)),yb.setAttributeNS(szMapNs,"class",String(xa))));this.szTimeField&&(Ta=null,Ta=this.szTimeField=="$item$"?(new Date(this.szFieldsA[pa].split(" ")[0])).getTime():(new Date(this.itemA[b].szTime)).getTime(),M&&M.setAttributeNS(szMapNs,"time",Ta),U&&U.setAttributeNS(szMapNs,"time",Ta),yb&&yb.setAttributeNS(szMapNs,"time",Ta));f=x*2/map.Scale.normalX(1);g.x=0;g.y=a.match(/TEXTONLY/)?x:x+map.Scale.normalY(5);this.nRealizedCount++}else return this.nMissingRangeCount++,null}else if(a.match(/SYMBOL/)){if(typeof this.szSymbolBoxStyle!=
"undefined"){G="#dddddd";typeof this.szBorderColor!="undefined"&&(G=this.szBorderColor);var ic="stroke-width:0;";if(typeof this.szBorderStyle!="undefined")switch(this.szBorderStyle){case "dotted":ic="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:round;stroke-dasharray:1,50;";break;case "dashed":ic="stroke-width:"+map.Scale.normalX(1)+";stroke-linecap:butt;stroke-dasharray:30,30;";break;case "solid":ic="stroke-width:"+map.Scale.normalX(1)+";";break;case "none":ic="stroke-width:0;"}var pc=map.Dom.newShape("rect",
l,0,0,1,1,"fill:white;stroke:"+G+";"+ic);switch(this.szSymbolBoxStyle){case "frame":pc.setAttributeNS(null,"fill-opacity",0);break;case "field":pc.setAttributeNS(null,"fill-opacity",1)}}if(!this.szSymbolsA)for(this.szSymbolsA=[],y=0;y<m.length;y++)this.szSymbolsA.push("circle");else if(this.szSymbolsA.length<m.length)for(y=this.szSymbolsA.length;y<m.length;y++)this.szSymbolsA.push(this.szSymbolsA[this.szSymbolsA.length-1]);var Pb=null;a.match(/VALUES|AXIS/)&&(Pb=map.Dom.newGroup(l,this.szId+":"+b+
":textgroup"));this.initAngle=0;if(a.match(/\bSORT\b/))if(a.match(/\bBYMEAN\b/)){this.sortedIndex=[];for(y=this.sortedMax=0;y<m.length;y++)this.sortedIndex[y]={index:y,value:m[y],tvalue:m[y],mean:this.nMeanA[y]},this.sortedMax=Math.max(this.sortedMax,m[y]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(a.match(/\bBYMEDIAN\b/)){this.sortedIndex=[];for(y=this.sortedMax=0;y<m.length;y++)this.sortedIndex[y]={index:y,value:m[y],tvalue:m[y],mean:this.nMedianA[y]},this.sortedMax=Math.max(this.sortedMax,
m[y]);this.sortedIndex.sort(this.sortMeanUp);this.initAngle=0}else if(a.match(/\bUP\b/)){this.sortedIndex=[];for(y=this.sortedMax=0;y<m.length;y++)this.sortedIndex[y]={index:y,value:m[y],tvalue:m[y]},this.sortedMax=Math.max(this.sortedMax,m[y]);this.sortedIndex.sort(this.sortIndexUp);this.initAngle=0}else if(a.match(/\bDOWN\b/)){this.sortedIndex=[];for(y=this.sortedMax=0;y<m.length;y++)this.sortedIndex[y]={index:y,value:m[y],tvalue:m[y]},this.sortedMax=Math.max(this.sortedMax,m[y]);this.sortedIndex.sort(this.sortIndexDown);
this.initAngle=0}else{if(a.match(/\bRANDOM\b/)){this.sortedIndex=[];this.sortedMax=0;if(this.nClipParts&&this.nClipParts<m.length){var jc=[];for(y=0;y<m.length;y++)jc[y]={index:y,value:m[y],tvalue:m[y]};jc.sort(this.sortIndexDown);for(y=0;y<this.nClipParts;y++){var Nc=jc[y].index;this.sortedIndex[y]={index:Nc,value:m[Nc],tvalue:m[Nc]};this.sortedMax=Math.max(this.sortedMax,m[y])}}else for(y=0;y<m.length;y++)this.sortedIndex[y]={index:y,value:m[y],tvalue:m[y]},this.sortedMax=Math.max(this.sortedMax,
m[y]);b?(this.itemA[b].randomA||(this.itemA[b].randomA=this.getRandomNumberArray(m.length+1)),this.shuffleArray(this.sortedIndex,this.itemA[b].randomA),this.initAngle=Math.floor(this.itemA[b].randomA[0]*360)):this.initAngle=0}}else this.sortedIndex=null;if(a.match(/RINGS/)){if(this.sortedIndex){var yc=0;for(y=0;y<this.sortedIndex.length;y++)this.sortedIndex[y].value&&(this.sortedIndex[y].value+=yc,yc=this.sortedIndex[y].value)}else for(yc=0,this.sortedIndex=[],y=0;y<m.length;y++)this.sortedIndex[y]=
{index:y,value:m[y],tvalue:m[y]},this.sortedIndex[y].value&&(this.sortedIndex[y].value+=yc,yc=this.sortedIndex[y].value);this.sortedIndex.sort(this.sortIndexDown)}if(a.match(/\bSMOOTH\b/)&&!a.match(/\bZOOM\b/)){var Oc=m.slice();for(y=m.length-2;y>=1;y--){m[y]=Oc[y];m[y]+=Oc[y+1];for(Ic=1;Ic<2;Ic++)m[y]+=Oc[y-Ic];m[y]/=3}}if(a.match(/\bLINREG\b/)){var pd=0,fd=0;for(y=0;y<m.length;y++)pd+=y,fd+=m[y];var bc=pd/m.length,gd=fd/m.length,qd=0,qc=0;for(y=0;y<m.length;y++)qb=y,ac=m[y],qd+=(qb-bc)*(ac-gd),
qc+=(qb-bc)*(qb-bc);var ua=qd/qc,Qb=gd-ua*bc}var ub=null,jb=null,cc=null;xa=0;var Fb="",Gb=0,wb=0,Bb=0,bb=0,Xa=0,Mb=0,Pc=0,Rb=!1,Sb=0;gb=m.length;this.nClipParts&&this.nClipParts<m.length&&(a.match(/\bUP\b/)?Sb=m.length-this.nClipParts:gb=this.nClipParts);if(this.szFlag.match(/DOMINANT/)){sa=da=0;var Zb=-1;for(y=0;y<this.itemA[b].nValuesA.length;y++)t=this.itemA[b].nValuesA[y],Aa=100/this.nMeanA[y]*t,V=100/this.nMedianA[y]*t,ea=(t-(this.nMeanA[y]||0))/this.nDeviationA[y],da=t,this.szFlag.match(/PERCENTOFMEAN/)&&
(da=Aa),this.szFlag.match(/PERCENTOFMEDIAN/)&&(da=V),this.szFlag.match(/DEVIATION/)&&(da=ea),t>(this.nFilterA[y]||0)&&da>sa&&(this.itemA[b].nClass=y,sa=da,Zb=y);Zb>=0&&(Sb=this.itemA[b].nDominant=Zb,gb=Sb+1,xa=Zb)}else this.szFlag.match(/COMPOSECOLOR/)&&(this.szFlag.match(/SUBTRACTIVE/)?this.itemA[b].szColor=ha(this.itemA[b].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)):this.itemA[b].szColor=ka(this.itemA[b].nValuesA,this.colorScheme,this.nMax,Math.floor(this.nBrightness*255)));
this.szFlag.match(/\bCLIP\b/)&&(gb=Sb+1);for(y=Sb;y<gb;y++)Mb+=m[y]!==0,Xa=Math.max(Xa,m[y]);if(this.szFlag.match(/STACKED/)&&this.nGridX)for(y=Sb;y<gb;){for(var zc=0,Pa=0;Pa<this.nGridX;Pa++)zc+=m[y++];Xa=Math.max(Xa,zc)}var Tb=this.formatValue(Math.max(this.nAllMaxValue,this.nMax),this.nValueDecimals||"")+(this.szUnit.length<=5?this.szUnit:""),Ac=0;for(y=Sb;y<gb;y++){var pa=y;t=m[pa];var rb=m[pa];a.match(/COUNT/)&&this.itemA[b].nCountA&&(rb=this.itemA[b].nCountA[pa]);this.sortedIndex&&(t=this.sortedIndex[pa].value,
rb=this.sortedIndex[pa].tvalue,pa=this.sortedIndex[pa].index);this.szValueField&&this.itemA[b]&&this.szValueField=="$title$"?rb=this.itemA[b].szTitle:this.szValueField&&this.itemA[b]&&this.itemA[b].szValue&&(rb=isNaN(this.itemA[b].szValue)?this.itemA[b].szValue:ya(this.itemA[b].szValue));if(this.szShowParts){var Qc=!0;for(eb in this.szShowPartsA)this.szShowPartsA[eb]==pa%(this.nGridX||1E6)&&(Qc=!1);if(Qc)continue}if(!a.match(/ZOOM/)||!this.markedClasses||this.markedClasses[pa]){xa=pa;this.nGridX&&
a.match(/PLOT/)&&(xa%=this.nGridX);a.match(/STACKED/)&&(xa==0&&(Ac=0),Ac=rb+=Ac);if((a.match(/ZOOM/)||a.match(/NORMSIZE/))&&this.szLabelA){var Hb=this.formatValue(rb,rb<1?2:0);Fb=Hb+this.szUnit;Fb+=" "+this.szLabelA[pa%(this.nGridX||1E7)]}else Hb=this.formatValue(rb,2),Fb=" "+Hb+this.szUnit;Ta=null;this.szTimeField&&(Ta=this.szTimeField=="$item$"?(new Date(this.szFieldsA[pa].split(" ")[0])).getTime():(new Date(this.itemA[b].szTime)).getTime());if(!a.match(/CATEGORICAL/)||a.match(/AGGREGATE/)||a.match(/GROUP/)){v=
map.Scale.normalX(f/2);X=this.nNormalSizeValue||this.nAllMaxValue;a.match(/MENUSIZE/)?X=Xa*5:!this.nNormalSizeValue||a.match(/SEQUENCE/)&&this.szSizeField||(this.nMaxSize=X=this.nNormalSizeValue);Xa&&a.match(/ZOOM/)&&a.match(/SEQUENCE/)&&(X=Xa/2+Xa/2*Math.pow(X,.5)/Math.pow(Xa,.5));if(a.match(/INVERTSIZE/)&&X-t===0&&!a.match(/ZEROISVALUE/))return null;this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&(rb=t=this.nClipFrames==m.length?Number(m[this.nActualFrame]):m[pa]*(this.nClipFrames-
1-this.nActualFrame)/(this.nClipFrames-1)+m[m.length-1]*this.nActualFrame/(this.nClipFrames-1));if(t||a.match(/PLOT|NOSIZE/)){x=0;a.match(/AUTOSIZE/)&&(T=map.Layer.nDynamicObjectScale,qa=a.match(/\bRECT\b/)?a.match(/GAP/)?2.3:2:a.match(/GAP/)?1.6:1.5,X=Math.max(this.nAllMaxValue,this.nMax),v=this.nGridWidthPx?map.Scale.normalX(this.nGridWidthPx)/qa/T:this.nGridWidth?map.Scale.getDeltaXofDistanceInMeter(this.nGridWidth)/qa/T:v);x=a.match(/GRIDSIZE/)&&!a.match(/PLOT/)?this.nGridSize/2:a.match(/NOSIZE/)?
map.Scale.normalX(f/3):a.match(/FIXSIZE/)?map.Scale.normalX(f/3)/(this.nNormalSizeValue||1):v/Math.pow(X,1/this.nSizePow)*Math.pow(t,1/this.nSizePow);a.match(/SEQUENCE/)?a.match(/MENUSIZE/)||a.match(/SUM/)&&!b?x*=this.szField100?1:2:a.match(/ZOOM/)&&!a.match(/PLOT/)?x*=2:a.match(/AGGREGATE/)&&a.match(/CATEGORICAL/)||!this.szSizeField||!b||!this.itemA[b]||(x=x/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[b].nSize,1/this.nSizePow)):a.match(/MENUSIZE/)||a.match(/SUM/)&&!b?x=v*1.5:a.match(/ZOOM/)&&
!a.match(/PLOT/)?x=Math.max(x,v*2/3):a.match(/NOSIZE/)?x=v/5:(!a.match(/GRIDSIZE/)&&this.szSizeField&&b&&this.itemA[b]&&(x=v/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[b].nSize,1/this.nSizePow)),a.match(/PLOTXY/)&&(x/=5));if(isNaN(x)||!x){if(!a.match(/STAR|STACKED|PLOT/))continue;x=1}Ia=this.szSymbolsA[pa];if(this.nRangesA&&this.nRangesA.length)for(Pa=0;Pa<this.nRangesA.length;Pa++)if(t==this.nRangesA[Pa]||Number(t)==Number(this.nRangesA[Pa])){Ia=this.szSymbolsA[Pa]||this.szSymbolsA[0]||
"circle";break}Ia=this.itemA[b]?this.itemA[b].szSymbol||Ia:Ia;a.match(/SEQUENCE/)&&(Ia=this.szSymbolsA[pa]);if(b&&this.itemA[b].szColor)H=this.itemA[b].szColor,xa=this.itemA[b].nClass,this.colorClassUsedA&&(this.colorClassUsedA[xa]=!0);else if((a.match(/SEQUENCE/)||a.match(/DOMINANT/))&&this.colorScheme.length>=this.partsA.length)H=this.colorScheme[pa%(this.nGridX||1E4)],G=this.colorScheme[pa];else if(H=this.colorScheme[0],G=this.colorScheme[1]?this.colorScheme[1]:"none",this.colorScheme.length>2&&
(H=this.colorScheme[this.colorScheme.length-1],G=this.colorScheme[0]),a.match(/NOLINES/)?G="none":G=="none"&&(e=N(H),G=e.textColor),this.colorScheme.length>2||this.szRanges&&this.szRanges.length){for(Pa=0;Pa<this.partsA.length;Pa++)if(a.match(/CATEGORICAL/)&&t==this.partsA[Pa].min||!a.match(/CATEGORICAL/)&&t<this.partsA[Pa].max){H=this.colorScheme[Pa];e=N(H);G=e.textColor;a.match(/RANGE/)&&!a.match(/RANGES/)&&(x=map.Scale.normalX(2+5*(Pa+1)/this.partsA.length));xa=Pa;break}else if(this.szRanges&&
this.szRanges.length&&t<this.partsA[Pa].min){H=this.colorScheme[Pa-1];e=N(H);G=e.textColor;xa=Pa-1;break}a.match(/NOLINES/)&&(G="none")}G=G||H;this.nSymbolScale=x/map.Scale.normalX(f);if(Ia=="circle"||Ia=="square"||Ia=="roundrect"||Ia=="carot"||Ia=="diamond"||Ia=="triangle"||Ia=="hexagon"||Ia=="empty"||Ia=="label"||Ia=="cross"){G=this.szLineColor||G;P=(this.nLineWidth||1)*map.Scale.normalX(Math.min(2*x/v,.2));switch(Ia){case "empty":M=map.Dom.newShape("circle",l,0,0,x,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+
P+";");break;case "circle":!this.fShadow&&this.fOrigShadow&&(fb=map.Dom.newShape("circle",l,map.Scale.normalX(.5)+x*.02,map.Scale.normalX(.5)+x*.02,x*1.02,"fill:#000000;stroke:none;opacity:"+.6*(this.fillOpacity?this.fillOpacity:1)));na=Z=null;if(!a.match(/GLOW/)||this.sortedIndex&&y!=Sb||a.match(/ZOOM/)||this.szGlowUpper&&!(map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)||this.szGlowLower&&!(map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower))a.match(/AURA/)&&y==Sb&&!a.match(/ZOOM/)&&
(!this.szGlowUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nGlowUpper)&(!this.szGlowLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale>=this.nGlowLower)&&(Z=map.Dom.newShape("circle",l,0,0,x*1.3,"fill:"+(this.szLineColor||H)+";stroke:none;fill-opacity:0.3;"))&&(Z.setAttributeNS(szMapNs,"class",String(xa)),Z.setAttributeNS(szMapNs,"time",String(Ta)));else{if(Z=map.Dom.newShape("circle",l,0,0,x*6,"fill:"+H+";stroke:none;fill-opacity:0.05;pointer-events:none;"))Z.setAttributeNS(szMapNs,
"class",String(xa)),Z.setAttributeNS(szMapNs,"time",Ta);if(na=map.Dom.newShape("circle",l,0,0,x*2,"fill:"+H+";stroke:none;fill-opacity:0.1;pointer-events:none;"))na.setAttributeNS(szMapNs,"class",String(xa)),na.setAttributeNS(szMapNs,"time",String(Ta))}M=map.Dom.newShape("circle",l,0,0,x,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";");break;case "square":M=map.Dom.newShape("rect",l,-x,-x,x*2,x*2,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";");break;case "roundrect":M=map.Dom.newShape("rect",l,-x,-x,
x*2,x*2,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";");M.setAttributeNS(null,"rx",x*.3);break;case "cross":M=map.Dom.newShape("rect",l,-x*1.6,-x*.4,x*2*1.6,x*2*.4,"fill:"+H+";stroke:"+G+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");M=map.Dom.newShape("rect",l,-x*.4,-x*1.6,x*2*.4,x*2*1.6,"fill:"+H+";stroke:"+G+";stroke-width:"+map.Scale.nFeatureScaling*map.Scale.nObjectScaling+";");break;case "carot":case "diamond":(M=map.Dom.newShape("rect",l,-x,-x,x*2,x*2,"fill:"+H+";stroke:"+
G+";stroke-width:"+P+";"))&&M.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":M=map.Dom.newShape("path",l,"M 0,"+x+" l"+x*1.2+",-"+x*2+" -"+x*2.4+",0 "+x*1.2+","+x*2+"z","fill:"+H+";stroke:"+G+";stroke-width:"+P+";");break;case "hexagon":Kb=x/2;Cb=x*Math.sin(60/180*Math.PI);id=x;M=map.Dom.newShape("path",l,"M -"+x+",0 l "+Kb+",-"+Cb+" "+id+",0 "+Kb+","+Cb+" -"+Kb+","+Cb+" -"+id+",0 -"+Kb+",-"+Cb+" z","fill:"+H+";stroke:"+G+";stroke-width:"+P+";");break;case "label":if(fa=this.formatValue(rb,
this.nValueDecimals||(rb<1||X<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),a.match(/TEXTONLY/))ja=N(H).textColor,la=String(Math.max(Math.min(x*.8,map.Scale.normalX(500)),map.Scale.normalX(2))),this.nValueSizeMin&&!a.match(/ZOOM/)&&la*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin)?(M=map.Dom.newShape("rect",l,0,0,0,0,"fill:none;"),fb=map.Dom.newShape("rect",l,0,0,0,0,"fill:none;")):this.nValueValueMin&&!a.match(/ZOOM/)&&t<this.nValueValueMin?(M=map.Dom.newShape("rect",
l,0,0,0,0,"fill:none;"),fb=map.Dom.newShape("rect",l,0,0,0,0,"fill:none;")):(oc=this.szTextFont||"arial",fb=map.Dom.newText(l,0,0,"font-family:"+oc+";font-size:"+la+"px;font-weight:bold;text-anchor:middle;fill:none;stroke:"+H+";stroke-width:"+la/7+";stroke-opacity:0.5;pointer-events:none;stroke-linejoin:bevel;",fa),fb.setAttributeNS(null,"id",this.szId+":"+b+":text:bg"),M=map.Dom.newText(l,0,0,"font-family:"+oc+";font-size:"+la+"px;font-weight:bold;text-anchor:middle;fill:"+(this.szValueColor||this.szTextColor||
"#000000")+";opacity:"+Ea+";stroke:none;",fa),M.setAttributeNS(null,"id",this.szId+":"+b+":text"));else if(la=String(Math.max(1,Math.min(x*.8,3.4/fa.length*x))),this.nValueSizeMin&&!a.match(/ZOOM/)&&la*map.Layer.nDynamicObjectScale<map.Scale.normalX(this.nValueSizeMin))M=map.Dom.newShape("rect",l,0,0,0,0,"fill:none;");else if(this.nValueValueMin&&!a.match(/ZOOM/)&&t<this.nValueValueMin)M=map.Dom.newShape("rect",l,0,0,0,0,"fill:none;");else if(Bd=la*1.6,M=map.Dom.newShape("rect",l,-x,-la*.83,x*2.05,
la*1.6,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";"))M.setAttributeNS(null,"rx",map.Scale.normalX(2*x/v)),M.setAttributeNS(null,"ry",map.Scale.normalX(2*x/v))}M&&(a.match(/OUTLINE/)?(M.style.setProperty("stroke-width",String(map.Scale.normalX(.5))),M.style.setProperty("stroke-opacity","1"),M.style.setProperty("fill-opacity","0.7")):a.match(/RANDOM/)?(M.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),M.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:
this.nOpacity?this.nOpacity:1),""),a.match(/DOPACITY/)&&(Qa=1/(this.nDopacityPow||1),Ea=Math.pow(t,Qa)/Math.pow(this.sortedMax,Qa)*(this.nOpacity||1)*(this.nDopacityScale||1),M.style.setProperty("fill-opacity",String(Ea),""))):a.match(/\bSORT\b/)&&a.match(/DOPACITY/)?(M.style.setProperty("stroke-opacity",String(this.nOpacity?this.nOpacity:1),""),Qa=1/(this.nDopacityPow||1),Ea=Math.pow(t,Qa)/Math.pow(this.sortedMax,Qa)*(this.nOpacity||1)*(this.nDopacityScale||1),M.style.setProperty("fill-opacity",
String(Ea),"")):a.match(/DOPACITY/)&&this.szAlphaField?b&&typeof this.itemA[b].nAlpha!="undefined"&&(Qa=1/(this.nDopacityPow||1),Ea=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,Qa)*Math.pow(this.itemA[b].nAlpha,Qa),M.style.setProperty("fill-opacity",String(Ea),"")):a.match(/DOPACITY/)?(Qa=1/(this.nDopacityPow||1),Ea=Math.pow(t-this.nMin,Qa)/Math.pow(this.nMax-this.nMin,Qa)*(this.fillOpacity||1)*(this.nDopacityScale||1),M.style.setProperty("fill-opacity",String(Ea),""),a.match(/CATEGORICAL/)||
(xa=Math.min(6,Math.ceil((t-this.nMin)/(this.nMax-this.nMin)*7)),M.setAttributeNS(szMapNs,"class",String(xa)),l.setAttributeNS(szMapNs,"class",String(xa)),c.setAttributeNS(szMapNs,"class",String(xa)))):M.style.setProperty("fill-opacity",String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:1),""),this.chartGroup&&this.chartGroup.style.setProperty("opacity","1",""),M.setAttributeNS(szMapNs,"tooltip",Fb),M.setAttributeNS(szMapNs,"time",Ta))}else Ia.match(/.svg|.png|.jpeg/)?(M=map.Dom.constructNode("image",
l,{"xlink:href":Ia}),M.setAttributeNS(null,"x",String(map.Scale.normalX(-f/2))),M.setAttributeNS(null,"y",String(map.Scale.normalY(-f/2))),M.setAttributeNS(null,"width",String(map.Scale.normalX(f))),M.setAttributeNS(null,"height",String(map.Scale.normalY(f)))):M=map.Dom.constructNode("use",l,{"xlink:href":"#"+Ia+":antizoomandpan"}),map.Dom.newShape("circle",l,0,0,x*.5,"fill:white;stroke:none;opacity:0"),M.fu.scale(x/v,x/v),M.setAttributeNS(null,"style","fill:"+H+";stroke:"+G);if(M&&a.match(/VALUES/)&&
!a.match(/TEXTONLY/)&&!this.fHideValues&&(!this.nValueValueMin||t>=this.nValueValueMin))if(U=null,fa=rb,isNaN(rb)||(fa=this.formatValue(rb,this.nValueDecimals||"")+(this.szUnit.length<=5?this.szUnit:"")),e=N(H),ja=this.szValueColor||this.szTextColor||e.textColor,Cd=Math.max((rb?.length||0)+1,Tb.length),la=String(Math.min(v*1,(Ia=="hexagon"?2.7:3.2)/Cd*v)),la*=x/v*this.nValueScale,a.match(/ZOOM/)&&a.match(/LINES/)&&!a.match(/INLINETEXT/)&&(this.nGridX==null||this.nGridX<=1||a.match(/STACKED/))){ja=
"black";k=k||map.Dom.newGroup(c,this.szId+":"+b+":textchartontop");la=4+.5*m.length/(this.nGridX?this.nGridX*2:1);var hd=Math.log(m.length)/3;U=this.createTextLabel(map.SVGDocument,k,"",fa,la*hd*this.nValueScale,"","rgba(255,255,255,0)",e.lowColor,"GLOW");U.setAttributeNS(null,"opacity","0.9");k.fu.setPosition(-map.Scale.normalX(la*hd)*3,-map.Scale.normalY(8/(this.nGridX||1)))}else if(Ia=="circle"||Ia=="square"||Ia=="roundrect"||Ia=="triangle"||Ia=="hexagon"||Ia=="label"||Ia=="empty")if(a.match(/CENTERVALUES/))xa===
0&&(U=map.Dom.newText(l,0,la*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+la+"px;text-anchor:middle;fill:"+ja+";stroke:none;pointer-events:none",fa));else if((a.match(/\bCENTER\b/)||a.match(/\bTOP\b/)||a.match(/\bBOTTOM\b/))&&!a.match(/\bDOMINANT\b/)){if(t){var Ca=6;this.szChartFlag+="|VALUEBACKGROUND";u=u||map.Dom.newGroup(c,this.szId+":"+b+":chartontop");bb=bb?bb:x;var rc=-map.Scale.normalX(1),Rc=-map.Scale.normalX(Ca*1.33)*(Mb-Pc-1);U=this.createTextLabel(map.SVGDocument,u,"",fa,
Ca,"",this.colorScheme[pa%(this.nGridX||1E4)],this.szTextColor);U.fu.setPosition(rc,Rc);if(b&&(a.match(/ZOOM/)||a.match(/NORMSIZE/))&&this.szLabelA){var Hc=U.fu.getBox().width;yb=map.Dom.newText(u,0,0,this.szValuesTextBgStyle,this.szLabelA[pa]);yb.fu.setPosition(rc+Hc+map.Scale.normalX(6),Rc-map.Scale.normalX(-1));yb.fu.scale(.6,.6);U=map.Dom.newText(u,0,0,this.szValuesTextStyle+";fill:#000;fill-opacity:0.8",this.szLabelA[pa]);U.fu.setPosition(rc+Hc+map.Scale.normalX(6),Rc-map.Scale.normalX(-1));
U.fu.scale(.6,.6)}U.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6)));U=null;Pc++}}else if(this.szValueField&&a.match(/2VALUES/)){U=map.Dom.newText(l,0,-la*.2,"font-family:"+(this.szTextFont||"arial")+";font-size:"+la+"px;text-anchor:middle;fill:"+ja+";stroke:none;pointer-events:none",fa);var Vb=Math.min(la*.8,120);Hb=this.formatValue(t,this.nValueDecimals||0)+this.szUnit;Xb=map.Dom.newText(l,0,la-Vb*.2,"font-family:"+(this.szTextFont||"arial")+";font-size:"+Vb+"px;text-anchor:middle;fill:"+
ja+";stroke:none;pointer-events:none",Hb)}else U=map.Dom.newText(l,0,la*.33,"font-family:"+(this.szTextFont||"arial")+";font-size:"+la+"px;text-anchor:middle;fill:"+ja+";stroke:none;pointer-events:none",fa);else la=Math.max(x*.8,1)*this.nValueScale,u=u||map.Dom.newGroup(c,this.szId+":"+b+":chartontop"),U=this.createTextLabel(map.SVGDocument,u,"",fa,la/map.Scale.normalX(1),"","rgba(255,255,255,0.3)",e.lowColor,"GLOW"),U.fu.setPosition(map.Scale.normalX(0)+wb,map.Scale.normalY(0)+Bb);if(M&&(M.setAttributeNS(szMapNs,
"class",String(xa%(this.nGridX||1E6))),M.setAttributeNS(szMapNs,"time",Ta),U&&(U.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),U.setAttributeNS(szMapNs,"time",Ta),U.setAttributeNS(szMapNs,"tooltip",Fb)),Xb&&(Xb.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),Xb.setAttributeNS(szMapNs,"time",Ta)),fb&&(fb.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),fb.setAttributeNS(szMapNs,"time",Ta)),!a.match(/CENTER/))){var hb=null;if(a.match(/STAR/)){if(y===0&&(ub=
M,jb=U,cc=Xb,bb=x,a.match(/EXPAND/)&&a.match(/\bSORT\b/)&&a.match(/\bUP\b/)&&(bb=a.match(/LINEAR/)||a.match(/SIZEP1/)?(a.match(/EXPANDMAX/)?2:.5)*v/X*this.sortedIndex[m.length-1].value:(a.match(/EXPANDMAX/)?2:.5)*v/Math.sqrt(X)*Math.sqrt(this.sortedIndex[m.length-1].value)),a.match(/ZOOM/)&&a.match(/STAR/)&&a.match(/\bUP\b/)?bb*=2:a.match(/COMPRESS/)&&(bb*=a.match(/COMPRESSMAX/)?.25:.5)),(y>0||a.match(/\bUP\b/))&&x){var Mc=this.nClipParts&&this.nClipParts<this.partsA.length?this.nClipParts:this.partsA.length,
Wb=x,vc=bb+x,wc=90-Math.asin(Wb*Math.sqrt(Math.pow(vc,2)-Math.pow(Wb,2))/vc/Wb)/Math.PI*180,ec=bb+x;a.match(/\bUP\b/)&&(y>5&&(wc/=1+x/v*2),ec=bb*(1+Mc/5));a.match(/ZOOM/)||(ec=this.nRangeScale?ec*this.nRangeScale:a.match(/EXPANDMAX/)?ec*2:a.match(/EXPAND/)?ec*1.5:ec);this.initAngle+=wc;wb=Math.cos(this.initAngle/180*Math.PI)*ec;Bb=Math.sin(this.initAngle/180*Math.PI)*ec;this.initAngle+=wc;hb=new point(map.Scale.normalX(0)+wb,map.Scale.normalY(0)+Bb)}}else if(a.match(/RANDOM/)){var Yc=a.match(/EXPANDMAX/)?
x*2:a.match(/EXPAND/)?x*1.5:x;a.match(/ZOOM/)&&(v*=2,Yc*=2);wb=Math.cos(this.initAngle+360/this.partsA.length*y/180*Math.PI)*Math.min(v,Yc);Bb=Math.sin(this.initAngle+360/this.partsA.length*y/180*Math.PI)*Math.min(v,Yc);hb=new point(map.Scale.normalX(0)+wb,map.Scale.normalY(0)+Bb)}else a.match(/HORZ/)?(wb+=x,hb=new point(map.Scale.normalX(0)+wb,map.Scale.normalY(0)+Bb),wb+=x):a.match(/BOTTOM/)?hb=new point(map.Scale.normalX(0),-x):a.match(/TOP/)?hb=new point(-x*.3,x*.7-v):a.match(/CONE/)?hb=new point(map.Scale.normalY(y*
.33),-map.Scale.normalY(y*1)):a.match(/BASE/)&&(hb=new point(map.Scale.normalX(0),Bb-x),Bb-=x*(a.match(/VALUES/)?1.25:1));hb?(M.fu.setPosition(hb.x,hb.y),fb&&fb.fu.setPosition(hb.x,hb.y),Z&&Z.fu.setPosition(hb.x,hb.y),na&&na.fu.setPosition(hb.x,hb.y),U&&U.fu.setPosition(hb.x,hb.y),Xb&&Xb.fu.setPosition(hb.x,hb.y)):Xb&&Xb.fu.setPosition(0,0);if(a.match(/PLOT/)){t!==0||a.match(/STACKED/)||(M.parentNode.removeChild(M),fb&&fb.parentNode.removeChild(fb),U&&U.parentNode.removeChild(U));var aa=map.Scale.normalX(f)*
(a.match(/LINES/),1),Ga=y*aa;this.nGridX&&(Ga=a.match(/PLOTVAR/)?Math.floor(y%this.nGridX)*aa:Math.floor(y/this.nGridX)*aa);var db=0;X=this.nAllMaxValue||this.nMax;X=Math.max(Xa,X);X=this.nMaxValuePlot=typeof this.nMaxValue!=="undefined"?this.nMaxValue:X;db=this.nMinValuePlot=typeof this.nMinValue!=="undefined"?this.nMinValue:Math.min(this.nMin,this.nAllMinValue);this.nMaxValue=="auto"&&(X=this.nMaxValuePlot=Xa);if(this.nMaxValue=="inherit"){this.nMaxValuePlot=this.nMinValuePlot=null;for(var jd=0;jd<
this.parent.themesA.length;jd++)this.parent.themesA[jd]!=this&&this.parent.themesA[jd].nMaxValuePlot&&(X=this.parent.themesA[jd].nMaxValuePlot)}ta=map.Scale.normalX(f)/(X-db)*(this.nGridX||m.length-1)*(this.nRangeScale||1);if(!Rb){var ae=this.szId+":"+this.itemA[b].szSelectionId+":chartgrid",ab=null;if(!ab||a.match(/ZOOM/))u=u||map.Dom.newGroup(c,this.szId+":"+b+":chartontop"),ab=map.Dom.newGroup(u,ae)}if(a.match(/PLOTXY/))Rb||(Rb=!0,a.match(/BOX/)&&a.match(/\bGRID\b/)&&!ab.childNodes.length&&(map.Dom.newShape("line",
ab,0,0,this.nChartWidth+100,0,"stroke:#888888;stroke-width:"+map.Scale.normalX(.3)+";"),map.Dom.newShape("line",ab,0,0,0,-this.nChartHeight-100,"stroke:#888888;stroke-width:"+map.Scale.normalX(.3)+";"),map.Dom.newText(ab,10,80,"font-family:arial;font-size:80px;text-anchor:start;fill:#444444;stroke:none;pointer-events:none;",String(this.nMinX)),map.Dom.newText(ab,this.nChartWidth+100,80,"font-family:arial;font-size:80px;text-anchor:end;fill:#444444;stroke:none;pointer-events:none;",String(this.nMaxX)),
map.Dom.newText(ab,-10,10,"font-family:arial;font-size:80px;text-anchor:end;fill:#444444;stroke:none;pointer-events:none;",String(this.nMinY)),map.Dom.newText(ab,-10,-this.nChartHeight-100+80,"font-family:arial;font-size:80px;text-anchor:end;fill:#444444;stroke:none;pointer-events:none;",String(this.nMaxY)))),qb=50+(this.itemA[b].nX-this.nMinX)*this.nChartWidth/this.nRangeX,ac=-100-(this.itemA[b].nY-this.nMinY)*this.nChartHeight/this.nRangeY,M.fu.setPosition(qb,ac),fb&&fb.fu.setPosition(qb,ac),Z&&
Z.fu.setPosition(qb,ac),na&&na.fu.setPosition(qb,ac),U&&U.fu.setPosition(qb,ac);else if(a.match(/PLOTYX/))M.fu.setPosition((X+Math.abs(X-t))*ta,Ga),fb&&fb.fu.setPosition((X+Math.abs(X-t))*ta,Ga),U&&U.fu.setPosition((X+Math.abs(X-t))*ta,Ga);else if(a.match(/PLOTY/)){M.fu.setPosition(0,(-X+Math.abs(X-t))*ta);fb&&fb.fu.setPosition(0,(-X+Math.abs(X-t))*ta);U&&U.fu.setPosition(0,(-X+Math.abs(X-t))*ta);var $a=1;$a=X/5;$a=Math.floor(Math.log($a))*10*Math.ceil($a/(Math.floor(Math.log($a))*10))||1;X=Math.ceil(X/
$a)*$a;if(!Rb&&(Rb=!0,a.match(/BOX/)&&a.match(/\bGRID\b/)))for(Fa=map.Scale.normalX(f)/2;Fa<X*ta;Fa+=ta*$a)map.Dom.newShape("line",ab,-20,-Fa,20,-Fa,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";")}else if(a.match(/PLOTX/)){if(M.fu.setPosition((X-Math.abs(X-t))*ta,0),fb&&fb.fu.setPosition((X-Math.abs(X-t))*ta,0),U&&U.fu.setPosition((X-Math.abs(X-t))*ta,0),$a=1,$a=X/5,$a=Math.floor(Math.log($a))*10*Math.ceil($a/(Math.floor(Math.log($a))*10))||1,X=Math.ceil(X/$a)*$a,!Rb&&(Rb=!0,a.match(/BOX/)&&
a.match(/\bGRID\b/)))for(Fa=map.Scale.normalX(f);Fa<X*ta+map.Scale.normalX(f);Fa+=ta*$a)map.Dom.newShape("line",ab,Fa,-20,Fa,20,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";")}else{$a=1;$a=Math.ceil(X-db)/5;$a<.5&&($a=Math.ceil(X-db)/10);if($a>1){var Od=Math.pow(10,Math.floor(Math.log10($a)));$a=Math.ceil($a/Od)*Od||1}X=Math.ceil(X/$a)*$a;for(db=Math.floor(db/$a)*$a;(X-db)/$a<5;)$a/=2;(X-db)/$a>5&&($a*=2);if(!Rb){Rb=!0;this.plot_last_last_position=[];this.plot_last_position=[];this.plot_last_value=
[];this.plot_last_stacked_value=[];this.plot_last_shape=[];this.plot_last_mean=[];this.plot_last_areaValue=[];this.plot_area_points=[];this.plot_area_shapes=[];this.plot_area_shapes[0]=map.Dom.newShape("path",l,"M0,0","fill:"+H+";fill-opacity:"+(this.fillOpacity||1)+";stroke:none");var sc=m.length/(this.nGridX||1),kc=map.Scale.normalX(Math.max(m.length/(this.nGridX||1),3));kc*=(a.match(/ZOOM/),1);var lc=map.Dom.newGroup(l,"");lc.parentNode.insertBefore(lc,l.firstChild);if(a.match(/BOX/)&&a.match(/\bGRID\b/)&&
(a.match(/ZOOM/)||!(this.nBoxUpper&&map.Scale.nTrueMapScale*map.Scale.nZoomScale>this.nBoxUpper||this.nBoxLower&&map.Scale.nTrueMapScale*map.Scale.nZoomScale<this.nBoxLower))){if(!a.match(/ZOOM/)){var Zc=-aa/(a.match(/LINES/)?3:1),mc=aa*(this.nGridX?m.length/this.nGridX-1:m.length-1);map.Dom.newShape("rect",l,0,-(X-db)*ta,mc,(X-db)*ta,"fill:#ffffff;fill-opacity:0;stroke:none;pointer-events:none")}var Pd=.8,be=0;for(Fa=0;Fa<=(X-db)*ta;Fa+=ta*$a){var rd=this.formatValue(Math.round(a.match(/INVERT/)?
X-Fa/ta+db:(Fa/ta+db)*100)/100,2);X>5&&(rd=String(Math.round(a.match(/INVERT/)?X-Fa/ta+db:Fa/ta+db)));var dc=Fa;a.match(/LOG/)&&(dc=100*Math.pow(10,be++),dc>X&&(Fa=X*ta),rd=this.formatValue(dc,0),dc=Math.log10(dc)*X/Math.ceil(Math.log10(X))*ta);Zc=-aa/(a.match(/LINES/)?5:1);mc=aa*(this.nGridX?m.length/this.nGridX-1:m.length-1);a.match(/PLOTVAR/)&&m.length/this.nGridX>1&&(mc=aa*this.nGridX);if(a.match(/GRADIENT/)&&Fa!==0){var Qd=mc+(a.match(/LINES/),0);va=map.Dom.newShape("path",l,"M0,"+-Fa+" L "+
Qd+","+-Fa+" "+Qd+","+(-Fa+ta*$a)+" 0,"+(-Fa+ta*$a)+" z","fill:#d8d8dd;fill-opacity:"+Pd+";stroke:none;");Pd-=.3}dc===-db*ta?map.Dom.newShape("line",ab,Zc,-dc,mc,-dc,"stroke:#444444;stroke-opacity:1;stroke-width:"+map.Scale.normalX(.05*sc)+";"):map.Dom.newShape("line",ab,Zc,-dc,mc,-dc,"stroke:#888888;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.05*sc)+";stroke-dasharray:"+6*sc+" "+3*sc+";");a.match(/RIGHT/)?map.Dom.newText(ab,mc+map.Scale.normalX(15),-dc+kc*.3,"font-family:arial;font-size:"+
kc+"px;text-anchor:start;fill:"+(a.match(/\bCOLOR\b/)?H:"#888888")+";stroke:none;pointer-events:none;",rd):map.Dom.newText(ab,Zc*1.1,-dc+kc*.3,"font-family:arial;font-size:"+kc+"px;text-anchor:end;fill:"+(a.match(/\bCOLOR\b/)?H:"#888888")+";stroke:none;pointer-events:none;",rd);this.nPlotHeight=Fa}a.match(/ZOOM/)&&(this.nLowValue&&(map.Dom.newShape("line",ab,Zc,-(this.nLowValue-db)*ta,mc,-(this.nLowValue-db)*ta,"stroke:#dd0000;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.1*sc)+";stroke-dasharray:"+
6*sc+" "+3*sc+";"),a.match(/ZOOM/)&&map.Dom.newText(ab,mc*1.06,-(this.nLowValue-db)*ta+kc*.3,"font-family:arial;font-size:"+kc+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",this.nLowValue)),this.nHighValue&&(map.Dom.newShape("line",ab,Zc,-(this.nHighValue-db)*ta,mc,-(this.nHighValue-db)*ta,"stroke:#dd0000;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.1*sc)+";stroke-dasharray:"+6*sc+" "+3*sc+";"),a.match(/ZOOM/)&&map.Dom.newText(ab,mc*1.06,-(this.nHighValue-db)*ta+kc*.3,
"font-family:arial;font-size:"+kc+"px;text-anchor:end;fill:#888888;stroke:none;pointer-events:none;",this.nHighValue)));map.Dom.newShape("line",ab,Ga,0,Ga,-(X-db)*ta,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(.1)+";");if(this.szXaxisA&&this.szXaxisA.length)for(Fa=0;Fa<this.szXaxisA.length;Fa++)if(this.szXaxisA[Fa].length&&this.szXaxisA[Fa]!=" "||Fa==0||Fa==this.szXaxisA.length-1)map.Dom.newShape("line",ab,aa*Fa,100,aa*Fa,-(X-db)*ta,"stroke:#888888;stroke-opacity:0.4;stroke-width:"+map.Scale.normalX(.05*
this.szXaxisA.length)+";stroke-dasharray:"+6*this.szXaxisA.length+" "+3*this.szXaxisA.length+";"),map.Dom.newText(ab,aa*Fa,kc*1.5,"font-family:arial;font-size:"+kc+"px;text-anchor:middle;fill:#888888;stroke:none;pointer-events:none;",this.szXaxisA[Fa])}a.match(/NOCLIP/)||map.Dom.setClipRect(l,{x:-100,y:-(X-db)*ta,width:100+gb/(this.nGridX||1)*aa,height:100+(X-db)*ta})}var tc=this.nGridX?Math.floor(y/this.nGridX)+1:1,La=this.nGridX?y%this.nGridX:1;a.match(/LOG/)&&t&&(t=Math.log10(t)*X/Math.ceil(Math.log10(X)));
var vb=a.match(/INVERT/)?X-t:t;vb-=db;vb+=a.match(/STACKED/)?this.plot_last_stacked_value[tc]||0:0;M.fu.setPosition(Ga,-vb*ta);fb&&fb.fu.setPosition(Ga,-vb*ta);if(U&&U.parentNode){if(this.nXLen>10){var Rd=Math.floor(y/(this.nGridX||1));Rd!=0&&Rd!=this.nXLen-1&&U.parentNode.removeChild(U)}U&&U.parentNode&&(a.match(/\bINLINETEXT\b/)?U.fu.setPosition(Ga,-vb*ta):a.match(/\bSTACKED\b/)?U.parentNode.removeChild(U):a.match(/LINES/)&&(this.nGridX==null||this.nGridX<=1)?(U.fu.setPosition(Ga-map.Scale.normalX(f*
this.nGridX||1),-vb*ta),U.fu.scale(2.5,2.5)):(U.fu.scale(1.5*this.nValueScale,1.5*this.nValueScale),U.fu.setPosition(Ga-map.Scale.normalX(f/7),-vb*ta)))}if(a.match(/LINES/)){var va=null;if(a.match(/ZEROISVALUE/)&&!a.match(/ZEROISNOTVALUE/)&&this.plot_last_position[La]&&(t||this.plot_last_position[La].y)||t&&this.plot_last_position[La]&&this.plot_last_position[La].y)if(a.match(/AREA/)){if(va=map.Dom.newShape("path",lc,"M"+(this.plot_last_position[La].x-2)+","+this.plot_last_position[La].y+"L"+Ga+","+
-vb*ta+" "+Ga+","+(-vb+t)*ta+" "+(this.plot_last_position[La].x-2)+","+((this.plot_last_last_position[La-1]?this.plot_last_last_position[La-1].y:0)+db*ta)+" z","fill:"+H+";fill-opacity:"+(this.fillOpacity||1)+";")){va.setAttributeNS(szMapNs,"value",String(t));va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6)));var Dd=this.nXLen<25?this.formatValue(this.plot_last_areaValue[La],this.nValueDecimals||2)+" ... "+this.formatValue(t,this.nValueDecimals||2):this.formatValue(t,this.nValueDecimals||
2);va.setAttributeNS(szMapNs,"tooltip",Dd+this.szUnit+" "+(this.szLabelA?this.szLabelA[pa%(this.nGridX||1E6)]:""));va.setAttributeNS(szMapNs,"time",String(Ta));if(this.szFlag.match(/\bFADE\b/)){var Sd="Gradient"+Math.random(),Td=map.Dom.constructNode("linearGradient",l,{id:Sd,gradientTransform:"rotate(90)"});map.Dom.constructNode("stop",Td,{offset:"0","stop-color":H,"stop-opacity":"1"});map.Dom.constructNode("stop",Td,{offset:"1","stop-color":H,"stop-opacity":"0.1"});va.style.setProperty("fill","url(#"+
Sd+")")}}var ce=y==1||y==gb-1||tc==2||tc==gb/(this.nGridX||1)?"but":"round";if(va=map.Dom.newShape("line",lc,this.plot_last_position[La].x,this.plot_last_position[La].y,Ga,-vb*ta,"stroke:"+H+";stroke-width:"+map.Scale.normalX(a.match(/STACKED/)?1:this.nLineWidth||3)+";stroke-linecap:"+ce+";"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"tooltip",this.formatValue(t,this.nValueDecimals||2)+this.szUnit+" "+(this.szLabelA?this.szLabelA[xa%(this.nGridX||1E6)]:""))}else{va=map.Dom.newShape("line",
lc,this.plot_last_position[La].x,this.plot_last_position[La].y,Ga,-vb*ta,"stroke:"+(this.szLineColor||H)+";stroke-width:"+map.Scale.normalX(this.nLineWidth||3)+";stroke-linecap:round;");Dd=this.nXLen<25?this.formatValue(this.plot_last_areaValue[La],this.nValueDecimals||2)+" ... "+this.formatValue(t,this.nValueDecimals||2):this.formatValue(t,this.nValueDecimals||2);va&&(va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,
"tooltip",Dd+this.szUnit+" "+(this.szLabelA?this.szLabelA[xa%(this.nGridX||1E6)]:"")),va.setAttributeNS(szMapNs,"time",String(Ta)));try{l.insertBefore(va,this.plot_last_shape[La])}catch(Nd){}}a.match(/LOLLIPOP/)&&t&&(va=map.Dom.newShape("line",lc,Ga,db*ta,Ga,-vb*ta,"stroke:"+H+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:butt;"))&&(va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta)));a.match(/LASTPOP/)&&
t&&y>=gb-(this.nGridX||1)&&(console.log("=== LASTPOP CREATION ==="),console.log("szFlag:",a),console.log("nValue:",t),console.log("i:",y),console.log("nMaxI:",gb),console.log("this.nGridX:",this.nGridX),console.log("condition (i >= nMaxI - (this.nGridX || 1)):",y>=gb-(this.nGridX||1)),console.log("this.szId:",this.szId),(va=map.Dom.newShape("circle",lc,Ga,-vb*ta,map.Scale.normalX((this.nLineWidth||5)*(this.nMarkerSize||1.5)),"fill:"+H+";stroke:"+G+";stroke-width:"+P+";"))?(console.log("LASTPOP plotShape created:",
va),va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"time",String(Ta))):console.log("LASTPOP plotShape creation FAILED"));if(va&&this.szFlag.match(/\bLASTARROW\b/)&&y>=gb-(this.nGridX||1)){var Ud="ArrowMarker"+Math.random(),de=map.Dom.newNode("defs",lc),Sc=Math.min(5,2.5+100/((this.nLineWidth||1)/this.nChartGroupScale))*(this.nMarkerSize||3),ee=map.Dom.constructNode("marker",de,{id:Ud,markerWidth:Sc,markerHeight:Sc,refX:Sc/1.7,refY:Sc/2,orient:"auto",markerUnits:"strokeWidth"});
map.Dom.constructNode("path",ee,{d:"M0,"+Sc+" L"+Sc+","+Sc/2+" L0,0 Z",style:"fill:"+H+";opacity:1;stroke:none;stroke-width:0.03"});va.setAttributeNS(null,"marker-end","url(#"+Ud+")")}a.match(/\bLASTVALUE\b/)&&!a.match(/\bZOOM\b/)&&t&&y>=gb-(this.nGridX||1)&&(console.log("=== LASTVALUE CREATION ==="),console.log("szFlag:",a),console.log("nValue:",t),console.log("i:",y),console.log("nMaxI:",gb),console.log("this.nGridX:",this.nGridX),console.log("condition (i >= nMaxI - (this.nGridX || 1)):",y>=gb-
(this.nGridX||1)),console.log("this.szId:",this.szId),(U=this.createTextLabel(map.SVGDocument,l,"",t,3/this.nScale*this.nValueScale,"","rgba(255,255,255,0)",this.szTextColor||"#444444","GLOW"))?(console.log("LASTVALUE newText created:",U),U.fu.setPosition(Ga-2E3,-vb*ta-1E3)):console.log("LASTVALUE newText creation FAILED"));if(a.match(/PLOTVAR/)){var Ib=a.match(/MEDIAN/)?this.nMedianA[pa]:this.nMeanA[pa];Ib-=db;this.plot_last_mean[La]&&((va=map.Dom.newShape("path",ab,"M"+this.plot_last_mean[La].x+
","+(this.plot_last_mean[La].y-this.nDeviationA[pa-1]*ta)+" L "+Ga+","+(-Ib-this.nDeviationA[pa])*ta+" "+Ga+","+(-Ib+this.nDeviationA[pa])*ta+" "+this.plot_last_mean[La].x+","+(this.plot_last_mean[La].y+this.nDeviationA[pa-1]*ta)+" z","fill:#d8d8dd;fill-opacity:0.2;stroke:none;"))&&va.setAttributeNS(szMapNs,"tooltip","standard deviation"),(va=map.Dom.newShape("line",l,this.plot_last_mean[La].x,this.plot_last_mean[La].y,Ga,-Ib*ta,"stroke:#888888;stroke-width:"+map.Scale.normalX(2)+";stroke-linecap:round;stroke-dasharray:10 80;"))&&
va.setAttributeNS(szMapNs,"tooltip","mean"));this.plot_last_mean[La]=new point(Ga,-Ib*ta)}this.plot_last_last_position[La]=a.match(/STACKED/)?this.plot_last_position[La]||new point(0,0):new point(0,0);this.plot_last_position[La]=vb>=0?new point(Ga,-vb*ta):new point(Ga,0);this.plot_last_shape[La]=M;this.plot_last_areaValue[La]=t;this.plot_area_points.push(new point(Ga,-vb*ta))}else if(a.match(/LOLLIPOP/)&&t){if(va=map.Dom.newShape("line",lc,Ga,db*ta,Ga,-vb*ta,"stroke:"+H+";stroke-width:"+map.Scale.normalX(3)+
";stroke-linecap:butt;"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta))}else if(a.match(/LASTPOP/)&&t){if(va=map.Dom.newShape("line",lc,Ga,0,Ga,-vb*ta,"stroke:"+H+";stroke-width:"+map.Scale.normalX(3)+";stroke-linecap:round;"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta))}else if(m.length/
this.nGridX>1)if(a.match(/PLOTVAR/)){M.style.setProperty("fill-opacity",tc==m.length/this.nGridX?"1":"0.2","");M.style.setProperty("stroke-width",tc==m.length/this.nGridX?"0":"3","");va=null;if(this.plot_last_position[La])if(a.match(/PLOTVAR/)){if(va=map.Dom.newShape("line",l,this.plot_last_position[La].x,this.plot_last_position[La].y,Ga,-vb*ta,"stroke:"+H+";stroke-width:"+map.Scale.normalX(2)+";"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||
1E6))),va.setAttributeNS(szMapNs,"time",String(Ta)),va.parentNode.insertBefore(va,va.parentNode.firstChild);if(va=map.Dom.newShape("line",l,this.plot_last_position[La].x-40,this.plot_last_position[La].y,this.plot_last_position[La].x+40,this.plot_last_position[La].y,"stroke:"+H+";stroke-width:"+map.Scale.normalX(this.nLineWidth||3)+";"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta)),va.parentNode.insertBefore(va,
va.parentNode.firstChild);if(va=map.Dom.newShape("line",l,Ga,0,Ga,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta)),va.parentNode.insertBefore(va,va.parentNode.firstChild)}else if(va=map.Dom.newShape("line",l,this.plot_last_position[La].x,this.plot_last_position[La].y,Ga,-vb*ta,"stroke:"+H+";stroke-width:"+map.Scale.normalX(this.nLineWidth||
3)+";"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta)),l.insertBefore(va,this.plot_last_shape[La]);this.plot_last_last_position[La]=this.plot_last_position[La]||new point(0,0);this.plot_last_position[La]=new point(Ga,-vb*ta);this.plot_last_shape[La]=M}else a.match(/BOX/)&&map.Dom.newShape("line",ab,Ga,0,Ga,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";");else if(a.match(/PLOTVAR/)){va=
null;Ib=a.match(/MEDIAN/)?this.nMedianA[pa]:this.nMeanA[pa];Ib-=db;if(va=map.Dom.newShape("line",ab,Ga,-(Ib-this.nDeviationA[pa])*ta,Ga,-(Ib+this.nDeviationA[pa])*ta,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta));if(va=map.Dom.newShape("line",ab,Ga-40,-Ib*ta,Ga+40,-Ib*ta,"stroke:#444444;stroke-width:"+map.Scale.normalX(2)+";"))va.setAttributeNS(szMapNs,
"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta));if(va=map.Dom.newShape("line",ab,Ga-80,-(Ib-this.nDeviationA[pa])*ta,Ga+80,-(Ib-this.nDeviationA[pa])*ta,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta));if(va=map.Dom.newShape("line",ab,Ga-80,-(Ib+this.nDeviationA[pa])*
ta,Ga+80,-(Ib+this.nDeviationA[pa])*ta,"stroke:#444444;stroke-width:"+map.Scale.normalX(1)+";"))va.setAttributeNS(szMapNs,"value",String(t)),va.setAttributeNS(szMapNs,"class",String(xa%(this.nGridX||1E6))),va.setAttributeNS(szMapNs,"time",String(Ta));map.Dom.newShape("line",ab,Ga,0,Ga,-this.nPlotHeight,"stroke:#dddddd;stroke-width:"+map.Scale.normalX(.25)+";");this.plot_last_position[La]&&(va=map.Dom.newShape("line",ab,this.plot_last_position[La].x,this.plot_last_position[La].y,Ga,-Ib*ta,"stroke:#888888;stroke-width:"+
map.Scale.normalX(1)+";"));this.plot_last_last_position[La]=this.plot_last_position[La]||new point(0,0);this.plot_last_position[La]=new point(Ga,-Ib*ta)}else a.match(/BOX/)&&map.Dom.newShape("line",ab,Ga,0,Ga,-this.nPlotHeight,"stroke:#aaaaaa;stroke-width:"+map.Scale.normalX(.25)+";");this.plot_last_value[tc]=t;this.plot_last_stacked_value[tc]=vb}Bb=0}else Ia=="label"&&(Bb-=Bd/1.95),M.fu.setPosition(map.Scale.normalX(0)+wb,map.Scale.normalY(0)+Bb),fb&&fb.fu.setPosition(map.Scale.normalX(0)+wb,map.Scale.normalY(0)+
Bb),U&&U.fu.setPosition(wb,map.Scale.normalY(0)+Bb),Bb=Ia=="label"?Bb-Bd/1.95:Bb-x}}}else{var Ia="";if(this.nRangesA&&this.nRangesA.length)for(Pa=0;Pa<this.nRangesA.length;Pa++)if(t==this.nRangesA[Pa]||Number(t)==Number(this.nRangesA[Pa])){Ia=this.szSymbolsA[Pa]||this.szSymbolsA[0]||"circle";xa=Pa;break}Ia=this.itemA[b].szSymbol||Ia;Fb=String(t);h=String(t);this.szLabelA&&this.szLabelA[xa]&&(Fb=this.szLabelA[xa],h=this.szLabelA[xa]);Ia.length||pa!==0||(Ia="empty",Fb=h="no data",xa=0);if(Ia.length){Gb++;
M=null;xa=typeof this.itemA[b].nClass!="undefined"?this.itemA[b].nClass:xa;H=typeof this.itemA[b].szColor!="undefined"?this.itemA[b].szColor:this.colorScheme[xa];if(a.match(/NOLINES/))G="none";else if(G=this.itemA[b].szColor||this.colorScheme[xa],H=="white"||H=="#ffffff")G="gray";G=this.szLineColor||G;x=map.Scale.normalX(f/2);a.match(/FIXSIZE/)?x=map.Scale.normalX(f/2)/(this.nNormalSizeValue||1):a.match(/NOSIZE/)?x=map.Scale.normalX(f/2):b&&this.itemA[b]&&this.itemA[b].nSize&&(x=x/Math.pow(this.nNormalSizeValue||
this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[b].nSize,1/this.nSizePow));if(Ia=="circle"||Ia=="square"||Ia=="roundrect"||Ia=="label"||Ia=="carot"||Ia=="diamond"||Ia=="triangle"||Ia=="hexagon"||Ia=="cross"||Ia=="empty"){v=map.Scale.normalX(f/2);P=(this.nLineWidth||1)*map.Scale.normalX(Math.min(x/v,1));switch(Ia){case "empty":M=map.Dom.newShape("circle",l,0,0,x,"fill:#888888;fill-opacity:0;stroke:#888888;stroke-width:"+P+";");break;case "circle":M=map.Dom.newShape("circle",l,0,0,x,"fill:"+H+";stroke:"+
G+";stroke-width:"+P+";");break;case "square":M=map.Dom.newShape("rect",l,-x*.8,-x*.8,x*2*.8,x*2*.8,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";");break;case "roundrect":M=map.Dom.newShape("rect",l,-x*.8,-x*.8,x*2*.8,x*2*.8,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";");M.setAttributeNS(null,"rx",x*.3);break;case "cross":var Kb=x*.4,Cb=x*.8;M=map.Dom.newShape("path",l,"M 0,-"+(Cb+Kb/2)+" l"+Kb/2+",0 0,"+Cb+" "+Cb+",0 0,"+Kb+" -"+Cb+",0 0,"+Cb+" -"+Kb+",0 0,-"+Cb+" -"+Cb+",0 0,-"+Kb+" "+Cb+",0 0,-"+
Cb+" "+Kb/2+",0 z","fill:"+H+";stroke:"+G+";stroke-width:"+P+";");break;case "diamond":case "carot":(M=map.Dom.newShape("rect",l,-x*.8,-x*.8,x*2*.8,x*2*.8,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";"))&&M.setAttributeNS(null,"transform","rotate(45)");break;case "triangle":M=map.Dom.newShape("path",l,"M 0,"+x+" l"+x*1.2+",-"+x*2+" -"+x*2.4+",0 "+x*1.2+","+x*2+"z","fill:"+H+";stroke:"+G+";stroke-width:"+P+";");break;case "hexagon":Kb=x/2;Cb=x*Math.sin(60/180*Math.PI);var id=x;M=map.Dom.newShape("path",
l,"M -"+x+",0 l "+Kb+",-"+Cb+" "+id+",0 "+Kb+","+Cb+" -"+Kb+","+Cb+" -"+id+",0 -"+Kb+",-"+Cb+" z","fill:"+H+";stroke:"+G+";stroke-width:"+P+";");break;case "label":var Bd=x*2*.4;M=map.Dom.newShape("rect",l,-x*.8,-x*.4,x*2*.8,x*2*.4,"fill:"+H+";stroke:"+G+";stroke-width:"+P+";")}if(!M)continue;if(a.match(/HORZ/)){a.match(/LEFT/)&&(pa=-pa);a.match(/VALUES/)&&(e=N(H),G=e.textColor,U=map.Dom.newText(Pb,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(x/2)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",
h),U.fu.setPosition(pa*x*2,-x-map.Scale.normalX(5)),m.length>1&&setRotate(U,-45));if(a.match(/AXIS/)&&this.szXaxisA&&(!this.fHideValues||a.match(/ZOOM/))){e=N(H);G=e.textColor;var sd=this.szXaxisA[y];U=map.Dom.newText(Pb,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(x)+"px;text-anchor:start;baseline-shift:-90%;fill:#bbbbbb;stroke:none;pointer-events:none",sd);U.fu.setPosition(pa*x*2+map.Scale.normalX(2),x+map.Scale.normalX(1));m.length>1&&setRotate(U,45)}M.setAttributeNS(szMapNs,
"tooltip",Fb);M.fu.setPosition(pa*x*2,0);a.match(/LEFT/)&&(pa=-pa)}else{if(a.match(/VALUES/)&&(!this.fHideValues||a.match(/ZOOM/))){e=N(H);ja=this.szValueColor||this.szTextColor||e.textColor;var Cd=Math.max((rb?.length||0)+1,Tb.length);a.match(/INLINETEXT/)?(fa=this.formatValue(rb,this.nValueDecimals||(rb<1||X<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),la=String(Math.min(v*1,(Ia=="hexagon"?2.7:3.2)/Cd*v)),la*=x/v*this.nValueScale,U=map.Dom.newText(l,0,la*.33,"font-family:"+(this.szTextFont||
"arial")+";font-size:"+la+"px;text-anchor:middle;fill:"+ja+";stroke:none;pointer-events:none",fa)):(e=N(H),G=e.textColor,fa=this.formatValue(rb,this.nValueDecimals||(rb<1||X<=1?1:0),"ROUND")+(this.szUnit.length<=5?this.szUnit:""),U=map.Dom.newText(Pb,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(x/2*this.nValueScale)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",fa),U.fu.setPosition(x+map.Scale.normalX(3),-pa*(x*2-map.Scale.normalY(0))))}M.setAttributeNS(szMapNs,
"tooltip",Fb);M.fu.setPosition(0,-pa*(x*2-map.Scale.normalY(0)))}a.match(/OUTLINE/)?(M.style.setProperty("stroke-width",String(map.Scale.normalX(.5))),M.style.setProperty("stroke-opacity","1"),M.style.setProperty("fill-opacity","0.7")):a.match(/DOPACITY/)&&this.szAlphaField?b&&typeof this.itemA[b].nAlpha!="undefined"&&(Qa=1/(this.nDopacityPow||1),Ea=(this.nDopacityScale||1)/Math.pow(this.nMaxAlpha,Qa)*Math.pow(this.itemA[b].nAlpha,Qa),M.style.setProperty("fill-opacity",String(Ea),"")):M.style.setProperty("fill-opacity",
String(this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:1),"")}else{Ia.match(/.svg|.png|.jpeg/)?(M=map.Dom.constructNode("image",l,{"xlink:href":Ia}),M.setAttributeNS(null,"x",String(map.Scale.normalX(-f/2))),M.setAttributeNS(null,"y",String(map.Scale.normalY(-f))),M.setAttributeNS(null,"width",String(map.Scale.normalX(f))),M.setAttributeNS(null,"height",String(map.Scale.normalY(f)))):M=map.Dom.constructNode("use",l,{"xlink:href":"#"+Ia+":antizoomandpan"});M.setAttributeNS(null,"style",
"fill:"+H+";stroke:"+G);if(this.szSizeField&&b&&this.itemA[b]){var ta=1/Math.sqrt(this.nMaxSize)*Math.sqrt(this.itemA[b].nSize);M.fu.scale(ta,ta)}M.fu.scale(x/f,x/f);M.fu.setPosition(map.Scale.normalX(0)+pa*map.Scale.normalX(20),map.Scale.normalY(0));pa>0&&(map.Dom.newText(l,map.Scale.normalX(-9)+pa*map.Scale.normalX(20),0,"font-family:"+(this.szTextFont||"arial")+";font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:none;stroke:black;stroke-width:60;pointer-events:none;opacity:0.3;","+"),
map.Dom.newText(l,map.Scale.normalX(-9)+pa*map.Scale.normalX(20),0,"font-family:"+(this.szTextFont||"arial")+";font-size:360px;text-anchor:middle;baseline-shift:-50%;fill:white;stroke:none;pointer-events:none;opacity:0.8;","+"));a.match(/VALUES/)&&(e=N(H),G=e.textColor,U=map.Dom.newText(Pb,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(x/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",h),U.fu.setPosition(x/2+map.Scale.normalX(3),x*2*-pa),
a.match(/MULTILINE/)&&this.szSizeField&&b&&this.itemA[b]&&(U=map.Dom.newText(Pb,0,0,"font-family:"+(this.szTextFont||"arial")+";font-size:"+String(x/2)+"px;text-anchor:start;baseline-shift:-45%;fill:#bbbbbb;stroke:none;pointer-events:none",String(this.itemA[b].nSize)+this.szSizeValueUnits),U.fu.setPosition(x/2+map.Scale.normalX(3),x*2*-pa+x/2)))}M.setAttributeNS(szMapNs,"value",String(t));M.setAttributeNS(szMapNs,"class",String(xa));M.setAttributeNS(szMapNs,"time",String(Ta));this.nRealizedCount++}else this.nMissingRangeCount++}}}Pb&&
Pb.parentNode&&Pb.parentNode.appendChild(Pb);ub&&ub.parentNode&&ub.parentNode.appendChild(ub);jb&&jb.parentNode&&jb.parentNode.appendChild(jb);cc&&cc.parentNode&&cc.parentNode.appendChild(cc);if(0&a.match(/AREA/)&&!this.nGridX&&this.plot_area_points&&this.plot_area_points.length){var Vd=!0,Ed=this.plot_area_points.length;for(eb=0;eb<Ed;eb++)this.plot_area_points[eb].y===0&&(Vd=!1);if(Vd||a.match(/ZEROISVALUE/)){var kd="M"+this.plot_area_points[0].x+","+this.plot_area_points[0].y+" L ";for(eb=1;eb<
Ed;eb++)kd+=this.plot_area_points[eb].x+","+this.plot_area_points[eb].y+" ";kd+=this.plot_area_points[Ed-1].x+",0 ";kd+="0,0 ";kd+="z ";this.plot_area_shapes[0].setAttributeNS(null,"d",kd)}}if(a.match(/\bLINREG\b/)){var Bc=0,Cc=m.length-1,Tc=ua*Bc+Qb,$c=ua*Cc+Qb;G=this.szLineColorA?this.szLineColorA[0]:this.chart.szColor;map.Dom.newShape("line",lc,Bc*aa,-Tc*ta,Cc*aa,-$c*ta,"stroke:"+G+";stroke-width:50;stroke-dasharray:50 50").setAttributeNS(szMapNs,"tooltip","linerar regression")}if(typeof this.szSymbolBoxStyle!=
"undefined"){var Wd=map.Dom.getBox(l);pc.setAttributeNS(null,"x",-map.Scale.normalX(15));pc.setAttributeNS(null,"y",-map.Scale.normalY(15));pc.setAttributeNS(null,"width",map.Scale.normalX(30*Gb));pc.setAttributeNS(null,"height",map.Scale.normalY(30));pc.setAttributeNS(null,"fill-opacity",1)}g.x=map.Scale.normalY(0);g.y=map.Scale.normalY(a.match(/ZOOM/)||a.match(/MENUSIZE/)?20:x/map.Scale.normalY(1)+5)}else if(a.match(/BUFFER/)){X=this.nMaxA[0];t=m[0];x=this.nBufferSize?this.nBufferSize:1E3;this.szShapeType.match(/line/)&&
(x*=this.nScale);x=map.Scale.getDeltaXofDistanceInMeter(x);H=this.colorScheme[0];if(this.szFields&&this.szFields.length&&this.nRangesA&&this.nRangesA.length&&(H=null,this.nRangesA.length==this.colorScheme.length))for(y=0;y<this.nRangesA.length;y++)if(t==this.nRangesA[y]||Number(t)==Number(this.nRangesA[y])){H=this.colorScheme[y];e=N(H);G=typeof this.szBorderColor!="undefined"?this.szBorderColor:this.fillOpacity<.8?"#888888":e.textColor;break}if(this.szShapeType.match(/dummy||point/))if(H){f=x*2/map.Scale.normalX(1);
g.x=0;g.y=x+map.Scale.normalY(5);this.szFlag.match(/OVERLAY/);M=map.Dom.newShape("circle",l,0,0,x,"");if(this.szFlag.match(/VALUE/)){var Uc="font-family:arial;font-size:"+map.Scale.normalX(30)+"px;fill:#222222;fill-opacity:1;stroke:white;stroke-opacity:0.2;stroke-dasharray:none;pointer-events:none;";U=map.Dom.newText(l,x-map.Scale.normalX(20),0,Uc,ixMap.Scale.prototype.formatDistanceString(this.nBufferSize))}this.nRealizedCount++}else return new point(0,0);if(this.szShapeType.match(/line/)){var td=
map.SVGDocument.getElementById(b),Fd=td.getAttributeNS(null,"id");if(!Fd.match(":paint")){var ld=map.SVGDocument.getElementById(Fd+":paint");ld||(ld=td.cloneNode(1E3),l.appendChild(ld),ld.setAttributeNS(null,"id",Fd+":paint"));td=ld;this.nRealizedCount++}var fe=x*2/map.Scale.normalX(1);td.setAttributeNS(null,"style","fill:none;stroke:"+H+";stroke-linejoin:round;stroke-linecap:round;stroke-width:"+map.Scale.normalX(fe)*map.Scale.nZoomScale+";stroke-opacity:"+String(this.fillOpacity?this.fillOpacity:
this.nOpacity?this.nOpacity:0));return null}}else if(a.match(/BAR/)||a.match(/BARS/)){var Ba=0,nb=0,ge=f,zb=1;oa=0;d=1;Za=this.nMax-this.nMin;Db=this.nMax100-this.nMin100;this.nNormalSizeValue&&(Za=Db=this.nMaxSize=this.nNormalSizeValue);if(a.match(/SIZE/)&&!a.match(/NORMSIZE/)&&this.szSizeField&&b&&this.itemA[b])zb=a.match(/SIZELOG/)?1/Math.max(1,Math.log(this.nMaxSize)*Math.log(this.itemA[b].nSize)):1/Math.pow(this.nMaxSize,1/this.nSizePow)*Math.pow(this.itemA[b].nSize,1/this.nSizePow);else if(a.match(/SIZE/)&&
!a.match(/NORMSIZE/)){var ud=z;a.match(/POINTER/)&&(ud/=m.length);zb=a.match(/SIZELOG/)?1/Math.max(1,Math.log(Za)*Math.log(Math.abs(ud))):1/Math.pow(Za,1/this.nSizePow)*Math.pow(Math.abs(ud),1/this.nSizePow)}zb===0&&z!==0&&(zb=30/f);f*=zb;var Q=map.Scale.normalX(f/m.length*.66);a.match(/STACKED/)&&(Q=map.Scale.normalX(f/3),this.nGridX&&!a.match(/MULTI/)&&(Q/=2));a.match(/MENUSIZE/)&&m.length==1&&(Q=map.Scale.normalX(f/2));Ca=Q<map.Scale.normalX(5)?Q*4/5:Q*5/5;Yb=1;a.match(/COLUMN/)&&(Q*=a.match(/THICK/)?
2:a.match(/THIN/)?1:1.5);a.match(/THIN/)&&(Q*=.6,Ca*=.75);a.match(/THICK/)&&(Q*=1.5,Ca*=1.5);a.match(/STACKED/)?Ca=map.Scale.normalX(5):(a.match(/ZOOM/)||a.match(/NORMSIZE/))&&m.length==1&&(Ca*=2.5);a.match(/STACKED/)&&!a.match(/ZOOM/)&&(Ca*=zb);Ca*=this.nValueScale||1;Uc="font-family:arial;font-size:"+Ca*.95+"px;fill:#606060;pointer-events:none;";Uc=map.Scale.tStyle.Values.szStyle+"font-size:"+Ca*.95+"px";a.match(/NORMSIZE/)||a.match(/MENUSIZE/)||this.szFlag.match(/NORMSIZE/)||this.szFlag.match(/MENUSIZE/)||
!this.nNormalSizeValue||this.szField100&&!a.match(/POINTER/)||(C=this.nNormalSizeValue);this.nOverrideMax&&(C=this.nOverrideMax);aa=map.Scale.normalX(ge)/C;if(a.match(/OFFSETMEAN/)||a.match(/OFFSETMEDIAN/)||a.match(/DEVIATION/))aa=map.Scale.normalX(f)/300;a.match(/SIZE/)&&a.match(/SEQUENCE/)&&b&&m.length>1&&!this.szSizeField&&!this.szField100?aa=aa*m.length/zb:a.match(/SIZE/)&&b&&m.length>1&&!a.match(/EXPAND/)&&(aa=this.szField100||a.match(/POINTER/)?aa*zb:aa/(a.match(/SIZEP4/)?zb*zb:zb));this.nRangeScale&&
(aa*=this.nRangeScale);a.match(/COMPRESSMAX/)?aa/=4:a.match(/COMPRESSMORE/)?aa/=3:a.match(/COMPRESS/)?aa/=2:a.match(/EXPANDMAX/)?aa*=4:a.match(/EXPANDMORE/)?aa*=3:a.match(/EXPAND/)&&(aa*=2);a.match(/POINTER/)&&!a.match(/NORMSIZE/)&&(aa*=1.2);var md=map.Dom.newGroup(l,"");if(a.match(/\bSORT\b/)){this.sortedIndex=[];for(y=0;y<m.length;y++)this.sortedIndex[y]={index:y,value:m[y]};this.sortedIndex.sort(a.match(/STACKED/)?this.sortIndexUp:this.sortIndexDown)}else this.sortedIndex=null;Sb=0;a.match(/\bUP\b/)&&
(Sb=m.length-1);var Ya=1;a.match(/CENTER/)&&(Ya=2);var Vc=new point(0,0),vd=null,uc=null,Dc=null,Ec=null,Nb=null,Gd=null,wd=ud=0;xa=null;var he=aa;for(y=this.nClipParts&&this.nClipParts<m.length?m.length-this.nClipParts:0;y<m.length;y++){if(this.szShowParts){Qc=!0;for(eb in this.szShowPartsA)this.szShowPartsA[eb]==y&&(Qc=!1);if(Qc)continue}aa=he;pa=Math.abs(Sb-y);this.sortedIndex&&(pa=this.sortedIndex[pa].index);t=m[pa];this.szFlag.match(/\bCLIP\b/)&&!this.szFlag.match(/MORPH/)&&this.nClipFrames&&
(t=this.nClipFrames==m.length?Number(m[this.nActualFrame]):m[0]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+m[m.length-1]*this.nActualFrame/(this.nClipFrames-1),pa=this.nActualFrame,y=m.length);var Ub=t;a.match(/INVERT/)&&(t!==0||a.match(/ZEROISVALUE/))&&(t=this.nMax-t);Hb=this.formatValue(t,this.nValueDecimals||2);a.match(/OFFSETMEAN/)||a.match(/OFFSETMEDIAN/)?(a.match(/OFFSETMEAN/)&&(t*=100/this.nMeanA[pa]),a.match(/OFFSETMEDIAN/)&&(t*=100/this.nMedianA[pa]),t-=100,Ub=t=isFinite(t)&&
!isNaN(t)?t:0,C=100,Hb=this.formatValue(t,this.nValueDecimals||2),t>0&&(Hb="+"+Hb)):a.match(/DEVIATION/)&&(t=(t-this.nMeanA[pa])/this.nDeviationA[pa],Ub=t=isFinite(t)&&!isNaN(t)?t:0,t*=100,Hb=this.formatValue(t,this.nValueDecimals||2),t>0&&(Hb="+"+Hb));var ib=this.colorScheme[pa]||this.colorScheme[pa%(this.nGridX||1E6)];xa=pa%(this.nGridX||1E6);if((a.match(/SEQUENCE|CLIP/)||m.length==1)&&this.colorScheme.length>=2)for(ib=this.colorScheme[this.partsA.length-1],Pa=0;Pa<this.partsA.length;Pa++)if(t<
this.partsA[Pa].max){ib=this.colorScheme[Pa];xa=Pa;break}a.match(/LEFT/)&&a.match(/HORZ/)&&(t=-t);t<0&&!a.match(/STACKED/)&&(nb=-t*aa,t=-t);a.match(/VOLUME/)&&a.match(/3D/)?(aa=1,t=this.szSizeField&&b?Q=map.Scale.normalX(f/3*2)*Math.pow(1/this.nMaxSize*this.itemA[b].nSize,1/3):Q=map.Scale.normalX(f/3*2)*Math.pow(1/C*t,1/3)):(a.match(/POINTER/)&&a.match(/SIZE/)&&b&&(Q=a.match(/WIDTH/)&&w&&(!(a.match(/DIFFERENCE/)||a.match(/RELATIVE/)||a.match(/FRACTION/))||a.match(/OFFSETMEAN/)||a.match(/OFFSETMEDIAN/)||
a.match(/DEVIATION/))?map.Scale.normalX(f)*Math.pow(Math.abs(1/this.nMax100*w),.5):map.Scale.normalX(f)*Math.pow(Math.abs(1/C*t),1/3),Ca=Q*.6,this.nValueSizeMin&&!a.match(/ZOOM/)&&(Ca=Ca*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?Ca:0),this.nValueValueMin&&!a.match(/ZOOM/)&&(Ca=t>this.nValueValueMin?Ca:0),a.match(/ZOOM|XAXIS/)||(Yb=Math.pow(Math.abs(t),.5)/Math.pow(this.nMax,.5),this.szFadeValuePow&&Number(this.szFadeValuePow)&&(Yb=Math.pow(Math.abs(t),Number(this.szFadeValuePow))/
Math.pow(C,Number(this.szFadeValuePow))))),a.match(/DTEXT/)&&b&&!a.match(/ZOOM/)?(Ca=map.Scale.normalX(f/3*2)*Math.pow(Math.abs(1/C*t),.5)*.75,this.nValueSizeMin&&!a.match(/ZOOM/)&&(Ca=Ca*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?Ca:0),this.nValueValueMin&&!a.match(/ZOOM/)&&(Ca=t>this.nValueValueMin?Ca:0),Yb=Math.pow(Math.abs(t),1/3)/Math.pow(C,1/3)):(this.nValueSizeMin&&!a.match(/ZOOM/)&&(Ca=Ca*map.Layer.nDynamicObjectScale>map.Scale.normalX(this.nValueSizeMin)?Ca:0),this.nValueValueMin&&
!a.match(/ZOOM/)&&(Ca=t>this.nValueValueMin?Ca:0)));t=isFinite(t)&&!isNaN(t)?t:0;if(t===0&&a.match(/NOZERO/))nb=0;else if(Ub<0&&a.match(/NONEGATIVE/))nb=0;else if(Ub>0&&a.match(/ONLYNEGATIVE/))nb=0;else{var Da=map.Dom.newGroup(md,"");this.szFlag.match(/MENUSIZE/)&&m.length==1&&!a.match(/VOLUME/)&&(Q*=.8,t=Q/aa*1.7,map.Dom.newShape("rect",Da,0,-map.Scale.normalY(f*.75),map.Scale.normalX(f*.5),map.Scale.normalY(f*.75),"fill:red;stroke:none;fill-opacity:0"));var kb=t;if(a.match(/COLUMN/))t*aa>0&&(ra=
DonutCharts.newChart(map.SVGDocument,Da,Ba+Q/2,0,Q/2,0),ra.setStyle("3D"),ra.addStyle("SILENT"),ra.addPart(100,t*aa*2-(a.match(/SPACED/)?Q/2:Q/5),ib,0,(this.szAggregation&&this.szAggregation.match(/sum/),this.formatValue(m[Ka],this.nValueDecimals||(m[Ka]<5?1:0),"ROUND")+this.szUnit),this.formatValue(m[Ka],2)+this.szUnit+h),ra.realize());else if(a.match(/3D/)){e=N(ib);if(a.match(/VOLUME/)&&uc){var Jb=(t*aa-uc)/15;nb+=Jb;H="white";H="#444444";H=Gd.borderColor;var Xd=Gd.mainColor,Hd=.3;uc<t*aa&&(Hd=
.2);map.Dom.newShape("line",Da,Dc+Nb,Ec-Jb,Ba,nb-Jb,"stroke:"+H+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",Da,Dc+Nb,Ec-uc-Jb,Ba,nb-t*aa-Jb,"stroke:"+H+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",Da,Dc+Nb+Nb/3,Ec-Nb/4-Jb,Ba+Q/3,nb-Q/4-Jb,"stroke:"+H+";stroke-width:"+map.Scale.normalX(.25)+";");map.Dom.newShape("line",Da,Dc+Nb+Nb/3,Ec-uc-Nb/4-Jb,Ba+Q/3,nb-t*aa-Q/4-Jb,"stroke:"+H+";stroke-width:"+map.Scale.normalX(.25));map.Dom.newShape("path",Da,"M"+
(Dc+Nb)+","+(Ec-Jb)+" L "+Ba+","+(nb-Jb)+" "+Ba+","+(nb-t*aa-Jb)+" "+(Dc+Nb)+","+(Ec-uc-Jb)+" z","fill:"+Xd+";stroke:"+H+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:"+Hd);uc-t*aa>-Q/4&&map.Dom.newShape("path",Da,"M"+(Dc+Nb)+","+(Ec-uc-Jb)+" L "+Ba+","+(nb-t*aa-Jb)+" "+(Ba+Q/3)+","+(nb-t*aa-Q/4-Jb)+" "+(Dc+Nb+Nb/3)+","+(Ec-uc-Nb/4-Jb)+" z","fill:"+Xd+";stroke:"+H+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:"+Hd)}uc=t*aa;Dc=Ba;Ec=nb;Nb=Q;Gd=e;if(kb=this.nFilterA[pa]){var nd="fill:#FFFFFF;stroke:gray;stroke-width:"+
map.Scale.normalX(.5)+";fill-opacity:0.1;stroke-opacity:0.1";map.Dom.newShape("path",Da,"M"+Ba+",0 l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+" 0 z",nd);map.Dom.newShape("rect",Da,Ba+Q/3,-kb*aa/Ya-Q/4,Q,kb*aa,nd);map.Dom.newShape("path",Da,"M"+Ba+",0 l 0,"+-kb*aa/Ya+" "+Q/3+","+-Q/4+" 0,"+kb*aa+" z",nd);map.Dom.newShape("rect",Da,Ba,-kb*aa/Ya,Q,kb*aa,nd);map.Dom.newShape("path",Da,"M"+(Ba+Q)+",0 l 0,"+-kb*aa/Ya+" "+Q/3+","+-Q/4+" 0,"+kb*aa+" z",nd);e.highColor=ColorScheme.getDerivateColor(ib,.9)}nb<=0||a.match(/LEFT/)||
a.match(/VOLUME/)?(t&&(t===0&&(e=N("none")),map.Dom.newShape("rect",Da,Ba,-t*aa/Ya,Q,t*aa,"fill:"+e.mainColor+";stroke:"+e.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:0.3"),map.Dom.newShape("path",Da,"M"+(Ba+Q)+",0 l 0,"+-t*aa/Ya+" "+Q/3+","+-Q/4+" 0,"+t*aa+" z","fill:"+e.lowColor+";stroke:"+e.borderColor+";stroke-width:"+map.Scale.normalX(.05)),e.highColor=ColorScheme.getDerivateColor(ib,.9)),map.Dom.newShape("path",Da,"M"+Ba+","+-t*aa/Ya+" l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+
" 0 z","fill:"+e.highColor+";stroke:"+e.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";stroke-opacity:1")):(map.Dom.newShape("path",Da,"M"+Ba+",0 l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+" 0 z","fill:"+e.highColor+";stroke:"+e.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.2"),map.Dom.newShape("rect",Da,Ba+Q/3,-t*aa/Ya-Q/4,Q,t*aa,"fill:"+e.mainColor+";stroke:"+e.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",Da,"M"+Ba+",0 l 0,"+
-t*aa/Ya+" "+Q/3+","+-Q/4+" 0,"+t*aa+" z","fill:"+e.lowColor+";stroke:"+e.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),e.highColor=ColorScheme.getDerivateColor(ib,.9),map.Dom.newShape("rect",Da,Ba,-t*aa/Ya,Q,t*aa,"fill:"+e.mainColor+";stroke:"+e.borderColor+";stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.4"),map.Dom.newShape("path",Da,"M"+(Ba+Q)+",0 l 0,"+-t*aa/Ya+" "+Q/3+","+-Q/4+" 0,"+t*aa+" z","fill:"+e.lowColor+";stroke:"+e.borderColor+";stroke-width:"+map.Scale.normalX(.05)+
";fill-opacity:0.4"),e.highColor=ColorScheme.getDerivateColor(ib,.9));kb&&(map.Dom.newShape("rect",Da,Ba,-kb*aa/Ya,Q,kb*aa,"fill:#FFFFFF;stroke:none;stroke-width:"+map.Scale.normalX(.05)+";fill-opacity:0.25"),kb>t?map.Dom.newShape("path",Da,"M"+Ba+","+-kb*aa/Ya+" l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+" 0 z","fill:#8888FF;stroke:#444488;stroke-width:"+map.Scale.normalX(.1)+";fill-opacity:0.2"):map.Dom.newShape("path",Da,"M"+Ba+","+-kb*aa/Ya+" l "+Q+",0 "+Q/3+","+-Q/4+" "+-Q+" 0 z","fill:#8888FF;stroke:"+
e.borderColor+";stroke-width:"+map.Scale.normalX(.1)+";fill-opacity:0.1;stroke-opacity:0.4"))}else if(a.match(/Border/))map.Dom.newShape("rect",Da,Ba,-t*aa/Ya,Q,t*aa,"fill:"+ib+";stroke:none;"),Bc=Ba+2,Cc=Ba+Q-2,Tc=2-t*aa/Ya,$c=Tc+t*aa-2,e=N(ib),map.Dom.newShape("line",Da,Bc,Tc,Bc,$c,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0"),map.Dom.newShape("line",Da,Bc,Tc,Cc,Tc,"stroke:white;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:1.0"),map.Dom.newShape("line",Da,
Bc,$c,Cc,$c,"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9"),map.Dom.newShape("line",Da,Cc,Tc,Cc,$c,"stroke:black;stroke-width:"+map.Scale.normalX(.001)+";stroke-opacity:0.9");else if(a.match(/POINTER/)&&t){(a.match(/OFFSETMEAN/)||a.match(/OFFSETMEDIAN/)||a.match(/DEVIATION/))&&Math.abs(t*aa)>1E3&&(aa=(1E3+(Math.abs(t*aa)-1E3)/10+Math.abs(t*aa)%1E3)/Math.abs(t));var Fc="fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-opacity:0.5;stroke-width:"+
map.Scale.normalX(this.nLineWidth)*Math.sqrt(zb||1);if(nb<=0)if(!this.fShadow&&this.fOrigShadow&&map.Dom.newShape("path",Da,"M"+(Ba+Q/7+10)+","+(-t*aa/Ya+10)+" l "+-Q/7+",0 0,"+-Q/15+" "+Q/2+","+-Q/3+" "+Q/2+","+Q/3+" 0,"+Q/15+" "+-Q/7+",0 0,"+t*aa+" "+-Q*5/7+",0 z","fill:000000;fill-opacity:0.5;stroke:none;"),a.match(/SMALLARROW/)){var od=map.Dom.newShape("path",Da,"m "+(Ba+zb*10)+",-230.68306 49.394,-49.394 v 263.787999 c 0,8.2839998 6.716001,14.9999998 15.000001,14.9999998 8.284001,0 15.000001,-6.716 15.000001,-14.9999998 V -280.07706 l 49.394,49.394 c 2.928,2.929 6.767,4.394 10.606,4.394 3.839,0 7.678,-1.465 10.606,-4.394 5.858,-5.857 5.858,-15.355 0,-21.213 l -75,-75 c -5.857001,-5.858 -15.355001,-5.858 -21.213001,0 l -75.0000008,75 c -5.85799995,5.857 -5.85799995,15.355 0,21.213 5.8579998,5.857 15.3559998,5.857 21.2129998,0 z",
Fc);od.fu.setPosition(30+t*aa/40,0);od.fu.scale(t*aa/250,t*aa/220)}else a.match(/ARROW/)?map.Dom.newShape("path",Da,"M"+(Ba+Q/3)+","+-t*aa*.9/Ya+" l "+-Q/3+",0 0,"+-Q/15+" "+Q/2+","+-Q/1.5+" "+Q/2+","+Q/1.5+" 0,"+Q/15+" "+-Q/3+",0 0,"+t*aa*.9+" "+-Q/3+",0 z",Fc):map.Dom.newShape("path",Da,"M"+(Ba+Q/7)+","+-t*aa/Ya+" l "+-Q/7+",0 0,"+-Q/15+" "+Q/2+","+-Q/2+" "+Q/2+","+Q/2+" 0,"+Q/15+" "+-Q/7+",0 0,"+t*aa+" "+-Q*5/7+",0 z",Fc);else a.match(/NONEGATIVE/)||(a.match(/LEFT/)||(a.match(/ZOOM/)||a.match(/NORMSIZE/)?
Fc="fill:"+ib+";stroke:"+ib+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.5":this.partsA.length>2?(e=N(ib),Fc="fill:"+ib+";stroke:"+e.lowColor+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*zb||.25)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:0.8"):(e=N(ib),Fc="fill:"+ib+";stroke:"+e.highColor+";stroke-width:"+map.Scale.normalX(this.nLineWidth)*Math.sqrt(zb||1)+";fill-opacity:"+(this.nFadeNegative||.1)+";stroke-opacity:1")),a.match(/SMALLARROW/)?(od=map.Dom.newShape("path",
Da,"m 155.27191,-100.6065 -49.394,49.393999 V -315.0005 c 0,-8.284 -6.716003,-15 -15.000003,-15 -8.284,0 -15,6.716 -15,15 v 263.787999 l -49.394,-49.393999 c -2.928,-2.929 -6.767,-4.394 -10.606,-4.394 -3.839,0 -7.6779996,1.465 -10.6059996,4.394 -5.85799995,5.856999 -5.85799995,15.354999 0,21.212999 L 80.271907,-4.3935012 c 5.857,5.858 15.355,5.858 21.213003,0 l 75,-74.9999998 c 5.858,-5.857 5.858,-15.355 0,-21.212999 -5.858,-5.857 -15.356,-5.857 -21.213,0 z",Fc),od.fu.setPosition(20+t/30,t/3),od.fu.scale(t*
aa/250,t*aa/220)):a.match(/ARROW/)?map.Dom.newShape("path",Da,"M"+(Ba+Q/3)+","+-t*aa/Ya+" l "+Q/3+",0 0,"+t*aa+" "+Q/3+",0 "+-Q/2+","+Q/2+" "+-Q/2+","+-Q/2+" "+Q/3+",0 z",Fc):map.Dom.newShape("path",Da,"M"+(Ba+Q/7)+","+-t*aa/Ya+" l "+Q*5/7+",0 0,"+t*aa+" "+Q/7+",0 "+-Q/2+","+Q/4+" "+-Q/2+","+-Q/4+" "+Q/7+",0 z",Fc))}else if(a.match(/DOTTED/))if(C<1E3){nb==0&&map.Dom.newShape("rect",Da,Ba,0,Q,2,"fill:none;stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*zb||
.2)+";stroke-opacity:"+(this.nLineWidth?1:.1));var Jc=Q*.8;aa=Jc;pb=Math.min(5,Math.ceil(C/20));Jc/=pb;aa=Jc/pb;for(var Ic=0;Ic<t;Ic++)map.Dom.newShape("circle",Da,Ba+Jc/2+Ic%pb*Jc,-Jc*Math.floor(Ic/pb)-Jc/2,Jc/2.2,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*zb||.2)+";stroke-opacity:"+(this.nLineWidth?1:.1));t=Math.ceil(t/pb)*pb+(t?.5:0)}else a.match(/NOZERO/)||(t=t||1E-5),nb<=0||a.match(/LEFT/)?map.Dom.newShape("rect",
Da,Ba,-t*aa/Ya,Q,t*aa,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*zb||.2)+";stroke-opacity:"+(this.nLineWidth?1:.1)):map.Dom.newShape("rect",Da,Ba,-t*aa/Ya,Q,t*aa,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+ib+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.3"),(kb=this.nFilterA[pa])&&(nb<=0||a.match(/LEFT/)?map.Dom.newShape("rect",Da,Ba,-kb*aa/Ya,Q,kb*aa,"fill:none;stroke:black;stroke-width:"+
map.Scale.normalX(.5)+";stroke-opacity:0.1"):map.Dom.newShape("rect",Da,Ba,-kb*aa/Ya,Q,kb*aa,"fill:none;stroke:"+ib+";stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.3"));else a.match(/NOZERO/)||(t=t||1E-5),nb<=0||a.match(/LEFT/)?map.Dom.newShape("rect",Da,Ba,-t*aa/Ya,Q,t*aa,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+(this.szLineColor||"black")+";stroke-width:"+map.Scale.normalX(this.nLineWidth*.25*zb||.2)+";stroke-opacity:"+(this.nLineWidth?1:.1)):map.Dom.newShape("rect",
Da,Ba,-t*aa/Ya,Q,t*aa,"fill:"+ib+";fill-opacity:"+(this.fillOpacity||1)+";stroke:"+ib+";stroke-width:"+map.Scale.normalX(.25)+";fill-opacity:0.3"),(kb=this.nFilterA[pa])&&(nb<=0||a.match(/LEFT/)?map.Dom.newShape("rect",Da,Ba,-kb*aa/Ya,Q,kb*aa,"fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.5)+";stroke-opacity:0.1"):map.Dom.newShape("rect",Da,Ba,-kb*aa/Ya,Q,kb*aa,"fill:none;stroke:"+ib+";stroke-width:"+map.Scale.normalX(.5)+";fill-opacity:0.3"));if(!(!a.match(/VALUES/)&&!this.szXaxisA||nb>
0&&a.match(/NONEGATIVE/)||!a.match(/ZOOM/)&&this.fHideValues)){t||=0;if(a.match(/AXIS/)&&(this.szLabelA||this.szXaxisA)){tc=pa/(this.nGridX||1);sd=(this.szXaxisA?this.szXaxisA[tc]:this.szLabelA?this.szLabelA[tc]:" ")||" ";var Id=Q*.5;a.match(/\bUP\b/)&&(Id=Q*.6);a.match(/\bHORZ\b/)&&(Id=Q*.7);U=map.Dom.newText(Da,0,0,Uc+";fill:#888888;text-anchor:end;font-size:"+Id+"px"," "+sd+" ");var Ra=new point(map.Scale.normalX(.8),Q/2+Ca/5*2);this.fNegativeValues?U.setAttributeNS(null,"transform","translate("+
(Ba+Ra.y)+","+(-Ra.x+Ca*.9+10)+") rotate(270)"):a.match(/CENTER/)?U.setAttributeNS(null,"transform","translate("+(Ba+Ra.y)+","+(map.Scale.normalX(f/2)+Ca*.9)+") rotate(270)"):a.match(/HORZ/)?U.setAttributeNS(null,"transform","translate("+(Ba+Ra.y)+","+(-Ra.x+Ca*.9+5)+") rotate(270)"):(U.style.setProperty("text-anchor","end",""),m.length==1?U.setAttributeNS(null,"transform","translate("+(Ba+(a.match(/VOLUME/)?Q*1.3:Ra.y*1.5))+","+-Ra.x+") "):sd.length>1?U.setAttributeNS(null,"transform","translate("+
(Ba+Ra.y*.66)+","+(Ca*.66+10)+") rotate(315)"):U.setAttributeNS(null,"transform","translate("+(Ba+Ra.y*.1)+","+(-Ra.x+Ca)+")"))}if(a.match(/VALUES/)&&Ca>0&&!(this.nGridX&&this.partsA.length/this.nGridX>2)){fa=this.formatValue(Ub,this.nValueDecimals||(this.nMax<=1?1:0));a.match(/POINTER/)&&Ub>0&&(this.nMin<0||a.match(/OFFSETMEAN/)||a.match(/OFFSETMEDIAN/)||this.szFlag.match(/\bSIGN\b/))&&(fa="+"+fa);a.match(/VOLUME/)||(fa+=this.szUnit?" "+this.szUnit+" ":"");!a.match(/STACKED/)||Ub===0||w||this.nGridX||
(fa=fa+" ("+Math.round(Ub/z*100)+"%)");a.match(/STACKED/)&&(Ca=a.match(/ZOOM/)?map.Scale.normalX(18):map.Scale.normalX(5),Ca*=this.nValueScale||1);var xd=fa.length*Ca*4/8;U=this.createTextLabel(map.SVGDocument,Da,"",fa,Ca/map.Scale.normalX(1),null,Ub>0&&(a.match(/CTEXT/)||a.match(/VALUEBACKGROUND/))?ib:null,parseFloat(fa)<0?this.szValueColor||"red":this.szTextColor);U.style.setProperty("opacity",String(Yb),"");var Jd=yb=null;this.szXaxisA&&a.match(/CATEGORICAL/)&&!a.match(/AXIS/)&&(Jd=map.Dom.newTSpan(U,
"fill:fill:#444444;font-size:"+Ca+"px"," "+this.szXaxisA[y]));var ad=U.fu.getBox().width;Ra=new point(map.Scale.normalX(-4),Q/2+Ca*.15);var Yd=!0;if(a.match(/DOINLINETEXT/)&&!a.match(/ZOOM/)&&!a.match(/NORMSIZE/)||!a.match(/VALUE/)||a.match(/VOLUME/)&&!a.match(/ZOOM/)||!(a.match(/THIN/)||a.match(/NOINLINETEXT/)||a.match(/DTEXT/)||a.match(/SIZE/)||ad+map.Scale.normalX(1)>t*aa/Ya||a.match(/STACKED/)||a.match(/NORMSIZE/)||a.match(/ZOOM/))){e=N(ib);U.removeChild(U.firstChild);U.firstChild.style.setProperty("fill",
e.textColor,"");Jd&&Jd.style.setProperty("fill",e.textColor,"");yb&&yb.parentNode.removeChild(yb);var ie=map.Scale.normalX(0),bd=map.Scale.normalY(.5);a.match(/VOLUME/)?(ta=t*aa/(ad+map.Scale.normalX(2)),U.parentNode.removeChild(U),U=map.Dom.newText(Da,Ba+t*aa/2,Ca*ta/4-t*aa/2,"font-family:arial;font-size:"+Ca*ta+"px;text-anchor:middle;fill:"+e.textColor+";opacity:"+Ea+";stroke:none;pointer-events:none",fa)):(ta=Math.min(1,t*aa/ad),ta<.33?U.parentNode.removeChild(U):(Ub>0&&(Ra.x+=Math.max(map.Scale.normalX(1),
t*aa-(ad+map.Scale.normalX(3))*ta)),bd/=ta,U.firstChild.style.setProperty("font-size",String(Ca*ta)),U.firstChild.setAttributeNS(null,"transform","translate("+(Ba+Ra.y-bd)+","+(-Ra.x-ie)+") rotate(270)\t")));Vc.x=Math.max(0,Vc.x-t*aa)}else if(Yd=!1,a.match(/STACKED/))if(t!==0||a.match(/ZEROISVALUE/))if(this.nGridX&&m.length/this.nGridX>2)U.parentNode.removeChild(U);else{Ra.x=0;a.match(/3D/)&&(Ra.x+=Q/4,Ra.y+=Q/3);var yd=t*aa/(a.match(/SUM/),2);Vc.x=Math.max(0,Vc.x+(Ca*.75-yd));var zd=new point(Vc.x+
Ra.x+yd-Ca/3,0),Gc=map.Scale.normalX(.5)*zb,Kc=Ba+Ra.y+Q/3,Lc=Ba+Ra.y+Q*7/8,Wc=-Ra.x-yd,Xc=-zd.x-Ca/3;if(this.nGridX&&wd<this.nGridX){Ra.y-=Q*2+U.fu.getBox().width;var je=Lc;Lc=Kc-(a.match(/3D/)?Q*1.5:Q*1.4);Kc=je-(a.match(/3D/)?Q*7/4:Q*1.4);a.match(/3D/)&&(Wc+=Q/5,Xc+=Q/5,zd.x-=Q/7);Gc=-Gc}U.setAttributeNS(null,"transform","translate("+(Ba+Ra.y+Q+Gc-Ca)+","+(-zd.x-Ca*.25)+") ");var Kd=map.Dom.newGroup(Da,""),Ld=map.Dom.newGroup(Da,"");map.Dom.newShape("line",Kd,Kc,Wc,Kc+Gc,Wc,"stroke-width:"+map.Scale.normalX(.15)+
";stroke:white;opacity:0.2;");map.Dom.newShape("line",Ld,Kc,Wc,Kc+Gc,Wc,"stroke-width:"+map.Scale.normalX(.05)+";stroke:#888888;");map.Dom.newShape("line",Kd,Kc+Gc,Wc,Lc,Xc,"stroke-width:"+map.Scale.normalX(.15)+";stroke:white;opacity:0.2;stroke-linecap:round;");map.Dom.newShape("line",Ld,Kc+Gc,Wc,Lc,Xc,"stroke-width:"+map.Scale.normalX(.05)+";stroke:#888888;");map.Dom.newShape("line",Kd,Lc,Xc,Lc+Gc,Xc,"stroke-width:"+map.Scale.normalX(.15)+";stroke:white;opacity:0.2;");map.Dom.newShape("line",Ld,
Lc,Xc,Lc+Gc,Xc,"stroke-width:"+map.Scale.normalX(.05)+";stroke:#888888;");Vc.x=Math.max(0,Vc.x+(Ca*2/3-(t*aa-yd)))}else U.parentNode.removeChild(U);else{Ra.x+=Q/4;a.match(/3D/)&&(Ra.x+=Q/4,Ra.y=Q*.3+Ca/2);a.match(/POINTER/)&&Ub>0&&(Ra.x+=Q*.25);var cd=t;ad+map.Scale.normalX(1)>(kb-t)*aa/Ya&&(cd=Math.max(t,kb),kb>t&&(cd+=Q/aa*.2,map.Dom.newShape("line",Da,Ba+Q*.6,-Ra.x-t*aa/Ya+Q/3,Ba+Q*.6,-Ra.x-kb*aa/Ya-Q*.4,"stroke:white;")));a.match(/VOLUME/)&&(cd+=Q/5);if(m.length!=1||a.match(/HORZ/)||a.match(/VOLUME/))a.match(/VOLUME/)?
U.setAttributeNS(null,"transform","translate("+(Ba+Ra.y)+","+(-Ra.x-cd*aa/Ya)+")  scale(0.9,0.9)"):U.setAttributeNS(null,"transform","translate("+(Ba+Ra.y)+","+(-10-Q*.25-cd*aa/Ya)+") rotate(270) scale(0.9,0.9)");else{if(a.match(/ZOOM/)||a.match(/NORMSIZE/)){Ra.y+=a.match(/3D/)?Q*.75:Q*.5;var ke=Math.min(0,Ca*.55-t*aa),Zd=Ca;!a.match(/3D/)&&!a.match(/ZOOM/)||a.match(/SIZE/)||(Zd=0);U.setAttributeNS(null,"transform","translate("+(Ba+Zd)+","+(ke-Ca*.5)+")")}else Ra.y+=a.match(/3D/)?a.match(/VOLUME/)?
Q*.75:Q*.6:Q*.2,U.setAttributeNS(null,"transform","translate("+(Ba-Q*.8)+","+(-cd*aa/Ya-Ca*.8-(a.match(/POINTER/)&&Ub>0?Q*.5:0))+")");Ub<0&&U.style.setProperty("opacity",String(Yb*.75),"")}U.style.setProperty("fill","#404040","")}}}p!=null&&y==p&&(d=Ca*2,e=N(ib),map.Dom.newShape("path",Da,"M5,0 l 35,-45 -25,0 0,-30 -20,0 0,30 -25,0 35,45","fill:#404040;stroke:white;stroke-width:"+map.Scale.normalX(.2)).fu.setPosition(y*(Q+1.5)+Q*.5,-t*aa+(Yd?-map.Scale.normalX(3):-ad-map.Scale.normalX(12))));if(a.match(/TRENDLINE/)){bd=
Math.min(t*aa/2,map.Scale.normalY(1.5));e=N(ib);H=e.lowColor;d=Ca/5;y>0&&(Bc=(y-1)*(Q+(a.match(/SPACED/)?Q/5:1))+Q/2,Cc=y*(Q+(a.match(/SPACED/)?Q/5:1))+Q/2,H="white",H=vd>t?"#CC3333":vd<t?"#22BB22":e.lowColor,map.Dom.newShape("line",Da,Bc,-vd*aa+bd,Cc,-t*aa+bd,"stroke:#666666;stroke-width:"+map.Scale.normalX(1/m.length*1.2)+";opacity:0.8"));var $d=map.Dom.newShape("circle",Da,0,0,d,"fill:"+H+";stroke:none;opacity:0.8");$d&&$d.fu.setPosition(y*(Q+(a.match(/SPACED/)?Q/5:0))+Q/2,-t*aa+bd)}a.match(/SILENT/)||
(this.szFlag.match(/SEQUENCE/)?Da.setAttributeNS(szMapNs,"tooltip",Hb+" ("+(this.szLabelA?this.szLabelA[xa]:"")+") ["+this.szFieldsA[pa]+"]"):(h=this.szFieldsA[pa],this.szLabelA&&this.szLabelA[pa]&&(h=this.szLabelA[pa]),Hb+=this.szUnit?" ["+this.szUnit+"]":"",!z||this.nGridX||this.szField100&&this.szFlag.match(/FRACTION/),Da.setAttributeNS(szMapNs,"tooltip",Hb+" '"+h+"'")));a.match(/FADEIN/)&&(m.length==2&&y===0?Da.style.setProperty("opacity","0.6",""):a.match(/NORMSIZE/)||(Qa=a.match(/FADEINP4/)?
10:3,Da.style.setProperty("opacity",String(.1+.9*Math.pow(y+1,Qa)/Math.pow(m.length,Qa)),"")));a.match(/FADENEGATIVE/)&&Ub<0&&Da.style.setProperty("opacity","0.5","");Da.setAttributeNS(szMapNs,"class",String(xa));Da.fu.setPosition(0,nb);a.match(/STACKED/)?a.match(/CENTER/)||(nb-=t*aa):(nb=0,Ba+=Q,a.match(/VOLUME/)&&a.match(/SPACED/)?Ba+=Q/(m.length==2?2:4):a.match(/SPACED/)?Ba+=Q/5:a.match(/\bUP\b/)||(Ba+=1));wd++;a.match(/STACKED/)&&!a.match(/MULTI/)&&this.nGridX&&wd%this.nGridX===0&&(nb=0,Ba+=Q+
Q/20);vd=t}}a.match(/HOR/)&&md.setAttributeNS(null,"transform","rotate(90) translate("+-Ba+",0)");a.match(/DIAGLEFT/)&&md.setAttributeNS(null,"transform","rotate(315) translate("+-Ba+",0)");a.match(/DIAGRIGHT/)&&md.setAttributeNS(null,"transform","rotate(45) translate("+-Ba+",0)");g.y=0;g.x=0;a.match(/HOR/)?(g.y-=Q*1/2,a.match(/3D/)&&(g.y-=Q*1/3)):a.match(/STACKED/)?g.x=Q/2:a.match(/Up/)||a.match(/HOR/)?g.x=0:g.x=Q*wd/2;a.match(/MENUSIZE/)&&(g.x+=Q*(a.match(/HORZ/)?1:0),g.y+=Q*(a.match(/HORZ/)?.3:
0),g.y+=Q*(a.match(/HORZ/)&&a.match(/3D/)?1:a.match(/VOLUME/)?.3:.6));this.nRealizedCount++;var Md=map.Dom.newGroup(l,"");Md.appendChild(md);a.match(/ZOOM/)&&(ta=240/Ca/(m.length>1?2:1),Md.fu.scale(ta,ta));Md.fu.setPosition(l.fu.getPosition().x-g.x,-g.y);g.x=0;g.y=0;a.match(/HOR/)&&(g.y=Q*1/2)}if(a.match(/EXTEND/)&&map.HTMLWindow.ixmaps.htmlgui_drawChartAfter)try{tb=this.objThemesA[this.szThemesA[0]],map.HTMLWindow.ixmaps.htmlgui_drawChartAfter(map.SVGDocument,{target:l,theme:this,item:b,values:m,
maxSize:f,flag:a,mark:p,dbRecord:tb.dbRecords?tb.dbRecords[this.itemA[b].dbIndex]:null})}catch(Nd){}if(!a.match(/NORMSIZE/)){var $b=new point(g.x,g.y);a.match(/PLOT/)?(g.x=map.Scale.normalX(this.nOffsetX||0),g.y=map.Scale.normalY(-this.nOffsetY||0)):(g.x=map.Scale.normalX(this.nOffsetX||0)*(this.nSymbolScale||1),g.y=map.Scale.normalY(-this.nOffsetY||0)*(this.nSymbolScale||1));this.szAlign&&(a.match(/PLOT/)&&!a.match(/ZOOM/)?(this.szAlign.match(/center/)&&(g.x=map.Scale.normalX(f/2*m.length/(this.nGridX||
1)),this.szAlign.match(/top/)||(g.y=-map.Scale.normalX(f/2*m.length/(this.nGridX||1)))),this.szAlign.match(/right/)&&(g.x=map.Scale.normalX(f*m.length/(this.nGridX||1))),this.szAlign.match(/23right/)&&(g.x=map.Scale.normalX(f*.66*m.length/(this.nGridX||1))),this.szAlign.match(/10%right/)&&(g.x=map.Scale.normalX(f*.9*m.length/(this.nGridX||1))),this.szAlign.match(/10%left/)&&(g.x=map.Scale.normalX(f*.1*m.length/(this.nGridX||1))),this.szAlign.match(/23left/)&&(g.x=map.Scale.normalX(f*.33*m.length/
(this.nGridX||1)))):this.nGridX&&!a.match(/ZOOM/)?(this.szAlign.match(/center/)&&(g.x=map.Scale.normalX(f/2/this.partsA.length*m.length/(this.nGridX||1))),this.szAlign.match(/right/)&&(g.x=map.Scale.normalX(f/this.partsA.length*m.length/(this.nGridX||1))),this.szAlign.match(/23right/)&&(g.x=map.Scale.normalX(f/this.partsA.length*.66*m.length/(this.nGridX||1)))):(this.szAlign.match(/center/)&&(g.y=0),this.szAlign.match(/bottom/)&&(g.y=$b.y?$b.y:map.Scale.normalX(f/5)),this.szAlign.match(/above/)&&
(g.y=$b.y?$b.y:map.Scale.normalX(f/2)),this.szAlign.match(/2above/)&&(g.y+=map.Scale.normalX(f/2)),this.szAlign.match(/below/)&&(g.y=-($b.y?$b.y:map.Scale.normalX(f/2))),this.szAlign.match(/2below/)&&(g.y-=map.Scale.normalX(f/2)),this.szAlign.match(/top/)&&(g.y=-($b.y?$b.y:map.Scale.normalX(f/2))),this.szAlign.match(/left/)&&(g.x=-($b.y?$b.y:map.Scale.normalX(f/2))),this.szAlign.match(/2left/)&&(g.x-=map.Scale.normalX(f/2)),this.szAlign.match(/right/)&&(g.x=$b.y?$b.y:map.Scale.normalX(f/2)),this.szAlign.match(/2right/)&&
(g.x+=map.Scale.normalX(f/2)),this.szAlign.match(/23right/)&&(g.x=map.Scale.normalX(f/3)),this.szAlign.match(/baseline/)&&(g.y+=map.Scale.normalY(f/5))))}if(b&&this.szLabelField&&!a.match(/NORMSIZE/)&&!a.match(/ZOOM/)&&(!this.nLabelUpper||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nLabelUpper)&&(!this.nLabelLower||map.Scale.nTrueMapScale*map.Scale.nZoomScale<=this.nLabelLower)){h=(h=this.itemA[b].szLabel)?isNaN(ya(h))?h+(this.szLabelUnits||""):this.formatValue(ya(h),this.nValueDecimals||2)+
(this.szLabelUnits||""):this.itemA[b].szTitle?this.itemA[b].szTitle:this.szLabelField+"?";Ca=map.Scale.normalX(5)*(this.nTextScale||1);Uc="opacity:0.7;font-family:arial;font-size:"+Ca+"px;text-anchor:middle;fill:#000000;pointer-events:none";var le="opacity:1;fill:white;fill-opacity:0.4;stroke:#000000;stroke-width:"+map.Scale.normalX(1)+"pointer-events:none;";xd=(h.length+2)*Ca*.5;var nc=map.Dom.newGroup(l,"");nc.parentNode.append(nc);a.match(/MULTI/)?Uc+=";fill:#444444;text-anchor:start;":nc.setAttributeNS(szMapNs,
"class",String(xa));var dd=map.Dom.newShape("rect",nc,-xd/2,-Ca*.95,xd,Ca*1.2,le);dd.setAttributeNS(null,"rx",Ca*.2);dd.setAttributeNS(null,"ry",Ca*.2);U=map.Dom.newText(nc,0,0,Uc,h);Wd=U.fu.getBox();Q=Math.max(Wd.width,xd);dd.setAttributeNS(null,"x",-Q/2);dd.setAttributeNS(null,"width",Q);a.match(/MULTI/)?(nc.fu.setPosition(map.Scale.normalX(f*.8),Ca*.77),nc.fu.scale(2,2),dd.parentNode.removeChild(dd)):nc.fu.setPosition(Q/3,Ca/3+$b.y);this.itemA[b].labelGroup=nc;this.szTimeField&&(Ta=(new Date(this.itemA[b].szTime)).getTime()||
this.itemA[b].szTime,nc.setAttributeNS(szMapNs,"time",Ta));map.fCheckLabelOverlap&&new ixMap.Label.Item(nc)}if(a.match(/MENU/)){var Ad=l.fu.getBox();l.fu.setPosition(-Ad.x-Ad.width/2,-Ad.y-Ad.height/2-map.Scale.normalY(f/2)-map.Scale.normalY(2))}else a.match(/ZOOM/)||(l.fu.setPosition(l.fu.getPosition().x-g.x,l.fu.getPosition().y-g.y),ab&&ab.fu.setPosition(ab.fu.getPosition().x-g.x,ab.fu.getPosition().y-g.y));this.nRotation&&l.fu.rotateBy(this.nRotation);g.x=0;g.y=0;b&&(this.itemA[b].fDone=!0);return g};
D.prototype.getShapes=function(){var c=map.Layer.getLayerObj(this.szThemesA[0]);if(!c||!c.szFlag.match(/tiled/))for(var b in this.itemA)this.parent.themeNodesA[b]||(this.parent.themeNodesA[b]=this.getShapeA(b))};D.prototype.getItemNodes=function(c){this.parent.themeNodesA[c]&&this.parent.themeNodesA[c].length||(this.parent.themeNodesA[c]=this.getShapeA(c));return this.parent.themeNodesA[c]||[]};D.prototype.getShapeA=function(c){c=Y(c);var b=map.SVGDocument.getElementById(c.trim());if(b)return Array(b);
if(c.match(/,/))for(var f=c.split("::"),a=f[0].split(","),p=0;p<a.length;p++)if(b=map.SVGDocument.getElementById((a[p]+"::"+f[1]).trim()))return Array(b);this.nMissingLookupCount++;this.missedA[c]=c;return[]};D.prototype.getPositions=function(){for(var c in this.itemA)this.getNodePosition(this.itemA[c].szSelectionId)};D.prototype.getNodePosition=function(c){if(typeof c=="undefined")return null;if(map.Themes.themeNodesPosA[c])return map.Themes.themeNodesPosA[c];var b=this.themeNodesPosA;if(!b[c]){if(c.match(/:clone/))return null;
if(c.match(/(-?[0-9\.]+) ?, ?(-?[0-9\.]+)/)){var f=this.getMapPosition(c);if(!f)return null;b[c]=new point(f.x,f.y);return b[c]}this.parent.themeNodesA[c]||(this.parent.themeNodesA[c]=this.getShapeA(c));f=this.parent.themeNodesA[c][0];if(this.parent.themeNodesA[c].length>1)for(var a=parseFloat(f.getAttributeNS(szMapNs,"area")),p=1;p<this.parent.themeNodesA[c].length;p++){var m=this.parent.themeNodesA[c][p],w=parseFloat(m.getAttributeNS(szMapNs,"area"));w>a&&(a=w,f=m)}f&&(this.szShapeType.match(/line/)?
((a=f.getAttributeNS(szMapNs,"center"))&&a.length>2?(a=a.split(","),new box(Number(a[0].split(":")[1]),Number(a[1].split(":")[1]),0,0)):map.Dom.getBox(f),a=map.Dom.getBox(f)):(a=f.getAttributeNS(szMapNs,"center"),!a&&f.parentNode&&(a=f.parentNode.getAttributeNS(szMapNs,"center")),a&&a.length>2?(a=a.split(","),a=new box(Number(a[0].split(":")[1]),Number(a[1].split(":")[1]),0,0)):a=map.Dom.getBox(f)),p=map.Scale.getMapOffset(f),b[c]=new point(p.x+a.x+a.width/2,p.y+a.y+a.height/2),f=getMatrix(f))&&(b[c].x+=
f[4],b[c].y+=f[5])}if(b[c]&&typeof b[c].x!="undefined"&&typeof b[c].y!="undefined")return b[c];this.missedA[c]=c;return null};D.prototype.getNodeBox=function(c){if(typeof c=="undefined")return null;if(!this.parent.themeNodesBoxA[c]){if(c.match(/:clone/))return null;this.parent.themeNodesA[c]||(this.parent.themeNodesA[c]=this.getShapeA(c));var b=this.parent.themeNodesA[c][0];if(this.parent.themeNodesA[c].length>1)for(var f=parseFloat(b.getAttributeNS(szMapNs,"area")),a=1;a<this.parent.themeNodesA[c].length;a++){var p=
this.parent.themeNodesA[c][a],m=parseFloat(p.getAttributeNS(szMapNs,"area"));m>f&&(f=m,b=p)}b&&(f=map.Dom.getBox(b),b=map.Scale.getMapOffset(b),this.parent.themeNodesBoxA[c]=new box(b.x+f.x,b.y+f.y,f.width,f.height))}return this.parent.themeNodesBoxA[c]};D.prototype.getNodeArea=function(c){return(c=this.getItemNodes(c)[0])?Number(c.getAttributeNS(szMapNs,"area"))/1E6:0};var wa=/(-?[0-9\.]+) ?[, ] ?(-?[0-9\.]+)/;D.prototype.getMapPosition=function(c){if(c){var b=null;if(c&&(b=c.match(wa)))return Math.abs(parseFloat(b[1]))>
180||Math.abs(parseFloat(b[2]))>180?new point(0,0):map.Scale.getMapPositionOfLatLon(parseFloat(b[1]),parseFloat(b[2]))}return new point(0,0)};D.prototype.onClick=function(c){this.fRemove||(this.widgetNode&&this.enable(),this.fToFront=!0,executeWithMessage(()=>map.Themes.execute(),"... processing ..."),map.Themes.onclickInfo(c,this.szId))};D.prototype.showErrorInfo=function(){if(this.nMissingPositionCount!==0){var c=this.szId+":errordisplay:widget",b=map.Dictionary.getLocalText("Chart statistic");
b=new InfoContainer(map.SVGDocument,this.widgetNode,c+":movable",new point(map.Scale.normalX(0),map.Scale.normalX(0)),new point(-map.Scale.normalX(15),map.Scale.normalX(80)),"fixed",b);var f=b.workspaceNode,a=[map.Dictionary.getLocalText("total items"),map.Dictionary.getLocalText("charts drawn"),map.Dictionary.getLocalText("missing positions"),map.Dictionary.getLocalText("missing value match"),map.Dictionary.getLocalText("zero values"),String(this.nCount),String(this.nRealizedCount),String(this.nMissingPositionCount),
String(this.nMissingRangeCount),String(this.nZeroValueCount)];f=map.Dom.newGroup(f,"");f.fu.setPosition(0,map.Scale.normalY(3));createTextGrid(map.SVGDocument,f,c+":textgrid",a,2);b.reformat()}};D.prototype.getDataGrid=function(c,b){if(this.szFlag.match(/AGGREGATE/)&&this.itemA[c].nCount>3)return null;if((c=map.Themes.getDataRow(c,this))&&c.length){for(var f=0;f<c.length;f++)c[f]=c[f]||"---";b=new ScrollArea(null,b,null,10,10,10);b.reformat();f=b.workspaceNode;for(var a=[],p=map.Themes.getFieldIndexArray(this),
m=0;m<p.length;m++)a[p[m]]="font-weight:bold;fill:#087BBB",a[p[m+c.length/2]]="font-weight:bold;fill:#087BBB";p=map.Scale.tStyle.Description.nFontHeight/map.Scale.normalX(1);c=createTextGrid(map.SVGDocument,f,":textgrid",c,2,p,a);return b?(b.setWidth(Math.min(c.fu.getBox().width/map.Scale.normalX(1)+25,map.Scale.bBox.width/map.Scale.normalY(2.2))),b.setHeight(Math.min(c.fu.getBox().height/map.Scale.normalY(1)+25,map.Scale.bBox.height/map.Scale.normalY(1.5))),b.reformat(),b.hasScrollBars()&&b.setScrollPosition(new point(0,
0)),b):c.fu}};D.prototype.drawTextforOneQuadrant=function(c,b,f,a,p,m,w,C){var z=c.szStyle.match(/3D/)?f*2.4:f*1.2,y=z/2;C-=z*(b.length-2);for(var O=0;O<b.length;O++){var t=b[O].y/b[O].ly,d=Math.max(y,Math.min(b[O].y,C));y=d+z;C+=f;var e=w+map.Scale.normalX(2);d>b[O].y&&(t=Math.max(t,d/b[O].y));var g=c.mX+b[O].lx*p,l=c.mY+b[O].ly*m,u=c.mX+b[O].x*p,k=c.mY+b[O].y*m;e=c.mX+e*p;d=c.mY+d*m;var v=map.Dom.newGroup(c.frameGroup,"");c.donutPartsA[b[O].index].textNode=v;var x=map.Dom.newGroup(v,""),H=map.Dom.newGroup(v,
"");t&&(map.Dom.newShape("line",x,g,l,u,k,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;"),map.Dom.newShape("line",H,g,l,u,k,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;"),g=u,l=k);b[O].x<w-map.Scale.normalX(3)&&(map.Dom.newShape("line",x,g,l,c.mX+(w-map.Scale.normalX(3))*p,l,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;"),map.Dom.newShape("line",H,g,l,c.mX+(w-map.Scale.normalX(3))*p,l,"stroke:#888888;stroke-width:"+
map.Scale.normalX(.5)+";opacity:1;"),g=c.mX+(w-map.Scale.normalX(3))*p);map.Dom.newShape("line",x,g,l,e,d,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;stroke-linecap:round;");map.Dom.newShape("line",H,g,l,e,d,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+";opacity:1;");g=e;e+=map.Scale.normalX(2)*p;map.Dom.newShape("line",x,g,d,e,d,"stroke:white;stroke-width:"+map.Scale.normalX(1.5)+";opacity:0.2;");map.Dom.newShape("line",H,g,d,e,d,"stroke:#888888;stroke-width:"+map.Scale.normalX(.5)+
";opacity:1;");e+=map.Scale.normalX(1.5)*p;(t=c.partsA[b[O].index]&&c.partsA[b[O].index].szText?c.partsA[b[O].index].szText:null)||(t=c.partsA[b[O].index].szInfo?c.partsA[b[O].index].szInfo:Math.round(c.partsA[b[O].index].nInfoValue*10)/10+" % ");t=this.createTextLabel(map.SVGDocument,v,"",t,f/map.Scale.normalX(1),a,this.szFlag.match(/VALUEBACKGROUND/)?c.partsA[b[O].index].color:"white",this.szChartFlag.match(/ZOOM/)?null:this.szTextColor);t.fu.setPosition(e-f,d-f*0);t.setAttributeNS(szMapNs,"tooltip",
c.partsA[b[O].index].szInfo);c.szStyle.match(/3D/)&&t.fu.scale(1,2)}};D.prototype.drawDonutText=function(c,b){for(var f=0,a=0,p=0,m=[],w=[],C=[],z=[],y=Math.min(50,this.partsA.length),O=0;O<y;O++){var t=c.getTextPosition(O);if(t){if(this.szShowPartsA){var d=!1,e;for(e in this.szShowPartsA)this.szShowPartsA[e]==O&&(d=!0);if(!d)continue}f=Math.max(f,Math.abs(t.y));a=Math.max(a,t.x);p=Math.min(p,t.x);c.szStyle.match(/STARBURST/)?(a=Math.max(a,t.x),p=Math.min(p,t.x)):(a=c.nRadOuter,p=-c.nRadOuter);t.x>
0?t.y>0?w[w.length]={index:O,x:t.x,y:t.y,lx:t.lx,ly:t.ly}:m[m.length]={index:O,x:t.x,y:-t.y,lx:t.lx,ly:-t.ly}:t.y>0?C[C.length]={index:O,x:-t.x,y:t.y,lx:-t.lx,ly:t.ly}:z[z.length]={index:O,x:-t.x,y:-t.y,lx:-t.lx,ly:-t.ly}}}m.sort(J);w.sort(J);C.sort(J);z.sort(J);b||=map.Scale.normalX(12);this.drawTextforOneQuadrant(c,m,b,"text-anchor:start;",1,-1,a,f);this.drawTextforOneQuadrant(c,w,b,"text-anchor:start;",1,1,a,f);this.drawTextforOneQuadrant(c,C,b,"text-anchor:end;",-1,1,-p,f);this.drawTextforOneQuadrant(c,
z,b,"text-anchor:end;",-1,-1,-p,f)};D.prototype.createTextLabel=function(c,b,f,a,p,m,w,C,z){var y=!0,O=!0,t=1,d=" "+this.szChartFlag+"|"+this.szFlag;if(d.match(/ZOOM/)||d.match(/MENUSIZE/)||d.match(/NORMSIZE/)||d.match(/INFOSIZE/)||d.match(/AXIS/)||d.match(/SELECTION/))y=w?y:!1,O=!1;d.match(/VALUEBACKGROUND/)&&(y=!0);d.match(/HORZ/)&&(y=!1);isNaN(p)&&(p=14);m||="";w&&y?(C=C||ColorScheme.getTextColor(w),t=d.match(/ZOOM/)?.9:.5):w="#fefeff";if(c&&b)return c=map.Dom.newGroup(b,f),b=null,O&&!this.fShadow&&
this.fOrigShadow&&(b=map.Dom.newShape("rect",c,1,1,1,1,"fill:#444444;fill-opacity:0.4;stroke:none;")),w=map.Dom.newShape("rect",c,1,1,1,1,"fill:"+w+";fill-opacity:"+t+";stroke:none;stroke-width:"+map.Scale.normalX(p*.05)),m=map.Scale.tStyle.Values.szStyle+(this.szTextFont?"font-family:"+this.szTextFont:"")+";font-size:"+map.Scale.normalY(p)+"px;fill:"+C+";fill-opacity:1;"+m,z&&z.match(/\bGLOW\b/)&&map.Dom.newText(c,map.Scale.normalX(p),map.Scale.normalY(p*.25),m+";font-size:"+map.Scale.normalY(p)+
"px;font-weight:normal;fill:none;stroke:white;stroke-width:"+map.Scale.normalY(p)/5+";stroke-opacity:0.8;pointer-events:none;stroke-linejoin:bevel;",a),map.Dom.newText(c,map.Scale.normalX(p),map.Scale.normalY(p*.25),m,a),a=map.Dom.newText(map.SVGHiddenGroup,map.Scale.normalX(p),map.Scale.normalY(p*.25),m,a),z=a.fu.getBox(),map.SVGHiddenGroup.removeChild(a),w.setAttributeNS(null,"rx",map.Scale.normalX(p*.1)),w.setAttributeNS(null,"ry",map.Scale.normalX(p*.1)),w.setAttributeNS(null,"x",z.x-map.Scale.normalX(p*
.3)),w.setAttributeNS(null,"y",z.y-map.Scale.normalY(p*0)),w.setAttributeNS(null,"width",z.width+map.Scale.normalX(p*.7)),w.setAttributeNS(null,"height",z.height+map.Scale.normalY(p)*.1),b&&(b.setAttributeNS(null,"rx",map.Scale.normalX(p*.1)),b.setAttributeNS(null,"ry",map.Scale.normalX(p*.1)),b.setAttributeNS(null,"x",z.x-map.Scale.normalX(p*.3)+map.Scale.normalX(p*.12)),b.setAttributeNS(null,"y",z.y+map.Scale.normalY(p*0)+map.Scale.normalY(p*.12)),b.setAttributeNS(null,"width",z.width+map.Scale.normalX(p*
.7)),b.setAttributeNS(null,"height",z.height+map.Scale.normalY(p)*.1)),y||(w.style.setProperty("display","none",""),b&&b.style.setProperty("display","none","")),c};D.prototype.getOverviewChart=function(c,b){c.fu=new Methods(c);var f=30;this.szChartFlag+="|MENUSIZE";if(this.szOverviewChart&&this.szOverviewChart!="NONE"&&this.nCount){f=map.Scale.normalX(100);b=map.Scale.normalY(100);var a=map.Scale.normalX(75),p=map.Scale.normalX(50);if(typeof DonutCharts!="undefined"){var m=map.Dom.newGroup(c);f=DonutCharts.newChart(map.SVGDocument,
m,f,b,a,p);this.szOverviewChart.match(/PIE/)&&(f.setStyle("flat"),f.setRadInner(0),f.setRadOuter(map.Scale.normalX(55)),f.setCenter(map.Scale.normalX(80),map.Scale.normalY(55)));if(this.szOverviewChart.match(/DONUT/)||this.szOverviewChart.match(/3D/))f.setStyle("3D"),f.setCenter(map.Scale.normalX(80),map.Scale.normalY(100));f.setLine("white");f.setLineWidth(map.Scale.normalX(.1));b=map.Scale.normalY(20);for(a=0;a<this.partsA.length;a++){p=this.partsA[a].nCount/this.nCount*100;m=100/this.nSum*this.partsA[a].nSum;
this.nRealizedCount&&this.szFlag.match(/CHART/)&&(p=this.partsA[a].nCount/this.nRealizedCount*100);this.nExactCount&&this.exactSizeA&&(p=this.partsA[a].nCount/this.nExactCount*100,m=this.exactSizeA[a]);this.szOverviewChart.match(/DONUT/)&&(b=map.Scale.normalY(this.partsA[a].nSum/this.nSum*80));var w=String(this.partsA[a].nCount),C=p?String(" = "+this.formatValue(p,1)+" %"):"",z=m?String(", "+this.szLabelA[a]+" => "+this.formatValue(m,1)+this.szUnit):"";this.szOverviewChart.match(/PERCENTOFVALUE/)?
(p=m,C="",w=this.nExactCount&&this.exactSizeA?String(this.formatValue(p,0)):String(this.formatValue(p,1)+(this.szFlag.match(/CHART/)?this.szUnit:" %"))):this.szOverviewChart.match(/DONUT/)||(z="");this.szFlag.match(/CATEGORICAL/)?(C+=" ("+this.szLabelA[a]+")",z=""):this.szLegendLabelA&&this.szLegendLabelA.length&&(C+=" ["+this.szLegendLabelA[a]+"])");f.addPart(p,b,this.partsA[a].color,0,w,String(this.partsA[a].nCount)+" member(s)"+C+z,"map.Themes.markClass(evt,'"+this.szId+"','"+a+"')","map.Themes.unmarkClass(evt,'"+
this.szId+"')")}f.realize();this.drawDonutText(f);f=map.Dom.getBox(c);if(f.width>0&&f.height>0){c.fu.getPosition();w=this.szOverviewChart.match(/PERCENTOFVALUE/)?"*  value / class":"*  members / class";b=map.Scale.normalY(10);if(this.szOverviewChart.match(/DONUT/)||this.szOverviewChart.match(/3D/))b=map.Scale.normalY(15);map.Dom.newText(c,map.Scale.normalX(80),f.y+f.height+b,map.Scale.tStyle.Note.szStyle+";text-anchor:middle;",w)}}}else{if((this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||
this.szFlag.match(/SYMBOL/))&&(!this.szFlag.match(/CATEGORICAL/)||!this.szFlag.match(/SYMBOL/))){p=this.nMinA[0];C=this.nMaxA[0];this.szSizeField&&(p=this.nMinSize,C=this.nMaxSize);a=map.Scale.normalX(f/2);m=a/Math.sqrt(C)*Math.sqrt(p);if(this.szFlag.match(/LINEAR/)||this.szFlag.match(/SIZEP1/))m=a/C*p;w=this.szFlag.match(/SUM/)?"sum":"mean";z=map.Dom.newGroup(c);if(!this.szFlag.match(/CATEGORICAL/)){var y=map.Dom.newGroup(z);this.drawChart(y,null,f*1.5,"VALUES|ZOOM|NORMSIZE");if(this.szFlag.match(/SEQUENCE/)){var O=
map.Dom.getBox(y);var t=y.fu.getPosition();y.fu.setPosition(O.width/1.5+t.x,-O.height/2+t.y);t=map.Scale.normalX(f*7)/O.height;y.fu.scale(t,t);f*=7}map.Dom.newText(z,map.Scale.normalX(0),map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",map.Dictionary.getLocalText(w));z.fu.setPosition(map.Scale.normalX(20),map.Scale.normalY(f))}this.szFlag.match(/SEQUENCE/)||(w=map.Dom.newGroup(c),z=map.Dom.getBox(z),w.fu.setPosition(z.x+z.width+map.Scale.normalX(f*.66),map.Scale.normalY(-5)),
z="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(.25)+"px",y=map.Dom.newGroup(w),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",y,0,0,a,z):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",y,-a,-a,a*2,a*2,z),map.Dom.newShape("line",y,0,-a,a*1.1,-a,z),map.Dom.newText(y,a*1.1+map.Scale.normalX(2),-a,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",this.formatValue(C,1)+this.szUnit),y.fu.setPosition(map.Scale.normalX(20),
map.Scale.normalY(f/2)),m>0&&m!=a&&(C=map.Dom.newGroup(w),this.szFlag.match(/BUBBLE/)?map.Dom.newShape("circle",C,0,0,m,z):this.szFlag.match(/SQUARE/)&&map.Dom.newShape("rect",C,-m,-m,m*2,m*2,z),map.Dom.newShape("line",C,0,-m,a*1.1,-m,z),map.Dom.newText(C,a*1.1+map.Scale.normalX(2),-m,"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-60%;fill:black;stroke:none;pointer-events:none",this.formatValue(p,1)+this.szUnit),C.fu.setPosition(map.Scale.normalX(20),map.Scale.normalY(0)+
a*2-m)),map.Dom.newText(w,map.Scale.normalX(20),map.Scale.normalY(0+f+15),map.Scale.tStyle.Note.szStyle+";text-anchor:left;",map.Dictionary.getLocalText("min / max size-values")));c.fu.scale(1,1)}this.szFlag.match(/CHART/)&&this.szFlag.match(/BUFFER/)&&(a=map.Scale.normalX(f/2),p=map.Dom.getBox(c.parentNode),p=p.width>0?p.width/map.Scale.normalX(1)+10:10,y=map.Dom.newGroup(c.parentNode),map.Dom.newShape("circle",y,0,0,a,"fill:none;stroke:black;"),z="fill:none;stroke:black;stroke-width:"+map.Scale.normalX(1)+
";",map.Dom.newShape("line",y,0,0,a,0,z),map.Dom.newShape("line",y,0,map.Scale.normalY(-2),0,map.Scale.normalY(2.5),z),map.Dom.newShape("line",y,a,0,a+map.Scale.normalX(-3),map.Scale.normalY(-3),z),map.Dom.newShape("line",y,a,0,a+map.Scale.normalX(-3),map.Scale.normalY(3),z),map.Dom.newText(y,a*1.1+map.Scale.normalX(2),map.Scale.normalX(-10),"font-family:arial;font-size:"+map.Scale.normalX(10)+"px;text-anchor:left;baseline-shift:-10%;fill:black;stroke:none;pointer-events:none",ixMap.Scale.prototype.formatDistanceString(this.nBufferSize*
this.nScale)),y.fu.setPosition(map.Scale.normalX(f/2+p),map.Scale.normalY(f/2)),b=new Button(c.parentNode,b+":bufferselectbutton","BUTTON","#bufferselect_button","map.Selections.newSelection('activeLayer','activeBuffer','type:BUFFER;buffersize:200','test');","","select active layer with this buffer"),b.setPosition(map.Scale.normalX(f+p+10),map.Scale.normalY(f)),b.scale(1.4,1.4),map._activeTheme&&map.Dom.newText(c.parentNode,map.Scale.normalX(f+p+20),map.Scale.normalY(f+6),"font-family:arial;font-size:"+
map.Scale.normalX(8)+"px;text-anchor:left;baseline-shift:-10%;fill:gray;stroke:none;pointer-events:none","... "+map._activeTheme));if(!(!this.szFlag.match(/CHART/)||this.szFlag.match(/BUBBLE/)||this.szFlag.match(/SQUARE/)||this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/BUFFER/)||this.szFlag.match(/SYMBOL/))){a=map.Dom.getBox(c.parentNode);a.width<0&&(a=new box(0,0,0,0));f=30;this.szFlag.match(/BAR/)&&this.nOrigSumA.length>5&&!this.szFlag.match(/STACKED/)&&(f=15*this.nOrigSumA.length/Math.log(this.nOrigSumA.length));
this.drawChart(c,null,f,"VALUES|NORMSIZE"+(this.szFlag.match(/STACKED/)?"|EXPANDMAX":""));f=map.Dom.getBox(c);f=Math.min(2.5,Math.max(a.height/f.height,map.Scale.normalX(100)/f.height));c.fu=new Methods(c);c.fu.scale(f,f);b=map.Dom.newGroup(c,"textGroup");b.fu.scale(1/f,1/f);f=c.fu.getBox();this.szFlag.match(/BAR/)?c.fu.setPosition(a.width-f.x+map.Scale.normalX(10),-f.y+Math.max(10,a.height*.95-f.height)):c.fu.setPosition(a.width-f.x+map.Scale.normalX(10),-f.y+Math.max(10,a.height/2-f.height/2));
w=" * overall sum";this.szAggregation&&this.szAggregation.match(/mean/)&&(w=" * arithmetic mean");c="middle";if(this.szFlag.match(/RIGHT/)||this.szFlag.match(/STACKED/)||this.szFlag.match(/CENTER/)||this.szFlag.match(/POINTER/)||this.partsA.length<=2)c="start";map.Dom.newText(b,0,f.height+f.y+map.Scale.normalY(5),map.Scale.tStyle.Note.szStyle+"baseline-shift:-100%;text-anchor:"+c+";",w)}}};D.prototype.drawColorSchemeLegend=function(c,b){var f=map.Scale.nButtonSize?map.Scale.nButtonSize*.66:12,a=map.Scale.nButtonSize||
12,p=map.Scale.nButtonSize?map.Scale.nButtonSize*1.2:18,m=p,w="font-family:arial;font-size:"+map.Scale.normalY(f)+"px;fill:#666666;pointer-events:none;",C=a*1.2;this.szFlag.match(/BAR/)&&this.szFlag.match(/\bUP\b/)&&(C=a);var z=f*1.15,y=0*C,O=0;this.szFlag.match(/BAR/)&&(this.szFlag.match(/\bUP\b/)||this.szFlag.match(/STACKED/))&&(O=this.partsA.length-1);this.showInfoMore||this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/\bUP\b/)||this.szFlag.match(/SYMBOL/)||this.szLabelA&&!this.szFlag.match(/\bCLIP\b/)||
this.partsA.length<=2?this.szLegendStyle="large":this.szLegendStyle="compact";var t=new ScrollArea(null,c,null,10,10,10);t.reformat();var d=t.workspaceNode;for(var e=1,g=0;g<this.partsA.length;g++)this.partsA[g].min&&(this.partsA[g].min.toFixed(0)!=this.partsA[g].min&&(e=Math.min(e,.1)),this.partsA[g].min.toFixed(1)!=this.partsA[g].min&&(e=Math.min(e,.01)));var l=[];for(g=0;g<this.partsA.length;g++)l[g]={},l[g].i=g,l[g].value=this.partsA[g].nCount;this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/)&&
this.szFlag.match(/SORTDOWN/)&&l.sort(this.sortIndexDown);!this.szFlag.match(/POINTER/)&&!this.szFlag.match(/INVERT/)||this.szLegendStyle.match(/compact/)||l.reverse();var u=1;!this.szLabelA&&l.length>15&&(u=Math.floor(l.length/10),a*=1.5);var k=this.showInfoMore&&this.isMarkable?18:10,v=!1;if(this.szFlag.match(/CHART/)&&this.szFieldsA.length>1&&!this.szFlag.match(/OFFSET/)&&!this.szFlag.match(/DEVIATION/)){for(var x=v=0;x<this.nOrigSumA.length;x++)this.partsA[x]&&typeof this.partsA[x].nSum!="undefined"&&
v++;v=v==this.nOrigSumA.length}for(var H=0;H<l.length;H+=u){g=l[H].i;var G=Math.min(Math.abs(O-g),this.partsA.length-u);if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/))p=this.nSkipCount===0?3*this.partsA[g].nCount/this.nCount*100:30/this.nCount*10*this.partsA[g].nCount;else if(v){p=0;if(this.szFlag.match(/MORPH/)){for(x=0;x<this.nOrigSumA.length/2;x++)p=Math.max(p,this.nOrigSumA[x]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[x+this.nOrigSumA.length/
2]*this.nActualFrame/(this.nClipFrames-1));p=(this.nOrigSumA[G]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[G+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1))/p}else{for(x=0;x<this.nOrigSumA.length;x++)p=Math.max(p,this.partsA[x].nSum);p=this.partsA[G].nSum/p}p*=60}p=isNaN(p)?m:p;if(this.szFlag.match(/BUBBLE/))x=this.szFlag.match(/CATEGORICAL/)||this.szSizeField?a/2:a/4+a/4*(g+1)/this.partsA.length,x=map.Dom.newShape("circle",d,map.Scale.normalX(k+a/
2),map.Scale.normalY(y+a/2),map.Scale.normalY(x),"fill:"+this.colorScheme[G]+";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");else if(u>1){x=map.Dom.newGroup(d,"");for(var P=0;P<u;P++)map.Dom.newShape("rect",x,map.Scale.normalX(k),map.Scale.normalY(y+a/u*P),map.Scale.normalX(p),map.Scale.normalY(a/u),"fill:"+this.colorScheme[G+P]+";stroke:none;")}else x=map.Dom.newShape("rect",d,map.Scale.normalX(k),map.Scale.normalY(y),map.Scale.normalX(p),map.Scale.normalY(a),"fill:"+this.colorScheme[G]+
";stroke:#eeeeee;stroke-width:"+map.Scale.normalX(.1)+";");if(x){var M=this.partsA[G].nCount;for(P=1;P<u;P++)M+=this.partsA[G+P].nCount;this.isMarkable&&this.showInfoMore&&(map.Dom.newShape("rect",d,map.Scale.normalX(-5),map.Scale.normalY(y-2),map.Scale.normalX(p),map.Scale.normalY(a+4),"fill:white;stroke:none;opacity:0;").setAttributeNS(null,"id",this.szId+":widget:background:"+G),P=new Button(d,this.szId+":class:"+G,"CHECKBOX|SELECTED","","map.Themes.showClass(evt,'"+this.szId+"','"+G+"','"+u+"')",
"map.Themes.hideClass(evt,'"+this.szId+"','"+G+"','"+u+"')","show/hide class"),P.setPosition(map.Scale.normalX(map.Scale.nButtonSize/2-1),map.Scale.normalY(y+map.Scale.nButtonSize/2-1)),P.scale(.75,.75));var T=this.partsA[G].min+(H?e:0);P=this.partsA[G+u-1].max;var qa=P-T>100?0:2;T=this.formatValue(T,qa);qa=this.formatValue(P,qa);P="";this.szFlag.match(/SHOWMEMBERS/)&&(P="  ["+M+"]");P=T!=qa?T+"..."+qa+(this.szLegendUnits?this.szLegendUnits:"")+this.szUnit+P:T+(this.szLegendUnits?this.szLegendUnits:
"")+this.szUnit+P;(!this.szFlag.match(/\bCLIP\b/)||this.szFlag.match(/MORPH/))&&this.szLabelA&&this.szLabelA[G]&&(P=this.szLabelA[G]);this.szLegendLabelA[G]=P;if(this.szLegendStyle.match(/compact/)){if(this.fGrayNoMember&&M===0&&this.szFlag.match(/CHOROPLETH/)&&this.szFlag.match(/DOMINANT/)&&(x.style.setProperty("fill-opacity","0.03",""),x.style.getPropertyValue("fill"),x.style.setProperty("stroke-opacity","0.2",""),x.style.setProperty("stroke","black",""),x.style.setProperty("stroke-width",map.Scale.normalX(.3),
"")),!(this.szFlag.match(/CATEGORICAL/)||this.szFlag.match(/DOMINANT/)&&P.length>15)){var X=";font-size:"+map.Scale.normalX(f*.9)+"px;";H===0?(P=P.length>0?T+this.szUnit:P,map.Dom.newText(d,map.Scale.normalX(k+2),map.Scale.normalY(y+z*(u+1.5)),w+X,P)):H==l.length-u&&(P=P.length>0?qa+this.szUnit:P,map.Dom.newText(d,map.Scale.normalX(k+2),map.Scale.normalY(y+z*(u+1.5)),w+X,P))}}else if(this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/))T=p+2,qa=String(this.partsA[g].nCount),this.nSkipCount===
0&&(qa=String(Math.round(100/this.nCount*this.partsA[g].nCount))+"%"),X=qa.length*5/7*f,this.szTextPlacement=="dynamic"&&X<p&&(T-=String(this.partsA[g].nCount).length*5/7*f),map.Dom.newText(d,map.Scale.normalX(k+T),map.Scale.normalY(y+z+1),w,qa),T+=X,this.szSymbolsA[g]&&this.szSymbolsA[g].match(/symbol/)&&(qa=map.Dom.constructNode("use",d,{"xlink:href":"#"+this.szSymbolsA[g]+":antizoomandpan"}),qa.setAttributeNS(null,"style","fill:"+this.colorScheme[G]),qa.fu.scale(.5,.5),qa.fu.setPosition(map.Scale.normalX(k+
T+10),map.Scale.normalY(y+z-3)),T+=20),T=map.Dom.newText(d,map.Scale.normalX(k+T),map.Scale.normalY(y+z),w,"("+P+")"),T.style.setProperty("fill","#bbbbdd","");else{T=p+4;if(v){qa=this.partsA[G].nSum;this.szFlag.match(/MORPH/)&&(qa=this.nOrigSumA[G]*(this.nClipFrames-1-this.nActualFrame)/(this.nClipFrames-1)+this.nOrigSumA[G+this.nOrigSumA.length/2]*this.nActualFrame/(this.nClipFrames-1));if(this.szField100&&!this.szFlag.match(/SUM/)||this.szAggregation&&!this.szAggregation.match(/sum/))qa/=this.partsA[G].nCount;
P=P+"  ("+this.formatValue(qa,1)+this.szUnit+")"}T=map.Dom.newText(d,map.Scale.normalX(k+T),map.Scale.normalY(y+z),w,P);this.fGrayNoMember&&M===0&&this.szFlag.match(/CHOROPLETH/)&&(T.style.setProperty("fill","#bbbbdd",""),x.style.setProperty("opacity","0.1",""))}this.szFlag.match(/BUFFER/)&&x.style.setProperty("fill-opacity",this.fillOpacity?this.fillOpacity:this.nOpacity?this.nOpacity:0,"");this.szFieldsA.length==1||!this.szFlag.match(/CHART/)||this.szFlag.match(/SYMBOL/)&&this.szFlag.match(/CATEGORICAL/)?
(this.szLegendStyle.match(/compact/)?x.setAttributeNS(szMapNs,"tooltip",P+" ("+M+" member(s))"):x.setAttributeNS(szMapNs,"tooltip",M+" member(s)"),g=x.getAttributeNS(null,"style"),x.setAttributeNS(szMapNs,"onoverstyle",g+";stroke:black;stroke-width:"+map.Scale.normalX(.5)+";"),x.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+G+"','"+u+"')"),x.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"),x.setAttributeNS(null,"onclick","map.Themes.zoomToClass(evt,'"+
this.szId+"','"+G+"','"+u+"')"),x.setAttributeNS(null,"id",b+":widget:classrect:"+G)):this.szFlag.match(/SYMBOL/)?this.szFlag.match(/CATEGORICAL/)?x.setAttributeNS(szMapNs,"tooltip",this.partsA[g].nCount+" ("+this.formatValue(this.partsA[g].nCount/this.nCount*100,1)+" %)"):this.szFlag.match(/SEQUENCE/)&&x.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[g]+" ("+this.formatValue(this.nOrigSumA[g]/this.nSum*100,1)+" %)"):this.szFieldsA.length>1&&!this.szFlag.match(/SEQUENCE/)&&(this.nSum100?x.setAttributeNS(szMapNs,
"tooltip",this.formatValue(100/this.nSum100*this.nOrigSumA[G],1)+" %"):this.nSum&&x.setAttributeNS(szMapNs,"tooltip",this.nOrigSumA[G]+" ("+this.formatValue(100/this.nSum*this.nOrigSumA[G],1)+" %)"),x.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+G+"','"+u+"')"),x.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"))}this.szLegendStyle.match(/compact/)?k+=p:y+=C*9/10}this.szLegendStyle.match(/compact/)?y+=C*u*2:this.nNoData&&(y+=C*1.5/10,
x=map.Dom.newShape("rect",d,0,map.Scale.normalY(y),map.Scale.normalX(p),map.Scale.normalY(a),"fill:"+(this.szNoDataColor?this.szNoDataColor:"#ffffff")+";stroke:#000000;stroke-width:"+map.Scale.normalX(.1)+";"),x.setAttributeNS(szMapNs,"tooltip",this.nNoData+" member(s)"),x.setAttributeNS(null,"onmouseover","map.Themes.markClass(evt,'"+this.szId+"','"+G+"')"),x.setAttributeNS(null,"onmouseout","map.Themes.unmarkClass(evt,'"+this.szId+"')"),map.Dom.newText(d,map.Scale.normalX(22),map.Scale.normalY(y+
z),w,map.Dictionary.getLocalText("no data")),y+=C*9/10);t&&(t.setWidth(-1),t.setHeight(Math.min(y+C,map.Scale.bBox.height/map.Scale.normalY(2.2))),this.nClipColorLegend&&t.setHeight(this.nClipColorLegend),t.reformat(),t.hasScrollBars()&&(d.style.setProperty("display","none",""),map.Dom.newShape("rect",c,0,0,map.Scale.normalX(t.getWidth()),map.Scale.normalY(t.getHeight()),"fill:none;stroke:none;")));return d};D.prototype.showInfo=function(){};D.prototype.chartButton=function(c,b,f){c=map.Dom.newGroup(c,
"chartvari"+String(Math.random()));var a=this.szFlag;f=="2D"&&this.removeDefinitionFromFlag("3D");this.szFlag+="|NORMSIZE|SILENT|MENUSIZE|"+f;this.drawChart(c,null,b);this.szFlag=a;a=map.Dom.getBox(c);this.addChartTypeSign(c,f);f=Math.min(map.Scale.normalX(b)/a.width,map.Scale.normalY(b)/a.height);c.fu.scale(f,f);c.fu.setPosition(map.Scale.normalX(b+10),map.Scale.normalY(b)*f);return c};D.prototype.addDefinitionToFlag=function(c){return this.szFlag=this.szFlag+"|"+c};D.prototype.removeDefinitionFromFlag=
function(c){for(var b="",f=this.szFlag.split("|"),a=0;a<f.length;a++)f[a]!=c&&(b+=(b.length?"|":"")+f[a]);return this.szFlag=b};D.prototype.removeDefinition=function(c,b){var f="";c=c.split("|");for(var a=0;a<c.length;a++)c[a]!=b&&(f+=(f.length?"|":"")+c[a]);return f};D.prototype.addChartTypeSign=function(c,b){var f="M0,0 l"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" -"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" M"+map.Scale.normalX(2.5)+",0 l"+map.Scale.normalX(17.5)+
",0 M"+map.Scale.normalX(22.5)+",0 l-"+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5)+" 0,"+map.Scale.normalX(3)+" "+map.Scale.normalX(1.5)+",-"+map.Scale.normalX(1.5);if(b.match(/SIZE/)){var a=map.Dom.newGroup(c,"");map.Dom.newShape("path",a,f,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;stroke-linecap:square;");map.Dom.newShape("path",a,f,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+";stroke-linejoin:miter;stroke-linecap:square;");a.fu.setPosition(-map.Scale.normalX(10),
map.Scale.normalX(-5))}b.match(/HEIGHT/)&&(a=map.Dom.newGroup(c,""),map.Dom.newShape("path",a,f,"stroke:white;stroke-width:"+map.Scale.normalX(4)+";stroke-opacity:0.5;stroke-linejoin:miter;stroke-linecap:square;"),map.Dom.newShape("path",a,f,"stroke:#666666;stroke-width:"+map.Scale.normalX(1.5)+";stroke-linejoin:miter;stroke-linecap:square;"),a.setAttributeNS(null,"transform","translate(0,"+-map.Scale.normalX(25)+") rotate(90)"))};D.prototype.getChartTypeMenu=function(c,b,f){if(typeof a=="undefined")var a=
"CHART|BAR CHART|BAR|3D CHART|BAR|3D|SORT CHART|BAR|HORZ|LEFT|UP CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|LEFT|UP|COMPRESS CHART|BAR|HORZ|RIGHT|UP|COMPRESS CHART|BAR|HORZ|LEFT|UP|3D CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|HORZ|LEFT|UP|COMPRESS|3D CHART|BAR|HORZ|RIGHT|UP|COMPRESS|3D CHART|BAR|HORZ|CENTER|UP CHART|BAR|STACKED CHART|BAR|STACKED|3D CHART|BAR|SORT|3D|COLUMNS|STACKED CHART|BAR|SORT|3D|COLUMNS|STACKED|SIZE CHART|PIE CHART|PIE|SIZE CHART|PIE|3D CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|VOLUME CHART|PIE|DONUT CHART|PIE|DONUT|SIZE CHART|PIE|DONUT|3D CHART|PIE|DONUT|3D|SIZE CHART|PIE|DONUT|3D|HEIGHT CHART|PIE|DONUT|3D|VOLUME CHART|PIE|STARBURST CHART|PIE|STARBURST|SIZE CHART|PIE|STARBURST|3D CHART|PIE|STARBURST|3D|SIZE CHART|PIE|STARBURST|3D|HEIGHT CHART|PIE|STARBURST|3D|VOLUME CHART|PIE|DONUT|STARBURST CHART|PIE|DONUT|STARBURST|SIZE CHART|PIE|DONUT|STARBURST|3D CHART|PIE|DONUT|STARBURST|3D|SIZE CHART|PIE|DONUT|STARBURST|3D|HEIGHT CHART|PIE|DONUT|STARBURST|3D|VOLUME".split(" ");
if(typeof p=="undefined")var p="CHOROPLETH CHART|BUBBLE CHART|SQUARE CHART|PIE|3D|SIZE CHART|PIE|3D|HEIGHT CHART|PIE|3D|SIZE|HEIGHT CHART|BAR|3D|VOLUME CHART|BAR CHART|BAR|3D CHART|BAR|3D|SIZE CHART|BAR|HORZ|RIGHT|UP CHART|BAR|HORZ|RIGHT|UP|3D CHART|BAR|POINTER CHART|BAR|POINTER|SIZE CHART|BAR|HORZ|RIGHT|UP|POINTER CHART|LABEL".split(" ");b=this.szOrigFlag;if(this.szFieldsA.length>1||this.szFlag.match(/CATEGORICAL/)&&this.szFlag.match(/AGGREGATE/))p=a;f=f?f/60:3;for(a=0;a<p.length;a++){var m=this.szFlag;
var w=map.Dom.constructNode("a",c,{});map.Dom.newShape("rect",w,map.Scale.normalX(a%f*60),map.Scale.normalY(60*Math.floor(a/f)),map.Scale.normalX(60),map.Scale.normalY(60),"fill:#f8f8ff;stroke:lightgray;stroke-dasharray:50 50;stroke-width:"+map.Scale.normalX(1)+";");var C=map.Dom.newGroup(w,"szDisplayId:chart:"+String(Math.random()));map.Dom.setClipRect(C,new box(-map.Scale.normalX(25),-map.Scale.normalX(60),map.Scale.normalX(60),map.Scale.normalX(60)));this.szFlag=p[a]+"|NORMSIZE|SILENT|MENUSIZE";
m.match(/CATEGORICAL/)&&(this.szFlag+="|CATEGORICAL");m.match(/GROUP/)&&(this.szFlag+="|GROUP");m.match(/AGGREGATE/)&&(this.szFlag+="|AGGREGATE");m.match(/COMPATIBLE/)&&(this.szFlag+="|COMPATIBLE");m.match(/FAST/)&&(this.szFlag+="|FAST");m.match(/RELOCATE/)&&(this.szFlag+="|RELOCATE");m.match(/DIFFERENCE/)&&(this.szFlag+="|DIFFERENCE");m.match(/FRACTION/)&&(this.szFlag+="|FRACTION");m.match(/INVERT/)&&(this.szFlag+="|INVERT");m.match(/INVERTSIZE/)&&(this.szFlag+="|INVERTSIZE");m.match(/RELATIVE/)&&
(this.szFlag+="|RELATIVE");m.match(/DENSITY/)&&(this.szFlag+="|DENSITY");m.match(/DOPACITYMAX/)?this.szFlag+="|DOPACITYMAX":m.match(/DOPACITYLOGMAX/)?this.szFlag+="|DOPACITYLOGMAX":m.match(/DOPACITYPOWMAX/)?this.szFlag+="|DOPACITYPOWMAX":m.match(/DOPACITYMEAN/)?this.szFlag+="|DOPACITYMEAN":m.match(/DOPACITYLOGMEAN/)?this.szFlag+="|DOPACITYLOGMEAN":m.match(/DOPACITYPOWMEAN/)?this.szFlag+="|DOPACITYPOWMEAN":m.match(/DOPACITYLOG/)?this.szFlag+="|DOPACITYLOG":m.match(/DOPACITY/)&&(this.szFlag+="|DOPACITY");
m.match(/AUTO100/)&&(this.szFlag+="|AUTO100");m.match(/AUTOCOMPLETE/)&&(this.szFlag+="|AUTOCOMPLETE");var z=this.szAggregation,y=this.nClipParts;this.nClipParts=10;var O=this.drawChart(C,null,40);typeof y==="undefined"?delete this.nClipParts:this.nClipParts=y;this.szAggregation=z;if(O){this.szFlag=m;var t=map.Scale.normalX(10);O.x-=map.Scale.normalX(60/f);C.fu.setPosition(t-O.x+a%f*map.Scale.normalX(60),map.Scale.normalY(40)+t+O.y+Math.floor(a/f)*map.Scale.normalY(60));C.setAttributeNS(null,"clip-path",
"");t=900/Math.max(C.fu.getBox().width,C.fu.getBox().height);t<1&&C.fu.scale(t,t);t="";b.match(/UNDEFINEDISVALUE/)&&(t+="|UNDEFINEDISVALUE");b.match(/ZEROISVALUE/)&&(t+="|ZEROISVALUE");b.match(/NEGATIVEISVALUE/)&&(t+="|NEGATIVEISVALUE");b.match(/NONEGATIVE/)&&(t+="|NEGATIVEISVALUE");b.match(/GROUP/)&&(t+="|GROUP");b.match(/AGGREGATE/)&&(t+="|AGGREGATE");b.match(/COMPATIBLE/)&&(t+="|COMPATIBLE");b.match(/FAST/)&&(t+="|FAST");b.match(/\bRECT\b/)&&(t+="|RECT");b.match(/HEX/)&&(t+="|HEX");b.match(/RELOCATE/)&&
(t+="|RELOCATE");b.match(/CATEGORICAL/)&&(t+="|CATEGORICAL");b.match(/SUM/)&&(t+="|SUM");b.match(/MEAN/)&&(t+="|MEAN");b.match(/DIFFERENCE/)&&(t+="|DIFFERENCE");b.match(/RELATIVE/)&&(t+="|RELATIVE");b.match(/INVERT/)&&(t+="|INVERT");b.match(/INVERTSIZE/)&&(t+="|INVERTSIZE");b.match(/CALCMEAN/)&&(t+="|CALCMEAN");b.match(/CALC100/)&&(t+="|CALC100");b.match(/PRODUCT/)&&(t+="|PRODUCT");b.match(/AUTOCOMPLETE/)&&(t+="|AUTOCOMPLETE");b.match(/AUTO100/)&&(t+="|AUTO100");b.match(/QUANTILE/)&&(t+="|QUANTILE");
b.match(/DENSITY/)&&(t+="|DENSITY");b.match(/DOPACITY/)&&(t+="|DOPACITY");if(b.match(/VALUES/)||m.match(/VALUES/))t+="|VALUES";b.match(/VALUEBACKGROUND/)&&(t+="|VALUEBACKGROUND");p[a].match(/SIZE/)&&(m.match(/SIZELOG/)?t+="|SIZELOG":m.match(/SIZEP4/)?t+="|SIZEP4":m.match(/SIZEP3/)?t+="|SIZEP3":m.match(/SIZE/)&&(t+="|SIZE"));m.match(/SPACED/)&&(t+="|SPACED");w.setAttributeNS(null,"onclick","map.Themes.changeThemeStyle(evt,'"+this.szId+"','type:"+p[a]+t+"')");this.addChartTypeSign(C,p[a])}}c=[];for(var d in p)c.push(p[d]+
t);return c};D.prototype.formatValue=function(c,b,f){return isNaN(c)?c:this.nMin>999&&this.nMax<3E3?__formatValue(c,b,f+"|NOBREAKS"):__formatValue(c,b,f)};D.prototype.remove=function(c){this.parent.removeTheme(c,this.szId)};D.prototype.removeElements=function(c){this.szFlag.match(/FEATURE/)&&this.chartGroup&&this.parent.removeFromThemeNodesCache(this.chartGroup);this.widgetNode&&(widgetList.removeWidget(this.widgetNode),this.widgetNode.parentNode.removeChild(this.widgetNode),this.widgetNode=null);
this.clipTimeout&&clearTimeout(this.clipTimeout);this.unpaintMap();this.clearWMS();this.szFlag.match(/FEATURE/)&&this.chartGroup&&(c=map.SVGDocument.getElementById(this.chartGroup.getAttributeNS(null,"id")+":label"),this.chartGroup.parentNode.removeChild(c),this.chartGroup.parentNode.removeChild(this.chartGroup),this.parent.removeFromThemeNodesCache(this.chartGroup));if(this.onremove)try{eval(this.onremove)}catch(b){}try{map.HTMLWindow.ixmaps.htmlgui_onRemoveTheme(this.szId)}catch(b){}};D.prototype.removeMapThemeStyles=
function(c){c=c.split("|");for(var b=map.SVGRootElement.getElementsByTagName("path"),f=0;f<b.length;f++)if(b.item(f).nodeType==1){var a=b.item(f).parentNode.getAttributeNS(null,"id"),p=!1;if(a&&a.length!==0){a=map.Tiles.getMasterId(a).split(":")[0];for(var m=0;m<c.length;m++)a==c[m]&&(p=!0)}p&&b.item(f).parentNode.removeAttributeNS(null,"style")}};D.prototype.disable=function(){if(!this.szFlag.match(/CHART/)&&this.widgetNode)for(var c=this.widgetNode.getElementsByTagName("g"),b=0;b<c.length;b++)c.item(b).setAttributeNS(null,
"opacity","0.9")};D.prototype.enable=function(){if(this.widgetNode){for(var c=this.widgetNode.getElementsByTagName("g"),b=0;b<c.length;b++)c.item(b).setAttributeNS(null,"opacity","1.0");this.widgetNode.parentNode.appendChild(this.widgetNode)}map.Themes.setActive(this)};D.prototype.makeVisible=function(){for(var c=0;c<this.szThemesA.length;c++)map.Layer.isLayerOn(this.szThemesA[c])||map.Layer.isScaleDependentLayer(this.szThemesA[c])||(map.Themes.switchedLayerA[this.szThemesA[c]]=!0,map.Api.switchMapTheme(this.szThemesA[c],
"on")),map.Tiles.switchScaleDependentTiles()};D.prototype.checkVisible=function(){for(var c=0;c<this.szThemesA.length;c++)map.Themes.isThemeLayerUsed(this.szThemesA[c])&&this.isVisible||!map.Themes.switchedLayerA[this.szThemesA[c]]||(map.Api.switchMapTheme(this.szThemesA[c],"off"),map.Themes.switchedLayerA[this.szThemesA[c]]=null)};D.prototype.resize=function(c){c!=999&&(this.nScale*=c);if(this.szFlag.match(/BUFFER/)&&this.szShapeType.match(/line/))this.fRedrawInfo=this.fRedraw=!0,this.nSkipCount=
1,map.Themes.execute();else{map.Layer.changeObjectScaling(null,c,this.chartGroup);this.szFlag.match(/DECLUTTER/)&&this.declutterCharts();if(this.szFlag.match(/BUFFER/))for(var b=this.chartGroup.getElementsByTagName("circle"),f=0;f<b.length;f++){var a=b.item(f).getAttributeNS(null,"style");a&&a.length&&(a=__scaleStyleString(a,1/c),b.item(f).setAttributeNS(null,"style",a))}this.f=!0;this.showInfo()}};D.prototype.offset=function(c){var b=this.chartGroup.fu.getPosition();this.chartGroup.fu.setPosition(b.x+
c.x,b.y+c.y)};D.prototype.opacity=function(c){this.fillOpacity=(this.fillOpacity?this.fillOpacity:1)*c;this.fillOpacity=Math.min(1,this.fillOpacity);this.fillOpacity=Math.max(0,this.fillOpacity);this.nOpacity=(this.nOpacity?this.nOpacity:1)*c;this.nOpacity=Math.min(1,this.nOpacity);this.nOpacity=Math.max(0,this.nOpacity);if(this.chartGroup)for(var b=this.chartGroup.childNodes,f=0;f<b.length;f++)map.Layer.changeNodeOpacity(b.item(f),c);else if(this.szShapeType.match(/line/))for(f=0;f<this.szThemesA.length;f++)map.Layer.changeLayerOpacity(this.szThemesA[f],
c);else for(b in this.itemA){f=this.getItemNodes(b);for(var a=0;a<f.length;a++)map.Layer.changeNodeOpacity(f[a],c,"fill-opacity")}};D.prototype.blur=function(c){if(this.chartGroup)if(this.nBlur){var b="blur-3",f=map.SVGDocument.getElementById(b);f?f.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(c)):(f=map.Dom.newNode("filter",this.chartGroup.parentNode),f.setAttributeNS(null,"id",b),f=map.Dom.newNode("feGaussianBlur",f),f.setAttributeNS(null,"stdDeviation",map.Scale.normalX(c)));
this.chartGroup.style.setProperty("filter","url(#"+b+")","")}else this.chartGroup.style.removeProperty("filter");else if(this.szThemesA[0]){var a=map.SVGDocument.getElementById("maplayer");a&&(this.nBlur?(b="blur-map",(f=map.SVGDocument.getElementById(b))?f.firstChild.setAttributeNS(null,"stdDeviation",map.Scale.normalX(c)/map.Zoom.nZoom):(f=map.Dom.newNode("filter",a.parentNode),f.setAttributeNS(null,"id",b),f.setAttributeNS(null,"x",0),f.setAttributeNS(null,"y",0),f.setAttributeNS(null,"width",
"100%"),f.setAttributeNS(null,"height","100%"),f=map.Dom.newNode("feGaussianBlur",f),f.setAttributeNS(null,"stdDeviation",map.Scale.normalX(c)/map.Zoom.nZoom)),a.style.setProperty("filter","url(#"+b+")","")):a.style.removeProperty("filter"))}};D.prototype.toggle=function(c){this.chartGroup?c===!0||typeof c=="undefined"&&this.chartGroup.style.getPropertyValue("display")=="none"?(this.chartGroup.style.setProperty("display","inline",""),this.chartGroup.display="inline",this.isChecked=!0):(this.chartGroup.style.setProperty("display",
"none",""),this.chartGroup.display="none",this.isChecked=!1):this.isChecked?(this.unpaintMap(),this.isChecked=!1,map.Themes.activateNextPaint(this)&&(this.fToggle=!1,map.Themes.execute(),this.widgetNode&&(this.widgetNode.setAttributeNS(null,"opacity","1.0"),this.widgetNode.parentNode.appendChild(this.widgetNode)))):(this.fRedraw=this.isChecked=!0,this.fToggle=!1,map.Themes.execute())};D.prototype.getHistogram=function(c,b,f){map.Themes.getHistogram(c,b,f,this)};var za=[]})();var mapSelection=null;
(function(){function Ha(A,B,D,J){this.nSelected=this.nCount=0;this.szThemes=A;this.szThemesA=A.split("|");this.szSelectShape=B;this.highLightList=new HighLight;this.szTitle=J?J:"["+B+"] - "+A;this.szTitle=map.Dictionary.getLocalText(this.szTitle);this.szOrigFlag=this.szFlag=D?D:"";this.nRefreshTimeout=0;this.szId="theme"+String(Math.random());this.szShapeType="polygon"}function q(A,B){var D=A.x;A=A.y;for(var J=!1,N=0,ia=B.length-1;N<B.length;ia=N++){var Y=B[N].x,W=B[N].y,S=B[ia].x;ia=B[ia].y;W>A!=
ia>A&&D<(S-Y)*(A-W)/(ia-W)+Y&&(J=!J)}return J}function K(A){if(A){var B=A instanceof Array?[]:{},D;for(D in A)D!="clone"&&(B[D]=A[D]&&typeof A[D]=="object"?K(A[D]):A[D]);return B}return null}ixMap.Selections=function(){};ixMap.Selections.prototype=new Map;typeof thisversion=="string"&&map.checkVersion(thisversion)?map.Selections=new ixMap.Selections:alert("ixMap.Themes incompatible !");ixMap.Selections.prototype.newSelection=function(A,B,D,J){if(B==null)return displayMessage("empty selection",1E3),
null;var N=null;D==null&&(D="type:circle");if(N=(N=D.split("style="))&&N.length>1?__getStyleObj(N[1]):__getStyleObj(D)){A=="activeLayer"&&(A=getActiveTheme(),A==null&&map.Themes.activeTheme&&(A=map.Themes.activeTheme.szThemes));if(A==null)return displayMessage("nothing to select!",1E3),null;mapSelection=new Ha(A,B,"SELECTION|"+N.type,J);N.buffersize&&(mapSelection.nBufferSize=N.buffersize)}mapSelection.parent=map.Themes;map.Themes.addTheme(mapSelection);mapSelection.fRealize=!0;executeWithMessage(()=>
map.Themes.execute(),"please wait ...");return mapSelection};Ha.prototype.initValues=function(){this.nSelectedArea=this.nSelected=this.nThemeItems=this.nTested=this.nCount=this.nNodes=0;this.activeTheme=map.Themes.getTheme(this.szThemes)||map.Themes.getTheme();this.activeTheme.szThemes!=this.szThemes&&this.activeTheme.szId!=this.szThemes||!this.activeTheme.szFlag.match(/CHART/)||this.activeTheme.szFlag.match(/MULTIPLE/)||(this.szThemes="generic");this.themeNodesA=[];if(this.szThemes=="generic"){var A=
this.activeTheme;this.nCount=this.nNodes=this.nThemeItems=(this.themeRootNodesA=A.filterNodesA&&A.filterNodesA!=this.szSelectShape?K(A.filterNodesA):K(A.indexA))?this.themeRootNodesA.length:0}else{this.themeRootNodesA=[];for(A=0;A<this.szThemesA.length;A++){var B=map.Layer.getLayerObj(this.szThemesA[A]);if(B&&B.szSelection&&B.szSelection.length!==0){this.szThemeType=B.szType;this.nThemeItems+=B.nItems;var D=[];B.szFlag.match(/tiled/)?D=map.Tiles.getTileNodes(this.szThemesA[A]):D[0]=SVGDocument.getElementById(B.szName);
if(B.nRenderer&1&&B.szRenderer&&B.szRenderer.length)for(B=0;B<D.length;B++)for(var J=D[B].childNodes,N=0;N<J.length;N++)J.item(N).nodeType==1&&J.item(N).hasChildNodes()&&(this.themeRootNodesA[this.themeRootNodesA.length]=J.item(N));else for(B=0;B<D.length;B++)this.themeRootNodesA[this.themeRootNodesA.length]=D[B]}}if(this.themeRootNodesA.length===0)return!1;for(A=0;A<this.themeRootNodesA.length;A++)this.nNodes+=this.themeRootNodesA[A].childNodes.length;this.nCount=this.nNodes}if(this.szSelectShape==
"queryresult")return!0;if(typeof this.szSelectShape=="object"){this.queryResultA=this.szSelectShape;if(this.szThemes=="generic")for(A=0;A<this.szSelectShape.length;A++)this.themeRootNodesA[A]=this.szSelectShape[A];else for(A=0;A<this.szSelectShape.length;A++)this.themeRootNodesA[A]=this.szSelectShape[A].node.parentNode;this.nNodes=this.themeRootNodesA.length=this.szSelectShape.length;this.szSelectShape="queryresult";this.szSelectQuery=this.szTitle;this.markGroup||(this.markGroup=map.Dom.newGroup(map.Layer.objectGroup,
this.szId+":markgroup"));return!0}if(this.szSelectShape=="activeBuffer"){D=map.Themes.activeBuffer;if(D!=null){B=[];A=D.chartGroup;J=A.getElementsByTagName("path");N=A.getElementsByTagName("circle");for(A=0;A<J.length;A++)B[B.length]=J.item(A);for(A=0;A<N.length;A++)B[B.length]=N.item(A);this.selectCenterA=[];for(A=0;A<B.length;A++)this.selectCenterA[this.selectCenterA.length]=map.Scale.getMapOffset(B[A]);this.selectBufferSize=D.nBufferSize/map.Scale.mapUnitsPPX;this.selectScale=D.nScale;this.markGroup||
(this.markGroup=map.Dom.newGroup(map.Layer.objectGroup,this.szId+":markgroup"));return!0}alert("error: no active theme/buffer to select with");return!1}if(this.szSelectShape=="mapbounds")A=map.Zoom.getBox(),this.selectCenterA=[],this.selectionCenter=new point(A.x+A.width/2,A.y+A.height/2),this.selectCenterA.push(this.selectionCenter),this.selectBufferSizeX=A.width/2,this.selectBufferSizeY=A.height/2,this.selectScale=1;else{this.selectCenterA=[];B=map.SVGDocument.getElementById(this.szSelectShape);
if(!B)return!1;B.fu=new Methods(B);if(this.szFlag.match(/shape/))B.fu.getPosition(),A=B.fu.getBox(),this.selectionCenter=new point(A.x+A.width/2,A.y+A.height/2),this.selectCenterA[this.selectCenterA.length]=this.selectionCenter,this.selectBufferSize=Math.max(A.width/2,A.height/2),this.selectBufferSize/=map.Scale.nZoomScale;else if(this.szFlag.match(/circle/)){A=B.fu.getPosition();A.x=Number(B.getAttributeNS(null,"cx"));A.y=Number(B.getAttributeNS(null,"cy"));this.selectionCenter=new point(A.x,A.y);
this.selectCenterA[this.selectCenterA.length]=map.Scale.getMapPosition(A.x,A.y);map.Scale.getMapPosition(A.x,A.y);this.selectBufferSize=B.getAttributeNS(null,"r");if(this.selectBufferSize===0)return!1;A=map.antiZoomAndPanList.getActualMatrix();this.selectBufferSize*=A[0]}else if(this.szFlag.match(/square/)){A=B.fu.getPosition();A.x=Number(B.getAttributeNS(null,"x"));A.y=Number(B.getAttributeNS(null,"y"));D=Number(B.getAttributeNS(null,"width"));B=Number(B.getAttributeNS(null,"height"));this.selectionCenter=
new point(A.x+D/2,A.y+B/2);this.selectCenterA[this.selectCenterA.length]=map.Scale.getMapPosition(A.x+D/2,A.y+B/2);map.Scale.getMapPosition(A.x+D/2,A.y+B/2);this.selectBufferSizeX=D/2;this.selectBufferSizeY=B/2;if(this.selectBufferSizeX===0||this.selectBufferSizeY===0)return!1;A=map.antiZoomAndPanList.getActualMatrix();this.selectBufferSizeX*=A[0];this.selectBufferSizeY*=A[0]}this.selectScale=map.Scale.nZoomScale;this.markGroup||(this.markGroup=map.Dom.newGroup(map.Layer.objectGroup,this.szId+":markgroup"))}return!0};
Ha.prototype.realize=function(){this.fShowProgressBar=!0;this.initValues()?(this.nSkipCount=this.nDoneCount=0,this.mapSleep=new ixMap.Sleep("activeSelection.selectShapes",100,map.Dictionary.getLocalText("do selection")),this.mapSleep.fShowProgressBar=!0,this.mapSleep.nCount=this.nCount,this.mapSleep.szCancel="activeSelection.cancel()",this.selectShapes()):(this.remove(),displayMessage("Selection could not be done",3E3))};Ha.prototype.realizeContinue=function(A){this.selectShapes(A)};Ha.prototype.realizeDone=
function(){this.nRefreshTimeout&&setTimeout("map.Themes.refreshTheme('"+this.szId+"')",this.nRefreshTimeout)};Ha.prototype.redraw=function(){};Ha.prototype.removeValues=function(){};Ha.prototype.disable=function(){};Ha.prototype.cancel=function(){this.fCancel=!0};Ha.prototype.nextThemeNode=function(A){return this.szThemes=="generic"||this.szSelectShape=="queryresult"?this.themeRootNodesA[A]:A===0?(this.nRootIndex=0,this.actNode=this.themeRootNodesA[this.nRootIndex].firstChild):this.actNode?(this.actNode=
this.actNode.nextSibling)?this.actNode:++this.nRootIndex>=this.themeRootNodesA.length?null:this.actNode=this.themeRootNodesA[this.nRootIndex].firstChild:null};Ha.prototype.selectShapes=function(A){if(!A||A===0)if(A=0,this.testA=[],this.itemA=[],this.chartPosA=[],this.exactCountA=[],this.exactSizeA=[],this.activeTheme||(this.activeTheme=map.Themes.activeTheme),this.activeTheme&&this.szThemesA[0]+" == "+this.activeTheme.szThemesA[0]){this.nPartsA=K(this.activeTheme.nPartsA);this.partsA=K(this.activeTheme.partsA);
this.origColorScheme=K(this.activeTheme.origColorScheme);this.colorScheme=K(this.activeTheme.colorScheme);this.szFieldsA=K(this.activeTheme.szFieldsA);this.szLabelA=K(this.activeTheme.szLabelA);this.szLegendLabelA=K(this.activeTheme.szLegendLabelA);this.szXaxisA=K(this.activeTheme.szXaxisA);this.szSymbolsA=K(this.activeTheme.szSymbolsA);this.szRanges=this.activeTheme.szRanges;this.szSizeField=this.activeTheme.szSizeField;this.nMeanA=K(this.activeTheme.nMeanA);this.nMedianA=K(this.activeTheme.nMedianA);
this.nDeviationA=K(this.activeTheme.nDeviationA);this.nFilterA=K(this.activeTheme.nFilterA);this.nOrigSumA=K(this.activeTheme.nOrigSumA);this.szUnit=this.activeTheme.szUnit;this.formatValue=this.activeTheme.formatValue;this.nMin100=this.activeTheme.nMin100;this.nMax100=this.activeTheme.nMax100;this.nClipFrames=this.activeTheme.nClipFrames;this.nActualFrame=this.activeTheme.nActualFrame;this.sortIndexDown=this.activeTheme.sortIndexDown;this.sortIndexUp=this.activeTheme.sortIndexUp;this.shuffleArray=
this.activeTheme.shuffleArray;this.removeDefinition=this.activeTheme.removeDefinition;this.szValuesTextStyle=this.activeTheme.szValuesTextStyle;this.nOrigValuesSumA=[];this.nValuesSumA=[];this.nValuesMinA=[];this.nValuesMaxA=[];this.nExactCount=this.nCount=this.nSum=this.nSum100=0;this.nMin=Number.MAX_VALUE;this.nMax=-Number.MAX_VALUE;this.nMinSize=Number.MAX_VALUE;this.nMaxSize=-Number.MAX_VALUE;for(var B=this.nSumSize=0;B<this.activeTheme.szFieldsA.length;B++)this.nOrigValuesSumA[B]=0,this.nValuesSumA[B]=
0,this.nValuesMinA[B]=Number.MAX_VALUE,this.nValuesMaxA[B]=-Number.MAX_VALUE;for(var D=0;D<this.partsA.length;D++)this.partsA[D].nCount=0,this.partsA[D].nSum=0,this.exactSizeA[D]=0}if(this.nNodes){var J=null,N=null,ia=this.selectBufferSize*this.selectScale,Y=null;this.selectBufferSizeX&&(ia=this.selectBufferSizeX*this.selectScale,Y=this.selectBufferSizeY*this.selectScale);for(D=A;D<this.nNodes;D++){this.mapSleep.nDoneCount=this.nDoneCount;if(this.mapSleep.checkSleep(D,10))return;if(this.szThemes==
"generic"){A=this.nextThemeNode(D);this.nDoneCount++;var W=!1;if(this.szSelectShape=="queryresult")W=!0;else if(this.szFlag.match(/shape/)){W=map.SVGDocument.getElementById(this.szSelectShape);var S=map.Api.getShapePoints(W.firstChild);W=q(this.activeTheme.getNodePosition(A),S)}else for(S=0;S<this.selectCenterA.length;S++){var ma=this.activeTheme.getNodePosition(A),ya=this.selectCenterA[S];ma&&ya&&ia?(B=ya.x-ma.x,ma=ya.y-ma.y,B=Y?Math.abs(B)<=ia&&Math.abs(ma)<=Y:Math.sqrt(B*B+ma*ma)<=ia):B=!1;if(B){W=
!0;break}}}else{J=this.nextThemeNode(D);this.nDoneCount++;if(!J||J.nodeType!=1)continue;if(J.getAttributeNS(null,"id").match(/:paint/))continue;A=map.Tiles.getMasterId(J.getAttributeNS(null,"id"));this.testA&&!this.testA[A]&&(this.testA[A]=J,this.nTested++);W=!1;if(this.szSelectShape=="queryresult")for(this.selectionCenter||(this.selectionCenter=new point(0,0)),S=0;S<this.queryResultA.length;S++){if(this.queryResultA[S].node.parentNode==J){W=!0;(S=J.getAttributeNS(szMapNs,"center"))&&S.length>2&&
(N=S.split(","),N=new point(Number(N[0].split(":")[1]),Number(N[1].split(":")[1])));N||(S=map.Dom.getBox(J),N=new point(S.x,S.y));S=map.Scale.mapCanvasCenter;map.Scale.getMapOffset(J);N.x+=S.x;N.y+=S.y;this.selectionCenter.x+=N.x/this.queryResultA.length;this.selectionCenter.y+=N.y/this.queryResultA.length;break}}else if(S=map.Dom.getBox(J),W=map.Scale.getMapOffset(J),S.x+=W.x,S.y+=W.y,S.x>this.selectCenterA[0].x+ia||S.y>this.selectCenterA[0].y+Y||S.x+S.width<this.selectCenterA[0].x-ia||S.y+S.height<
this.selectCenterA[0].y-Y)W=!1;else if(S.x<this.selectCenterA[0].x-ia&&S.y<this.selectCenterA[0].y-Y&&S.x+S.width>this.selectCenterA[0].x+ia&&S.y+S.height>this.selectCenterA[0].y+Y){S=J.getElementsByTagName("path");S=map.Api.getShapePoints(S.item(0));B=map.Scale.getMapOffset(J);for(let ba in S)S[ba].x+=B.x,S[ba].y+=B.y;W=q(new point(this.selectCenterA[0].x,this.selectCenterA[0].y),S)}else{W=!1;S=J.getElementsByTagName("path");S=map.Api.getShapePoints(S.item(0));B=map.Scale.getMapOffset(J);for(let ba in S)if(S[ba].x+
B.x<=this.selectCenterA[0].x+ia&&S[ba].y+B.y<=this.selectCenterA[0].y+Y&&S[ba].x+B.x>=this.selectCenterA[0].x-ia&&S[ba].y+B.y>=this.selectCenterA[0].y-Y){W=!0;break}}}if(W){if(this.szThemes=="generic")this.itemA[A]=this.activeTheme.itemA[A],this.nSelected++;else{this.szThemeType=="point"&&(this.markGroup?map.Dom.newShape("circle",this.markGroup,N.x,N.y,map.Scale.normalX(1)*map.Scale.nZoomScale,"fill:yellow;stroke:none;"):J&&J.style.setProperty("opacity","0.0"));W=J.getAttributeNS(szMapNs,"area");
if(this.itemA&&this.itemA[A])continue;this.itemA[A]=J;this.nSelected++;this.nSelectedArea+=Number(W)}if(this.activeTheme)for(W=[],this.activeTheme.itemA[A]?W.push(this.activeTheme.itemA[A]):this.activeTheme.posItemA[A]&&(W=this.activeTheme.posItemA[A]),A=0;A<W.length;A++)if(S=W[A],S.nValuesA.length!=1||!(isNaN(S.nValuesA[0])||S.nValuesA[0]===0&!this.activeTheme.szFlag.match(/ZEROISVALUE/))){this.nCount++;for(B=0;B<S.nValuesA.length;B++)isNaN(S.nValuesA[B])||(this.nOrigValuesSumA[B]+=S.nOrigValuesA[B],
this.nValuesSumA[B]+=S.nValuesA[B],this.nValuesMinA[B]=Math.min(this.nValuesMinA[B],S.nValuesA[B]),this.nValuesMaxA[B]=Math.max(this.nValuesMaxA[B],S.nValuesA[B]),this.nMin=Math.min(this.nMin,S.nValuesA[B]),this.nMax=Math.max(this.nMax,S.nValuesA[B]),this.nMinSize=Math.min(this.nMinSize,S.nSize||this.nMinSize),this.nMaxSize=Math.max(this.nMaxSize,S.nSize||this.nMaxSize),this.nSumSize+=S.nSize);S.nValue100&&(this.nSum100+=S.nValue100);if(this.activeTheme.szFlag.match(/AGGREGATE/)&&this.activeTheme.szFlag.match(/CATEGORICAL/))for(B=
0;B<this.partsA.length;B++)this.partsA[B].nCount+=S.nValuesA[B]?1:0,this.partsA[B].nSum+=S.nValuesA[B]||0,this.nSum+=S.nValuesA[B],this.nExactCount++,this.exactSizeA[B]+=S.nSize||1;else if(this.activeTheme.szFlag.match(/CATEGORICAL/))for(ma=0;ma<S.nValuesA.length;ma++)for(B=0;B<this.partsA.length;B++){if(S.nValuesA[ma]==this.partsA[B].min){this.partsA[B].nCount++;this.partsA[B].nSum+=S.nValuesA[ma];this.nSum+=S.nValuesA[ma];this.nExactCount++;this.exactSizeA[B]+=S.nSize||1;break}}else if(this.activeTheme.szFlag.match(/SEQUENCE/)||
this.activeTheme.szFlag.match(/CHART/))for(B=0;B<this.partsA.length;B++)this.partsA[B].nCount++,this.partsA[B].nSum+=S.nValuesA[B],this.nSum+=S.nValuesA[B];else if(this.activeTheme.szFlag.match(/CLIP/)&&this.activeTheme.nClipFrames)this.nSum=this.nClipFrames==S.nValuesA.length?this.nSum+Number(S.nValuesA[this.nActualFrame]):this.nSum+Number(S.nValuesA[0]*(this.nClipFrames-this.nActualFrame)/this.nClipFrames+S.nValuesA[S.nValuesA.length-1]*this.nActualFrame/this.nClipFrames);else for(ma=0;ma<S.nValuesA.length;ma++)for(B=
0;B<this.partsA.length;B++)if(S.nValuesA[ma]<this.partsA[B].max){this.partsA[B].nCount++;this.partsA[B].nSum+=S.nValuesA[ma];this.nSum+=S.nValuesA[ma];break}}}if(this.fCancel){this.fShowProgressBar=!1;this.showInfo(!1);clearMessage();return}}}this.nThemeItems===0&&(this.nThemeItems=this.nTested);if(this.szThemes!="generic"&&this.szThemeType!="point")for(var Ua in this.itemA)if((D=map.Tiles.getTileNodes(Ua))&&D.length)for(var ca in D)this.highLightList.addItem(D[ca]),this.highLightList.lock();else this.highLightList.addItem(this.itemA[Ua]),
this.highLightList.lock();this.isVisible=!0;this.realizeDone();this.fShowProgressBar=!1;clearMessage();if(map.HTMLWindow.ixmaps.htmlgui_onSelection(this.szId))return null;this.showInfo(!0)};Ha.prototype.showInfo=function(A){if(this.nCount===0)displayMessage("Selection: no values found !",1E3),this.remove();else if(this.nSelected===0)displayMessage("Selection is empty !",1E3),this.remove();else if(!this.widgetNode||this.fRedrawInfo){this.fRedrawInfo=!1;var B=this.szId+":display:widget",D=map.Dictionary.getLocalText("Selection");
typeof A=="undefined"||A||(D+=" ("+map.Dictionary.getLocalText("incomplete")+"!)");this.selectionCenter||(this.selectionCenter=map.Scale.mapCanvasCenter);this.widgetNode?(A=this.widgetNode,A.clear()):A=new InfoContainer(map.SVGDocument,map.SVGFixedGroup,B+":movable",this.selectionCenter,new point(-map.Scale.normalX(55),map.Scale.normalY(50)),"fixed|pointer",D);A.frameNode.style.setProperty("fill","#e8e8e8","");D=map.szTextGridStyle;map.szTextGridStyle="firstgray";this.widgetNode=A;A.fClipped=!1;var J=
A.workspaceNode;A.setOnRemove("map.Themes.removeTheme(evt,'"+this.szId+"')");var N=0;if(this.szSelectShape=="activeBuffer"){var ia=map.Themes.activeBuffer.szTitle;var Y=[map.Dictionary.getLocalText("layer"),map.Dictionary.getLocalText("selected by"),map.Dictionary.getLocalText("selected items"),this.szThemesA.length==1?String(map.Layer.listA[this.szThemesA[0]].szLegendName):"(multiple)",String(ia),String(this.nSelected)+" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*
this.nSelected,2))+"%)"],W=Array(3);W[0]="font-weight:bold;fill:#ffffff;";W[1]="font-weight:bold;fill:#ffffff;";W[2]="font-weight:bold;fill:#ffffff;";N+=50}else this.szSelectShape=="queryresult"?(ia=this.szThemes,this.szThemesA.length>1?ia="(multiple)":this.szThemes!="generic"&&(ia=String(map.Layer.listA[this.szThemesA[0]].szLegendName)),Y=[map.Dictionary.getLocalText("layer"),map.Dictionary.getLocalText("selected by"),map.Dictionary.getLocalText("selected items"),ia,this.szSelectQuery,String(this.nSelected)+
" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*this.nSelected,2))+"%)"],W=Array(3),W[0]="font-weight:bold;fill:#ffffff;",W[1]="font-weight:bold;fill:#ffffff;",W[2]="font-weight:bold;fill:#ffffff;",N+=50):(Y=this.szThemes=="generic"?[map.Dictionary.getLocalText("layer"),map.Dictionary.getLocalText("selected items"),"(generic)",String(this.nSelected)+" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*this.nSelected,2))+"%)"]:[map.Dictionary.getLocalText("layer"),
map.Dictionary.getLocalText("selected items"),this.szThemesA.length==1?String(map.Layer.listA[this.szThemesA[0]].szLegendName):"(multiple)",String(this.nSelected)+" / "+String(this.nThemeItems)+"  ("+String(__formatValue(100/this.nThemeItems*this.nSelected,2))+"%)"],W=Array(2),W[0]="font-weight:bold;fill:#ffffff;",W[1]="font-weight:bold;fill:#ffffff;",N+=40);var S=map.Dom.newGroup(J,"");S.fu.setPosition(map.Scale.normalY(3),map.Scale.normalY(3));createTextGrid(map.SVGDocument,S,B+":textgrid",Y,2,
11,W,"fill:#bbbbbb;");ia=[];if(this.activeTheme){N+=14;map.Dom.newText(J,map.Scale.normalX(3),map.Scale.normalY(N),"font-family:arial;font-weight:bold;font-size:"+map.Scale.normalY(11)+"px;fill:#555555;pointer-events:none",map.Dictionary.getLocalText("Theme")+": "+this.activeTheme.szTitle);N+=8;S=map.Dom.newGroup(J,"");S.fu.setPosition(map.Scale.normalY(3),map.Scale.normalY(N));this.drawDonutText=this.activeTheme.drawDonutText;this.drawTextforOneQuadrant=this.activeTheme.drawTextforOneQuadrant;this.createTextLabel=
this.activeTheme.createTextLabel;if(this.nValuesSumA.length==1){this.addItemValues=this.activeTheme.addItemValues;this.szFieldsA=this.activeTheme.szFieldsA;this.fField100=this.activeTheme.fField100;var ma=this.szFlag;this.szFlag=this.activeTheme.szFlag;this.itemA=[];Y=[];for(W=0;W<this.nOrigValuesSumA.length;W++)Y[W]=this.nOrigValuesSumA[W];this.addItemValues("selection",Y,this.nSum100);this.szFlag=ma;if(this.activeTheme.szFlag.match(/CATEGORICAL/))Y=[map.Dictionary.getLocalText("selected items"),
String(__formatValue(Number(this.nCount,2)))],W=Array(2),W[0]="font-weight:bold;fill:#7996D7;",W[1]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,S,B+":textgrid",Y,2,11,W),N+=S.fu.getBox().height/map.Scale.normalX(1)+5;else if(this.activeTheme.szAggregation&&this.activeTheme.szAggregation.match(/sum/)||this.activeTheme.szFlag.match(/SUM/)){if(Y=[map.Dictionary.getLocalText("value of selection"),map.Dictionary.getLocalText("% of total value")," ",map.Dictionary.getLocalText("min"),
map.Dictionary.getLocalText("max"),map.Dictionary.getLocalText("average"),String(__formatValue(Number(this.itemA.selection.nValuesA[0]),2))+" "+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/Number(this.activeTheme.nOrigSumA[0])*100,2))+" %"," ",String(__formatValue(Number(this.nValuesMinA[0]),2))+" "+this.szUnit,String(__formatValue(Number(this.nValuesMaxA[0]),2))+" "+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/this.nCount,2))+" "+this.szUnit],W=Array(12),W[0]="font-weight:bold;fill:#7996D7;",
W[6]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,S,B+":textgrid",Y,2,11,W),N+=S.fu.getBox().height/map.Scale.normalX(1)+5,B=map.Dom.newGroup(J,""),ia.push(B),S=DonutCharts.newChart(map.SVGDocument,B,map.Scale.normalX(55),map.Scale.normalY(55),0,0),S.setRadInner(0),S.setRadOuter(map.Scale.normalX(55)),S.setCenter(map.Scale.normalX(80),map.Scale.normalY(100)),Y=Number(this.nValuesSumA[0])/Number(this.activeTheme.nOrigSumA[0])*100,S.addPart(Y,map.Scale.normalY(20),
"#ddddee",0,this.formatValue(Y,2)+"%","selection: "+this.formatValue(Y,2)+"% of total value"),S.addPart(100-Y,map.Scale.normalY(20),"#f8f8ff",0,this.formatValue(100-Y,2)+"%",this.formatValue(100-Y,2)+"%"),S.realize(),map.Dom.newText(B,map.Scale.normalX(80),map.Scale.normalX(82),"font-size:"+map.Scale.normalX(10)/.66+"px;text-anchor:middle;baseline-shift:-60%;fill:darkgrey;stroke:none;pointer-events:none",this.formatValue(Y,0)+" % of total"),this.activeTheme.szFlag.match(/BUBBLE/)||this.activeTheme.szFlag.match(/SQUARE/)||
this.activeTheme.szFlag.match(/SYMBOL/))this.getOverviewChart=this.activeTheme.getOverviewChart,this.szOverviewChart=this.activeTheme.szOverviewChart,this.drawChart=this.activeTheme.drawChart,this.getOverviewChart&&(S=map.Dom.newGroup(J,""),B=map.Dom.newGroup(S,""),ia.push(S),S=this.szFlag,this.szFlag=this.activeTheme.szFlag,this.nOrigSumA=this.nOrigValuesSumA,this.nMaxA=this.nValuesMaxA,this.nMinA=this.nValuesMinA,this.szAggregation=this.activeTheme.szAggregation,this.getOverviewChart(B),this.szFlag=
S,B.fu.scale(1.3,1.3),B.fu.setPosition(map.Scale.normalX(-35),map.Scale.normalY(35)))}else this.fField100?(Y=[map.Dictionary.getLocalText("value of selection")," ",map.Dictionary.getLocalText("min value"),map.Dictionary.getLocalText("max value"),map.Dictionary.getLocalText("mean value"),String(__formatValue(Number(this.itemA.selection.nValuesA[0]),2))+this.szUnit," ",String(__formatValue(Number(this.nValuesMinA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesMaxA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/
this.nCount,2))+this.szUnit],W=Array(10),W[0]="font-weight:bold;fill:#7996D7;",W[5]="font-weight:bold;fill:#000000;font-size:240px;"):this.activeTheme.szFlag.match(/DENSITY/)?(Y=[map.Dictionary.getLocalText("value of selection")," ",map.Dictionary.getLocalText("min value"),map.Dictionary.getLocalText("max value"),map.Dictionary.getLocalText("mean value"),String(__formatValue(Number(this.itemA.selection.nValuesA[0]),2))+this.szUnit," ",String(__formatValue(Number(this.nValuesMinA[0]),2))+this.szUnit,
String(__formatValue(Number(this.nValuesMaxA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesSumA[0])/this.nCount,2))+this.szUnit],W=Array(10),W[0]="font-weight:bold;fill:#7996D7;",W[5]="font-weight:bold;fill:#000000;font-size:240px;"):(Y=[map.Dictionary.getLocalText("mean value"),map.Dictionary.getLocalText(" "),map.Dictionary.getLocalText("min value"),map.Dictionary.getLocalText("max value"),String(__formatValue(Number(this.nValuesSumA[0])/this.nCount,2))+this.szUnit,map.Dictionary.getLocalText(" "),
String(__formatValue(Number(this.nValuesMinA[0]),2))+this.szUnit,String(__formatValue(Number(this.nValuesMaxA[0]),2))+this.szUnit],W=Array(8),W[0]="font-weight:bold;fill:#7996D7;",W[4]="font-weight:bold;fill:#000000;font-size:240px;"),createTextGrid(map.SVGDocument,S,B+":textgrid",Y,2,11,W),N+=S.fu.getBox().height/map.Scale.normalX(1)+5;this.getOverviewChart=this.activeTheme.getOverviewChart;this.szOverviewChart=this.activeTheme.szOverviewChart;if(this.activeTheme.colorScheme.length>2||this.activeTheme.szFlag.match(/CATEGORICAL/)||
!this.activeTheme.szFlag.match(/CHART/)&&!this.activeTheme.szFlag.match(/DOMINANT/))this.szOverviewChart=this.nOrigSumA.length>5?"BAR":"PIE";this.szOverviewChart&&(B=map.Dom.newGroup(J,""),ia.push(B),this.getOverviewChart(B),this.szOverviewChart.match(/PIE/)&&this.activeTheme.szAggregation.match(/sum/)&&(this.szOverviewChart+="|PERCENTOFVALUE",B=map.Dom.newGroup(J,""),ia.push(B),this.getOverviewChart(B)));!this.activeTheme.szFlag.match(/CHART/)||this.activeTheme.szAggregation&&this.activeTheme.szAggregation.match(/sum/)||
(this.getOverviewChart=this.activeTheme.getOverviewChart,this.szOverviewChart=null,this.drawChart=this.activeTheme.drawChart,this.getOverviewChart&&(S=map.Dom.newGroup(J,""),B=map.Dom.newGroup(S,""),ia.push(S),S=this.szFlag,this.szFlag=this.activeTheme.szFlag,this.nOrigSumA=this.nOrigValuesSumA,this.nMaxA=this.nValuesMaxA,this.nMinA=this.nValuesMinA,this.nOverrideMax=this.activeTheme.nMax,this.szAggregation=this.activeTheme.szAggregation,this.getOverviewChart(B),this.szFlag=S,this.activeTheme.szFlag.match(/BAR/)?
(B.fu.scale(2.5,2.5),B.fu.setPosition(map.Scale.normalX(55),map.Scale.normalY(65))):(B.fu.scale(1.3,1.3),B.fu.setPosition(map.Scale.normalX(-35),map.Scale.normalY(35))),S=this.szFlag,this.szFlag=this.activeTheme.szFlag,this.szOverviewChart+="|PERCENTOFVALUE",B=map.Dom.newGroup(J,""),ia.push(B),this.getOverviewChart(B),this.szFlag=S))}else{if(this.activeTheme.szAggregation.match(/sum/)||this.activeTheme.szFlag.match(/SUM/))ma=this.nSum100?this.nSum100:this.activeTheme.szFlag.match(/CATEGORICAL/)?this.nExactCount:
this.nSum,Y=this.activeTheme.nSum100?this.activeTheme.nSum100:this.activeTheme.szFlag.match(/CATEGORICAL/)?this.activeTheme.nExactCount:this.activeTheme.nSum,Y=[map.Dictionary.getLocalText("total of selection"),String(__formatValue(ma,2))+" ("+String(__formatValue(Number(ma)/Number(Y)*100,2))+" %)"],W=Array(2),W[0]="font-weight:bold;fill:#7996D7;",W[1]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,S,B+":textgrid",Y,2,11,W),N+=S.fu.getBox().height/map.Scale.normalX(1)+
5;this.nSum100&&(ma=this.nSum100,this.activeTheme.szFlag.match(/DOMINANT/)||this.activeTheme.szAggregation.match(/sum/)||(ma/=this.nSelected),Y=this.activeTheme.nSum100,Y=[map.Dictionary.getLocalText("total of selection"),String(__formatValue(ma,2))+" ("+String(__formatValue(Number(ma)/Number(Y)*100,2))+" %)"],W=Array(2),W[0]="font-weight:bold;fill:#7996D7;",W[1]="font-weight:bold;fill:#000000;font-size:240px;",createTextGrid(map.SVGDocument,S,B+":textgrid",Y,2,11,W),N+=S.fu.getBox().height/map.Scale.normalX(1)+
5);this.drawChart=this.activeTheme.drawChart;this.getOverviewChart=this.activeTheme.getOverviewChart;this.szOverviewChart=this.activeTheme.szOverviewChart;if(this.activeTheme.szFlag.match(/CATEGORICAL/)||!this.activeTheme.szFlag.match(/CHART/)&&!this.activeTheme.szFlag.match(/DOMINANT/))this.szOverviewChart="PIE";this.nOrigSumA=this.nOrigValuesSumA;this.nMaxA=this.nValuesMaxA;this.nMinA=this.nValuesMinA;ma=this.szFlag;this.szFlag=this.activeTheme.szFlag;this.szAggregation=this.activeTheme.szAggregation;
this.szOverviewChart?(B=map.Dom.newGroup(J,""),ia.push(B),this.getOverviewChart(B),this.szOverviewChart.match(/PIE/)&&this.activeTheme.szAggregation.match(/sum/)&&(this.szOverviewChart+="|PERCENTOFVALUE",B=map.Dom.newGroup(J,""),ia.push(B),this.getOverviewChart(B))):(B=map.Dom.newGroup(J,""),this.nMin=this.activeTheme.nMin,this.nMax=this.activeTheme.nMax,S=1.8,this.szFlag.match(/DOMINANT/)&&(S=1.8),this.drawColorSchemeLegend=this.activeTheme.drawColorSchemeLegend,this.nOrigSumA=this.activeTheme.nOrigSumA,
this.nSum=this.activeTheme.nSum,this.szField100=this.activeTheme.szField100,this.drawColorSchemeLegend(B,"test").fu.scale(.9/S,.9/S),J=map.Dom.getBox(B),J.width>0&&J.height>0&&(B.fu.scale(S,S),B.fu.setPosition(map.Scale.normalX(10)-J.x*S,map.Scale.normalY(N)+map.Scale.normalY(5)-J.y*S),map.Dom.newText(B,J.x,J.y+J.height+map.Scale.normalX(6),"font-family:Arial;font-style:italic;font-size:"+map.Scale.normalY(6)+"px;fill:#888888;pointer-events:none",this.activeTheme.fField100||this.activeTheme.szAggregation.match(/sum/)?
map.Dictionary.getLocalText("* summary over selected area"):map.Dictionary.getLocalText("* arithmetic mean over selected area"))))}this.szFlag=ma}__formatValue(100/this.nThemeItems*this.nSelected,2);W=map.Scale.normalX(N);var ya=N=0;for(B=ma=J=0;B<ia.length;B++)S=ia[B],S.fu.scale(.8,.8),Y=S.fu.getBox(),ya=Math.min(ya,Y.y),J=Math.max(J,Y.width);W=W-ya+40;for(B=0;B<ia.length;B++)S=ia[B],Y=S.fu.getBox(),B===0?N=map.Scale.normalX(2)-0:B%2===0&&(W+=map.Scale.normalX(20)+ma,N=map.Scale.normalX(2)-Y.x,ma=
0),ma=Math.max(ma,Y.height),S.fu.setPosition(N,W),N+=J-map.Scale.normalX(10);A.reformat();map.szTextGridStyle=D}};Ha.prototype.markClass=function(A){};Ha.prototype.unmarkClass=function(A){};Ha.prototype.remove=function(A){this.parent.removeTheme(A,this.szId)};Ha.prototype.removeElements=function(A){this.markGroup&&(this.markGroup.style.setProperty("display","none",""),setTimeout("map.Dom.removeElementById('"+this.markGroup.getAttributeNS(null,"id")+"')",1E4));try{this.mapTool.remove()}catch(B){}this.highLightList.unlock();
this.highLightList.removeAll()};Ha.prototype.getItemNodes=function(A){return[]};Ha.prototype.getNodeArea=function(A){return this.nSelectedArea?this.nSelectedArea/1E6:1};ixMap.Selections.prototype.selectItemByPosition=function(A,B){A=map.Themes.getTheme(A);B=map.Scale.getMapPositionOfLatLon(B.lat,B.lng);for(var D in A.itemA){A=map.SVGDocument.getElementById(D).childNodes;for(var J=0;J<A.length;J++){var N=map.Api.getShapePoints(A.item(J));if(q(B,N))return D}}return null};ixMap.Selections.prototype.selectItemByBoundingBox=
function(A,B){var D=map.Themes.getTheme(A);A=map.Scale.getMapPositionOfLatLon(B[0].lat,B[0].lng);B=map.Scale.getMapPositionOfLatLon(B[1].lat,B[1].lng);let J=[];for(var N in D.itemA){D=map.SVGDocument.getElementById(N).childNodes;for(var ia=0;ia<D.length;ia++){var Y=map.Api.getShapePoints(D.item(ia)),W;for(W in Y){Y[W].x>A.x&&Y[W].x<B.x&&Y[W].y<A.y&&Y[W].y>B.y&&J.push(N);break}}}return J}})();(function(){function Ha(ca,ba,ka,ha,wa,za){this.targetDocument=window.document;this.targetGroup=ba;this.mX=isNaN(ka)?0:ka;this.mY=isNaN(ha)?0:ha;this.nRadOuter=isNaN(wa)?0:wa;this.nRadInner=isNaN(za)?0:za;this.szStyle="flat";this.szLine=null;this.nLineWidth=1;this.partsA=[]}function q(ca,ba,ka,ha){ca=ba.createElementNS("http://www.w3.org/2000/svg",ca);ka.appendChild(ca);for(var wa in ha)ca.setAttribute(wa,ha[wa]);return ca}function K(ca,ba,ka,ha,wa,za,c,b,f,a,p,m,w,C,z,y,O){y==null&&(y=0);var t=b<
f?(b+f)/2:Math.max(360,(b+f+360)/2);var d=Math.sin(t/180*Math.PI);t=-Math.cos(t/180*Math.PI);ka+=y*d;ha+=y*t;z==null&&(z="3D");a==null&&(a="#ffff00");p==null&&(p=ColorScheme.getDerivateColor(a,.7));m==null&&(m=ColorScheme.getDerivateColor(a,.7));w==null&&(w=ColorScheme.getBorderColor(a));ba=z.match(/SILENT/)?q("g",ca,ba,{}):q("g",ca,ba,{onmouseover:"DonutCharts.partOver(evt)",onmouseout:"DonutCharts.partOut(evt)",onmousedown:"DonutCharts.partDown(evt)",onmouseup:"DonutCharts.partUp(evt)"});if(b<0||
f<0||b==f)return ba;q("rect",ca,ba,{id:"extractPoint",x:d*wa/3,y:t*wa/3,width:0,height:0,style:"fill:none;stroke:none"});z.match(/3D/)&&(b>f?(A(ca,ba,ka,ha,wa,za,c,b,360,p,"none",0),A(ca,ba,ka,ha,wa,za,c,0,f,p,"none",0)):A(ca,ba,ka,ha,wa,za,c,b,f,p,w,C));z.match(/3D/)&&b>180&&(y=""+ya(ka,ha-c,wa,b),y+=Ua(ka,ha-c,za,b),y+=Ua(ka,ha,za,b),y+=Ua(ka,ha,wa,b),y+=Ua(ka,ha-c,wa,b),q("path",ca,ba,{d:y,style:"stroke:"+w+";fill:"+m+";stroke-width:"+C+";"}));z.match(/3D/)&&f<180&&(y=""+ya(ka,ha-c,wa,f),y+=Ua(ka,
ha-c,za,f),y+=Ua(ka,ha,za,f),y+=Ua(ka,ha,wa,f),y+=Ua(ka,ha-c,wa,f),q("path",ca,ba,{d:y,style:"stroke:"+w+";fill:"+m+";stroke-width:"+C+";"}));z.match(/3D/)&&(b>f?(B(ca,ba,ka,ha,wa,za,c,b,360,p,"none",0),B(ca,ba,ka,ha,wa,za,c,0,f,p,"none",0)):B(ca,ba,ka,ha,wa,za,c,b,f,p,w,C));f-b>=360?(y=""+ya(ka,ha-c,wa,b),y+=S(ka,ha-c,wa,b,f,O),y+=ya(ka,ha-c,za,f),za&&(y+=ma(ka,ha-c,za,f,b))):(y=""+ya(ka,ha-c,wa,b),y+=S(ka,ha-c,wa,b,f,O),y+=Ua(ka,ha-c,za,f),za&&(y+=ma(ka,ha-c,za,f,b)),y+=Ua(ka,ha-c,wa,b));q("path",
ca,ba,{d:y,style:"stroke:"+w+";fill:"+a+";stroke-width:"+C+";"});return ba}function A(ca,ba,ka,ha,wa,za,c,b,f,a,p,m){b>90&&b<270&&f<270||(wa=""+ya(ka,ha-c,za,b),wa+=S(ka,ha-c,za,b,f),wa+=Ua(ka,ha,za,f),wa+=ma(ka,ha,za,f,b),wa+=Ua(ka,ha-c,za,b),q("path",ca,ba,{d:wa,style:"stroke:"+p+";fill:"+a+";stroke-width:"+m+";"}))}function B(ca,ba,ka,ha,wa,za,c,b,f,a,p,m){za=Math.max(b,90);f=Math.min(f,270);za>f||(b=""+ya(ka,ha-c,wa,za),b+=S(ka,ha-c,wa,za,f),b+=Ua(ka,ha,wa,f),b+=ma(ka,ha,wa,f,za),b+=Ua(ka,ha-
c,wa,za),q("path",ca,ba,{d:b,style:"stroke:"+p+";fill:"+a+";stroke-width:"+m+";"}))}function D(ca){var ba=Number(ca.currentTarget.firstChild.getAttributeNS(null,"x")),ka=Number(ca.currentTarget.firstChild.getAttributeNS(null,"y"));ca.currentTarget.setAttribute("transform","translate("+ba/25+","+ka/25+")");try{eval(ca.currentTarget.getAttribute("onover"))}catch(ha){}}function J(ca){ca.currentTarget.setAttribute("transform","translate(0,0)");try{eval(ca.currentTarget.getAttribute("onout"))}catch(ba){}}
function N(ca){var ba=Number(ca.currentTarget.firstChild.getAttributeNS(null,"x")),ka=Number(ca.currentTarget.firstChild.getAttributeNS(null,"y"));ka+=map.Scale.normalY(.1);ca.currentTarget.setAttribute("transform","translate("+ba/5+","+ka/5+")")}function ia(ca){var ba=Number(ca.currentTarget.firstChild.getAttributeNS(null,"x")),ka=Number(ca.currentTarget.firstChild.getAttributeNS(null,"y"));ca.currentTarget.setAttribute("transform","translate("+ba/5+","+ka/5+")")}function Y(ca){if(ca.firstChild){var ba=
Number(ca.firstChild.getAttributeNS(null,"x")),ka=Number(ca.firstChild.getAttributeNS(null,"y"));if(ba&&ka)return ca.setAttribute("transform","translate("+ba+","+ka+")"),!0}return!1}function W(ca){if(ca.firstChild){var ba=Number(ca.firstChild.getAttributeNS(null,"x")),ka=Number(ca.firstChild.getAttributeNS(null,"y"));if(ba&&ka)return ca.setAttribute("transform","translate(0,0)"),!0}return!1}function S(ca,ba,ka,ha,wa,za){var c,b=" ";ha%=360;if(ha>wa)return b+=S(ca,ba,ka,ha,360,za),b+=S(ca,ba,ka,0,
wa,za);for(c=1;c<=8;c++)if(!(ha>c*45||wa<(c-1)*45)){var f=Math.max(ha,(c-1)*45);var a=Math.min(wa,c*45);if(f!=a){f>180&&(f=360-f);f>90&&(f=180-f);f>45&&(f=90-f);a>180&&(a=360-a);a>90&&(a=180-a);a>45&&(a=90-a);var p=Math.PI*f/180;var m=Math.PI*a/180;var w=ka*Math.sin(p);var C=ka*Math.cos(p);a=ka*Math.sin(m);f=ka*Math.cos(m);w=C+Math.tan(p)*w;C=f+Math.tan(m)*a;m=(C-w)/(Math.tan(m)-Math.tan(p));p=-Math.tan(p)*m+w;m*=za||1;p*=za||1;switch(c){case 1:var z=a;var y=m;var O=-f;var t=-p;break;case 2:z=f;y=
p;O=-a;t=-m;break;case 3:z=f;y=p;O=a;t=m;break;case 4:z=a;y=m;O=f;t=p;break;case 5:z=-a;y=-m;O=f;t=p;break;case 6:z=-f;y=-p;O=a;t=m;break;case 7:z=-f;y=-p;O=-a;t=-m;break;case 8:z=-a,y=-m,O=-f,t=-p}b+="Q"+String(ca+y)+","+String(ba+t)+" "+String(ca+z)+","+String(ba+O)}}return b}function ma(ca,ba,ka,ha,wa){var za="";ha=(""+S(ca,ba,ka,wa,ha)).split("Q");for(var c=ha.length-1;c>0;c--)for(var b=ha[c].split(" "),f=1;f>=0;f--)if(c!=ha.length-1||f!=1)za=f===0?za+(" Q"+b[f]):za+(" "+b[f]);wa=Math.PI*wa/180;
return za+=" "+String(ca+ka*Math.sin(wa))+","+String(ba+-(ka*Math.cos(wa)))}function ya(ca,ba,ka,ha){ha=Math.PI*ha/180;return"M"+String(ca+ka*Math.sin(ha))+","+String(ba+-(ka*Math.cos(ha)))}function Ua(ca,ba,ka,ha){ha=Math.PI*ha/180;return"L"+String(ca+ka*Math.sin(ha))+","+String(ba+-(ka*Math.cos(ha)))}Ha.prototype.setCenter=function(ca,ba){this.mX=ca;this.mY=ba};Ha.prototype.setRadOuter=function(ca){this.nRadOuter=isNaN(ca)?0:ca};Ha.prototype.setRadInner=function(ca){this.nRadInner=isNaN(ca)?0:ca};
Ha.prototype.setStyle=function(ca){this.szStyle=ca};Ha.prototype.addStyle=function(ca){this.szStyle+="|"+ca};Ha.prototype.setLine=function(ca){this.szLine=ca};Ha.prototype.setLineWidth=function(ca){this.nLineWidth=ca};Ha.prototype.setMaxValue=function(ca){this.nMaxValue=ca};Ha.prototype.setNormalSizeValue=function(ca){this.nNormalSizeValue=ca};Ha.prototype.addPart=function(ca,ba,ka,ha,wa,za,c,b){this.partsA[this.partsA.length]={nPercent:ca,nInfoValue:ca,nHeight:ba,color:ka,nOffset:ha,szText:wa,szInfo:za,
szOver:c,szOut:b};return this.partsA[this.partsA.length-1]};Ha.prototype.realize=function(){var ca,ba=360,ka=this.partsA[0],ha=0,wa=this.partsA.length-1;this.donutPartsA=[];for(var za=!1,c=0;c<this.partsA.length;c++)this.partsA[c].nPercent>0&&(this.szStyle.match(/BIGTOTOP/)&&this.partsA[c].nPercent>ha&&(ka=this.partsA[c],ha=this.partsA[c].nPercent),za=!0);if(za||this.szStyle.match(/AUTOCOMPLETE/)){var b=ca=0,f=0,a=za=ha=0;if(this.szStyle.match(/VOLUME/)){for(c=0;c<this.partsA.length;c++)b+=this.partsA[c].nPercent,
ca+=Math.sqrt(this.partsA[c].nPercent);ca=Math.sqrt(this.nMaxValue*this.partsA.length);for(c=0;c<this.partsA.length;c++)this.partsA[c].nPercent=100/ca*Math.sqrt(this.partsA[c].nPercent),this.szStyle.match(/VOLUME/)&&(this.partsA[c].nHeight*=this.partsA[c].nPercent/25);f=100/ca*Math.sqrt(this.nMaxValue||100);ha=100/ca*Math.sqrt(this.nMaxValue/4||50);za=100/ca*Math.sqrt(this.nMaxValue/2||50);a=100/ca*Math.sqrt(this.nMaxValue/4*3||50)}if(this.szStyle.match(/STARBURST/)){for(c=0;c<this.partsA.length;c++)b+=
this.partsA[c].nPercent,ca+=Math.sqrt(this.partsA[c].nPercent);f=this.nMaxValue||100;ha=this.nMaxValue/4||50;za=this.nMaxValue/2||50;a=this.nMaxValue/4*3||50}else{for(c=0;c<this.partsA.length;c++)b+=this.partsA[c].nPercent;if(b!=100)if(this.szStyle.match(/AUTOCOMPLETE/)&&b<100)this.addPart(Math.floor((100-b)*1E5)/1E5,this.partsA[0]?this.partsA[0].nHeight:0,this.szNoDataColor||"#eeeeee",0,"");else for(c=0;c<this.partsA.length;c++)this.partsA[c].nPercent=this.partsA[c].nPercent/b*100}if(this.szStyle.match(/SYMMETRIC/))if(this.szStyle.match(/STARBURST/))ba=
360-Math.floor(360/this.partsA.length/2);else if(this.szStyle.match(/BIGTOTOP/)){ba=360;for(c=0;c<this.partsA.length&&this.partsA[c]!=ka;c++)ba-=this.partsA[c].nPercent<100?Math.floor(3.6*this.partsA[c].nPercent):0;ba-=this.partsA[c].nPercent<100?Math.floor(1.8*ka.nPercent):0}else this.partsA[0].nPercent<100&&(ba=360-Math.floor(1.8*this.partsA[0].nPercent));this.szStyle.match(/HALF/)&&(ba=270);this.szStyle.match(/HALFPLUS10/)&&(ba=260);this.szStyle.match(/HALFMINUS10/)&&(ba=280);this.szStyle.match(/HALFPLUS20/)&&
(ba=250);this.szStyle.match(/HALFMINUS20/)&&(ba=290);b=this.szStyle.match(/HALF/)?180:360;b=this.szStyle.match(/HALFPLUS10/)?200:b;b=this.szStyle.match(/HALFMINUS10/)?160:b;b=this.szStyle.match(/HALFPLUS20/)?220:b;b=this.szStyle.match(/HALFMINUS20/)?140:b;var p=0,m=0;this.szStyle.match(/STARBURST/)&&(p=b/this.partsA.length,this.nRadOuter+=this.nRadInner,this.szStyle.match(/XLRAYS/)?(p=Math.min(b/4,b/this.partsA.length),m=p*.1*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):
this.szStyle.match(/LRAYS/)?(p=Math.min(b/4,b/this.partsA.length),m=p*.2*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/XSRAYS/)?(p=Math.min(b/12,b/this.partsA.length),m=p*.4*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/SRAYS/)?(p=Math.min(b/10,b/this.partsA.length),m=p*.33*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)):this.szStyle.match(/RAYS/)&&(p=b/this.partsA.length,
m=p*.35*(this.szStyle.match(/HALF/)?.5:1),this.nRadInner=Math.max(5,this.nRadInner)));for(c=this.nRadOuterMaxR=this.nRadOuterMaxL=0;c<this.partsA.length;c++)this.szStyle.match(/STARBURST/)||(p=this.partsA[c].nPercent/100*b,m=0),ca=ba%360,ba=ca+p,ba>360&&(ba%=360),this.szStyle.match(/DIRECTION/)?this.donutPartsA[c]=this.partsA[c].nAngle?{nStartAngle:this.partsA[c].nAngle-1,nEndAngle:this.partsA[c].nAngle+1,color:this.partsA[c].color,nHeight:this.partsA[c].nHeight,nOffset:this.partsA[c].nOffset}:{}:
this.szStyle.match(/DIRECTED/)?this.donutPartsA[c]=this.partsA[c].nAngle?{nStartAngle:this.partsA[c].nAngle-10,nEndAngle:this.partsA[c].nAngle+10,color:this.partsA[c].color,nHeight:this.partsA[c].nHeight,nOffset:this.partsA[c].nOffset}:{}:this.donutPartsA[c]={nStartAngle:ca+m,nEndAngle:ba-m,color:this.partsA[c].color,nHeight:this.partsA[c].nHeight,nOffset:this.partsA[c].nOffset},this.szStyle.match(/3D/)||(this.donutPartsA[c].nHeight=0),this.szStyle.match(/STARBURST/)&&(ka=this.nMaxValue/(this.nNormalSizeValue||
this.nMaxValue)*2.14,this.donutPartsA[c].nRadOuter=Math.max(1,this.nRadInner+Math.sqrt(this.partsA[c].nPercent)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*ka)),ca<=180&&ba>=180&&(wa=c),ca<=180?this.nRadOuterMaxR=Math.max(this.nRadOuterMaxR,this.donutPartsA[c].nRadOuter):this.nRadOuterMaxL=Math.max(this.nRadOuterMaxL,this.donutPartsA[c].nRadOuter),this.partsA[c].nOpacity&&(this.donutPartsA[c].nOpacity=this.partsA[c].nOpacity);this.szStyle.match(/STARBURST/)&&this.szStyle.match(/POLAR/)&&
(ka=this.nMaxValue/(this.nNormalSizeValue||this.nMaxValue)*2.14,ba=Math.max(1,this.nRadInner+Math.sqrt(f)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*ka),ba=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,ba,"fill:white;fill-opacity:0.25;stroke:#444444;stroke-width:1px;"),ba.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*.75)+"-"+String((this.nMaxValue||100)*1)),ba=Math.max(1,this.nRadInner+Math.sqrt(a)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*
ka),ba=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,ba,"fill:none;stroke:#444444;stroke-width:3px;stroke-dasharray:50 50"),ba.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*.5)+"-"+String((this.nMaxValue||100)*.75)),ba=Math.max(1,this.nRadInner+Math.sqrt(za)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*ka),ba=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,ba,"fill:none;stroke:#444444;stroke-width:1px;"),ba.setAttributeNS(szMapNs,"tooltip",
"range "+String((this.nMaxValue||100)*.25)+"-"+String((this.nMaxValue||100)*.5)),ba=Math.max(1,this.nRadInner+Math.sqrt(ha)/Math.sqrt(this.nMaxValue)*(this.nRadOuter-this.nRadInner)*ka),ba=map.Dom.newShape("circle",this.targetGroup,this.mX,this.mY,ba,"fill:none;stroke:#444444;stroke-width:3px;stroke-dasharray:50 50"),ba.setAttributeNS(szMapNs,"tooltip","range "+String((this.nMaxValue||100)*0)+"-"+String((this.nMaxValue||100)*.25)));if(this.szStyle.match(/HALF/))for(wa=this.donutPartsA.length,c=0;c<
wa;c++)this.donutPartsA[c].nEndAngle>270&&(this.donutPartsA.push(this.donutPartsA.splice(c,1)[0]),this.partsA.push(this.partsA.splice(c,1)[0]),wa--,c=-1);this.frameGroup=q("g",this.targetDocument,this.targetGroup,{});for(c=0;c<wa;c++)ba=K(this.targetDocument,this.frameGroup,this.mX,this.mY,this.donutPartsA[c].nRadOuter?this.donutPartsA[c].nRadOuter:this.nRadOuter,this.nRadInner,this.donutPartsA[c].nHeight,this.donutPartsA[c].nStartAngle,this.donutPartsA[c].nEndAngle,this.donutPartsA[c].color,null,
null,this.szLine,this.nLineWidth*(this.donutPartsA[c].nRadOuter?this.donutPartsA[c].nRadOuter:this.nRadOuter)/300,this.szStyle,this.donutPartsA[c].nOffset,this.nBow),this.szStyle.match(/SILENT/)||(ba.setAttributeNS(szMapNs,"tooltip",this.partsA[c].szInfo?this.partsA[c].szText+this.partsA[c].szInfo:Math.round(this.partsA[c].nInfoValue*10)/10+" % "),this.partsA[c].szOver&&ba.setAttributeNS(szMapNs,"onover",this.partsA[c].szOver),this.partsA[c].szOut&&ba.setAttributeNS(szMapNs,"onout",this.partsA[c].szOut)),
this.donutPartsA[c].nOpacity&&(ba.style.setProperty("stroke-opacity","0.6",""),ba.style.setProperty("fill-opacity","0.1","")),this.donutPartsA[c].objNode=ba;for(c=this.donutPartsA.length-1;c>=wa;c--)ba=K(this.targetDocument,this.frameGroup,this.mX,this.mY,this.donutPartsA[c].nRadOuter?this.donutPartsA[c].nRadOuter:this.nRadOuter,this.nRadInner,this.donutPartsA[c].nHeight,this.donutPartsA[c].nStartAngle,this.donutPartsA[c].nEndAngle,this.donutPartsA[c].color,null,null,this.szLine,this.nLineWidth*(this.donutPartsA[c].nRadOuter?
this.donutPartsA[c].nRadOuter:this.nRadOuter)/300,this.szStyle,this.donutPartsA[c].nOffset,this.nBow),this.szStyle.match(/SILENT/)||(ba.setAttributeNS(szMapNs,"tooltip",this.partsA[c].szInfo?this.partsA[c].szText+this.partsA[c].szInfo:Math.round(this.partsA[c].nInfoValue*10)/10+" % "),this.partsA[c].szOver&&ba.setAttributeNS(szMapNs,"onover",this.partsA[c].szOver),this.partsA[c].szOut&&ba.setAttributeNS(szMapNs,"onout",this.partsA[c].szOut)),this.donutPartsA[c].nOpacity&&(ba.style.setProperty("stroke-opacity",
"0.6",""),ba.style.setProperty("fill-opacity","0.1","")),this.donutPartsA[c].objNode=ba;this.szStyle.match(/3D/)&&this.frameGroup.setAttributeNS(null,"transform","matrix(1 0 0 0.5 0 0)")}else q("circle",this.targetDocument,this.targetGroup,{id:"emptypie",cx:this.mX,cy:this.mY,r:this.nRadOuter,style:"fill:none;stroke:gray"}),ba=this.targetDocument,wa=q("text",ba,this.targetGroup,{x:String(this.mX),y:String(this.mY),style:"fill:gray;font-size:"+this.nRadOuter/5+";text-anchor:middle;"}),ba=ba.createTextNode("Pie error: no values !"),
wa.appendChild(ba)};Ha.prototype.getTextPosition=function(ca){if(!this.donutPartsA[ca])return null;var ba=this.donutPartsA[ca].nRadOuter?this.donutPartsA[ca].nRadOuter:this.nRadOuter;var ka=this.donutPartsA[ca].nStartAngle;var ha=this.donutPartsA[ca].nEndAngle;if(ka==ha)return null;ha=ka<ha?(ka+ha)/2:Math.min(360,(ka+ha+360)/2)%360;ka=ha<180?this.nRadOuterMaxR?this.nRadOuterMaxR+(this.nRadOuterMaxL>this.nRadOuterMaxR?Math.min(this.nRadOuterMaxR,(this.nRadOuterMaxL-this.nRadOuterMaxR)/2):0):this.nRadOuter:
this.nRadOuterMaxL?this.nRadOuterMaxL+(this.nRadOuterMaxR>this.nRadOuterMaxL?Math.min(this.nRadOuterMaxL,(this.nRadOuterMaxR-this.nRadOuterMaxL)/2):0):this.nRadOuter;return{x:Math.sin(ha/180*Math.PI)*ka*1.1,y:-Math.cos(ha/180*Math.PI)*ka*1.1-this.donutPartsA[ca].nHeight,lx:Math.sin(ha/180*Math.PI)*ba,ly:-Math.cos(ha/180*Math.PI)*ba-this.donutPartsA[ca].nHeight}};window.DonutCharts=new function(){this.newChart=function(ca,ba,ka,ha,wa,za){return new Ha(ca,ba,ka,ha,wa,za)};this.partOver=D;this.partOut=
J;this.partDown=N;this.partUp=ia;this.partDrawOut=Y;this.partDrawIn=W}})();
